function BB(r,t){for(var n=0;n<t.length;n++){const i=t[n];if(typeof i!="string"&&!Array.isArray(i)){for(const o in i)if(o!=="default"&&!(o in r)){const a=Object.getOwnPropertyDescriptor(i,o);a&&Object.defineProperty(r,o,a.get?a:{enumerable:!0,get:()=>i[o]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();/*!
 * Vue.js v2.7.14
 * (c) 2014-2022 Evan You
 * Released under the MIT License.
 */var Mi=Object.freeze({}),hn=Array.isArray;function Ue(r){return r==null}function $t(r){return r!=null}function ys(r){return r===!0}function zB(r){return r===!1}function ym(r){return typeof r=="string"||typeof r=="number"||typeof r=="symbol"||typeof r=="boolean"}function hs(r){return typeof r=="function"}function Fr(r){return r!==null&&typeof r=="object"}var dS=Object.prototype.toString;function Fi(r){return dS.call(r)==="[object Object]"}function VB(r){return dS.call(r)==="[object RegExp]"}function tM(r){var t=parseFloat(String(r));return t>=0&&Math.floor(t)===t&&isFinite(r)}function Kb(r){return $t(r)&&typeof r.then=="function"&&typeof r.catch=="function"}function UB(r){return r==null?"":Array.isArray(r)||Fi(r)&&r.toString===dS?JSON.stringify(r,null,2):String(r)}function Pp(r){var t=parseFloat(r);return isNaN(t)?r:t}function na(r,t){for(var n=Object.create(null),i=r.split(","),o=0;o<i.length;o++)n[i[o]]=!0;return t?function(a){return n[a.toLowerCase()]}:function(a){return n[a]}}na("slot,component",!0);var WB=na("key,ref,slot,slot-scope,is");function Dc(r,t){var n=r.length;if(n){if(t===r[n-1]){r.length=n-1;return}var i=r.indexOf(t);if(i>-1)return r.splice(i,1)}}var GB=Object.prototype.hasOwnProperty;function Qr(r,t){return GB.call(r,t)}function fh(r){var t=Object.create(null);return function(i){var o=t[i];return o||(t[i]=r(i))}}var HB=/-(\w)/g,Bu=fh(function(r){return r.replace(HB,function(t,n){return n?n.toUpperCase():""})}),jB=fh(function(r){return r.charAt(0).toUpperCase()+r.slice(1)}),qB=/\B([A-Z])/g,xm=fh(function(r){return r.replace(qB,"-$1").toLowerCase()});function KB(r,t){function n(i){var o=arguments.length;return o?o>1?r.apply(t,arguments):r.call(t,i):r.call(t)}return n._length=r.length,n}function XB(r,t){return r.bind(t)}var eM=Function.prototype.bind?XB:KB;function Xb(r,t){t=t||0;for(var n=r.length-t,i=new Array(n);n--;)i[n]=r[n+t];return i}function ns(r,t){for(var n in t)r[n]=t[n];return r}function nM(r){for(var t={},n=0;n<r.length;n++)r[n]&&ns(t,r[n]);return t}function ar(r,t,n){}var s0=function(r,t,n){return!1},sM=function(r){return r};function zu(r,t){if(r===t)return!0;var n=Fr(r),i=Fr(t);if(n&&i)try{var o=Array.isArray(r),a=Array.isArray(t);if(o&&a)return r.length===t.length&&r.every(function(u,h){return zu(u,t[h])});if(r instanceof Date&&t instanceof Date)return r.getTime()===t.getTime();if(!o&&!a){var l=Object.keys(r),c=Object.keys(t);return l.length===c.length&&l.every(function(u){return zu(r[u],t[u])})}else return!1}catch{return!1}else return!n&&!i?String(r)===String(t):!1}function rM(r,t){for(var n=0;n<r.length;n++)if(zu(r[n],t))return n;return-1}function R1(r){var t=!1;return function(){t||(t=!0,r.apply(this,arguments))}}function YB(r,t){return r===t?r===0&&1/r!==1/t:r===r||t===t}var rk="data-server-rendered",W2=["component","directive","filter"],iM=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch","renderTracked","renderTriggered"],mo={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:s0,isReservedAttr:s0,isUnknownElement:s0,getTagNamespace:ar,parsePlatformTagName:sM,mustUseProp:s0,async:!0,_lifecycleHooks:iM},ZB=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function oM(r){var t=(r+"").charCodeAt(0);return t===36||t===95}function lc(r,t,n,i){Object.defineProperty(r,t,{value:n,enumerable:!!i,writable:!0,configurable:!0})}var JB=new RegExp("[^".concat(ZB.source,".$_\\d]"));function QB(r){if(!JB.test(r)){var t=r.split(".");return function(n){for(var i=0;i<t.length;i++){if(!n)return;n=n[t[i]]}return n}}}var tz="__proto__"in{},Vi=typeof window<"u",vo=Vi&&window.navigator.userAgent.toLowerCase(),of=vo&&/msie|trident/.test(vo),af=vo&&vo.indexOf("msie 9.0")>0,aM=vo&&vo.indexOf("edge/")>0;vo&&vo.indexOf("android")>0;var ez=vo&&/iphone|ipad|ipod|ios/.test(vo),ik=vo&&vo.match(/firefox\/(\d+)/),Yb={}.watch,lM=!1;if(Vi)try{var ok={};Object.defineProperty(ok,"passive",{get:function(){lM=!0}}),window.addEventListener("test-passive",null,ok)}catch{}var r0,bm=function(){return r0===void 0&&(!Vi&&typeof global<"u"?r0=global.process&&global.process.env.VUE_ENV==="server":r0=!1),r0},O1=Vi&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function yd(r){return typeof r=="function"&&/native code/.test(r.toString())}var wm=typeof Symbol<"u"&&yd(Symbol)&&typeof Reflect<"u"&&yd(Reflect.ownKeys),Bp;typeof Set<"u"&&yd(Set)?Bp=Set:Bp=function(){function r(){this.set=Object.create(null)}return r.prototype.has=function(t){return this.set[t]===!0},r.prototype.add=function(t){this.set[t]=!0},r.prototype.clear=function(){this.set=Object.create(null)},r}();var Ip=null;function vc(r){r===void 0&&(r=null),r||Ip&&Ip._scope.off(),Ip=r,r&&r._scope.on()}var Pi=function(){function r(t,n,i,o,a,l,c,u){this.tag=t,this.data=n,this.children=i,this.text=o,this.elm=a,this.ns=void 0,this.context=l,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=n&&n.key,this.componentOptions=c,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=u,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1}return Object.defineProperty(r.prototype,"child",{get:function(){return this.componentInstance},enumerable:!1,configurable:!0}),r}(),ku=function(r){r===void 0&&(r="");var t=new Pi;return t.text=r,t.isComment=!0,t};function hd(r){return new Pi(void 0,void 0,void 0,String(r))}function Zb(r){var t=new Pi(r.tag,r.data,r.children&&r.children.slice(),r.text,r.elm,r.context,r.componentOptions,r.asyncFactory);return t.ns=r.ns,t.isStatic=r.isStatic,t.key=r.key,t.isComment=r.isComment,t.fnContext=r.fnContext,t.fnOptions=r.fnOptions,t.fnScopeId=r.fnScopeId,t.asyncMeta=r.asyncMeta,t.isCloned=!0,t}var nz=0,v1=[],sz=function(){for(var r=0;r<v1.length;r++){var t=v1[r];t.subs=t.subs.filter(function(n){return n}),t._pending=!1}v1.length=0},yc=function(){function r(){this._pending=!1,this.id=nz++,this.subs=[]}return r.prototype.addSub=function(t){this.subs.push(t)},r.prototype.removeSub=function(t){this.subs[this.subs.indexOf(t)]=null,this._pending||(this._pending=!0,v1.push(this))},r.prototype.depend=function(t){r.target&&r.target.addDep(this)},r.prototype.notify=function(t){for(var n=this.subs.filter(function(l){return l}),i=0,o=n.length;i<o;i++){var a=n[i];a.update()}},r}();yc.target=null;var y1=[];function lf(r){y1.push(r),yc.target=r}function cf(){y1.pop(),yc.target=y1[y1.length-1]}var cM=Array.prototype,L1=Object.create(cM),rz=["push","pop","shift","unshift","splice","sort","reverse"];rz.forEach(function(r){var t=cM[r];lc(L1,r,function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var a=t.apply(this,i),l=this.__ob__,c;switch(r){case"push":case"unshift":c=i;break;case"splice":c=i.slice(2);break}return c&&l.observeArray(c),l.dep.notify(),a})});var ak=Object.getOwnPropertyNames(L1),uM={},fS=!0;function xc(r){fS=r}var iz={notify:ar,depend:ar,addSub:ar,removeSub:ar},lk=function(){function r(t,n,i){if(n===void 0&&(n=!1),i===void 0&&(i=!1),this.value=t,this.shallow=n,this.mock=i,this.dep=i?iz:new yc,this.vmCount=0,lc(t,"__ob__",this),hn(t)){if(!i)if(tz)t.__proto__=L1;else for(var o=0,a=ak.length;o<a;o++){var l=ak[o];lc(t,l,L1[l])}n||this.observeArray(t)}else for(var c=Object.keys(t),o=0;o<c.length;o++){var l=c[o];Vu(t,l,uM,void 0,n,i)}}return r.prototype.observeArray=function(t){for(var n=0,i=t.length;n<i;n++)yl(t[n],!1,this.mock)},r}();function yl(r,t,n){if(r&&Qr(r,"__ob__")&&r.__ob__ instanceof lk)return r.__ob__;if(fS&&(n||!bm())&&(hn(r)||Fi(r))&&Object.isExtensible(r)&&!r.__v_skip&&!Ia(r)&&!(r instanceof Pi))return new lk(r,t,n)}function Vu(r,t,n,i,o,a){var l=new yc,c=Object.getOwnPropertyDescriptor(r,t);if(!(c&&c.configurable===!1)){var u=c&&c.get,h=c&&c.set;(!u||h)&&(n===uM||arguments.length===2)&&(n=r[t]);var d=!o&&yl(n,!1,a);return Object.defineProperty(r,t,{enumerable:!0,configurable:!0,get:function(){var p=u?u.call(r):n;return yc.target&&(l.depend(),d&&(d.dep.depend(),hn(p)&&dM(p))),Ia(p)&&!o?p.value:p},set:function(p){var m=u?u.call(r):n;if(YB(m,p)){if(h)h.call(r,p);else{if(u)return;if(!o&&Ia(m)&&!Ia(p)){m.value=p;return}else n=p}d=!o&&yl(p,!1,a),l.notify()}}}),l}}function pS(r,t,n){if(!mS(r)){var i=r.__ob__;return hn(r)&&tM(t)?(r.length=Math.max(r.length,t),r.splice(t,1,n),i&&!i.shallow&&i.mock&&yl(n,!1,!0),n):t in r&&!(t in Object.prototype)?(r[t]=n,n):r._isVue||i&&i.vmCount?n:i?(Vu(i.value,t,n,void 0,i.shallow,i.mock),i.dep.notify(),n):(r[t]=n,n)}}function hM(r,t){if(hn(r)&&tM(t)){r.splice(t,1);return}var n=r.__ob__;r._isVue||n&&n.vmCount||mS(r)||Qr(r,t)&&(delete r[t],n&&n.dep.notify())}function dM(r){for(var t=void 0,n=0,i=r.length;n<i;n++)t=r[n],t&&t.__ob__&&t.__ob__.dep.depend(),hn(t)&&dM(t)}function fM(r){return oz(r,!0),lc(r,"__v_isShallow",!0),r}function oz(r,t){mS(r)||yl(r,t,bm())}function mS(r){return!!(r&&r.__v_isReadonly)}function Ia(r){return!!(r&&r.__v_isRef===!0)}function Jb(r,t,n){Object.defineProperty(r,n,{enumerable:!0,configurable:!0,get:function(){var i=t[n];if(Ia(i))return i.value;var o=i&&i.__ob__;return o&&o.dep.depend(),i},set:function(i){var o=t[n];Ia(o)&&!Ia(i)?o.value=i:t[n]=i}})}var Ni,az=function(){function r(t){t===void 0&&(t=!1),this.detached=t,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Ni,!t&&Ni&&(this.index=(Ni.scopes||(Ni.scopes=[])).push(this)-1)}return r.prototype.run=function(t){if(this.active){var n=Ni;try{return Ni=this,t()}finally{Ni=n}}},r.prototype.on=function(){Ni=this},r.prototype.off=function(){Ni=this.parent},r.prototype.stop=function(t){if(this.active){var n=void 0,i=void 0;for(n=0,i=this.effects.length;n<i;n++)this.effects[n].teardown();for(n=0,i=this.cleanups.length;n<i;n++)this.cleanups[n]();if(this.scopes)for(n=0,i=this.scopes.length;n<i;n++)this.scopes[n].stop(!0);if(!this.detached&&this.parent&&!t){var o=this.parent.scopes.pop();o&&o!==this&&(this.parent.scopes[this.index]=o,o.index=this.index)}this.parent=void 0,this.active=!1}},r}();function lz(r,t){t===void 0&&(t=Ni),t&&t.active&&t.effects.push(r)}function cz(r){var t=r._provided,n=r.$parent&&r.$parent._provided;return n===t?r._provided=Object.create(n):t}var ck=fh(function(r){var t=r.charAt(0)==="&";r=t?r.slice(1):r;var n=r.charAt(0)==="~";r=n?r.slice(1):r;var i=r.charAt(0)==="!";return r=i?r.slice(1):r,{name:r,once:n,capture:i,passive:t}});function Qb(r,t){function n(){var i=n.fns;if(hn(i))for(var o=i.slice(),a=0;a<o.length;a++)bc(o[a],null,arguments,t,"v-on handler");else return bc(i,null,arguments,t,"v-on handler")}return n.fns=r,n}function pM(r,t,n,i,o,a){var l,c,u,h;for(l in r)c=r[l],u=t[l],h=ck(l),Ue(c)||(Ue(u)?(Ue(c.fns)&&(c=r[l]=Qb(c,a)),ys(h.once)&&(c=r[l]=o(h.name,c,h.capture)),n(h.name,c,h.capture,h.passive,h.params)):c!==u&&(u.fns=c,r[l]=u));for(l in t)Ue(r[l])&&(h=ck(l),i(h.name,t[l],h.capture))}function tc(r,t,n){r instanceof Pi&&(r=r.data.hook||(r.data.hook={}));var i,o=r[t];function a(){n.apply(this,arguments),Dc(i.fns,a)}Ue(o)?i=Qb([a]):$t(o.fns)&&ys(o.merged)?(i=o,i.fns.push(a)):i=Qb([o,a]),i.merged=!0,r[t]=i}function uz(r,t,n){var i=t.options.props;if(!Ue(i)){var o={},a=r.attrs,l=r.props;if($t(a)||$t(l))for(var c in i){var u=xm(c);uk(o,l,c,u,!0)||uk(o,a,c,u,!1)}return o}}function uk(r,t,n,i,o){if($t(t)){if(Qr(t,n))return r[n]=t[n],o||delete t[n],!0;if(Qr(t,i))return r[n]=t[i],o||delete t[i],!0}return!1}function hz(r){for(var t=0;t<r.length;t++)if(hn(r[t]))return Array.prototype.concat.apply([],r);return r}function gS(r){return ym(r)?[hd(r)]:hn(r)?mM(r):void 0}function Wf(r){return $t(r)&&$t(r.text)&&zB(r.isComment)}function mM(r,t){var n=[],i,o,a,l;for(i=0;i<r.length;i++)o=r[i],!(Ue(o)||typeof o=="boolean")&&(a=n.length-1,l=n[a],hn(o)?o.length>0&&(o=mM(o,"".concat(t||"","_").concat(i)),Wf(o[0])&&Wf(l)&&(n[a]=hd(l.text+o[0].text),o.shift()),n.push.apply(n,o)):ym(o)?Wf(l)?n[a]=hd(l.text+o):o!==""&&n.push(hd(o)):Wf(o)&&Wf(l)?n[a]=hd(l.text+o.text):(ys(r._isVList)&&$t(o.tag)&&Ue(o.key)&&$t(t)&&(o.key="__vlist".concat(t,"_").concat(i,"__")),n.push(o)));return n}function dz(r,t){var n=null,i,o,a,l;if(hn(r)||typeof r=="string")for(n=new Array(r.length),i=0,o=r.length;i<o;i++)n[i]=t(r[i],i);else if(typeof r=="number")for(n=new Array(r),i=0;i<r;i++)n[i]=t(i+1,i);else if(Fr(r))if(wm&&r[Symbol.iterator]){n=[];for(var c=r[Symbol.iterator](),u=c.next();!u.done;)n.push(t(u.value,n.length)),u=c.next()}else for(a=Object.keys(r),n=new Array(a.length),i=0,o=a.length;i<o;i++)l=a[i],n[i]=t(r[l],l,i);return $t(n)||(n=[]),n._isVList=!0,n}function fz(r,t,n,i){var o=this.$scopedSlots[r],a;o?(n=n||{},i&&(n=ns(ns({},i),n)),a=o(n)||(hs(t)?t():t)):a=this.$slots[r]||(hs(t)?t():t);var l=n&&n.slot;return l?this.$createElement("template",{slot:l},a):a}function pz(r){return U1(this.$options,"filters",r)||sM}function hk(r,t){return hn(r)?r.indexOf(t)===-1:r!==t}function mz(r,t,n,i,o){var a=mo.keyCodes[t]||n;return o&&i&&!mo.keyCodes[t]?hk(o,i):a?hk(a,r):i?xm(i)!==t:r===void 0}function gz(r,t,n,i,o){if(n&&Fr(n)){hn(n)&&(n=nM(n));var a=void 0,l=function(u){if(u==="class"||u==="style"||WB(u))a=r;else{var h=r.attrs&&r.attrs.type;a=i||mo.mustUseProp(t,h,u)?r.domProps||(r.domProps={}):r.attrs||(r.attrs={})}var d=Bu(u),f=xm(u);if(!(d in a)&&!(f in a)&&(a[u]=n[u],o)){var p=r.on||(r.on={});p["update:".concat(u)]=function(m){n[u]=m}}};for(var c in n)l(c)}return r}function vz(r,t){var n=this._staticTrees||(this._staticTrees=[]),i=n[r];return i&&!t||(i=n[r]=this.$options.staticRenderFns[r].call(this._renderProxy,this._c,this),gM(i,"__static__".concat(r),!1)),i}function yz(r,t,n){return gM(r,"__once__".concat(t).concat(n?"_".concat(n):""),!0),r}function gM(r,t,n){if(hn(r))for(var i=0;i<r.length;i++)r[i]&&typeof r[i]!="string"&&dk(r[i],"".concat(t,"_").concat(i),n);else dk(r,t,n)}function dk(r,t,n){r.isStatic=!0,r.key=t,r.isOnce=n}function xz(r,t){if(t&&Fi(t)){var n=r.on=r.on?ns({},r.on):{};for(var i in t){var o=n[i],a=t[i];n[i]=o?[].concat(o,a):a}}return r}function vM(r,t,n,i){t=t||{$stable:!n};for(var o=0;o<r.length;o++){var a=r[o];hn(a)?vM(a,t,n):a&&(a.proxy&&(a.fn.proxy=!0),t[a.key]=a.fn)}return i&&(t.$key=i),t}function bz(r,t){for(var n=0;n<t.length;n+=2){var i=t[n];typeof i=="string"&&i&&(r[t[n]]=t[n+1])}return r}function wz(r,t){return typeof r=="string"?t+r:r}function yM(r){r._o=yz,r._n=Pp,r._s=UB,r._l=dz,r._t=fz,r._q=zu,r._i=rM,r._m=vz,r._f=pz,r._k=mz,r._b=gz,r._v=hd,r._e=ku,r._u=vM,r._g=xz,r._d=bz,r._p=wz}function vS(r,t){if(!r||!r.length)return{};for(var n={},i=0,o=r.length;i<o;i++){var a=r[i],l=a.data;if(l&&l.attrs&&l.attrs.slot&&delete l.attrs.slot,(a.context===t||a.fnContext===t)&&l&&l.slot!=null){var c=l.slot,u=n[c]||(n[c]=[]);a.tag==="template"?u.push.apply(u,a.children||[]):u.push(a)}else(n.default||(n.default=[])).push(a)}for(var h in n)n[h].every(Sz)&&delete n[h];return n}function Sz(r){return r.isComment&&!r.asyncFactory||r.text===" "}function zp(r){return r.isComment&&r.asyncFactory}function Ep(r,t,n,i){var o,a=Object.keys(n).length>0,l=t?!!t.$stable:!a,c=t&&t.$key;if(!t)o={};else{if(t._normalized)return t._normalized;if(l&&i&&i!==Mi&&c===i.$key&&!a&&!i.$hasNormal)return i;o={};for(var u in t)t[u]&&u[0]!=="$"&&(o[u]=_z(r,n,u,t[u]))}for(var h in n)h in o||(o[h]=Tz(n,h));return t&&Object.isExtensible(t)&&(t._normalized=o),lc(o,"$stable",l),lc(o,"$key",c),lc(o,"$hasNormal",a),o}function _z(r,t,n,i){var o=function(){var a=Ip;vc(r);var l=arguments.length?i.apply(null,arguments):i({});l=l&&typeof l=="object"&&!hn(l)?[l]:gS(l);var c=l&&l[0];return vc(a),l&&(!c||l.length===1&&c.isComment&&!zp(c))?void 0:l};return i.proxy&&Object.defineProperty(t,n,{get:o,enumerable:!0,configurable:!0}),o}function Tz(r,t){return function(){return r[t]}}function Cz(r){var t=r.$options,n=t.setup;if(n){var i=r._setupContext=kz(r);vc(r),lf();var o=bc(n,null,[r._props||fM({}),i],r,"setup");if(cf(),vc(),hs(o))t.render=o;else if(Fr(o))if(r._setupState=o,o.__sfc){var l=r._setupProxy={};for(var a in o)a!=="__sfc"&&Jb(l,o,a)}else for(var a in o)oM(a)||Jb(r,o,a)}}function kz(r){return{get attrs(){if(!r._attrsProxy){var t=r._attrsProxy={};lc(t,"_v_attr_proxy",!0),F1(t,r.$attrs,Mi,r,"$attrs")}return r._attrsProxy},get listeners(){if(!r._listenersProxy){var t=r._listenersProxy={};F1(t,r.$listeners,Mi,r,"$listeners")}return r._listenersProxy},get slots(){return Iz(r)},emit:eM(r.$emit,r),expose:function(t){t&&Object.keys(t).forEach(function(n){return Jb(r,t,n)})}}}function F1(r,t,n,i,o){var a=!1;for(var l in t)l in r?t[l]!==n[l]&&(a=!0):(a=!0,$z(r,l,i,o));for(var l in r)l in t||(a=!0,delete r[l]);return a}function $z(r,t,n,i){Object.defineProperty(r,t,{enumerable:!0,configurable:!0,get:function(){return n[i][t]}})}function Iz(r){return r._slotsProxy||xM(r._slotsProxy={},r.$scopedSlots),r._slotsProxy}function xM(r,t){for(var n in t)r[n]=t[n];for(var n in r)n in t||delete r[n]}function Ez(r){r._vnode=null,r._staticTrees=null;var t=r.$options,n=r.$vnode=t._parentVnode,i=n&&n.context;r.$slots=vS(t._renderChildren,i),r.$scopedSlots=n?Ep(r.$parent,n.data.scopedSlots,r.$slots):Mi,r._c=function(a,l,c,u){return P1(r,a,l,c,u,!1)},r.$createElement=function(a,l,c,u){return P1(r,a,l,c,u,!0)};var o=n&&n.data;Vu(r,"$attrs",o&&o.attrs||Mi,null,!0),Vu(r,"$listeners",t._parentListeners||Mi,null,!0)}var t3=null;function Nz(r){yM(r.prototype),r.prototype.$nextTick=function(t){return yS(t,this)},r.prototype._render=function(){var t=this,n=t.$options,i=n.render,o=n._parentVnode;o&&t._isMounted&&(t.$scopedSlots=Ep(t.$parent,o.data.scopedSlots,t.$slots,t.$scopedSlots),t._slotsProxy&&xM(t._slotsProxy,t.$scopedSlots)),t.$vnode=o;var a;try{vc(t),t3=t,a=i.call(t._renderProxy,t.$createElement)}catch(l){Uu(l,t,"render"),a=t._vnode}finally{t3=null,vc()}return hn(a)&&a.length===1&&(a=a[0]),a instanceof Pi||(a=ku()),a.parent=o,a}}function sx(r,t){return(r.__esModule||wm&&r[Symbol.toStringTag]==="Module")&&(r=r.default),Fr(r)?t.extend(r):r}function Az(r,t,n,i,o){var a=ku();return a.asyncFactory=r,a.asyncMeta={data:t,context:n,children:i,tag:o},a}function Mz(r,t){if(ys(r.error)&&$t(r.errorComp))return r.errorComp;if($t(r.resolved))return r.resolved;var n=t3;if(n&&$t(r.owners)&&r.owners.indexOf(n)===-1&&r.owners.push(n),ys(r.loading)&&$t(r.loadingComp))return r.loadingComp;if(n&&!$t(r.owners)){var i=r.owners=[n],o=!0,a=null,l=null;n.$on("hook:destroyed",function(){return Dc(i,n)});var c=function(f){for(var p=0,m=i.length;p<m;p++)i[p].$forceUpdate();f&&(i.length=0,a!==null&&(clearTimeout(a),a=null),l!==null&&(clearTimeout(l),l=null))},u=R1(function(f){r.resolved=sx(f,t),o?i.length=0:c(!0)}),h=R1(function(f){$t(r.errorComp)&&(r.error=!0,c(!0))}),d=r(u,h);return Fr(d)&&(Kb(d)?Ue(r.resolved)&&d.then(u,h):Kb(d.component)&&(d.component.then(u,h),$t(d.error)&&(r.errorComp=sx(d.error,t)),$t(d.loading)&&(r.loadingComp=sx(d.loading,t),d.delay===0?r.loading=!0:a=setTimeout(function(){a=null,Ue(r.resolved)&&Ue(r.error)&&(r.loading=!0,c(!1))},d.delay||200)),$t(d.timeout)&&(l=setTimeout(function(){l=null,Ue(r.resolved)&&h(null)},d.timeout)))),o=!1,r.loading?r.loadingComp:r.resolved}}function bM(r){if(hn(r))for(var t=0;t<r.length;t++){var n=r[t];if($t(n)&&($t(n.componentOptions)||zp(n)))return n}}var Dz=1,wM=2;function P1(r,t,n,i,o,a){return(hn(n)||ym(n))&&(o=i,i=n,n=void 0),ys(a)&&(o=wM),Rz(r,t,n,i,o)}function Rz(r,t,n,i,o){if($t(n)&&$t(n.__ob__)||($t(n)&&$t(n.is)&&(t=n.is),!t))return ku();hn(i)&&hs(i[0])&&(n=n||{},n.scopedSlots={default:i[0]},i.length=0),o===wM?i=gS(i):o===Dz&&(i=hz(i));var a,l;if(typeof t=="string"){var c=void 0;l=r.$vnode&&r.$vnode.ns||mo.getTagNamespace(t),mo.isReservedTag(t)?a=new Pi(mo.parsePlatformTagName(t),n,i,void 0,void 0,r):(!n||!n.pre)&&$t(c=U1(r.$options,"components",t))?a=bk(c,n,r,i,t):a=new Pi(t,n,i,void 0,void 0,r)}else a=bk(t,n,r,i);return hn(a)?a:$t(a)?($t(l)&&SM(a,l),$t(n)&&Oz(n),a):ku()}function SM(r,t,n){if(r.ns=t,r.tag==="foreignObject"&&(t=void 0,n=!0),$t(r.children))for(var i=0,o=r.children.length;i<o;i++){var a=r.children[i];$t(a.tag)&&(Ue(a.ns)||ys(n)&&a.tag!=="svg")&&SM(a,t,n)}}function Oz(r){Fr(r.style)&&B1(r.style),Fr(r.class)&&B1(r.class)}function Uu(r,t,n){lf();try{if(t)for(var i=t;i=i.$parent;){var o=i.$options.errorCaptured;if(o)for(var a=0;a<o.length;a++)try{var l=o[a].call(i,r,t,n)===!1;if(l)return}catch(c){fk(c,i,"errorCaptured hook")}}fk(r,t,n)}finally{cf()}}function bc(r,t,n,i,o){var a;try{a=n?r.apply(t,n):r.call(t),a&&!a._isVue&&Kb(a)&&!a._handled&&(a.catch(function(l){return Uu(l,i,o+" (Promise/async)")}),a._handled=!0)}catch(l){Uu(l,i,o)}return a}function fk(r,t,n){if(mo.errorHandler)try{return mo.errorHandler.call(null,r,t,n)}catch(i){i!==r&&pk(i)}pk(r)}function pk(r,t,n){if(Vi&&typeof console<"u")console.error(r);else throw r}var e3=!1,n3=[],s3=!1;function i0(){s3=!1;var r=n3.slice(0);n3.length=0;for(var t=0;t<r.length;t++)r[t]()}var vp;if(typeof Promise<"u"&&yd(Promise)){var Lz=Promise.resolve();vp=function(){Lz.then(i0),ez&&setTimeout(ar)},e3=!0}else if(!of&&typeof MutationObserver<"u"&&(yd(MutationObserver)||MutationObserver.toString()==="[object MutationObserverConstructor]")){var o0=1,Fz=new MutationObserver(i0),mk=document.createTextNode(String(o0));Fz.observe(mk,{characterData:!0}),vp=function(){o0=(o0+1)%2,mk.data=String(o0)},e3=!0}else typeof setImmediate<"u"&&yd(setImmediate)?vp=function(){setImmediate(i0)}:vp=function(){setTimeout(i0,0)};function yS(r,t){var n;if(n3.push(function(){if(r)try{r.call(t)}catch(i){Uu(i,t,"nextTick")}else n&&n(t)}),s3||(s3=!0,vp()),!r&&typeof Promise<"u")return new Promise(function(i){n=i})}var Pz="2.7.14",gk=new Bp;function B1(r){return x1(r,gk),gk.clear(),r}function x1(r,t){var n,i,o=hn(r);if(!(!o&&!Fr(r)||r.__v_skip||Object.isFrozen(r)||r instanceof Pi)){if(r.__ob__){var a=r.__ob__.dep.id;if(t.has(a))return;t.add(a)}if(o)for(n=r.length;n--;)x1(r[n],t);else if(Ia(r))x1(r.value,t);else for(i=Object.keys(r),n=i.length;n--;)x1(r[i[n]],t)}}var Bz=0,xS=function(){function r(t,n,i,o,a){lz(this,Ni&&!Ni._vm?Ni:t?t._scope:void 0),(this.vm=t)&&a&&(t._watcher=this),o?(this.deep=!!o.deep,this.user=!!o.user,this.lazy=!!o.lazy,this.sync=!!o.sync,this.before=o.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=i,this.id=++Bz,this.active=!0,this.post=!1,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new Bp,this.newDepIds=new Bp,this.expression="",hs(n)?this.getter=n:(this.getter=QB(n),this.getter||(this.getter=ar)),this.value=this.lazy?void 0:this.get()}return r.prototype.get=function(){lf(this);var t,n=this.vm;try{t=this.getter.call(n,n)}catch(i){if(this.user)Uu(i,n,'getter for watcher "'.concat(this.expression,'"'));else throw i}finally{this.deep&&B1(t),cf(),this.cleanupDeps()}return t},r.prototype.addDep=function(t){var n=t.id;this.newDepIds.has(n)||(this.newDepIds.add(n),this.newDeps.push(t),this.depIds.has(n)||t.addSub(this))},r.prototype.cleanupDeps=function(){for(var t=this.deps.length;t--;){var n=this.deps[t];this.newDepIds.has(n.id)||n.removeSub(this)}var i=this.depIds;this.depIds=this.newDepIds,this.newDepIds=i,this.newDepIds.clear(),i=this.deps,this.deps=this.newDeps,this.newDeps=i,this.newDeps.length=0},r.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():eV(this)},r.prototype.run=function(){if(this.active){var t=this.get();if(t!==this.value||Fr(t)||this.deep){var n=this.value;if(this.value=t,this.user){var i='callback for watcher "'.concat(this.expression,'"');bc(this.cb,this.vm,[t,n],this.vm,i)}else this.cb.call(this.vm,t,n)}}},r.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},r.prototype.depend=function(){for(var t=this.deps.length;t--;)this.deps[t].depend()},r.prototype.teardown=function(){if(this.vm&&!this.vm._isBeingDestroyed&&Dc(this.vm._scope.effects,this),this.active){for(var t=this.deps.length;t--;)this.deps[t].removeSub(this);this.active=!1,this.onStop&&this.onStop()}},r}();function zz(r){r._events=Object.create(null),r._hasHookEvent=!1;var t=r.$options._parentListeners;t&&_M(r,t)}var Vp;function Vz(r,t){Vp.$on(r,t)}function Uz(r,t){Vp.$off(r,t)}function Wz(r,t){var n=Vp;return function i(){var o=t.apply(null,arguments);o!==null&&n.$off(r,i)}}function _M(r,t,n){Vp=r,pM(t,n||{},Vz,Uz,Wz,r),Vp=void 0}function Gz(r){var t=/^hook:/;r.prototype.$on=function(n,i){var o=this;if(hn(n))for(var a=0,l=n.length;a<l;a++)o.$on(n[a],i);else(o._events[n]||(o._events[n]=[])).push(i),t.test(n)&&(o._hasHookEvent=!0);return o},r.prototype.$once=function(n,i){var o=this;function a(){o.$off(n,a),i.apply(o,arguments)}return a.fn=i,o.$on(n,a),o},r.prototype.$off=function(n,i){var o=this;if(!arguments.length)return o._events=Object.create(null),o;if(hn(n)){for(var a=0,l=n.length;a<l;a++)o.$off(n[a],i);return o}var c=o._events[n];if(!c)return o;if(!i)return o._events[n]=null,o;for(var u,h=c.length;h--;)if(u=c[h],u===i||u.fn===i){c.splice(h,1);break}return o},r.prototype.$emit=function(n){var i=this,o=i._events[n];if(o){o=o.length>1?Xb(o):o;for(var a=Xb(arguments,1),l='event handler for "'.concat(n,'"'),c=0,u=o.length;c<u;c++)bc(o[c],i,a,i,l)}return i}}var $u=null;function TM(r){var t=$u;return $u=r,function(){$u=t}}function Hz(r){var t=r.$options,n=t.parent;if(n&&!t.abstract){for(;n.$options.abstract&&n.$parent;)n=n.$parent;n.$children.push(r)}r.$parent=n,r.$root=n?n.$root:r,r.$children=[],r.$refs={},r._provided=n?n._provided:Object.create(null),r._watcher=null,r._inactive=null,r._directInactive=!1,r._isMounted=!1,r._isDestroyed=!1,r._isBeingDestroyed=!1}function jz(r){r.prototype._update=function(t,n){var i=this,o=i.$el,a=i._vnode,l=TM(i);i._vnode=t,a?i.$el=i.__patch__(a,t):i.$el=i.__patch__(i.$el,t,n,!1),l(),o&&(o.__vue__=null),i.$el&&(i.$el.__vue__=i);for(var c=i;c&&c.$vnode&&c.$parent&&c.$vnode===c.$parent._vnode;)c.$parent.$el=c.$el,c=c.$parent},r.prototype.$forceUpdate=function(){var t=this;t._watcher&&t._watcher.update()},r.prototype.$destroy=function(){var t=this;if(!t._isBeingDestroyed){Go(t,"beforeDestroy"),t._isBeingDestroyed=!0;var n=t.$parent;n&&!n._isBeingDestroyed&&!t.$options.abstract&&Dc(n.$children,t),t._scope.stop(),t._data.__ob__&&t._data.__ob__.vmCount--,t._isDestroyed=!0,t.__patch__(t._vnode,null),Go(t,"destroyed"),t.$off(),t.$el&&(t.$el.__vue__=null),t.$vnode&&(t.$vnode.parent=null)}}}function qz(r,t,n){r.$el=t,r.$options.render||(r.$options.render=ku),Go(r,"beforeMount");var i;i=function(){r._update(r._render(),n)};var o={before:function(){r._isMounted&&!r._isDestroyed&&Go(r,"beforeUpdate")}};new xS(r,i,ar,o,!0),n=!1;var a=r._preWatchers;if(a)for(var l=0;l<a.length;l++)a[l].run();return r.$vnode==null&&(r._isMounted=!0,Go(r,"mounted")),r}function Kz(r,t,n,i,o){var a=i.data.scopedSlots,l=r.$scopedSlots,c=!!(a&&!a.$stable||l!==Mi&&!l.$stable||a&&r.$scopedSlots.$key!==a.$key||!a&&r.$scopedSlots.$key),u=!!(o||r.$options._renderChildren||c),h=r.$vnode;r.$options._parentVnode=i,r.$vnode=i,r._vnode&&(r._vnode.parent=i),r.$options._renderChildren=o;var d=i.data.attrs||Mi;r._attrsProxy&&F1(r._attrsProxy,d,h.data&&h.data.attrs||Mi,r,"$attrs")&&(u=!0),r.$attrs=d,n=n||Mi;var f=r.$options._parentListeners;if(r._listenersProxy&&F1(r._listenersProxy,n,f||Mi,r,"$listeners"),r.$listeners=r.$options._parentListeners=n,_M(r,n,f),t&&r.$options.props){xc(!1);for(var p=r._props,m=r.$options._propKeys||[],g=0;g<m.length;g++){var y=m[g],v=r.$options.props;p[y]=CS(y,v,t,r)}xc(!0),r.$options.propsData=t}u&&(r.$slots=vS(o,i.context),r.$forceUpdate())}function CM(r){for(;r&&(r=r.$parent);)if(r._inactive)return!0;return!1}function bS(r,t){if(t){if(r._directInactive=!1,CM(r))return}else if(r._directInactive)return;if(r._inactive||r._inactive===null){r._inactive=!1;for(var n=0;n<r.$children.length;n++)bS(r.$children[n]);Go(r,"activated")}}function kM(r,t){if(!(t&&(r._directInactive=!0,CM(r)))&&!r._inactive){r._inactive=!0;for(var n=0;n<r.$children.length;n++)kM(r.$children[n]);Go(r,"deactivated")}}function Go(r,t,n,i){i===void 0&&(i=!0),lf();var o=Ip;i&&vc(r);var a=r.$options[t],l="".concat(t," hook");if(a)for(var c=0,u=a.length;c<u;c++)bc(a[c],r,n||null,r,l);r._hasHookEvent&&r.$emit("hook:"+t),i&&vc(o),cf()}var ll=[],wS=[],z1={},r3=!1,SS=!1,dd=0;function Xz(){dd=ll.length=wS.length=0,z1={},r3=SS=!1}var $M=0,i3=Date.now;if(Vi&&!of){var rx=window.performance;rx&&typeof rx.now=="function"&&i3()>document.createEvent("Event").timeStamp&&(i3=function(){return rx.now()})}var Yz=function(r,t){if(r.post){if(!t.post)return 1}else if(t.post)return-1;return r.id-t.id};function Zz(){$M=i3(),SS=!0;var r,t;for(ll.sort(Yz),dd=0;dd<ll.length;dd++)r=ll[dd],r.before&&r.before(),t=r.id,z1[t]=null,r.run();var n=wS.slice(),i=ll.slice();Xz(),tV(n),Jz(i),sz(),O1&&mo.devtools&&O1.emit("flush")}function Jz(r){for(var t=r.length;t--;){var n=r[t],i=n.vm;i&&i._watcher===n&&i._isMounted&&!i._isDestroyed&&Go(i,"updated")}}function Qz(r){r._inactive=!1,wS.push(r)}function tV(r){for(var t=0;t<r.length;t++)r[t]._inactive=!0,bS(r[t],!0)}function eV(r){var t=r.id;if(z1[t]==null&&!(r===yc.target&&r.noRecurse)){if(z1[t]=!0,!SS)ll.push(r);else{for(var n=ll.length-1;n>dd&&ll[n].id>r.id;)n--;ll.splice(n+1,0,r)}r3||(r3=!0,yS(Zz))}}function nV(r){var t=r.$options.provide;if(t){var n=hs(t)?t.call(r):t;if(!Fr(n))return;for(var i=cz(r),o=wm?Reflect.ownKeys(n):Object.keys(n),a=0;a<o.length;a++){var l=o[a];Object.defineProperty(i,l,Object.getOwnPropertyDescriptor(n,l))}}}function sV(r){var t=IM(r.$options.inject,r);t&&(xc(!1),Object.keys(t).forEach(function(n){Vu(r,n,t[n])}),xc(!0))}function IM(r,t){if(r){for(var n=Object.create(null),i=wm?Reflect.ownKeys(r):Object.keys(r),o=0;o<i.length;o++){var a=i[o];if(a!=="__ob__"){var l=r[a].from;if(l in t._provided)n[a]=t._provided[l];else if("default"in r[a]){var c=r[a].default;n[a]=hs(c)?c.call(t):c}}}return n}}function _S(r,t,n,i,o){var a=this,l=o.options,c;Qr(i,"_uid")?(c=Object.create(i),c._original=i):(c=i,i=i._original);var u=ys(l._compiled),h=!u;this.data=r,this.props=t,this.children=n,this.parent=i,this.listeners=r.on||Mi,this.injections=IM(l.inject,i),this.slots=function(){return a.$slots||Ep(i,r.scopedSlots,a.$slots=vS(n,i)),a.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return Ep(i,r.scopedSlots,this.slots())}}),u&&(this.$options=l,this.$slots=this.slots(),this.$scopedSlots=Ep(i,r.scopedSlots,this.$slots)),l._scopeId?this._c=function(d,f,p,m){var g=P1(c,d,f,p,m,h);return g&&!hn(g)&&(g.fnScopeId=l._scopeId,g.fnContext=i),g}:this._c=function(d,f,p,m){return P1(c,d,f,p,m,h)}}yM(_S.prototype);function rV(r,t,n,i,o){var a=r.options,l={},c=a.props;if($t(c))for(var u in c)l[u]=CS(u,c,t||Mi);else $t(n.attrs)&&yk(l,n.attrs),$t(n.props)&&yk(l,n.props);var h=new _S(n,l,o,i,r),d=a.render.call(null,h._c,h);if(d instanceof Pi)return vk(d,n,h.parent,a);if(hn(d)){for(var f=gS(d)||[],p=new Array(f.length),m=0;m<f.length;m++)p[m]=vk(f[m],n,h.parent,a);return p}}function vk(r,t,n,i,o){var a=Zb(r);return a.fnContext=n,a.fnOptions=i,t.slot&&((a.data||(a.data={})).slot=t.slot),a}function yk(r,t){for(var n in t)r[Bu(n)]=t[n]}function V1(r){return r.name||r.__name||r._componentTag}var TS={init:function(r,t){if(r.componentInstance&&!r.componentInstance._isDestroyed&&r.data.keepAlive){var n=r;TS.prepatch(n,n)}else{var i=r.componentInstance=iV(r,$u);i.$mount(t?r.elm:void 0,t)}},prepatch:function(r,t){var n=t.componentOptions,i=t.componentInstance=r.componentInstance;Kz(i,n.propsData,n.listeners,t,n.children)},insert:function(r){var t=r.context,n=r.componentInstance;n._isMounted||(n._isMounted=!0,Go(n,"mounted")),r.data.keepAlive&&(t._isMounted?Qz(n):bS(n,!0))},destroy:function(r){var t=r.componentInstance;t._isDestroyed||(r.data.keepAlive?kM(t,!0):t.$destroy())}},xk=Object.keys(TS);function bk(r,t,n,i,o){if(!Ue(r)){var a=n.$options._base;if(Fr(r)&&(r=a.extend(r)),typeof r=="function"){var l;if(Ue(r.cid)&&(l=r,r=Mz(l,a),r===void 0))return Az(l,t,n,i,o);t=t||{},$S(r),$t(t.model)&&lV(r.options,t);var c=uz(t,r);if(ys(r.options.functional))return rV(r,c,t,n,i);var u=t.on;if(t.on=t.nativeOn,ys(r.options.abstract)){var h=t.slot;t={},h&&(t.slot=h)}oV(t);var d=V1(r.options)||o,f=new Pi("vue-component-".concat(r.cid).concat(d?"-".concat(d):""),t,void 0,void 0,void 0,n,{Ctor:r,propsData:c,listeners:u,tag:o,children:i},l);return f}}}function iV(r,t){var n={_isComponent:!0,_parentVnode:r,parent:t},i=r.data.inlineTemplate;return $t(i)&&(n.render=i.render,n.staticRenderFns=i.staticRenderFns),new r.componentOptions.Ctor(n)}function oV(r){for(var t=r.hook||(r.hook={}),n=0;n<xk.length;n++){var i=xk[n],o=t[i],a=TS[i];o!==a&&!(o&&o._merged)&&(t[i]=o?aV(a,o):a)}}function aV(r,t){var n=function(i,o){r(i,o),t(i,o)};return n._merged=!0,n}function lV(r,t){var n=r.model&&r.model.prop||"value",i=r.model&&r.model.event||"input";(t.attrs||(t.attrs={}))[n]=t.model.value;var o=t.on||(t.on={}),a=o[i],l=t.model.callback;$t(a)?(hn(a)?a.indexOf(l)===-1:a!==l)&&(o[i]=[l].concat(a)):o[i]=l}var cV=ar,Ta=mo.optionMergeStrategies;function Up(r,t,n){if(n===void 0&&(n=!0),!t)return r;for(var i,o,a,l=wm?Reflect.ownKeys(t):Object.keys(t),c=0;c<l.length;c++)i=l[c],i!=="__ob__"&&(o=r[i],a=t[i],!n||!Qr(r,i)?pS(r,i,a):o!==a&&Fi(o)&&Fi(a)&&Up(o,a));return r}function wk(r,t,n){return n?function(){var o=hs(t)?t.call(n,n):t,a=hs(r)?r.call(n,n):r;return o?Up(o,a):a}:t?r?function(){return Up(hs(t)?t.call(this,this):t,hs(r)?r.call(this,this):r)}:t:r}Ta.data=function(r,t,n){return n?wk(r,t,n):t&&typeof t!="function"?r:wk(r,t)};function uV(r,t){var n=t?r?r.concat(t):hn(t)?t:[t]:r;return n&&hV(n)}function hV(r){for(var t=[],n=0;n<r.length;n++)t.indexOf(r[n])===-1&&t.push(r[n]);return t}iM.forEach(function(r){Ta[r]=uV});function dV(r,t,n,i){var o=Object.create(r||null);return t?ns(o,t):o}W2.forEach(function(r){Ta[r+"s"]=dV});Ta.watch=function(r,t,n,i){if(r===Yb&&(r=void 0),t===Yb&&(t=void 0),!t)return Object.create(r||null);if(!r)return t;var o={};ns(o,r);for(var a in t){var l=o[a],c=t[a];l&&!hn(l)&&(l=[l]),o[a]=l?l.concat(c):hn(c)?c:[c]}return o};Ta.props=Ta.methods=Ta.inject=Ta.computed=function(r,t,n,i){if(!r)return t;var o=Object.create(null);return ns(o,r),t&&ns(o,t),o};Ta.provide=function(r,t){return r?function(){var n=Object.create(null);return Up(n,hs(r)?r.call(this):r),t&&Up(n,hs(t)?t.call(this):t,!1),n}:t};var fV=function(r,t){return t===void 0?r:t};function pV(r,t){var n=r.props;if(n){var i={},o,a,l;if(hn(n))for(o=n.length;o--;)a=n[o],typeof a=="string"&&(l=Bu(a),i[l]={type:null});else if(Fi(n))for(var c in n)a=n[c],l=Bu(c),i[l]=Fi(a)?a:{type:a};r.props=i}}function mV(r,t){var n=r.inject;if(n){var i=r.inject={};if(hn(n))for(var o=0;o<n.length;o++)i[n[o]]={from:n[o]};else if(Fi(n))for(var a in n){var l=n[a];i[a]=Fi(l)?ns({from:a},l):{from:l}}}}function gV(r){var t=r.directives;if(t)for(var n in t){var i=t[n];hs(i)&&(t[n]={bind:i,update:i})}}function Wu(r,t,n){if(hs(t)&&(t=t.options),pV(t),mV(t),gV(t),!t._base&&(t.extends&&(r=Wu(r,t.extends,n)),t.mixins))for(var i=0,o=t.mixins.length;i<o;i++)r=Wu(r,t.mixins[i],n);var a={},l;for(l in r)c(l);for(l in t)Qr(r,l)||c(l);function c(u){var h=Ta[u]||fV;a[u]=h(r[u],t[u],n,u)}return a}function U1(r,t,n,i){if(typeof n=="string"){var o=r[t];if(Qr(o,n))return o[n];var a=Bu(n);if(Qr(o,a))return o[a];var l=jB(a);if(Qr(o,l))return o[l];var c=o[n]||o[a]||o[l];return c}}function CS(r,t,n,i){var o=t[r],a=!Qr(n,r),l=n[r],c=_k(Boolean,o.type);if(c>-1){if(a&&!Qr(o,"default"))l=!1;else if(l===""||l===xm(r)){var u=_k(String,o.type);(u<0||c<u)&&(l=!0)}}if(l===void 0){l=vV(i,o,r);var h=fS;xc(!0),yl(l),xc(h)}return l}function vV(r,t,n){if(Qr(t,"default")){var i=t.default;return r&&r.$options.propsData&&r.$options.propsData[n]===void 0&&r._props[n]!==void 0?r._props[n]:hs(i)&&o3(t.type)!=="Function"?i.call(r):i}}var yV=/^\s*function (\w+)/;function o3(r){var t=r&&r.toString().match(yV);return t?t[1]:""}function Sk(r,t){return o3(r)===o3(t)}function _k(r,t){if(!hn(t))return Sk(t,r)?0:-1;for(var n=0,i=t.length;n<i;n++)if(Sk(t[n],r))return n;return-1}var Ql={enumerable:!0,configurable:!0,get:ar,set:ar};function kS(r,t,n){Ql.get=function(){return this[t][n]},Ql.set=function(o){this[t][n]=o},Object.defineProperty(r,n,Ql)}function xV(r){var t=r.$options;if(t.props&&bV(r,t.props),Cz(r),t.methods&&CV(r,t.methods),t.data)wV(r);else{var n=yl(r._data={});n&&n.vmCount++}t.computed&&TV(r,t.computed),t.watch&&t.watch!==Yb&&kV(r,t.watch)}function bV(r,t){var n=r.$options.propsData||{},i=r._props=fM({}),o=r.$options._propKeys=[],a=!r.$parent;a||xc(!1);var l=function(u){o.push(u);var h=CS(u,t,n,r);Vu(i,u,h),u in r||kS(r,"_props",u)};for(var c in t)l(c);xc(!0)}function wV(r){var t=r.$options.data;t=r._data=hs(t)?SV(t,r):t||{},Fi(t)||(t={});var n=Object.keys(t),i=r.$options.props;r.$options.methods;for(var o=n.length;o--;){var a=n[o];i&&Qr(i,a)||oM(a)||kS(r,"_data",a)}var l=yl(t);l&&l.vmCount++}function SV(r,t){lf();try{return r.call(t,t)}catch(n){return Uu(n,t,"data()"),{}}finally{cf()}}var _V={lazy:!0};function TV(r,t){var n=r._computedWatchers=Object.create(null),i=bm();for(var o in t){var a=t[o],l=hs(a)?a:a.get;i||(n[o]=new xS(r,l||ar,ar,_V)),o in r||EM(r,o,a)}}function EM(r,t,n){var i=!bm();hs(n)?(Ql.get=i?Tk(t):Ck(n),Ql.set=ar):(Ql.get=n.get?i&&n.cache!==!1?Tk(t):Ck(n.get):ar,Ql.set=n.set||ar),Object.defineProperty(r,t,Ql)}function Tk(r){return function(){var n=this._computedWatchers&&this._computedWatchers[r];if(n)return n.dirty&&n.evaluate(),yc.target&&n.depend(),n.value}}function Ck(r){return function(){return r.call(this,this)}}function CV(r,t){r.$options.props;for(var n in t)r[n]=typeof t[n]!="function"?ar:eM(t[n],r)}function kV(r,t){for(var n in t){var i=t[n];if(hn(i))for(var o=0;o<i.length;o++)a3(r,n,i[o]);else a3(r,n,i)}}function a3(r,t,n,i){return Fi(n)&&(i=n,n=n.handler),typeof n=="string"&&(n=r[n]),r.$watch(t,n,i)}function $V(r){var t={};t.get=function(){return this._data};var n={};n.get=function(){return this._props},Object.defineProperty(r.prototype,"$data",t),Object.defineProperty(r.prototype,"$props",n),r.prototype.$set=pS,r.prototype.$delete=hM,r.prototype.$watch=function(i,o,a){var l=this;if(Fi(o))return a3(l,i,o,a);a=a||{},a.user=!0;var c=new xS(l,i,o,a);if(a.immediate){var u='callback for immediate watcher "'.concat(c.expression,'"');lf(),bc(o,l,[c.value],l,u),cf()}return function(){c.teardown()}}}var IV=0;function EV(r){r.prototype._init=function(t){var n=this;n._uid=IV++,n._isVue=!0,n.__v_skip=!0,n._scope=new az(!0),n._scope._vm=!0,t&&t._isComponent?NV(n,t):n.$options=Wu($S(n.constructor),t||{},n),n._renderProxy=n,n._self=n,Hz(n),zz(n),Ez(n),Go(n,"beforeCreate",void 0,!1),sV(n),xV(n),nV(n),Go(n,"created"),n.$options.el&&n.$mount(n.$options.el)}}function NV(r,t){var n=r.$options=Object.create(r.constructor.options),i=t._parentVnode;n.parent=t.parent,n._parentVnode=i;var o=i.componentOptions;n.propsData=o.propsData,n._parentListeners=o.listeners,n._renderChildren=o.children,n._componentTag=o.tag,t.render&&(n.render=t.render,n.staticRenderFns=t.staticRenderFns)}function $S(r){var t=r.options;if(r.super){var n=$S(r.super),i=r.superOptions;if(n!==i){r.superOptions=n;var o=AV(r);o&&ns(r.extendOptions,o),t=r.options=Wu(n,r.extendOptions),t.name&&(t.components[t.name]=r)}}return t}function AV(r){var t,n=r.options,i=r.sealedOptions;for(var o in n)n[o]!==i[o]&&(t||(t={}),t[o]=n[o]);return t}function dn(r){this._init(r)}EV(dn);$V(dn);Gz(dn);jz(dn);Nz(dn);function MV(r){r.use=function(t){var n=this._installedPlugins||(this._installedPlugins=[]);if(n.indexOf(t)>-1)return this;var i=Xb(arguments,1);return i.unshift(this),hs(t.install)?t.install.apply(t,i):hs(t)&&t.apply(null,i),n.push(t),this}}function DV(r){r.mixin=function(t){return this.options=Wu(this.options,t),this}}function RV(r){r.cid=0;var t=1;r.extend=function(n){n=n||{};var i=this,o=i.cid,a=n._Ctor||(n._Ctor={});if(a[o])return a[o];var l=V1(n)||V1(i.options),c=function(h){this._init(h)};return c.prototype=Object.create(i.prototype),c.prototype.constructor=c,c.cid=t++,c.options=Wu(i.options,n),c.super=i,c.options.props&&OV(c),c.options.computed&&LV(c),c.extend=i.extend,c.mixin=i.mixin,c.use=i.use,W2.forEach(function(u){c[u]=i[u]}),l&&(c.options.components[l]=c),c.superOptions=i.options,c.extendOptions=n,c.sealedOptions=ns({},c.options),a[o]=c,c}}function OV(r){var t=r.options.props;for(var n in t)kS(r.prototype,"_props",n)}function LV(r){var t=r.options.computed;for(var n in t)EM(r.prototype,n,t[n])}function FV(r){W2.forEach(function(t){r[t]=function(n,i){return i?(t==="component"&&Fi(i)&&(i.name=i.name||n,i=this.options._base.extend(i)),t==="directive"&&hs(i)&&(i={bind:i,update:i}),this.options[t+"s"][n]=i,i):this.options[t+"s"][n]}})}function kk(r){return r&&(V1(r.Ctor.options)||r.tag)}function a0(r,t){return hn(r)?r.indexOf(t)>-1:typeof r=="string"?r.split(",").indexOf(t)>-1:VB(r)?r.test(t):!1}function $k(r,t){var n=r.cache,i=r.keys,o=r._vnode;for(var a in n){var l=n[a];if(l){var c=l.name;c&&!t(c)&&l3(n,a,i,o)}}}function l3(r,t,n,i){var o=r[t];o&&(!i||o.tag!==i.tag)&&o.componentInstance.$destroy(),r[t]=null,Dc(n,t)}var Ik=[String,RegExp,Array],PV={name:"keep-alive",abstract:!0,props:{include:Ik,exclude:Ik,max:[String,Number]},methods:{cacheVNode:function(){var r=this,t=r.cache,n=r.keys,i=r.vnodeToCache,o=r.keyToCache;if(i){var a=i.tag,l=i.componentInstance,c=i.componentOptions;t[o]={name:kk(c),tag:a,componentInstance:l},n.push(o),this.max&&n.length>parseInt(this.max)&&l3(t,n[0],n,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var r in this.cache)l3(this.cache,r,this.keys)},mounted:function(){var r=this;this.cacheVNode(),this.$watch("include",function(t){$k(r,function(n){return a0(t,n)})}),this.$watch("exclude",function(t){$k(r,function(n){return!a0(t,n)})})},updated:function(){this.cacheVNode()},render:function(){var r=this.$slots.default,t=bM(r),n=t&&t.componentOptions;if(n){var i=kk(n),o=this,a=o.include,l=o.exclude;if(a&&(!i||!a0(a,i))||l&&i&&a0(l,i))return t;var c=this,u=c.cache,h=c.keys,d=t.key==null?n.Ctor.cid+(n.tag?"::".concat(n.tag):""):t.key;u[d]?(t.componentInstance=u[d].componentInstance,Dc(h,d),h.push(d)):(this.vnodeToCache=t,this.keyToCache=d),t.data.keepAlive=!0}return t||r&&r[0]}},BV={KeepAlive:PV};function zV(r){var t={};t.get=function(){return mo},Object.defineProperty(r,"config",t),r.util={warn:cV,extend:ns,mergeOptions:Wu,defineReactive:Vu},r.set=pS,r.delete=hM,r.nextTick=yS,r.observable=function(n){return yl(n),n},r.options=Object.create(null),W2.forEach(function(n){r.options[n+"s"]=Object.create(null)}),r.options._base=r,ns(r.options.components,BV),MV(r),DV(r),RV(r),FV(r)}zV(dn);Object.defineProperty(dn.prototype,"$isServer",{get:bm});Object.defineProperty(dn.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}});Object.defineProperty(dn,"FunctionalRenderContext",{value:_S});dn.version=Pz;var VV=na("style,class"),UV=na("input,textarea,option,select,progress"),WV=function(r,t,n){return n==="value"&&UV(r)&&t!=="button"||n==="selected"&&r==="option"||n==="checked"&&r==="input"||n==="muted"&&r==="video"},NM=na("contenteditable,draggable,spellcheck"),GV=na("events,caret,typing,plaintext-only"),HV=function(r,t){return W1(t)||t==="false"?"false":r==="contenteditable"&&GV(t)?t:"true"},jV=na("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),c3="http://www.w3.org/1999/xlink",IS=function(r){return r.charAt(5)===":"&&r.slice(0,5)==="xlink"},AM=function(r){return IS(r)?r.slice(6,r.length):""},W1=function(r){return r==null||r===!1};function qV(r){for(var t=r.data,n=r,i=r;$t(i.componentInstance);)i=i.componentInstance._vnode,i&&i.data&&(t=Ek(i.data,t));for(;$t(n=n.parent);)n&&n.data&&(t=Ek(t,n.data));return KV(t.staticClass,t.class)}function Ek(r,t){return{staticClass:ES(r.staticClass,t.staticClass),class:$t(r.class)?[r.class,t.class]:t.class}}function KV(r,t){return $t(r)||$t(t)?ES(r,NS(t)):""}function ES(r,t){return r?t?r+" "+t:r:t||""}function NS(r){return Array.isArray(r)?XV(r):Fr(r)?YV(r):typeof r=="string"?r:""}function XV(r){for(var t="",n,i=0,o=r.length;i<o;i++)$t(n=NS(r[i]))&&n!==""&&(t&&(t+=" "),t+=n);return t}function YV(r){var t="";for(var n in r)r[n]&&(t&&(t+=" "),t+=n);return t}var ZV={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},JV=na("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),AS=na("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),MM=function(r){return JV(r)||AS(r)};function QV(r){if(AS(r))return"svg";if(r==="math")return"math"}var l0=Object.create(null);function tU(r){if(!Vi)return!0;if(MM(r))return!1;if(r=r.toLowerCase(),l0[r]!=null)return l0[r];var t=document.createElement(r);return r.indexOf("-")>-1?l0[r]=t.constructor===window.HTMLUnknownElement||t.constructor===window.HTMLElement:l0[r]=/HTMLUnknownElement/.test(t.toString())}var u3=na("text,number,password,search,email,tel,url");function eU(r){if(typeof r=="string"){var t=document.querySelector(r);return t||document.createElement("div")}else return r}function nU(r,t){var n=document.createElement(r);return r!=="select"||t.data&&t.data.attrs&&t.data.attrs.multiple!==void 0&&n.setAttribute("multiple","multiple"),n}function sU(r,t){return document.createElementNS(ZV[r],t)}function rU(r){return document.createTextNode(r)}function iU(r){return document.createComment(r)}function oU(r,t,n){r.insertBefore(t,n)}function aU(r,t){r.removeChild(t)}function lU(r,t){r.appendChild(t)}function cU(r){return r.parentNode}function uU(r){return r.nextSibling}function hU(r){return r.tagName}function dU(r,t){r.textContent=t}function fU(r,t){r.setAttribute(t,"")}var pU=Object.freeze({__proto__:null,createElement:nU,createElementNS:sU,createTextNode:rU,createComment:iU,insertBefore:oU,removeChild:aU,appendChild:lU,parentNode:cU,nextSibling:uU,tagName:hU,setTextContent:dU,setStyleScope:fU}),mU={create:function(r,t){fd(t)},update:function(r,t){r.data.ref!==t.data.ref&&(fd(r,!0),fd(t))},destroy:function(r){fd(r,!0)}};function fd(r,t){var n=r.data.ref;if($t(n)){var i=r.context,o=r.componentInstance||r.elm,a=t?null:o,l=t?void 0:o;if(hs(n)){bc(n,i,[a],i,"template ref function");return}var c=r.data.refInFor,u=typeof n=="string"||typeof n=="number",h=Ia(n),d=i.$refs;if(u||h){if(c){var f=u?d[n]:n.value;t?hn(f)&&Dc(f,o):hn(f)?f.includes(o)||f.push(o):u?(d[n]=[o],Nk(i,n,d[n])):n.value=[o]}else if(u){if(t&&d[n]!==o)return;d[n]=l,Nk(i,n,a)}else if(h){if(t&&n.value!==o)return;n.value=a}}}}function Nk(r,t,n){var i=r._setupState;i&&Qr(i,t)&&(Ia(i[t])?i[t].value=n:i[t]=n)}var ec=new Pi("",{},[]),Gf=["create","activate","update","remove","destroy"];function Qc(r,t){return r.key===t.key&&r.asyncFactory===t.asyncFactory&&(r.tag===t.tag&&r.isComment===t.isComment&&$t(r.data)===$t(t.data)&&gU(r,t)||ys(r.isAsyncPlaceholder)&&Ue(t.asyncFactory.error))}function gU(r,t){if(r.tag!=="input")return!0;var n,i=$t(n=r.data)&&$t(n=n.attrs)&&n.type,o=$t(n=t.data)&&$t(n=n.attrs)&&n.type;return i===o||u3(i)&&u3(o)}function vU(r,t,n){var i,o,a={};for(i=t;i<=n;++i)o=r[i].key,$t(o)&&(a[o]=i);return a}function yU(r){var t,n,i={},o=r.modules,a=r.nodeOps;for(t=0;t<Gf.length;++t)for(i[Gf[t]]=[],n=0;n<o.length;++n)$t(o[n][Gf[t]])&&i[Gf[t]].push(o[n][Gf[t]]);function l(F){return new Pi(a.tagName(F).toLowerCase(),{},[],void 0,F)}function c(F,D){function L(){--L.listeners===0&&u(F)}return L.listeners=D,L}function u(F){var D=a.parentNode(F);$t(D)&&a.removeChild(D,F)}function h(F,D,L,V,j,Y,H){if($t(F.elm)&&$t(Y)&&(F=Y[H]=Zb(F)),F.isRootInsert=!j,!d(F,D,L,V)){var et=F.data,it=F.children,J=F.tag;$t(J)?(F.elm=F.ns?a.createElementNS(F.ns,J):a.createElement(J,F),x(F),g(F,it,D),$t(et)&&v(F,D),m(L,F.elm,V)):ys(F.isComment)?(F.elm=a.createComment(F.text),m(L,F.elm,V)):(F.elm=a.createTextNode(F.text),m(L,F.elm,V))}}function d(F,D,L,V){var j=F.data;if($t(j)){var Y=$t(F.componentInstance)&&j.keepAlive;if($t(j=j.hook)&&$t(j=j.init)&&j(F,!1),$t(F.componentInstance))return f(F,D),m(L,F.elm,V),ys(Y)&&p(F,D,L,V),!0}}function f(F,D){$t(F.data.pendingInsert)&&(D.push.apply(D,F.data.pendingInsert),F.data.pendingInsert=null),F.elm=F.componentInstance.$el,y(F)?(v(F,D),x(F)):(fd(F),D.push(F))}function p(F,D,L,V){for(var j,Y=F;Y.componentInstance;)if(Y=Y.componentInstance._vnode,$t(j=Y.data)&&$t(j=j.transition)){for(j=0;j<i.activate.length;++j)i.activate[j](ec,Y);D.push(Y);break}m(L,F.elm,V)}function m(F,D,L){$t(F)&&($t(L)?a.parentNode(L)===F&&a.insertBefore(F,D,L):a.appendChild(F,D))}function g(F,D,L){if(hn(D))for(var V=0;V<D.length;++V)h(D[V],L,F.elm,null,!0,D,V);else ym(F.text)&&a.appendChild(F.elm,a.createTextNode(String(F.text)))}function y(F){for(;F.componentInstance;)F=F.componentInstance._vnode;return $t(F.tag)}function v(F,D){for(var L=0;L<i.create.length;++L)i.create[L](ec,F);t=F.data.hook,$t(t)&&($t(t.create)&&t.create(ec,F),$t(t.insert)&&D.push(F))}function x(F){var D;if($t(D=F.fnScopeId))a.setStyleScope(F.elm,D);else for(var L=F;L;)$t(D=L.context)&&$t(D=D.$options._scopeId)&&a.setStyleScope(F.elm,D),L=L.parent;$t(D=$u)&&D!==F.context&&D!==F.fnContext&&$t(D=D.$options._scopeId)&&a.setStyleScope(F.elm,D)}function b(F,D,L,V,j,Y){for(;V<=j;++V)h(L[V],Y,F,D,!1,L,V)}function w(F){var D,L,V=F.data;if($t(V))for($t(D=V.hook)&&$t(D=D.destroy)&&D(F),D=0;D<i.destroy.length;++D)i.destroy[D](F);if($t(D=F.children))for(L=0;L<F.children.length;++L)w(F.children[L])}function S(F,D,L){for(;D<=L;++D){var V=F[D];$t(V)&&($t(V.tag)?(_(V),w(V)):u(V.elm))}}function _(F,D){if($t(D)||$t(F.data)){var L,V=i.remove.length+1;for($t(D)?D.listeners+=V:D=c(F.elm,V),$t(L=F.componentInstance)&&$t(L=L._vnode)&&$t(L.data)&&_(L,D),L=0;L<i.remove.length;++L)i.remove[L](F,D);$t(L=F.data.hook)&&$t(L=L.remove)?L(F,D):D()}else u(F.elm)}function $(F,D,L,V,j){for(var Y=0,H=0,et=D.length-1,it=D[0],J=D[et],rt=L.length-1,ut=L[0],vt=L[rt],bt,ht,Wt,Dt,Vt=!j;Y<=et&&H<=rt;)Ue(it)?it=D[++Y]:Ue(J)?J=D[--et]:Qc(it,ut)?(k(it,ut,V,L,H),it=D[++Y],ut=L[++H]):Qc(J,vt)?(k(J,vt,V,L,rt),J=D[--et],vt=L[--rt]):Qc(it,vt)?(k(it,vt,V,L,rt),Vt&&a.insertBefore(F,it.elm,a.nextSibling(J.elm)),it=D[++Y],vt=L[--rt]):Qc(J,ut)?(k(J,ut,V,L,H),Vt&&a.insertBefore(F,J.elm,it.elm),J=D[--et],ut=L[++H]):(Ue(bt)&&(bt=vU(D,Y,et)),ht=$t(ut.key)?bt[ut.key]:N(ut,D,Y,et),Ue(ht)?h(ut,V,F,it.elm,!1,L,H):(Wt=D[ht],Qc(Wt,ut)?(k(Wt,ut,V,L,H),D[ht]=void 0,Vt&&a.insertBefore(F,Wt.elm,it.elm)):h(ut,V,F,it.elm,!1,L,H)),ut=L[++H]);Y>et?(Dt=Ue(L[rt+1])?null:L[rt+1].elm,b(F,Dt,L,H,rt,V)):H>rt&&S(D,Y,et)}function N(F,D,L,V){for(var j=L;j<V;j++){var Y=D[j];if($t(Y)&&Qc(F,Y))return j}}function k(F,D,L,V,j,Y){if(F!==D){$t(D.elm)&&$t(V)&&(D=V[j]=Zb(D));var H=D.elm=F.elm;if(ys(F.isAsyncPlaceholder)){$t(D.asyncFactory.resolved)?B(F.elm,D,L):D.isAsyncPlaceholder=!0;return}if(ys(D.isStatic)&&ys(F.isStatic)&&D.key===F.key&&(ys(D.isCloned)||ys(D.isOnce))){D.componentInstance=F.componentInstance;return}var et,it=D.data;$t(it)&&$t(et=it.hook)&&$t(et=et.prepatch)&&et(F,D);var J=F.children,rt=D.children;if($t(it)&&y(D)){for(et=0;et<i.update.length;++et)i.update[et](F,D);$t(et=it.hook)&&$t(et=et.update)&&et(F,D)}Ue(D.text)?$t(J)&&$t(rt)?J!==rt&&$(H,J,rt,L,Y):$t(rt)?($t(F.text)&&a.setTextContent(H,""),b(H,null,rt,0,rt.length-1,L)):$t(J)?S(J,0,J.length-1):$t(F.text)&&a.setTextContent(H,""):F.text!==D.text&&a.setTextContent(H,D.text),$t(it)&&$t(et=it.hook)&&$t(et=et.postpatch)&&et(F,D)}}function I(F,D,L){if(ys(L)&&$t(F.parent))F.parent.data.pendingInsert=D;else for(var V=0;V<D.length;++V)D[V].data.hook.insert(D[V])}var O=na("attrs,class,staticClass,staticStyle,key");function B(F,D,L,V){var j,Y=D.tag,H=D.data,et=D.children;if(V=V||H&&H.pre,D.elm=F,ys(D.isComment)&&$t(D.asyncFactory))return D.isAsyncPlaceholder=!0,!0;if($t(H)&&($t(j=H.hook)&&$t(j=j.init)&&j(D,!0),$t(j=D.componentInstance)))return f(D,L),!0;if($t(Y)){if($t(et))if(!F.hasChildNodes())g(D,et,L);else if($t(j=H)&&$t(j=j.domProps)&&$t(j=j.innerHTML)){if(j!==F.innerHTML)return!1}else{for(var it=!0,J=F.firstChild,rt=0;rt<et.length;rt++){if(!J||!B(J,et[rt],L,V)){it=!1;break}J=J.nextSibling}if(!it||J)return!1}if($t(H)){var ut=!1;for(var vt in H)if(!O(vt)){ut=!0,v(D,L);break}!ut&&H.class&&B1(H.class)}}else F.data!==D.text&&(F.data=D.text);return!0}return function(D,L,V,j){if(Ue(L)){$t(D)&&w(D);return}var Y=!1,H=[];if(Ue(D))Y=!0,h(L,H);else{var et=$t(D.nodeType);if(!et&&Qc(D,L))k(D,L,H,null,null,j);else{if(et){if(D.nodeType===1&&D.hasAttribute(rk)&&(D.removeAttribute(rk),V=!0),ys(V)&&B(D,L,H))return I(L,H,!0),D;D=l(D)}var it=D.elm,J=a.parentNode(it);if(h(L,H,it._leaveCb?null:J,a.nextSibling(it)),$t(L.parent))for(var rt=L.parent,ut=y(L);rt;){for(var vt=0;vt<i.destroy.length;++vt)i.destroy[vt](rt);if(rt.elm=L.elm,ut){for(var bt=0;bt<i.create.length;++bt)i.create[bt](ec,rt);var ht=rt.data.hook.insert;if(ht.merged)for(var Wt=1;Wt<ht.fns.length;Wt++)ht.fns[Wt]()}else fd(rt);rt=rt.parent}$t(J)?S([D],0,0):$t(D.tag)&&w(D)}}return I(L,H,Y),L.elm}}var xU={create:ix,update:ix,destroy:function(t){ix(t,ec)}};function ix(r,t){(r.data.directives||t.data.directives)&&bU(r,t)}function bU(r,t){var n=r===ec,i=t===ec,o=Ak(r.data.directives,r.context),a=Ak(t.data.directives,t.context),l=[],c=[],u,h,d;for(u in a)h=o[u],d=a[u],h?(d.oldValue=h.value,d.oldArg=h.arg,Hf(d,"update",t,r),d.def&&d.def.componentUpdated&&c.push(d)):(Hf(d,"bind",t,r),d.def&&d.def.inserted&&l.push(d));if(l.length){var f=function(){for(var p=0;p<l.length;p++)Hf(l[p],"inserted",t,r)};n?tc(t,"insert",f):f()}if(c.length&&tc(t,"postpatch",function(){for(var p=0;p<c.length;p++)Hf(c[p],"componentUpdated",t,r)}),!n)for(u in o)a[u]||Hf(o[u],"unbind",r,r,i)}var wU=Object.create(null);function Ak(r,t){var n=Object.create(null);if(!r)return n;var i,o;for(i=0;i<r.length;i++){if(o=r[i],o.modifiers||(o.modifiers=wU),n[SU(o)]=o,t._setupState&&t._setupState.__sfc){var a=o.def||U1(t,"_setupState","v-"+o.name);typeof a=="function"?o.def={bind:a,update:a}:o.def=a}o.def=o.def||U1(t.$options,"directives",o.name)}return n}function SU(r){return r.rawName||"".concat(r.name,".").concat(Object.keys(r.modifiers||{}).join("."))}function Hf(r,t,n,i,o){var a=r.def&&r.def[t];if(a)try{a(n.elm,r,n,i,o)}catch(l){Uu(l,n.context,"directive ".concat(r.name," ").concat(t," hook"))}}var _U=[mU,xU];function Mk(r,t){var n=t.componentOptions;if(!($t(n)&&n.Ctor.options.inheritAttrs===!1)&&!(Ue(r.data.attrs)&&Ue(t.data.attrs))){var i,o,a,l=t.elm,c=r.data.attrs||{},u=t.data.attrs||{};($t(u.__ob__)||ys(u._v_attr_proxy))&&(u=t.data.attrs=ns({},u));for(i in u)o=u[i],a=c[i],a!==o&&Dk(l,i,o,t.data.pre);(of||aM)&&u.value!==c.value&&Dk(l,"value",u.value);for(i in c)Ue(u[i])&&(IS(i)?l.removeAttributeNS(c3,AM(i)):NM(i)||l.removeAttribute(i))}}function Dk(r,t,n,i){i||r.tagName.indexOf("-")>-1?Rk(r,t,n):jV(t)?W1(n)?r.removeAttribute(t):(n=t==="allowfullscreen"&&r.tagName==="EMBED"?"true":t,r.setAttribute(t,n)):NM(t)?r.setAttribute(t,HV(t,n)):IS(t)?W1(n)?r.removeAttributeNS(c3,AM(t)):r.setAttributeNS(c3,t,n):Rk(r,t,n)}function Rk(r,t,n){if(W1(n))r.removeAttribute(t);else{if(of&&!af&&r.tagName==="TEXTAREA"&&t==="placeholder"&&n!==""&&!r.__ieph){var i=function(o){o.stopImmediatePropagation(),r.removeEventListener("input",i)};r.addEventListener("input",i),r.__ieph=!0}r.setAttribute(t,n)}}var TU={create:Mk,update:Mk};function Ok(r,t){var n=t.elm,i=t.data,o=r.data;if(!(Ue(i.staticClass)&&Ue(i.class)&&(Ue(o)||Ue(o.staticClass)&&Ue(o.class)))){var a=qV(t),l=n._transitionClasses;$t(l)&&(a=ES(a,NS(l))),a!==n._prevClass&&(n.setAttribute("class",a),n._prevClass=a)}}var CU={create:Ok,update:Ok},ox="__r",ax="__c";function kU(r){if($t(r[ox])){var t=of?"change":"input";r[t]=[].concat(r[ox],r[t]||[]),delete r[ox]}$t(r[ax])&&(r.change=[].concat(r[ax],r.change||[]),delete r[ax])}var Wp;function $U(r,t,n){var i=Wp;return function o(){var a=t.apply(null,arguments);a!==null&&DM(r,o,n,i)}}var IU=e3&&!(ik&&Number(ik[1])<=53);function EU(r,t,n,i){if(IU){var o=$M,a=t;t=a._wrapper=function(l){if(l.target===l.currentTarget||l.timeStamp>=o||l.timeStamp<=0||l.target.ownerDocument!==document)return a.apply(this,arguments)}}Wp.addEventListener(r,t,lM?{capture:n,passive:i}:n)}function DM(r,t,n,i){(i||Wp).removeEventListener(r,t._wrapper||t,n)}function lx(r,t){if(!(Ue(r.data.on)&&Ue(t.data.on))){var n=t.data.on||{},i=r.data.on||{};Wp=t.elm||r.elm,kU(n),pM(n,i,EU,DM,$U,t.context),Wp=void 0}}var NU={create:lx,update:lx,destroy:function(r){return lx(r,ec)}},c0;function Lk(r,t){if(!(Ue(r.data.domProps)&&Ue(t.data.domProps))){var n,i,o=t.elm,a=r.data.domProps||{},l=t.data.domProps||{};($t(l.__ob__)||ys(l._v_attr_proxy))&&(l=t.data.domProps=ns({},l));for(n in a)n in l||(o[n]="");for(n in l){if(i=l[n],n==="textContent"||n==="innerHTML"){if(t.children&&(t.children.length=0),i===a[n])continue;o.childNodes.length===1&&o.removeChild(o.childNodes[0])}if(n==="value"&&o.tagName!=="PROGRESS"){o._value=i;var c=Ue(i)?"":String(i);AU(o,c)&&(o.value=c)}else if(n==="innerHTML"&&AS(o.tagName)&&Ue(o.innerHTML)){c0=c0||document.createElement("div"),c0.innerHTML="<svg>".concat(i,"</svg>");for(var u=c0.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;u.firstChild;)o.appendChild(u.firstChild)}else if(i!==a[n])try{o[n]=i}catch{}}}}function AU(r,t){return!r.composing&&(r.tagName==="OPTION"||MU(r,t)||DU(r,t))}function MU(r,t){var n=!0;try{n=document.activeElement!==r}catch{}return n&&r.value!==t}function DU(r,t){var n=r.value,i=r._vModifiers;if($t(i)){if(i.number)return Pp(n)!==Pp(t);if(i.trim)return n.trim()!==t.trim()}return n!==t}var RU={create:Lk,update:Lk},OU=fh(function(r){var t={},n=/;(?![^(]*\))/g,i=/:(.+)/;return r.split(n).forEach(function(o){if(o){var a=o.split(i);a.length>1&&(t[a[0].trim()]=a[1].trim())}}),t});function cx(r){var t=RM(r.style);return r.staticStyle?ns(r.staticStyle,t):t}function RM(r){return Array.isArray(r)?nM(r):typeof r=="string"?OU(r):r}function LU(r,t){var n={},i;if(t)for(var o=r;o.componentInstance;)o=o.componentInstance._vnode,o&&o.data&&(i=cx(o.data))&&ns(n,i);(i=cx(r.data))&&ns(n,i);for(var a=r;a=a.parent;)a.data&&(i=cx(a.data))&&ns(n,i);return n}var FU=/^--/,Fk=/\s*!important$/,Pk=function(r,t,n){if(FU.test(t))r.style.setProperty(t,n);else if(Fk.test(n))r.style.setProperty(xm(t),n.replace(Fk,""),"important");else{var i=PU(t);if(Array.isArray(n))for(var o=0,a=n.length;o<a;o++)r.style[i]=n[o];else r.style[i]=n}},Bk=["Webkit","Moz","ms"],u0,PU=fh(function(r){if(u0=u0||document.createElement("div").style,r=Bu(r),r!=="filter"&&r in u0)return r;for(var t=r.charAt(0).toUpperCase()+r.slice(1),n=0;n<Bk.length;n++){var i=Bk[n]+t;if(i in u0)return i}});function zk(r,t){var n=t.data,i=r.data;if(!(Ue(n.staticStyle)&&Ue(n.style)&&Ue(i.staticStyle)&&Ue(i.style))){var o,a,l=t.elm,c=i.staticStyle,u=i.normalizedStyle||i.style||{},h=c||u,d=RM(t.data.style)||{};t.data.normalizedStyle=$t(d.__ob__)?ns({},d):d;var f=LU(t,!0);for(a in h)Ue(f[a])&&Pk(l,a,"");for(a in f)o=f[a],o!==h[a]&&Pk(l,a,o??"")}}var BU={create:zk,update:zk},OM=/\s+/;function LM(r,t){if(!(!t||!(t=t.trim())))if(r.classList)t.indexOf(" ")>-1?t.split(OM).forEach(function(i){return r.classList.add(i)}):r.classList.add(t);else{var n=" ".concat(r.getAttribute("class")||""," ");n.indexOf(" "+t+" ")<0&&r.setAttribute("class",(n+t).trim())}}function FM(r,t){if(!(!t||!(t=t.trim())))if(r.classList)t.indexOf(" ")>-1?t.split(OM).forEach(function(o){return r.classList.remove(o)}):r.classList.remove(t),r.classList.length||r.removeAttribute("class");else{for(var n=" ".concat(r.getAttribute("class")||""," "),i=" "+t+" ";n.indexOf(i)>=0;)n=n.replace(i," ");n=n.trim(),n?r.setAttribute("class",n):r.removeAttribute("class")}}function PM(r){if(r){if(typeof r=="object"){var t={};return r.css!==!1&&ns(t,Vk(r.name||"v")),ns(t,r),t}else if(typeof r=="string")return Vk(r)}}var Vk=fh(function(r){return{enterClass:"".concat(r,"-enter"),enterToClass:"".concat(r,"-enter-to"),enterActiveClass:"".concat(r,"-enter-active"),leaveClass:"".concat(r,"-leave"),leaveToClass:"".concat(r,"-leave-to"),leaveActiveClass:"".concat(r,"-leave-active")}}),BM=Vi&&!af,rd="transition",ux="animation",b1="transition",G1="transitionend",h3="animation",zM="animationend";BM&&(window.ontransitionend===void 0&&window.onwebkittransitionend!==void 0&&(b1="WebkitTransition",G1="webkitTransitionEnd"),window.onanimationend===void 0&&window.onwebkitanimationend!==void 0&&(h3="WebkitAnimation",zM="webkitAnimationEnd"));var Uk=Vi?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(r){return r()};function VM(r){Uk(function(){Uk(r)})}function Iu(r,t){var n=r._transitionClasses||(r._transitionClasses=[]);n.indexOf(t)<0&&(n.push(t),LM(r,t))}function cl(r,t){r._transitionClasses&&Dc(r._transitionClasses,t),FM(r,t)}function UM(r,t,n){var i=WM(r,t),o=i.type,a=i.timeout,l=i.propCount;if(!o)return n();var c=o===rd?G1:zM,u=0,h=function(){r.removeEventListener(c,d),n()},d=function(f){f.target===r&&++u>=l&&h()};setTimeout(function(){u<l&&h()},a+1),r.addEventListener(c,d)}var zU=/\b(transform|all)(,|$)/;function WM(r,t){var n=window.getComputedStyle(r),i=(n[b1+"Delay"]||"").split(", "),o=(n[b1+"Duration"]||"").split(", "),a=Wk(i,o),l=(n[h3+"Delay"]||"").split(", "),c=(n[h3+"Duration"]||"").split(", "),u=Wk(l,c),h,d=0,f=0;t===rd?a>0&&(h=rd,d=a,f=o.length):t===ux?u>0&&(h=ux,d=u,f=c.length):(d=Math.max(a,u),h=d>0?a>u?rd:ux:null,f=h?h===rd?o.length:c.length:0);var p=h===rd&&zU.test(n[b1+"Property"]);return{type:h,timeout:d,propCount:f,hasTransform:p}}function Wk(r,t){for(;r.length<t.length;)r=r.concat(r);return Math.max.apply(null,t.map(function(n,i){return Gk(n)+Gk(r[i])}))}function Gk(r){return Number(r.slice(0,-1).replace(",","."))*1e3}function d3(r,t){var n=r.elm;$t(n._leaveCb)&&(n._leaveCb.cancelled=!0,n._leaveCb());var i=PM(r.data.transition);if(!Ue(i)&&!($t(n._enterCb)||n.nodeType!==1)){for(var o=i.css,a=i.type,l=i.enterClass,c=i.enterToClass,u=i.enterActiveClass,h=i.appearClass,d=i.appearToClass,f=i.appearActiveClass,p=i.beforeEnter,m=i.enter,g=i.afterEnter,y=i.enterCancelled,v=i.beforeAppear,x=i.appear,b=i.afterAppear,w=i.appearCancelled,S=i.duration,_=$u,$=$u.$vnode;$&&$.parent;)_=$.context,$=$.parent;var N=!_._isMounted||!r.isRootInsert;if(!(N&&!x&&x!=="")){var k=N&&h?h:l,I=N&&f?f:u,O=N&&d?d:c,B=N&&v||p,F=N&&hs(x)?x:m,D=N&&b||g,L=N&&w||y,V=Pp(Fr(S)?S.enter:S),j=o!==!1&&!af,Y=MS(F),H=n._enterCb=R1(function(){j&&(cl(n,O),cl(n,I)),H.cancelled?(j&&cl(n,k),L&&L(n)):D&&D(n),n._enterCb=null});r.data.show||tc(r,"insert",function(){var et=n.parentNode,it=et&&et._pending&&et._pending[r.key];it&&it.tag===r.tag&&it.elm._leaveCb&&it.elm._leaveCb(),F&&F(n,H)}),B&&B(n),j&&(Iu(n,k),Iu(n,I),VM(function(){cl(n,k),H.cancelled||(Iu(n,O),Y||(HM(V)?setTimeout(H,V):UM(n,a,H)))})),r.data.show&&(t&&t(),F&&F(n,H)),!j&&!Y&&H()}}}function GM(r,t){var n=r.elm;$t(n._enterCb)&&(n._enterCb.cancelled=!0,n._enterCb());var i=PM(r.data.transition);if(Ue(i)||n.nodeType!==1)return t();if($t(n._leaveCb))return;var o=i.css,a=i.type,l=i.leaveClass,c=i.leaveToClass,u=i.leaveActiveClass,h=i.beforeLeave,d=i.leave,f=i.afterLeave,p=i.leaveCancelled,m=i.delayLeave,g=i.duration,y=o!==!1&&!af,v=MS(d),x=Pp(Fr(g)?g.leave:g),b=n._leaveCb=R1(function(){n.parentNode&&n.parentNode._pending&&(n.parentNode._pending[r.key]=null),y&&(cl(n,c),cl(n,u)),b.cancelled?(y&&cl(n,l),p&&p(n)):(t(),f&&f(n)),n._leaveCb=null});m?m(w):w();function w(){b.cancelled||(!r.data.show&&n.parentNode&&((n.parentNode._pending||(n.parentNode._pending={}))[r.key]=r),h&&h(n),y&&(Iu(n,l),Iu(n,u),VM(function(){cl(n,l),b.cancelled||(Iu(n,c),v||(HM(x)?setTimeout(b,x):UM(n,a,b)))})),d&&d(n,b),!y&&!v&&b())}}function HM(r){return typeof r=="number"&&!isNaN(r)}function MS(r){if(Ue(r))return!1;var t=r.fns;return $t(t)?MS(Array.isArray(t)?t[0]:t):(r._length||r.length)>1}function Hk(r,t){t.data.show!==!0&&d3(t)}var VU=Vi?{create:Hk,activate:Hk,remove:function(r,t){r.data.show!==!0?GM(r,t):t()}}:{},UU=[TU,CU,NU,RU,BU,VU],WU=UU.concat(_U),GU=yU({nodeOps:pU,modules:WU});af&&document.addEventListener("selectionchange",function(){var r=document.activeElement;r&&r.vmodel&&DS(r,"input")});var jM={inserted:function(r,t,n,i){n.tag==="select"?(i.elm&&!i.elm._vOptions?tc(n,"postpatch",function(){jM.componentUpdated(r,t,n)}):jk(r,t,n.context),r._vOptions=[].map.call(r.options,H1)):(n.tag==="textarea"||u3(r.type))&&(r._vModifiers=t.modifiers,t.modifiers.lazy||(r.addEventListener("compositionstart",HU),r.addEventListener("compositionend",Xk),r.addEventListener("change",Xk),af&&(r.vmodel=!0)))},componentUpdated:function(r,t,n){if(n.tag==="select"){jk(r,t,n.context);var i=r._vOptions,o=r._vOptions=[].map.call(r.options,H1);if(o.some(function(l,c){return!zu(l,i[c])})){var a=r.multiple?t.value.some(function(l){return Kk(l,o)}):t.value!==t.oldValue&&Kk(t.value,o);a&&DS(r,"change")}}}};function jk(r,t,n){qk(r,t),(of||aM)&&setTimeout(function(){qk(r,t)},0)}function qk(r,t,n){var i=t.value,o=r.multiple;if(!(o&&!Array.isArray(i))){for(var a,l,c=0,u=r.options.length;c<u;c++)if(l=r.options[c],o)a=rM(i,H1(l))>-1,l.selected!==a&&(l.selected=a);else if(zu(H1(l),i)){r.selectedIndex!==c&&(r.selectedIndex=c);return}o||(r.selectedIndex=-1)}}function Kk(r,t){return t.every(function(n){return!zu(n,r)})}function H1(r){return"_value"in r?r._value:r.value}function HU(r){r.target.composing=!0}function Xk(r){r.target.composing&&(r.target.composing=!1,DS(r.target,"input"))}function DS(r,t){var n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),r.dispatchEvent(n)}function f3(r){return r.componentInstance&&(!r.data||!r.data.transition)?f3(r.componentInstance._vnode):r}var jU={bind:function(r,t,n){var i=t.value;n=f3(n);var o=n.data&&n.data.transition,a=r.__vOriginalDisplay=r.style.display==="none"?"":r.style.display;i&&o?(n.data.show=!0,d3(n,function(){r.style.display=a})):r.style.display=i?a:"none"},update:function(r,t,n){var i=t.value,o=t.oldValue;if(!i!=!o){n=f3(n);var a=n.data&&n.data.transition;a?(n.data.show=!0,i?d3(n,function(){r.style.display=r.__vOriginalDisplay}):GM(n,function(){r.style.display="none"})):r.style.display=i?r.__vOriginalDisplay:"none"}},unbind:function(r,t,n,i,o){o||(r.style.display=r.__vOriginalDisplay)}},qU={model:jM,show:jU},qM={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function p3(r){var t=r&&r.componentOptions;return t&&t.Ctor.options.abstract?p3(bM(t.children)):r}function KM(r){var t={},n=r.$options;for(var i in n.propsData)t[i]=r[i];var o=n._parentListeners;for(var i in o)t[Bu(i)]=o[i];return t}function Yk(r,t){if(/\d-keep-alive$/.test(t.tag))return r("keep-alive",{props:t.componentOptions.propsData})}function KU(r){for(;r=r.parent;)if(r.data.transition)return!0}function XU(r,t){return t.key===r.key&&t.tag===r.tag}var YU=function(r){return r.tag||zp(r)},ZU=function(r){return r.name==="show"},JU={name:"transition",props:qM,abstract:!0,render:function(r){var t=this,n=this.$slots.default;if(n&&(n=n.filter(YU),!!n.length)){var i=this.mode,o=n[0];if(KU(this.$vnode))return o;var a=p3(o);if(!a)return o;if(this._leaving)return Yk(r,o);var l="__transition-".concat(this._uid,"-");a.key=a.key==null?a.isComment?l+"comment":l+a.tag:ym(a.key)?String(a.key).indexOf(l)===0?a.key:l+a.key:a.key;var c=(a.data||(a.data={})).transition=KM(this),u=this._vnode,h=p3(u);if(a.data.directives&&a.data.directives.some(ZU)&&(a.data.show=!0),h&&h.data&&!XU(a,h)&&!zp(h)&&!(h.componentInstance&&h.componentInstance._vnode.isComment)){var d=h.data.transition=ns({},c);if(i==="out-in")return this._leaving=!0,tc(d,"afterLeave",function(){t._leaving=!1,t.$forceUpdate()}),Yk(r,o);if(i==="in-out"){if(zp(a))return u;var f,p=function(){f()};tc(c,"afterEnter",p),tc(c,"enterCancelled",p),tc(d,"delayLeave",function(m){f=m})}}return o}}},XM=ns({tag:String,moveClass:String},qM);delete XM.mode;var QU={props:XM,beforeMount:function(){var r=this,t=this._update;this._update=function(n,i){var o=TM(r);r.__patch__(r._vnode,r.kept,!1,!0),r._vnode=r.kept,o(),t.call(r,n,i)}},render:function(r){for(var t=this.tag||this.$vnode.data.tag||"span",n=Object.create(null),i=this.prevChildren=this.children,o=this.$slots.default||[],a=this.children=[],l=KM(this),c=0;c<o.length;c++){var u=o[c];u.tag&&u.key!=null&&String(u.key).indexOf("__vlist")!==0&&(a.push(u),n[u.key]=u,(u.data||(u.data={})).transition=l)}if(i){for(var h=[],d=[],c=0;c<i.length;c++){var u=i[c];u.data.transition=l,u.data.pos=u.elm.getBoundingClientRect(),n[u.key]?h.push(u):d.push(u)}this.kept=r(t,null,h),this.removed=d}return r(t,null,a)},updated:function(){var r=this.prevChildren,t=this.moveClass||(this.name||"v")+"-move";!r.length||!this.hasMove(r[0].elm,t)||(r.forEach(tW),r.forEach(eW),r.forEach(nW),this._reflow=document.body.offsetHeight,r.forEach(function(n){if(n.data.moved){var i=n.elm,o=i.style;Iu(i,t),o.transform=o.WebkitTransform=o.transitionDuration="",i.addEventListener(G1,i._moveCb=function a(l){l&&l.target!==i||(!l||/transform$/.test(l.propertyName))&&(i.removeEventListener(G1,a),i._moveCb=null,cl(i,t))})}}))},methods:{hasMove:function(r,t){if(!BM)return!1;if(this._hasMove)return this._hasMove;var n=r.cloneNode();r._transitionClasses&&r._transitionClasses.forEach(function(o){FM(n,o)}),LM(n,t),n.style.display="none",this.$el.appendChild(n);var i=WM(n);return this.$el.removeChild(n),this._hasMove=i.hasTransform}}};function tW(r){r.elm._moveCb&&r.elm._moveCb(),r.elm._enterCb&&r.elm._enterCb()}function eW(r){r.data.newPos=r.elm.getBoundingClientRect()}function nW(r){var t=r.data.pos,n=r.data.newPos,i=t.left-n.left,o=t.top-n.top;if(i||o){r.data.moved=!0;var a=r.elm.style;a.transform=a.WebkitTransform="translate(".concat(i,"px,").concat(o,"px)"),a.transitionDuration="0s"}}var sW={Transition:JU,TransitionGroup:QU};dn.config.mustUseProp=WV;dn.config.isReservedTag=MM;dn.config.isReservedAttr=VV;dn.config.getTagNamespace=QV;dn.config.isUnknownElement=tU;ns(dn.options.directives,qU);ns(dn.options.components,sW);dn.prototype.__patch__=Vi?GU:ar;dn.prototype.$mount=function(r,t){return r=r&&Vi?eU(r):void 0,qz(this,r,t)};Vi&&setTimeout(function(){mo.devtools&&O1&&O1.emit("init",dn)},0);function re(){return re=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])}return r},re.apply(this,arguments)}var Ea=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function rW(r){if(r.__esModule)return r;var t=r.default;if(typeof t=="function"){var n=function i(){if(this instanceof i){var o=[null];o.push.apply(o,arguments);var a=Function.bind.apply(t,o);return new a}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var o=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:function(){return r[i]}})}),n}function m3(){return m3=Object.assign?Object.assign.bind():function(r){for(var t,n=1;n<arguments.length;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i]);return r},m3.apply(this,arguments)}var iW=["attrs","props","domProps"],oW=["class","style","directives"],aW=["on","nativeOn"],lW=function(r){return r.reduce(function(t,n){for(var i in n)if(!t[i])t[i]=n[i];else if(iW.indexOf(i)!==-1)t[i]=m3({},t[i],n[i]);else if(oW.indexOf(i)!==-1){var o=t[i]instanceof Array?t[i]:[t[i]],a=n[i]instanceof Array?n[i]:[n[i]];t[i]=[].concat(o,a)}else if(aW.indexOf(i)!==-1)for(var l in n[i])if(t[i][l]){var c=t[i][l]instanceof Array?t[i][l]:[t[i][l]],u=n[i][l]instanceof Array?n[i][l]:[n[i][l]];t[i][l]=[].concat(c,u)}else t[i][l]=n[i][l];else if(i==="hook")for(var h in n[i])t[i][h]=t[i][h]?cW(t[i][h],n[i][h]):n[i][h];else t[i]=n[i];return t},{})},cW=function(r,t){return function(){r&&r.apply(this,arguments),t&&t.apply(this,arguments)}},uW=lW;const mn=uW;function g3(r,t){return t?typeof t=="string"?" "+r+"--"+t:Array.isArray(t)?t.reduce(function(n,i){return n+g3(r,i)},""):Object.keys(t).reduce(function(n,i){return n+(t[i]?g3(r,i):"")},""):""}function hW(r){return function(t,n){return t&&typeof t!="string"&&(n=t,t=""),t=t?r+"__"+t:r,""+t+g3(t,n)}}var dW=Object.prototype.hasOwnProperty;function fW(r,t,n){var i=t[n];gn(i)&&(!dW.call(r,n)||!sa(i)?r[n]=i:r[n]=YM(Object(r[n]),t[n]))}function YM(r,t){return Object.keys(t).forEach(function(n){fW(r,t,n)}),r}const pW={name:"",tel:"",save:"",confirm:"",cancel:"",delete:"",complete:"",loading:"...",telEmpty:"",nameEmpty:"",nameInvalid:"",confirmDelete:"",telInvalid:"",vanCalendar:{end:"",start:"",title:"",confirm:"",startEnd:"/",weekdays:["","","","","","",""],monthTitle:function(t,n){return t+""+n+""},rangePrompt:function(t){return" "+t+" "}},vanCascader:{select:""},vanContactCard:{addText:""},vanContactList:{addText:""},vanPagination:{prev:"",next:""},vanPullRefresh:{pulling:"...",loosing:"..."},vanSubmitBar:{label:""},vanCoupon:{unlimited:"",discount:function(t){return t+""},condition:function(t){return""+t+""}},vanCouponCell:{title:"",tips:"",count:function(t){return t+""}},vanCouponList:{empty:"",exchange:"",close:"",enable:"",disabled:"",placeholder:""},vanAddressEdit:{area:"",postal:"",areaEmpty:"",addressEmpty:"",postalEmpty:"",defaultAddress:"",telPlaceholder:"",namePlaceholder:"",areaPlaceholder:" /  / "},vanAddressEditDetail:{label:"",placeholder:""},vanAddressList:{add:""}};var pd=dn.prototype,ZM=dn.util.defineReactive;ZM(pd,"$vantLang","zh-CN");ZM(pd,"$vantMessages",{"zh-CN":pW});const RS={messages:function(){return pd.$vantMessages[pd.$vantLang]},use:function(t,n){var i;pd.$vantLang=t,this.add((i={},i[t]=n,i))},add:function(t){t===void 0&&(t={}),YM(pd.$vantMessages,t)}};var mW=/-(\w)/g;function JM(r){return r.replace(mW,function(t,n){return n.toUpperCase()})}function Ms(r,t){t===void 0&&(t=2);for(var n=r+"";n.length<t;)n="0"+n;return n}var gW={methods:{slots:function(t,n){t===void 0&&(t="default");var i=this.$slots,o=this.$scopedSlots,a=o[t];return a?a(n):i[t]}}};function vW(r){var t=this.name;r.component(t,this),r.component(JM("-"+t),this)}function yW(r){var t=r.scopedSlots||r.data.scopedSlots||{},n=r.slots();return Object.keys(n).forEach(function(i){t[i]||(t[i]=function(){return n[i]})}),t}function xW(r){return{functional:!0,props:r.props,model:r.model,render:function(n,i){return r(n,i.props,yW(i),i)}}}function bW(r){return function(t){return Ad(t)&&(t=xW(t)),t.functional||(t.mixins=t.mixins||[],t.mixins.push(gW)),t.name=r,t.install=vW,t}}function wW(r){var t=JM(r)+".";return function(n){for(var i=RS.messages(),o=Zk(i,t+n)||Zk(i,n),a=arguments.length,l=new Array(a>1?a-1:0),c=1;c<a;c++)l[c-1]=arguments[c];return Ad(o)?o.apply(void 0,l):o}}function Ht(r){return r="van-"+r,[bW(r),hW(r),wW(r)]}function OS(r){return/^\d+(\.\d+)?$/.test(r)}function LS(r){return Number.isNaN?Number.isNaN(r):r!==r}function kn(r){if(gn(r))return r=String(r),OS(r)?r+"px":r}var hx;function SW(){if(!hx){var r=document.documentElement,t=r.style.fontSize||window.getComputedStyle(r).fontSize;hx=parseFloat(t)}return hx}function _W(r){return r=r.replace(/rem/g,""),+r*SW()}function TW(r){return r=r.replace(/vw/g,""),+r*window.innerWidth/100}function CW(r){return r=r.replace(/vh/g,""),+r*window.innerHeight/100}function FS(r){if(typeof r=="number")return r;if(G2){if(r.indexOf("rem")!==-1)return _W(r);if(r.indexOf("vw")!==-1)return TW(r);if(r.indexOf("vh")!==-1)return CW(r)}return parseFloat(r)}var G2=typeof window<"u",_o=dn.prototype.$isServer;function Gp(){}function gn(r){return r!=null}function Ad(r){return typeof r=="function"}function sa(r){return r!==null&&typeof r=="object"}function j1(r){return sa(r)&&Ad(r.then)&&Ad(r.catch)}function Zk(r,t){var n=t.split("."),i=r;return n.forEach(function(o){var a;i=sa(i)&&(a=i[o])!=null?a:""}),i}function kW(r){return r==null||typeof r!="object"?!0:Object.keys(r).length===0}var $W=["ref","key","style","class","attrs","refInFor","nativeOn","directives","staticClass","staticStyle"],IW={nativeOn:"on"};function Xn(r,t){var n=$W.reduce(function(i,o){return r.data[o]&&(i[IW[o]||o]=r.data[o]),i},{});return t&&(n.on=n.on||{},re(n.on,r.data.on)),n}function bn(r,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];var a=r.listeners[t];a&&(Array.isArray(a)?a.forEach(function(l){l.apply(void 0,i)}):a.apply(void 0,i))}function QM(r,t){var n=new dn({el:document.createElement("div"),props:r.props,render:function(o){return o(r,re({props:this.$props},t))}});return document.body.appendChild(n.$el),n}var ci={zIndex:2e3,lockCount:0,stack:[],find:function(t){return this.stack.filter(function(n){return n.vm===t})[0]},remove:function(t){var n=this.find(t);if(n){n.vm=null,n.overlay=null;var i=this.stack.indexOf(n);this.stack.splice(i,1)}}},t6=!1;if(!_o)try{var Jk={};Object.defineProperty(Jk,"passive",{get:function(){t6=!0}}),window.addEventListener("test-passive",null,Jk)}catch{}function ao(r,t,n,i){i===void 0&&(i=!1),_o||r.addEventListener(t,n,t6?{capture:!1,passive:i}:!1)}function wc(r,t,n){_o||r.removeEventListener(t,n)}function e6(r){r.stopPropagation()}function wr(r,t){(typeof r.cancelable!="boolean"||r.cancelable)&&r.preventDefault(),t&&e6(r)}var n6=Ht("overlay"),EW=n6[0],NW=n6[1];function AW(r){wr(r,!0)}function s6(r,t,n,i){var o=re({zIndex:t.zIndex},t.customStyle);return gn(t.duration)&&(o.animationDuration=t.duration+"s"),r("transition",{attrs:{name:"van-fade"}},[r("div",mn([{directives:[{name:"show",value:t.show}],style:o,class:[NW(),t.className],on:{touchmove:t.lockScroll?AW:Gp}},Xn(i,!0)]),[n.default==null?void 0:n.default()])])}s6.props={show:Boolean,zIndex:[Number,String],duration:[Number,String],className:null,customStyle:Object,lockScroll:{type:Boolean,default:!0}};const r6=EW(s6);function PS(r){var t=r.parentNode;t&&t.removeChild(r)}var MW={className:"",customStyle:{}};function DW(r){return QM(r6,{on:{click:function(){r.$emit("click-overlay"),r.closeOnClickOverlay&&(r.onClickOverlay?r.onClickOverlay():r.close())}}})}function i6(r){var t=ci.find(r);if(t){var n=r.$el,i=t.config,o=t.overlay;n&&n.parentNode&&n.parentNode.insertBefore(o.$el,n),re(o,MW,i,{show:!0})}}function RW(r,t){var n=ci.find(r);if(n)n.config=t;else{var i=DW(r);ci.stack.push({vm:r,config:t,overlay:i})}i6(r)}function Qk(r){var t=ci.find(r);t&&(t.overlay.show=!1)}function OW(r){var t=ci.find(r);t&&(PS(t.overlay.$el),ci.remove(r))}function BS(r){return r===window}var LW=/scroll|auto|overlay/i;function ph(r,t){t===void 0&&(t=window);for(var n=r;n&&n.tagName!=="HTML"&&n.tagName!=="BODY"&&n.nodeType===1&&n!==t;){var i=window.getComputedStyle(n),o=i.overflowY;if(LW.test(o))return n;n=n.parentNode}return t}function mh(r){var t="scrollTop"in r?r.scrollTop:r.pageYOffset;return Math.max(t,0)}function q1(r,t){"scrollTop"in r?r.scrollTop=t:r.scrollTo(r.scrollX,t)}function Sm(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0}function H2(r){q1(window,r),q1(document.body,r)}function v3(r,t){if(BS(r))return 0;var n=t?mh(t):Sm();return r.getBoundingClientRect().top+n}function FW(r){return BS(r)?r.innerHeight:r.getBoundingClientRect().height}function PW(r){return BS(r)?0:r.getBoundingClientRect().top}function BW(r,t){return r>t?"horizontal":t>r?"vertical":""}var To={data:function(){return{direction:""}},methods:{touchStart:function(t){this.resetTouchStatus(),this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY},touchMove:function(t){var n=t.touches[0];this.deltaX=n.clientX<0?0:n.clientX-this.startX,this.deltaY=n.clientY-this.startY,this.offsetX=Math.abs(this.deltaX),this.offsetY=Math.abs(this.deltaY);var i=10;(!this.direction||this.offsetX<i&&this.offsetY<i)&&(this.direction=BW(this.offsetX,this.offsetY))},resetTouchStatus:function(){this.direction="",this.deltaX=0,this.deltaY=0,this.offsetX=0,this.offsetY=0},bindTouchEvent:function(t){var n=this.onTouchStart,i=this.onTouchMove,o=this.onTouchEnd;ao(t,"touchstart",n),ao(t,"touchmove",i),o&&(ao(t,"touchend",o),ao(t,"touchcancel",o))}}};function zW(r){return typeof r=="string"?document.querySelector(r):r()}function zS(r){var t=r===void 0?{}:r,n=t.ref,i=t.afterPortal;return{props:{getContainer:[String,Function]},watch:{getContainer:"portal"},mounted:function(){this.getContainer&&this.portal()},methods:{portal:function(){var a=this.getContainer,l=n?this.$refs[n]:this.$el,c;a?c=zW(a):this.$parent&&(c=this.$parent.$el),c&&c!==l.parentNode&&c.appendChild(l),i&&i.call(this)}}}}var VW=0;function ra(r){var t="binded_"+VW++;function n(){this[t]||(r.call(this,ao,!0),this[t]=!0)}function i(){this[t]&&(r.call(this,wc,!1),this[t]=!1)}return{mounted:n,activated:n,deactivated:i,beforeDestroy:i}}var UW={mixins:[ra(function(r,t){this.handlePopstate(t&&this.closeOnPopstate)})],props:{closeOnPopstate:Boolean},data:function(){return{bindStatus:!1}},watch:{closeOnPopstate:function(t){this.handlePopstate(t)}},methods:{onPopstate:function(){this.close(),this.shouldReopen=!1},handlePopstate:function(t){if(!this.$isServer&&this.bindStatus!==t){this.bindStatus=t;var n=t?ao:wc;n(window,"popstate",this.onPopstate)}}}},j2={transitionAppear:Boolean,value:Boolean,overlay:Boolean,overlayStyle:Object,overlayClass:String,closeOnClickOverlay:Boolean,zIndex:[Number,String],lockScroll:{type:Boolean,default:!0},lazyRender:{type:Boolean,default:!0}};function q2(r){return r===void 0&&(r={}),{mixins:[To,UW,zS({afterPortal:function(){this.overlay&&i6()}})],provide:function(){return{vanPopup:this}},props:j2,data:function(){return this.onReopenCallback=[],{inited:this.value}},computed:{shouldRender:function(){return this.inited||!this.lazyRender}},watch:{value:function(n){var i=n?"open":"close";this.inited=this.inited||this.value,this[i](),r.skipToggleEvent||this.$emit(i)},overlay:"renderOverlay"},mounted:function(){this.value&&this.open()},activated:function(){this.shouldReopen&&(this.$emit("input",!0),this.shouldReopen=!1)},beforeDestroy:function(){OW(this),this.opened&&this.removeLock(),this.getContainer&&PS(this.$el)},deactivated:function(){this.value&&(this.close(),this.shouldReopen=!0)},methods:{open:function(){this.$isServer||this.opened||(this.zIndex!==void 0&&(ci.zIndex=this.zIndex),this.opened=!0,this.renderOverlay(),this.addLock(),this.onReopenCallback.forEach(function(n){n()}))},addLock:function(){this.lockScroll&&(ao(document,"touchstart",this.touchStart),ao(document,"touchmove",this.onTouchMove),ci.lockCount||document.body.classList.add("van-overflow-hidden"),ci.lockCount++)},removeLock:function(){this.lockScroll&&ci.lockCount&&(ci.lockCount--,wc(document,"touchstart",this.touchStart),wc(document,"touchmove",this.onTouchMove),ci.lockCount||document.body.classList.remove("van-overflow-hidden"))},close:function(){this.opened&&(Qk(this),this.opened=!1,this.removeLock(),this.$emit("input",!1))},onTouchMove:function(n){this.touchMove(n);var i=this.deltaY>0?"10":"01",o=ph(n.target,this.$el),a=o.scrollHeight,l=o.offsetHeight,c=o.scrollTop,u="11";c===0?u=l>=a?"00":"01":c+l>=a&&(u="10"),u!=="11"&&this.direction==="vertical"&&!(parseInt(u,2)&parseInt(i,2))&&wr(n,!0)},renderOverlay:function(){var n=this;this.$isServer||!this.value||this.$nextTick(function(){n.updateZIndex(n.overlay?1:0),n.overlay?RW(n,{zIndex:ci.zIndex++,duration:n.duration,className:n.overlayClass,customStyle:n.overlayStyle}):Qk(n)})},updateZIndex:function(n){n===void 0&&(n=0),this.$el.style.zIndex=++ci.zIndex+n},onReopen:function(n){this.onReopenCallback.push(n)}}}}var o6=Ht("info"),WW=o6[0],GW=o6[1];function a6(r,t,n,i){var o=t.dot,a=t.info,l=gn(a)&&a!=="";if(!(!o&&!l))return r("div",mn([{class:GW({dot:o})},Xn(i,!0)]),[o?"":t.info])}a6.props={dot:Boolean,info:[Number,String]};const gh=WW(a6);var l6=Ht("icon"),HW=l6[0],c6=l6[1];function jW(r){return r?r.indexOf("/")!==-1:!1}var qW={medel:"medal","medel-o":"medal-o","calender-o":"calendar-o"};function KW(r){return r&&qW[r]||r}function u6(r,t,n,i){var o,a=KW(t.name),l=jW(a);return r(t.tag,mn([{class:[t.classPrefix,l?"":t.classPrefix+"-"+a],style:{color:t.color,fontSize:kn(t.size)}},Xn(i,!0)]),[n.default&&n.default(),l&&r("img",{class:c6("image"),attrs:{src:a}}),r(gh,{attrs:{dot:t.dot,info:(o=t.badge)!=null?o:t.info}})])}u6.props={dot:Boolean,name:String,size:[Number,String],info:[Number,String],badge:[Number,String],color:String,tag:{type:String,default:"i"},classPrefix:{type:String,default:c6()}};const cn=HW(u6);var h6=Ht("popup"),XW=h6[0],t$=h6[1];const Va=XW({mixins:[q2()],props:{round:Boolean,duration:[Number,String],closeable:Boolean,transition:String,safeAreaInsetBottom:Boolean,closeIcon:{type:String,default:"cross"},closeIconPosition:{type:String,default:"top-right"},position:{type:String,default:"center"},overlay:{type:Boolean,default:!0},closeOnClickOverlay:{type:Boolean,default:!0}},beforeCreate:function(){var t=this,n=function(o){return function(a){return t.$emit(o,a)}};this.onClick=n("click"),this.onOpened=n("opened"),this.onClosed=n("closed")},methods:{onClickCloseIcon:function(t){this.$emit("click-close-icon",t),this.close()}},render:function(){var t,n=arguments[0];if(this.shouldRender){var i=this.round,o=this.position,a=this.duration,l=o==="center",c=this.transition||(l?"van-fade":"van-popup-slide-"+o),u={};if(gn(a)){var h=l?"animationDuration":"transitionDuration";u[h]=a+"s"}return n("transition",{attrs:{appear:this.transitionAppear,name:c},on:{afterEnter:this.onOpened,afterLeave:this.onClosed}},[n("div",{directives:[{name:"show",value:this.value}],style:u,class:t$((t={round:i},t[o]=o,t["safe-area-inset-bottom"]=this.safeAreaInsetBottom,t)),on:{click:this.onClick}},[this.slots(),this.closeable&&n(cn,{attrs:{role:"button",tabindex:"0",name:this.closeIcon},class:t$("close-icon",this.closeIconPosition),on:{click:this.onClickCloseIcon}})])])}}});var d6=Ht("loading"),YW=d6[0],K1=d6[1];function ZW(r,t){if(t.type==="spinner"){for(var n=[],i=0;i<12;i++)n.push(r("i"));return n}return r("svg",{class:K1("circular"),attrs:{viewBox:"25 25 50 50"}},[r("circle",{attrs:{cx:"50",cy:"50",r:"20",fill:"none"}})])}function JW(r,t,n){if(n.default){var i,o={fontSize:kn(t.textSize),color:(i=t.textColor)!=null?i:t.color};return r("span",{class:K1("text"),style:o},[n.default()])}}function f6(r,t,n,i){var o=t.color,a=t.size,l=t.type,c={color:o};if(a){var u=kn(a);c.width=u,c.height=u}return r("div",mn([{class:K1([l,{vertical:t.vertical}])},Xn(i,!0)]),[r("span",{class:K1("spinner",l),style:c},[ZW(r,t)]),JW(r,t,n)])}f6.props={color:String,size:[Number,String],vertical:Boolean,textSize:[Number,String],textColor:String,type:{type:String,default:"circular"}};const ia=YW(f6);var p6=Ht("action-sheet"),QW=p6[0],No=p6[1];function m6(r,t,n,i){var o=t.title,a=t.cancelText,l=t.closeable;function c(){bn(i,"input",!1),bn(i,"cancel")}function u(){if(o)return r("div",{class:No("header")},[o,l&&r(cn,{attrs:{name:t.closeIcon},class:No("close"),on:{click:c}})])}function h(p,m){var g=p.disabled,y=p.loading,v=p.callback;function x(w){w.stopPropagation(),!(g||y)&&(v&&v(p),t.closeOnClickAction&&bn(i,"input",!1),dn.nextTick(function(){bn(i,"select",p,m)}))}function b(){return y?r(ia,{class:No("loading-icon")}):[r("span",{class:No("name")},[p.name]),p.subname&&r("div",{class:No("subname")},[p.subname])]}return r("button",{attrs:{type:"button"},class:[No("item",{disabled:g,loading:y}),p.className],style:{color:p.color},on:{click:x}},[b()])}function d(){if(a)return[r("div",{class:No("gap")}),r("button",{attrs:{type:"button"},class:No("cancel"),on:{click:c}},[a])]}function f(){var p=(n.description==null?void 0:n.description())||t.description;if(p)return r("div",{class:No("description")},[p])}return r(Va,mn([{class:No(),attrs:{position:"bottom",round:t.round,value:t.value,overlay:t.overlay,duration:t.duration,lazyRender:t.lazyRender,lockScroll:t.lockScroll,getContainer:t.getContainer,closeOnPopstate:t.closeOnPopstate,closeOnClickOverlay:t.closeOnClickOverlay,safeAreaInsetBottom:t.safeAreaInsetBottom}},Xn(i,!0)]),[u(),f(),r("div",{class:No("content")},[t.actions&&t.actions.map(h),n.default==null?void 0:n.default()]),d()])}m6.props=re({},j2,{title:String,actions:Array,duration:[Number,String],cancelText:String,description:String,getContainer:[String,Function],closeOnPopstate:Boolean,closeOnClickAction:Boolean,round:{type:Boolean,default:!0},closeable:{type:Boolean,default:!0},closeIcon:{type:String,default:"cross"},safeAreaInsetBottom:{type:Boolean,default:!0},overlay:{type:Boolean,default:!0},closeOnClickOverlay:{type:Boolean,default:!0}});const tG=QW(m6);function g6(r){return r=r.replace(/[^-|\d]/g,""),/^((\+86)|(86))?(1)\d{10}$/.test(r)||/^0[0-9-]{10,13}$/.test(r)}var eG=44,K2={title:String,loading:Boolean,readonly:Boolean,itemHeight:[Number,String],showToolbar:Boolean,cancelButtonText:String,confirmButtonText:String,allowHtml:{type:Boolean,default:!0},visibleItemCount:{type:[Number,String],default:6},swipeDuration:{type:[Number,String],default:1e3}},v6="#ee0a24",Ho="van-hairline",VS=Ho+"--top",y6=Ho+"--left",_m=Ho+"--bottom",x6=Ho+"--surround",X2=Ho+"--top-bottom",nG=Ho+"-unset--top-bottom";function Hp(r){if(!gn(r))return r;if(Array.isArray(r))return r.map(function(n){return Hp(n)});if(typeof r=="object"){var t={};return Object.keys(r).forEach(function(n){t[n]=Hp(r[n])}),t}return r}function Dr(r,t,n){return Math.min(Math.max(r,t),n)}function e$(r,t,n){var i=r.indexOf(t),o="";return i===-1?r:t==="-"&&i!==0?r.slice(0,i):(t==="."&&r.match(/^(\.|-\.)/)&&(o=i?"-0":"0"),o+r.slice(0,i+1)+r.slice(i).replace(n,""))}function b6(r,t,n){t===void 0&&(t=!0),n===void 0&&(n=!0),t?r=e$(r,".",/\./g):r=r.split(".")[0],n?r=e$(r,"-",/-/g):r=r.replace(/-/,"");var i=t?/[^-0-9.]/g:/[^-0-9]/g;return r.replace(i,"")}function w6(r,t){var n=Math.pow(10,10);return Math.round((r+t)*n)/n}var n$=200,dx=300,sG=15,S6=Ht("picker-column"),rG=S6[0],fx=S6[1];function s$(r){var t=window.getComputedStyle(r),n=t.transform||t.webkitTransform,i=n.slice(7,n.length-1).split(", ")[5];return Number(i)}function px(r){return sa(r)&&r.disabled}var r$=G2&&"onwheel"in window,mx=null;const iG=rG({mixins:[To],props:{valueKey:String,readonly:Boolean,allowHtml:Boolean,className:String,itemHeight:Number,defaultIndex:Number,swipeDuration:[Number,String],visibleItemCount:[Number,String],initialOptions:{type:Array,default:function(){return[]}}},data:function(){return{offset:0,duration:0,options:Hp(this.initialOptions),currentIndex:this.defaultIndex}},created:function(){this.$parent.children&&this.$parent.children.push(this),this.setIndex(this.currentIndex)},mounted:function(){this.bindTouchEvent(this.$el),r$&&ao(this.$el,"wheel",this.onMouseWheel,!1)},destroyed:function(){var t=this.$parent.children;t&&t.splice(t.indexOf(this),1),r$&&wc(this.$el,"wheel")},watch:{initialOptions:"setOptions",defaultIndex:function(t){this.setIndex(t)}},computed:{count:function(){return this.options.length},baseOffset:function(){return this.itemHeight*(this.visibleItemCount-1)/2}},methods:{setOptions:function(t){JSON.stringify(t)!==JSON.stringify(this.options)&&(this.options=Hp(t),this.setIndex(this.defaultIndex))},onTouchStart:function(t){if(!this.readonly){if(this.touchStart(t),this.moving){var n=s$(this.$refs.wrapper);this.offset=Math.min(0,n-this.baseOffset),this.startOffset=this.offset}else this.startOffset=this.offset;this.duration=0,this.transitionEndTrigger=null,this.touchStartTime=Date.now(),this.momentumOffset=this.startOffset}},onTouchMove:function(t){if(!this.readonly){this.touchMove(t),this.direction==="vertical"&&(this.moving=!0,wr(t,!0)),this.offset=Dr(this.startOffset+this.deltaY,-(this.count*this.itemHeight),this.itemHeight);var n=Date.now();n-this.touchStartTime>dx&&(this.touchStartTime=n,this.momentumOffset=this.offset)}},onTouchEnd:function(){var t=this;if(!this.readonly){var n=this.offset-this.momentumOffset,i=Date.now()-this.touchStartTime,o=i<dx&&Math.abs(n)>sG;if(o){this.momentum(n,i);return}var a=this.getIndexByOffset(this.offset);this.duration=n$,this.setIndex(a,!0),setTimeout(function(){t.moving=!1},0)}},onMouseWheel:function(t){var n=this;if(!this.readonly){wr(t,!0);var i=s$(this.$refs.wrapper);this.startOffset=Math.min(0,i-this.baseOffset),this.momentumOffset=this.startOffset,this.transitionEndTrigger=null;var o=t.deltaY;if(!(this.startOffset===0&&o<0)){var a=-o;this.offset=Dr(this.startOffset+a,-(this.count*this.itemHeight),this.itemHeight),mx&&clearTimeout(mx),mx=setTimeout(function(){n.onTouchEnd(),n.touchStartTime=0},dx)}}},onTransitionEnd:function(){this.stopMomentum()},onClickItem:function(t){this.moving||this.readonly||(this.transitionEndTrigger=null,this.duration=n$,this.setIndex(t,!0))},adjustIndex:function(t){t=Dr(t,0,this.count);for(var n=t;n<this.count;n++)if(!px(this.options[n]))return n;for(var i=t-1;i>=0;i--)if(!px(this.options[i]))return i},getOptionText:function(t){return sa(t)&&this.valueKey in t?t[this.valueKey]:t},setIndex:function(t,n){var i=this;t=this.adjustIndex(t)||0;var o=-t*this.itemHeight,a=function(){t!==i.currentIndex&&(i.currentIndex=t,n&&i.$emit("change",t))};this.moving&&o!==this.offset?this.transitionEndTrigger=a:a(),this.offset=o},setValue:function(t){for(var n=this.options,i=0;i<n.length;i++)if(this.getOptionText(n[i])===t)return this.setIndex(i)},getValue:function(){return this.options[this.currentIndex]},getIndexByOffset:function(t){return Dr(Math.round(-t/this.itemHeight),0,this.count-1)},momentum:function(t,n){var i=Math.abs(t/n);t=this.offset+i/.003*(t<0?-1:1);var o=this.getIndexByOffset(t);this.duration=+this.swipeDuration,this.setIndex(o,!0)},stopMomentum:function(){this.moving=!1,this.duration=0,this.transitionEndTrigger&&(this.transitionEndTrigger(),this.transitionEndTrigger=null)},genOptions:function(){var t=this,n=this.$createElement,i={height:this.itemHeight+"px"};return this.options.map(function(o,a){var l,c=t.getOptionText(o),u=px(o),h={style:i,attrs:{role:"button",tabindex:u?-1:0},class:[fx("item",{disabled:u,selected:a===t.currentIndex})],on:{click:function(){t.onClickItem(a)}}},d={class:"van-ellipsis",domProps:(l={},l[t.allowHtml?"innerHTML":"textContent"]=c,l)};return n("li",mn([{},h]),[t.slots("option",o)||n("div",mn([{},d]))])})}},render:function(){var t=arguments[0],n={transform:"translate3d(0, "+(this.offset+this.baseOffset)+"px, 0)",transitionDuration:this.duration+"ms",transitionProperty:this.duration?"all":"none"};return t("div",{class:[fx(),this.className]},[t("ul",{ref:"wrapper",style:n,class:fx("wrapper"),on:{transitionend:this.onTransitionEnd}},[this.genOptions()])])}});var US=Ht("picker"),oG=US[0],Ha=US[1],i$=US[2];const WS=oG({props:re({},K2,{defaultIndex:{type:[Number,String],default:0},columns:{type:Array,default:function(){return[]}},toolbarPosition:{type:String,default:"top"},valueKey:{type:String,default:"text"}}),data:function(){return{children:[],formattedColumns:[]}},computed:{itemPxHeight:function(){return this.itemHeight?FS(this.itemHeight):eG},dataType:function(){var t=this.columns,n=t[0]||{};return n.children?"cascade":n.values?"object":"text"}},watch:{columns:{handler:"format",immediate:!0}},methods:{format:function(){var t=this.columns,n=this.dataType;n==="text"?this.formattedColumns=[{values:t}]:n==="cascade"?this.formatCascade():this.formattedColumns=t},formatCascade:function(){for(var t=[],n={children:this.columns};n&&n.children;){for(var i,o=n,a=o.children,l=(i=n.defaultIndex)!=null?i:+this.defaultIndex;a[l]&&a[l].disabled;)if(l<a.length-1)l++;else{l=0;break}t.push({values:n.children,className:n.className,defaultIndex:l}),n=a[l]}this.formattedColumns=t},emit:function(t){var n=this;if(this.dataType==="text")this.$emit(t,this.getColumnValue(0),this.getColumnIndex(0));else{var i=this.getValues();this.dataType==="cascade"&&(i=i.map(function(o){return o[n.valueKey]})),this.$emit(t,i,this.getIndexes())}},onCascadeChange:function(t){for(var n={children:this.columns},i=this.getIndexes(),o=0;o<=t;o++)n=n.children[i[o]];for(;n&&n.children;)t++,this.setColumnValues(t,n.children),n=n.children[n.defaultIndex||0]},onChange:function(t){var n=this;if(this.dataType==="cascade"&&this.onCascadeChange(t),this.dataType==="text")this.$emit("change",this,this.getColumnValue(0),this.getColumnIndex(0));else{var i=this.getValues();this.dataType==="cascade"&&(i=i.map(function(o){return o[n.valueKey]})),this.$emit("change",this,i,t)}},getColumn:function(t){return this.children[t]},getColumnValue:function(t){var n=this.getColumn(t);return n&&n.getValue()},setColumnValue:function(t,n){var i=this.getColumn(t);i&&(i.setValue(n),this.dataType==="cascade"&&this.onCascadeChange(t))},getColumnIndex:function(t){return(this.getColumn(t)||{}).currentIndex},setColumnIndex:function(t,n){var i=this.getColumn(t);i&&(i.setIndex(n),this.dataType==="cascade"&&this.onCascadeChange(t))},getColumnValues:function(t){return(this.children[t]||{}).options},setColumnValues:function(t,n){var i=this.children[t];i&&i.setOptions(n)},getValues:function(){return this.children.map(function(t){return t.getValue()})},setValues:function(t){var n=this;t.forEach(function(i,o){n.setColumnValue(o,i)})},getIndexes:function(){return this.children.map(function(t){return t.currentIndex})},setIndexes:function(t){var n=this;t.forEach(function(i,o){n.setColumnIndex(o,i)})},confirm:function(){this.children.forEach(function(t){return t.stopMomentum()}),this.emit("confirm")},cancel:function(){this.emit("cancel")},genTitle:function(){var t=this.$createElement,n=this.slots("title");if(n)return n;if(this.title)return t("div",{class:["van-ellipsis",Ha("title")]},[this.title])},genCancel:function(){var t=this.$createElement;return t("button",{attrs:{type:"button"},class:Ha("cancel"),on:{click:this.cancel}},[this.slots("cancel")||this.cancelButtonText||i$("cancel")])},genConfirm:function(){var t=this.$createElement;return t("button",{attrs:{type:"button"},class:Ha("confirm"),on:{click:this.confirm}},[this.slots("confirm")||this.confirmButtonText||i$("confirm")])},genToolbar:function(){var t=this.$createElement;if(this.showToolbar)return t("div",{class:Ha("toolbar")},[this.slots()||[this.genCancel(),this.genTitle(),this.genConfirm()]])},genColumns:function(){var t=this.$createElement,n=this.itemPxHeight,i=n*this.visibleItemCount,o={height:n+"px"},a={height:i+"px"},l={backgroundSize:"100% "+(i-n)/2+"px"};return t("div",{class:Ha("columns"),style:a,on:{touchmove:wr}},[this.genColumnItems(),t("div",{class:Ha("mask"),style:l}),t("div",{class:[nG,Ha("frame")],style:o})])},genColumnItems:function(){var t=this,n=this.$createElement;return this.formattedColumns.map(function(i,o){var a;return n(iG,{attrs:{readonly:t.readonly,valueKey:t.valueKey,allowHtml:t.allowHtml,className:i.className,itemHeight:t.itemPxHeight,defaultIndex:(a=i.defaultIndex)!=null?a:+t.defaultIndex,swipeDuration:t.swipeDuration,visibleItemCount:t.visibleItemCount,initialOptions:i.values},scopedSlots:{option:t.$scopedSlots.option},on:{change:function(){t.onChange(o)}}})})}},render:function(t){return t("div",{class:Ha()},[this.toolbarPosition==="top"?this.genToolbar():t(),this.loading?t(ia,{class:Ha("loading")}):t(),this.slots("columns-top"),this.genColumns(),this.slots("columns-bottom"),this.toolbarPosition==="bottom"?this.genToolbar():t()])}});var _6=Ht("area"),aG=_6[0],lG=_6[1],gx="000000";function cG(r){return r[0]==="9"}function uG(r,t){var n=r.$slots,i=r.$scopedSlots,o={};return t.forEach(function(a){i[a]?o[a]=i[a]:n[a]&&(o[a]=function(){return n[a]})}),o}const T6=aG({props:re({},K2,{value:String,areaList:{type:Object,default:function(){return{}}},columnsNum:{type:[Number,String],default:3},isOverseaCode:{type:Function,default:cG},columnsPlaceholder:{type:Array,default:function(){return[]}}}),data:function(){return{code:this.value,columns:[{values:[]},{values:[]},{values:[]}]}},computed:{province:function(){return this.areaList.province_list||{}},city:function(){return this.areaList.city_list||{}},county:function(){return this.areaList.county_list||{}},displayColumns:function(){return this.columns.slice(0,+this.columnsNum)},placeholderMap:function(){return{province:this.columnsPlaceholder[0]||"",city:this.columnsPlaceholder[1]||"",county:this.columnsPlaceholder[2]||""}}},watch:{value:function(t){this.code=t,this.setValues()},areaList:{deep:!0,handler:"setValues"},columnsNum:function(){var t=this;this.$nextTick(function(){t.setValues()})}},mounted:function(){this.setValues()},methods:{getList:function(t,n){var i=[];if(t!=="province"&&!n)return i;var o=this[t];if(i=Object.keys(o).map(function(l){return{code:l,name:o[l]}}),n&&(this.isOverseaCode(n)&&t==="city"&&(n="9"),i=i.filter(function(l){return l.code.indexOf(n)===0})),this.placeholderMap[t]&&i.length){var a="";t==="city"?a=gx.slice(2,4):t==="county"&&(a=gx.slice(4,6)),i.unshift({code:""+n+a,name:this.placeholderMap[t]})}return i},getIndex:function(t,n){var i=t==="province"?2:t==="city"?4:6,o=this.getList(t,n.slice(0,i-2));this.isOverseaCode(n)&&t==="province"&&(i=1),n=n.slice(0,i);for(var a=0;a<o.length;a++)if(o[a].code.slice(0,i)===n)return a;return 0},parseOutputValues:function(t){var n=this;return t.map(function(i,o){return i&&(i=JSON.parse(JSON.stringify(i)),(!i.code||i.name===n.columnsPlaceholder[o])&&(i.code="",i.name=""),i)})},onChange:function(t,n,i){this.code=n[i].code,this.setValues();var o=this.parseOutputValues(t.getValues());this.$emit("change",t,o,i)},onConfirm:function(t,n){t=this.parseOutputValues(t),this.setValues(),this.$emit("confirm",t,n)},getDefaultCode:function(){if(this.columnsPlaceholder.length)return gx;var t=Object.keys(this.county);if(t[0])return t[0];var n=Object.keys(this.city);return n[0]?n[0]:""},setValues:function(){var t=this.code;t||(t=this.getDefaultCode());var n=this.$refs.picker,i=this.getList("province"),o=this.getList("city",t.slice(0,2));n&&(n.setColumnValues(0,i),n.setColumnValues(1,o),o.length&&t.slice(2,4)==="00"&&!this.isOverseaCode(t)&&(t=o[0].code),n.setColumnValues(2,this.getList("county",t.slice(0,4))),n.setIndexes([this.getIndex("province",t),this.getIndex("city",t),this.getIndex("county",t)]))},getValues:function(){var t=this.$refs.picker,n=t?t.getValues().filter(function(i){return!!i}):[];return n=this.parseOutputValues(n),n},getArea:function(){var t=this.getValues(),n={code:"",country:"",province:"",city:"",county:""};if(!t.length)return n;var i=t.map(function(a){return a.name}),o=t.filter(function(a){return!!a.code});return n.code=o.length?o[o.length-1].code:"",this.isOverseaCode(n.code)?(n.country=i[1]||"",n.province=i[2]||""):(n.province=i[0]||"",n.city=i[1]||"",n.county=i[2]||""),n},reset:function(t){this.code=t||"",this.setValues()}},render:function(){var t=arguments[0],n=re({},this.$listeners,{change:this.onChange,confirm:this.onConfirm});return t(WS,{ref:"picker",class:lG(),attrs:{showToolbar:!0,valueKey:"name",title:this.title,columns:this.displayColumns,loading:this.loading,readonly:this.readonly,itemHeight:this.itemHeight,swipeDuration:this.swipeDuration,visibleItemCount:this.visibleItemCount,cancelButtonText:this.cancelButtonText,confirmButtonText:this.confirmButtonText},scopedSlots:uG(this,["title","columns-top","columns-bottom"]),on:re({},n)})}});function hG(r){return r.name==="NavigationDuplicated"||r.message&&r.message.indexOf("redundant navigation")!==-1}function vh(r,t){var n=t.to,i=t.url,o=t.replace;if(n&&r){var a=r[o?"replace":"push"](n);a&&a.catch&&a.catch(function(l){if(l&&!hG(l))throw l})}else i&&(o?location.replace(i):location.href=i)}function C6(r){vh(r.parent&&r.parent.$router,r.props)}var Rc={url:String,replace:Boolean,to:[String,Object]},GS={icon:String,size:String,center:Boolean,isLink:Boolean,required:Boolean,iconPrefix:String,titleStyle:null,titleClass:null,valueClass:null,labelClass:null,title:[Number,String],value:[Number,String],label:[Number,String],arrowDirection:String,border:{type:Boolean,default:!0},clickable:{type:Boolean,default:null}},k6=Ht("cell"),dG=k6[0],Dh=k6[1];function $6(r,t,n,i){var o,a=t.icon,l=t.size,c=t.title,u=t.label,h=t.value,d=t.isLink,f=n.title||gn(c);function p(){var S=n.label||gn(u);if(S)return r("div",{class:[Dh("label"),t.labelClass]},[n.label?n.label():u])}function m(){if(f)return r("div",{class:[Dh("title"),t.titleClass],style:t.titleStyle},[n.title?n.title():r("span",[c]),p()])}function g(){var S=n.default||gn(h);if(S)return r("div",{class:[Dh("value",{alone:!f}),t.valueClass]},[n.default?n.default():r("span",[h])])}function y(){if(n.icon)return n.icon();if(a)return r(cn,{class:Dh("left-icon"),attrs:{name:a,classPrefix:t.iconPrefix}})}function v(){var S=n["right-icon"];if(S)return S();if(d){var _=t.arrowDirection;return r(cn,{class:Dh("right-icon"),attrs:{name:_?"arrow-"+_:"arrow"}})}}function x(S){bn(i,"click",S),C6(i)}var b=(o=t.clickable)!=null?o:d,w={clickable:b,center:t.center,required:t.required,borderless:!t.border};return l&&(w[l]=l),r("div",mn([{class:Dh(w),attrs:{role:b?"button":null,tabindex:b?0:null},on:{click:x}},Xn(i)]),[y(),m(),g(),v(),n.extra==null?void 0:n.extra()])}$6.props=re({},GS,Rc);const ei=dG($6);function fG(){return _o?!1:/android/.test(navigator.userAgent.toLowerCase())}function pG(){return _o?!1:/ios|iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase())}var mG=pG();function I6(){mG&&H2(Sm())}var E6=Ht("field"),gG=E6[0],ki=E6[1];const lo=gG({inheritAttrs:!1,provide:function(){return{vanField:this}},inject:{vanForm:{default:null}},props:re({},GS,{name:String,rules:Array,disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null},autosize:[Boolean,Object],leftIcon:String,rightIcon:String,clearable:Boolean,formatter:Function,maxlength:[Number,String],labelWidth:[Number,String],labelClass:null,labelAlign:String,inputAlign:String,placeholder:String,errorMessage:String,errorMessageAlign:String,showWordLimit:Boolean,value:{type:[Number,String],default:""},type:{type:String,default:"text"},error:{type:Boolean,default:null},colon:{type:Boolean,default:null},clearTrigger:{type:String,default:"focus"},formatTrigger:{type:String,default:"onChange"}}),data:function(){return{focused:!1,validateFailed:!1,validateMessage:""}},watch:{value:function(){this.updateValue(this.value),this.resetValidation(),this.validateWithTrigger("onChange"),this.$nextTick(this.adjustSize)}},mounted:function(){this.updateValue(this.value,this.formatTrigger),this.$nextTick(this.adjustSize),this.vanForm&&this.vanForm.addField(this)},beforeDestroy:function(){this.vanForm&&this.vanForm.removeField(this)},computed:{showClear:function(){var t=this.getProp("readonly");if(this.clearable&&!t){var n=gn(this.value)&&this.value!=="",i=this.clearTrigger==="always"||this.clearTrigger==="focus"&&this.focused;return n&&i}},showError:function(){if(this.error!==null)return this.error;if(this.vanForm&&this.vanForm.showError&&this.validateFailed)return!0},listeners:function(){return re({},this.$listeners,{blur:this.onBlur,focus:this.onFocus,input:this.onInput,click:this.onClickInput,keypress:this.onKeypress})},labelStyle:function(){var t=this.getProp("labelWidth");if(t)return{width:kn(t)}},formValue:function(){return this.children&&(this.$scopedSlots.input||this.$slots.input)?this.children.value:this.value}},methods:{focus:function(){this.$refs.input&&this.$refs.input.focus()},blur:function(){this.$refs.input&&this.$refs.input.blur()},runValidator:function(t,n){return new Promise(function(i){var o=n.validator(t,n);if(j1(o))return o.then(i);i(o)})},isEmptyValue:function(t){return Array.isArray(t)?!t.length:t===0?!1:!t},runSyncRule:function(t,n){return!(n.required&&this.isEmptyValue(t)||n.pattern&&!n.pattern.test(t))},getRuleMessage:function(t,n){var i=n.message;return Ad(i)?i(t,n):i},runRules:function(t){var n=this;return t.reduce(function(i,o){return i.then(function(){if(!n.validateFailed){var a=n.formValue;if(o.formatter&&(a=o.formatter(a,o)),!n.runSyncRule(a,o)){n.validateFailed=!0,n.validateMessage=n.getRuleMessage(a,o);return}if(o.validator)return n.runValidator(a,o).then(function(l){l===!1&&(n.validateFailed=!0,n.validateMessage=n.getRuleMessage(a,o))})}})},Promise.resolve())},validate:function(t){var n=this;return t===void 0&&(t=this.rules),new Promise(function(i){t||i(),n.resetValidation(),n.runRules(t).then(function(){n.validateFailed?i({name:n.name,message:n.validateMessage}):i()})})},validateWithTrigger:function(t){if(this.vanForm&&this.rules){var n=this.vanForm.validateTrigger===t,i=this.rules.filter(function(o){return o.trigger?o.trigger===t:n});i.length&&this.validate(i)}},resetValidation:function(){this.validateFailed&&(this.validateFailed=!1,this.validateMessage="")},updateValue:function(t,n){n===void 0&&(n="onChange"),t=gn(t)?String(t):"";var i=this.maxlength;if(gn(i)&&t.length>i&&(this.value&&this.value.length===+i?t=this.value:t=t.slice(0,i)),this.type==="number"||this.type==="digit"){var o=this.type==="number";t=b6(t,o,o)}this.formatter&&n===this.formatTrigger&&(t=this.formatter(t));var a=this.$refs.input;a&&t!==a.value&&(a.value=t),t!==this.value&&this.$emit("input",t)},onInput:function(t){t.target.composing||this.updateValue(t.target.value)},onFocus:function(t){this.focused=!0,this.$emit("focus",t),this.$nextTick(this.adjustSize),this.getProp("readonly")&&this.blur()},onBlur:function(t){this.getProp("readonly")||(this.focused=!1,this.updateValue(this.value,"onBlur"),this.$emit("blur",t),this.validateWithTrigger("onBlur"),this.$nextTick(this.adjustSize),I6())},onClick:function(t){this.$emit("click",t)},onClickInput:function(t){this.$emit("click-input",t)},onClickLeftIcon:function(t){this.$emit("click-left-icon",t)},onClickRightIcon:function(t){this.$emit("click-right-icon",t)},onClear:function(t){wr(t),this.$emit("input",""),this.$emit("clear",t)},onKeypress:function(t){var n=13;if(t.keyCode===n){var i=this.getProp("submitOnEnter");!i&&this.type!=="textarea"&&wr(t),this.type==="search"&&this.blur()}this.$emit("keypress",t)},adjustSize:function(){var t=this.$refs.input;if(!(!(this.type==="textarea"&&this.autosize)||!t)){var n=Sm();t.style.height="auto";var i=t.scrollHeight;if(sa(this.autosize)){var o=this.autosize,a=o.maxHeight,l=o.minHeight;a&&(i=Math.min(i,a)),l&&(i=Math.max(i,l))}i&&(t.style.height=i+"px",H2(n))}},genInput:function(){var t=this.$createElement,n=this.type,i=this.getProp("disabled"),o=this.getProp("readonly"),a=this.slots("input"),l=this.getProp("inputAlign");if(a)return t("div",{class:ki("control",[l,"custom"]),on:{click:this.onClickInput}},[a]);var c={ref:"input",class:ki("control",l),domProps:{value:this.value},attrs:re({},this.$attrs,{name:this.name,disabled:i,readonly:o,placeholder:this.placeholder}),on:this.listeners,directives:[{name:"model",value:this.value}]};if(n==="textarea")return t("textarea",mn([{},c]));var u=n,h;return n==="number"&&(u="text",h="decimal"),n==="digit"&&(u="tel",h="numeric"),t("input",mn([{attrs:{type:u,inputmode:h}},c]))},genLeftIcon:function(){var t=this.$createElement,n=this.slots("left-icon")||this.leftIcon;if(n)return t("div",{class:ki("left-icon"),on:{click:this.onClickLeftIcon}},[this.slots("left-icon")||t(cn,{attrs:{name:this.leftIcon,classPrefix:this.iconPrefix}})])},genRightIcon:function(){var t=this.$createElement,n=this.slots,i=n("right-icon")||this.rightIcon;if(i)return t("div",{class:ki("right-icon"),on:{click:this.onClickRightIcon}},[n("right-icon")||t(cn,{attrs:{name:this.rightIcon,classPrefix:this.iconPrefix}})])},genWordLimit:function(){var t=this.$createElement;if(this.showWordLimit&&this.maxlength){var n=(this.value||"").length;return t("div",{class:ki("word-limit")},[t("span",{class:ki("word-num")},[n]),"/",this.maxlength])}},genMessage:function(){var t=this.$createElement;if(!(this.vanForm&&this.vanForm.showErrorMessage===!1)){var n=this.errorMessage||this.validateMessage;if(n){var i=this.getProp("errorMessageAlign");return t("div",{class:ki("error-message",i)},[n])}}},getProp:function(t){if(gn(this[t]))return this[t];if(this.vanForm&&gn(this.vanForm[t]))return this.vanForm[t]},genLabel:function(){var t=this.$createElement,n=this.getProp("colon")?":":"";if(this.slots("label"))return[this.slots("label"),n];if(this.label)return t("span",[this.label+n])}},render:function(){var t,n=arguments[0],i=this.slots,o=this.getProp("disabled"),a=this.getProp("labelAlign"),l={icon:this.genLeftIcon},c=this.genLabel();c&&(l.title=function(){return c});var u=this.slots("extra");return u&&(l.extra=function(){return u}),n(ei,{attrs:{icon:this.leftIcon,size:this.size,center:this.center,border:this.border,isLink:this.isLink,required:this.required,clickable:this.clickable,titleStyle:this.labelStyle,valueClass:ki("value"),titleClass:[ki("label",a),this.labelClass],arrowDirection:this.arrowDirection},scopedSlots:l,class:ki((t={error:this.showError,disabled:o},t["label-"+a]=a,t["min-height"]=this.type==="textarea"&&!this.autosize,t)),on:{click:this.onClick}},[n("div",{class:ki("body")},[this.genInput(),this.showClear&&n(cn,{attrs:{name:"clear"},class:ki("clear"),on:{touchstart:this.onClear}}),this.genRightIcon(),i("button")&&n("div",{class:ki("button")},[i("button")])]),this.genWordLimit(),this.genMessage()])}});var h0=0;function vG(r){r?(h0||document.body.classList.add("van-toast--unclickable"),h0++):(h0--,h0||document.body.classList.remove("van-toast--unclickable"))}var N6=Ht("toast"),yG=N6[0],jf=N6[1];const A6=yG({mixins:[q2()],props:{icon:String,className:null,iconPrefix:String,loadingType:String,forbidClick:Boolean,closeOnClick:Boolean,message:[Number,String],type:{type:String,default:"text"},position:{type:String,default:"middle"},transition:{type:String,default:"van-fade"},lockScroll:{type:Boolean,default:!1}},data:function(){return{clickable:!1}},mounted:function(){this.toggleClickable()},destroyed:function(){this.toggleClickable()},watch:{value:"toggleClickable",forbidClick:"toggleClickable"},methods:{onClick:function(){this.closeOnClick&&this.close()},toggleClickable:function(){var t=this.value&&this.forbidClick;this.clickable!==t&&(this.clickable=t,vG(t))},onAfterEnter:function(){this.$emit("opened"),this.onOpened&&this.onOpened()},onAfterLeave:function(){this.$emit("closed")},genIcon:function(){var t=this.$createElement,n=this.icon,i=this.type,o=this.iconPrefix,a=this.loadingType,l=n||i==="success"||i==="fail";if(l)return t(cn,{class:jf("icon"),attrs:{classPrefix:o,name:n||i}});if(i==="loading")return t(ia,{class:jf("loading"),attrs:{type:a}})},genMessage:function(){var t=this.$createElement,n=this.type,i=this.message;if(!(!gn(i)||i===""))return n==="html"?t("div",{class:jf("text"),domProps:{innerHTML:i}}):t("div",{class:jf("text")},[i])}},render:function(){var t,n=arguments[0];return n("transition",{attrs:{name:this.transition},on:{afterEnter:this.onAfterEnter,afterLeave:this.onAfterLeave}},[n("div",{directives:[{name:"show",value:this.value}],class:[jf([this.position,(t={},t[this.type]=!this.icon,t)]),this.className],on:{click:this.onClick}},[this.genIcon(),this.genMessage()])])}});var M6={icon:"",type:"text",mask:!1,value:!0,message:"",className:"",overlay:!1,onClose:null,onOpened:null,duration:2e3,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,getContainer:"body",overlayStyle:null,closeOnClick:!1,closeOnClickOverlay:!1},X1={},Ai=[],Y2=!1,Y1=re({},M6);function D6(r){return sa(r)?r:{message:r}}function xG(r){return document.body.contains(r)}function bG(){if(_o)return{};if(Ai=Ai.filter(function(t){return!t.$el.parentNode||xG(t.$el)}),!Ai.length||Y2){var r=new(dn.extend(A6))({el:document.createElement("div")});r.$on("input",function(t){r.value=t}),Ai.push(r)}return Ai[Ai.length-1]}function wG(r){return re({},r,{overlay:r.mask||r.overlay,mask:void 0,duration:void 0})}function ir(r){r===void 0&&(r={});var t=bG();return t.value&&t.updateZIndex(),r=D6(r),r=re({},Y1,X1[r.type||Y1.type],r),r.clear=function(){t.value=!1,r.onClose&&(r.onClose(),r.onClose=null),Y2&&!_o&&t.$on("closed",function(){clearTimeout(t.timer),Ai=Ai.filter(function(n){return n!==t}),PS(t.$el),t.$destroy()})},re(t,wG(r)),clearTimeout(t.timer),r.duration>0&&(t.timer=setTimeout(function(){t.clear()},r.duration)),t}var SG=function(t){return function(n){return ir(re({type:t},D6(n)))}};["loading","success","fail"].forEach(function(r){ir[r]=SG(r)});ir.clear=function(r){Ai.length&&(r?(Ai.forEach(function(t){t.clear()}),Ai=[]):Y2?Ai.shift().clear():Ai[0].clear())};ir.setDefaultOptions=function(r,t){typeof r=="string"?X1[r]=t:re(Y1,r)};ir.resetDefaultOptions=function(r){typeof r=="string"?X1[r]=null:(Y1=re({},M6),X1={})};ir.allowMultiple=function(r){r===void 0&&(r=!0),Y2=r};ir.install=function(){dn.use(A6)};dn.prototype.$toast=ir;var R6=Ht("button"),_G=R6[0],Rh=R6[1];function O6(r,t,n,i){var o,a=t.tag,l=t.icon,c=t.type,u=t.color,h=t.plain,d=t.disabled,f=t.loading,p=t.hairline,m=t.loadingText,g=t.iconPosition,y={};u&&(y.color=h?u:"white",h||(y.background=u),u.indexOf("gradient")!==-1?y.border=0:y.borderColor=u);function v(_){t.loading&&_.preventDefault(),!f&&!d&&(bn(i,"click",_),C6(i))}function x(_){bn(i,"touchstart",_)}var b=[Rh([c,t.size,{plain:h,loading:f,disabled:d,hairline:p,block:t.block,round:t.round,square:t.square}]),(o={},o[x6]=p,o)];function w(){if(f)return n.loading?n.loading():r(ia,{class:Rh("loading"),attrs:{size:t.loadingSize,type:t.loadingType,color:"currentColor"}});if(n.icon)return r("div",{class:Rh("icon")},[n.icon()]);if(l)return r(cn,{attrs:{name:l,classPrefix:t.iconPrefix},class:Rh("icon")})}function S(){var _=[];g==="left"&&_.push(w());var $;return f?$=m:$=n.default?n.default():t.text,$&&_.push(r("span",{class:Rh("text")},[$])),g==="right"&&_.push(w()),_}return r(a,mn([{style:y,class:b,attrs:{type:t.nativeType,disabled:d},on:{click:v,touchstart:x}},Xn(i)]),[r("div",{class:Rh("content")},[S()])])}O6.props=re({},Rc,{text:String,icon:String,color:String,block:Boolean,plain:Boolean,round:Boolean,square:Boolean,loading:Boolean,hairline:Boolean,disabled:Boolean,iconPrefix:String,nativeType:String,loadingText:String,loadingType:String,tag:{type:String,default:"button"},type:{type:String,default:"default"},size:{type:String,default:"normal"},loadingSize:{type:String,default:"20px"},iconPosition:{type:String,default:"left"}});const Pr=_G(O6);function TG(r){var t=[];function n(i){i.forEach(function(o){t.push(o),o.componentInstance&&n(o.componentInstance.$children.map(function(a){return a.$vnode})),o.children&&n(o.children)})}return n(r),t}function L6(r,t){var n=t.$vnode.componentOptions;if(!(!n||!n.children)){var i=TG(n.children);r.sort(function(o,a){return i.indexOf(o.$vnode)-i.indexOf(a.$vnode)})}}function wi(r,t){var n,i;t===void 0&&(t={});var o=t.indexKey||"index";return{inject:(n={},n[r]={default:null},n),computed:(i={parent:function(){return this.disableBindRelation?null:this[r]}},i[o]=function(){return this.bindRelation(),this.parent?this.parent.children.indexOf(this):null},i),watch:{disableBindRelation:function(l){l||this.bindRelation()}},mounted:function(){this.bindRelation()},beforeDestroy:function(){var l=this;this.parent&&(this.parent.children=this.parent.children.filter(function(c){return c!==l}))},methods:{bindRelation:function(){if(!(!this.parent||this.parent.children.indexOf(this)!==-1)){var l=[].concat(this.parent.children,[this]);L6(l,this.parent),this.parent.children=l}}}}}function Si(r){return{provide:function(){var n;return n={},n[r]=this,n},data:function(){return{children:[]}}}}var F6=Ht("goods-action"),CG=F6[0],kG=F6[1];const P6=CG({mixins:[Si("vanGoodsAction")],props:{safeAreaInsetBottom:{type:Boolean,default:!0}},render:function(){var t=arguments[0];return t("div",{class:kG({unfit:!this.safeAreaInsetBottom})},[this.slots()])}});var B6=Ht("goods-action-button"),$G=B6[0],IG=B6[1];const y3=$G({mixins:[wi("vanGoodsAction")],props:re({},Rc,{type:String,text:String,icon:String,color:String,loading:Boolean,disabled:Boolean}),computed:{isFirst:function(){var t=this.parent&&this.parent.children[this.index-1];return!t||t.$options.name!==this.$options.name},isLast:function(){var t=this.parent&&this.parent.children[this.index+1];return!t||t.$options.name!==this.$options.name}},methods:{onClick:function(t){this.$emit("click",t),vh(this.$router,this)}},render:function(){var t=arguments[0];return t(Pr,{class:IG([{first:this.isFirst,last:this.isLast},this.type]),attrs:{size:"large",type:this.type,icon:this.icon,color:this.color,loading:this.loading,disabled:this.disabled},on:{click:this.onClick}},[this.slots()||this.text])}});var HS=Ht("dialog"),EG=HS[0],Ao=HS[1],d0=HS[2];const jS=EG({mixins:[q2()],props:{title:String,theme:String,width:[Number,String],message:String,className:null,callback:Function,beforeClose:Function,messageAlign:String,cancelButtonText:String,cancelButtonColor:String,confirmButtonText:String,confirmButtonColor:String,showCancelButton:Boolean,overlay:{type:Boolean,default:!0},allowHtml:{type:Boolean,default:!0},transition:{type:String,default:"van-dialog-bounce"},showConfirmButton:{type:Boolean,default:!0},closeOnPopstate:{type:Boolean,default:!0},closeOnClickOverlay:{type:Boolean,default:!1}},data:function(){return{loading:{confirm:!1,cancel:!1}}},methods:{onClickOverlay:function(){this.handleAction("overlay")},handleAction:function(t){var n=this;this.$emit(t),this.value&&(this.beforeClose?(this.loading[t]=!0,this.beforeClose(t,function(i){i!==!1&&n.loading[t]&&n.onClose(t),n.loading.confirm=!1,n.loading.cancel=!1})):this.onClose(t))},onClose:function(t){this.close(),this.callback&&this.callback(t)},onOpened:function(){var t=this;this.$emit("opened"),this.$nextTick(function(){var n;(n=t.$refs.dialog)==null||n.focus()})},onClosed:function(){this.$emit("closed")},onKeydown:function(t){var n=this;if(t.key==="Escape"||t.key==="Enter"){if(t.target!==this.$refs.dialog)return;var i={Enter:this.showConfirmButton?function(){return n.handleAction("confirm")}:Gp,Escape:this.showCancelButton?function(){return n.handleAction("cancel")}:Gp};i[t.key](),this.$emit("keydown",t)}},genRoundButtons:function(){var t=this,n=this.$createElement;return n(P6,{class:Ao("footer")},[this.showCancelButton&&n(y3,{attrs:{size:"large",type:"warning",text:this.cancelButtonText||d0("cancel"),color:this.cancelButtonColor,loading:this.loading.cancel},class:Ao("cancel"),on:{click:function(){t.handleAction("cancel")}}}),this.showConfirmButton&&n(y3,{attrs:{size:"large",type:"danger",text:this.confirmButtonText||d0("confirm"),color:this.confirmButtonColor,loading:this.loading.confirm},class:Ao("confirm"),on:{click:function(){t.handleAction("confirm")}}})])},genButtons:function(){var t=this,n,i=this.$createElement,o=this.showCancelButton&&this.showConfirmButton;return i("div",{class:[VS,Ao("footer")]},[this.showCancelButton&&i(Pr,{attrs:{size:"large",loading:this.loading.cancel,text:this.cancelButtonText||d0("cancel"),nativeType:"button"},class:Ao("cancel"),style:{color:this.cancelButtonColor},on:{click:function(){t.handleAction("cancel")}}}),this.showConfirmButton&&i(Pr,{attrs:{size:"large",loading:this.loading.confirm,text:this.confirmButtonText||d0("confirm"),nativeType:"button"},class:[Ao("confirm"),(n={},n[y6]=o,n)],style:{color:this.confirmButtonColor},on:{click:function(){t.handleAction("confirm")}}})])},genContent:function(t,n){var i=this.$createElement;if(n)return i("div",{class:Ao("content")},[n]);var o=this.message,a=this.messageAlign;if(o){var l,c,u={class:Ao("message",(l={"has-title":t},l[a]=a,l)),domProps:(c={},c[this.allowHtml?"innerHTML":"textContent"]=o,c)};return i("div",{class:Ao("content",{isolated:!t})},[i("div",mn([{},u]))])}}},render:function(){var t=arguments[0];if(this.shouldRender){var n=this.message,i=this.slots(),o=this.slots("title")||this.title,a=o&&t("div",{class:Ao("header",{isolated:!n&&!i})},[o]);return t("transition",{attrs:{name:this.transition},on:{afterEnter:this.onOpened,afterLeave:this.onClosed}},[t("div",{directives:[{name:"show",value:this.value}],attrs:{role:"dialog","aria-labelledby":this.title||n,tabIndex:0},class:[Ao([this.theme]),this.className],style:{width:kn(this.width)},ref:"dialog",on:{keydown:this.onKeydown}},[a,this.genContent(o,i),this.theme==="round-button"?this.genRoundButtons():this.genButtons()])])}}});var Uo;function NG(r){return document.body.contains(r)}function AG(){Uo&&Uo.$destroy(),Uo=new(dn.extend(jS))({el:document.createElement("div"),propsData:{lazyRender:!1}}),Uo.$on("input",function(r){Uo.value=r})}function qs(r){return _o?Promise.resolve():new Promise(function(t,n){(!Uo||!NG(Uo.$el))&&AG(),re(Uo,qs.currentOptions,r,{resolve:t,reject:n})})}qs.defaultOptions={value:!0,title:"",width:"",theme:null,message:"",overlay:!0,className:"",allowHtml:!0,lockScroll:!0,transition:"van-dialog-bounce",beforeClose:null,overlayClass:"",overlayStyle:null,messageAlign:"",getContainer:"body",cancelButtonText:"",cancelButtonColor:null,confirmButtonText:"",confirmButtonColor:null,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1,callback:function(t){Uo[t==="confirm"?"resolve":"reject"](t)}};qs.alert=qs;qs.confirm=function(r){return qs(re({showCancelButton:!0},r))};qs.close=function(){Uo&&(Uo.value=!1)};qs.setDefaultOptions=function(r){re(qs.currentOptions,r)};qs.resetDefaultOptions=function(){qs.currentOptions=re({},qs.defaultOptions)};qs.resetDefaultOptions();qs.install=function(){dn.use(jS)};qs.Component=jS;dn.prototype.$dialog=qs;var qS=Ht("address-edit-detail"),MG=qS[0],f0=qS[1],vx=qS[2],o$=fG();const DG=MG({props:{value:String,errorMessage:String,focused:Boolean,detailRows:[Number,String],searchResult:Array,detailMaxlength:[Number,String],showSearchResult:Boolean},computed:{shouldShowSearchResult:function(){return this.focused&&this.searchResult&&this.showSearchResult}},methods:{onSelect:function(t){this.$emit("select-search",t),this.$emit("input",((t.address||"")+" "+(t.name||"")).trim())},onFinish:function(){this.$refs.field.blur()},genFinish:function(){var t=this.$createElement,n=this.value&&this.focused&&o$;if(n)return t("div",{class:f0("finish"),on:{click:this.onFinish}},[vx("complete")])},genSearchResult:function(){var t=this,n=this.$createElement,i=this.value,o=this.shouldShowSearchResult,a=this.searchResult;if(o)return a.map(function(l){return n(ei,{key:l.name+l.address,attrs:{clickable:!0,border:!1,icon:"location-o",label:l.address},class:f0("search-item"),on:{click:function(){t.onSelect(l)}},scopedSlots:{title:function(){if(l.name){var u=l.name.replace(i,"<span class="+f0("keyword")+">"+i+"</span>");return n("div",{domProps:{innerHTML:u}})}}}})})}},render:function(){var t=arguments[0];return t(ei,{class:f0()},[t(lo,{attrs:{autosize:!0,rows:this.detailRows,clearable:!o$,type:"textarea",value:this.value,errorMessage:this.errorMessage,border:!this.shouldShowSearchResult,label:vx("label"),maxlength:this.detailMaxlength,placeholder:vx("placeholder")},ref:"field",scopedSlots:{icon:this.genFinish},on:re({},this.$listeners)}),this.genSearchResult()])}});var z6={size:[Number,String],value:null,loading:Boolean,disabled:Boolean,activeColor:String,inactiveColor:String,activeValue:{type:null,default:!0},inactiveValue:{type:null,default:!1}},Oc={inject:{vanField:{default:null}},watch:{value:function(){var t=this.vanField;t&&(t.resetValidation(),t.validateWithTrigger("onChange"))}},created:function(){var t=this.vanField;t&&!t.children&&(t.children=this)}},V6=Ht("switch"),RG=V6[0],yx=V6[1];const Z2=RG({mixins:[Oc],props:z6,computed:{checked:function(){return this.value===this.activeValue},style:function(){return{fontSize:kn(this.size),backgroundColor:this.checked?this.activeColor:this.inactiveColor}}},methods:{onClick:function(t){if(this.$emit("click",t),!this.disabled&&!this.loading){var n=this.checked?this.inactiveValue:this.activeValue;this.$emit("input",n),this.$emit("change",n)}},genLoading:function(){var t=this.$createElement;if(this.loading){var n=this.checked?this.activeColor:this.inactiveColor;return t(ia,{class:yx("loading"),attrs:{color:n}})}}},render:function(){var t=arguments[0],n=this.checked,i=this.loading,o=this.disabled;return t("div",{class:yx({on:n,loading:i,disabled:o}),attrs:{role:"switch","aria-checked":String(n)},style:this.style,on:{click:this.onClick}},[t("div",{class:yx("node")},[this.genLoading()])])}});var KS=Ht("address-edit"),OG=KS[0],p0=KS[1],er=KS[2],a$={name:"",tel:"",country:"",province:"",city:"",county:"",areaCode:"",postalCode:"",addressDetail:"",isDefault:!1};function LG(r){return/^\d{6}$/.test(r)}const FG=OG({props:{areaList:Object,isSaving:Boolean,isDeleting:Boolean,validator:Function,showDelete:Boolean,showPostal:Boolean,searchResult:Array,telMaxlength:[Number,String],showSetDefault:Boolean,saveButtonText:String,areaPlaceholder:String,deleteButtonText:String,showSearchResult:Boolean,showArea:{type:Boolean,default:!0},showDetail:{type:Boolean,default:!0},disableArea:Boolean,detailRows:{type:[Number,String],default:1},detailMaxlength:{type:[Number,String],default:200},addressInfo:{type:Object,default:function(){return re({},a$)}},telValidator:{type:Function,default:g6},postalValidator:{type:Function,default:LG},areaColumnsPlaceholder:{type:Array,default:function(){return[]}}},data:function(){return{data:{},showAreaPopup:!1,detailFocused:!1,errorInfo:{tel:"",name:"",areaCode:"",postalCode:"",addressDetail:""}}},computed:{areaListLoaded:function(){return sa(this.areaList)&&Object.keys(this.areaList).length},areaText:function(){var t=this.data,n=t.country,i=t.province,o=t.city,a=t.county,l=t.areaCode;if(l){var c=[n,i,o,a];return i&&i===o&&c.splice(1,1),c.filter(function(u){return u}).join("/")}return""},hideBottomFields:function(){var t=this.searchResult;return t&&t.length&&this.detailFocused}},watch:{addressInfo:{handler:function(t){this.data=re({},a$,t),this.setAreaCode(t.areaCode)},deep:!0,immediate:!0},areaList:function(){this.setAreaCode(this.data.areaCode)}},methods:{onFocus:function(t){this.errorInfo[t]="",this.detailFocused=t==="addressDetail",this.$emit("focus",t)},onChangeDetail:function(t){this.data.addressDetail=t,this.$emit("change-detail",t)},onAreaConfirm:function(t){if(t=t.filter(function(n){return!!n}),t.some(function(n){return!n.code})){ir(er("areaEmpty"));return}this.showAreaPopup=!1,this.assignAreaValues(),this.$emit("change-area",t)},assignAreaValues:function(){var t=this.$refs.area;if(t){var n=t.getArea();n.areaCode=n.code,delete n.code,re(this.data,n)}},onSave:function(){var t=this,n=["name","tel"];this.showArea&&n.push("areaCode"),this.showDetail&&n.push("addressDetail"),this.showPostal&&n.push("postalCode");var i=n.every(function(o){var a=t.getErrorMessage(o);return a&&(t.errorInfo[o]=a),!a});i&&!this.isSaving&&this.$emit("save",this.data)},getErrorMessage:function(t){var n=String(this.data[t]||"").trim();if(this.validator){var i=this.validator(t,n);if(i)return i}switch(t){case"name":return n?"":er("nameEmpty");case"tel":return this.telValidator(n)?"":er("telInvalid");case"areaCode":return n?"":er("areaEmpty");case"addressDetail":return n?"":er("addressEmpty");case"postalCode":return n&&!this.postalValidator(n)?er("postalEmpty"):""}},onDelete:function(){var t=this;qs.confirm({title:er("confirmDelete")}).then(function(){t.$emit("delete",t.data)}).catch(function(){t.$emit("cancel-delete",t.data)})},getArea:function(){return this.$refs.area?this.$refs.area.getValues():[]},setAreaCode:function(t){this.data.areaCode=t||"",t&&this.$nextTick(this.assignAreaValues)},setAddressDetail:function(t){this.data.addressDetail=t},onDetailBlur:function(){var t=this;setTimeout(function(){t.detailFocused=!1})},genSetDefaultCell:function(t){var n=this;if(this.showSetDefault){var i={"right-icon":function(){return t(Z2,{attrs:{size:"24"},on:{change:function(l){n.$emit("change-default",l)}},model:{value:n.data.isDefault,callback:function(l){n.$set(n.data,"isDefault",l)}}})}};return t(ei,{directives:[{name:"show",value:!this.hideBottomFields}],attrs:{center:!0,title:er("defaultAddress")},class:p0("default"),scopedSlots:i})}return t()}},render:function(t){var n=this,i=this.data,o=this.errorInfo,a=this.disableArea,l=this.hideBottomFields,c=function(h){return function(){return n.onFocus(h)}};return t("div",{class:p0()},[t("div",{class:p0("fields")},[t(lo,{attrs:{clearable:!0,label:er("name"),placeholder:er("namePlaceholder"),errorMessage:o.name},on:{focus:c("name")},model:{value:i.name,callback:function(h){n.$set(i,"name",h)}}}),t(lo,{attrs:{clearable:!0,type:"tel",label:er("tel"),maxlength:this.telMaxlength,placeholder:er("telPlaceholder"),errorMessage:o.tel},on:{focus:c("tel")},model:{value:i.tel,callback:function(h){n.$set(i,"tel",h)}}}),t(lo,{directives:[{name:"show",value:this.showArea}],attrs:{readonly:!0,clickable:!a,label:er("area"),placeholder:this.areaPlaceholder||er("areaPlaceholder"),errorMessage:o.areaCode,rightIcon:a?null:"arrow",value:this.areaText},on:{focus:c("areaCode"),click:function(){n.$emit("click-area"),n.showAreaPopup=!a}}}),t(DG,{directives:[{name:"show",value:this.showDetail}],attrs:{focused:this.detailFocused,value:i.addressDetail,errorMessage:o.addressDetail,detailRows:this.detailRows,detailMaxlength:this.detailMaxlength,searchResult:this.searchResult,showSearchResult:this.showSearchResult},on:{focus:c("addressDetail"),blur:this.onDetailBlur,input:this.onChangeDetail,"select-search":function(h){n.$emit("select-search",h)}}}),this.showPostal&&t(lo,{directives:[{name:"show",value:!l}],attrs:{type:"tel",maxlength:"6",label:er("postal"),placeholder:er("postal"),errorMessage:o.postalCode},on:{focus:c("postalCode")},model:{value:i.postalCode,callback:function(h){n.$set(i,"postalCode",h)}}}),this.slots()]),this.genSetDefaultCell(t),t("div",{directives:[{name:"show",value:!l}],class:p0("buttons")},[t(Pr,{attrs:{block:!0,round:!0,loading:this.isSaving,type:"danger",text:this.saveButtonText||er("save")},on:{click:this.onSave}}),this.showDelete&&t(Pr,{attrs:{block:!0,round:!0,loading:this.isDeleting,text:this.deleteButtonText||er("delete")},on:{click:this.onDelete}})]),t(Va,{attrs:{round:!0,position:"bottom",lazyRender:!1,getContainer:"body"},model:{value:n.showAreaPopup,callback:function(h){n.showAreaPopup=h}}},[t(T6,{ref:"area",attrs:{value:i.areaCode,loading:!this.areaListLoaded,areaList:this.areaList,columnsPlaceholder:this.areaColumnsPlaceholder},on:{confirm:this.onAreaConfirm,cancel:function(){n.showAreaPopup=!1}}})])])}});var U6=Ht("radio-group"),PG=U6[0],BG=U6[1];const XS=PG({mixins:[Si("vanRadio"),Oc],props:{value:null,disabled:Boolean,direction:String,checkedColor:String,iconSize:[Number,String]},watch:{value:function(t){this.$emit("change",t)}},render:function(){var t=arguments[0];return t("div",{class:BG([this.direction]),attrs:{role:"radiogroup"}},[this.slots()])}});var W6=Ht("tag"),zG=W6[0],l$=W6[1];function G6(r,t,n,i){var o,a=t.type,l=t.mark,c=t.plain,u=t.color,h=t.round,d=t.size,f=t.textColor,p=c?"color":"backgroundColor",m=(o={},o[p]=u,o);c?(m.color=f||u,m.borderColor=u):(m.color=f,m.background=u);var g={mark:l,plain:c,round:h};d&&(g[d]=d);var y=t.closeable&&r(cn,{attrs:{name:"cross"},class:l$("close"),on:{click:function(x){x.stopPropagation(),bn(i,"close")}}});return r("transition",{attrs:{name:t.closeable?"van-fade":null}},[r("span",mn([{key:"content",style:m,class:l$([g,a])},Xn(i,!0)]),[n.default==null?void 0:n.default(),y])])}G6.props={size:String,mark:Boolean,color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean,type:{type:String,default:"default"}};const J2=zG(G6);var H6=function(t){var n=t.parent,i=t.bem,o=t.role;return{mixins:[wi(n),Oc],props:{name:null,value:null,disabled:Boolean,iconSize:[Number,String],checkedColor:String,labelPosition:String,labelDisabled:Boolean,shape:{type:String,default:"round"},bindGroup:{type:Boolean,default:!0}},computed:{disableBindRelation:function(){return!this.bindGroup},isDisabled:function(){return this.parent&&this.parent.disabled||this.disabled},direction:function(){return this.parent&&this.parent.direction||null},iconStyle:function(){var l=this.checkedColor||this.parent&&this.parent.checkedColor;if(l&&this.checked&&!this.isDisabled)return{borderColor:l,backgroundColor:l}},tabindex:function(){return this.isDisabled||o==="radio"&&!this.checked?-1:0}},methods:{onClick:function(l){var c=this,u=l.target,h=this.$refs.icon,d=h===u||(h==null?void 0:h.contains(u));!this.isDisabled&&(d||!this.labelDisabled)?(this.toggle(),setTimeout(function(){c.$emit("click",l)})):this.$emit("click",l)},genIcon:function(){var l=this.$createElement,c=this.checked,u=this.iconSize||this.parent&&this.parent.iconSize;return l("div",{ref:"icon",class:i("icon",[this.shape,{disabled:this.isDisabled,checked:c}]),style:{fontSize:kn(u)}},[this.slots("icon",{checked:c})||l(cn,{attrs:{name:"success"},style:this.iconStyle})])},genLabel:function(){var l=this.$createElement,c=this.slots();if(c)return l("span",{class:i("label",[this.labelPosition,{disabled:this.isDisabled}])},[c])}},render:function(){var l=arguments[0],c=[this.genIcon()];return this.labelPosition==="left"?c.unshift(this.genLabel()):c.push(this.genLabel()),l("div",{attrs:{role:o,tabindex:this.tabindex,"aria-checked":String(this.checked)},class:i([{disabled:this.isDisabled,"label-disabled":this.labelDisabled},this.direction]),on:{click:this.onClick}},[c])}}},j6=Ht("radio"),VG=j6[0],UG=j6[1];const YS=VG({mixins:[H6({bem:UG,role:"radio",parent:"vanRadio"})],computed:{currentValue:{get:function(){return this.parent?this.parent.value:this.value},set:function(t){(this.parent||this).$emit("input",t)}},checked:function(){return this.currentValue===this.name}},methods:{toggle:function(){this.currentValue=this.name}}});var q6=Ht("address-item"),WG=q6[0],Oh=q6[1];function K6(r,t,n,i){var o=t.disabled,a=t.switchable;function l(){a&&bn(i,"select"),bn(i,"click")}var c=function(){return r(cn,{attrs:{name:"edit"},class:Oh("edit"),on:{click:function(p){p.stopPropagation(),bn(i,"edit"),bn(i,"click")}}})};function u(){if(n.tag)return n.tag(re({},t.data));if(t.data.isDefault&&t.defaultTagText)return r(J2,{attrs:{type:"danger",round:!0},class:Oh("tag")},[t.defaultTagText])}function h(){var d=t.data,f=[r("div",{class:Oh("name")},[d.name+" "+d.tel,u()]),r("div",{class:Oh("address")},[d.address])];return a&&!o?r(YS,{attrs:{name:d.id,iconSize:18}},[f]):f}return r("div",{class:Oh({disabled:o}),on:{click:l}},[r(ei,mn([{attrs:{border:!1,valueClass:Oh("value")},scopedSlots:{default:h,"right-icon":c}},Xn(i)])),n.bottom==null?void 0:n.bottom(re({},t.data,{disabled:o}))])}K6.props={data:Object,disabled:Boolean,switchable:Boolean,defaultTagText:String};const GG=WG(K6);var ZS=Ht("address-list"),HG=ZS[0],m0=ZS[1],jG=ZS[2];function X6(r,t,n,i){function o(c,u){if(c)return c.map(function(h,d){return r(GG,{attrs:{data:h,disabled:u,switchable:t.switchable,defaultTagText:t.defaultTagText},key:h.id,scopedSlots:{bottom:n["item-bottom"],tag:n.tag},on:{select:function(){bn(i,u?"select-disabled":"select",h,d),u||bn(i,"input",h.id)},edit:function(){bn(i,u?"edit-disabled":"edit",h,d)},click:function(){bn(i,"click-item",h,d)}}})})}var a=o(t.list),l=o(t.disabledList,!0);return r("div",mn([{class:m0()},Xn(i)]),[n.top==null?void 0:n.top(),r(XS,{attrs:{value:t.value}},[a]),t.disabledText&&r("div",{class:m0("disabled-text")},[t.disabledText]),l,n.default==null?void 0:n.default(),r("div",{class:m0("bottom")},[r(Pr,{attrs:{round:!0,block:!0,type:"danger",text:t.addButtonText||jG("add")},class:m0("add"),on:{click:function(){bn(i,"add")}}})])])}X6.props={list:Array,value:[Number,String],disabledList:Array,disabledText:String,addButtonText:String,defaultTagText:String,switchable:{type:Boolean,default:!0}};const qG=HG(X6);var Y6=Ht("badge"),KG=Y6[0],c$=Y6[1];const XG=KG({props:{dot:Boolean,max:[Number,String],color:String,content:[Number,String],tag:{type:String,default:"div"}},methods:{hasContent:function(){return!!(this.$scopedSlots.content||gn(this.content)&&this.content!=="")},renderContent:function(){var t=this.dot,n=this.max,i=this.content;if(!t&&this.hasContent())return this.$scopedSlots.content?this.$scopedSlots.content():gn(n)&&OS(i)&&+i>n?n+"+":i},renderBadge:function(){var t=this.$createElement;if(this.hasContent()||this.dot)return t("div",{class:c$({dot:this.dot,fixed:!!this.$scopedSlots.default}),style:{background:this.color}},[this.renderContent()])}},render:function(){var t=arguments[0];if(this.$scopedSlots.default){var n=this.tag;return t(n,{class:c$("wrapper")},[this.$scopedSlots.default(),this.renderBadge()])}return this.renderBadge()}});var u$=Date.now();function YG(r){var t=Date.now(),n=Math.max(0,16-(t-u$)),i=setTimeout(r,n);return u$=t+n,i}var jp=_o?global:window,ZG=jp.requestAnimationFrame||YG,JG=jp.cancelAnimationFrame||jp.clearTimeout;function yo(r){return ZG.call(jp,r)}function yu(r){yo(function(){yo(r)})}function Z6(r){JG.call(jp,r)}function Np(r){return Object.prototype.toString.call(r)==="[object Date]"&&!LS(r.getTime())}var JS=Ht("calendar"),QG=JS[0],Us=JS[1],cc=JS[2];function tH(r){return cc("monthTitle",r.getFullYear(),r.getMonth()+1)}function x3(r,t){var n=r.getFullYear(),i=t.getFullYear(),o=r.getMonth(),a=t.getMonth();return n===i?o===a?0:o>a?1:-1:n>i?1:-1}function ya(r,t){var n=x3(r,t);if(n===0){var i=r.getDate(),o=t.getDate();return i===o?0:i>o?1:-1}return n}function QS(r,t){return r=new Date(r),r.setDate(r.getDate()+t),r}function eH(r){return QS(r,-1)}function J6(r){return QS(r,1)}function nH(r){var t=r[0].getTime(),n=r[1].getTime();return(n-t)/(1e3*60*60*24)+1}function b3(r){return new Date(r)}function h$(r){return Array.isArray(r)?r.map(function(t){return t===null?t:b3(t)}):b3(r)}function sH(r,t){if(r<0)return[];for(var n=-1,i=Array(r);++n<r;)i[n]=t(n);return i}function xx(r){if(!r)return 0;for(;LS(parseInt(r,10));)if(r.length>1)r=r.slice(1);else return 0;return parseInt(r,10)}function w3(r,t){return 32-new Date(r,t-1,32).getDate()}var rH=Ht("calendar-month"),iH=rH[0];const oH=iH({props:{date:Date,type:String,color:String,minDate:Date,maxDate:Date,showMark:Boolean,rowHeight:[Number,String],formatter:Function,lazyRender:Boolean,currentDate:[Date,Array],allowSameDay:Boolean,showSubtitle:Boolean,showMonthTitle:Boolean,firstDayOfWeek:Number},data:function(){return{visible:!1}},computed:{title:function(){return tH(this.date)},rowHeightWithUnit:function(){return kn(this.rowHeight)},offset:function(){var t=this.firstDayOfWeek,n=this.date.getDay();return t?(n+7-this.firstDayOfWeek)%7:n},totalDay:function(){return w3(this.date.getFullYear(),this.date.getMonth()+1)},shouldRender:function(){return this.visible||!this.lazyRender},placeholders:function(){for(var t=[],n=Math.ceil((this.totalDay+this.offset)/7),i=1;i<=n;i++)t.push({type:"placeholder"});return t},days:function(){for(var t=[],n=this.date.getFullYear(),i=this.date.getMonth(),o=1;o<=this.totalDay;o++){var a=new Date(n,i,o),l=this.getDayType(a),c={date:a,type:l,text:o,bottomInfo:this.getBottomInfo(l)};this.formatter&&(c=this.formatter(c)),t.push(c)}return t}},methods:{getHeight:function(){var t;return((t=this.$el)==null?void 0:t.getBoundingClientRect().height)||0},scrollIntoView:function(t){var n=this.$refs,i=n.days,o=n.month,a=this.showSubtitle?i:o,l=a.getBoundingClientRect().top-t.getBoundingClientRect().top+t.scrollTop;q1(t,l)},getMultipleDayType:function(t){var n=this,i=function(h){return n.currentDate.some(function(d){return ya(d,h)===0})};if(i(t)){var o=eH(t),a=J6(t),l=i(o),c=i(a);return l&&c?"multiple-middle":l?"end":c?"start":"multiple-selected"}return""},getRangeDayType:function(t){var n=this.currentDate,i=n[0],o=n[1];if(!i)return"";var a=ya(t,i);if(!o)return a===0?"start":"";var l=ya(t,o);if(a===0&&l===0&&this.allowSameDay)return"start-end";if(a===0)return"start";if(l===0)return"end";if(a>0&&l<0)return"middle"},getDayType:function(t){var n=this.type,i=this.minDate,o=this.maxDate,a=this.currentDate;if(ya(t,i)<0||ya(t,o)>0)return"disabled";if(a!==null){if(n==="single")return ya(t,a)===0?"selected":"";if(n==="multiple")return this.getMultipleDayType(t);if(n==="range")return this.getRangeDayType(t)}},getBottomInfo:function(t){if(this.type==="range"){if(t==="start"||t==="end")return cc(t);if(t==="start-end")return cc("startEnd")}},getDayStyle:function(t,n){var i={height:this.rowHeightWithUnit};return t==="placeholder"?(i.width="100%",i):(n===0&&(i.marginLeft=100*this.offset/7+"%"),this.color&&(t==="start"||t==="end"||t==="start-end"||t==="multiple-selected"||t==="multiple-middle"?i.background=this.color:t==="middle"&&(i.color=this.color)),i)},genTitle:function(){var t=this.$createElement;if(this.showMonthTitle)return t("div",{class:Us("month-title")},[this.title])},genMark:function(){var t=this.$createElement;if(this.showMark&&this.shouldRender)return t("div",{class:Us("month-mark")},[this.date.getMonth()+1])},genDays:function(){var t=this.$createElement,n=this.shouldRender?this.days:this.placeholders;return t("div",{ref:"days",attrs:{role:"grid"},class:Us("days")},[this.genMark(),n.map(this.genDay)])},genTopInfo:function(t){var n=this.$createElement,i=this.$scopedSlots["top-info"];if(t.topInfo||i)return n("div",{class:Us("top-info")},[i?i(t):t.topInfo])},genBottomInfo:function(t){var n=this.$createElement,i=this.$scopedSlots["bottom-info"];if(t.bottomInfo||i)return n("div",{class:Us("bottom-info")},[i?i(t):t.bottomInfo])},genDay:function(t,n){var i=this,o=this.$createElement,a=t.type,l=this.getDayStyle(a,n),c=a==="disabled",u=function(){c||i.$emit("click",t)};return a==="selected"?o("div",{attrs:{role:"gridcell",tabindex:-1},style:l,class:[Us("day"),t.className],on:{click:u}},[o("div",{class:Us("selected-day"),style:{width:this.rowHeightWithUnit,height:this.rowHeightWithUnit,background:this.color}},[this.genTopInfo(t),t.text,this.genBottomInfo(t)])]):o("div",{attrs:{role:"gridcell",tabindex:c?null:-1},style:l,class:[Us("day",a),t.className],on:{click:u}},[this.genTopInfo(t),t.text,this.genBottomInfo(t)])}},render:function(){var t=arguments[0];return t("div",{class:Us("month"),ref:"month"},[this.genTitle(),this.genDays()])}});var aH=Ht("calendar-header"),lH=aH[0];const cH=lH({props:{title:String,subtitle:String,showTitle:Boolean,showSubtitle:Boolean,firstDayOfWeek:Number},methods:{genTitle:function(){var t=this.$createElement;if(this.showTitle){var n=this.slots("title")||this.title||cc("title");return t("div",{class:Us("header-title")},[n])}},genSubtitle:function(){var t=this.$createElement;if(this.showSubtitle)return t("div",{class:Us("header-subtitle")},[this.subtitle])},genWeekDays:function(){var t=this.$createElement,n=cc("weekdays"),i=this.firstDayOfWeek,o=[].concat(n.slice(i,7),n.slice(0,i));return t("div",{class:Us("weekdays")},[o.map(function(a){return t("span",{class:Us("weekday")},[a])})])}},render:function(){var t=arguments[0];return t("div",{class:Us("header")},[this.genTitle(),this.genSubtitle(),this.genWeekDays()])}}),uH=QG({props:{title:String,color:String,value:Boolean,readonly:Boolean,formatter:Function,rowHeight:[Number,String],confirmText:String,rangePrompt:String,defaultDate:[Date,Array],getContainer:[String,Function],allowSameDay:Boolean,confirmDisabledText:String,type:{type:String,default:"single"},round:{type:Boolean,default:!0},position:{type:String,default:"bottom"},poppable:{type:Boolean,default:!0},maxRange:{type:[Number,String],default:null},lazyRender:{type:Boolean,default:!0},showMark:{type:Boolean,default:!0},showTitle:{type:Boolean,default:!0},showConfirm:{type:Boolean,default:!0},showSubtitle:{type:Boolean,default:!0},closeOnPopstate:{type:Boolean,default:!0},closeOnClickOverlay:{type:Boolean,default:!0},safeAreaInsetBottom:{type:Boolean,default:!0},minDate:{type:Date,validator:Np,default:function(){return new Date}},maxDate:{type:Date,validator:Np,default:function(){var t=new Date;return new Date(t.getFullYear(),t.getMonth()+6,t.getDate())}},firstDayOfWeek:{type:[Number,String],default:0,validator:function(t){return t>=0&&t<=6}}},inject:{vanPopup:{default:null}},data:function(){return{subtitle:"",currentDate:this.getInitialDate()}},computed:{months:function(){var t=[],n=new Date(this.minDate);n.setDate(1);do t.push(new Date(n)),n.setMonth(n.getMonth()+1);while(x3(n,this.maxDate)!==1);return t},buttonDisabled:function(){var t=this.type,n=this.currentDate;if(n){if(t==="range")return!n[0]||!n[1];if(t==="multiple")return!n.length}return!n},dayOffset:function(){return this.firstDayOfWeek?this.firstDayOfWeek%7:0}},watch:{value:"init",type:function(){this.reset()},defaultDate:function(t){this.currentDate=t,this.scrollIntoView()}},mounted:function(){if(this.init(),!this.poppable){var t;(t=this.vanPopup)==null||t.$on("opened",this.onScroll)}},activated:function(){this.init()},methods:{reset:function(t){t===void 0&&(t=this.getInitialDate()),this.currentDate=t,this.scrollIntoView()},init:function(){var t=this;this.poppable&&!this.value||this.$nextTick(function(){t.bodyHeight=Math.floor(t.$refs.body.getBoundingClientRect().height),t.onScroll(),t.scrollIntoView()})},scrollToDate:function(t){var n=this;yo(function(){var i=n.value||!n.poppable;!t||!i||(n.months.some(function(o,a){if(x3(o,t)===0){var l=n.$refs,c=l.body,u=l.months;return u[a].scrollIntoView(c),!0}return!1}),n.onScroll())})},scrollIntoView:function(){var t=this.currentDate;if(t){var n=this.type==="single"?t:t[0];this.scrollToDate(n)}},getInitialDate:function(){var t=this.type,n=this.minDate,i=this.maxDate,o=this.defaultDate;if(o===null)return o;var a=new Date;if(ya(a,n)===-1?a=n:ya(a,i)===1&&(a=i),t==="range"){var l=o||[],c=l[0],u=l[1];return[c||a,u||J6(a)]}return t==="multiple"?o||[a]:o||a},onScroll:function(){var t=this.$refs,n=t.body,i=t.months,o=mh(n),a=o+this.bodyHeight,l=i.map(function(m){return m.getHeight()}),c=l.reduce(function(m,g){return m+g},0);if(!(a>c&&o>0)){for(var u=0,h,d=[-1,-1],f=0;f<i.length;f++){var p=u<=a&&u+l[f]>=o;p&&(d[1]=f,h||(h=i[f],d[0]=f),i[f].showed||(i[f].showed=!0,this.$emit("month-show",{date:i[f].date,title:i[f].title}))),u+=l[f]}i.forEach(function(m,g){m.visible=g>=d[0]-1&&g<=d[1]+1}),h&&(this.subtitle=h.title)}},onClickDay:function(t){if(!this.readonly){var n=t.date,i=this.type,o=this.currentDate;if(i==="range"){if(!o){this.select([n,null]);return}var a=o[0],l=o[1];if(a&&!l){var c=ya(n,a);c===1?this.select([a,n],!0):c===-1?this.select([n,null]):this.allowSameDay&&this.select([n,n],!0)}else this.select([n,null])}else if(i==="multiple"){if(!o){this.select([n]);return}var u,h=this.currentDate.some(function(p,m){var g=ya(p,n)===0;return g&&(u=m),g});if(h){var d=o.splice(u,1),f=d[0];this.$emit("unselect",b3(f))}else this.maxRange&&o.length>=this.maxRange?ir(this.rangePrompt||cc("rangePrompt",this.maxRange)):this.select([].concat(o,[n]))}else this.select(n,!0)}},togglePopup:function(t){this.$emit("input",t)},select:function(t,n){var i=this,o=function(c){i.currentDate=c,i.$emit("select",h$(i.currentDate))};if(n&&this.type==="range"){var a=this.checkRange(t);if(!a){this.showConfirm?o([t[0],QS(t[0],this.maxRange-1)]):o(t);return}}o(t),n&&!this.showConfirm&&this.onConfirm()},checkRange:function(t){var n=this.maxRange,i=this.rangePrompt;return n&&nH(t)>n?(ir(i||cc("rangePrompt",n)),!1):!0},onConfirm:function(){this.$emit("confirm",h$(this.currentDate))},genMonth:function(t,n){var i=this.$createElement,o=n!==0||!this.showSubtitle;return i(oH,{ref:"months",refInFor:!0,attrs:{date:t,type:this.type,color:this.color,minDate:this.minDate,maxDate:this.maxDate,showMark:this.showMark,formatter:this.formatter,rowHeight:this.rowHeight,lazyRender:this.lazyRender,currentDate:this.currentDate,showSubtitle:this.showSubtitle,allowSameDay:this.allowSameDay,showMonthTitle:o,firstDayOfWeek:this.dayOffset},scopedSlots:{"top-info":this.$scopedSlots["top-info"],"bottom-info":this.$scopedSlots["bottom-info"]},on:{click:this.onClickDay}})},genFooterContent:function(){var t=this.$createElement,n=this.slots("footer");if(n)return n;if(this.showConfirm){var i=this.buttonDisabled?this.confirmDisabledText:this.confirmText;return t(Pr,{attrs:{round:!0,block:!0,type:"danger",color:this.color,disabled:this.buttonDisabled,nativeType:"button"},class:Us("confirm"),on:{click:this.onConfirm}},[i||cc("confirm")])}},genFooter:function(){var t=this.$createElement;return t("div",{class:Us("footer",{unfit:!this.safeAreaInsetBottom})},[this.genFooterContent()])},genCalendar:function(){var t=this,n=this.$createElement;return n("div",{class:Us()},[n(cH,{attrs:{title:this.title,showTitle:this.showTitle,subtitle:this.subtitle,showSubtitle:this.showSubtitle,firstDayOfWeek:this.dayOffset},scopedSlots:{title:function(){return t.slots("title")}}}),n("div",{ref:"body",class:Us("body"),on:{scroll:this.onScroll}},[this.months.map(this.genMonth)]),this.genFooter()])}},render:function(){var t=this,n=arguments[0];if(this.poppable){var i,o=function(l){return function(){return t.$emit(l)}};return n(Va,{attrs:(i={round:!0,value:this.value},i.round=this.round,i.position=this.position,i.closeable=this.showTitle||this.showSubtitle,i.getContainer=this.getContainer,i.closeOnPopstate=this.closeOnPopstate,i.closeOnClickOverlay=this.closeOnClickOverlay,i),class:Us("popup"),on:{input:this.togglePopup,open:o("open"),opened:o("opened"),close:o("close"),closed:o("closed")}},[this.genCalendar()])}return this.genCalendar()}});var Q6=Ht("image"),hH=Q6[0],Lh=Q6[1];const uf=hH({props:{src:String,fit:String,alt:String,round:Boolean,width:[Number,String],height:[Number,String],radius:[Number,String],lazyLoad:Boolean,iconPrefix:String,showError:{type:Boolean,default:!0},showLoading:{type:Boolean,default:!0},errorIcon:{type:String,default:"photo-fail"},loadingIcon:{type:String,default:"photo"}},data:function(){return{loading:!0,error:!1}},watch:{src:function(){this.loading=!0,this.error=!1}},computed:{style:function(){var t={};return gn(this.width)&&(t.width=kn(this.width)),gn(this.height)&&(t.height=kn(this.height)),gn(this.radius)&&(t.overflow="hidden",t.borderRadius=kn(this.radius)),t}},created:function(){var t=this.$Lazyload;t&&G2&&(t.$on("loaded",this.onLazyLoaded),t.$on("error",this.onLazyLoadError))},beforeDestroy:function(){var t=this.$Lazyload;t&&(t.$off("loaded",this.onLazyLoaded),t.$off("error",this.onLazyLoadError))},methods:{onLoad:function(t){this.loading=!1,this.$emit("load",t)},onLazyLoaded:function(t){var n=t.el;n===this.$refs.image&&this.loading&&this.onLoad()},onLazyLoadError:function(t){var n=t.el;n===this.$refs.image&&!this.error&&this.onError()},onError:function(t){this.error=!0,this.loading=!1,this.$emit("error",t)},onClick:function(t){this.$emit("click",t)},genPlaceholder:function(){var t=this.$createElement;if(this.loading&&this.showLoading)return t("div",{class:Lh("loading")},[this.slots("loading")||t(cn,{attrs:{name:this.loadingIcon,classPrefix:this.iconPrefix},class:Lh("loading-icon")})]);if(this.error&&this.showError)return t("div",{class:Lh("error")},[this.slots("error")||t(cn,{attrs:{name:this.errorIcon,classPrefix:this.iconPrefix},class:Lh("error-icon")})])},genImage:function(){var t=this.$createElement,n={class:Lh("img"),attrs:{alt:this.alt},style:{objectFit:this.fit}};if(!this.error)return this.lazyLoad?t("img",mn([{ref:"image",directives:[{name:"lazy",value:this.src}]},n])):t("img",mn([{attrs:{src:this.src},on:{load:this.onLoad,error:this.onError}},n]))}},render:function(){var t=arguments[0];return t("div",{class:Lh({round:this.round}),style:this.style,on:{click:this.onClick}},[this.genImage(),this.genPlaceholder(),this.slots()])}});var t5=Ht("card"),dH=t5[0],oi=t5[1];function e5(r,t,n,i){var o,a=t.thumb,l=n.num||gn(t.num),c=n.price||gn(t.price),u=n["origin-price"]||gn(t.originPrice),h=l||c||u||n.bottom;function d(S){bn(i,"click-thumb",S)}function f(){if(n.tag||t.tag)return r("div",{class:oi("tag")},[n.tag?n.tag():r(J2,{attrs:{mark:!0,type:"danger"}},[t.tag])])}function p(){if(n.thumb||a)return r("a",{attrs:{href:t.thumbLink},class:oi("thumb"),on:{click:d}},[n.thumb?n.thumb():r(uf,{attrs:{src:a,width:"100%",height:"100%",fit:"cover","lazy-load":t.lazyLoad}}),f()])}function m(){if(n.title)return n.title();if(t.title)return r("div",{class:[oi("title"),"van-multi-ellipsis--l2"]},[t.title])}function g(){if(n.desc)return n.desc();if(t.desc)return r("div",{class:[oi("desc"),"van-ellipsis"]},[t.desc])}function y(){var S=t.price.toString().split(".");return r("div",[r("span",{class:oi("price-currency")},[t.currency]),r("span",{class:oi("price-integer")},[S[0]]),".",r("span",{class:oi("price-decimal")},[S[1]])])}function v(){if(c)return r("div",{class:oi("price")},[n.price?n.price():y()])}function x(){if(u){var S=n["origin-price"];return r("div",{class:oi("origin-price")},[S?S():t.currency+" "+t.originPrice])}}function b(){if(l)return r("div",{class:oi("num")},[n.num?n.num():"x"+t.num])}function w(){if(n.footer)return r("div",{class:oi("footer")},[n.footer()])}return r("div",mn([{class:oi()},Xn(i,!0)]),[r("div",{class:oi("header")},[p(),r("div",{class:oi("content",{centered:t.centered})},[r("div",[m(),g(),n.tags==null?void 0:n.tags()]),h&&r("div",{class:"van-card__bottom"},[(o=n["price-top"])==null?void 0:o.call(n),v(),x(),b(),n.bottom==null?void 0:n.bottom()])])]),w()])}e5.props={tag:String,desc:String,thumb:String,title:String,centered:Boolean,lazyLoad:Boolean,thumbLink:String,num:[Number,String],price:[Number,String],originPrice:[Number,String],currency:{type:String,default:""}};const fH=dH(e5);var n5=Ht("tab"),pH=n5[0],bx=n5[1];const Z1=pH({mixins:[wi("vanTabs")],props:re({},Rc,{dot:Boolean,name:[Number,String],info:[Number,String],badge:[Number,String],title:String,titleStyle:null,titleClass:null,disabled:Boolean}),data:function(){return{inited:!1}},computed:{computedName:function(){var t;return(t=this.name)!=null?t:this.index},isActive:function(){var t=this.computedName===this.parent.currentName;return t&&(this.inited=!0),t}},watch:{title:function(){this.parent.setLine(),this.parent.scrollIntoView()},inited:function(t){var n=this;this.parent.lazyRender&&t&&this.$nextTick(function(){n.parent.$emit("rendered",n.computedName,n.title)})}},render:function(t){var n=this.slots,i=this.parent,o=this.isActive,a=n();if(!(!a&&!i.animated)){var l=i.scrollspy||o,c=this.inited||i.scrollspy||!i.lazyRender,u=c?a:t();return i.animated?t("div",{attrs:{role:"tabpanel","aria-hidden":!o},class:bx("pane-wrapper",{inactive:!o})},[t("div",{class:bx("pane")},[u])]):t("div",{directives:[{name:"show",value:l}],attrs:{role:"tabpanel"},class:bx("pane")},[u])}}});function mH(r,t,n){var i=0,o=r.scrollLeft,a=n===0?1:Math.round(n*1e3/16);function l(){r.scrollLeft+=(t-o)/a,++i<a&&yo(l)}l()}function gH(r,t,n,i){var o=mh(r),a=o<t,l=n===0?1:Math.round(n*1e3/16),c=(t-o)/l;function u(){o+=c,(a&&o>t||!a&&o<t)&&(o=t),q1(r,o),a&&o<t||!a&&o>t?yo(u):i&&yo(i)}u()}function Tm(r){var t=window.getComputedStyle(r),n=t.display==="none",i=r.offsetParent===null&&t.position!=="fixed";return n||i}function s5(r){var t=r.interceptor,n=r.args,i=r.done;if(t){var o=t.apply(void 0,n);j1(o)?o.then(function(a){a&&i()}).catch(Gp):o&&i()}else i()}var r5=Ht("tab"),vH=r5[0],wx=r5[1];const yH=vH({props:{dot:Boolean,type:String,info:[Number,String],color:String,title:String,isActive:Boolean,disabled:Boolean,scrollable:Boolean,activeColor:String,inactiveColor:String},computed:{style:function(){var t={},n=this.color,i=this.isActive,o=this.type==="card";n&&o&&(t.borderColor=n,this.disabled||(i?t.backgroundColor=n:t.color=n));var a=i?this.activeColor:this.inactiveColor;return a&&(t.color=a),t}},methods:{onClick:function(){this.$emit("click")},genText:function(){var t=this.$createElement,n=t("span",{class:wx("text",{ellipsis:!this.scrollable})},[this.slots()||this.title]);return this.dot||gn(this.info)&&this.info!==""?t("span",{class:wx("text-wrapper")},[n,t(gh,{attrs:{dot:this.dot,info:this.info}})]):n}},render:function(){var t=arguments[0];return t("div",{attrs:{role:"tab","aria-selected":this.isActive},class:[wx({active:this.isActive,disabled:this.disabled})],style:this.style,on:{click:this.onClick}},[this.genText()])}});var i5=Ht("sticky"),xH=i5[0],bH=i5[1];const o5=xH({mixins:[ra(function(r,t){if(this.scroller||(this.scroller=ph(this.$el)),this.observer){var n=t?"observe":"unobserve";this.observer[n](this.$el)}r(this.scroller,"scroll",this.onScroll,!0),this.onScroll()})],props:{zIndex:[Number,String],container:null,offsetTop:{type:[Number,String],default:0}},data:function(){return{fixed:!1,height:0,transform:0}},computed:{offsetTopPx:function(){return FS(this.offsetTop)},style:function(){if(this.fixed){var t={};return gn(this.zIndex)&&(t.zIndex=this.zIndex),this.offsetTopPx&&this.fixed&&(t.top=this.offsetTopPx+"px"),this.transform&&(t.transform="translate3d(0, "+this.transform+"px, 0)"),t}}},watch:{fixed:function(t){this.$emit("change",t)}},created:function(){var t=this;!_o&&window.IntersectionObserver&&(this.observer=new IntersectionObserver(function(n){n[0].intersectionRatio>0&&t.onScroll()},{root:document.body}))},methods:{onScroll:function(){var t=this;if(!Tm(this.$el)){this.height=this.$el.offsetHeight;var n=this.container,i=this.offsetTopPx,o=mh(window),a=v3(this.$el),l=function(){t.$emit("scroll",{scrollTop:o,isFixed:t.fixed})};if(n){var c=a+n.offsetHeight;if(o+i+this.height>c){var u=this.height+o-c;u<this.height?(this.fixed=!0,this.transform=-(u+i)):this.fixed=!1,l();return}}o+i>a?(this.fixed=!0,this.transform=0):this.fixed=!1,l()}}},render:function(){var t=arguments[0],n=this.fixed,i={height:n?this.height+"px":null};return t("div",{style:i},[t("div",{class:bH({fixed:n}),style:this.style},[this.slots()])])}});var a5=Ht("tabs"),wH=a5[0],d$=a5[1],SH=50;const _H=wH({mixins:[To],props:{count:Number,duration:[Number,String],animated:Boolean,swipeable:Boolean,currentIndex:Number},computed:{style:function(){if(this.animated)return{transform:"translate3d("+-1*this.currentIndex*100+"%, 0, 0)",transitionDuration:this.duration+"s"}},listeners:function(){if(this.swipeable)return{touchstart:this.touchStart,touchmove:this.touchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchEnd}}},methods:{onTouchEnd:function(){var t=this.direction,n=this.deltaX,i=this.currentIndex;t==="horizontal"&&this.offsetX>=SH&&(n>0&&i!==0?this.$emit("change",i-1):n<0&&i!==this.count-1&&this.$emit("change",i+1))},genChildren:function(){var t=this.$createElement;return this.animated?t("div",{class:d$("track"),style:this.style},[this.slots()]):this.slots()}},render:function(){var t=arguments[0];return t("div",{class:d$("content",{animated:this.animated}),on:re({},this.listeners)},[this.genChildren()])}});var l5=Ht("tabs"),TH=l5[0],g0=l5[1];const t4=TH({mixins:[Si("vanTabs"),ra(function(r){this.scroller||(this.scroller=ph(this.$el)),r(window,"resize",this.resize,!0),this.scrollspy&&r(this.scroller,"scroll",this.onScroll,!0)})],inject:{vanPopup:{default:null}},model:{prop:"active"},props:{color:String,border:Boolean,sticky:Boolean,animated:Boolean,swipeable:Boolean,scrollspy:Boolean,background:String,lineWidth:[Number,String],lineHeight:[Number,String],beforeChange:Function,titleActiveColor:String,titleInactiveColor:String,type:{type:String,default:"line"},active:{type:[Number,String],default:0},ellipsis:{type:Boolean,default:!0},duration:{type:[Number,String],default:.3},offsetTop:{type:[Number,String],default:0},lazyRender:{type:Boolean,default:!0},swipeThreshold:{type:[Number,String],default:5}},data:function(){return{position:"",currentIndex:null,lineStyle:{backgroundColor:this.color}}},computed:{scrollable:function(){return this.children.length>this.swipeThreshold||!this.ellipsis},navStyle:function(){return{borderColor:this.color,background:this.background}},currentName:function(){var t=this.children[this.currentIndex];if(t)return t.computedName},offsetTopPx:function(){return FS(this.offsetTop)},scrollOffset:function(){return this.sticky?this.offsetTopPx+this.tabHeight:0}},watch:{color:"setLine",active:function(t){t!==this.currentName&&this.setCurrentIndexByName(t)},children:function(){var t=this;this.setCurrentIndexByName(this.active),this.setLine(),this.$nextTick(function(){t.scrollIntoView(!0)})},currentIndex:function(){this.scrollIntoView(),this.setLine(),this.stickyFixed&&!this.scrollspy&&H2(Math.ceil(v3(this.$el)-this.offsetTopPx))},scrollspy:function(t){t?ao(this.scroller,"scroll",this.onScroll,!0):wc(this.scroller,"scroll",this.onScroll)}},mounted:function(){var t=this;this.init(),this.vanPopup&&this.vanPopup.onReopen(function(){t.setLine()})},activated:function(){this.init(),this.setLine()},methods:{resize:function(){this.setLine()},init:function(){var t=this;this.$nextTick(function(){t.inited=!0,t.tabHeight=FW(t.$refs.wrap),t.scrollIntoView(!0)})},setLine:function(){var t=this,n=this.inited;this.$nextTick(function(){var i=t.$refs.titles;if(!(!i||!i[t.currentIndex]||t.type!=="line"||Tm(t.$el))){var o=i[t.currentIndex].$el,a=t.lineWidth,l=t.lineHeight,c=o.offsetLeft+o.offsetWidth/2,u={width:kn(a),backgroundColor:t.color,transform:"translateX("+c+"px) translateX(-50%)"};if(n&&(u.transitionDuration=t.duration+"s"),gn(l)){var h=kn(l);u.height=h,u.borderRadius=h}t.lineStyle=u}})},setCurrentIndexByName:function(t){var n=this.children.filter(function(o){return o.computedName===t}),i=(this.children[0]||{}).index||0;this.setCurrentIndex(n.length?n[0].index:i)},setCurrentIndex:function(t){var n=this.findAvailableTab(t);if(gn(n)){var i=this.children[n],o=i.computedName,a=this.currentIndex!==null;this.currentIndex=n,o!==this.active&&(this.$emit("input",o),a&&this.$emit("change",o,i.title))}},findAvailableTab:function(t){for(var n=t<this.currentIndex?-1:1;t>=0&&t<this.children.length;){if(!this.children[t].disabled)return t;t+=n}},onClick:function(t,n){var i=this,o=this.children[n],a=o.title,l=o.disabled,c=o.computedName;l?this.$emit("disabled",c,a):(s5({interceptor:this.beforeChange,args:[c],done:function(){i.setCurrentIndex(n),i.scrollToCurrentContent()}}),this.$emit("click",c,a),vh(t.$router,t))},scrollIntoView:function(t){var n=this.$refs.titles;if(!(!this.scrollable||!n||!n[this.currentIndex])){var i=this.$refs.nav,o=n[this.currentIndex].$el,a=o.offsetLeft-(i.offsetWidth-o.offsetWidth)/2;mH(i,a,t?0:+this.duration)}},onSticktScroll:function(t){this.stickyFixed=t.isFixed,this.$emit("scroll",t)},scrollTo:function(t){var n=this;this.$nextTick(function(){n.setCurrentIndexByName(t),n.scrollToCurrentContent(!0)})},scrollToCurrentContent:function(t){var n=this;if(t===void 0&&(t=!1),this.scrollspy){var i=this.children[this.currentIndex],o=i==null?void 0:i.$el;if(o){var a=v3(o,this.scroller)-this.scrollOffset;this.lockScroll=!0,gH(this.scroller,a,t?0:+this.duration,function(){n.lockScroll=!1})}}},onScroll:function(){if(this.scrollspy&&!this.lockScroll){var t=this.getCurrentIndexOnScroll();this.setCurrentIndex(t)}},getCurrentIndexOnScroll:function(){for(var t=this.children,n=0;n<t.length;n++){var i=PW(t[n].$el);if(i>this.scrollOffset)return n===0?0:n-1}return t.length-1}},render:function(){var t=this,n,i=arguments[0],o=this.type,a=this.animated,l=this.scrollable,c=this.children.map(function(h,d){var f;return i(yH,{ref:"titles",refInFor:!0,attrs:{type:o,dot:h.dot,info:(f=h.badge)!=null?f:h.info,title:h.title,color:t.color,isActive:d===t.currentIndex,disabled:h.disabled,scrollable:l,activeColor:t.titleActiveColor,inactiveColor:t.titleInactiveColor},style:h.titleStyle,class:h.titleClass,scopedSlots:{default:function(){return h.slots("title")}},on:{click:function(){t.onClick(h,d)}}})}),u=i("div",{ref:"wrap",class:[g0("wrap",{scrollable:l}),(n={},n[X2]=o==="line"&&this.border,n)]},[i("div",{ref:"nav",attrs:{role:"tablist"},class:g0("nav",[o,{complete:this.scrollable}]),style:this.navStyle},[this.slots("nav-left"),c,o==="line"&&i("div",{class:g0("line"),style:this.lineStyle}),this.slots("nav-right")])]);return i("div",{class:g0([o])},[this.sticky?i(o5,{attrs:{container:this.$el,offsetTop:this.offsetTop},on:{scroll:this.onSticktScroll}},[u]):u,i(_H,{attrs:{count:this.children.length,animated:a,duration:this.duration,swipeable:this.swipeable,currentIndex:this.currentIndex},on:{change:this.setCurrentIndex}},[this.slots()])])}});var e4=Ht("cascader"),CH=e4[0],ja=e4[1],kH=e4[2];const $H=CH({props:{title:String,value:[Number,String],fieldNames:Object,placeholder:String,activeColor:String,options:{type:Array,default:function(){return[]}},closeable:{type:Boolean,default:!0},showHeader:{type:Boolean,default:!0}},data:function(){return{tabs:[],activeTab:0}},computed:{textKey:function(){var t;return((t=this.fieldNames)==null?void 0:t.text)||"text"},valueKey:function(){var t;return((t=this.fieldNames)==null?void 0:t.value)||"value"},childrenKey:function(){var t;return((t=this.fieldNames)==null?void 0:t.children)||"children"}},watch:{options:{deep:!0,handler:"updateTabs"},value:function(t){var n=this;if(t||t===0){var i=this.tabs.map(function(o){var a;return(a=o.selectedOption)==null?void 0:a[n.valueKey]});if(i.indexOf(t)!==-1)return}this.updateTabs()}},created:function(){this.updateTabs()},methods:{getSelectedOptionsByValue:function(t,n){for(var i=0;i<t.length;i++){var o=t[i];if(o[this.valueKey]===n)return[o];if(o[this.childrenKey]){var a=this.getSelectedOptionsByValue(o[this.childrenKey],n);if(a)return[o].concat(a)}}},updateTabs:function(){var t=this;if(this.value||this.value===0){var n=this.getSelectedOptionsByValue(this.options,this.value);if(n){var i=this.options;this.tabs=n.map(function(o){var a={options:i,selectedOption:o},l=i.filter(function(c){return c[t.valueKey]===o[t.valueKey]});return l.length&&(i=l[0][t.childrenKey]),a}),i&&this.tabs.push({options:i,selectedOption:null}),this.$nextTick(function(){t.activeTab=t.tabs.length-1});return}}this.tabs=[{options:this.options,selectedOption:null}]},onSelect:function(t,n){var i=this;if(this.tabs[n].selectedOption=t,this.tabs.length>n+1&&(this.tabs=this.tabs.slice(0,n+1)),t[this.childrenKey]){var o={options:t[this.childrenKey],selectedOption:null};this.tabs[n+1]?this.$set(this.tabs,n+1,o):this.tabs.push(o),this.$nextTick(function(){i.activeTab++})}var a=this.tabs.map(function(c){return c.selectedOption}).filter(function(c){return!!c}),l={value:t[this.valueKey],tabIndex:n,selectedOptions:a};this.$emit("input",t[this.valueKey]),this.$emit("change",l),t[this.childrenKey]||this.$emit("finish",l)},onClose:function(){this.$emit("close")},renderHeader:function(){var t=this.$createElement;if(this.showHeader)return t("div",{class:ja("header")},[t("h2",{class:ja("title")},[this.slots("title")||this.title]),this.closeable?t(cn,{attrs:{name:"cross"},class:ja("close-icon"),on:{click:this.onClose}}):null])},renderOptions:function(t,n,i){var o=this,a=this.$createElement,l=function(u){var h=n&&u[o.valueKey]===n[o.valueKey],d=o.slots("option",{option:u,selected:h})||a("span",[u[o.textKey]]);return a("li",{class:ja("option",{selected:h}),style:{color:h?o.activeColor:null},on:{click:function(){o.onSelect(u,i)}}},[d,h?a(cn,{attrs:{name:"success"},class:ja("selected-icon")}):null])};return a("ul",{class:ja("options")},[t.map(l)])},renderTab:function(t,n){var i=this.$createElement,o=t.options,a=t.selectedOption,l=a?a[this.textKey]:this.placeholder||kH("select");return i(Z1,{attrs:{title:l,titleClass:ja("tab",{unselected:!a})}},[this.renderOptions(o,a,n)])},renderTabs:function(){var t=this,n=this.$createElement;return n(t4,{attrs:{animated:!0,swipeable:!0,swipeThreshold:0,color:this.activeColor},class:ja("tabs"),model:{value:t.activeTab,callback:function(o){t.activeTab=o}}},[this.tabs.map(this.renderTab)])}},render:function(){var t=arguments[0];return t("div",{class:ja()},[this.renderHeader(),this.renderTabs()])}});var c5=Ht("cell-group"),IH=c5[0],f$=c5[1];function u5(r,t,n,i){var o,a=r("div",mn([{class:[f$({inset:t.inset}),(o={},o[X2]=t.border,o)]},Xn(i,!0)]),[n.default==null?void 0:n.default()]);return t.title||n.title?r("div",{key:i.data.key},[r("div",{class:f$("title",{inset:t.inset})},[n.title?n.title():t.title]),a]):a}u5.props={title:String,inset:Boolean,border:{type:Boolean,default:!0}};const h5=IH(u5);var d5=Ht("checkbox"),EH=d5[0],NH=d5[1];const f5=EH({mixins:[H6({bem:NH,role:"checkbox",parent:"vanCheckbox"})],computed:{checked:{get:function(){return this.parent?this.parent.value.indexOf(this.name)!==-1:this.value},set:function(t){this.parent?this.setParentValue(t):this.$emit("input",t)}}},watch:{value:function(t){this.$emit("change",t)}},methods:{toggle:function(t){var n=this;t===void 0&&(t=!this.checked),clearTimeout(this.toggleTask),this.toggleTask=setTimeout(function(){n.checked=t})},setParentValue:function(t){var n=this.parent,i=n.value.slice();if(t){if(n.max&&i.length>=n.max)return;i.indexOf(this.name)===-1&&(i.push(this.name),n.$emit("input",i))}else{var o=i.indexOf(this.name);o!==-1&&(i.splice(o,1),n.$emit("input",i))}}}});var p5=Ht("checkbox-group"),AH=p5[0],MH=p5[1];const DH=AH({mixins:[Si("vanCheckbox"),Oc],props:{max:[Number,String],disabled:Boolean,direction:String,iconSize:[Number,String],checkedColor:String,value:{type:Array,default:function(){return[]}}},watch:{value:function(t){this.$emit("change",t)}},methods:{toggleAll:function(t){t===void 0&&(t={}),typeof t=="boolean"&&(t={checked:t});var n=t,i=n.checked,o=n.skipDisabled,a=this.children.filter(function(c){return c.disabled&&o?c.checked:i??!c.checked}),l=a.map(function(c){return c.name});this.$emit("input",l)}},render:function(){var t=arguments[0];return t("div",{class:MH([this.direction])},[this.slots()])}});var m5=Ht("circle"),RH=m5[0],v0=m5[1],p$=3140,OH=0;function m$(r){return Math.min(Math.max(r,0),100)}function LH(r,t){var n=r?1:0;return"M "+t/2+" "+t/2+" m 0, -500 a 500, 500 0 1, "+n+" 0, 1000 a 500, 500 0 1, "+n+" 0, -1000"}const FH=RH({props:{text:String,size:[Number,String],color:[String,Object],layerColor:String,strokeLinecap:String,value:{type:Number,default:0},speed:{type:[Number,String],default:0},fill:{type:String,default:"none"},rate:{type:[Number,String],default:100},strokeWidth:{type:[Number,String],default:40},clockwise:{type:Boolean,default:!0}},beforeCreate:function(){this.uid="van-circle-gradient-"+OH++},computed:{style:function(){var t=kn(this.size);return{width:t,height:t}},path:function(){return LH(this.clockwise,this.viewBoxSize)},viewBoxSize:function(){return+this.strokeWidth+1e3},layerStyle:function(){return{fill:""+this.fill,stroke:""+this.layerColor,strokeWidth:this.strokeWidth+"px"}},hoverStyle:function(){var t=p$*this.value/100;return{stroke:""+(this.gradient?"url(#"+this.uid+")":this.color),strokeWidth:+this.strokeWidth+1+"px",strokeLinecap:this.strokeLinecap,strokeDasharray:t+"px "+p$+"px"}},gradient:function(){return sa(this.color)},LinearGradient:function(){var t=this,n=this.$createElement;if(this.gradient){var i=Object.keys(this.color).sort(function(o,a){return parseFloat(o)-parseFloat(a)}).map(function(o,a){return n("stop",{key:a,attrs:{offset:o,"stop-color":t.color[o]}})});return n("defs",[n("linearGradient",{attrs:{id:this.uid,x1:"100%",y1:"0%",x2:"0%",y2:"0%"}},[i])])}}},watch:{rate:{handler:function(t){this.startTime=Date.now(),this.startRate=this.value,this.endRate=m$(t),this.increase=this.endRate>this.startRate,this.duration=Math.abs((this.startRate-this.endRate)*1e3/this.speed),this.speed?(Z6(this.rafId),this.rafId=yo(this.animate)):this.$emit("input",this.endRate)},immediate:!0}},methods:{animate:function(){var t=Date.now(),n=Math.min((t-this.startTime)/this.duration,1),i=n*(this.endRate-this.startRate)+this.startRate;this.$emit("input",m$(parseFloat(i.toFixed(1)))),(this.increase?i<this.endRate:i>this.endRate)&&(this.rafId=yo(this.animate))}},render:function(){var t=arguments[0];return t("div",{class:v0(),style:this.style},[t("svg",{attrs:{viewBox:"0 0 "+this.viewBoxSize+" "+this.viewBoxSize}},[this.LinearGradient,t("path",{class:v0("layer"),style:this.layerStyle,attrs:{d:this.path}}),t("path",{attrs:{d:this.path},class:v0("hover"),style:this.hoverStyle})]),this.slots()||this.text&&t("div",{class:v0("text")},[this.text])])}});var g5=Ht("col"),PH=g5[0],BH=g5[1];const zH=PH({mixins:[wi("vanRow")],props:{span:[Number,String],offset:[Number,String],tag:{type:String,default:"div"}},computed:{style:function(){var t=this.index,n=this.parent||{},i=n.spaces;if(i&&i[t]){var o=i[t],a=o.left,l=o.right;return{paddingLeft:a?a+"px":null,paddingRight:l?l+"px":null}}}},methods:{onClick:function(t){this.$emit("click",t)}},render:function(){var t,n=arguments[0],i=this.span,o=this.offset;return n(this.tag,{style:this.style,class:BH((t={},t[i]=i,t["offset-"+o]=o,t)),on:{click:this.onClick}},[this.slots()])}});var v5=Ht("collapse"),VH=v5[0],UH=v5[1];const WH=VH({mixins:[Si("vanCollapse")],props:{accordion:Boolean,value:[String,Number,Array],border:{type:Boolean,default:!0}},methods:{switch:function(t,n){this.accordion||(t=n?this.value.concat(t):this.value.filter(function(i){return i!==t})),this.$emit("change",t),this.$emit("input",t)}},render:function(){var t,n=arguments[0];return n("div",{class:[UH(),(t={},t[X2]=this.border,t)]},[this.slots()])}});var y5=Ht("collapse-item"),GH=y5[0],y0=y5[1],HH=["title","icon","right-icon"];const jH=GH({mixins:[wi("vanCollapse")],props:re({},GS,{name:[Number,String],disabled:Boolean,lazyRender:{type:Boolean,default:!0},isLink:{type:Boolean,default:!0}}),data:function(){return{show:null,inited:null}},computed:{currentName:function(){var t;return(t=this.name)!=null?t:this.index},expanded:function(){var t=this;if(!this.parent)return null;var n=this.parent,i=n.value,o=n.accordion;return o?i===this.currentName:i.some(function(a){return a===t.currentName})}},created:function(){this.show=this.expanded,this.inited=this.expanded},watch:{expanded:function(t,n){var i=this;if(n!==null){t&&(this.show=!0,this.inited=!0);var o=t?this.$nextTick:yo;o(function(){var a=i.$refs,l=a.content,c=a.wrapper;if(!(!l||!c)){var u=l.offsetHeight;if(u){var h=u+"px";c.style.height=t?0:h,yu(function(){c.style.height=t?h:0})}else i.onTransitionEnd()}})}}},methods:{onClick:function(){this.disabled||this.toggle()},toggle:function(t){t===void 0&&(t=!this.expanded);var n=this.parent,i=this.currentName,o=n.accordion&&i===n.value,a=o?"":i;this.parent.switch(a,t)},onTransitionEnd:function(){this.expanded?this.$refs.wrapper.style.height="":this.show=!1},genTitle:function(){var t=this,n=this.$createElement,i=this.border,o=this.disabled,a=this.expanded,l=HH.reduce(function(c,u){return t.slots(u)&&(c[u]=function(){return t.slots(u)}),c},{});return this.slots("value")&&(l.default=function(){return t.slots("value")}),n(ei,{attrs:{role:"button",tabindex:o?-1:0,"aria-expanded":String(a)},class:y0("title",{disabled:o,expanded:a,borderless:!i}),on:{click:this.onClick},scopedSlots:l,props:re({},this.$props)})},genContent:function(){var t=this.$createElement;if(this.inited||!this.lazyRender)return t("div",{directives:[{name:"show",value:this.show}],ref:"wrapper",class:y0("wrapper"),on:{transitionend:this.onTransitionEnd}},[t("div",{ref:"content",class:y0("content")},[this.slots()])])}},render:function(){var t=arguments[0];return t("div",{class:[y0({border:this.index&&this.border})]},[this.genTitle(),this.genContent()])}});var n4=Ht("contact-card"),qH=n4[0],g$=n4[1],Sx=n4[2];function x5(r,t,n,i){var o=t.type,a=t.editable;function l(u){a&&bn(i,"click",u)}function c(){return o==="add"?t.addText||Sx("addText"):[r("div",[Sx("name")+""+t.name]),r("div",[Sx("tel")+""+t.tel])]}return r(ei,mn([{attrs:{center:!0,border:!1,isLink:a,valueClass:g$("value"),icon:o==="edit"?"contact":"add-square"},class:g$([o]),on:{click:l}},Xn(i)]),[c()])}x5.props={tel:String,name:String,addText:String,editable:{type:Boolean,default:!0},type:{type:String,default:"add"}};const KH=qH(x5);var s4=Ht("contact-edit"),XH=s4[0],x0=s4[1],qa=s4[2],_x={tel:"",name:""};const YH=XH({props:{isEdit:Boolean,isSaving:Boolean,isDeleting:Boolean,showSetDefault:Boolean,setDefaultLabel:String,contactInfo:{type:Object,default:function(){return re({},_x)}},telValidator:{type:Function,default:g6}},data:function(){return{data:re({},_x,this.contactInfo),errorInfo:{name:"",tel:""}}},watch:{contactInfo:function(t){this.data=re({},_x,t)}},methods:{onFocus:function(t){this.errorInfo[t]=""},getErrorMessageByKey:function(t){var n=this.data[t].trim();switch(t){case"name":return n?"":qa("nameInvalid");case"tel":return this.telValidator(n)?"":qa("telInvalid")}},onSave:function(){var t=this,n=["name","tel"].every(function(i){var o=t.getErrorMessageByKey(i);return o&&(t.errorInfo[i]=o),!o});n&&!this.isSaving&&this.$emit("save",this.data)},onDelete:function(){var t=this;qs.confirm({title:qa("confirmDelete")}).then(function(){t.$emit("delete",t.data)})}},render:function(){var t=this,n=arguments[0],i=this.data,o=this.errorInfo,a=function(c){return function(){return t.onFocus(c)}};return n("div",{class:x0()},[n("div",{class:x0("fields")},[n(lo,{attrs:{clearable:!0,maxlength:"30",label:qa("name"),placeholder:qa("nameEmpty"),errorMessage:o.name},on:{focus:a("name")},model:{value:i.name,callback:function(c){t.$set(i,"name",c)}}}),n(lo,{attrs:{clearable:!0,type:"tel",label:qa("tel"),placeholder:qa("telEmpty"),errorMessage:o.tel},on:{focus:a("tel")},model:{value:i.tel,callback:function(c){t.$set(i,"tel",c)}}})]),this.showSetDefault&&n(ei,{attrs:{title:this.setDefaultLabel,border:!1},class:x0("switch-cell")},[n(Z2,{attrs:{size:24},slot:"right-icon",on:{change:function(c){t.$emit("change-default",c)}},model:{value:i.isDefault,callback:function(c){t.$set(i,"isDefault",c)}}})]),n("div",{class:x0("buttons")},[n(Pr,{attrs:{block:!0,round:!0,type:"danger",text:qa("save"),loading:this.isSaving},on:{click:this.onSave}}),this.isEdit&&n(Pr,{attrs:{block:!0,round:!0,text:qa("delete"),loading:this.isDeleting},on:{click:this.onDelete}})])])}});var r4=Ht("contact-list"),ZH=r4[0],Pl=r4[1],JH=r4[2];function b5(r,t,n,i){var o=t.list&&t.list.map(function(a,l){function c(){bn(i,"input",a.id),bn(i,"select",a,l)}function u(){return r(YS,{attrs:{name:a.id,iconSize:16,checkedColor:v6},on:{click:c}})}function h(){return r(cn,{attrs:{name:"edit"},class:Pl("edit"),on:{click:function(p){p.stopPropagation(),bn(i,"edit",a,l)}}})}function d(){var f=[a.name+""+a.tel];return a.isDefault&&t.defaultTagText&&f.push(r(J2,{attrs:{type:"danger",round:!0},class:Pl("item-tag")},[t.defaultTagText])),f}return r(ei,{key:a.id,attrs:{isLink:!0,center:!0,valueClass:Pl("item-value")},class:Pl("item"),scopedSlots:{icon:h,default:d,"right-icon":u},on:{click:c}})});return r("div",mn([{class:Pl()},Xn(i)]),[r(XS,{attrs:{value:t.value},class:Pl("group")},[o]),r("div",{class:Pl("bottom")},[r(Pr,{attrs:{round:!0,block:!0,type:"danger",text:t.addText||JH("addText")},class:Pl("add"),on:{click:function(){bn(i,"add")}}})])])}b5.props={value:null,list:Array,addText:String,defaultTagText:String};const QH=ZH(b5);var S3=1e3,_3=60*S3,T3=60*_3,v$=24*T3;function tj(r){var t=Math.floor(r/v$),n=Math.floor(r%v$/T3),i=Math.floor(r%T3/_3),o=Math.floor(r%_3/S3),a=Math.floor(r%S3);return{days:t,hours:n,minutes:i,seconds:o,milliseconds:a}}function ej(r,t){var n=t.days,i=t.hours,o=t.minutes,a=t.seconds,l=t.milliseconds;if(r.indexOf("DD")===-1?i+=n*24:r=r.replace("DD",Ms(n)),r.indexOf("HH")===-1?o+=i*60:r=r.replace("HH",Ms(i)),r.indexOf("mm")===-1?a+=o*60:r=r.replace("mm",Ms(o)),r.indexOf("ss")===-1?l+=a*1e3:r=r.replace("ss",Ms(a)),r.indexOf("S")!==-1){var c=Ms(l,3);r.indexOf("SSS")!==-1?r=r.replace("SSS",c):r.indexOf("SS")!==-1?r=r.replace("SS",c.slice(0,2)):r=r.replace("S",c.charAt(0))}return r}function nj(r,t){return Math.floor(r/1e3)===Math.floor(t/1e3)}var w5=Ht("count-down"),sj=w5[0],rj=w5[1];const ij=sj({props:{millisecond:Boolean,time:{type:[Number,String],default:0},format:{type:String,default:"HH:mm:ss"},autoStart:{type:Boolean,default:!0}},data:function(){return{remain:0}},computed:{timeData:function(){return tj(this.remain)},formattedTime:function(){return ej(this.format,this.timeData)}},watch:{time:{immediate:!0,handler:"reset"}},activated:function(){this.keepAlivePaused&&(this.counting=!0,this.keepAlivePaused=!1,this.tick())},deactivated:function(){this.counting&&(this.pause(),this.keepAlivePaused=!0)},beforeDestroy:function(){this.pause()},methods:{start:function(){this.counting||(this.counting=!0,this.endTime=Date.now()+this.remain,this.tick())},pause:function(){this.counting=!1,Z6(this.rafId)},reset:function(){this.pause(),this.remain=+this.time,this.autoStart&&this.start()},tick:function(){G2&&(this.millisecond?this.microTick():this.macroTick())},microTick:function(){var t=this;this.rafId=yo(function(){t.counting&&(t.setRemain(t.getRemain()),t.remain>0&&t.microTick())})},macroTick:function(){var t=this;this.rafId=yo(function(){if(t.counting){var n=t.getRemain();(!nj(n,t.remain)||n===0)&&t.setRemain(n),t.remain>0&&t.macroTick()}})},getRemain:function(){return Math.max(this.endTime-Date.now(),0)},setRemain:function(t){this.remain=t,this.$emit("change",this.timeData),t===0&&(this.pause(),this.$emit("finish"))}},render:function(){var t=arguments[0];return t("div",{class:rj()},[this.slots("default",this.timeData)||this.formattedTime])}});var i4=Ht("coupon"),oj=i4[0],da=i4[1],Tx=i4[2];function aj(r){return r<Math.pow(10,12)?r*1e3:+r}function y$(r){var t=new Date(aj(r));return t.getFullYear()+"."+Ms(t.getMonth()+1)+"."+Ms(t.getDate())}function lj(r){return(r/10).toFixed(r%10===0?0:1)}function x$(r){return(r/100).toFixed(r%100===0?0:r%10===0?1:2)}const C3=oj({props:{coupon:Object,chosen:Boolean,disabled:Boolean,currency:{type:String,default:""}},computed:{validPeriod:function(){var t=this.coupon,n=t.startAt,i=t.endAt,o=t.customValidPeriod;return o||y$(n)+" - "+y$(i)},faceAmount:function(){var t=this.coupon;if(t.valueDesc)return t.valueDesc+"<span>"+(t.unitDesc||"")+"</span>";if(t.denominations){var n=x$(t.denominations);return"<span>"+this.currency+"</span> "+n}return t.discount?Tx("discount",lj(t.discount)):""},conditionMessage:function(){var t=x$(this.coupon.originCondition);return t==="0"?Tx("unlimited"):Tx("condition",t)}},render:function(){var t=arguments[0],n=this.coupon,i=this.disabled,o=i&&n.reason||n.description;return t("div",{class:da({disabled:i})},[t("div",{class:da("content")},[t("div",{class:da("head")},[t("h2",{class:da("amount"),domProps:{innerHTML:this.faceAmount}}),t("p",{class:da("condition")},[this.coupon.condition||this.conditionMessage])]),t("div",{class:da("body")},[t("p",{class:da("name")},[n.name]),t("p",{class:da("valid")},[this.validPeriod]),!this.disabled&&t(f5,{attrs:{size:18,value:this.chosen,checkedColor:v6},class:da("corner")})])]),o&&t("p",{class:da("description")},[o])])}});var o4=Ht("coupon-cell"),cj=o4[0],b$=o4[1],k3=o4[2];function uj(r){var t=r.coupons,n=r.chosenCoupon,i=r.currency,o=t[+n];if(o){var a=0;return gn(o.value)?a=o.value:gn(o.denominations)&&(a=o.denominations),"-"+i+" "+(a/100).toFixed(2)}return t.length===0?k3("tips"):k3("count",t.length)}function a4(r,t,n,i){var o=t.coupons[+t.chosenCoupon],a=uj(t);return r(ei,mn([{class:b$(),attrs:{value:a,title:t.title||k3("title"),border:t.border,isLink:t.editable,valueClass:b$("value",{selected:o})}},Xn(i,!0)]))}a4.model={prop:"chosenCoupon"};a4.props={title:String,coupons:{type:Array,default:function(){return[]}},currency:{type:String,default:""},border:{type:Boolean,default:!0},editable:{type:Boolean,default:!0},chosenCoupon:{type:[Number,String],default:-1}};const hj=cj(a4);var l4=Ht("coupon-list"),dj=l4[0],fa=l4[1],Fh=l4[2],fj="https://img01.yzcdn.cn/vant/coupon-empty.png";const pj=dj({model:{prop:"code"},props:{code:String,closeButtonText:String,inputPlaceholder:String,enabledTitle:String,disabledTitle:String,exchangeButtonText:String,exchangeButtonLoading:Boolean,exchangeButtonDisabled:Boolean,exchangeMinLength:{type:Number,default:1},chosenCoupon:{type:Number,default:-1},coupons:{type:Array,default:function(){return[]}},disabledCoupons:{type:Array,default:function(){return[]}},displayedCouponIndex:{type:Number,default:-1},showExchangeBar:{type:Boolean,default:!0},showCloseButton:{type:Boolean,default:!0},showCount:{type:Boolean,default:!0},currency:{type:String,default:""},emptyImage:{type:String,default:fj}},data:function(){return{tab:0,winHeight:window.innerHeight,currentCode:this.code||""}},computed:{buttonDisabled:function(){return!this.exchangeButtonLoading&&(this.exchangeButtonDisabled||!this.currentCode||this.currentCode.length<this.exchangeMinLength)},listStyle:function(){return{height:this.winHeight-(this.showExchangeBar?140:94)+"px"}}},watch:{code:function(t){this.currentCode=t},currentCode:function(t){this.$emit("input",t)},displayedCouponIndex:"scrollToShowCoupon"},mounted:function(){this.scrollToShowCoupon(this.displayedCouponIndex)},methods:{onClickExchangeButton:function(){this.$emit("exchange",this.currentCode),this.code||(this.currentCode="")},scrollToShowCoupon:function(t){var n=this;t!==-1&&this.$nextTick(function(){var i=n.$refs,o=i.card,a=i.list;a&&o&&o[t]&&(a.scrollTop=o[t].$el.offsetTop-100)})},genEmpty:function(){var t=this.$createElement;return t("div",{class:fa("empty")},[t("img",{attrs:{src:this.emptyImage}}),t("p",[Fh("empty")])])},genExchangeButton:function(){var t=this.$createElement;return t(Pr,{attrs:{plain:!0,type:"danger",text:this.exchangeButtonText||Fh("exchange"),loading:this.exchangeButtonLoading,disabled:this.buttonDisabled},class:fa("exchange"),on:{click:this.onClickExchangeButton}})}},render:function(){var t=this,n=arguments[0],i=this.coupons,o=this.disabledCoupons,a=this.showCount?" ("+i.length+")":"",l=(this.enabledTitle||Fh("enable"))+a,c=this.showCount?" ("+o.length+")":"",u=(this.disabledTitle||Fh("disabled"))+c,h=this.showExchangeBar&&n("div",{class:fa("exchange-bar")},[n(lo,{attrs:{clearable:!0,border:!1,placeholder:this.inputPlaceholder||Fh("placeholder"),maxlength:"20"},class:fa("field"),model:{value:t.currentCode,callback:function(g){t.currentCode=g}}}),this.genExchangeButton()]),d=function(g){return function(){return t.$emit("change",g)}},f=n(Z1,{attrs:{title:l}},[n("div",{class:fa("list",{"with-bottom":this.showCloseButton}),style:this.listStyle},[i.map(function(m,g){return n(C3,{ref:"card",key:m.id,attrs:{coupon:m,currency:t.currency,chosen:g===t.chosenCoupon},nativeOn:{click:d(g)}})}),!i.length&&this.genEmpty(),this.slots("list-footer")])]),p=n(Z1,{attrs:{title:u}},[n("div",{class:fa("list",{"with-bottom":this.showCloseButton}),style:this.listStyle},[o.map(function(m){return n(C3,{attrs:{disabled:!0,coupon:m,currency:t.currency},key:m.id})}),!o.length&&this.genEmpty(),this.slots("disabled-list-footer")])]);return n("div",{class:fa()},[h,n(t4,{class:fa("tab"),attrs:{border:!1},model:{value:t.tab,callback:function(g){t.tab=g}}},[f,p]),n("div",{class:fa("bottom")},[n(Pr,{directives:[{name:"show",value:this.showCloseButton}],attrs:{round:!0,type:"danger",block:!0,text:this.closeButtonText||Fh("close")},class:fa("close"),on:{click:d(-1)}})])])}});var S5=re({},K2,{value:null,filter:Function,columnsOrder:Array,showToolbar:{type:Boolean,default:!0},formatter:{type:Function,default:function(t,n){return n}}}),_5={data:function(){return{innerValue:this.formatValue(this.value)}},computed:{originColumns:function(){var t=this;return this.ranges.map(function(n){var i=n.type,o=n.range,a=sH(o[1]-o[0]+1,function(l){var c=Ms(o[0]+l);return c});return t.filter&&(a=t.filter(i,a)),{type:i,values:a}})},columns:function(){var t=this;return this.originColumns.map(function(n){return{values:n.values.map(function(i){return t.formatter(n.type,i)})}})}},watch:{columns:"updateColumnValue",innerValue:function(t,n){n?this.$emit("input",t):this.$emit("input",null)}},mounted:function(){var t=this;this.updateColumnValue(),this.$nextTick(function(){t.updateInnerValue()})},methods:{getPicker:function(){return this.$refs.picker},getProxiedPicker:function(){var t=this,n=this.$refs.picker;if(n){var i=function(a){return function(){n[a].apply(n,arguments),t.updateInnerValue()}};return re({},n,{setValues:i("setValues"),setIndexes:i("setIndexes"),setColumnIndex:i("setColumnIndex"),setColumnValue:i("setColumnValue")})}},onConfirm:function(){this.$emit("input",this.innerValue),this.$emit("confirm",this.innerValue)},onCancel:function(){this.$emit("cancel")}},render:function(){var t=this,n=arguments[0],i={};return Object.keys(K2).forEach(function(o){i[o]=t[o]}),n(WS,{ref:"picker",attrs:{columns:this.columns,readonly:this.readonly},scopedSlots:this.$scopedSlots,on:{change:this.onChange,confirm:this.onConfirm,cancel:this.onCancel},props:re({},i)})}},mj=Ht("time-picker"),gj=mj[0];const w$=gj({mixins:[_5],props:re({},S5,{minHour:{type:[Number,String],default:0},maxHour:{type:[Number,String],default:23},minMinute:{type:[Number,String],default:0},maxMinute:{type:[Number,String],default:59}}),computed:{ranges:function(){return[{type:"hour",range:[+this.minHour,+this.maxHour]},{type:"minute",range:[+this.minMinute,+this.maxMinute]}]}},watch:{filter:"updateInnerValue",minHour:function(){var t=this;this.$nextTick(function(){t.updateInnerValue()})},maxHour:function(t){var n=this.innerValue.split(":"),i=n[0],o=n[1];i>=t?(this.innerValue=this.formatValue(t+":"+o),this.updateColumnValue()):this.updateInnerValue()},minMinute:"updateInnerValue",maxMinute:function(t){var n=this.innerValue.split(":"),i=n[0],o=n[1];o>=t?(this.innerValue=this.formatValue(i+":"+t),this.updateColumnValue()):this.updateInnerValue()},value:function(t){t=this.formatValue(t),t!==this.innerValue&&(this.innerValue=t,this.updateColumnValue())}},methods:{formatValue:function(t){t||(t=Ms(this.minHour)+":"+Ms(this.minMinute));var n=t.split(":"),i=n[0],o=n[1];return i=Ms(Dr(i,this.minHour,this.maxHour)),o=Ms(Dr(o,this.minMinute,this.maxMinute)),i+":"+o},updateInnerValue:function(){var t=this.getPicker().getIndexes(),n=t[0],i=t[1],o=this.originColumns,a=o[0],l=o[1],c=a.values[n]||a.values[0],u=l.values[i]||l.values[0];this.innerValue=this.formatValue(c+":"+u),this.updateColumnValue()},onChange:function(t){var n=this;this.updateInnerValue(),this.$nextTick(function(){n.$nextTick(function(){n.updateInnerValue(),n.$emit("change",t)})})},updateColumnValue:function(){var t=this,n=this.formatter,i=this.innerValue.split(":"),o=[n("hour",i[0]),n("minute",i[1])];this.$nextTick(function(){t.getPicker().setValues(o)})}}});function $3(r,t){return $3=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,o){return i.__proto__=o,i},$3(r,t)}function vj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ap(r,t,n){return vj()?Ap=Reflect.construct.bind():Ap=function(o,a,l){var c=[null];c.push.apply(c,a);var u=Function.bind.apply(o,c),h=new u;return l&&$3(h,l.prototype),h},Ap.apply(null,arguments)}var S$=new Date().getFullYear(),yj=Ht("date-picker"),xj=yj[0];const _$=xj({mixins:[_5],props:re({},S5,{type:{type:String,default:"datetime"},minDate:{type:Date,default:function(){return new Date(S$-10,0,1)},validator:Np},maxDate:{type:Date,default:function(){return new Date(S$+10,11,31)},validator:Np}}),watch:{filter:"updateInnerValue",minDate:function(){var t=this;this.$nextTick(function(){t.updateInnerValue()})},maxDate:function(t){this.innerValue.valueOf()>=t.valueOf()?this.innerValue=t:this.updateInnerValue()},value:function(t){t=this.formatValue(t),t&&t.valueOf()!==this.innerValue.valueOf()&&(this.innerValue=t)}},computed:{ranges:function(){var t=this.getBoundary("max",this.innerValue?this.innerValue:this.minDate),n=t.maxYear,i=t.maxDate,o=t.maxMonth,a=t.maxHour,l=t.maxMinute,c=this.getBoundary("min",this.innerValue?this.innerValue:this.minDate),u=c.minYear,h=c.minDate,d=c.minMonth,f=c.minHour,p=c.minMinute,m=[{type:"year",range:[u,n]},{type:"month",range:[d,o]},{type:"day",range:[h,i]},{type:"hour",range:[f,a]},{type:"minute",range:[p,l]}];switch(this.type){case"date":m=m.slice(0,3);break;case"year-month":m=m.slice(0,2);break;case"month-day":m=m.slice(1,3);break;case"datehour":m=m.slice(0,4);break}if(this.columnsOrder){var g=this.columnsOrder.concat(m.map(function(y){return y.type}));m.sort(function(y,v){return g.indexOf(y.type)-g.indexOf(v.type)})}return m}},methods:{formatValue:function(t){var n=this;if(!Np(t))return null;var i=new Date(this.minDate),o=new Date(this.maxDate),a={year:"getFullYear",month:"getMonth",day:"getDate",hour:"getHours",minute:"getMinutes"};if(this.originColumns){var l=this.originColumns.map(function(h,d){var f=h.type,p=h.values,m=n.ranges[d].range,g=i[a[f]](),y=o[a[f]](),v=f==="month"?+p[0]-1:+p[0],x=f==="month"?+p[p.length-1]-1:+p[p.length-1];return{type:f,values:[g<m[0]?Math.max(g,v):v||g,y>m[1]?Math.min(y,x):x||y]}});if(this.type==="month-day"){var c=(this.innerValue||this.minDate).getFullYear();l.unshift({type:"year",values:[c,c]})}var u=Object.keys(a).map(function(h){var d;return(d=l.filter(function(f){return f.type===h})[0])==null?void 0:d.values}).filter(function(h){return h});i=Ap(Date,u.map(function(h){return xx(h[0])})),o=Ap(Date,u.map(function(h){return xx(h[1])}))}return t=Math.max(t,i.getTime()),t=Math.min(t,o.getTime()),new Date(t)},getBoundary:function(t,n){var i,o=this[t+"Date"],a=o.getFullYear(),l=1,c=1,u=0,h=0;return t==="max"&&(l=12,c=w3(n.getFullYear(),n.getMonth()+1),u=23,h=59),n.getFullYear()===a&&(l=o.getMonth()+1,n.getMonth()+1===l&&(c=o.getDate(),n.getDate()===c&&(u=o.getHours(),n.getHours()===u&&(h=o.getMinutes())))),i={},i[t+"Year"]=a,i[t+"Month"]=l,i[t+"Date"]=c,i[t+"Hour"]=u,i[t+"Minute"]=h,i},updateInnerValue:function(){var t=this,n=this.type,i=this.getPicker().getIndexes(),o=function(m){var g=0;t.originColumns.forEach(function(v,x){m===v.type&&(g=x)});var y=t.originColumns[g].values;return xx(y[i[g]])},a,l,c;n==="month-day"?(a=(this.innerValue||this.minDate).getFullYear(),l=o("month"),c=o("day")):(a=o("year"),l=o("month"),c=n==="year-month"?1:o("day"));var u=w3(a,l);c=c>u?u:c;var h=0,d=0;n==="datehour"&&(h=o("hour")),n==="datetime"&&(h=o("hour"),d=o("minute"));var f=new Date(a,l-1,c,h,d);this.innerValue=this.formatValue(f)},onChange:function(t){var n=this;this.updateInnerValue(),this.$nextTick(function(){n.$nextTick(function(){n.updateInnerValue(),n.$emit("change",t)})})},updateColumnValue:function(){var t=this,n=this.innerValue?this.innerValue:this.minDate,i=this.formatter,o=this.originColumns.map(function(a){switch(a.type){case"year":return i("year",""+n.getFullYear());case"month":return i("month",Ms(n.getMonth()+1));case"day":return i("day",Ms(n.getDate()));case"hour":return i("hour",Ms(n.getHours()));case"minute":return i("minute",Ms(n.getMinutes()));default:return null}});this.$nextTick(function(){t.getPicker().setValues(o)})}}});var T5=Ht("datetime-picker"),bj=T5[0],wj=T5[1];const C5=bj({props:re({},w$.props,_$.props),methods:{getPicker:function(){return this.$refs.root.getProxiedPicker()}},render:function(){var t=arguments[0],n=this.type==="time"?w$:_$;return t(n,{ref:"root",class:wj(),scopedSlots:this.$scopedSlots,props:re({},this.$props),on:re({},this.$listeners)})}});var k5=Ht("divider"),Sj=k5[0],_j=k5[1];function $5(r,t,n,i){var o;return r("div",mn([{attrs:{role:"separator"},style:{borderColor:t.borderColor},class:_j((o={dashed:t.dashed,hairline:t.hairline},o["content-"+t.contentPosition]=n.default,o))},Xn(i,!0)]),[n.default&&n.default()])}$5.props={dashed:Boolean,hairline:{type:Boolean,default:!0},contentPosition:{type:String,default:"center"}};const Tj=Sj($5);var I5=Ht("dropdown-item"),Cj=I5[0],b0=I5[1];const kj=Cj({mixins:[zS({ref:"wrapper"}),wi("vanDropdownMenu")],props:{value:null,title:String,disabled:Boolean,titleClass:String,options:{type:Array,default:function(){return[]}},lazyRender:{type:Boolean,default:!0}},data:function(){return{transition:!0,showPopup:!1,showWrapper:!1}},computed:{displayTitle:function(){var t=this;if(this.title)return this.title;var n=this.options.filter(function(i){return i.value===t.value});return n.length?n[0].text:""}},watch:{showPopup:function(t){this.bindScroll(t)}},beforeCreate:function(){var t=this,n=function(o){return function(){return t.$emit(o)}};this.onOpen=n("open"),this.onClose=n("close"),this.onOpened=n("opened")},methods:{toggle:function(t,n){t===void 0&&(t=!this.showPopup),n===void 0&&(n={}),t!==this.showPopup&&(this.transition=!n.immediate,this.showPopup=t,t&&(this.parent.updateOffset(),this.showWrapper=!0))},bindScroll:function(t){var n=this.parent.scroller,i=t?ao:wc;i(n,"scroll",this.onScroll,!0)},onScroll:function(){this.parent.updateOffset()},onClickWrapper:function(t){this.getContainer&&t.stopPropagation()}},render:function(){var t=this,n=arguments[0],i=this.parent,o=i.zIndex,a=i.offset,l=i.overlay,c=i.duration,u=i.direction,h=i.activeColor,d=i.closeOnClickOverlay,f=this.options.map(function(m){var g=m.value===t.value;return n(ei,{attrs:{clickable:!0,icon:m.icon,title:m.text},key:m.value,class:b0("option",{active:g}),style:{color:g?h:""},on:{click:function(){t.showPopup=!1,m.value!==t.value&&(t.$emit("input",m.value),t.$emit("change",m.value))}}},[g&&n(cn,{class:b0("icon"),attrs:{color:h,name:"success"}})])}),p={zIndex:o};return u==="down"?p.top=a+"px":p.bottom=a+"px",n("div",[n("div",{directives:[{name:"show",value:this.showWrapper}],ref:"wrapper",style:p,class:b0([u]),on:{click:this.onClickWrapper}},[n(Va,{attrs:{overlay:l,position:u==="down"?"top":"bottom",duration:this.transition?c:0,lazyRender:this.lazyRender,overlayStyle:{position:"absolute"},closeOnClickOverlay:d},class:b0("content"),on:{open:this.onOpen,close:this.onClose,opened:this.onOpened,closed:function(){t.showWrapper=!1,t.$emit("closed")}},model:{value:t.showPopup,callback:function(g){t.showPopup=g}}},[f,this.slots("default")])])])}});var c4=function(t){return{props:{closeOnClickOutside:{type:Boolean,default:!0}},data:function(){var i=this,o=function(l){i.closeOnClickOutside&&!i.$el.contains(l.target)&&i[t.method]()};return{clickOutsideHandler:o}},mounted:function(){ao(document,t.event,this.clickOutsideHandler)},beforeDestroy:function(){wc(document,t.event,this.clickOutsideHandler)}}},E5=Ht("dropdown-menu"),$j=E5[0],w0=E5[1];const Ij=$j({mixins:[Si("vanDropdownMenu"),c4({event:"click",method:"onClickOutside"})],props:{zIndex:[Number,String],activeColor:String,overlay:{type:Boolean,default:!0},duration:{type:[Number,String],default:.2},direction:{type:String,default:"down"},closeOnClickOverlay:{type:Boolean,default:!0}},data:function(){return{offset:0}},computed:{scroller:function(){return ph(this.$el)},opened:function(){return this.children.some(function(t){return t.showWrapper})},barStyle:function(){if(this.opened&&gn(this.zIndex))return{zIndex:1+this.zIndex}}},methods:{updateOffset:function(){if(this.$refs.bar){var t=this.$refs.bar.getBoundingClientRect();this.direction==="down"?this.offset=t.bottom:this.offset=window.innerHeight-t.top}},toggleItem:function(t){this.children.forEach(function(n,i){i===t?n.toggle():n.showPopup&&n.toggle(!1,{immediate:!0})})},onClickOutside:function(){this.children.forEach(function(t){t.toggle(!1)})}},render:function(){var t=this,n=arguments[0],i=this.children.map(function(o,a){return n("div",{attrs:{role:"button",tabindex:o.disabled?-1:0},class:w0("item",{disabled:o.disabled}),on:{click:function(){o.disabled||t.toggleItem(a)}}},[n("span",{class:[w0("title",{active:o.showPopup,down:o.showPopup===(t.direction==="down")}),o.titleClass],style:{color:o.showPopup?t.activeColor:""}},[n("div",{class:"van-ellipsis"},[o.slots("title")||o.displayTitle])])])});return n("div",{class:w0()},[n("div",{ref:"bar",style:this.barStyle,class:w0("bar",{opened:this.opened})},[i]),this.slots("default")])}});var vr="van-empty-network-";const Ej={render:function(){var t=arguments[0],n=function(o,a,l){return t("stop",{attrs:{"stop-color":o,offset:a+"%","stop-opacity":l}})};return t("svg",{attrs:{viewBox:"0 0 160 160",xmlns:"http://www.w3.org/2000/svg"}},[t("defs",[t("linearGradient",{attrs:{id:vr+"1",x1:"64.022%",y1:"100%",x2:"64.022%",y2:"0%"}},[n("#FFF",0,.5),n("#F2F3F5",100)]),t("linearGradient",{attrs:{id:vr+"2",x1:"50%",y1:"0%",x2:"50%",y2:"84.459%"}},[n("#EBEDF0",0),n("#DCDEE0",100,0)]),t("linearGradient",{attrs:{id:vr+"3",x1:"100%",y1:"0%",x2:"100%",y2:"100%"}},[n("#EAEDF0",0),n("#DCDEE0",100)]),t("linearGradient",{attrs:{id:vr+"4",x1:"100%",y1:"100%",x2:"100%",y2:"0%"}},[n("#EAEDF0",0),n("#DCDEE0",100)]),t("linearGradient",{attrs:{id:vr+"5",x1:"0%",y1:"43.982%",x2:"100%",y2:"54.703%"}},[n("#EAEDF0",0),n("#DCDEE0",100)]),t("linearGradient",{attrs:{id:vr+"6",x1:"94.535%",y1:"43.837%",x2:"5.465%",y2:"54.948%"}},[n("#EAEDF0",0),n("#DCDEE0",100)]),t("radialGradient",{attrs:{id:vr+"7",cx:"50%",cy:"0%",fx:"50%",fy:"0%",r:"100%",gradientTransform:"matrix(0 1 -.54835 0 .5 -.5)"}},[n("#EBEDF0",0),n("#FFF",100,0)])]),t("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[t("g",{attrs:{opacity:".8"}},[t("path",{attrs:{d:"M0 124V46h20v20h14v58H0z",fill:"url(#"+vr+"1)",transform:"matrix(-1 0 0 1 36 7)"}}),t("path",{attrs:{d:"M121 8h22.231v14H152v77.37h-31V8z",fill:"url(#"+vr+"1)",transform:"translate(2 7)"}})]),t("path",{attrs:{fill:"url(#"+vr+"7)",d:"M0 139h160v21H0z"}}),t("path",{attrs:{d:"M37 18a7 7 0 013 13.326v26.742c0 1.23-.997 2.227-2.227 2.227h-1.546A2.227 2.227 0 0134 58.068V31.326A7 7 0 0137 18z",fill:"url(#"+vr+"2)","fill-rule":"nonzero",transform:"translate(43 36)"}}),t("g",{attrs:{opacity:".6","stroke-linecap":"round","stroke-width":"7"}},[t("path",{attrs:{d:"M20.875 11.136a18.868 18.868 0 00-5.284 13.121c0 5.094 2.012 9.718 5.284 13.12",stroke:"url(#"+vr+"3)",transform:"translate(43 36)"}}),t("path",{attrs:{d:"M9.849 0C3.756 6.225 0 14.747 0 24.146c0 9.398 3.756 17.92 9.849 24.145",stroke:"url(#"+vr+"3)",transform:"translate(43 36)"}}),t("path",{attrs:{d:"M57.625 11.136a18.868 18.868 0 00-5.284 13.121c0 5.094 2.012 9.718 5.284 13.12",stroke:"url(#"+vr+"4)",transform:"rotate(-180 76.483 42.257)"}}),t("path",{attrs:{d:"M73.216 0c-6.093 6.225-9.849 14.747-9.849 24.146 0 9.398 3.756 17.92 9.849 24.145",stroke:"url(#"+vr+"4)",transform:"rotate(-180 89.791 42.146)"}})]),t("g",{attrs:{transform:"translate(31 105)","fill-rule":"nonzero"}},[t("rect",{attrs:{fill:"url(#"+vr+"5)",width:"98",height:"34",rx:"2"}}),t("rect",{attrs:{fill:"#FFF",x:"9",y:"8",width:"80",height:"18",rx:"1.114"}}),t("rect",{attrs:{fill:"url(#"+vr+"6)",x:"15",y:"12",width:"18",height:"6",rx:"1.114"}})])])])}};var N5=Ht("empty"),Nj=N5[0],S0=N5[1],Aj=["error","search","default"];const Mj=Nj({props:{imageSize:[Number,String],description:String,image:{type:String,default:"default"}},methods:{genImageContent:function(){var t=this.$createElement,n=this.slots("image");if(n)return n;if(this.image==="network")return t(Ej);var i=this.image;return Aj.indexOf(i)!==-1&&(i="https://img01.yzcdn.cn/vant/empty-image-"+i+".png"),t("img",{attrs:{src:i}})},genImage:function(){var t=this.$createElement,n={width:kn(this.imageSize),height:kn(this.imageSize)};return t("div",{class:S0("image"),style:n},[this.genImageContent()])},genDescription:function(){var t=this.$createElement,n=this.slots("description")||this.description;if(n)return t("p",{class:S0("description")},[n])},genBottom:function(){var t=this.$createElement,n=this.slots();if(n)return t("div",{class:S0("bottom")},[n])}},render:function(){var t=arguments[0];return t("div",{class:S0()},[this.genImage(),this.genDescription(),this.genBottom()])}});var A5=Ht("form"),Dj=A5[0],Rj=A5[1];const Oj=Dj({props:{colon:Boolean,disabled:Boolean,readonly:Boolean,labelWidth:[Number,String],labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,errorMessageAlign:String,submitOnEnter:{type:Boolean,default:!0},validateTrigger:{type:String,default:"onBlur"},showError:{type:Boolean,default:!0},showErrorMessage:{type:Boolean,default:!0}},provide:function(){return{vanForm:this}},data:function(){return{fields:[]}},methods:{getFieldsByNames:function(t){return t?this.fields.filter(function(n){return t.indexOf(n.name)!==-1}):this.fields},validateSeq:function(t){var n=this;return new Promise(function(i,o){var a=[],l=n.getFieldsByNames(t);l.reduce(function(c,u){return c.then(function(){if(!a.length)return u.validate().then(function(h){h&&a.push(h)})})},Promise.resolve()).then(function(){a.length?o(a):i()})})},validateFields:function(t){var n=this;return new Promise(function(i,o){var a=n.getFieldsByNames(t);Promise.all(a.map(function(l){return l.validate()})).then(function(l){l=l.filter(function(c){return c}),l.length?o(l):i()})})},validate:function(t){return t&&!Array.isArray(t)?this.validateField(t):this.validateFirst?this.validateSeq(t):this.validateFields(t)},validateField:function(t){var n=this.fields.filter(function(i){return i.name===t});return n.length?new Promise(function(i,o){n[0].validate().then(function(a){a?o(a):i()})}):Promise.reject()},resetValidation:function(t){t&&!Array.isArray(t)&&(t=[t]);var n=this.getFieldsByNames(t);n.forEach(function(i){i.resetValidation()})},scrollToField:function(t,n){this.fields.some(function(i){return i.name===t?(i.$el.scrollIntoView(n),!0):!1})},addField:function(t){this.fields.push(t),L6(this.fields,this)},removeField:function(t){this.fields=this.fields.filter(function(n){return n!==t})},getValues:function(){return this.fields.reduce(function(t,n){return t[n.name]=n.formValue,t},{})},onSubmit:function(t){t.preventDefault(),this.submit()},submit:function(){var t=this,n=this.getValues();this.validate().then(function(){t.$emit("submit",n)}).catch(function(i){t.$emit("failed",{values:n,errors:i}),t.scrollToError&&t.scrollToField(i[0].name)})}},render:function(){var t=arguments[0];return t("form",{class:Rj(),on:{submit:this.onSubmit}},[this.slots()])}});var M5=Ht("goods-action-icon"),Lj=M5[0],Cx=M5[1];const Fj=Lj({mixins:[wi("vanGoodsAction")],props:re({},Rc,{dot:Boolean,text:String,icon:String,color:String,info:[Number,String],badge:[Number,String],iconClass:null}),methods:{onClick:function(t){this.$emit("click",t),vh(this.$router,this)},genIcon:function(){var t,n=this.$createElement,i=this.slots("icon"),o=(t=this.badge)!=null?t:this.info;return i?n("div",{class:Cx("icon")},[i,n(gh,{attrs:{dot:this.dot,info:o}})]):n(cn,{class:[Cx("icon"),this.iconClass],attrs:{tag:"div",dot:this.dot,name:this.icon,badge:o,color:this.color}})}},render:function(){var t=arguments[0];return t("div",{attrs:{role:"button",tabindex:"0"},class:Cx(),on:{click:this.onClick}},[this.genIcon(),this.slots()||this.text])}});var D5=Ht("grid"),Pj=D5[0],Bj=D5[1];const zj=Pj({mixins:[Si("vanGrid")],props:{square:Boolean,gutter:[Number,String],iconSize:[Number,String],direction:String,clickable:Boolean,columnNum:{type:[Number,String],default:4},center:{type:Boolean,default:!0},border:{type:Boolean,default:!0}},computed:{style:function(){var t=this.gutter;if(t)return{paddingLeft:kn(t)}}},render:function(){var t,n=arguments[0];return n("div",{style:this.style,class:[Bj(),(t={},t[VS]=this.border&&!this.gutter,t)]},[this.slots()])}});var R5=Ht("grid-item"),Vj=R5[0],qf=R5[1];const Uj=Vj({mixins:[wi("vanGrid")],props:re({},Rc,{dot:Boolean,text:String,icon:String,iconPrefix:String,info:[Number,String],badge:[Number,String]}),computed:{style:function(){var t=this.parent,n=t.square,i=t.gutter,o=t.columnNum,a=100/o+"%",l={flexBasis:a};if(n)l.paddingTop=a;else if(i){var c=kn(i);l.paddingRight=c,this.index>=o&&(l.marginTop=c)}return l},contentStyle:function(){var t=this.parent,n=t.square,i=t.gutter;if(n&&i){var o=kn(i);return{right:o,bottom:o,height:"auto"}}}},methods:{onClick:function(t){this.$emit("click",t),vh(this.$router,this)},genIcon:function(){var t,n=this.$createElement,i=this.slots("icon"),o=(t=this.badge)!=null?t:this.info;if(i)return n("div",{class:qf("icon-wrapper")},[i,n(gh,{attrs:{dot:this.dot,info:o}})]);if(this.icon)return n(cn,{attrs:{name:this.icon,dot:this.dot,badge:o,size:this.parent.iconSize,classPrefix:this.iconPrefix},class:qf("icon")})},getText:function(){var t=this.$createElement,n=this.slots("text");if(n)return n;if(this.text)return t("span",{class:qf("text")},[this.text])},genContent:function(){var t=this.slots();return t||[this.genIcon(),this.getText()]}},render:function(){var t,n=arguments[0],i=this.parent,o=i.center,a=i.border,l=i.square,c=i.gutter,u=i.direction,h=i.clickable;return n("div",{class:[qf({square:l})],style:this.style},[n("div",{style:this.contentStyle,attrs:{role:h?"button":null,tabindex:h?0:null},class:[qf("content",[u,{center:o,square:l,clickable:h,surround:a&&c}]),(t={},t[Ho]=a,t)],on:{click:this.onClick}},[this.genContent()])])}});var O5=Ht("image-preview"),Wj=O5[0],Yl=O5[1],L5=Ht("swipe"),Gj=L5[0],_0=L5[1];const F5=Gj({mixins:[To,Si("vanSwipe"),ra(function(r,t){r(window,"resize",this.resize,!0),r(window,"orientationchange",this.resize,!0),r(window,"visibilitychange",this.onVisibilityChange),t?this.initialize():this.clear()})],props:{width:[Number,String],height:[Number,String],autoplay:[Number,String],vertical:Boolean,lazyRender:Boolean,indicatorColor:String,loop:{type:Boolean,default:!0},duration:{type:[Number,String],default:500},touchable:{type:Boolean,default:!0},initialSwipe:{type:[Number,String],default:0},showIndicators:{type:Boolean,default:!0},stopPropagation:{type:Boolean,default:!0}},data:function(){return{rect:null,offset:0,active:0,deltaX:0,deltaY:0,swiping:!1,computedWidth:0,computedHeight:0}},watch:{children:function(){this.initialize()},initialSwipe:function(){this.initialize()},autoplay:function(t){t>0?this.autoPlay():this.clear()}},computed:{count:function(){return this.children.length},maxCount:function(){return Math.ceil(Math.abs(this.minOffset)/this.size)},delta:function(){return this.vertical?this.deltaY:this.deltaX},size:function(){return this[this.vertical?"computedHeight":"computedWidth"]},trackSize:function(){return this.count*this.size},activeIndicator:function(){return(this.active+this.count)%this.count},isCorrectDirection:function(){var t=this.vertical?"vertical":"horizontal";return this.direction===t},trackStyle:function(){var t={transitionDuration:(this.swiping?0:this.duration)+"ms",transform:"translate"+(this.vertical?"Y":"X")+"("+this.offset+"px)"};if(this.size){var n=this.vertical?"height":"width",i=this.vertical?"width":"height";t[n]=this.trackSize+"px",t[i]=this[i]?this[i]+"px":""}return t},indicatorStyle:function(){return{backgroundColor:this.indicatorColor}},minOffset:function(){return(this.vertical?this.rect.height:this.rect.width)-this.size*this.count}},mounted:function(){this.bindTouchEvent(this.$refs.track)},methods:{initialize:function(t){if(t===void 0&&(t=+this.initialSwipe),!(!this.$el||Tm(this.$el))){clearTimeout(this.timer);var n={width:this.$el.offsetWidth,height:this.$el.offsetHeight};this.rect=n,this.swiping=!0,this.active=t,this.computedWidth=+this.width||n.width,this.computedHeight=+this.height||n.height,this.offset=this.getTargetOffset(t),this.children.forEach(function(i){i.offset=0}),this.autoPlay()}},resize:function(){this.initialize(this.activeIndicator)},onVisibilityChange:function(){document.hidden?this.clear():this.autoPlay()},onTouchStart:function(t){this.touchable&&(this.clear(),this.touchStartTime=Date.now(),this.touchStart(t),this.correctPosition())},onTouchMove:function(t){!this.touchable||!this.swiping||(this.touchMove(t),this.isCorrectDirection&&(wr(t,this.stopPropagation),this.move({offset:this.delta})))},onTouchEnd:function(){if(!(!this.touchable||!this.swiping)){var t=this.size,n=this.delta,i=Date.now()-this.touchStartTime,o=n/i,a=Math.abs(o)>.25||Math.abs(n)>t/2;if(a&&this.isCorrectDirection){var l=this.vertical?this.offsetY:this.offsetX,c=0;this.loop?c=l>0?n>0?-1:1:0:c=-Math[n>0?"ceil":"floor"](n/t),this.move({pace:c,emitChange:!0})}else n&&this.move({pace:0});this.swiping=!1,this.autoPlay()}},getTargetActive:function(t){var n=this.active,i=this.count,o=this.maxCount;return t?this.loop?Dr(n+t,-1,i):Dr(n+t,0,o):n},getTargetOffset:function(t,n){n===void 0&&(n=0);var i=t*this.size;this.loop||(i=Math.min(i,-this.minOffset));var o=n-i;return this.loop||(o=Dr(o,this.minOffset,0)),o},move:function(t){var n=t.pace,i=n===void 0?0:n,o=t.offset,a=o===void 0?0:o,l=t.emitChange,c=this.loop,u=this.count,h=this.active,d=this.children,f=this.trackSize,p=this.minOffset;if(!(u<=1)){var m=this.getTargetActive(i),g=this.getTargetOffset(m,a);if(c){if(d[0]&&g!==p){var y=g<p;d[0].offset=y?f:0}if(d[u-1]&&g!==0){var v=g>0;d[u-1].offset=v?-f:0}}this.active=m,this.offset=g,l&&m!==h&&this.$emit("change",this.activeIndicator)}},prev:function(){var t=this;this.correctPosition(),this.resetTouchStatus(),yu(function(){t.swiping=!1,t.move({pace:-1,emitChange:!0})})},next:function(){var t=this;this.correctPosition(),this.resetTouchStatus(),yu(function(){t.swiping=!1,t.move({pace:1,emitChange:!0})})},swipeTo:function(t,n){var i=this;n===void 0&&(n={}),this.correctPosition(),this.resetTouchStatus(),yu(function(){var o;i.loop&&t===i.count?o=i.active===0?0:t:o=t%i.count,n.immediate?yu(function(){i.swiping=!1}):i.swiping=!1,i.move({pace:o-i.active,emitChange:!0})})},correctPosition:function(){this.swiping=!0,this.active<=-1&&this.move({pace:this.count}),this.active>=this.count&&this.move({pace:-this.count})},clear:function(){clearTimeout(this.timer)},autoPlay:function(){var t=this,n=this.autoplay;n>0&&this.count>1&&(this.clear(),this.timer=setTimeout(function(){t.next(),t.autoPlay()},n))},genIndicator:function(){var t=this,n=this.$createElement,i=this.count,o=this.activeIndicator,a=this.slots("indicator");if(a)return a;if(this.showIndicators&&i>1)return n("div",{class:_0("indicators",{vertical:this.vertical})},[Array.apply(void 0,Array(i)).map(function(l,c){return n("i",{class:_0("indicator",{active:c===o}),style:c===o?t.indicatorStyle:null})})])}},render:function(){var t=arguments[0];return t("div",{class:_0()},[t("div",{ref:"track",style:this.trackStyle,class:_0("track",{vertical:this.vertical})},[this.slots()]),this.genIndicator()])}});var P5=Ht("swipe-item"),Hj=P5[0],jj=P5[1];const B5=Hj({mixins:[wi("vanSwipe")],data:function(){return{offset:0,inited:!1,mounted:!1}},mounted:function(){var t=this;this.$nextTick(function(){t.mounted=!0})},computed:{style:function(){var t={},n=this.parent,i=n.size,o=n.vertical;return i&&(t[o?"height":"width"]=i+"px"),this.offset&&(t.transform="translate"+(o?"Y":"X")+"("+this.offset+"px)"),t},shouldRender:function(){var t=this.index,n=this.inited,i=this.parent,o=this.mounted;if(!i.lazyRender||n)return!0;if(!o)return!1;var a=i.activeIndicator,l=i.count-1,c=a===0&&i.loop?l:a-1,u=a===l&&i.loop?0:a+1,h=t===a||t===c||t===u;return h&&(this.inited=!0),h}},render:function(){var t=arguments[0];return t("div",{class:jj(),style:this.style,on:re({},this.$listeners)},[this.shouldRender&&this.slots()])}});function T$(r){return Math.sqrt(Math.pow(r[0].clientX-r[1].clientX,2)+Math.pow(r[0].clientY-r[1].clientY,2))}const qj={mixins:[To],props:{src:String,show:Boolean,active:Number,minZoom:[Number,String],maxZoom:[Number,String],rootWidth:Number,rootHeight:Number},data:function(){return{scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}},computed:{vertical:function(){var t=this.rootWidth,n=this.rootHeight,i=n/t;return this.imageRatio>i},imageStyle:function(){var t=this.scale,n={transitionDuration:this.zooming||this.moving?"0s":".3s"};if(t!==1){var i=this.moveX/t,o=this.moveY/t;n.transform="scale("+t+", "+t+") translate("+i+"px, "+o+"px)"}return n},maxMoveX:function(){if(this.imageRatio){var t=this.vertical?this.rootHeight/this.imageRatio:this.rootWidth;return Math.max(0,(this.scale*t-this.rootWidth)/2)}return 0},maxMoveY:function(){if(this.imageRatio){var t=this.vertical?this.rootHeight:this.rootWidth*this.imageRatio;return Math.max(0,(this.scale*t-this.rootHeight)/2)}return 0}},watch:{active:"resetScale",show:function(t){t||this.resetScale()}},mounted:function(){this.bindTouchEvent(this.$el)},methods:{resetScale:function(){this.setScale(1),this.moveX=0,this.moveY=0},setScale:function(t){t=Dr(t,+this.minZoom,+this.maxZoom),t!==this.scale&&(this.scale=t,this.$emit("scale",{scale:this.scale,index:this.active}))},toggleScale:function(){var t=this.scale>1?1:2;this.setScale(t),this.moveX=0,this.moveY=0},onTouchStart:function(t){var n=t.touches,i=this.offsetX,o=i===void 0?0:i;this.touchStart(t),this.touchStartTime=new Date,this.fingerNum=n.length,this.startMoveX=this.moveX,this.startMoveY=this.moveY,this.moving=this.fingerNum===1&&this.scale!==1,this.zooming=this.fingerNum===2&&!o,this.zooming&&(this.startScale=this.scale,this.startDistance=T$(t.touches))},onTouchMove:function(t){var n=t.touches;if(this.touchMove(t),(this.moving||this.zooming)&&wr(t,!0),this.moving){var i=this.deltaX+this.startMoveX,o=this.deltaY+this.startMoveY;this.moveX=Dr(i,-this.maxMoveX,this.maxMoveX),this.moveY=Dr(o,-this.maxMoveY,this.maxMoveY)}if(this.zooming&&n.length===2){var a=T$(n),l=this.startScale*a/this.startDistance;this.setScale(l)}},onTouchEnd:function(t){var n=!1;(this.moving||this.zooming)&&(n=!0,this.moving&&this.startMoveX===this.moveX&&this.startMoveY===this.moveY&&(n=!1),t.touches.length||(this.zooming&&(this.moveX=Dr(this.moveX,-this.maxMoveX,this.maxMoveX),this.moveY=Dr(this.moveY,-this.maxMoveY,this.maxMoveY),this.zooming=!1),this.moving=!1,this.startMoveX=0,this.startMoveY=0,this.startScale=1,this.scale<1&&this.resetScale())),wr(t,n),this.checkTap(),this.resetTouchStatus()},checkTap:function(){var t=this;if(!(this.fingerNum>1)){var n=this.offsetX,i=n===void 0?0:n,o=this.offsetY,a=o===void 0?0:o,l=new Date-this.touchStartTime,c=250,u=5;i<u&&a<u&&l<c&&(this.doubleTapTimer?(clearTimeout(this.doubleTapTimer),this.doubleTapTimer=null,this.toggleScale()):this.doubleTapTimer=setTimeout(function(){t.$emit("close"),t.doubleTapTimer=null},c))}},onLoad:function(t){var n=t.target,i=n.naturalWidth,o=n.naturalHeight;this.imageRatio=o/i}},render:function(){var t=arguments[0],n={loading:function(){return t(ia,{attrs:{type:"spinner"}})}};return t(B5,{class:Yl("swipe-item")},[t(uf,{attrs:{src:this.src,fit:"contain"},class:Yl("image",{vertical:this.vertical}),style:this.imageStyle,scopedSlots:n,on:{load:this.onLoad}})])}},u4=Wj({mixins:[To,q2({skipToggleEvent:!0}),ra(function(r){r(window,"resize",this.resize,!0),r(window,"orientationchange",this.resize,!0)})],props:{className:null,closeable:Boolean,asyncClose:Boolean,overlayStyle:Object,showIndicators:Boolean,images:{type:Array,default:function(){return[]}},loop:{type:Boolean,default:!0},overlay:{type:Boolean,default:!0},minZoom:{type:[Number,String],default:1/3},maxZoom:{type:[Number,String],default:3},transition:{type:String,default:"van-fade"},showIndex:{type:Boolean,default:!0},swipeDuration:{type:[Number,String],default:300},startPosition:{type:[Number,String],default:0},overlayClass:{type:String,default:Yl("overlay")},closeIcon:{type:String,default:"clear"},closeOnPopstate:{type:Boolean,default:!0},closeIconPosition:{type:String,default:"top-right"}},data:function(){return{active:0,rootWidth:0,rootHeight:0,doubleClickTimer:null}},mounted:function(){this.resize()},watch:{startPosition:"setActive",value:function(t){var n=this;t?(this.setActive(+this.startPosition),this.$nextTick(function(){n.resize(),n.$refs.swipe.swipeTo(+n.startPosition,{immediate:!0})})):this.$emit("close",{index:this.active,url:this.images[this.active]})}},methods:{resize:function(){if(this.$el&&this.$el.getBoundingClientRect){var t=this.$el.getBoundingClientRect();this.rootWidth=t.width,this.rootHeight=t.height}},emitClose:function(){this.asyncClose||this.$emit("input",!1)},emitScale:function(t){this.$emit("scale",t)},setActive:function(t){t!==this.active&&(this.active=t,this.$emit("change",t))},genIndex:function(){var t=this.$createElement;if(this.showIndex)return t("div",{class:Yl("index")},[this.slots("index",{index:this.active})||this.active+1+" / "+this.images.length])},genCover:function(){var t=this.$createElement,n=this.slots("cover");if(n)return t("div",{class:Yl("cover")},[n])},genImages:function(){var t=this,n=this.$createElement;return n(F5,{ref:"swipe",attrs:{lazyRender:!0,loop:this.loop,duration:this.swipeDuration,initialSwipe:this.startPosition,showIndicators:this.showIndicators,indicatorColor:"white"},class:Yl("swipe"),on:{change:this.setActive}},[this.images.map(function(i){return n(qj,{attrs:{src:i,show:t.value,active:t.active,maxZoom:t.maxZoom,minZoom:t.minZoom,rootWidth:t.rootWidth,rootHeight:t.rootHeight},on:{scale:t.emitScale,close:t.emitClose}})})])},genClose:function(){var t=this.$createElement;if(this.closeable)return t(cn,{attrs:{role:"button",name:this.closeIcon},class:Yl("close-icon",this.closeIconPosition),on:{click:this.emitClose}})},onClosed:function(){this.$emit("closed")},swipeTo:function(t,n){this.$refs.swipe&&this.$refs.swipe.swipeTo(t,n)}},render:function(){var t=arguments[0];return t("transition",{attrs:{name:this.transition},on:{afterLeave:this.onClosed}},[this.shouldRender?t("div",{directives:[{name:"show",value:this.value}],class:[Yl(),this.className]},[this.genClose(),this.genImages(),this.genIndex(),this.genCover()]):null])}});var yr,Kj={loop:!0,value:!0,images:[],maxZoom:3,minZoom:1/3,onClose:null,onChange:null,className:"",showIndex:!0,closeable:!1,closeIcon:"clear",asyncClose:!1,transition:"van-fade",getContainer:"body",overlayStyle:null,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"},Xj=function(){yr=new(dn.extend(u4))({el:document.createElement("div")}),document.body.appendChild(yr.$el),yr.$on("change",function(t){yr.onChange&&yr.onChange(t)}),yr.$on("scale",function(t){yr.onScale&&yr.onScale(t)})},h4=function(t,n){if(n===void 0&&(n=0),!_o){yr||Xj();var i=Array.isArray(t)?{images:t,startPosition:n}:t;return re(yr,Kj,i),yr.$once("input",function(o){yr.value=o}),yr.$once("closed",function(){yr.images=[]}),i.onClose&&(yr.$off("close"),yr.$once("close",i.onClose)),yr}};h4.Component=u4;h4.install=function(){dn.use(u4)};const d4=h4;var z5=Ht("index-anchor"),Yj=z5[0],Zj=z5[1];const Jj=Yj({mixins:[wi("vanIndexBar",{indexKey:"childrenIndex"})],props:{index:[Number,String]},data:function(){return{top:0,left:null,rect:{top:0,height:0},width:null,active:!1}},computed:{sticky:function(){return this.active&&this.parent.sticky},anchorStyle:function(){if(this.sticky)return{zIndex:""+this.parent.zIndex,left:this.left?this.left+"px":null,width:this.width?this.width+"px":null,transform:"translate3d(0, "+this.top+"px, 0)",color:this.parent.highlightColor}}},mounted:function(){var t=this.$el.getBoundingClientRect();this.rect.height=t.height},methods:{scrollIntoView:function(){this.$el.scrollIntoView()},getRect:function(t,n){var i=this.$el,o=i.getBoundingClientRect();return this.rect.height=o.height,t===window||t===document.body?this.rect.top=o.top+Sm():this.rect.top=o.top+mh(t)-n.top,this.rect}},render:function(){var t,n=arguments[0],i=this.sticky;return n("div",{style:{height:i?this.rect.height+"px":null}},[n("div",{style:this.anchorStyle,class:[Zj({sticky:i}),(t={},t[_m]=i,t)]},[this.slots("default")||this.index])])}});function Qj(){for(var r=[],t="A".charCodeAt(0),n=0;n<26;n++)r.push(String.fromCharCode(t+n));return r}var V5=Ht("index-bar"),tq=V5[0],kx=V5[1];const eq=tq({mixins:[To,Si("vanIndexBar"),ra(function(r){this.scroller||(this.scroller=ph(this.$el)),r(this.scroller,"scroll",this.onScroll)})],props:{zIndex:[Number,String],highlightColor:String,sticky:{type:Boolean,default:!0},stickyOffsetTop:{type:Number,default:0},indexList:{type:Array,default:Qj}},data:function(){return{activeAnchorIndex:null}},computed:{sidebarStyle:function(){if(gn(this.zIndex))return{zIndex:this.zIndex+1}},highlightStyle:function(){var t=this.highlightColor;if(t)return{color:t}}},watch:{indexList:function(){this.$nextTick(this.onScroll)},activeAnchorIndex:function(t){t&&this.$emit("change",t)}},methods:{onScroll:function(){var t=this;if(!Tm(this.$el)){var n=mh(this.scroller),i=this.getScrollerRect(),o=this.children.map(function(l){return l.getRect(t.scroller,i)}),a=this.getActiveAnchorIndex(n,o);this.activeAnchorIndex=this.indexList[a],this.sticky&&this.children.forEach(function(l,c){if(c===a||c===a-1){var u=l.$el.getBoundingClientRect();l.left=u.left,l.width=u.width}else l.left=null,l.width=null;if(c===a)l.active=!0,l.top=Math.max(t.stickyOffsetTop,o[c].top-n)+i.top;else if(c===a-1){var h=o[a].top-n;l.active=h>0,l.top=h+i.top-o[c].height}else l.active=!1})}},getScrollerRect:function(){return this.scroller.getBoundingClientRect?this.scroller.getBoundingClientRect():{top:0,left:0}},getActiveAnchorIndex:function(t,n){for(var i=this.children.length-1;i>=0;i--){var o=i>0?n[i-1].height:0,a=this.sticky?o+this.stickyOffsetTop:0;if(t+a>=n[i].top)return i}return-1},onClick:function(t){this.scrollToElement(t.target)},onTouchMove:function(t){if(this.touchMove(t),this.direction==="vertical"){wr(t);var n=t.touches[0],i=n.clientX,o=n.clientY,a=document.elementFromPoint(i,o);if(a){var l=a.dataset.index;this.touchActiveIndex!==l&&(this.touchActiveIndex=l,this.scrollToElement(a))}}},scrollTo:function(t){var n=this.children.filter(function(i){return String(i.index)===t});n[0]&&(n[0].scrollIntoView(),this.sticky&&this.stickyOffsetTop&&H2(Sm()-this.stickyOffsetTop),this.$emit("select",n[0].index))},scrollToElement:function(t){var n=t.dataset.index;this.scrollTo(n)},onTouchEnd:function(){this.active=null}},render:function(){var t=this,n=arguments[0],i=this.indexList.map(function(o){var a=o===t.activeAnchorIndex;return n("span",{class:kx("index",{active:a}),style:a?t.highlightStyle:null,attrs:{"data-index":o}},[o])});return n("div",{class:kx()},[n("div",{class:kx("sidebar"),style:this.sidebarStyle,on:{click:this.onClick,touchstart:this.touchStart,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchEnd}},[i]),this.slots("default")])}});var f4=Ht("list"),nq=f4[0],Kf=f4[1],sq=f4[2];const rq=nq({mixins:[ra(function(r){this.scroller||(this.scroller=ph(this.$el)),r(this.scroller,"scroll",this.check)})],model:{prop:"loading"},props:{error:Boolean,loading:Boolean,finished:Boolean,errorText:String,loadingText:String,finishedText:String,immediateCheck:{type:Boolean,default:!0},offset:{type:[Number,String],default:300},direction:{type:String,default:"down"}},data:function(){return{innerLoading:this.loading}},updated:function(){this.innerLoading=this.loading},mounted:function(){this.immediateCheck&&this.check()},watch:{loading:"check",finished:"check"},methods:{check:function(){var t=this;this.$nextTick(function(){if(!(t.innerLoading||t.finished||t.error)){var n=t.$el,i=t.scroller,o=t.offset,a=t.direction,l;i.getBoundingClientRect?l=i.getBoundingClientRect():l={top:0,bottom:i.innerHeight};var c=l.bottom-l.top;if(!c||Tm(n))return!1;var u=!1,h=t.$refs.placeholder.getBoundingClientRect();a==="up"?u=l.top-h.top<=o:u=h.bottom-l.bottom<=o,u&&(t.innerLoading=!0,t.$emit("input",!0),t.$emit("load"))}})},clickErrorText:function(){this.$emit("update:error",!1),this.check()},genLoading:function(){var t=this.$createElement;if(this.innerLoading&&!this.finished)return t("div",{key:"loading",class:Kf("loading")},[this.slots("loading")||t(ia,{attrs:{size:"16"}},[this.loadingText||sq("loading")])])},genFinishedText:function(){var t=this.$createElement;if(this.finished){var n=this.slots("finished")||this.finishedText;if(n)return t("div",{class:Kf("finished-text")},[n])}},genErrorText:function(){var t=this.$createElement;if(this.error){var n=this.slots("error")||this.errorText;if(n)return t("div",{on:{click:this.clickErrorText},class:Kf("error-text")},[n])}}},render:function(){var t=arguments[0],n=t("div",{ref:"placeholder",key:"placeholder",class:Kf("placeholder")});return t("div",{class:Kf(),attrs:{role:"feed","aria-busy":this.innerLoading}},[this.direction==="down"?this.slots():n,this.genLoading(),this.genFinishedText(),this.genErrorText(),this.direction==="up"?this.slots():n])}});var U5=Ht("nav-bar"),iq=U5[0],Ka=U5[1];const oq=iq({props:{title:String,fixed:Boolean,zIndex:[Number,String],leftText:String,rightText:String,leftArrow:Boolean,placeholder:Boolean,safeAreaInsetTop:Boolean,border:{type:Boolean,default:!0}},data:function(){return{height:null}},mounted:function(){var t=this;if(this.placeholder&&this.fixed){var n=function(){t.height=t.$refs.navBar.getBoundingClientRect().height};n(),setTimeout(n,100)}},methods:{genLeft:function(){var t=this.$createElement,n=this.slots("left");return n||[this.leftArrow&&t(cn,{class:Ka("arrow"),attrs:{name:"arrow-left"}}),this.leftText&&t("span",{class:Ka("text")},[this.leftText])]},genRight:function(){var t=this.$createElement,n=this.slots("right");if(n)return n;if(this.rightText)return t("span",{class:Ka("text")},[this.rightText])},genNavBar:function(){var t,n=this.$createElement;return n("div",{ref:"navBar",style:{zIndex:this.zIndex},class:[Ka({fixed:this.fixed,"safe-area-inset-top":this.safeAreaInsetTop}),(t={},t[_m]=this.border,t)]},[n("div",{class:Ka("content")},[this.hasLeft()&&n("div",{class:Ka("left"),on:{click:this.onClickLeft}},[this.genLeft()]),n("div",{class:[Ka("title"),"van-ellipsis"]},[this.slots("title")||this.title]),this.hasRight()&&n("div",{class:Ka("right"),on:{click:this.onClickRight}},[this.genRight()])])])},hasLeft:function(){return this.leftArrow||this.leftText||this.slots("left")},hasRight:function(){return this.rightText||this.slots("right")},onClickLeft:function(t){this.$emit("click-left",t)},onClickRight:function(t){this.$emit("click-right",t)}},render:function(){var t=arguments[0];return this.placeholder&&this.fixed?t("div",{class:Ka("placeholder"),style:{height:this.height+"px"}},[this.genNavBar()]):this.genNavBar()}});var W5=Ht("notice-bar"),aq=W5[0],Xf=W5[1];const lq=aq({mixins:[ra(function(r){r(window,"pageshow",this.reset)})],inject:{vanPopup:{default:null}},props:{text:String,mode:String,color:String,leftIcon:String,wrapable:Boolean,background:String,scrollable:{type:Boolean,default:null},delay:{type:[Number,String],default:1},speed:{type:[Number,String],default:60}},data:function(){return{show:!0,offset:0,duration:0,wrapWidth:0,contentWidth:0}},watch:{scrollable:"reset",text:{handler:"reset",immediate:!0}},created:function(){this.vanPopup&&this.vanPopup.onReopen(this.reset)},activated:function(){this.reset()},methods:{onClickIcon:function(t){this.mode==="closeable"&&(this.show=!1,this.$emit("close",t))},onTransitionEnd:function(){var t=this;this.offset=this.wrapWidth,this.duration=0,yo(function(){yu(function(){t.offset=-t.contentWidth,t.duration=(t.contentWidth+t.wrapWidth)/t.speed,t.$emit("replay")})})},start:function(){this.reset()},reset:function(){var t=this,n=gn(this.delay)?this.delay*1e3:0;this.offset=0,this.duration=0,this.wrapWidth=0,this.contentWidth=0,clearTimeout(this.startTimer),this.startTimer=setTimeout(function(){var i=t.$refs,o=i.wrap,a=i.content;if(!(!o||!a||t.scrollable===!1)){var l=o.getBoundingClientRect().width,c=a.getBoundingClientRect().width;(t.scrollable||c>l)&&yu(function(){t.offset=-c,t.duration=c/t.speed,t.wrapWidth=l,t.contentWidth=c})}},n)}},render:function(){var t=this,n=arguments[0],i=this.slots,o=this.mode,a=this.leftIcon,l=this.onClickIcon,c={color:this.color,background:this.background},u={transform:this.offset?"translateX("+this.offset+"px)":"",transitionDuration:this.duration+"s"};function h(){var f=i("left-icon");if(f)return f;if(a)return n(cn,{class:Xf("left-icon"),attrs:{name:a}})}function d(){var f=i("right-icon");if(f)return f;var p;if(o==="closeable"?p="cross":o==="link"&&(p="arrow"),p)return n(cn,{class:Xf("right-icon"),attrs:{name:p},on:{click:l}})}return n("div",{attrs:{role:"alert"},directives:[{name:"show",value:this.show}],class:Xf({wrapable:this.wrapable}),style:c,on:{click:function(p){t.$emit("click",p)}}},[h(),n("div",{ref:"wrap",class:Xf("wrap"),attrs:{role:"marquee"}},[n("div",{ref:"content",class:[Xf("content"),{"van-ellipsis":this.scrollable===!1&&!this.wrapable}],style:u,on:{transitionend:this.onTransitionEnd}},[this.slots()||this.text])]),d()])}});var G5=Ht("notify"),cq=G5[0],uq=G5[1];function H5(r,t,n,i){var o={color:t.color,background:t.background};return r(Va,mn([{attrs:{value:t.value,position:"top",overlay:!1,duration:.2,lockScroll:!1},style:o,class:[uq([t.type]),t.className]},Xn(i,!0)]),[(n.default==null?void 0:n.default())||t.message])}H5.props=re({},j2,{color:String,message:[Number,String],duration:[Number,String],className:null,background:String,getContainer:[String,Function],type:{type:String,default:"danger"}});const p4=cq(H5);var C$,Zi;function hq(r){return sa(r)?r:{message:r}}function xo(r){if(!_o)return Zi||(Zi=QM(p4,{on:{click:function(n){Zi.onClick&&Zi.onClick(n)},close:function(){Zi.onClose&&Zi.onClose()},opened:function(){Zi.onOpened&&Zi.onOpened()}}})),r=re({},xo.currentOptions,hq(r)),re(Zi,r),clearTimeout(C$),r.duration&&r.duration>0&&(C$=setTimeout(xo.clear,r.duration)),Zi}function j5(){return{type:"danger",value:!0,message:"",color:void 0,background:void 0,duration:3e3,className:"",onClose:null,onClick:null,onOpened:null}}xo.clear=function(){Zi&&(Zi.value=!1)};xo.currentOptions=j5();xo.setDefaultOptions=function(r){re(xo.currentOptions,r)};xo.resetDefaultOptions=function(){xo.currentOptions=j5()};xo.install=function(){dn.use(p4)};xo.Component=p4;dn.prototype.$notify=xo;const dq={render:function(){var t=arguments[0];return t("svg",{attrs:{viewBox:"0 0 32 22",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M28.016 0A3.991 3.991 0 0132 3.987v14.026c0 2.2-1.787 3.987-3.98 3.987H10.382c-.509 0-.996-.206-1.374-.585L.89 13.09C.33 12.62 0 11.84 0 11.006c0-.86.325-1.62.887-2.08L9.01.585A1.936 1.936 0 0110.383 0zm0 1.947H10.368L2.24 10.28c-.224.226-.312.432-.312.73 0 .287.094.51.312.729l8.128 8.333h17.648a2.041 2.041 0 002.037-2.04V3.987c0-1.127-.915-2.04-2.037-2.04zM23.028 6a.96.96 0 01.678.292.95.95 0 01-.003 1.377l-3.342 3.348 3.326 3.333c.189.188.292.43.292.679 0 .248-.103.49-.292.679a.96.96 0 01-.678.292.959.959 0 01-.677-.292L18.99 12.36l-3.343 3.345a.96.96 0 01-.677.292.96.96 0 01-.678-.292.962.962 0 01-.292-.68c0-.248.104-.49.292-.679l3.342-3.348-3.342-3.348A.963.963 0 0114 6.971c0-.248.104-.49.292-.679A.96.96 0 0114.97 6a.96.96 0 01.677.292l3.358 3.348 3.345-3.348A.96.96 0 0123.028 6z",fill:"currentColor"}})])}},fq={render:function(){var t=arguments[0];return t("svg",{attrs:{viewBox:"0 0 30 24",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M25.877 12.843h-1.502c-.188 0-.188 0-.188.19v1.512c0 .188 0 .188.188.188h1.5c.187 0 .187 0 .187-.188v-1.511c0-.19 0-.191-.185-.191zM17.999 10.2c0 .188 0 .188.188.188h1.687c.188 0 .188 0 .188-.188V8.688c0-.187.004-.187-.186-.19h-1.69c-.187 0-.187 0-.187.19V10.2zm2.25-3.967h1.5c.188 0 .188 0 .188-.188v-1.7c0-.19 0-.19-.188-.19h-1.5c-.189 0-.189 0-.189.19v1.7c0 .188 0 .188.19.188zm2.063 4.157h3.563c.187 0 .187 0 .187-.189V4.346c0-.19.004-.19-.185-.19h-1.69c-.187 0-.187 0-.187.188v4.155h-1.688c-.187 0-.187 0-.187.189v1.514c0 .19 0 .19.187.19zM14.812 24l2.812-3.4H12l2.813 3.4zm-9-11.157H4.31c-.188 0-.188 0-.188.19v1.512c0 .188 0 .188.188.188h1.502c.187 0 .187 0 .187-.188v-1.511c0-.19.01-.191-.189-.191zm15.937 0H8.25c-.188 0-.188 0-.188.19v1.512c0 .188 0 .188.188.188h13.5c.188 0 .188 0 .188-.188v-1.511c0-.19 0-.191-.188-.191zm-11.438-2.454h1.5c.188 0 .188 0 .188-.188V8.688c0-.187 0-.187-.188-.189h-1.5c-.187 0-.187 0-.187.189V10.2c0 .188 0 .188.187.188zM27.94 0c.563 0 .917.21 1.313.567.518.466.748.757.748 1.51v14.92c0 .567-.188 1.134-.562 1.512-.376.378-.938.566-1.313.566H2.063c-.563 0-.938-.188-1.313-.566-.562-.378-.75-.945-.75-1.511V2.078C0 1.51.188.944.562.567.938.189 1.5 0 1.875 0zm-.062 2H2v14.92h25.877V2zM5.81 4.157c.19 0 .19 0 .19.189v1.762c-.003.126-.024.126-.188.126H4.249c-.126-.003-.126-.023-.126-.188v-1.7c-.187-.19 0-.19.188-.19zm10.5 2.077h1.503c.187 0 .187 0 .187-.188v-1.7c0-.19 0-.19-.187-.19h-1.502c-.188 0-.188.001-.188.19v1.7c0 .188 0 .188.188.188zM7.875 8.5c.187 0 .187.002.187.189V10.2c0 .188 0 .188-.187.188H4.249c-.126-.002-.126-.023-.126-.188V8.625c.003-.126.024-.126.188-.126zm7.875 0c.19.002.19.002.19.189v1.575c-.003.126-.024.126-.19.126h-1.563c-.126-.002-.126-.023-.126-.188V8.625c.002-.126.023-.126.189-.126zm-6-4.342c.187 0 .187 0 .187.189v1.7c0 .188 0 .188-.187.188H8.187c-.126-.003-.126-.023-.126-.188V4.283c.003-.126.024-.126.188-.126zm3.94 0c.185 0 .372 0 .372.189v1.762c-.002.126-.023.126-.187.126h-1.75C12 6.231 12 6.211 12 6.046v-1.7c0-.19.187-.19.187-.19z",fill:"currentColor"}})])}};var q5=Ht("key"),pq=q5[0],Yf=q5[1];const $x=pq({mixins:[To],props:{type:String,text:[Number,String],color:String,wider:Boolean,large:Boolean,loading:Boolean},data:function(){return{active:!1}},mounted:function(){this.bindTouchEvent(this.$el)},methods:{onTouchStart:function(t){t.stopPropagation(),this.touchStart(t),this.active=!0},onTouchMove:function(t){this.touchMove(t),this.direction&&(this.active=!1)},onTouchEnd:function(t){this.active&&(this.slots("default")||t.preventDefault(),this.active=!1,this.$emit("press",this.text,this.type))},genContent:function(){var t=this.$createElement,n=this.type==="extra",i=this.type==="delete",o=this.slots("default")||this.text;return this.loading?t(ia,{class:Yf("loading-icon")}):i?o||t(dq,{class:Yf("delete-icon")}):n?o||t(fq,{class:Yf("collapse-icon")}):o}},render:function(){var t=arguments[0];return t("div",{class:Yf("wrapper",{wider:this.wider})},[t("div",{attrs:{role:"button",tabindex:"0"},class:Yf([this.color,{large:this.large,active:this.active,delete:this.type==="delete"}])},[this.genContent()])])}});var K5=Ht("number-keyboard"),mq=K5[0],Bl=K5[1];const gq=mq({mixins:[zS(),ra(function(r){this.hideOnClickOutside&&r(document.body,"touchstart",this.onBlur)})],model:{event:"update:value"},props:{show:Boolean,title:String,zIndex:[Number,String],randomKeyOrder:Boolean,closeButtonText:String,deleteButtonText:String,closeButtonLoading:Boolean,theme:{type:String,default:"default"},value:{type:String,default:""},extraKey:{type:[String,Array],default:""},maxlength:{type:[Number,String],default:Number.MAX_VALUE},transition:{type:Boolean,default:!0},showDeleteKey:{type:Boolean,default:!0},hideOnClickOutside:{type:Boolean,default:!0},safeAreaInsetBottom:{type:Boolean,default:!0}},watch:{show:function(t){this.transition||this.$emit(t?"show":"hide")}},computed:{keys:function(){return this.theme==="custom"?this.genCustomKeys():this.genDefaultKeys()}},methods:{genBasicKeys:function(){for(var t=[],n=1;n<=9;n++)t.push({text:n});return this.randomKeyOrder&&t.sort(function(){return Math.random()>.5?1:-1}),t},genDefaultKeys:function(){return[].concat(this.genBasicKeys(),[{text:this.extraKey,type:"extra"},{text:0},{text:this.showDeleteKey?this.deleteButtonText:"",type:this.showDeleteKey?"delete":""}])},genCustomKeys:function(){var t=this.genBasicKeys(),n=this.extraKey,i=Array.isArray(n)?n:[n];return i.length===1?t.push({text:0,wider:!0},{text:i[0],type:"extra"}):i.length===2&&t.push({text:i[0],type:"extra"},{text:0},{text:i[1],type:"extra"}),t},onBlur:function(){this.show&&this.$emit("blur")},onClose:function(){this.$emit("close"),this.onBlur()},onAnimationEnd:function(){this.$emit(this.show?"show":"hide")},onPress:function(t,n){if(t===""){n==="extra"&&this.onBlur();return}var i=this.value;n==="delete"?(this.$emit("delete"),this.$emit("update:value",i.slice(0,i.length-1))):n==="close"?this.onClose():i.length<this.maxlength&&(this.$emit("input",t),this.$emit("update:value",i+t))},genTitle:function(){var t=this.$createElement,n=this.title,i=this.theme,o=this.closeButtonText,a=this.slots("title-left"),l=o&&i==="default",c=n||l||a;if(c)return t("div",{class:Bl("header")},[a&&t("span",{class:Bl("title-left")},[a]),n&&t("h2",{class:Bl("title")},[n]),l&&t("button",{attrs:{type:"button"},class:Bl("close"),on:{click:this.onClose}},[o])])},genKeys:function(){var t=this,n=this.$createElement;return this.keys.map(function(i){return n($x,{key:i.text,attrs:{text:i.text,type:i.type,wider:i.wider,color:i.color},on:{press:t.onPress}},[i.type==="delete"&&t.slots("delete"),i.type==="extra"&&t.slots("extra-key")])})},genSidebar:function(){var t=this.$createElement;if(this.theme==="custom")return t("div",{class:Bl("sidebar")},[this.showDeleteKey&&t($x,{attrs:{large:!0,text:this.deleteButtonText,type:"delete"},on:{press:this.onPress}},[this.slots("delete")]),t($x,{attrs:{large:!0,text:this.closeButtonText,type:"close",color:"blue",loading:this.closeButtonLoading},on:{press:this.onPress}})])}},render:function(){var t=arguments[0],n=this.genTitle();return t("transition",{attrs:{name:this.transition?"van-slide-up":""}},[t("div",{directives:[{name:"show",value:this.show}],style:{zIndex:this.zIndex},class:Bl({unfit:!this.safeAreaInsetBottom,"with-title":n}),on:{touchstart:e6,animationend:this.onAnimationEnd,webkitAnimationEnd:this.onAnimationEnd}},[n,t("div",{class:Bl("body")},[t("div",{class:Bl("keys")},[this.genKeys()]),this.genSidebar()])])])}});var m4=Ht("pagination"),vq=m4[0],zl=m4[1],k$=m4[2];function Ix(r,t,n){return{number:r,text:t,active:n}}const yq=vq({props:{prevText:String,nextText:String,forceEllipses:Boolean,mode:{type:String,default:"multi"},value:{type:Number,default:0},pageCount:{type:[Number,String],default:0},totalItems:{type:[Number,String],default:0},itemsPerPage:{type:[Number,String],default:10},showPageSize:{type:[Number,String],default:5}},computed:{count:function(){var t=this.pageCount||Math.ceil(this.totalItems/this.itemsPerPage);return Math.max(1,t)},pages:function(){var t=[],n=this.count,i=+this.showPageSize;if(this.mode!=="multi")return t;var o=1,a=n,l=i<n;l&&(o=Math.max(this.value-Math.floor(i/2),1),a=o+i-1,a>n&&(a=n,o=a-i+1));for(var c=o;c<=a;c++){var u=Ix(c,c,c===this.value);t.push(u)}if(l&&i>0&&this.forceEllipses){if(o>1){var h=Ix(o-1,"...",!1);t.unshift(h)}if(a<n){var d=Ix(a+1,"...",!1);t.push(d)}}return t}},watch:{value:{handler:function(t){this.select(t||this.value)},immediate:!0}},methods:{select:function(t,n){t=Math.min(this.count,Math.max(1,t)),this.value!==t&&(this.$emit("input",t),n&&this.$emit("change",t))}},render:function(){var t=this,n,i,o=arguments[0],a=this.value,l=this.mode!=="multi",c=function(h){return function(){t.select(h,!0)}};return o("ul",{class:zl({simple:l})},[o("li",{class:[zl("item",{disabled:a===1}),zl("prev"),Ho],on:{click:c(a-1)}},[((n=this.slots("prev-text"))!=null?n:this.prevText)||k$("prev")]),this.pages.map(function(u){var h;return o("li",{class:[zl("item",{active:u.active}),zl("page"),Ho],on:{click:c(u.number)}},[(h=t.slots("page",u))!=null?h:u.text])}),l&&o("li",{class:zl("page-desc")},[this.slots("pageDesc")||a+"/"+this.count]),o("li",{class:[zl("item",{disabled:a===this.count}),zl("next"),Ho],on:{click:c(a+1)}},[((i=this.slots("next-text"))!=null?i:this.nextText)||k$("next")])])}});var X5=Ht("panel"),xq=X5[0],Zf=X5[1];function Y5(r,t,n,i){var o=function(){return[n.header?n.header():r(ei,{attrs:{icon:t.icon,label:t.desc,title:t.title,value:t.status,valueClass:Zf("header-value")},class:Zf("header")}),r("div",{class:Zf("content")},[n.default&&n.default()]),n.footer&&r("div",{class:[Zf("footer"),VS]},[n.footer()])]};return r(h5,mn([{class:Zf(),scopedSlots:{default:o}},Xn(i,!0)]))}Y5.props={icon:String,desc:String,title:String,status:String};const bq=xq(Y5);var Z5=Ht("password-input"),wq=Z5[0],Jf=Z5[1];function J5(r,t,n,i){for(var o,a=t.mask,l=t.value,c=t.length,u=t.gutter,h=t.focused,d=t.errorInfo,f=d||t.info,p=[],m=0;m<c;m++){var g,y=l[m],v=m!==0&&!u,x=h&&m===l.length,b=void 0;m!==0&&u&&(b={marginLeft:kn(u)}),p.push(r("li",{class:[(g={},g[y6]=v,g),Jf("item",{focus:x})],style:b},[a?r("i",{style:{visibility:y?"visible":"hidden"}}):y,x&&r("div",{class:Jf("cursor")})]))}return r("div",{class:Jf()},[r("ul",mn([{class:[Jf("security"),(o={},o[x6]=!u,o)],on:{touchstart:function(S){S.stopPropagation(),bn(i,"focus",S)}}},Xn(i,!0)]),[p]),f&&r("div",{class:Jf(d?"error-info":"info")},[f])])}J5.props={info:String,gutter:[Number,String],focused:Boolean,errorInfo:String,mask:{type:Boolean,default:!0},value:{type:String,default:""},length:{type:[Number,String],default:6}};const Sq=wq(J5);function oa(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var t=r.ownerDocument;return t&&t.defaultView||window}return r}function g4(r){var t=oa(r).Element;return r instanceof t||r instanceof Element}function jo(r){var t=oa(r).HTMLElement;return r instanceof t||r instanceof HTMLElement}function Q5(r){if(typeof ShadowRoot>"u")return!1;var t=oa(r).ShadowRoot;return r instanceof t||r instanceof ShadowRoot}var Md=Math.round;function I3(){var r=navigator.userAgentData;return r!=null&&r.brands?r.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function _q(){return!/^((?!chrome|android).)*safari/i.test(I3())}function J1(r,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var i=r.getBoundingClientRect(),o=1,a=1;t&&jo(r)&&(o=r.offsetWidth>0&&Md(i.width)/r.offsetWidth||1,a=r.offsetHeight>0&&Md(i.height)/r.offsetHeight||1);var l=g4(r)?oa(r):window,c=l.visualViewport,u=!_q()&&n,h=(i.left+(u&&c?c.offsetLeft:0))/o,d=(i.top+(u&&c?c.offsetTop:0))/a,f=i.width/o,p=i.height/a;return{width:f,height:p,top:d,right:h+f,bottom:d+p,left:h,x:h,y:d}}function tD(r){var t=oa(r),n=t.pageXOffset,i=t.pageYOffset;return{scrollLeft:n,scrollTop:i}}function Tq(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function Cq(r){return r===oa(r)||!jo(r)?tD(r):Tq(r)}function xl(r){return r?(r.nodeName||"").toLowerCase():null}function Q2(r){return((g4(r)?r.ownerDocument:r.document)||window.document).documentElement}function kq(r){return J1(Q2(r)).left+tD(r).scrollLeft}function bl(r){return oa(r).getComputedStyle(r)}function v4(r){var t=bl(r),n=t.overflow,i=t.overflowX,o=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+o+i)}function $q(r){var t=r.getBoundingClientRect(),n=Md(t.width)/r.offsetWidth||1,i=Md(t.height)/r.offsetHeight||1;return n!==1||i!==1}function Iq(r,t,n){n===void 0&&(n=!1);var i=jo(t),o=jo(t)&&$q(t),a=Q2(t),l=J1(r,o,n),c={scrollLeft:0,scrollTop:0},u={x:0,y:0};return(i||!i&&!n)&&((xl(t)!=="body"||v4(a))&&(c=Cq(t)),jo(t)?(u=J1(t,!0),u.x+=t.clientLeft,u.y+=t.clientTop):a&&(u.x=kq(a))),{x:l.left+c.scrollLeft-u.x,y:l.top+c.scrollTop-u.y,width:l.width,height:l.height}}function Eq(r){var t=J1(r),n=r.offsetWidth,i=r.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-i)<=1&&(i=t.height),{x:r.offsetLeft,y:r.offsetTop,width:n,height:i}}function y4(r){return xl(r)==="html"?r:r.assignedSlot||r.parentNode||(Q5(r)?r.host:null)||Q2(r)}function eD(r){return["html","body","#document"].indexOf(xl(r))>=0?r.ownerDocument.body:jo(r)&&v4(r)?r:eD(y4(r))}function w1(r,t){var n;t===void 0&&(t=[]);var i=eD(r),o=i===((n=r.ownerDocument)==null?void 0:n.body),a=oa(i),l=o?[a].concat(a.visualViewport||[],v4(i)?i:[]):i,c=t.concat(l);return o?c:c.concat(w1(y4(l)))}function Nq(r){return["table","td","th"].indexOf(xl(r))>=0}function $$(r){return!jo(r)||bl(r).position==="fixed"?null:r.offsetParent}function Aq(r){var t=/firefox/i.test(I3()),n=/Trident/i.test(I3());if(n&&jo(r)){var i=bl(r);if(i.position==="fixed")return null}var o=y4(r);for(Q5(o)&&(o=o.host);jo(o)&&["html","body"].indexOf(xl(o))<0;){var a=bl(o);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||t&&a.willChange==="filter"||t&&a.filter&&a.filter!=="none")return o;o=o.parentNode}return null}function nD(r){for(var t=oa(r),n=$$(r);n&&Nq(n)&&bl(n).position==="static";)n=$$(n);return n&&(xl(n)==="html"||xl(n)==="body"&&bl(n).position==="static")?t:n||Aq(r)||t}var xd="top",Q1="bottom",qp="right",Eu="left",sD="auto",Mq=[xd,Q1,qp,Eu],rD="start",t2="end",Dq=[].concat(Mq,[sD]).reduce(function(r,t){return r.concat([t,t+"-"+rD,t+"-"+t2])},[]),Rq="beforeRead",Oq="read",Lq="afterRead",Fq="beforeMain",Pq="main",Bq="afterMain",zq="beforeWrite",Vq="write",Uq="afterWrite",E3=[Rq,Oq,Lq,Fq,Pq,Bq,zq,Vq,Uq];function Wq(r){var t=new Map,n=new Set,i=[];r.forEach(function(a){t.set(a.name,a)});function o(a){n.add(a.name);var l=[].concat(a.requires||[],a.requiresIfExists||[]);l.forEach(function(c){if(!n.has(c)){var u=t.get(c);u&&o(u)}}),i.push(a)}return r.forEach(function(a){n.has(a.name)||o(a)}),i}function Gq(r){var t=Wq(r);return E3.reduce(function(n,i){return n.concat(t.filter(function(o){return o.phase===i}))},[])}function Hq(r){var t;return function(){return t||(t=new Promise(function(n){Promise.resolve().then(function(){t=void 0,n(r())})})),t}}function Vl(r){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return[].concat(n).reduce(function(o,a){return o.replace(/%s/,a)},r)}var tu='Popper: modifier "%s" provided an invalid %s property, expected %s but got %s',jq='Popper: modifier "%s" requires "%s", but "%s" modifier is not available',I$=["name","enabled","phase","fn","effect","requires","options"];function qq(r){r.forEach(function(t){[].concat(Object.keys(t),I$).filter(function(n,i,o){return o.indexOf(n)===i}).forEach(function(n){switch(n){case"name":typeof t.name!="string"&&console.error(Vl(tu,String(t.name),'"name"','"string"','"'+String(t.name)+'"'));break;case"enabled":typeof t.enabled!="boolean"&&console.error(Vl(tu,t.name,'"enabled"','"boolean"','"'+String(t.enabled)+'"'));break;case"phase":E3.indexOf(t.phase)<0&&console.error(Vl(tu,t.name,'"phase"',"either "+E3.join(", "),'"'+String(t.phase)+'"'));break;case"fn":typeof t.fn!="function"&&console.error(Vl(tu,t.name,'"fn"','"function"','"'+String(t.fn)+'"'));break;case"effect":t.effect!=null&&typeof t.effect!="function"&&console.error(Vl(tu,t.name,'"effect"','"function"','"'+String(t.fn)+'"'));break;case"requires":t.requires!=null&&!Array.isArray(t.requires)&&console.error(Vl(tu,t.name,'"requires"','"array"','"'+String(t.requires)+'"'));break;case"requiresIfExists":Array.isArray(t.requiresIfExists)||console.error(Vl(tu,t.name,'"requiresIfExists"','"array"','"'+String(t.requiresIfExists)+'"'));break;case"options":case"data":break;default:console.error('PopperJS: an invalid property has been provided to the "'+t.name+'" modifier, valid properties are '+I$.map(function(i){return'"'+i+'"'}).join(", ")+'; but "'+n+'" was provided.')}t.requires&&t.requires.forEach(function(i){r.find(function(o){return o.name===i})==null&&console.error(Vl(jq,String(t.name),i,i))})})})}function Kq(r,t){var n=new Set;return r.filter(function(i){var o=t(i);if(!n.has(o))return n.add(o),!0})}function tv(r){return r.split("-")[0]}function Xq(r){var t=r.reduce(function(n,i){var o=n[i.name];return n[i.name]=o?Object.assign({},o,i,{options:Object.assign({},o.options,i.options),data:Object.assign({},o.data,i.data)}):i,n},{});return Object.keys(t).map(function(n){return t[n]})}function iD(r){return r.split("-")[1]}function Yq(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function Zq(r){var t=r.reference,n=r.element,i=r.placement,o=i?tv(i):null,a=i?iD(i):null,l=t.x+t.width/2-n.width/2,c=t.y+t.height/2-n.height/2,u;switch(o){case xd:u={x:l,y:t.y-n.height};break;case Q1:u={x:l,y:t.y+t.height};break;case qp:u={x:t.x+t.width,y:c};break;case Eu:u={x:t.x-n.width,y:c};break;default:u={x:t.x,y:t.y}}var h=o?Yq(o):null;if(h!=null){var d=h==="y"?"height":"width";switch(a){case rD:u[h]=u[h]-(t[d]/2-n[d]/2);break;case t2:u[h]=u[h]+(t[d]/2-n[d]/2);break}}return u}var E$="Popper: Invalid reference or popper argument provided. They must be either a DOM element or virtual element.",Jq="Popper: An infinite loop in the modifiers cycle has been detected! The cycle has been interrupted to prevent a browser crash.",N$={placement:"bottom",modifiers:[],strategy:"absolute"};function A$(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];return!t.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function Qq(r){r===void 0&&(r={});var t=r,n=t.defaultModifiers,i=n===void 0?[]:n,o=t.defaultOptions,a=o===void 0?N$:o;return function(c,u,h){h===void 0&&(h=a);var d={placement:"bottom",orderedModifiers:[],options:Object.assign({},N$,a),modifiersData:{},elements:{reference:c,popper:u},attributes:{},styles:{}},f=[],p=!1,m={state:d,setOptions:function(x){var b=typeof x=="function"?x(d.options):x;y(),d.options=Object.assign({},a,d.options,b),d.scrollParents={reference:g4(c)?w1(c):c.contextElement?w1(c.contextElement):[],popper:w1(u)};var w=Gq(Xq([].concat(i,d.options.modifiers)));d.orderedModifiers=w.filter(function(B){return B.enabled});{var S=Kq([].concat(w,d.options.modifiers),function(B){var F=B.name;return F});if(qq(S),tv(d.options.placement)===sD){var _=d.orderedModifiers.find(function(B){var F=B.name;return F==="flip"});_||console.error(['Popper: "auto" placements require the "flip" modifier be',"present and enabled to work."].join(" "))}var $=bl(u),N=$.marginTop,k=$.marginRight,I=$.marginBottom,O=$.marginLeft;[N,k,I,O].some(function(B){return parseFloat(B)})&&console.warn(['Popper: CSS "margin" styles cannot be used to apply padding',"between the popper and its reference element or boundary.","To replicate margin, use the `offset` modifier, as well as","the `padding` option in the `preventOverflow` and `flip`","modifiers."].join(" "))}return g(),m.update()},forceUpdate:function(){if(!p){var x=d.elements,b=x.reference,w=x.popper;if(!A$(b,w)){console.error(E$);return}d.rects={reference:Iq(b,nD(w),d.options.strategy==="fixed"),popper:Eq(w)},d.reset=!1,d.placement=d.options.placement,d.orderedModifiers.forEach(function(B){return d.modifiersData[B.name]=Object.assign({},B.data)});for(var S=0,_=0;_<d.orderedModifiers.length;_++){if(S+=1,S>100){console.error(Jq);break}if(d.reset===!0){d.reset=!1,_=-1;continue}var $=d.orderedModifiers[_],N=$.fn,k=$.options,I=k===void 0?{}:k,O=$.name;typeof N=="function"&&(d=N({state:d,options:I,name:O,instance:m})||d)}}},update:Hq(function(){return new Promise(function(v){m.forceUpdate(),v(d)})}),destroy:function(){y(),p=!0}};if(!A$(c,u))return console.error(E$),m;m.setOptions(h).then(function(v){!p&&h.onFirstUpdate&&h.onFirstUpdate(v)});function g(){d.orderedModifiers.forEach(function(v){var x=v.name,b=v.options,w=b===void 0?{}:b,S=v.effect;if(typeof S=="function"){var _=S({state:d,name:x,instance:m,options:w}),$=function(){};f.push(_||$)}})}function y(){f.forEach(function(v){return v()}),f=[]}return m}}var T0={passive:!0};function tK(r){var t=r.state,n=r.instance,i=r.options,o=i.scroll,a=o===void 0?!0:o,l=i.resize,c=l===void 0?!0:l,u=oa(t.elements.popper),h=[].concat(t.scrollParents.reference,t.scrollParents.popper);return a&&h.forEach(function(d){d.addEventListener("scroll",n.update,T0)}),c&&u.addEventListener("resize",n.update,T0),function(){a&&h.forEach(function(d){d.removeEventListener("scroll",n.update,T0)}),c&&u.removeEventListener("resize",n.update,T0)}}var eK={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:tK,data:{}};function nK(r){var t=r.state,n=r.name;t.modifiersData[n]=Zq({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}var sK={name:"popperOffsets",enabled:!0,phase:"read",fn:nK,data:{}},rK={top:"auto",right:"auto",bottom:"auto",left:"auto"};function iK(r){var t=r.x,n=r.y,i=window,o=i.devicePixelRatio||1;return{x:Md(t*o)/o||0,y:Md(n*o)/o||0}}function M$(r){var t,n=r.popper,i=r.popperRect,o=r.placement,a=r.variation,l=r.offsets,c=r.position,u=r.gpuAcceleration,h=r.adaptive,d=r.roundOffsets,f=r.isFixed,p=l.x,m=p===void 0?0:p,g=l.y,y=g===void 0?0:g,v=typeof d=="function"?d({x:m,y}):{x:m,y};m=v.x,y=v.y;var x=l.hasOwnProperty("x"),b=l.hasOwnProperty("y"),w=Eu,S=xd,_=window;if(h){var $=nD(n),N="clientHeight",k="clientWidth";if($===oa(n)&&($=Q2(n),bl($).position!=="static"&&c==="absolute"&&(N="scrollHeight",k="scrollWidth")),$=$,o===xd||(o===Eu||o===qp)&&a===t2){S=Q1;var I=f&&$===_&&_.visualViewport?_.visualViewport.height:$[N];y-=I-i.height,y*=u?1:-1}if(o===Eu||(o===xd||o===Q1)&&a===t2){w=qp;var O=f&&$===_&&_.visualViewport?_.visualViewport.width:$[k];m-=O-i.width,m*=u?1:-1}}var B=Object.assign({position:c},h&&rK),F=d===!0?iK({x:m,y}):{x:m,y};if(m=F.x,y=F.y,u){var D;return Object.assign({},B,(D={},D[S]=b?"0":"",D[w]=x?"0":"",D.transform=(_.devicePixelRatio||1)<=1?"translate("+m+"px, "+y+"px)":"translate3d("+m+"px, "+y+"px, 0)",D))}return Object.assign({},B,(t={},t[S]=b?y+"px":"",t[w]=x?m+"px":"",t.transform="",t))}function oK(r){var t=r.state,n=r.options,i=n.gpuAcceleration,o=i===void 0?!0:i,a=n.adaptive,l=a===void 0?!0:a,c=n.roundOffsets,u=c===void 0?!0:c;{var h=bl(t.elements.popper).transitionProperty||"";l&&["transform","top","right","bottom","left"].some(function(f){return h.indexOf(f)>=0})&&console.warn(["Popper: Detected CSS transitions on at least one of the following",'CSS properties: "transform", "top", "right", "bottom", "left".',`

`,'Disable the "computeStyles" modifier\'s `adaptive` option to allow',"for smooth transitions, or remove these properties from the CSS","transition declaration on the popper element if only transitioning","opacity or background-color for example.",`

`,"We recommend using the popper element as a wrapper around an inner","element that can have any CSS property transitioned for animations."].join(" "))}var d={placement:tv(t.placement),variation:iD(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:o,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,M$(Object.assign({},d,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:l,roundOffsets:u})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,M$(Object.assign({},d,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:u})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}var aK={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:oK,data:{}};function lK(r){var t=r.state;Object.keys(t.elements).forEach(function(n){var i=t.styles[n]||{},o=t.attributes[n]||{},a=t.elements[n];!jo(a)||!xl(a)||(Object.assign(a.style,i),Object.keys(o).forEach(function(l){var c=o[l];c===!1?a.removeAttribute(l):a.setAttribute(l,c===!0?"":c)}))})}function cK(r){var t=r.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach(function(i){var o=t.elements[i],a=t.attributes[i]||{},l=Object.keys(t.styles.hasOwnProperty(i)?t.styles[i]:n[i]),c=l.reduce(function(u,h){return u[h]="",u},{});!jo(o)||!xl(o)||(Object.assign(o.style,c),Object.keys(a).forEach(function(u){o.removeAttribute(u)}))})}}var uK={name:"applyStyles",enabled:!0,phase:"write",fn:lK,effect:cK,requires:["computeStyles"]},hK=[eK,sK,aK,uK],dK=Qq({defaultModifiers:hK});function fK(r,t,n){var i=tv(r),o=[Eu,xd].indexOf(i)>=0?-1:1,a=typeof n=="function"?n(Object.assign({},t,{placement:r})):n,l=a[0],c=a[1];return l=l||0,c=(c||0)*o,[Eu,qp].indexOf(i)>=0?{x:c,y:l}:{x:l,y:c}}function pK(r){var t=r.state,n=r.options,i=r.name,o=n.offset,a=o===void 0?[0,0]:o,l=Dq.reduce(function(d,f){return d[f]=fK(f,t.rects,a),d},{}),c=l[t.placement],u=c.x,h=c.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=u,t.modifiersData.popperOffsets.y+=h),t.modifiersData[i]=l}var mK={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:pK},oD=Ht("popover"),gK=oD[0],eu=oD[1];const vK=gK({mixins:[c4({event:"touchstart",method:"onClickOutside"})],props:{value:Boolean,trigger:String,overlay:Boolean,offset:{type:Array,default:function(){return[0,8]}},theme:{type:String,default:"light"},actions:{type:Array,default:function(){return[]}},placement:{type:String,default:"bottom"},getContainer:{type:[String,Function],default:"body"},closeOnClickAction:{type:Boolean,default:!0}},watch:{value:"updateLocation",placement:"updateLocation"},mounted:function(){this.updateLocation()},beforeDestroy:function(){this.popper&&(this.popper.destroy(),this.popper=null)},methods:{createPopper:function(){return dK(this.$refs.wrapper,this.$refs.popover.$el,{placement:this.placement,modifiers:[{name:"computeStyles",options:{adaptive:!1,gpuAcceleration:!1}},re({},mK,{options:{offset:this.offset}})]})},updateLocation:function(){var t=this;this.$nextTick(function(){t.value&&(t.popper?t.popper.setOptions({placement:t.placement}):t.popper=t.createPopper())})},renderAction:function(t,n){var i=this,o=this.$createElement,a=t.icon,l=t.text,c=t.disabled,u=t.className;return o("div",{attrs:{role:"menuitem"},class:[eu("action",{disabled:c,"with-icon":a}),u],on:{click:function(){return i.onClickAction(t,n)}}},[a&&o(cn,{attrs:{name:a},class:eu("action-icon")}),o("div",{class:[eu("action-text"),_m]},[l])])},onToggle:function(t){this.$emit("input",t)},onClickWrapper:function(){this.trigger==="click"&&this.onToggle(!this.value)},onTouchstart:function(t){t.stopPropagation(),this.$emit("touchstart",t)},onClickAction:function(t,n){t.disabled||(this.$emit("select",t,n),this.closeOnClickAction&&this.$emit("input",!1))},onClickOutside:function(){this.$emit("input",!1)},onOpen:function(){this.$emit("open")},onOpened:function(){this.$emit("opened")},onClose:function(){this.$emit("close")},onClosed:function(){this.$emit("closed")}},render:function(){var t=arguments[0];return t("span",{ref:"wrapper",class:eu("wrapper"),on:{click:this.onClickWrapper}},[t(Va,{ref:"popover",attrs:{value:this.value,overlay:this.overlay,position:null,transition:"van-popover-zoom",lockScroll:!1,getContainer:this.getContainer},class:eu([this.theme]),on:{open:this.onOpen,close:this.onClose,input:this.onToggle,opened:this.onOpened,closed:this.onClosed},nativeOn:{touchstart:this.onTouchstart}},[t("div",{class:eu("arrow")}),t("div",{class:eu("content"),attrs:{role:"menu"}},[this.slots("default")||this.actions.map(this.renderAction)])]),this.slots("reference")])}});var aD=Ht("progress"),yK=aD[0],Ex=aD[1];const xK=yK({mixins:[ra(function(r){r(window,"resize",this.resize,!0),r(window,"orientationchange",this.resize,!0)})],props:{color:String,inactive:Boolean,pivotText:String,textColor:String,pivotColor:String,trackColor:String,strokeWidth:[Number,String],percentage:{type:[Number,String],required:!0,validator:function(t){return t>=0&&t<=100}},showPivot:{type:Boolean,default:!0}},data:function(){return{pivotWidth:0,progressWidth:0}},mounted:function(){this.resize()},watch:{showPivot:"resize",pivotText:"resize"},methods:{resize:function(){var t=this;this.$nextTick(function(){t.progressWidth=t.$el.offsetWidth,t.pivotWidth=t.$refs.pivot?t.$refs.pivot.offsetWidth:0})}},render:function(){var t=arguments[0],n=this.pivotText,i=this.percentage,o=n??i+"%",a=this.showPivot&&o,l=this.inactive?"#cacaca":this.color,c={color:this.textColor,left:(this.progressWidth-this.pivotWidth)*i/100+"px",background:this.pivotColor||l},u={background:l,width:this.progressWidth*i/100+"px"},h={background:this.trackColor,height:kn(this.strokeWidth)};return t("div",{class:Ex(),style:h},[t("span",{class:Ex("portion"),style:u},[a&&t("span",{ref:"pivot",style:c,class:Ex("pivot")},[o])])])}});var x4=Ht("pull-refresh"),bK=x4[0],C0=x4[1],wK=x4[2],D$=50,SK=["pulling","loosing","success"];const _K=bK({mixins:[To],props:{disabled:Boolean,successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:[Number,String],value:{type:Boolean,required:!0},successDuration:{type:[Number,String],default:500},animationDuration:{type:[Number,String],default:300},headHeight:{type:[Number,String],default:D$}},data:function(){return{status:"normal",distance:0,duration:0}},computed:{touchable:function(){return this.status!=="loading"&&this.status!=="success"&&!this.disabled},headStyle:function(){if(this.headHeight!==D$)return{height:this.headHeight+"px"}}},watch:{value:function(t){this.duration=this.animationDuration,t?this.setStatus(+this.headHeight,!0):this.slots("success")||this.successText?this.showSuccessTip():this.setStatus(0,!1)}},mounted:function(){this.bindTouchEvent(this.$refs.track),this.scrollEl=ph(this.$el)},methods:{checkPullStart:function(t){this.ceiling=mh(this.scrollEl)===0,this.ceiling&&(this.duration=0,this.touchStart(t))},onTouchStart:function(t){this.touchable&&this.checkPullStart(t)},onTouchMove:function(t){this.touchable&&(this.ceiling||this.checkPullStart(t),this.touchMove(t),this.ceiling&&this.deltaY>=0&&this.direction==="vertical"&&(wr(t),this.setStatus(this.ease(this.deltaY))))},onTouchEnd:function(){var t=this;this.touchable&&this.ceiling&&this.deltaY&&(this.duration=this.animationDuration,this.status==="loosing"?(this.setStatus(+this.headHeight,!0),this.$emit("input",!0),this.$nextTick(function(){t.$emit("refresh")})):this.setStatus(0))},ease:function(t){var n=+(this.pullDistance||this.headHeight);return t>n&&(t<n*2?t=n+(t-n)/2:t=n*1.5+(t-n*2)/4),Math.round(t)},setStatus:function(t,n){var i;n?i="loading":t===0?i="normal":i=t<(this.pullDistance||this.headHeight)?"pulling":"loosing",this.distance=t,i!==this.status&&(this.status=i)},genStatus:function(){var t=this.$createElement,n=this.status,i=this.distance,o=this.slots(n,{distance:i});if(o)return o;var a=[],l=this[n+"Text"]||wK(n);return SK.indexOf(n)!==-1&&a.push(t("div",{class:C0("text")},[l])),n==="loading"&&a.push(t(ia,{attrs:{size:"16"}},[l])),a},showSuccessTip:function(){var t=this;this.status="success",setTimeout(function(){t.setStatus(0)},this.successDuration)}},render:function(){var t=arguments[0],n={transitionDuration:this.duration+"ms",transform:this.distance?"translate3d(0,"+this.distance+"px, 0)":""};return t("div",{class:C0()},[t("div",{ref:"track",class:C0("track"),style:n},[t("div",{class:C0("head"),style:this.headStyle},[this.genStatus()]),this.slots()])])}});var lD=Ht("rate"),TK=lD[0],k0=lD[1];function CK(r,t,n){return r>=t?"full":r+.5>=t&&n?"half":"void"}const kK=TK({mixins:[To,Oc],props:{size:[Number,String],color:String,gutter:[Number,String],readonly:Boolean,disabled:Boolean,allowHalf:Boolean,voidColor:String,iconPrefix:String,disabledColor:String,value:{type:Number,default:0},icon:{type:String,default:"star"},voidIcon:{type:String,default:"star-o"},count:{type:[Number,String],default:5},touchable:{type:Boolean,default:!0}},computed:{list:function(){for(var t=[],n=1;n<=this.count;n++)t.push(CK(this.value,n,this.allowHalf));return t},sizeWithUnit:function(){return kn(this.size)},gutterWithUnit:function(){return kn(this.gutter)}},mounted:function(){this.bindTouchEvent(this.$el)},methods:{select:function(t){!this.disabled&&!this.readonly&&t!==this.value&&(this.$emit("input",t),this.$emit("change",t))},onTouchStart:function(t){var n=this;if(!(this.readonly||this.disabled||!this.touchable)){this.touchStart(t);var i=this.$refs.items.map(function(a){return a.getBoundingClientRect()}),o=[];i.forEach(function(a,l){n.allowHalf?o.push({score:l+.5,left:a.left},{score:l+1,left:a.left+a.width/2}):o.push({score:l+1,left:a.left})}),this.ranges=o}},onTouchMove:function(t){if(!(this.readonly||this.disabled||!this.touchable)&&(this.touchMove(t),this.direction==="horizontal")){wr(t);var n=t.touches[0].clientX;this.select(this.getScoreByPosition(n))}},getScoreByPosition:function(t){for(var n=this.ranges.length-1;n>0;n--)if(t>this.ranges[n].left)return this.ranges[n].score;return this.allowHalf?.5:1},genStar:function(t,n){var i=this,o=this.$createElement,a=this.icon,l=this.color,c=this.count,u=this.voidIcon,h=this.disabled,d=this.voidColor,f=this.disabledColor,p=n+1,m=t==="full",g=t==="void",y;return this.gutterWithUnit&&p!==+c&&(y={paddingRight:this.gutterWithUnit}),o("div",{ref:"items",refInFor:!0,key:n,attrs:{role:"radio",tabindex:"0","aria-setsize":c,"aria-posinset":p,"aria-checked":String(!g)},style:y,class:k0("item")},[o(cn,{attrs:{size:this.sizeWithUnit,name:m?a:u,color:h?f:m?l:d,classPrefix:this.iconPrefix,"data-score":p},class:k0("icon",{disabled:h,full:m}),on:{click:function(){i.select(p)}}}),this.allowHalf&&o(cn,{attrs:{size:this.sizeWithUnit,name:g?u:a,color:h?f:g?d:l,classPrefix:this.iconPrefix,"data-score":p-.5},class:k0("icon",["half",{disabled:h,full:!g}]),on:{click:function(){i.select(p-.5)}}})])}},render:function(){var t=this,n=arguments[0];return n("div",{class:k0({readonly:this.readonly,disabled:this.disabled}),attrs:{tabindex:"0",role:"radiogroup"}},[this.list.map(function(i,o){return t.genStar(i,o)})])}});var cD=Ht("row"),$K=cD[0],IK=cD[1];const EK=$K({mixins:[Si("vanRow")],props:{type:String,align:String,justify:String,tag:{type:String,default:"div"},gutter:{type:[Number,String],default:0}},computed:{spaces:function(){var t=Number(this.gutter);if(t){var n=[],i=[[]],o=0;return this.children.forEach(function(a,l){o+=Number(a.span),o>24?(i.push([l]),o-=24):i[i.length-1].push(l)}),i.forEach(function(a){var l=t*(a.length-1)/a.length;a.forEach(function(c,u){if(u===0)n.push({right:l});else{var h=t-n[c-1].right,d=l-h;n.push({left:h,right:d})}})}),n}}},methods:{onClick:function(t){this.$emit("click",t)}},render:function(){var t,n=arguments[0],i=this.align,o=this.justify,a=this.type==="flex";return n(this.tag,{class:IK((t={flex:a},t["align-"+i]=a&&i,t["justify-"+o]=a&&o,t)),on:{click:this.onClick}},[this.slots()])}});var b4=Ht("search"),NK=b4[0],$0=b4[1],AK=b4[2];function uD(r,t,n,i){function o(){if(n.label||t.label)return r("div",{class:$0("label")},[n.label?n.label():t.label])}function a(){if(!t.showAction)return;function u(){n.action||(bn(i,"input",""),bn(i,"cancel"))}return r("div",{class:$0("action"),attrs:{role:"button",tabindex:"0"},on:{click:u}},[n.action?n.action():t.actionText||AK("cancel")])}var l={attrs:i.data.attrs,on:re({},i.listeners,{keypress:function(h){h.keyCode===13&&(wr(h),bn(i,"search",t.value)),bn(i,"keypress",h)}})},c=Xn(i);return c.attrs=void 0,r("div",mn([{class:$0({"show-action":t.showAction}),style:{background:t.background}},c]),[n.left==null?void 0:n.left(),r("div",{class:$0("content",t.shape)},[o(),r(lo,mn([{attrs:{type:"search",border:!1,value:t.value,leftIcon:t.leftIcon,rightIcon:t.rightIcon,clearable:t.clearable,clearTrigger:t.clearTrigger},scopedSlots:{"left-icon":n["left-icon"],"right-icon":n["right-icon"]}},l]))]),a()])}uD.props={value:String,label:String,rightIcon:String,actionText:String,background:String,showAction:Boolean,clearTrigger:String,shape:{type:String,default:"square"},clearable:{type:Boolean,default:!0},leftIcon:{type:String,default:"search"}};const MK=NK(uD);var DK=["qq","link","weibo","wechat","poster","qrcode","weapp-qrcode","wechat-moments"],w4=Ht("share-sheet"),RK=w4[0],pa=w4[1],OK=w4[2];const LK=RK({props:re({},j2,{title:String,duration:String,cancelText:String,description:String,getContainer:[String,Function],options:{type:Array,default:function(){return[]}},overlay:{type:Boolean,default:!0},closeOnPopstate:{type:Boolean,default:!0},safeAreaInsetBottom:{type:Boolean,default:!0},closeOnClickOverlay:{type:Boolean,default:!0}}),methods:{onCancel:function(){this.toggle(!1),this.$emit("cancel")},onSelect:function(t,n){this.$emit("select",t,n)},toggle:function(t){this.$emit("input",t)},getIconURL:function(t){return DK.indexOf(t)!==-1?"https://img01.yzcdn.cn/vant/share-sheet-"+t+".png":t},genHeader:function(){var t=this.$createElement,n=this.slots("title")||this.title,i=this.slots("description")||this.description;if(!(!n&&!i))return t("div",{class:pa("header")},[n&&t("h2",{class:pa("title")},[n]),i&&t("span",{class:pa("description")},[i])])},genOptions:function(t,n){var i=this,o=this.$createElement;return o("div",{class:pa("options",{border:n})},[t.map(function(a,l){return o("div",{attrs:{role:"button",tabindex:"0"},class:[pa("option"),a.className],on:{click:function(){i.onSelect(a,l)}}},[o("img",{attrs:{src:i.getIconURL(a.icon)},class:pa("icon")}),a.name&&o("span",{class:pa("name")},[a.name]),a.description&&o("span",{class:pa("option-description")},[a.description])])})])},genRows:function(){var t=this,n=this.options;return Array.isArray(n[0])?n.map(function(i,o){return t.genOptions(i,o!==0)}):this.genOptions(n)},genCancelText:function(){var t,n=this.$createElement,i=(t=this.cancelText)!=null?t:OK("cancel");if(i)return n("button",{attrs:{type:"button"},class:pa("cancel"),on:{click:this.onCancel}},[i])},onClickOverlay:function(){this.$emit("click-overlay")}},render:function(){var t=arguments[0];return t(Va,{attrs:{round:!0,value:this.value,position:"bottom",overlay:this.overlay,duration:this.duration,lazyRender:this.lazyRender,lockScroll:this.lockScroll,getContainer:this.getContainer,closeOnPopstate:this.closeOnPopstate,closeOnClickOverlay:this.closeOnClickOverlay,safeAreaInsetBottom:this.safeAreaInsetBottom},class:pa(),on:{input:this.toggle,"click-overlay":this.onClickOverlay}},[this.genHeader(),this.genRows(),this.genCancelText()])}});var hD=Ht("sidebar"),FK=hD[0],PK=hD[1];const dD=FK({mixins:[Si("vanSidebar")],model:{prop:"activeKey"},props:{activeKey:{type:[Number,String],default:0}},data:function(){return{index:+this.activeKey}},watch:{activeKey:function(){this.setIndex(+this.activeKey)}},methods:{setIndex:function(t){t!==this.index&&(this.index=t,this.$emit("change",t))}},render:function(){var t=arguments[0];return t("div",{class:PK()},[this.slots()])}});var fD=Ht("sidebar-item"),BK=fD[0],Nx=fD[1];const pD=BK({mixins:[wi("vanSidebar")],props:re({},Rc,{dot:Boolean,info:[Number,String],badge:[Number,String],title:String,disabled:Boolean}),computed:{select:function(){return this.index===+this.parent.activeKey}},methods:{onClick:function(){this.disabled||(this.$emit("click",this.index),this.parent.$emit("input",this.index),this.parent.setIndex(this.index),vh(this.$router,this))}},render:function(){var t,n,i=arguments[0];return i("a",{class:Nx({select:this.select,disabled:this.disabled}),on:{click:this.onClick}},[i("div",{class:Nx("text")},[(t=this.slots("title"))!=null?t:this.title,i(gh,{attrs:{dot:this.dot,info:(n=this.badge)!=null?n:this.info},class:Nx("info")})])])}});var mD=Ht("skeleton"),zK=mD[0],Qf=mD[1],gD="100%",VK="60%";function vD(r,t,n,i){if(!t.loading)return n.default&&n.default();function o(){if(t.title)return r("h3",{class:Qf("title"),style:{width:kn(t.titleWidth)}})}function a(){var c=[],u=t.rowWidth;function h(f){return u===gD&&f===+t.row-1?VK:Array.isArray(u)?u[f]:u}for(var d=0;d<t.row;d++)c.push(r("div",{class:Qf("row"),style:{width:kn(h(d))}}));return c}function l(){if(t.avatar){var c=kn(t.avatarSize);return r("div",{class:Qf("avatar",t.avatarShape),style:{width:c,height:c}})}}return r("div",mn([{class:Qf({animate:t.animate,round:t.round})},Xn(i)]),[l(),r("div",{class:Qf("content")},[o(),a()])])}vD.props={title:Boolean,round:Boolean,avatar:Boolean,titleWidth:[Number,String],avatarSize:[Number,String],row:{type:[Number,String],default:0},loading:{type:Boolean,default:!0},animate:{type:Boolean,default:!0},avatarShape:{type:String,default:"round"},rowWidth:{type:[Number,String,Array],default:gD}};const UK=zK(vD),WK={"zh-CN":{vanSku:{select:"",selected:"",selectSku:"",soldout:"",originPrice:"",minusTip:"",minusStartTip:function(t){return t+""},unavailable:"",stock:"",stockUnit:"",quotaTip:function(t){return""+t+""},quotaUsedTip:function(t,n){return""+t+""+n+""}},vanSkuActions:{buy:"",addCart:""},vanSkuImgUploader:{oversize:function(t){return""+t+"MB"},fail:"",uploading:"..."},vanSkuStepper:{quotaLimit:function(t){return""+t+""},quotaStart:function(t){return t+""},comma:"",num:""},vanSkuMessages:{fill:"",upload:"",imageLabel:"",invalid:{tel:"",mobile:"6-20",email:"",id_no:""},placeholder:{id_no:"",text:"",tel:"",email:"",date:"",time:"",textarea:"",mobile:""}},vanSkuRow:{multiple:""},vanSkuDatetimeField:{title:{date:"",time:"",datetime:""},format:{year:"",month:"",day:"",hour:"",minute:""}}}};var ev={QUOTA_LIMIT:0,STOCK_LIMIT:1},Nu="";const GK={LIMIT_TYPE:ev,UNSELECTED_SKU_VALUE_ID:Nu};var yD=function(t){var n={};return t.forEach(function(i){n[i.k_s]=i.v}),n},HK=function(t){var n={};return t.forEach(function(i){var o={};i.v.forEach(function(a){o[a.id]=a}),n[i.k_id]=o}),n},xD=function(t,n){var i=Object.keys(n).filter(function(o){return n[o]!==Nu});return t.length===i.length},bD=function(t,n){var i=t.filter(function(o){return Object.keys(n).every(function(a){return String(o[a])===String(n[a])})});return i[0]},wD=function(t,n){var i=yD(t);return Object.keys(n).reduce(function(o,a){var l=i[a]||[],c=n[a];if(c!==Nu&&l.length>0){var u=l.filter(function(h){return h.id===c})[0];u&&o.push(u)}return o},[])},S4=function(t,n,i){var o,a=i.key,l=i.valueId,c=re({},n,(o={},o[a]=l,o)),u=Object.keys(c).filter(function(f){return c[f]!==Nu}),h=t.filter(function(f){return u.every(function(p){return String(c[p])===String(f[p])})}),d=h.reduce(function(f,p){return f+=p.stock_num,f},0);return d>0},SD=function(t,n){var i=HK(t);return Object.keys(n).reduce(function(o,a){return n[a].forEach(function(l){o.push(re({},i[a][l]))}),o},[])},_D=function(t,n){var i=[];return(t||[]).forEach(function(o){if(n[o.k_id]&&n[o.k_id].length>0){var a=[];o.v.forEach(function(l){n[o.k_id].indexOf(l.id)>-1&&a.push(re({},l))}),i.push(re({},o,{v:a}))}}),i};const jK={normalizeSkuTree:yD,getSkuComb:bD,getSelectedSkuValues:wD,isAllSelected:xD,isSkuChoosable:S4,getSelectedPropValues:SD,getSelectedProperties:_D};var TD=Ht("sku-header"),qK=TD[0],Ax=TD[1];function KK(r,t){var n;return r.tree.some(function(i){var o=t[i.k_s];if(o&&i.v){var a=i.v.filter(function(c){return c.id===o})[0]||{},l=a.previewImgUrl||a.imgUrl||a.img_url;if(l)return n=re({},a,{ks:i.k_s,imgUrl:l}),!0}return!1}),n}function CD(r,t,n,i){var o,a=t.sku,l=t.goods,c=t.skuEventBus,u=t.selectedSku,h=t.showHeaderImage,d=h===void 0?!0:h,f=KK(a,u),p=f?f.imgUrl:l.picture,m=function(){c.$emit("sku:previewImage",f)};return r("div",mn([{class:[Ax(),_m]},Xn(i)]),[d&&r(uf,{attrs:{fit:"cover",src:p},class:Ax("img-wrap"),on:{click:m}},[(o=n["sku-header-image-extra"])==null?void 0:o.call(n)]),r("div",{class:Ax("goods-info")},[n.default==null?void 0:n.default()])])}CD.props={sku:Object,goods:Object,skuEventBus:Object,selectedSku:Object,showHeaderImage:Boolean};const kD=qK(CD);var $D=Ht("sku-header-item"),XK=$D[0],YK=$D[1];function ZK(r,t,n,i){return r("div",mn([{class:YK()},Xn(i)]),[n.default&&n.default()])}const S1=XK(ZK);var _4=Ht("sku-row"),JK=_4[0],Lo=_4[1],QK=_4[2];const N3=JK({mixins:[Si("vanSkuRows"),ra(function(r){this.scrollable&&this.$refs.scroller&&r(this.$refs.scroller,"scroll",this.onScroll)})],props:{skuRow:Object},data:function(){return{progress:0}},computed:{scrollable:function(){return this.skuRow.largeImageMode&&this.skuRow.v.length>6}},methods:{onScroll:function(){var t=this.$refs,n=t.scroller,i=t.row,o=i.offsetWidth-n.offsetWidth;this.progress=n.scrollLeft/o},genTitle:function(){var t=this.$createElement;return t("div",{class:Lo("title")},[this.skuRow.k,this.skuRow.is_multiple&&t("span",{class:Lo("title-multiple")},["",QK("multiple"),""])])},genIndicator:function(){var t=this.$createElement;if(this.scrollable){var n={transform:"translate3d("+this.progress*20+"px, 0, 0)"};return t("div",{class:Lo("indicator-wrapper")},[t("div",{class:Lo("indicator")},[t("div",{class:Lo("indicator-slider"),style:n})])])}},genContent:function(){var t=this.$createElement,n=this.slots();if(this.skuRow.largeImageMode){var i=[],o=[];return n.forEach(function(a,l){var c=Math.floor(l/3)%2===0?i:o;c.push(a)}),t("div",{class:Lo("scroller"),ref:"scroller"},[t("div",{class:Lo("row"),ref:"row"},[i]),o.length?t("div",{class:Lo("row")},[o]):null])}return n},centerItem:function(t){if(!(!this.skuRow.largeImageMode||!t)){var n=this.children,i=n===void 0?[]:n,o=this.$refs,a=o.scroller,l=o.row,c=i.find(function(d){return+d.skuValue.id==+t});if(a&&l&&c&&c.$el){var u=c.$el,h=u.offsetLeft-(a.offsetWidth-u.offsetWidth)/2;a.scrollLeft=h}}}},render:function(){var t=arguments[0];return t("div",{class:[Lo(),_m]},[this.genTitle(),this.genContent(),this.genIndicator()])}});var tX=Ht("sku-row-item"),eX=tX[0];const ID=eX({mixins:[wi("vanSkuRows")],props:{lazyLoad:Boolean,skuValue:Object,skuKeyStr:String,skuEventBus:Object,selectedSku:Object,largeImageMode:Boolean,disableSoldoutSku:Boolean,skuList:{type:Array,default:function(){return[]}}},computed:{imgUrl:function(){var t=this.skuValue.imgUrl||this.skuValue.img_url;return this.largeImageMode?t||"https://img01.yzcdn.cn/upload_files/2020/06/24/FmKWDg0bN9rMcTp9ne8MXiQWGtLn.png":t},choosable:function(){return this.disableSoldoutSku?S4(this.skuList,this.selectedSku,{key:this.skuKeyStr,valueId:this.skuValue.id}):!0}},methods:{onSelect:function(){this.choosable&&this.skuEventBus.$emit("sku:select",re({},this.skuValue,{skuKeyStr:this.skuKeyStr}))},onPreviewImg:function(t){t.stopPropagation();var n=this.skuValue,i=this.skuKeyStr;this.skuEventBus.$emit("sku:previewImage",re({},n,{ks:i,imgUrl:n.imgUrl||n.img_url}))},genImage:function(t){var n=this.$createElement;if(this.imgUrl)return n(uf,{attrs:{fit:"cover",src:this.imgUrl,lazyLoad:this.lazyLoad},class:t+"-img"})}},render:function(){var t=arguments[0],n=this.skuValue.id===this.selectedSku[this.skuKeyStr],i=this.largeImageMode?Lo("image-item"):Lo("item");return t("span",{class:[i,n?i+"--active":"",this.choosable?"":i+"--disabled"],on:{click:this.onSelect}},[this.genImage(i),t("div",{class:i+"-name"},[this.largeImageMode?t("span",{class:{"van-multi-ellipsis--l2":this.largeImageMode}},[this.skuValue.name]):this.skuValue.name]),this.largeImageMode&&t(cn,{attrs:{name:"enlarge"},class:i+"-img-icon",on:{click:this.onPreviewImg}})])}});var nX=Ht("sku-row-prop-item"),sX=nX[0];const ED=sX({props:{skuValue:Object,skuKeyStr:String,skuEventBus:Object,selectedProp:Object,multiple:Boolean,disabled:Boolean},computed:{choosed:function(){var t=this.selectedProp,n=this.skuKeyStr,i=this.skuValue;return t&&t[n]?t[n].indexOf(i.id)>-1:!1}},methods:{onSelect:function(){this.disabled||this.skuEventBus.$emit("sku:propSelect",re({},this.skuValue,{skuKeyStr:this.skuKeyStr,multiple:this.multiple}))}},render:function(){var t=arguments[0];return t("span",{class:["van-sku-row__item",{"van-sku-row__item--active":this.choosed},{"van-sku-row__item--disabled":this.disabled}],on:{click:this.onSelect}},[t("span",{class:"van-sku-row__item-name"},[this.skuValue.name])])}});var ND=Ht("stepper"),rX=ND[0],I0=ND[1],iX=600,oX=200;function E0(r,t){return String(r)===String(t)}const AD=rX({mixins:[Oc],props:{value:null,theme:String,integer:Boolean,disabled:Boolean,allowEmpty:Boolean,inputWidth:[Number,String],buttonSize:[Number,String],asyncChange:Boolean,placeholder:String,disablePlus:Boolean,disableMinus:Boolean,disableInput:Boolean,decimalLength:[Number,String],name:{type:[Number,String],default:""},min:{type:[Number,String],default:1},max:{type:[Number,String],default:1/0},step:{type:[Number,String],default:1},defaultValue:{type:[Number,String],default:1},showPlus:{type:Boolean,default:!0},showMinus:{type:Boolean,default:!0},showInput:{type:Boolean,default:!0},longPress:{type:Boolean,default:!0}},data:function(){var t,n=(t=this.value)!=null?t:this.defaultValue,i=this.format(n);return E0(i,this.value)||this.$emit("input",i),{currentValue:i}},computed:{minusDisabled:function(){return this.disabled||this.disableMinus||this.currentValue<=+this.min},plusDisabled:function(){return this.disabled||this.disablePlus||this.currentValue>=+this.max},inputStyle:function(){var t={};return this.inputWidth&&(t.width=kn(this.inputWidth)),this.buttonSize&&(t.height=kn(this.buttonSize)),t},buttonStyle:function(){if(this.buttonSize){var t=kn(this.buttonSize);return{width:t,height:t}}}},watch:{max:"check",min:"check",integer:"check",decimalLength:"check",value:function(t){E0(t,this.currentValue)||(this.currentValue=this.format(t))},currentValue:function(t){this.$emit("input",t),this.$emit("change",t,{name:this.name})}},methods:{check:function(){var t=this.format(this.currentValue);E0(t,this.currentValue)||(this.currentValue=t)},formatNumber:function(t){return b6(String(t),!this.integer)},format:function(t){return this.allowEmpty&&t===""||(t=this.formatNumber(t),t=t===""?0:+t,t=LS(t)?this.min:t,t=Math.max(Math.min(this.max,t),this.min),gn(this.decimalLength)&&(t=t.toFixed(this.decimalLength))),t},onInput:function(t){var n=t.target.value,i=this.formatNumber(n);if(gn(this.decimalLength)&&i.indexOf(".")!==-1){var o=i.split(".");i=o[0]+"."+o[1].slice(0,this.decimalLength)}E0(n,i)||(t.target.value=i),i===String(+i)&&(i=+i),this.emitChange(i)},emitChange:function(t){this.asyncChange?(this.$emit("input",t),this.$emit("change",t,{name:this.name})):this.currentValue=t},onChange:function(){var t=this.type;if(this[t+"Disabled"]){this.$emit("overlimit",t);return}var n=t==="minus"?-this.step:+this.step,i=this.format(w6(+this.currentValue,n));this.emitChange(i),this.$emit(t)},onFocus:function(t){this.disableInput&&this.$refs.input?this.$refs.input.blur():this.$emit("focus",t)},onBlur:function(t){var n=this.format(t.target.value);t.target.value=n,this.emitChange(n),this.$emit("blur",t),I6()},longPressStep:function(){var t=this;this.longPressTimer=setTimeout(function(){t.onChange(),t.longPressStep(t.type)},oX)},onTouchStart:function(){var t=this;this.longPress&&(clearTimeout(this.longPressTimer),this.isLongPress=!1,this.longPressTimer=setTimeout(function(){t.isLongPress=!0,t.onChange(),t.longPressStep()},iX))},onTouchEnd:function(t){this.longPress&&(clearTimeout(this.longPressTimer),this.isLongPress&&wr(t))},onMousedown:function(t){this.disableInput&&t.preventDefault()}},render:function(){var t=this,n=arguments[0],i=function(a){return{on:{click:function(c){c.preventDefault(),t.type=a,t.onChange()},touchstart:function(){t.type=a,t.onTouchStart()},touchend:t.onTouchEnd,touchcancel:t.onTouchEnd}}};return n("div",{class:I0([this.theme])},[n("button",mn([{directives:[{name:"show",value:this.showMinus}],attrs:{type:"button"},style:this.buttonStyle,class:I0("minus",{disabled:this.minusDisabled})},i("minus")])),n("input",{directives:[{name:"show",value:this.showInput}],ref:"input",attrs:{type:this.integer?"tel":"text",role:"spinbutton",disabled:this.disabled,readonly:this.disableInput,inputmode:this.integer?"numeric":"decimal",placeholder:this.placeholder,"aria-valuemax":this.max,"aria-valuemin":this.min,"aria-valuenow":this.currentValue},class:I0("input"),domProps:{value:this.currentValue},style:this.inputStyle,on:{input:this.onInput,focus:this.onFocus,blur:this.onBlur,mousedown:this.onMousedown}}),n("button",mn([{directives:[{name:"show",value:this.showPlus}],attrs:{type:"button"},style:this.buttonStyle,class:I0("plus",{disabled:this.plusDisabled})},i("plus")]))])}});var MD=Ht("sku-stepper"),aX=MD[0],N0=MD[2],lX=ev.QUOTA_LIMIT,R$=ev.STOCK_LIMIT;const DD=aX({props:{stock:Number,skuEventBus:Object,skuStockNum:Number,selectedNum:Number,stepperTitle:String,disableStepperInput:Boolean,customStepperConfig:Object,hideQuotaText:Boolean,quota:{type:Number,default:0},quotaUsed:{type:Number,default:0},startSaleNum:{type:Number,default:1}},data:function(){return{currentNum:this.selectedNum,limitType:R$}},watch:{currentNum:function(t){var n=parseInt(t,10);n>=this.stepperMinLimit&&n<=this.stepperLimit&&this.skuEventBus.$emit("sku:numChange",n)},stepperLimit:function(t){t<this.currentNum&&this.stepperMinLimit<=t&&(this.currentNum=t),this.checkState(this.stepperMinLimit,t)},stepperMinLimit:function(t){(t>this.currentNum||t>this.stepperLimit)&&(this.currentNum=t),this.checkState(t,this.stepperLimit)}},computed:{stepperLimit:function(){var t=this.quota-this.quotaUsed,n;return this.quota>0&&t<=this.stock?(n=t<0?0:t,this.limitType=lX):(n=this.stock,this.limitType=R$),n},stepperMinLimit:function(){return this.startSaleNum<1?1:this.startSaleNum},quotaText:function(){var t=this.customStepperConfig,n=t.quotaText,i=t.hideQuotaText;if(i)return"";var o="";if(n)o=n;else{var a=[];this.startSaleNum>1&&a.push(N0("quotaStart",this.startSaleNum)),this.quota>0&&a.push(N0("quotaLimit",this.quota)),o=a.join(N0("comma"))}return o}},created:function(){this.checkState(this.stepperMinLimit,this.stepperLimit)},methods:{setCurrentNum:function(t){this.currentNum=t,this.checkState(this.stepperMinLimit,this.stepperLimit)},onOverLimit:function(t){this.skuEventBus.$emit("sku:overLimit",{action:t,limitType:this.limitType,quota:this.quota,quotaUsed:this.quotaUsed,startSaleNum:this.startSaleNum})},onChange:function(t){var n=parseInt(t,10),i=this.customStepperConfig.handleStepperChange;i&&i(n),this.$emit("change",n)},checkState:function(t,n){this.currentNum<t||t>n?this.currentNum=t:this.currentNum>n&&(this.currentNum=n),this.skuEventBus.$emit("sku:stepperState",{valid:t<=n,min:t,max:n,limitType:this.limitType,quota:this.quota,quotaUsed:this.quotaUsed,startSaleNum:this.startSaleNum})}},render:function(){var t=this,n=arguments[0];return n("div",{class:"van-sku-stepper-stock"},[n("div",{class:"van-sku__stepper-title"},[this.stepperTitle||N0("num")]),n(AD,{attrs:{integer:!0,min:this.stepperMinLimit,max:this.stepperLimit,disableInput:this.disableStepperInput},class:"van-sku__stepper",on:{overlimit:this.onOverLimit,change:this.onChange},model:{value:t.currentNum,callback:function(o){t.currentNum=o}}}),!this.hideQuotaText&&this.quotaText&&n("span",{class:"van-sku__stepper-quota"},["(",this.quotaText,")"])])}});function cX(r){var t=/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/;return t.test(r.trim())}function RD(r){return Array.isArray(r)?r:[r]}function O$(r,t){return new Promise(function(n){if(t==="file"){n(null);return}var i=new FileReader;i.onload=function(o){n(o.target.result)},t==="dataUrl"?i.readAsDataURL(r):t==="text"&&i.readAsText(r)})}function L$(r,t){return RD(r).some(function(n){return n?Ad(t)?t(n):n.size>t:!1})}var uX=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i;function hX(r){return uX.test(r)}function F$(r){return r.isImage?!0:r.file&&r.file.type?r.file.type.indexOf("image")===0:r.url?hX(r.url):r.content?r.content.indexOf("data:image")===0:!1}var OD=Ht("uploader"),dX=OD[0],Bs=OD[1];const LD=dX({inheritAttrs:!1,mixins:[Oc],model:{prop:"fileList"},props:{disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,uploadText:String,afterRead:Function,beforeRead:Function,beforeDelete:Function,previewSize:[Number,String],previewOptions:Object,name:{type:[Number,String],default:""},accept:{type:String,default:"image/*"},fileList:{type:Array,default:function(){return[]}},maxSize:{type:[Number,String,Function],default:Number.MAX_VALUE},maxCount:{type:[Number,String],default:Number.MAX_VALUE},deletable:{type:Boolean,default:!0},showUpload:{type:Boolean,default:!0},previewImage:{type:Boolean,default:!0},previewFullImage:{type:Boolean,default:!0},imageFit:{type:String,default:"cover"},resultType:{type:String,default:"dataUrl"},uploadIcon:{type:String,default:"photograph"}},computed:{previewSizeWithUnit:function(){return kn(this.previewSize)},value:function(){return this.fileList}},created:function(){this.urls=[]},beforeDestroy:function(){this.urls.forEach(function(t){return URL.revokeObjectURL(t)})},methods:{getDetail:function(t){return t===void 0&&(t=this.fileList.length),{name:this.name,index:t}},onChange:function(t){var n=this,i=t.target.files;if(!(this.disabled||!i.length)){if(i=i.length===1?i[0]:[].slice.call(i),this.beforeRead){var o=this.beforeRead(i,this.getDetail());if(!o){this.resetInput();return}if(j1(o)){o.then(function(a){a?n.readFile(a):n.readFile(i)}).catch(this.resetInput);return}}this.readFile(i)}},readFile:function(t){var n=this,i=L$(t,this.maxSize);if(Array.isArray(t)){var o=this.maxCount-this.fileList.length;t.length>o&&(t=t.slice(0,o)),Promise.all(t.map(function(a){return O$(a,n.resultType)})).then(function(a){var l=t.map(function(c,u){var h={file:c,status:"",message:""};return a[u]&&(h.content=a[u]),h});n.onAfterRead(l,i)})}else O$(t,this.resultType).then(function(a){var l={file:t,status:"",message:""};a&&(l.content=a),n.onAfterRead(l,i)})},onAfterRead:function(t,n){var i=this;this.resetInput();var o=t;if(n){var a=t;Array.isArray(t)?(a=[],o=[],t.forEach(function(c){c.file&&(L$(c.file,i.maxSize)?a.push(c):o.push(c))})):o=null,this.$emit("oversize",a,this.getDetail())}var l=Array.isArray(o)?Boolean(o.length):Boolean(o);l&&(this.$emit("input",[].concat(this.fileList,RD(o))),this.afterRead&&this.afterRead(o,this.getDetail()))},onDelete:function(t,n){var i,o=this,a=(i=t.beforeDelete)!=null?i:this.beforeDelete;if(a){var l=a(t,this.getDetail(n));if(!l)return;if(j1(l)){l.then(function(){o.deleteFile(t,n)}).catch(Gp);return}}this.deleteFile(t,n)},deleteFile:function(t,n){var i=this.fileList.slice(0);i.splice(n,1),this.$emit("input",i),this.$emit("delete",t,this.getDetail(n))},resetInput:function(){this.$refs.input&&(this.$refs.input.value="")},onClickUpload:function(t){this.$emit("click-upload",t)},onPreviewImage:function(t){var n=this;if(this.previewFullImage){var i=this.fileList.filter(function(a){return F$(a)}),o=i.map(function(a){return a.file&&!a.url&&a.status!=="failed"&&(a.url=URL.createObjectURL(a.file),n.urls.push(a.url)),a.url});this.imagePreview=d4(re({images:o,startPosition:i.indexOf(t),onClose:function(){n.$emit("close-preview")}},this.previewOptions))}},closeImagePreview:function(){this.imagePreview&&this.imagePreview.close()},chooseFile:function(){this.disabled||this.$refs.input&&this.$refs.input.click()},genPreviewMask:function(t){var n=this.$createElement,i=t.status,o=t.message;if(i==="uploading"||i==="failed"){var a=i==="failed"?n(cn,{attrs:{name:"close"},class:Bs("mask-icon")}):n(ia,{class:Bs("loading")}),l=gn(o)&&o!=="";return n("div",{class:Bs("mask")},[a,l&&n("div",{class:Bs("mask-message")},[o])])}},genPreviewItem:function(t,n){var i,o=this,a,l,c=this.$createElement,u=(i=t.deletable)!=null?i:this.deletable,h=t.status!=="uploading"&&u,d=h&&c("div",{class:Bs("preview-delete"),on:{click:function(x){x.stopPropagation(),o.onDelete(t,n)}}},[c(cn,{attrs:{name:"cross"},class:Bs("preview-delete-icon")})]),f=this.slots("preview-cover",re({index:n},t)),p=f&&c("div",{class:Bs("preview-cover")},[f]),m=(a=t.previewSize)!=null?a:this.previewSize,g=(l=t.imageFit)!=null?l:this.imageFit,y=F$(t)?c(uf,{attrs:{fit:g,src:t.content||t.url,width:m,height:m,lazyLoad:this.lazyLoad},class:Bs("preview-image"),on:{click:function(){o.onPreviewImage(t)}}},[p]):c("div",{class:Bs("file"),style:{width:this.previewSizeWithUnit,height:this.previewSizeWithUnit}},[c(cn,{class:Bs("file-icon"),attrs:{name:"description"}}),c("div",{class:[Bs("file-name"),"van-ellipsis"]},[t.file?t.file.name:t.url]),p]);return c("div",{class:Bs("preview"),on:{click:function(){o.$emit("click-preview",t,o.getDetail(n))}}},[y,this.genPreviewMask(t),d])},genPreviewList:function(){if(this.previewImage)return this.fileList.map(this.genPreviewItem)},genUpload:function(){var t=this.$createElement;if(!(this.fileList.length>=this.maxCount)){var n=this.slots(),i=this.readonly?null:t("input",{attrs:re({},this.$attrs,{type:"file",accept:this.accept,disabled:this.disabled}),ref:"input",class:Bs("input"),on:{change:this.onChange}});if(n)return t("div",{class:Bs("input-wrapper"),key:"input-wrapper",on:{click:this.onClickUpload}},[n,i]);var o;if(this.previewSize){var a=this.previewSizeWithUnit;o={width:a,height:a}}return t("div",{directives:[{name:"show",value:this.showUpload}],class:Bs("upload",{readonly:this.readonly}),style:o,on:{click:this.onClickUpload}},[t(cn,{attrs:{name:this.uploadIcon},class:Bs("upload-icon")}),this.uploadText&&t("span",{class:Bs("upload-text")},[this.uploadText]),i])}}},render:function(){var t=arguments[0];return t("div",{class:Bs()},[t("div",{class:Bs("wrapper",{disabled:this.disabled})},[this.genPreviewList(),this.genUpload()])])}});var FD=Ht("sku-img-uploader"),fX=FD[0],Mx=FD[2];const pX=fX({props:{value:String,uploadImg:Function,customUpload:Function,maxSize:{type:Number,default:6}},data:function(){return{fileList:[]}},watch:{value:function(t){t?this.fileList=[{url:t,isImage:!0}]:this.fileList=[]}},methods:{afterReadFile:function(t){var n=this;t.status="uploading",t.message=Mx("uploading"),this.uploadImg(t.file,t.content).then(function(i){t.status="done",n.$emit("input",i)}).catch(function(){t.status="failed",t.message=Mx("fail")})},onOversize:function(){this.$toast(Mx("oversize",this.maxSize))},onDelete:function(){this.$emit("input","")},onClickUpload:function(){var t=this;this.customUpload&&this.customUpload().then(function(n){t.fileList.push({url:n}),t.$emit("input",n)})}},render:function(){var t=this,n=arguments[0];return n(LD,{attrs:{maxCount:1,readonly:!!this.customUpload,maxSize:this.maxSize*1024*1024,afterRead:this.afterReadFile},on:{oversize:this.onOversize,delete:this.onDelete,"click-upload":this.onClickUpload},model:{value:t.fileList,callback:function(o){t.fileList=o}}})}});function mX(r){return r?new Date(r.replace(/-/g,"/")):null}function gX(r,t){if(t===void 0&&(t="date"),!r)return"";var n=r.getFullYear(),i=r.getMonth()+1,o=r.getDate(),a=n+"-"+Ms(i)+"-"+Ms(o);if(t==="datetime"){var l=r.getHours(),c=r.getMinutes();a+=" "+Ms(l)+":"+Ms(c)}return a}var PD=Ht("sku-datetime-field"),vX=PD[0],P$=PD[2];const yX=vX({props:{value:String,label:String,required:Boolean,placeholder:String,type:{type:String,default:"date"}},data:function(){return{showDatePicker:!1,currentDate:this.type==="time"?"":new Date,minDate:new Date(new Date().getFullYear()-60,0,1)}},watch:{value:function(t){switch(this.type){case"time":this.currentDate=t;break;case"date":case"datetime":this.currentDate=mX(t)||new Date;break}}},computed:{title:function(){return P$("title."+this.type)}},methods:{onClick:function(){this.showDatePicker=!0},onConfirm:function(t){var n=t;this.type!=="time"&&(n=gX(t,this.type)),this.$emit("input",n),this.showDatePicker=!1},onCancel:function(){this.showDatePicker=!1},formatter:function(t,n){var i=P$("format."+t);return""+n+i}},render:function(){var t=this,n=arguments[0];return n(lo,{attrs:{readonly:!0,"is-link":!0,center:!0,value:this.value,label:this.label,required:this.required,placeholder:this.placeholder},on:{click:this.onClick}},[n(Va,{attrs:{round:!0,position:"bottom",getContainer:"body"},slot:"extra",model:{value:t.showDatePicker,callback:function(o){t.showDatePicker=o}}},[n(C5,{attrs:{type:this.type,title:this.title,value:this.currentDate,minDate:this.minDate,formatter:this.formatter},on:{cancel:this.onCancel,confirm:this.onConfirm}})])])}});var T4=Ht("sku-messages"),xX=T4[0],Ph=T4[1],nu=T4[2];const BD=xX({props:{messageConfig:Object,goodsId:[Number,String],messages:{type:Array,default:function(){return[]}}},data:function(){return{messageValues:this.resetMessageValues(this.messages)}},watch:{messages:function(t){this.messageValues=this.resetMessageValues(t)}},methods:{resetMessageValues:function(t){var n=this.messageConfig,i=n.initialMessages,o=i===void 0?{}:i;return(t||[]).map(function(a){return{value:o[a.name]||""}})},getType:function(t){return+t.multiple==1?"textarea":t.type==="id_no"?"text":t.datetime>0?"datetime":t.type},getMessages:function(){var t={};return this.messageValues.forEach(function(n,i){t["message_"+i]=n.value}),t},getCartMessages:function(){var t=this,n={};return this.messageValues.forEach(function(i,o){var a=t.messages[o];n[a.name]=i.value}),n},getPlaceholder:function(t){var n=+t.multiple==1?"textarea":t.type,i=this.messageConfig.placeholderMap||{};return t.placeholder||i[n]||nu("placeholder."+n)},validateMessages:function(){for(var t=this.messageValues,n=0;n<t.length;n++){var i=t[n].value,o=this.messages[n];if(i===""){if(String(o.required)==="1"){var a=nu(o.type==="image"?"upload":"fill");return a+o.name}}else{if(o.type==="tel"&&!OS(i))return nu("invalid.tel");if(o.type==="mobile"&&!/^\d{6,20}$/.test(i))return nu("invalid.mobile");if(o.type==="email"&&!cX(i))return nu("invalid.email");if(o.type==="id_no"&&(i.length<15||i.length>18))return nu("invalid.id_no")}}},getFormatter:function(t){return function(i){return t.type==="mobile"||t.type==="tel"?i.replace(/[^\d.]/g,""):i}},getExtraDesc:function(t){var n=this.$createElement,i=t.extraDesc;if(i)return n("div",{class:Ph("extra-message")},[i])},genMessage:function(t,n){var i=this,o=this.$createElement;if(t.type==="image")return o(ei,{key:this.goodsId+"-"+n,attrs:{title:t.name,required:String(t.required)==="1",valueClass:Ph("image-cell-value")},class:Ph("image-cell")},[o(pX,{attrs:{maxSize:this.messageConfig.uploadMaxSize,uploadImg:this.messageConfig.uploadImg,customUpload:this.messageConfig.customUpload},model:{value:i.messageValues[n].value,callback:function(c){i.$set(i.messageValues[n],"value",c)}}}),o("div",{class:Ph("image-cell-label")},[nu("imageLabel")])]);var a=["date","time"].indexOf(t.type)>-1;return a?o(yX,{attrs:{label:t.name,required:String(t.required)==="1",placeholder:this.getPlaceholder(t),type:this.getType(t)},key:this.goodsId+"-"+n,model:{value:i.messageValues[n].value,callback:function(c){i.$set(i.messageValues[n],"value",c)}}}):o("div",{class:Ph("cell-block")},[o(lo,{attrs:{maxlength:"200",center:!t.multiple,label:t.name,required:String(t.required)==="1",placeholder:this.getPlaceholder(t),type:this.getType(t),formatter:this.getFormatter(t),border:!1},key:this.goodsId+"-"+n,model:{value:i.messageValues[n].value,callback:function(c){i.$set(i.messageValues[n],"value",c)}}}),this.getExtraDesc(t)])}},render:function(){var t=arguments[0];return t("div",{class:Ph()},[this.messages.map(this.genMessage)])}});var C4=Ht("sku-actions"),bX=C4[0],wX=C4[1],B$=C4[2];function zD(r,t,n,i){var o=function(l){return function(){t.skuEventBus.$emit(l)}};return r("div",mn([{class:wX()},Xn(i)]),[t.showAddCartBtn&&r(Pr,{attrs:{size:"large",type:"warning",text:t.addCartText||B$("addCart")},on:{click:o("sku:addCart")}}),r(Pr,{attrs:{size:"large",type:"danger",text:t.buyText||B$("buy")},on:{click:o("sku:buy")}})])}zD.props={buyText:String,addCartText:String,skuEventBus:Object,showAddCartBtn:Boolean};const VD=bX(zD);var k4=Ht("sku"),SX=k4[0],_X=k4[1],qi=k4[2],TX=ev.QUOTA_LIMIT;const aa=SX({props:{sku:Object,goods:Object,value:Boolean,buyText:String,goodsId:[Number,String],priceTag:String,lazyLoad:Boolean,hideStock:Boolean,properties:Array,addCartText:String,stepperTitle:String,getContainer:[String,Function],hideQuotaText:Boolean,hideSelectedText:Boolean,resetStepperOnHide:Boolean,customSkuValidator:Function,disableStepperInput:Boolean,resetSelectedSkuOnHide:Boolean,quota:{type:Number,default:0},quotaUsed:{type:Number,default:0},startSaleNum:{type:Number,default:1},initialSku:{type:Object,default:function(){return{}}},stockThreshold:{type:Number,default:50},showSoldoutSku:{type:Boolean,default:!0},showAddCartBtn:{type:Boolean,default:!0},disableSoldoutSku:{type:Boolean,default:!0},customStepperConfig:{type:Object,default:function(){return{}}},showHeaderImage:{type:Boolean,default:!0},previewOnClickImage:{type:Boolean,default:!0},safeAreaInsetBottom:{type:Boolean,default:!0},closeOnClickOverlay:{type:Boolean,default:!0},bodyOffsetTop:{type:Number,default:200},messageConfig:{type:Object,default:function(){return{initialMessages:{},placeholderMap:{},uploadImg:function(){return Promise.resolve()},uploadMaxSize:5}}}},data:function(){return{selectedSku:{},selectedProp:{},selectedNum:1,show:this.value}},watch:{show:function(t){this.$emit("input",t),t||(this.$emit("sku-close",{selectedSkuValues:this.selectedSkuValues,selectedNum:this.selectedNum,selectedSkuComb:this.selectedSkuComb}),this.resetStepperOnHide&&this.resetStepper(),this.resetSelectedSkuOnHide&&this.resetSelectedSku())},value:function(t){this.show=t},skuTree:"resetSelectedSku",initialSku:function(){this.resetStepper(),this.resetSelectedSku()}},computed:{skuGroupClass:function(){return["van-sku-group-container",{"van-sku-group-container--hide-soldout":!this.showSoldoutSku}]},bodyStyle:function(){if(!this.$isServer){var t=window.innerHeight-this.bodyOffsetTop;return{maxHeight:t+"px"}}},isSkuCombSelected:function(){var t=this;return this.hasSku&&!xD(this.skuTree,this.selectedSku)?!1:!this.propList.filter(function(n){return n.is_necessary!==!1}).some(function(n){return(t.selectedProp[n.k_id]||[]).length===0})},isSkuEmpty:function(){return Object.keys(this.sku).length===0},hasSku:function(){return!this.sku.none_sku},hasSkuOrAttr:function(){return this.hasSku||this.propList.length>0},selectedSkuComb:function(){var t=null;return this.isSkuCombSelected&&(this.hasSku?t=bD(this.skuList,this.selectedSku):t={id:this.sku.collection_id,price:Math.round(this.sku.price*100),stock_num:this.sku.stock_num},t&&(t.properties=_D(this.propList,this.selectedProp),t.property_price=this.selectedPropValues.reduce(function(n,i){return n+(i.price||0)},0))),t},selectedSkuValues:function(){return wD(this.skuTree,this.selectedSku)},selectedPropValues:function(){return SD(this.propList,this.selectedProp)},price:function(){return this.selectedSkuComb?((this.selectedSkuComb.price+this.selectedSkuComb.property_price)/100).toFixed(2):this.sku.price},originPrice:function(){return this.selectedSkuComb&&this.selectedSkuComb.origin_price?((this.selectedSkuComb.origin_price+this.selectedSkuComb.property_price)/100).toFixed(2):this.sku.origin_price},skuTree:function(){return this.sku.tree||[]},skuList:function(){return this.sku.list||[]},propList:function(){return this.properties||[]},imageList:function(){var t=[this.goods.picture];return this.skuTree.length>0&&this.skuTree.forEach(function(n){n.v&&n.v.forEach(function(i){var o=i.previewImgUrl||i.imgUrl||i.img_url;o&&t.indexOf(o)===-1&&t.push(o)})}),t},stock:function(){var t=this.customStepperConfig.stockNum;return t!==void 0?t:this.selectedSkuComb?this.selectedSkuComb.stock_num:this.sku.stock_num},stockText:function(){var t=this.$createElement,n=this.customStepperConfig.stockFormatter;return n?n(this.stock):[qi("stock")+" ",t("span",{class:_X("stock-num",{highlight:this.stock<this.stockThreshold})},[this.stock])," "+qi("stockUnit")]},selectedText:function(){var t=this;if(this.selectedSkuComb){var n=this.selectedSkuValues.concat(this.selectedPropValues);return qi("selected")+" "+n.map(function(a){return a.name}).join(" ")}var i=this.skuTree.filter(function(a){return t.selectedSku[a.k_s]===Nu}).map(function(a){return a.k}),o=this.propList.filter(function(a){return(t.selectedProp[a.k_id]||[]).length<1}).map(function(a){return a.k});return qi("select")+" "+i.concat(o).join(" ")}},created:function(){var t=new dn;this.skuEventBus=t,t.$on("sku:select",this.onSelect),t.$on("sku:propSelect",this.onPropSelect),t.$on("sku:numChange",this.onNumChange),t.$on("sku:previewImage",this.onPreviewImage),t.$on("sku:overLimit",this.onOverLimit),t.$on("sku:stepperState",this.onStepperState),t.$on("sku:addCart",this.onAddCart),t.$on("sku:buy",this.onBuy),this.resetStepper(),this.resetSelectedSku(),this.$emit("after-sku-create",t)},methods:{resetStepper:function(){var t=this.$refs.skuStepper,n=this.initialSku.selectedNum,i=n??this.startSaleNum;this.stepperError=null,t?t.setCurrentNum(i):this.selectedNum=i},resetSelectedSku:function(){var t=this;this.selectedSku={},this.skuTree.forEach(function(l){t.selectedSku[l.k_s]=Nu}),this.skuTree.forEach(function(l){var c=l.k_s,u=l.v.length===1?l.v[0].id:t.initialSku[c];u&&S4(t.skuList,t.selectedSku,{key:c,valueId:u})&&(t.selectedSku[c]=u)});var n=this.selectedSkuValues;n.length>0&&this.$nextTick(function(){t.$emit("sku-selected",{skuValue:n[n.length-1],selectedSku:t.selectedSku,selectedSkuComb:t.selectedSkuComb})}),this.selectedProp={};var i=this.initialSku.selectedProp,o=i===void 0?{}:i;this.propList.forEach(function(l){o[l.k_id]&&(t.selectedProp[l.k_id]=o[l.k_id])}),kW(this.selectedProp)&&this.propList.forEach(function(l){var c;if((l==null||(c=l.v)==null?void 0:c.length)>0){var u=l.v,h=l.k_id,d=u.some(function(p){return+p.price!=0});if(!d){var f=u.find(function(p){return p.text_status!==0});f&&(t.selectedProp[h]=[f.id])}}});var a=this.selectedPropValues;a.length>0&&this.$emit("sku-prop-selected",{propValue:a[a.length-1],selectedProp:this.selectedProp,selectedSkuComb:this.selectedSkuComb}),this.$emit("sku-reset",{selectedSku:this.selectedSku,selectedProp:this.selectedProp,selectedSkuComb:this.selectedSkuComb}),this.centerInitialSku()},getSkuMessages:function(){return this.$refs.skuMessages?this.$refs.skuMessages.getMessages():{}},getSkuCartMessages:function(){return this.$refs.skuMessages?this.$refs.skuMessages.getCartMessages():{}},validateSkuMessages:function(){return this.$refs.skuMessages?this.$refs.skuMessages.validateMessages():""},validateSku:function(){if(this.selectedNum===0)return qi("unavailable");if(this.isSkuCombSelected)return this.validateSkuMessages();if(this.customSkuValidator){var t=this.customSkuValidator(this);if(t)return t}return qi("selectSku")},onSelect:function(t){var n,i;this.selectedSku=this.selectedSku[t.skuKeyStr]===t.id?re({},this.selectedSku,(n={},n[t.skuKeyStr]=Nu,n)):re({},this.selectedSku,(i={},i[t.skuKeyStr]=t.id,i)),this.$emit("sku-selected",{skuValue:t,selectedSku:this.selectedSku,selectedSkuComb:this.selectedSkuComb})},onPropSelect:function(t){var n,i=this.selectedProp[t.skuKeyStr]||[],o=i.indexOf(t.id);o>-1?i.splice(o,1):t.multiple?i.push(t.id):i.splice(0,1,t.id),this.selectedProp=re({},this.selectedProp,(n={},n[t.skuKeyStr]=i,n)),this.$emit("sku-prop-selected",{propValue:t,selectedProp:this.selectedProp,selectedSkuComb:this.selectedSkuComb})},onNumChange:function(t){this.selectedNum=t},onPreviewImage:function(t){var n=this,i=this.imageList,o=0,a=i[0];t&&t.imgUrl&&(this.imageList.some(function(c,u){return c===t.imgUrl?(o=u,!0):!1}),a=t.imgUrl);var l=re({},t,{index:o,imageList:this.imageList,indexImage:a});this.$emit("open-preview",l),this.previewOnClickImage&&d4({images:this.imageList,startPosition:o,onClose:function(){n.$emit("close-preview",l)}})},onOverLimit:function(t){var n=t.action,i=t.limitType,o=t.quota,a=t.quotaUsed,l=this.customStepperConfig.handleOverLimit;if(l){l(t);return}n==="minus"?this.startSaleNum>1?ir(qi("minusStartTip",this.startSaleNum)):ir(qi("minusTip")):n==="plus"&&(i===TX?a>0?ir(qi("quotaUsedTip",o,a)):ir(qi("quotaTip",o)):ir(qi("soldout")))},onStepperState:function(t){this.stepperError=t.valid?null:re({},t,{action:"plus"})},onAddCart:function(){this.onBuyOrAddCart("add-cart")},onBuy:function(){this.onBuyOrAddCart("buy-clicked")},onBuyOrAddCart:function(t){if(this.stepperError)return this.onOverLimit(this.stepperError);var n=this.validateSku();n?ir(n):this.$emit(t,this.getSkuData())},getSkuData:function(){return{goodsId:this.goodsId,messages:this.getSkuMessages(),selectedNum:this.selectedNum,cartMessages:this.getSkuCartMessages(),selectedSkuComb:this.selectedSkuComb}},onOpened:function(){this.centerInitialSku()},centerInitialSku:function(){var t=this;(this.$refs.skuRows||[]).forEach(function(n){var i=n.skuRow||{},o=i.k_s;n.centerItem(t.initialSku[o])})}},render:function(){var t=this,n=arguments[0];if(!this.isSkuEmpty){var i=this.sku,o=this.skuList,a=this.goods,l=this.price,c=this.lazyLoad,u=this.originPrice,h=this.skuEventBus,d=this.selectedSku,f=this.selectedProp,p=this.selectedNum,m=this.stepperTitle,g=this.selectedSkuComb,y=this.showHeaderImage,v=this.disableSoldoutSku,x={price:l,originPrice:u,selectedNum:p,skuEventBus:h,selectedSku:d,selectedSkuComb:g},b=function(I){return t.slots(I,x)},w=b("sku-header")||n(kD,{attrs:{sku:i,goods:a,skuEventBus:h,selectedSku:d,showHeaderImage:y}},[n("template",{slot:"sku-header-image-extra"},[b("sku-header-image-extra")]),b("sku-header-price")||n("div",{class:"van-sku__goods-price"},[n("span",{class:"van-sku__price-symbol"},[""]),n("span",{class:"van-sku__price-num"},[l]),this.priceTag&&n("span",{class:"van-sku__price-tag"},[this.priceTag])]),b("sku-header-origin-price")||u&&n(S1,[qi("originPrice")," ",u]),!this.hideStock&&n(S1,[n("span",{class:"van-sku__stock"},[this.stockText])]),this.hasSkuOrAttr&&!this.hideSelectedText&&n(S1,[this.selectedText]),b("sku-header-extra")]),S=b("sku-group")||this.hasSkuOrAttr&&n("div",{class:this.skuGroupClass},[this.skuTree.map(function(k){return n(N3,{attrs:{skuRow:k},ref:"skuRows",refInFor:!0},[k.v.map(function(I){return n(ID,{attrs:{skuList:o,lazyLoad:c,skuValue:I,skuKeyStr:k.k_s,selectedSku:d,skuEventBus:h,disableSoldoutSku:v,largeImageMode:k.largeImageMode}})})])}),this.propList.map(function(k){return n(N3,{attrs:{skuRow:k}},[k.v.map(function(I){return n(ED,{attrs:{skuValue:I,skuKeyStr:k.k_id+"",selectedProp:f,skuEventBus:h,multiple:k.is_multiple,disabled:I.text_status===0}})})])})]),_=b("sku-stepper")||n(DD,{ref:"skuStepper",attrs:{stock:this.stock,quota:this.quota,quotaUsed:this.quotaUsed,startSaleNum:this.startSaleNum,skuEventBus:h,selectedNum:p,stepperTitle:m,skuStockNum:i.stock_num,disableStepperInput:this.disableStepperInput,customStepperConfig:this.customStepperConfig,hideQuotaText:this.hideQuotaText},on:{change:function(I){t.$emit("stepper-change",I)}}}),$=b("sku-messages")||n(BD,{ref:"skuMessages",attrs:{goodsId:this.goodsId,messageConfig:this.messageConfig,messages:i.messages}}),N=b("sku-actions")||n(VD,{attrs:{buyText:this.buyText,skuEventBus:h,addCartText:this.addCartText,showAddCartBtn:this.showAddCartBtn}});return n(Va,{attrs:{round:!0,closeable:!0,position:"bottom",getContainer:this.getContainer,closeOnClickOverlay:this.closeOnClickOverlay,safeAreaInsetBottom:this.safeAreaInsetBottom},class:"van-sku-container",on:{opened:this.onOpened},model:{value:t.show,callback:function(I){t.show=I}}},[w,n("div",{class:"van-sku-body",style:this.bodyStyle},[b("sku-body-top"),S,b("extra-sku-group"),_,$]),b("sku-actions-top"),N])}}});RS.add(WK);aa.SkuActions=VD;aa.SkuHeader=kD;aa.SkuHeaderItem=S1;aa.SkuMessages=BD;aa.SkuStepper=DD;aa.SkuRow=N3;aa.SkuRowItem=ID;aa.SkuRowPropItem=ED;aa.skuHelper=jK;aa.skuConstants=GK;var UD=Ht("slider"),CX=UD[0],A0=UD[1],z$=function(t,n){return JSON.stringify(t)===JSON.stringify(n)};const kX=CX({mixins:[To,Oc],props:{disabled:Boolean,vertical:Boolean,range:Boolean,barHeight:[Number,String],buttonSize:[Number,String],activeColor:String,inactiveColor:String,min:{type:[Number,String],default:0},max:{type:[Number,String],default:100},step:{type:[Number,String],default:1},value:{type:[Number,Array],default:0}},data:function(){return{dragStatus:""}},computed:{scope:function(){return this.max-this.min},buttonStyle:function(){if(this.buttonSize){var t=kn(this.buttonSize);return{width:t,height:t}}}},created:function(){this.updateValue(this.value)},mounted:function(){this.range?(this.bindTouchEvent(this.$refs.wrapper0),this.bindTouchEvent(this.$refs.wrapper1)):this.bindTouchEvent(this.$refs.wrapper)},methods:{onTouchStart:function(t){this.disabled||(this.touchStart(t),this.currentValue=this.value,this.range?this.startValue=this.value.map(this.format):this.startValue=this.format(this.value),this.dragStatus="start")},onTouchMove:function(t){if(!this.disabled){this.dragStatus==="start"&&this.$emit("drag-start"),wr(t,!0),this.touchMove(t),this.dragStatus="draging";var n=this.$el.getBoundingClientRect(),i=this.vertical?this.deltaY:this.deltaX,o=this.vertical?n.height:n.width,a=i/o*this.scope;this.range?this.currentValue[this.index]=this.startValue[this.index]+a:this.currentValue=this.startValue+a,this.updateValue(this.currentValue)}},onTouchEnd:function(){this.disabled||(this.dragStatus==="draging"&&(this.updateValue(this.currentValue,!0),this.$emit("drag-end")),this.dragStatus="")},onClick:function(t){if(t.stopPropagation(),!this.disabled){var n=this.$el.getBoundingClientRect(),i=this.vertical?t.clientY-n.top:t.clientX-n.left,o=this.vertical?n.height:n.width,a=+this.min+i/o*this.scope;if(this.range){var l=this.value,c=l[0],u=l[1],h=(c+u)/2;a<=h?c=a:u=a,a=[c,u]}this.startValue=this.value,this.updateValue(a,!0)}},handleOverlap:function(t){return t[0]>t[1]?(t=Hp(t),t.reverse()):t},updateValue:function(t,n){this.range?t=this.handleOverlap(t).map(this.format):t=this.format(t),z$(t,this.value)||this.$emit("input",t),n&&!z$(t,this.startValue)&&this.$emit("change",t)},format:function(t){var n=+this.min,i=+this.max,o=+this.step;t=Dr(t,n,i);var a=Math.round((t-n)/o)*o;return w6(n,a)}},render:function(){var t,n=this,i,o=arguments[0],a=this.vertical,l=a?"height":"width",c=a?"width":"height",u=(t={background:this.inactiveColor},t[c]=kn(this.barHeight),t),h=function(){var g=n.value,y=n.min,v=n.range,x=n.scope;return v?(g[1]-g[0])*100/x+"%":(g-y)*100/x+"%"},d=function(){var g=n.value,y=n.min,v=n.range,x=n.scope;return v?(g[0]-y)*100/x+"%":null},f=(i={},i[l]=h(),i.left=this.vertical?null:d(),i.top=this.vertical?d():null,i.background=this.activeColor,i);this.dragStatus&&(f.transition="none");var p=function(g){var y=["left","right"],v=typeof g=="number",x=v?n.value[g]:n.value,b=function(){return v?"button-wrapper-"+y[g]:"button-wrapper"},w=function(){return v?"wrapper"+g:"wrapper"},S=function(){if(v){var $=n.slots(g===0?"left-button":"right-button",{value:x});if($)return $}return n.slots("button")?n.slots("button"):o("div",{class:A0("button"),style:n.buttonStyle})};return o("div",{ref:w(),attrs:{role:"slider",tabindex:n.disabled?-1:0,"aria-valuemin":n.min,"aria-valuenow":n.value,"aria-valuemax":n.max,"aria-orientation":n.vertical?"vertical":"horizontal"},class:A0(b()),on:{touchstart:function(){v&&(n.index=g)},click:function($){return $.stopPropagation()}}},[S()])};return o("div",{style:u,class:A0({disabled:this.disabled,vertical:a}),on:{click:this.onClick}},[o("div",{class:A0("bar"),style:f},[this.range?[p(0),p(1)]:p()])])}});var WD=Ht("step"),$X=WD[0],Ul=WD[1];const IX=$X({mixins:[wi("vanSteps")],computed:{status:function(){if(this.index<this.parent.active)return"finish";if(this.index===+this.parent.active)return"process"},active:function(){return this.status==="process"},lineStyle:function(){var t=this.parent,n=t.activeColor,i=t.inactiveColor,o=t.center,a=t.direction,l={background:this.status==="finish"?n:i};return o&&a==="vertical"&&(l.top="50%"),l},circleContainerStyle:function(){if(this.parent.center&&this.parent.direction==="vertical")return{top:"50%"}},titleStyle:function(){if(this.active)return{color:this.parent.activeColor};if(!this.status)return{color:this.parent.inactiveColor}}},methods:{genCircle:function(){var t=this.$createElement,n=this.parent,i=n.activeIcon,o=n.iconPrefix,a=n.activeColor,l=n.finishIcon,c=n.inactiveIcon;if(this.active)return this.slots("active-icon")||t(cn,{class:Ul("icon","active"),attrs:{name:i,color:a,classPrefix:o}});var u=this.slots("finish-icon");if(this.status==="finish"&&(l||u))return u||t(cn,{class:Ul("icon","finish"),attrs:{name:l,color:a,classPrefix:o}});var h=this.slots("inactive-icon");return c||h?h||t(cn,{class:Ul("icon"),attrs:{name:c,classPrefix:o}}):t("i",{class:Ul("circle"),style:this.lineStyle})},onClickStep:function(){this.parent.$emit("click-step",this.index)}},render:function(){var t,n=arguments[0],i=this.status,o=this.active,a=this.parent.direction;return n("div",{class:[Ho,Ul([a,(t={},t[i]=i,t)])]},[n("div",{class:Ul("title",{active:o}),style:this.titleStyle,on:{click:this.onClickStep}},[this.slots()]),n("div",{class:Ul("circle-container"),on:{click:this.onClickStep},style:this.circleContainerStyle},[this.genCircle()]),n("div",{class:Ul("line"),style:this.lineStyle})])}});var GD=Ht("steps"),EX=GD[0],V$=GD[1];const NX=EX({mixins:[Si("vanSteps")],props:{center:Boolean,iconPrefix:String,finishIcon:String,activeColor:String,inactiveIcon:String,inactiveColor:String,active:{type:[Number,String],default:0},direction:{type:String,default:"horizontal"},activeIcon:{type:String,default:"checked"}},render:function(){var t=arguments[0];return t("div",{class:V$([this.direction])},[t("div",{class:V$("items")},[this.slots()])])}});var $4=Ht("submit-bar"),AX=$4[0],ma=$4[1],MX=$4[2];function HD(r,t,n,i){var o=t.tip,a=t.price,l=t.tipIcon;function c(){if(typeof a=="number"){var h=(a/100).toFixed(t.decimalLength).split("."),d=t.decimalLength?"."+h[1]:"";return r("div",{style:{textAlign:t.textAlign?t.textAlign:""},class:ma("text")},[r("span",[t.label||MX("label")]),r("span",{class:ma("price")},[t.currency,r("span",{class:ma("price","integer")},[h[0]]),d]),t.suffixLabel&&r("span",{class:ma("suffix-label")},[t.suffixLabel])])}}function u(){if(n.tip||o)return r("div",{class:ma("tip")},[l&&r(cn,{class:ma("tip-icon"),attrs:{name:l}}),o&&r("span",{class:ma("tip-text")},[o]),n.tip&&n.tip()])}return r("div",mn([{class:ma({unfit:!t.safeAreaInsetBottom})},Xn(i)]),[n.top&&n.top(),u(),r("div",{class:ma("bar")},[n.default&&n.default(),c(),n.button?n.button():r(Pr,{attrs:{round:!0,type:t.buttonType,text:t.loading?"":t.buttonText,color:t.buttonColor,loading:t.loading,disabled:t.disabled},class:ma("button",t.buttonType),on:{click:function(){bn(i,"submit")}}})])])}HD.props={tip:String,label:String,price:Number,tipIcon:String,loading:Boolean,disabled:Boolean,textAlign:String,buttonText:String,buttonColor:String,suffixLabel:String,safeAreaInsetBottom:{type:Boolean,default:!0},decimalLength:{type:[Number,String],default:2},currency:{type:String,default:""},buttonType:{type:String,default:"danger"}};const DX=AX(HD);var jD=Ht("swipe-cell"),RX=jD[0],M0=jD[1],U$=.15;const OX=RX({mixins:[To,c4({event:"touchstart",method:"onClick"})],props:{onClose:Function,disabled:Boolean,leftWidth:[Number,String],rightWidth:[Number,String],beforeClose:Function,stopPropagation:Boolean,name:{type:[Number,String],default:""}},data:function(){return{offset:0,dragging:!1}},computed:{computedLeftWidth:function(){return+this.leftWidth||this.getWidthByRef("left")},computedRightWidth:function(){return+this.rightWidth||this.getWidthByRef("right")}},mounted:function(){this.bindTouchEvent(this.$el)},methods:{getWidthByRef:function(t){if(this.$refs[t]){var n=this.$refs[t].getBoundingClientRect();return n.width}return 0},open:function(t){var n=t==="left"?this.computedLeftWidth:-this.computedRightWidth;this.opened=!0,this.offset=n,this.$emit("open",{position:t,name:this.name,detail:this.name})},close:function(t){this.offset=0,this.opened&&(this.opened=!1,this.$emit("close",{position:t,name:this.name}))},onTouchStart:function(t){this.disabled||(this.startOffset=this.offset,this.touchStart(t))},onTouchMove:function(t){if(!this.disabled&&(this.touchMove(t),this.direction==="horizontal")){this.dragging=!0,this.lockClick=!0;var n=!this.opened||this.deltaX*this.startOffset<0;n&&wr(t,this.stopPropagation),this.offset=Dr(this.deltaX+this.startOffset,-this.computedRightWidth,this.computedLeftWidth)}},onTouchEnd:function(){var t=this;this.disabled||this.dragging&&(this.toggle(this.offset>0?"left":"right"),this.dragging=!1,setTimeout(function(){t.lockClick=!1},0))},toggle:function(t){var n=Math.abs(this.offset),i=this.opened?1-U$:U$,o=this.computedLeftWidth,a=this.computedRightWidth;a&&t==="right"&&n>a*i?this.open("right"):o&&t==="left"&&n>o*i?this.open("left"):this.close()},onClick:function(t){t===void 0&&(t="outside"),this.$emit("click",t),this.opened&&!this.lockClick&&(this.beforeClose?this.beforeClose({position:t,name:this.name,instance:this}):this.onClose?this.onClose(t,this,{name:this.name}):this.close(t))},getClickHandler:function(t,n){var i=this;return function(o){n&&o.stopPropagation(),i.onClick(t)}},genLeftPart:function(){var t=this.$createElement,n=this.slots("left");if(n)return t("div",{ref:"left",class:M0("left"),on:{click:this.getClickHandler("left",!0)}},[n])},genRightPart:function(){var t=this.$createElement,n=this.slots("right");if(n)return t("div",{ref:"right",class:M0("right"),on:{click:this.getClickHandler("right",!0)}},[n])}},render:function(){var t=arguments[0],n={transform:"translate3d("+this.offset+"px, 0, 0)",transitionDuration:this.dragging?"0s":".6s"};return t("div",{class:M0(),on:{click:this.getClickHandler("cell")}},[t("div",{class:M0("wrapper"),style:n},[this.genLeftPart(),this.slots(),this.genRightPart()])])}});var qD=Ht("switch-cell"),LX=qD[0],FX=qD[1];function KD(r,t,n,i){return r(ei,mn([{attrs:{center:!0,size:t.cellSize,title:t.title,border:t.border},class:FX([t.cellSize])},Xn(i)]),[r(Z2,{props:re({},t),on:re({},i.listeners)})])}KD.props=re({},z6,{title:String,cellSize:String,border:{type:Boolean,default:!0},size:{type:String,default:"24px"}});const PX=LX(KD);var XD=Ht("tabbar"),BX=XD[0],W$=XD[1];const zX=BX({mixins:[Si("vanTabbar")],props:{route:Boolean,zIndex:[Number,String],placeholder:Boolean,activeColor:String,beforeChange:Function,inactiveColor:String,value:{type:[Number,String],default:0},border:{type:Boolean,default:!0},fixed:{type:Boolean,default:!0},safeAreaInsetBottom:{type:Boolean,default:null}},data:function(){return{height:null}},computed:{fit:function(){return this.safeAreaInsetBottom!==null?this.safeAreaInsetBottom:this.fixed}},watch:{value:"setActiveItem",children:"setActiveItem"},mounted:function(){var t=this;if(this.placeholder&&this.fixed){var n=function(){t.height=t.$refs.tabbar.getBoundingClientRect().height};n(),setTimeout(n,100)}},methods:{setActiveItem:function(){var t=this;this.children.forEach(function(n,i){n.nameMatched=n.name===t.value||i===t.value})},triggerChange:function(t,n){var i=this;s5({interceptor:this.beforeChange,args:[t],done:function(){i.$emit("input",t),i.$emit("change",t),n()}})},genTabbar:function(){var t,n=this.$createElement;return n("div",{ref:"tabbar",style:{zIndex:this.zIndex},class:[(t={},t[X2]=this.border,t),W$({unfit:!this.fit,fixed:this.fixed})]},[this.slots()])}},render:function(){var t=arguments[0];return this.placeholder&&this.fixed?t("div",{class:W$("placeholder"),style:{height:this.height+"px"}},[this.genTabbar()]):this.genTabbar()}});var YD=Ht("tabbar-item"),VX=YD[0],Dx=YD[1];const UX=VX({mixins:[wi("vanTabbar")],props:re({},Rc,{dot:Boolean,icon:String,name:[Number,String],info:[Number,String],badge:[Number,String],iconPrefix:String}),data:function(){return{nameMatched:!1}},computed:{active:function(){var t=this.parent.route;if(t&&"$route"in this){var n=this.to,i=this.$route,o=sa(n)?n:{path:n};return!!i.matched.find(function(a){var l=a.path===""?"/":a.path,c=o.path===l,u=gn(o.name)&&o.name===a.name;return c||u})}return this.nameMatched}},methods:{onClick:function(t){var n=this;this.active||this.parent.triggerChange(this.name||this.index,function(){vh(n.$router,n)}),this.$emit("click",t)},genIcon:function(){var t=this.$createElement,n=this.slots("icon",{active:this.active});if(n)return n;if(this.icon)return t(cn,{attrs:{name:this.icon,classPrefix:this.iconPrefix}})}},render:function(){var t,n=arguments[0],i=this.active,o=this.parent[i?"activeColor":"inactiveColor"];return n("div",{class:Dx({active:i}),style:{color:o},on:{click:this.onClick}},[n("div",{class:Dx("icon")},[this.genIcon(),n(gh,{attrs:{dot:this.dot,info:(t=this.badge)!=null?t:this.info}})]),n("div",{class:Dx("text")},[this.slots("default",{active:i})])])}});var ZD=Ht("tree-select"),WX=ZD[0],Bh=ZD[1];function JD(r,t,n,i){var o=t.items,a=t.height,l=t.activeId,c=t.selectedIcon,u=t.mainActiveIndex,h=o[+u]||{},d=h.children||[],f=Array.isArray(l);function p(y){return f?l.indexOf(y)!==-1:l===y}var m=o.map(function(y){var v;return r(pD,{attrs:{dot:y.dot,info:(v=y.badge)!=null?v:y.info,title:y.text,disabled:y.disabled},class:[Bh("nav-item"),y.className]})});function g(){return n.content?n.content():d.map(function(y){return r("div",{key:y.id,class:["van-ellipsis",Bh("item",{active:p(y.id),disabled:y.disabled})],on:{click:function(){if(!y.disabled){var x=y.id;if(f){x=l.slice();var b=x.indexOf(y.id);b!==-1?x.splice(b,1):x.length<t.max&&x.push(y.id)}bn(i,"update:active-id",x),bn(i,"click-item",y),bn(i,"itemclick",y)}}}},[y.text,p(y.id)&&r(cn,{attrs:{name:c},class:Bh("selected")})])})}return r("div",mn([{class:Bh(),style:{height:kn(a)}},Xn(i)]),[r(dD,{class:Bh("nav"),attrs:{activeKey:u},on:{change:function(v){bn(i,"update:main-active-index",v),bn(i,"click-nav",v),bn(i,"navclick",v)}}},[m]),r("div",{class:Bh("content")},[g()])])}JD.props={max:{type:[Number,String],default:1/0},items:{type:Array,default:function(){return[]}},height:{type:[Number,String],default:300},activeId:{type:[Number,String,Array],default:0},selectedIcon:{type:String,default:"success"},mainActiveIndex:{type:[Number,String],default:0}};const GX=WX(JD);var HX="2.12.53";function QD(r){var t=[tG,FG,qG,T6,XG,Pr,uH,fH,$H,ei,h5,f5,DH,FH,zH,WH,jH,KH,YH,QH,ij,C3,hj,pj,C5,qs,Tj,kj,Ij,Mj,lo,Oj,P6,y3,Fj,zj,Uj,cn,uf,d4,Jj,eq,gh,rq,ia,RS,oq,lq,xo,gq,r6,yq,bq,Sq,WS,vK,Va,xK,_K,YS,XS,kK,EK,MK,LK,dD,pD,UK,aa,kX,IX,AD,NX,o5,DX,F5,OX,B5,Z2,PX,Z1,zX,UX,t4,J2,ir,GX,LD];t.forEach(function(n){n.install?r.use(n):n.name&&r.component(n.name,n)})}typeof window<"u"&&window.Vue&&QD(window.Vue);const jX={install:QD,version:HX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qX=1e-7,KX=1e-4;class tR{constructor(t,n){this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,n){this.dataIdsCount++,this.data.set(t,n)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}let I4=class{refCount(t){return ai("refCount")}incRef(t){return ai("incRef")}timerAvailable(){return!0}time(t){return ai("time")}read(t){return ai("read")}readSync(t){return ai("readSync")}readToGPU(t,n){return ai("readToGPU")}numDataIds(){return ai("numDataIds")}disposeData(t,n){return ai("disposeData")}write(t,n,i){return ai("write")}move(t,n,i,o,a){return ai("move")}createTensorFromTexture(t,n,i){return ai("createTensorFromTexture")}memory(){return ai("memory")}floatPrecision(){return ai("floatPrecision")}epsilon(){return this.floatPrecision()===32?qX:KX}dispose(){return ai("dispose")}};function ai(r){throw new Error(`'${r}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XX(r){let t=r.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,id(r,t,n)}function Gu(r,t,n){return Math.max(r,Math.min(t,n))}function E4(r){return r%2===0?r:r+1}function id(r,t,n){const i=r[t];r[t]=r[n],r[n]=i}function YX(r){let t=0;for(let n=0;n<r.length;n++)t+=r[n];return t}function W(r,t){if(!r)throw new Error(typeof t=="string"?t:t())}function Co(r,t,n=""){W(An(r,t),()=>n+` Shapes ${r} and ${t} must match`)}function eR(r){W(r!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Dd(r,t=[],n=!1){if(t==null&&(t=[]),Array.isArray(r)||Fa(r)&&!n)for(let i=0;i<r.length;++i)Dd(r[i],t,n);else t.push(r);return t}function Nt(r){if(r.length===0)return 1;let t=r[0];for(let n=1;n<r.length;n++)t*=r[n];return t}function An(r,t){if(r===t)return!0;if(r==null||t==null||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!==t[n])return!1;return!0}function Rd(r){return r%1===0}function A3(r){const t=Math.ceil(Math.sqrt(r));return[t,Math.ceil(r/t)]}function bd(r,t){return t<=r.length?r:r+" ".repeat(t-r.length)}function G$(r,t=o=>0,n,i){return new Promise((o,a)=>{let l=0;const c=()=>{if(r()){o();return}l++;const u=t(l);if(n!=null&&l>=n){a();return}i!=null?i(c,u):setTimeout(c,u)};c()})}function nR(r,t){let n=1,i=-1;for(let a=0;a<r.length;++a)if(r[a]>=0)n*=r[a];else if(r[a]===-1){if(i!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${i} and dim ${a}`);i=a}else if(r[a]<0)throw Error(`Shapes can not be < 0. Found ${r[a]} at dim ${a}`);if(i===-1){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${r}`);return r}if(n===0)throw Error(`Cannot infer the missing size in [${r}] when there are 0 elements`);if(t%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);const o=r.slice();return o[i]=t/n,o}function on(r,t){const n=t.length;return r=r==null?t.map((i,o)=>o):[].concat(r),W(r.every(i=>i>=-n&&i<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${r}`),W(r.every(i=>Rd(i)),()=>`All values in axis param must be integers but got axis ${r}`),r.map(i=>i<0?n+i:i)}function Lc(r,t){const n=[],i=[],o=t!=null&&Array.isArray(t)&&t.length===0,a=t==null||o?null:on(t,r).sort();let l=0;for(let c=0;c<r.length;++c){if(a!=null){if(a[l]===c&&r[c]!==1)throw new Error(`Can't squeeze axis ${c} since its dim '${r[c]}' is not 1`);(a[l]==null||a[l]>c)&&r[c]===1&&(n.push(r[c]),i.push(c)),a[l]<=c&&l++}r[c]!==1&&(n.push(r[c]),i.push(c))}return{newShape:n,keptDims:i}}function hr(r,t){let n=null;if(r==null||r==="float32")n=new Float32Array(t);else if(r==="int32")n=new Int32Array(t);else if(r==="bool")n=new Uint8Array(t);else throw new Error(`Unknown data type ${r}`);return n}function ks(r,t){let n=null;if(r==null||r==="float32")n=new Float32Array(t);else if(r==="int32")n=new Int32Array(t);else if(r==="bool")n=new Uint8Array(t);else if(r==="string")n=new Array(t);else throw new Error(`Unknown data type ${r}`);return n}function ZX(r,t){for(let n=0;n<r.length;n++){const i=r[n];if(isNaN(i)||!isFinite(i))throw Error(`A tensor of type ${t} being uploaded contains ${i}.`)}}function JX(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function sR(r,t){return!(t==="complex64"||t==="float32"&&r!=="complex64"||t==="int32"&&r!=="float32"&&r!=="complex64"||t==="bool"&&r==="bool")}function Fa(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}function M3(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error(`Unknown dtype ${r}`)}function QX(r){if(r==null)return 0;let t=0;return r.forEach(n=>t+=n.length),t}function Cm(r){return typeof r=="string"||r instanceof String}function tY(r){return typeof r=="boolean"}function D3(r){return typeof r=="number"}function km(r){return Array.isArray(r)?km(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":D3(r)?"float32":Cm(r)?"string":tY(r)?"bool":"float32"}function R3(r){return!!(r&&r.constructor&&r.call&&r.apply)}function O3(r,t){for(let n=t;n<r;++n)if(r%n===0)return n;return r}function Ie(r){const t=r.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=r[t-1];for(let i=t-3;i>=0;--i)n[i]=n[i+1]*r[i+1];return n}function rR(r,t,n,i=!1){const o=new Array;if(t.length===1){const a=t[0]*(i?2:1);for(let l=0;l<a;l++)o[l]=n[r+l]}else{const a=t[0],l=t.slice(1),c=l.reduce((u,h)=>u*h)*(i?2:1);for(let u=0;u<a;u++)o[u]=rR(r+u*c,l,n,i)}return o}function qo(r,t,n=!1){if(r.length===0)return t[0];const i=r.reduce((o,a)=>o*a)*(n?2:1);if(i===0)return[];if(i!==t.length)throw new Error(`[${r}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return rR(0,r,t,n)}function N4(r,t){const n=Sr(r,t);for(let i=0;i<n.length;i++)n[i]=1;return n}function Sr(r,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(r);if(t==="int32")return new Int32Array(r);if(t==="bool")return new Uint8Array(r);throw new Error(`Unknown data type ${t}`)}function iR(r,t){const n=r.reduce((i,o)=>i*o,1);if(t==null||t==="float32")return qo(r,new Float32Array(n));if(t==="int32")return qo(r,new Int32Array(n));if(t==="bool")return qo(r,new Uint8Array(n));throw new Error(`Unknown data type ${t}`)}function El(r){r.forEach(t=>{W(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${r}].`)})}function Na(r,t,n){if(t===0)return 0;if(t===1)return r[0];let i=r[r.length-1];for(let o=0;o<r.length-1;++o)i+=n[o]*r[o];return i}function hf(r,t,n){if(t===0)return[];if(t===1)return[r];const i=new Array(t);for(let o=0;o<i.length-1;++o)i[o]=Math.floor(r/n[o]),r-=i[o]*n[o];return i[i.length-1]=r,i}function oR(r){return r&&r.then&&typeof r.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H$="tfjsflags";let eY=class{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=nY,this.populateURLFlags()}setPlatform(t,n){this.platform!=null&&(kt().getBool("IS_TEST")||kt().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=n}registerFlag(t,n,i){if(this.flagRegistry[t]={evaluationFn:n,setHook:i},this.urlFlags[t]!=null){const o=this.urlFlags[t];kt().getBool("IS_TEST")||kt().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${o}.`),this.set(t,o)}}async getAsync(t){return t in this.flags?this.flags[t]:(this.flags[t]=await this.evaluateFlag(t),this.flags[t])}get(t){if(t in this.flags)return this.flags[t];const n=this.evaluateFlag(t);if(oR(n))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=n,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,n){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=n,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(n)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const t=this.getQueryParams(this.global.location.search);H$ in t&&t[H$].split(",").forEach(i=>{const[o,a]=i.split(":");this.urlFlags[o]=rY(o,a)})}};function nY(r){const t={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...i)=>(sY(t,i[0],i[1]),i.join("="))),t}function sY(r,t,n){r[decodeURIComponent(t)]=decodeURIComponent(n||"")}function rY(r,t){if(t=t.toLowerCase(),t==="true"||t==="false")return t==="true";if(`${+t}`===t)return+t;throw new Error(`Could not parse value flag value ${t} for flag ${r}.`)}function kt(){return aR}let aR=null;function iY(r){aR=r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Rx;function lR(){if(Rx==null){let r;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");Rx=r}return Rx}function oY(){const r=lR();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function A4(r,t){const n=oY();if(n.has(r))return n.get(r);{const i=t();return n.set(r,i),n.get(r)}}const nv="Abs",$m="Acos",Im="Acosh",df="Add",M4="AddN",D4="All",R4="Any",sv="ArgMax",rv="ArgMin",Em="Asin",Nm="Asinh",Am="Atan",Mm="Atanh",Dm="Atan2",iv="AvgPool",O4="AvgPoolGrad",ov="AvgPool3D",L4="AvgPool3DGrad",av="BatchMatMul",lv="BatchToSpaceND",F4="Bincount",aY="BroadcastTo",cR="BroadcastArgs",Rm="Cast",Om="Ceil",Lm="ClipByValue",P4="Complex",cv="ComplexAbs",uv="Concat",hv="Conv2D",B4="Conv2DBackpropFilter",dv="Conv2DBackpropInput",fv="Conv3D",z4="Conv3DBackpropFilterV2",V4="Conv3DBackpropInputV2",Fm="Cos",Pm="Cosh",U4="Cumprod",pv="Cumsum",W4="CropAndResize",G4="DenseBincount",H4="DepthToSpace",mv="DepthwiseConv2dNative",j4="DepthwiseConv2dNativeBackpropFilter",q4="DepthwiseConv2dNativeBackpropInput",uR="Diag",gv="Dilation2D",L3="Dilation2DBackpropInput",F3="Dilation2DBackpropFilter",Bm="RealDiv",hR="Einsum",zm="Elu",K4="EluGrad",Vm="Erf",vv="Equal",Um="Exp",yv="ExpandDims",Wm="Expm1",X4="FFT",Y4="Fill",Z4="FlipLeftRight",Gm="Floor",Hm="FloorDiv",xv="FusedBatchNorm",bv="GatherV2",dR="GatherNd",wv="Greater",jm="GreaterEqual",qm="Identity",J4="IFFT",Q4="Imag",Km="IsFinite",Xm="IsInf",Ym="IsNan",Sv="LeakyRelu",_v="Less",Tv="LessEqual",fR="LinSpace",Zm="Log",Jm="Log1p",Cv="LogicalAnd",kv="LogicalNot",$v="LogicalOr",lY="LogSoftmax",Iv="LRN",t_="LRNGrad",Ev="Max",Qm="Maximum",Nv="MaxPool",e_="MaxPoolGrad",Av="MaxPool3D",n_="MaxPool3DGrad",pR="MaxPoolWithArgmax",Mv="Mean",Dv="Min",tg="Minimum",Rv="MirrorPad",eg="Mod",mR="Multinomial",ng="Multiply",Ov="Neg",Lv="NotEqual",s_="NonMaxSuppressionV3",r_="NonMaxSuppressionV4",i_="NonMaxSuppressionV5",Fv="OnesLike",Pv="OneHot",Bv="Pack",zv="PadV2",sg="Pow",Vv="Prelu",Uv="Prod",gR="RaggedGather",vR="RaggedRange",yR="RaggedTensorToTensor",o_="Range",a_="Real",rg="Reciprocal",ig="Relu",Wv="Reshape",Gv="ResizeNearestNeighbor",l_="ResizeNearestNeighborGrad",Hv="ResizeBilinear",c_="ResizeBilinearGrad",og="Relu6",jv="Reverse",ag="Round",lg="Rsqrt",xR="ScatterNd",bR="SearchSorted",qv="Select",cg="Selu",Kv="Slice",ug="Sin",hg="Sinh",dg="Sign",fg="Sigmoid",pg="Softplus",mg="Sqrt",Xv="Sum",Yv="SpaceToBatchND",Zv="SplitV",Jv="Softmax",u_="SparseFillEmptyRows",h_="SparseReshape",d_="SparseSegmentMean",f_="SparseSegmentSum",wR="SparseToDense",gg="SquaredDifference",p_="Square",m_="StridedSlice",g_="StringNGrams",v_="StringSplit",y_="StringToHashBucketFast",vg="Sub",yg="Tan",xg="Tanh",bg="Tile",x_="TopK",b_="Transform",wd="Transpose",w_="Unique",Qv="Unpack",ty="UnsortedSegmentSum",ey="ZerosLike",wg="Step",cY="FromPixels",S_="RotateWithOffset",e2="_FusedMatMul",n2="FusedConv2D",SR="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Di(...r){kt().getBool("IS_TEST")||kt().getBool("PROD")||console.warn(...r)}function uY(...r){kt().getBool("IS_TEST")||kt().getBool("PROD")||console.log(...r)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s2=A4("kernelRegistry",()=>new Map),P3=A4("gradRegistry",()=>new Map);function j$(r,t){const n=TR(r,t);return s2.get(n)}function q$(r){return P3.get(r)}function K$(r){const t=s2.entries(),n=[];for(;;){const{done:i,value:o}=t.next();if(i)break;const[a,l]=o,[c]=a.split("_");c===r&&n.push(l)}return n}function _R(r){const{kernelName:t,backendName:n}=r,i=TR(t,n);s2.has(i)&&Di(`The kernel '${t}' for backend '${n}' is already registered`),s2.set(i,r)}function hY(r){const{kernelName:t}=r;P3.has(t)&&kt().getBool("DEBUG")&&Di(`Overriding the gradient for '${t}'`),P3.set(t,r)}function TR(r,t){return`${t}_${r}`}var B3=ss,co=null;try{co=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ss(r,t,n){this.low=r|0,this.high=t|0,this.unsigned=!!n}ss.prototype.__isLong__;Object.defineProperty(ss.prototype,"__isLong__",{value:!0});function _i(r){return(r&&r.__isLong__)===!0}ss.isLong=_i;var X$={},Y$={};function yh(r,t){var n,i,o;return t?(r>>>=0,(o=0<=r&&r<256)&&(i=Y$[r],i)?i:(n=rs(r,(r|0)<0?-1:0,!0),o&&(Y$[r]=n),n)):(r|=0,(o=-128<=r&&r<128)&&(i=X$[r],i)?i:(n=rs(r,r<0?-1:0,!1),o&&(X$[r]=n),n))}ss.fromInt=yh;function uo(r,t){if(isNaN(r))return t?xu:ho;if(t){if(r<0)return xu;if(r>=CR)return IR}else{if(r<=-J$)return fi;if(r+1>=J$)return $R}return r<0?uo(-r,t).neg():rs(r%Od|0,r/Od|0,t)}ss.fromNumber=uo;function rs(r,t,n){return new ss(r,t,n)}ss.fromBits=rs;var r2=Math.pow;function __(r,t,n){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return ho;if(typeof t=="number"?(n=t,t=!1):t=!!t,n=n||10,n<2||36<n)throw RangeError("radix");var i;if((i=r.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return __(r.substring(1),t,n).neg();for(var o=uo(r2(n,8)),a=ho,l=0;l<r.length;l+=8){var c=Math.min(8,r.length-l),u=parseInt(r.substring(l,l+c),n);if(c<8){var h=uo(r2(n,c));a=a.mul(h).add(uo(u))}else a=a.mul(o),a=a.add(uo(u))}return a.unsigned=t,a}ss.fromString=__;function la(r,t){return typeof r=="number"?uo(r,t):typeof r=="string"?__(r,t):rs(r.low,r.high,typeof t=="boolean"?t:r.unsigned)}ss.fromValue=la;var Z$=1<<16,dY=1<<24,Od=Z$*Z$,CR=Od*Od,J$=CR/2,Q$=yh(dY),ho=yh(0);ss.ZERO=ho;var xu=yh(0,!0);ss.UZERO=xu;var md=yh(1);ss.ONE=md;var kR=yh(1,!0);ss.UONE=kR;var z3=yh(-1);ss.NEG_ONE=z3;var $R=rs(-1,2147483647,!1);ss.MAX_VALUE=$R;var IR=rs(-1,-1,!0);ss.MAX_UNSIGNED_VALUE=IR;var fi=rs(0,-2147483648,!1);ss.MIN_VALUE=fi;var ie=ss.prototype;ie.toInt=function(){return this.unsigned?this.low>>>0:this.low};ie.toNumber=function(){return this.unsigned?(this.high>>>0)*Od+(this.low>>>0):this.high*Od+(this.low>>>0)};ie.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(fi)){var n=uo(t),i=this.div(n),o=i.mul(n).sub(this);return i.toString(t)+o.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var a=uo(r2(t,6),this.unsigned),l=this,c="";;){var u=l.div(a),h=l.sub(u.mul(a)).toInt()>>>0,d=h.toString(t);if(l=u,l.isZero())return d+c;for(;d.length<6;)d="0"+d;c=""+d+c}};ie.getHighBits=function(){return this.high};ie.getHighBitsUnsigned=function(){return this.high>>>0};ie.getLowBits=function(){return this.low};ie.getLowBitsUnsigned=function(){return this.low>>>0};ie.getNumBitsAbs=function(){if(this.isNegative())return this.eq(fi)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,n=31;n>0&&!(t&1<<n);n--);return this.high!=0?n+33:n+1};ie.isZero=function(){return this.high===0&&this.low===0};ie.eqz=ie.isZero;ie.isNegative=function(){return!this.unsigned&&this.high<0};ie.isPositive=function(){return this.unsigned||this.high>=0};ie.isOdd=function(){return(this.low&1)===1};ie.isEven=function(){return(this.low&1)===0};ie.equals=function(t){return _i(t)||(t=la(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};ie.eq=ie.equals;ie.notEquals=function(t){return!this.eq(t)};ie.neq=ie.notEquals;ie.ne=ie.notEquals;ie.lessThan=function(t){return this.comp(t)<0};ie.lt=ie.lessThan;ie.lessThanOrEqual=function(t){return this.comp(t)<=0};ie.lte=ie.lessThanOrEqual;ie.le=ie.lessThanOrEqual;ie.greaterThan=function(t){return this.comp(t)>0};ie.gt=ie.greaterThan;ie.greaterThanOrEqual=function(t){return this.comp(t)>=0};ie.gte=ie.greaterThanOrEqual;ie.ge=ie.greaterThanOrEqual;ie.compare=function(t){if(_i(t)||(t=la(t)),this.eq(t))return 0;var n=this.isNegative(),i=t.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};ie.comp=ie.compare;ie.negate=function(){return!this.unsigned&&this.eq(fi)?fi:this.not().add(md)};ie.neg=ie.negate;ie.add=function(t){_i(t)||(t=la(t));var n=this.high>>>16,i=this.high&65535,o=this.low>>>16,a=this.low&65535,l=t.high>>>16,c=t.high&65535,u=t.low>>>16,h=t.low&65535,d=0,f=0,p=0,m=0;return m+=a+h,p+=m>>>16,m&=65535,p+=o+u,f+=p>>>16,p&=65535,f+=i+c,d+=f>>>16,f&=65535,d+=n+l,d&=65535,rs(p<<16|m,d<<16|f,this.unsigned)};ie.subtract=function(t){return _i(t)||(t=la(t)),this.add(t.neg())};ie.sub=ie.subtract;ie.multiply=function(t){if(this.isZero())return ho;if(_i(t)||(t=la(t)),co){var n=co.mul(this.low,this.high,t.low,t.high);return rs(n,co.get_high(),this.unsigned)}if(t.isZero())return ho;if(this.eq(fi))return t.isOdd()?fi:ho;if(t.eq(fi))return this.isOdd()?fi:ho;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Q$)&&t.lt(Q$))return uo(this.toNumber()*t.toNumber(),this.unsigned);var i=this.high>>>16,o=this.high&65535,a=this.low>>>16,l=this.low&65535,c=t.high>>>16,u=t.high&65535,h=t.low>>>16,d=t.low&65535,f=0,p=0,m=0,g=0;return g+=l*d,m+=g>>>16,g&=65535,m+=a*d,p+=m>>>16,m&=65535,m+=l*h,p+=m>>>16,m&=65535,p+=o*d,f+=p>>>16,p&=65535,p+=a*h,f+=p>>>16,p&=65535,p+=l*u,f+=p>>>16,p&=65535,f+=i*d+o*h+a*u+l*c,f&=65535,rs(m<<16|g,f<<16|p,this.unsigned)};ie.mul=ie.multiply;ie.divide=function(t){if(_i(t)||(t=la(t)),t.isZero())throw Error("division by zero");if(co){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var n=(this.unsigned?co.div_u:co.div_s)(this.low,this.high,t.low,t.high);return rs(n,co.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?xu:ho;var i,o,a;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return xu;if(t.gt(this.shru(1)))return kR;a=xu}else{if(this.eq(fi)){if(t.eq(md)||t.eq(z3))return fi;if(t.eq(fi))return md;var l=this.shr(1);return i=l.div(t).shl(1),i.eq(ho)?t.isNegative()?md:z3:(o=this.sub(t.mul(i)),a=i.add(o.div(t)),a)}else if(t.eq(fi))return this.unsigned?xu:ho;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();a=ho}for(o=this;o.gte(t);){i=Math.max(1,Math.floor(o.toNumber()/t.toNumber()));for(var c=Math.ceil(Math.log(i)/Math.LN2),u=c<=48?1:r2(2,c-48),h=uo(i),d=h.mul(t);d.isNegative()||d.gt(o);)i-=u,h=uo(i,this.unsigned),d=h.mul(t);h.isZero()&&(h=md),a=a.add(h),o=o.sub(d)}return a};ie.div=ie.divide;ie.modulo=function(t){if(_i(t)||(t=la(t)),co){var n=(this.unsigned?co.rem_u:co.rem_s)(this.low,this.high,t.low,t.high);return rs(n,co.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};ie.mod=ie.modulo;ie.rem=ie.modulo;ie.not=function(){return rs(~this.low,~this.high,this.unsigned)};ie.and=function(t){return _i(t)||(t=la(t)),rs(this.low&t.low,this.high&t.high,this.unsigned)};ie.or=function(t){return _i(t)||(t=la(t)),rs(this.low|t.low,this.high|t.high,this.unsigned)};ie.xor=function(t){return _i(t)||(t=la(t)),rs(this.low^t.low,this.high^t.high,this.unsigned)};ie.shiftLeft=function(t){return _i(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?rs(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):rs(0,this.low<<t-32,this.unsigned)};ie.shl=ie.shiftLeft;ie.shiftRight=function(t){return _i(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?rs(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):rs(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};ie.shr=ie.shiftRight;ie.shiftRightUnsigned=function(t){if(_i(t)&&(t=t.toInt()),t&=63,t===0)return this;var n=this.high;if(t<32){var i=this.low;return rs(i>>>t|n<<32-t,n>>>t,this.unsigned)}else return t===32?rs(n,0,this.unsigned):rs(n>>>t-32,0,this.unsigned)};ie.shru=ie.shiftRightUnsigned;ie.shr_u=ie.shiftRightUnsigned;ie.toSigned=function(){return this.unsigned?rs(this.low,this.high,!1):this};ie.toUnsigned=function(){return this.unsigned?this:rs(this.low,this.high,!0)};ie.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};ie.toBytesLE=function(){var t=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};ie.toBytesBE=function(){var t=this.high,n=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};ss.fromBytes=function(t,n,i){return i?ss.fromBytesLE(t,n):ss.fromBytesBE(t,n)};ss.fromBytesLE=function(t,n){return new ss(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,n)};ss.fromBytesBE=function(t,n){return new ss(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],n)};const fY=BB({__proto__:null,default:B3},[B3]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pu=B3||fY;function ny(r){return pu.fromString(r,!0,16)}const ER=ny("c3a5c85c97cb3127"),hu=ny("b492b66fbe98f273"),Ar=ny("9ae16a3b2f90404f");function V3(r){return r.xor(r.shru(47))}function NR(r,t,n){const i=r.slice(t,t+n);return pu.fromBytes(Array.from(i),!0,!0)}function Wn(r,t){return NR(r,t,8)}function tI(r,t){return NR(r,t,4)}function Gs(r,t){return t===0?r:r.shru(t).or(r.shl(64-t))}function uc(r,t,n=ny("9ddfea08eb382d69")){let i=r.xor(t).mul(n);i=i.xor(i.shru(47));let o=t.xor(i).mul(n);return o=o.xor(o.shru(47)),o=o.mul(n),o}function pY(r,t,n,i,o,a){o=o.add(r),a=Gs(a.add(o).add(i),21);const l=o;return o=o.add(t),o=o.add(n),a=a.add(Gs(o,44)),[o.add(i),a.add(l)]}function D0(r,t,n,i){return pY(Wn(r,t),Wn(r,t+8),Wn(r,t+16),Wn(r,t+24),n,i)}function mY(r,t=r.length){if(t>=8){const n=Ar.add(t*2),i=Wn(r,0).add(Ar),o=Wn(r,t-8),a=Gs(o,37).mul(n).add(i),l=Gs(i,25).add(o).mul(n);return uc(a,l,n)}if(t>=4){const n=Ar.add(t*2),i=tI(r,0);return uc(i.shl(3).add(t),tI(r,t-4),n)}if(t>0){const n=r[0],i=r[t>>1],o=r[t-1],a=n+(i<<8),l=t+(o<<2);return V3(Ar.mul(a).xor(ER.mul(l))).mul(Ar)}return Ar}function gY(r,t=r.length){const n=Ar.add(t*2),i=Wn(r,0).mul(hu),o=Wn(r,8),a=Wn(r,t-8).mul(n),l=Wn(r,t-16).mul(Ar);return uc(Gs(i.add(o),43).add(Gs(a,30)).add(l),i.add(Gs(o.add(Ar),18)).add(a),n)}function vY(r,t=r.length){const n=Ar.add(t*2),i=Wn(r,0).mul(Ar),o=Wn(r,8),a=Wn(r,t-8).mul(n),l=Wn(r,t-16).mul(Ar),c=Gs(i.add(o),43).add(Gs(a,30)).add(l),u=uc(c,i.add(Gs(o.add(Ar),18)).add(a),n),h=Wn(r,16).mul(n),d=Wn(r,24),f=c.add(Wn(r,t-32)).mul(n),p=u.add(Wn(r,t-24)).mul(n);return uc(Gs(h.add(d),43).add(Gs(f,30)).add(p),h.add(Gs(d.add(i),18)).add(f),n)}function yY(r,t=r.length){const n=pu.fromNumber(81,!0);if(t<=32)return t<=16?mY(r,t):gY(r,t);if(t<=64)return vY(r,t);let i=n,o=n.mul(hu).add(113),a=V3(o.mul(Ar).add(113)).mul(Ar),l=[pu.UZERO,pu.UZERO],c=[pu.UZERO,pu.UZERO];i=i.mul(Ar).add(Wn(r,0));let u=0;const h=(t-1>>6)*64,d=h+(t-1&63)-63;do i=Gs(i.add(o).add(l[0]).add(Wn(r,u+8)),37).mul(hu),o=Gs(o.add(l[1]).add(Wn(r,u+48)),42).mul(hu),i=i.xor(c[1]),o=o.add(l[0]).add(Wn(r,u+40)),a=Gs(a.add(c[0]),33).mul(hu),l=D0(r,u,l[1].mul(hu),i.add(c[0])),c=D0(r,u+32,a.add(c[1]),o.add(Wn(r,u+16))),[a,i]=[i,a],u+=64;while(u!==h);const f=hu.add(a.and(255).shl(1));return u=d,c[0]=c[0].add(t-1&63),l[0]=l[0].add(c[0]),c[0]=c[0].add(l[0]),i=Gs(i.add(o).add(l[0]).add(Wn(r,u+8)),37).mul(f),o=Gs(o.add(l[1]).add(Wn(r,u+48)),42).mul(f),i=i.xor(c[1].mul(9)),o=o.add(l[0].mul(9).add(Wn(r,u+40))),a=Gs(a.add(c[0]),33).mul(f),l=D0(r,u,l[1].mul(f),i.add(c[0])),c=D0(r,u+32,a.add(c[1]),o.add(Wn(r,u+16))),[a,i]=[i,a],uc(uc(l[0],c[0],f).add(V3(o).mul(ER)).add(a),uc(l[1],c[1],f).add(i),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fc(r,t){return t==="string"?hc(r):xh([r],t)}function xY(r,t){return r instanceof Float32Array&&t==="float32"||r instanceof Int32Array&&t==="int32"||r instanceof Uint8Array&&t==="bool"}function xh(r,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Dd(r)),kt().getBool("DEBUG")&&ZX(r,t),xY(r,t))return r;if(t==null||t==="float32"||t==="complex64")return new Float32Array(r);if(t==="int32")return new Int32Array(r);if(t==="bool"){const n=new Uint8Array(r.length);for(let i=0;i<n.length;++i)Math.round(r[i])!==0&&(n[i]=1);return n}else throw new Error(`Unknown data type ${t}`)}function Kr(){return kt().platform.now()}function hc(r,t="utf-8"){return t=t||"utf-8",kt().platform.encode(r,t)}function Sc(r,t="utf-8"){return t=t||"utf-8",kt().platform.decode(r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let bY=class{constructor(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new SY)}profileKernel(t,n,i){let o;const a=()=>{o=i()};let l;const c=Kr();if(this.backendTimer.timerAvailable())l=this.backendTimer.time(a);else{a();for(const h of o)h.dataSync();l=Promise.resolve({kernelMs:Kr()-c})}if(kt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let h=0;h<o.length;h++){const d=o[h];d.data().then(f=>{wY(f,d.dtype,t)})}return{kernelName:t,outputs:o,inputs:n,timeMs:l.then(h=>h.kernelMs),extraInfo:l.then(h=>h.getExtraProfileInfo!=null?h.getExtraProfileInfo():"")}}logKernelProfile(t){const{kernelName:n,outputs:i,timeMs:o,inputs:a,extraInfo:l}=t;i.forEach(c=>{Promise.all([c.data(),o,l]).then(u=>{this.logger.logKernelProfile(n,c,u[0],u[1],a,u[2])})})}};function wY(r,t,n){if(t!=="float32")return!1;for(let i=0;i<r.length;i++){const o=r[i];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${n}'`),!0}return!1}let SY=class{logKernelProfile(t,n,i,o,a,l){const c=typeof o=="number"?bd(`${o}ms`,9):o.error,u=bd(t,25),h=n.rank,d=n.size,f=bd(n.shape.toString(),14);let p="";for(const m in a){const g=a[m];if(g!=null){const y=g.shape||n.shape,v=y.length;p+=`${m}: ${v}D ${v>0?y:""} `}}console.log(`%c${u}	%c${c}	%c${h}D ${f}	%c${d}	%c${p}	%c${l}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Y(r,t,n){const i={},o={};for(let u=0;u<t.length;u++)i[t[u].id]=!0;for(let u=0;u<r.length;u++){const h=r[u],d=h.inputs;for(const f in d){const p=d[f];let m=!1;for(let g=0;g<t.length;g++)if(i[p.id]){h.outputs.forEach(y=>i[y.id]=!0),m=!0,o[h.id]=!0;break}if(m)break}}const a={};a[n.id]=!0;const l={};for(let u=r.length-1;u>=0;u--){const h=r[u],d=h.inputs;for(let f=0;f<h.outputs.length;f++)if(a[h.outputs[f].id]){for(const p in d)a[d[p].id]=!0,l[h.id]=!0;break}}const c=[];for(let u=0;u<r.length;u++){const h=r[u];if(o[h.id]&&l[h.id]){const d={};for(const p in h.inputs){const m=h.inputs[p];i[m.id]&&(d[p]=m)}const f=Object.assign({},h);f.inputs=d,f.outputs=h.outputs,c.push(f)}}return c}function TY(r,t,n,i){for(let o=t.length-1;o>=0;o--){const a=t[o],l=[];if(a.outputs.forEach(u=>{const h=r[u.id];h!=null?l.push(h):l.push(null)}),a.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${a.kernelName}.`);const c=a.gradient(l);for(const u in a.inputs){if(!(u in c))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(c)}.`);const h=n(()=>c[u]());if(h.dtype!=="float32")throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${h.dtype}'`);const d=a.inputs[u];if(!An(h.shape,d.shape))throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input '${u}' has shape '${h.shape}', which does not match the shape of the input '${d.shape}'`);if(r[d.id]==null)r[d.id]=h;else{const f=r[d.id];r[d.id]=i(f,h),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eI=20,tp=3,Ox=7;function CY(r,t,n,i){const o=Ie(t),a=kY(r,t,n,o),l=t.length,c=_1(r,t,n,o,a),u=["Tensor"];return i&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${l}`),u.push(`  shape: [${t}]`),u.push("  values:")),u.push(c.map(h=>"    "+h).join(`
`)),u.join(`
`)}function kY(r,t,n,i){const o=Nt(t),a=i[i.length-1],l=new Array(a).fill(0),c=t.length,u=n==="complex64"?xp(r):r;if(c>1)for(let h=0;h<o/a;h++){const d=h*a;for(let f=0;f<a;f++)l[f]=Math.max(l[f],yp(u[d+f],0,n).length)}return l}function yp(r,t,n){let i;return Array.isArray(r)?i=`${parseFloat(r[0].toFixed(Ox))} + ${parseFloat(r[1].toFixed(Ox))}j`:Cm(r)?i=`'${r}'`:n==="bool"?i=AR(r):i=parseFloat(r.toFixed(Ox)).toString(),bd(i,t)}function AR(r){return r===0?"false":"true"}function _1(r,t,n,i,o,a=!0){const l=n==="complex64"?2:1,c=t[0],u=t.length;if(u===0){if(n==="complex64"){const y=xp(r);return[yp(y[0],0,n)]}return n==="bool"?[AR(r[0])]:[r[0].toString()]}if(u===1){if(c>eI){const v=tp*l;let x=Array.from(r.slice(0,v)),b=Array.from(r.slice((c-tp)*l,c*l));return n==="complex64"&&(x=xp(x),b=xp(b)),["["+x.map((w,S)=>yp(w,o[S],n)).join(", ")+", ..., "+b.map((w,S)=>yp(w,o[c-tp+S],n)).join(", ")+"]"]}return["["+(n==="complex64"?xp(r):Array.from(r)).map((v,x)=>yp(v,o[x],n)).join(", ")+"]"]}const h=t.slice(1),d=i.slice(1),f=i[0]*l,p=[];if(c>eI){for(let y=0;y<tp;y++){const v=y*f,x=v+f;p.push(..._1(r.slice(v,x),h,n,d,o,!1))}p.push("...");for(let y=c-tp;y<c;y++){const v=y*f,x=v+f;p.push(..._1(r.slice(v,x),h,n,d,o,y===c-1))}}else for(let y=0;y<c;y++){const v=y*f,x=v+f;p.push(..._1(r.slice(v,x),h,n,d,o,y===c-1))}const m=u===2?",":"";p[0]="["+p[0]+m;for(let y=1;y<p.length-1;y++)p[y]=" "+p[y]+m;let g=`,
`;for(let y=2;y<u;y++)g+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(a?"":g),p}function xp(r){const t=[];for(let n=0;n<r.length;n+=2)t.push([r[n],r[n+1]]);return t}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let xr=class{constructor(t,n,i){if(this.dtype=n,this.shape=t.slice(),this.size=Nt(t),i!=null){const o=i.length;W(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=i||ks(n,this.size),this.strides=Ie(t)}set(t,...n){n.length===0&&(n=[0]),W(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const i=this.locToIndex(n);this.values[i]=t}get(...t){t.length===0&&(t=[0]);let n=0;for(const o of t){if(o<0||o>=this.shape[n]){const a=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(a)}n++}let i=t[t.length-1];for(let o=0;o<t.length-1;++o)i+=this.strides[o]*t[o];return this.values[i]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let n=t[t.length-1];for(let i=0;i<t.length-1;++i)n+=this.strides[i]*t[i];return n}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];const n=new Array(this.shape.length);for(let i=0;i<n.length-1;++i)n[i]=Math.floor(t/this.strides[i]),t-=n[i]*this.strides[i];return n[n.length-1]=t,n}get rank(){return this.shape.length}toTensor(){return Po().makeTensor(this.values,this.shape,this.dtype)}},Po=null,od=null;function $Y(r){Po=r}function IY(r){od=r}let Cs=class{constructor(t,n,i,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=Nt(t),this.strides=Ie(t),this.dataId=i,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return od.buffer(this.shape,this.dtype,t)}bufferSync(){return od.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return qo(this.shape,t,this.dtype==="complex64")}arraySync(){return qo(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const t=Po().read(this.dataId);if(this.dtype==="string"){const n=await t;try{return n.map(i=>Sc(i))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),Po().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=Po().readSync(this.dataId);if(this.dtype==="string")try{return t.map(n=>Sc(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await Po().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(Po().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return od.print(this,t)}clone(){return this.throwIfDisposed(),od.clone(this)}toString(t=!1){const n=this.dataSync();return CY(n,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),od.cast(this,t)}variable(t=!0,n,i){return this.throwIfDisposed(),Po().makeVariable(this,t,n,i)}};Object.defineProperty(Cs,Symbol.hasInstance,{value:r=>!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null});function It(){return A4("Tensor",()=>Cs)}It();let i2=class extends Cs{constructor(t,n,i,o){super(t.shape,t.dtype,t.dataId,o),this.trainable=n,this.name=i}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!An(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);Po().disposeTensor(this),this.dataId=t.dataId,Po().incRef(this,null)}dispose(){Po().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(i2,Symbol.hasInstance,{value:r=>r instanceof Cs&&r.assign!=null&&r.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var nI;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(nI||(nI={}));var U3;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(U3||(U3={}));var W3;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(W3||(W3={}));var G3;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(G3||(G3={}));var H3;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(H3||(H3={}));const EY={float32:G3,int32:U3,bool:W3,complex64:H3};function gi(r,t){if(r==="string"||t==="string"){if(r==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${r} with ${t}`)}return EY[r][t]}function T_(r){return gi(r,"int32")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ws(r,t){if(r.dtype===t.dtype)return[r,t];const n=gi(r.dtype,t.dtype);return[r.cast(n),t.cast(n)]}function MR(r){const t=[];return DR(r,t,new Set),t}function DR(r,t,n){if(r==null)return;if(r instanceof Cs){t.push(r);return}if(!NY(r))return;const i=r;for(const o in i){const a=i[o];n.has(a)||(n.add(a),DR(a,t,n))}}function NY(r){return Array.isArray(r)||typeof r=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lx(r){return r.kernelName!=null}let sI=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}},Kp=class{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new sI}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const t=this.getSortedBackends();for(let n=0;n<t.length;n++){const i=t[n];if(await this.initializeBackend(i).success){await this.setBackend(i);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:t,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){const{asyncInit:n}=this.initializeBackend(t);if(n)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,n,i=1){return t in this.registryFactory?(Di(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:n,priority:i},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;const{success:n,asyncInit:i}=this.initializeBackend(t);if(!(i?await n:n))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new bY(this.backendInstance),!0}setupRegisteredKernels(){K$(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){K$(t).forEach(i=>{i.disposeFunc!=null&&i.disposeFunc(this.registry[t])})}initializeBackend(t){const n=this.registryFactory[t];if(n==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const i=n.factory();if(i&&!(i instanceof I4)&&typeof i.then=="function"){const o=++this.pendingBackendInitId,a=i.then(l=>o<this.pendingBackendInitId?!1:(this.registry[t]=l,this.pendingBackendInit=null,!0)).catch(l=>(o<this.pendingBackendInitId||(this.pendingBackendInit=null,Di(`Initialization of backend ${t} failed`),Di(l.stack||l.message)),!1));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}else return this.registry[t]=i,{success:!0,asyncInit:!1}}catch(i){return Di(`Initialization of backend ${t} failed`),Di(i.stack||i.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,n)=>this.registryFactory[n].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let n=0;n<t.length;n++){const i=t[n],{success:o,asyncInit:a}=this.initializeBackend(i);if(a||o)return{name:i,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,n){const i=this.state.tensorInfo.get(n),o=i.backend,a=this.readSync(n),l=o.refCount(n);o.disposeData(n,!0),i.backend=t,t.move(n,a,i.shape,i.dtype,l),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,n){let i=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}let o;return this.scopedRun(()=>this.startScope(i),()=>this.endScope(o),()=>(o=n(),o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),o))}scopedRun(t,n,i){t();try{const o=i();return n(),o}catch(o){throw n(),o}}nextTensorId(){return Kp.nextTensorId++}nextVariableId(){return Kp.nextVariableId++}clone(t){const n=ft.runKernel(qm,{x:t}),i={x:t},o=l=>({x:()=>{const c="float32",u={x:l},h={dtype:c};return ft.runKernel(Rm,u,h)}}),a=[];return this.addTapeNode(this.state.activeScope.name,i,[n],o,a,{}),n}runKernel(t,n,i){if(this.backendName==null&&this.backend,!(j$(t,this.backendName)!=null))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:n,attrs:i})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,n,i){const o=this.backend.numDataIds();let a=0;i.forEach(u=>{a+=u.dtype==="complex64"?3:1});const l=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],c=o-n-a-l;if(c>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${c} data ids) after running '${t}'`)}runKernelFunc(t){let n,i=[];const o=this.isTapeOn(),a=this.state.numBytes,l=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let c;this.backendName==null&&this.backend;let u;const h=Lx(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Lx(t)){const{kernelName:g,inputs:y,attrs:v}=t;this.backendName==null&&this.backend;const x=j$(g,this.backendName);W(x!=null,()=>`Cannot find registered kernel '${g}' for backend '${this.backendName}'`),c=()=>{const b=this.backend.numDataIds();u=x.kernelFunc({inputs:y,attrs:v,backend:this.backend});const w=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(g,b,w);const S=w.map(_=>_.rank!=null?_:this.makeTensorFromTensorInfo(_));if(o){const _=this.getTensorsForGradient(g,y,S);i=this.saveTensorsForBackwardMode(_)}return S}}else{const{forwardFunc:g}=t,y=v=>{o&&(i=v.map(x=>this.keep(this.clone(x))))};c=()=>{const v=this.backend.numDataIds();u=this.tidy(()=>g(this.backend,y));const x=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(h,v,x),x}}const{inputs:d,attrs:f}=t,p=Lx(t)?null:t.backwardsFunc;let m;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=c():(m=this.profiler.profileKernel(h,d,()=>c()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),n=m.outputs)}),o&&this.addTapeNode(h,d,n,p,i,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:h,bytesAdded:this.state.numBytes-a,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-l,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(g=>d[g]!=null?d[g].shape:null),outputShapes:n.map(g=>g.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(u)?n:n[0]}saveTensorsForBackwardMode(t){return t.map(i=>this.keep(this.clone(i)))}getTensorsForGradient(t,n,i){const o=q$(t);if(o!=null){const a=o.inputsToSave||[],l=o.outputsToSave||[];let c;o.saveAllInputs?(W(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),c=Object.keys(n).map(h=>n[h])):c=a.map(h=>n[h]);const u=i.filter((h,d)=>l[d]);return c.concat(u)}return[]}makeTensor(t,n,i,o){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");i=i||"float32",o=o||this.backend;let a=t;i==="string"&&Cm(t[0])&&(a=t.map(u=>hc(u)));const l=o.write(a,n,i),c=new Cs(n,i,l,this.nextTensorId());if(this.trackTensor(c,o),i==="string"){const u=this.state.tensorInfo.get(l),h=QX(a);this.state.numBytes+=h-u.bytes,u.bytes=h}return c}makeTensorFromDataId(t,n,i,o){i=i||"float32";const a={dataId:t,shape:n,dtype:i};return this.makeTensorFromTensorInfo(a,o)}makeTensorFromTensorInfo(t,n){const{dataId:i,shape:o,dtype:a}=t,l=new Cs(o,a,i,this.nextTensorId());return this.trackTensor(l,n),l}makeVariable(t,n=!0,i,o){i=i||this.nextVariableId().toString(),o!=null&&o!==t.dtype&&(t=t.cast(o));const a=new i2(t,n,i,this.nextTensorId());if(this.state.registeredVariables[a.name]!=null)throw new Error(`Variable with name ${a.name} was already registered`);return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}trackTensor(t,n){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let i=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(i=t.size*M3(t.dtype)),this.state.numBytes+=i,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:i})),t instanceof i2||this.track(t)}incRef(t,n){this.trackTensor(t,n),this.backend.incRef(t.dataId)}removeDataId(t,n){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===n&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const n=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){const i=t.size*M3(t.dtype);this.state.numBytes-=i}n.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,n.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const n=this.state.registeredVariables[t];this.disposeVariable(n)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const n=this.state.numBytes,i=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(o=>o.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-i;for(const o of this.state.activeProfile.kernels)o.kernelTimeMs=await o.kernelTimeMs,o.extraInfo=await o.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,n,i,o,a,l){const c={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:i,saved:a},u=q$(t);u!=null&&(o=u.gradFunc),o!=null&&(c.gradient=h=>(h=h.map((d,f)=>{if(d==null){const p=i[f],m=Sr(p.size,p.dtype);return this.makeTensor(m,p.shape,p.dtype)}return d}),o(h.length>1?h:h[0],a,l))),this.state.activeTape.push(c)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(t){const n=MR(t),i=new Set(n.map(a=>a.id));for(let a=0;a<this.state.activeScope.track.length;a++){const l=this.state.activeScope.track[a];!l.kept&&!i.has(l.id)&&l.dispose()}const o=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(a=>{!a.kept&&a.scopeId===o.id&&this.track(a)})}gradients(t,n,i,o=!1){if(W(n.length>0,()=>"gradients() received an empty list of xs."),i!=null&&i.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${i.dtype}'`);const a=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));W(a instanceof Cs,()=>"The result y returned by f() must be a tensor.");const l=_Y(this.state.activeTape,n,a);if(!o&&l.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const c={};c[a.id]=i??AY(a.shape),TY(c,l,h=>this.tidy(h),MY);const u=n.map(h=>c[h.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(h=>{for(const d of h.saved)d.dispose()}),this.state.activeTape=null),{value:a,grads:u}})}customGrad(t){return W(R3(t),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{W(n.every(c=>c instanceof Cs),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let i;const o={};n.forEach((c,u)=>{o[u]=c});const a=(c,u)=>(i=t(...n,u),W(i.value instanceof Cs,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),W(R3(i.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),i.value),l=(c,u)=>{const h=i.gradFunc(c,u),d=Array.isArray(h)?h:[h];W(d.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),W(d.every(p=>p instanceof Cs),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return d.forEach((p,m)=>{f[m]=()=>p}),f};return this.runKernelFunc({forwardFunc:a,backwardsFunc:l,inputs:o})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,n){return this.state.tensorInfo.get(t).backend.readToGPU(t,n)}async time(t){const n=Kr(),i=await this.backend.time(t);return i.wallMs=Kr()-n,i}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new sI;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};Kp.nextTensorId=0;Kp.nextVariableId=0;function AY(r){const t=N4(Nt(r),"float32");return ft.makeTensor(t,r,"float32")}function RR(){const r=lR();if(r._tfengine==null){const t=new eY(r);r._tfengine=new Kp(t)}return iY(r._tfengine.ENV),$Y(()=>r._tfengine),r._tfengine}const ft=RR();function MY(r,t){const n={a:r,b:t};return ft.runKernel(df,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DY(){return typeof navigator<"u"&&navigator!=null}function OR(r){if(r||DY()){if(r||(r=navigator),r.product==="ReactNative")return!0;const t=r.userAgent||r.vendor||(typeof window<"u"?window.opera:"");if(!t){const n=r;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function LR(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bi=kt();Bi.registerFlag("DEBUG",()=>!1,r=>{r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Bi.registerFlag("IS_BROWSER",()=>LR());Bi.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Bi.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Bi.registerFlag("PROD",()=>!1);Bi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Bi.getBool("DEBUG"));Bi.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Bi.registerFlag("IS_TEST",()=>!1);Bi.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);Bi.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Bi.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Bi.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sy(r,t){let n=r;if(Fa(r))return t==="string"?[]:[r.length];if(typeof r=="object"&&"texture"in r){const o=r.channels||"RGBA";return[r.height,r.width*o.length]}if(!Array.isArray(r))return[];const i=[];for(;Array.isArray(n)||Fa(n)&&t!=="string";)i.push(n.length),n=n[0];return Array.isArray(r)&&kt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&FR(r,i,[]),i}function FR(r,t,n){if(n=n||[],!Array.isArray(r)&&!Fa(r)){W(t.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}W(t.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${r.length} elements`),W(r.length===t[0],()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${r.length} elements`);const i=t.slice(1);for(let o=0;o<r.length;++o)FR(r[o],i,n.concat(o))}function rI(r,t,n,i){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==t||r==="numeric"&&t==="string")throw new Error(`Argument '${n}' passed to '${i}' must be ${r} tensor, but got ${t} tensor`)}}function K(r,t,n,i="numeric"){if(r instanceof Cs)return rI(i,r.dtype,t,n),r;let o=km(r);if(o!=="string"&&["bool","int32","float32"].indexOf(i)>=0&&(o=i),rI(i,o,t,n),r==null||!Fa(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){const u=r==null?"null":r.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${u}'`)}const a=sy(r,o);!Fa(r)&&!Array.isArray(r)&&(r=[r]);const c=o!=="string"?xh(r,o):Dd(r,[],!0);return ft.makeTensor(c,a,o)}function PR(r,t,n,i="numeric"){if(!Array.isArray(r))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return r.map((a,l)=>K(a,`${t}[${l}]`,n,i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RY="__op";function pt(r){const t=Object.keys(r);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0];const i=r[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+RY;const o=(...a)=>{ft.startScope(n);try{const l=i(...a);return oR(l)&&console.error("Cannot return a Promise inside of tidy."),ft.endScope(l),l}catch(l){throw ft.endScope(null),l}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OY(r,t){const n=K(r,"real","complex"),i=K(t,"imag","complex");Co(n.shape,i.shape,`real and imag shapes, ${n.shape} and ${i.shape}, must match in call to tf.complex().`);const o={real:n,imag:i};return ft.runKernel(P4,o)}const Ld=pt({complex_:OY});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ry(r,t,n,i){if(i==null&&(i=km(r)),i==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(typeof r=="object"&&"texture"in r){if(i!=="float32"&&i!=="int32")throw new Error(`Creating tensor from texture only supports 'float32'|'int32' dtype, while the dtype is ${i}.`);return r.channels=r.channels||"RGBA",ft.backend.createTensorFromTexture(r,t||n,i)}if(!Fa(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){El(t);const o=Nt(t),a=Nt(n);W(o===a,()=>`Based on the provided shape, [${t}], the tensor should have ${o} values but has ${a}`);for(let l=0;l<n.length;++l){const c=n[l],u=l===n.length-1?c!==Nt(t.slice(l)):!0;W(n[l]===t[l]||!u,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `)}}return!Fa(r)&&!Array.isArray(r)&&(r=[r]),t=t||n,r=i!=="string"?xh(r,i):Dd(r,[],!0),ft.makeTensor(r,t,i)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BR(r,t,n){const i=sy(r,n);return ry(r,t,i,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iI=4;async function oI(r,t){const n=[],i=[],o=Array.isArray(r)?r.map(l=>l.name):Object.keys(r);for(let l=0;l<o.length;++l){const c=o[l],u=Array.isArray(r)?r[l].tensor:r[c];if(u.dtype!=="float32"&&u.dtype!=="int32"&&u.dtype!=="bool"&&u.dtype!=="string"&&u.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${c}': ${u.dtype}`);const h={name:c,shape:u.shape,dtype:u.dtype};if(u.dtype==="string"){const d=new Promise(async f=>{const p=await u.bytes(),m=p.reduce((v,x)=>v+x.length,0)+iI*p.length,g=new Uint8Array(m);let y=0;for(let v=0;v<p.length;v++){const x=p[v],b=new Uint8Array(new Uint32Array([x.length]).buffer);g.set(b,y),y+=iI,g.set(x,y),y+=x.length}f(g)});i.push(d)}else i.push(u.data());t!=null&&(h.group=t),n.push(h)}const a=await Promise.all(i);return{data:LY(a),specs:n}}function LY(r){if(r===null)throw new Error(`Invalid input value: ${JSON.stringify(r)}`);let t=0;const n=[];r.forEach(a=>{if(t+=a.byteLength,n.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${a.constructor.name}`)});const i=new Uint8Array(t);let o=0;return n.forEach(a=>{i.set(new Uint8Array(a.buffer),o),o+=a.byteLength}),i.buffer}const C_=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function aI(r){return C_?Buffer.byteLength(r):new Blob([r]).size}function FY(r){if(C_)return Buffer.from(r).toString("base64");const t=new Uint8Array(r);let n="";for(let i=0,o=t.length;i<o;i++)n+=String.fromCharCode(t[i]);return btoa(n)}function PY(r){if(C_){const i=Buffer.from(r,"base64");return i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength)}const t=atob(r),n=new Uint8Array(t.length);for(let i=0;i<t.length;++i)n.set([t.charCodeAt(i)],i);return n.buffer}function zR(r){if(r.length===1)return r[0];let t=0;r.forEach(o=>{t+=o.byteLength});const n=new Uint8Array(t);let i=0;return r.forEach(o=>{n.set(new Uint8Array(o),i),i+=o.byteLength}),n.buffer}function VR(r,t){const n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:t};return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(n.initializerSignature=r.initializerSignature),r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),n}function BY(r,t,n){const i={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(i.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");i.weightSpecs=t,i.weightData=n}return r.signature!=null&&(i.signature=r.signature),r.userDefinedMetadata!=null&&(i.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(i.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(i.initializerSignature=r.initializerSignature),i}async function zY(r,t){let n,i;return r.weightsManifest!=null&&([n,i]=await t(r.weightsManifest)),BY(r,n,i)}function iy(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:aI(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:aI(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}function VY(r){const t=[];for(const n of r)t.push(...n.weights);return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let sr=class{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return sr.instance==null&&(sr.instance=new sr),sr.instance}static registerSaveRouter(t){sr.getInstance().saveRouters.push(t)}static registerLoadRouter(t){sr.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return sr.getHandlers(t,"save")}static getLoadHandlers(t,n){return sr.getHandlers(t,"load",n)}static getHandlers(t,n,i){const o=[];return(n==="load"?sr.getInstance().loadRouters:sr.getInstance().saveRouters).forEach(l=>{const c=l(t,i);c!==null&&o.push(c)}),o}};const UY=r=>sr.getSaveHandlers(r);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j3="tensorflowjs",q3=1,bu="models_store",nc="model_info_store";function UR(){if(!kt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const r=typeof window>"u"?self:window,t=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function K3(r){const t=r.result;t.createObjectStore(bu,{keyPath:"modelPath"}),t.createObjectStore(nc,{keyPath:"modelPath"})}let Hu=class{constructor(t){if(this.indexedDB=UR(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,n){return new Promise((i,o)=>{const a=this.indexedDB.open(j3,q3);a.onupgradeneeded=()=>K3(a),a.onsuccess=()=>{const l=a.result;if(n==null){const c=l.transaction(bu,"readonly"),h=c.objectStore(bu).get(this.modelPath);h.onsuccess=()=>{if(h.result==null)return l.close(),o(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));i(h.result.modelArtifacts)},h.onerror=d=>(l.close(),o(h.error)),c.oncomplete=()=>l.close()}else{const c=iy(n),u=l.transaction(nc,"readwrite");let h=u.objectStore(nc);const d=h.put({modelPath:this.modelPath,modelArtifactsInfo:c});let f;d.onsuccess=()=>{f=l.transaction(bu,"readwrite");const m=f.objectStore(bu).put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:c});m.onsuccess=()=>i({modelArtifactsInfo:c}),m.onerror=g=>{h=u.objectStore(nc);const y=h.delete(this.modelPath);y.onsuccess=()=>(l.close(),o(m.error)),y.onerror=v=>(l.close(),o(m.error))}},d.onerror=p=>(l.close(),o(d.error)),u.oncomplete=()=>{f==null?l.close():f.oncomplete=()=>l.close()}}},a.onerror=l=>o(a.error)})}};Hu.URL_SCHEME="indexeddb://";const WR=r=>kt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Hu.URL_SCHEME)?WY(r.slice(Hu.URL_SCHEME.length)):null;sr.registerSaveRouter(WR);sr.registerLoadRouter(WR);function WY(r){return new Hu(r)}function GY(r){return r.startsWith(Hu.URL_SCHEME)?r.slice(Hu.URL_SCHEME.length):r}let HY=class{constructor(){this.indexedDB=UR()}async listModels(){return new Promise((t,n)=>{const i=this.indexedDB.open(j3,q3);i.onupgradeneeded=()=>K3(i),i.onsuccess=()=>{const o=i.result,a=o.transaction(nc,"readonly"),c=a.objectStore(nc).getAll();c.onsuccess=()=>{const u={};for(const h of c.result)u[h.modelPath]=h.modelArtifactsInfo;t(u)},c.onerror=u=>(o.close(),n(c.error)),a.oncomplete=()=>o.close()},i.onerror=o=>n(i.error)})}async removeModel(t){return t=GY(t),new Promise((n,i)=>{const o=this.indexedDB.open(j3,q3);o.onupgradeneeded=()=>K3(o),o.onsuccess=()=>{const a=o.result,l=a.transaction(nc,"readwrite"),c=l.objectStore(nc),u=c.get(t);let h;u.onsuccess=()=>{if(u.result==null)return a.close(),i(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const d=c.delete(t),f=()=>{h=a.transaction(bu,"readwrite");const m=h.objectStore(bu).delete(t);m.onsuccess=()=>n(u.result.modelArtifactsInfo),m.onerror=g=>i(u.error)};d.onsuccess=f,d.onerror=p=>(f(),a.close(),i(u.error))}},u.onerror=d=>(a.close(),i(u.error)),l.oncomplete=()=>{h==null?a.close():h.oncomplete=()=>a.close()}},o.onerror=a=>i(o.error)})}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const il="/",ad="tensorflowjs_models",GR="info",jY="model_topology",qY="weight_specs",KY="weight_data",XY="model_metadata";function HR(r){return{info:[ad,r,GR].join(il),topology:[ad,r,jY].join(il),weightSpecs:[ad,r,qY].join(il),weightData:[ad,r,KY].join(il),modelMetadata:[ad,r,XY].join(il)}}function jR(r){for(const t of Object.values(r))window.localStorage.removeItem(t)}function YY(r){const t=r.split(il);if(t.length<3)throw new Error(`Invalid key format: ${r}`);return t.slice(1,t.length-1).join(il)}function ZY(r){return r.startsWith(ju.URL_SCHEME)?r.slice(ju.URL_SCHEME.length):r}let ju=class{constructor(t){if(!kt().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=HR(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(t.modelTopology),i=JSON.stringify(t.weightSpecs),o=iy(t);try{this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,i),this.LS.setItem(this.keys.weightData,FY(t.weightData));const a={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:t.signature!=null?t.signature:void 0,userDefinedMetadata:t.userDefinedMetadata!=null?t.userDefinedMetadata:void 0,modelInitializer:t.modelInitializer!=null?t.modelInitializer:void 0,initializerSignature:t.initializerSignature!=null?t.initializerSignature:void 0,trainingConfig:t.trainingConfig!=null?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(a)),{modelArtifactsInfo:o}}catch{throw jR(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${o.modelTopologyBytes}, weightSpecsBytes=${o.weightSpecsBytes}, weightDataBytes=${o.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(t==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},i=JSON.parse(this.LS.getItem(this.keys.topology));if(i==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=i;const o=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(o==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=o;const a=this.LS.getItem(this.keys.modelMetadata);if(a!=null){const c=JSON.parse(a);n.format=c.format,n.generatedBy=c.generatedBy,n.convertedBy=c.convertedBy,c.signature!=null&&(n.signature=c.signature),c.userDefinedMetadata!=null&&(n.userDefinedMetadata=c.userDefinedMetadata),c.modelInitializer!=null&&(n.modelInitializer=c.modelInitializer),c.initializerSignature!=null&&(n.initializerSignature=c.initializerSignature),c.trainingConfig!=null&&(n.trainingConfig=c.trainingConfig)}const l=this.LS.getItem(this.keys.weightData);if(l==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=PY(l),n}};ju.URL_SCHEME="localstorage://";const qR=r=>kt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(ju.URL_SCHEME)?JY(r.slice(ju.URL_SCHEME.length)):null;sr.registerSaveRouter(qR);sr.registerLoadRouter(qR);function JY(r){return new ju(r)}let QY=class{constructor(){W(kt().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),W(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const t={},n=ad+il,i=il+GR;for(let o=0;o<this.LS.length;++o){const a=this.LS.key(o);if(a.startsWith(n)&&a.endsWith(i)){const l=YY(a);t[l]=JSON.parse(this.LS.getItem(a))}}return t}async removeModel(t){t=ZY(t);const n=HR(t);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${t}'`);const i=JSON.parse(this.LS.getItem(n.info));return jR(n),i}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lI="://";let nl=class{constructor(){this.managers={}}static getInstance(){return nl.instance==null&&(nl.instance=new nl),nl.instance}static registerManager(t,n){W(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(lI)&&(t=t.slice(0,t.indexOf(lI))),W(t.length>0,()=>"scheme must not be an empty string.");const i=nl.getInstance();W(i.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),i.managers[t]=n}static getManager(t){const n=nl.getInstance().managers[t];if(n==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return n}static getSchemes(){return Object.keys(nl.getInstance().managers)}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let tZ=class{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,n){return fetch(t,n)}now(){return performance.now()}encode(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,n){return new TextDecoder(n).decode(t)}setTimeoutCustom(t,n){if(typeof window>"u"||!kt().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(t,n);return}this.functionRefs.push(t),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",i=>{if(i.source===window&&i.data.name===this.messageName){i.stopPropagation();const o=this.functionRefs[i.data.index];o(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}};if(kt().get("IS_BROWSER")){kt().setPlatform("browser",new tZ);try{nl.registerManager(ju.URL_SCHEME,new QY)}catch{}try{nl.registerManager(Hu.URL_SCHEME,new HY)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eZ={importFetch:()=>require("node-fetch")};let Fx,nZ=class{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,n){return kt().global.fetch!=null?kt().global.fetch(t,n):(Fx==null&&(Fx=eZ.importFetch()),Fx(t,n))}now(){const t=process.hrtime();return t[0]*1e3+t[1]/1e6}encode(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(t)}decode(t,n){return t.length===0?"":new this.util.TextDecoder(n).decode(t)}};kt().get("IS_NODE")&&!kt().get("IS_BROWSER")&&kt().setPlatform("node",new nZ);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rn(r,t="float32",n){return t=t||"float32",El(r),new xr(r,t,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sZ(r,t){const n=K(r,"x","cast");if(!JX(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const i={x:n},o={dtype:t};return ft.runKernel(Rm,i,o)}const de=pt({cast_:sZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rZ(r){const n={x:K(r,"x","clone","string_or_numeric")};return ft.runKernel(qm,n)}const Au=pt({clone_:rZ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iZ(r,t=!1){console.log(r.toString(t))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */RR();const oZ={buffer:rn,cast:de,clone:Au,print:iZ};IY(oZ);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aZ="model",lZ=".json",cZ=".weights.bin";function cI(r){return new Promise(t=>setTimeout(t)).then(r)}let Fd=class{constructor(t){if(!kt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(Fd.URL_SCHEME)&&(t=t.slice(Fd.URL_SCHEME.length)),(t==null||t.length===0)&&(t=aZ),this.modelJsonFileName=t+lZ,this.weightDataFileName=t+cZ}async save(t){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const i=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],o=VR(t,i),a=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),l=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(l.download=this.modelJsonFileName,l.href=a,await cI(()=>l.dispatchEvent(new MouseEvent("click"))),t.weightData!=null){const c=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;c.download=this.weightDataFileName,c.href=n,await cI(()=>c.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:iy(t)}}}};Fd.URL_SCHEME="downloads://";const uZ=r=>kt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Fd.URL_SCHEME)?hZ(r.slice(Fd.URL_SCHEME.length)):null;sr.registerSaveRouter(uZ);function hZ(r="model"){return new Fd(r)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uI(r,t,n,i){l(r),n=n??0,i=i??1,c(n,i);let o=0;const a=u=>(u.then(h=>{const d=n+ ++o/r.length*(i-n);return t(d),h}),u);function l(u){W(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function c(u,h){W(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),W(h>=0&&h<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${h}`),W(h>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${h}`)}return Promise.all(r.map(a))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function dZ(r,t){t==null&&(t={});const n=t.fetchFunc==null?kt().platform.fetch:t.fetchFunc,i=r.map(f=>n(f,t.requestInit,{isBinary:!0})),o=0,a=.5,c=(t.onProgress==null?await Promise.all(i):await uI(i,t.onProgress,o,a)).map(f=>f.arrayBuffer()),u=.5,h=1;return t.onProgress==null?await Promise.all(c):await uI(c,t.onProgress,u,h)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fZ="application/octet-stream",pZ="application/json";let k_=class{constructor(t,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(W(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=kt().platform.fetch,W(t!=null&&t.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(t)&&W(t.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`),this.path=t,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const i=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],o=VR(t,i);n.body.append("model.json",new Blob([JSON.stringify(o)],{type:pZ}),"model.json"),t.weightData!=null&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:fZ}),"model.weights.bin");const a=await this.fetch(this.path,n);if(a.ok)return{modelArtifactsInfo:iy(t),responses:[a]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${a.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await t.json()}catch{let l=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?l+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":l+=" Please make sure the server is serving valid JSON for this request.",new Error(l)}const i=n.modelTopology,o=n.weightsManifest;if(i==null&&o==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return zY(n,a=>this.loadWeights(a))}async loadWeights(t){const n=Array.isArray(this.path)?this.path[1]:this.path,[i,o]=mZ(n),a=this.weightPathPrefix||i,l=VY(t),c=[],u=[];for(const d of t)for(const f of d.paths)this.weightUrlConverter!=null?u.push(this.weightUrlConverter(f)):c.push(a+f+o);this.weightUrlConverter&&c.push(...await Promise.all(u));const h=await dZ(c,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[l,zR(h)]}};k_.URL_SCHEME_REGEX=/^https?:\/\//;function mZ(r){const t=r.lastIndexOf("/"),n=r.lastIndexOf("?"),i=r.substring(0,t),o=n>t?r.substring(n):"";return[i+"/",o]}function hI(r){return r.match(k_.URL_SCHEME_REGEX)!=null}const KR=(r,t)=>{if(typeof fetch>"u"&&(t==null||t.fetchFunc==null))return null;{let n=!0;if(Array.isArray(r)?n=r.every(i=>hI(i)):n=hI(r),n)return gZ(r,t)}return null};sr.registerSaveRouter(KR);sr.registerLoadRouter(KR);function gZ(r,t){return new k_(r,t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vZ(r,t,n=!1,i=!1){let o=K(r,"a","matMul"),a=K(t,"b","matMul");[o,a]=ws(o,a);const l={a:o,b:a},c={transposeA:n,transposeB:i};return ft.runKernel(av,l,c)}const Nn=pt({matMul_:vZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yZ(r,t,n=1,i=0,o="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const l={indices:K(r,"indices","oneHot","int32")},c={dtype:o,depth:t,onValue:n,offValue:i};return ft.runKernel(Pv,l,c)}const XR=pt({oneHot_:yZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ga(){return ft}function X3(){return ft.memory()}function _t(r,t){return ft.tidy(r,t)}function ln(r){MR(r).forEach(n=>n.dispose())}function Aa(r){return ft.keep(r)}function xZ(r){return ft.setBackend(r)}function YR(r,t,n=1){return ft.registerBackend(r,t,n)}function bZ(){return ft.backend}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wZ(r){const n={input:K(r,"input","imag")};return ft.runKernel(Q4,n)}const $_=pt({imag_:wZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SZ(r){const n={x:K(r,"x","neg")};return ft.runKernel(Ov,n)}const fs=pt({neg_:SZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Z(r){const n={input:K(r,"input","real")};return ft.runKernel(a_,n)}const o2=pt({real_:_Z});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TZ(r,t,n){const i=K(r,"x","transpose");if(t==null&&(t=i.shape.map((l,c)=>c).reverse()),W(i.rank===t.length,()=>`Error in transpose: rank of input ${i.rank} must match length of perm ${t}.`),t.forEach(l=>{W(l>=0&&l<i.rank,()=>`All entries in 'perm' must be between 0 and ${i.rank-1} but got ${t}`)}),i.rank<=1)return i.clone();const o={x:i},a={perm:t};return i.dtype==="complex64"?_t(()=>{let l=o2(i),c=$_(i);return l=ft.runKernel(wd,{x:l},a),c=ft.runKernel(wd,{x:c},a),n&&(c=fs(c)),Ld(l,c)}):ft.runKernel(wd,o,a)}const vn=pt({transpose_:TZ});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pd(r,t){const n=r.length,i=[];for(let o=0;o<n;o++){const a=n-1-o,l=r[a]||1;(t[t.length-1-o]||1)>1&&l===1&&i.unshift(a)}return i}function Fs(r,t){const n=[];for(let i=0;i<t.length;i++){const o=r[r.length-i-1],a=t.length-i-1,l=t[a];(o==null||o===1&&l>1)&&n.unshift(a)}return n}function qe(r,t){const n=[],i=Math.max(r.length,t.length);for(let o=0;o<i;o++){let a=r[r.length-o-1];a==null&&(a=1);let l=t[t.length-o-1];if(l==null&&(l=1),a===1)n.unshift(l);else if(l===1)n.unshift(a);else if(a!==l){const c=`Operands could not be broadcast together with shapes ${r} and ${t}.`;throw Error(c)}else n.unshift(a)}return n}function I_(r,t){const n=r.shape.length,i=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(i<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${i}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[i-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[i-1]} vs. ${n}`);if(Nt(r.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${r.shape}.`);const o=t.shape,a=o[o.length-1];let l=1;for(let f=0;f<o.length-1;++f)l*=o[f];const c=r.shape,u=o.slice();u.pop();let h=1;for(let f=a;f<n;++f)h*=c[f],u.push(c[f]);const d=[...Ie(r.shape).map(f=>f/h),1].slice(0,a);return[u,l,h,d]}function ZR(r,t,n){const i=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${r}, sliceDim: ${i}, and batchDim: ${o}.`;if(n.rank<o)throw new Error(a+` update.rank < ${o}. `);if(r.length<i+(n.rank-o))throw new Error(a+` Output shape length < ${i+(n.rank-o)}`);if(n.rank!==o+r.length-i)throw new Error(a+` update.rank != ${o+r.length-i}`);for(let l=0;l<o;++l)if(n.shape[l]!==t.shape[l])throw new Error(a+` updates.shape[${l}] (${n.shape[l]}) != indices.shape[${l}] (${t.shape[l]}).`);for(let l=0;l<n.rank-o;++l)if(n.shape[l+o]!==r[l+i])throw new Error(a+` updates.shape[${l+o}] (${n.shape[l+o]}) != shape[${l+o}] (${r[l+o]})`)}function CZ(r,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(r.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${r.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(r.size===0)throw new Error(`Updates specified for empty output. updates shape: ${r.shape}`)}ZR(n,t,r)}function Sg(r,t,n){const i=t.shape.length,o=i>1?t.shape[i-1]:1,a=n.length;let l=1;for(let f=o;f<a;++f)l*=n[f];const c=o<1?1:o,u=Nt(t.shape)/c,h=[...Ie(n.slice(0,o)),1],d=Nt(n);return{sliceRank:o,numUpdates:u,sliceSize:l,strides:h,outputSize:d}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y3=-2,kZ=-1;function E_(r,t,n){const i=r.shape.length;W(i===t.length,()=>`Error in slice${i}D: Length of begin ${t} must match the rank of the array (${i}).`),W(i===n.length,()=>`Error in slice${i}D: Length of size ${n} must match the rank of the array (${i}).`);for(let o=0;o<i;++o)W(t[o]+n[o]<=r.shape[o],()=>`Error in slice${i}D: begin[${o}] + size[${o}] (${t[o]+n[o]}) would overflow input.shape[${o}] (${r.shape[o]})`)}function $Z(r){const t=[];let n=0;for(;r>0;)r&1&&t.push(n),r/=2,n++;return t}function N_(r,t,n){const i=[];for(let o=0;o<r.length;o++)i[o]=Math.ceil((t[o]-r[o])/n[o]);return i}function JR(r,t,n,i){const o=[...r];for(let a=o.length;a<i.length;a++)o.push(1);for(let a=0;a<n;a++)a===0?o[t]=1:(o.splice(t,0,1),o.pop());return o}function QR(r,t,n){return n<=r?n:n-(t-1)}function t9(r,t){const n=[];for(let i=0;i<r;i++)n.push(t+i);return n}function IZ(r,t,n,i,o,a,l,c,u){const h=r.length;let d=new Array(h),f=new Array(h),p=new Array(h);if(t.length&&n>0){const m=t[0],g=n+1;d=e9(l,m,g,i,r),f=n9(c,m,g,o,r),p=JR(a,m,g,r)}else for(let m=0;m<h;m++)d[m]=r9(l,i,a,r,m,u),f[m]=i9(c,o,a,r,m,u),p[m]=s9(a,m,u);return{begin:d,end:f,strides:p}}function e9(r,t,n,i,o){const a=[...o],l=t9(n,t);for(let c=0;c<a.length;c++)if(l.indexOf(c)>-1)a[c]=0;else{const u=QR(t,n,c);let h=i[u];r&1<<u&&(h=0),a[c]=h}return a}function n9(r,t,n,i,o){const a=[...o],l=t9(n,t);for(let c=0;c<a.length;c++)if(l.indexOf(c)>-1)a[c]=Number.MAX_SAFE_INTEGER;else{const u=QR(t,n,c);let h=i[u];r&1<<u&&(h=Number.MAX_SAFE_INTEGER),a[c]=h}for(let c=0;c<a.length;c++){const u=o[c];a[c]<0&&(a[c]+=u),a[c]=Gu(0,a[c],o[c])}return a}function s9(r,t,n){let i=r[t];return(n&1<<t||i==null)&&(i=1),i}function r9(r,t,n,i,o,a){let l=t[o];const c=n[o]||1;(r&1<<o||a&1<<o||l==null)&&(c>0?l=Number.MIN_SAFE_INTEGER:l=Number.MAX_SAFE_INTEGER);const u=i[o];return l<0&&(l+=u),l=Gu(0,l,u-1),l}function i9(r,t,n,i,o,a){let l=t[o];const c=n[o]||1;(r&1<<o||a&1<<o||l==null)&&(c>0?l=Number.MAX_SAFE_INTEGER:l=Number.MIN_SAFE_INTEGER);const u=i[o];return l<0&&(l+=u),c>0?l=Gu(0,l,u):l=Gu(-1,l,u-1),l}function A_(r,t,n){let i=n.length;for(let o=0;o<n.length;o++)if(n[o]>1){i=o;break}for(let o=i+1;o<n.length;o++)if(t[o]>0||n[o]!==r[o])return!1;return!0}function M_(r,t){let n=r.length>0?r[r.length-1]:1;for(let i=0;i<r.length-1;i++)n+=r[i]*t[i];return n}function oy(r,t,n){let i;const o=r.shape.length;typeof t=="number"?i=[t,...new Array(o-1).fill(0)]:t.length<o?i=t.concat(new Array(o-t.length).fill(0)):i=t.slice(),i.forEach(l=>{W(l!==-1,()=>"slice() does not support negative begin indexing.")});let a;return n==null?a=new Array(o).fill(-1):typeof n=="number"?a=[n,...new Array(o-1).fill(-1)]:n.length<o?a=n.concat(new Array(o-n.length).fill(-1)):a=n,a=a.map((l,c)=>l>=0?l:(W(l===-1,()=>`Negative size values should be exactly -1 but got ${l} for the slice() size at index ${c}.`),r.shape[c]-i[c])),[i,a]}function D_(r,t,n,i,o,a,l,c,u){let h;if(i==null?(h=new Array(t.length),h.fill(1)):h=i,l!=null&&l&l-1)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const f={dims:h.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:h.slice(),beginMask:o,endMask:a,ellipsisMask:l,newAxisMask:c,shrinkAxisMask:u};for(let w=0;w<f.dims;w++)d&&1<<w&c&&f.numAddAxisAfterEllipsis++,1<<w&l&&(d=!0);d||(f.ellipsisMask|=1<<f.dims,f.dims++);const p={dims:r.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};EZ(f,p);let m=!0,g=!0,y=!0;const v=[],x=[];for(let w=0;w<r.length;++w){if(p.strides[w]===0)throw Error(`strides[${w}] must be non-zero`);const S=!!(p.shrinkAxisMask&1<<w),_=r[w];if(_===-1){v.push(S?1:-1);continue}const $=[p.beginMask&1<<w,p.endMask&1<<w],N=[p.strides[w]>0?0:-1,p.strides[w]>0?_:_-1];if(S&&p.strides[w]<=0)throw Error("only stride 1 allowed on non-range indexing.");y=y&&p.strides[w]===1;const k=!!(p.beginMask&1<<w&&p.endMask&1<<w);if(p.beginValid&&p.endValid){if(S){const F=p.begin[w]<0?_+p.begin[w]:p.begin[w];if(p.begin[w]=F,p.end[w]=p.begin[w]+1,F<0||F>=_)throw Error(`slice index ${p.begin[w]} of dimension ${w} out of bounds.`)}else p.begin[w]=dI(p.begin[w],0,p.strides[w],_,$,N),p.end[w]=dI(p.end[w],1,p.strides[w],_,$,N);const B=p.strides[w]===1&&p.begin[w]===0&&p.end[w]===_;m=m&&B,g=g&&(w===0&&p.strides[w]===1||B)}else m=m&&p.strides[w]===1&&k,g=g&&(w===0&&p.strides[w]===1||k);let I,O=!1;if(p.beginValid&&p.endValid?(I=p.end[w]-p.begin[w],O=!0):S?(I=1,O=!0):k&&_>=0&&(p.strides[w]<0?I=-_:I=_,O=!0),O){let B;I===0||I<0!=p.strides[w]<0?B=0:B=Math.trunc(I/p.strides[w])+(I%p.strides[w]!==0?1:0),v.push(B)}else v.push(-1)}for(let w=0;w<p.finalShapeGatherIndices.length;++w){const S=p.finalShapeGatherIndices[w];S>=0?x.push(v[S]):S===Y3&&x.push(1)}return{finalShapeSparse:x.filter((w,S)=>p.finalShapeGatherIndices[S]!==Y3),finalShape:x,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:p.begin,end:p.end,strides:p.strides}}function EZ(r,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=r.begin!=null,t.endValid=r.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let i=0;i<r.dims;i++)if(1<<i&r.ellipsisMask){const o=Math.min(t.dims-(r.dims-i)+1+r.numAddAxisAfterEllipsis,t.dims);for(;n<o;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=i}else if(1<<i&r.newAxisMask)t.finalShapeGatherIndices.push(Y3),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);r.begin!=null&&(t.begin[n]=r.begin[i]),r.end!=null&&(t.end[n]=r.end[i]),t.strides[n]=r.strides[i],r.beginMask&1<<i&&(t.beginMask|=1<<n),r.endMask&1<<i&&(t.endMask|=1<<n),r.shrinkAxisMask&1<<i?(t.finalShapeGatherIndices.push(kZ),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(i)),t.inputShapeGatherIndicesSparse[n]=i,n++}}function dI(r,t,n,i,o,a){if(o[t])return n>0?a[t]:a[t+1&1];{const l=r<0?i+r:r;return l<a[0]?a[0]:l>a[1]?a[1]:l}}const NZ=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:E_,maskToAxes:$Z,computeOutShape:N_,stridesWithElidedDims:JR,getNormalizedAxes:IZ,startIndicesWithElidedDims:e9,stopIndicesWithElidedDims:n9,stridesForAxis:s9,startForAxis:r9,stopForAxis:i9,isSliceContinous:A_,computeFlatOffset:M_,parseSliceParams:oy,sliceInfo:D_},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ff{getClassName(){return this.constructor.className}static fromConfig(t,n){return new t(n)}}class ro{constructor(){this.classNameMap={}}static getMap(){return ro.instance==null&&(ro.instance=new ro),ro.instance}static register(t){ro.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function Gt(r){W(r.className!=null,()=>"Class being registered does not have the static className property defined."),W(typeof r.className=="string",()=>"className is required to be a string, but got type "+typeof r.className),W(r.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),ro.register(r)}/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AZ(r,t){let n=K(r,"a","add"),i=K(t,"b","add");[n,i]=ws(n,i);const o={a:n,b:i};return ft.runKernel(df,o)}const Xt=pt({add_:AZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MZ(r,t){let n=K(r,"a","floorDiv"),i=K(t,"b","floorDiv");[n,i]=ws(n,i);const o={a:n,b:i};return ft.runKernel(Hm,o)}const o9=pt({floorDiv_:MZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DZ(r,t){let n=K(r,"a","div"),i=K(t,"b","div");if([n,i]=ws(n,i),n.dtype==="int32"&&i.dtype==="int32")return o9(n,i);const o={a:n,b:i},a={};return ft.runKernel(Bm,o,a)}const $e=pt({div_:DZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RZ(r,t){let n=K(r,"a","mul"),i=K(t,"b","mul");[n,i]=ws(n,i);const o={a:n,b:i};return ft.runKernel(ng,o)}const ct=pt({mul_:RZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OZ(r){const t=K(r,"x","abs");if(t.dtype==="complex64"){const n={x:t};return ft.runKernel(cv,n)}else{const n={x:t};return ft.runKernel(nv,n)}}const Ws=pt({abs_:OZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LZ(r){const n={x:K(r,"x","acos")};return ft.runKernel($m,n)}const FZ=pt({acos_:LZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PZ(r){const n={x:K(r,"x","acosh")};return ft.runKernel(Im,n)}const BZ=pt({acosh_:PZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zZ(r,t=null,n=!1){const o={x:K(r,"x","all","bool")},a={axis:t,keepDims:n};return ft.runKernel(D4,o,a)}const a9=pt({all_:zZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VZ(r,t=null,n=!1){const o={x:K(r,"x","any","bool")},a={axis:t,keepDims:n};return ft.runKernel(R4,o,a)}const Z3=pt({any_:VZ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UZ(r,t=0){const i={x:K(r,"x","argMax")},o={axis:t};return ft.runKernel(sv,i,o)}const Xp=pt({argMax_:UZ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WZ(r,t=0){const i={x:K(r,"x","argMin")},o={axis:t};return ft.runKernel(rv,i,o)}const GZ=pt({argMin_:WZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HZ(r){const n={x:K(r,"x","asin")};return ft.runKernel(Em,n)}const jZ=pt({asin_:HZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qZ(r){const n={x:K(r,"x","asinh")};return ft.runKernel(Nm,n)}const KZ=pt({asinh_:qZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XZ(r){const n={x:K(r,"x","atan")};return ft.runKernel(Am,n)}const YZ=pt({atan_:XZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZZ(r,t){let n=K(r,"a","atan2"),i=K(t,"b","atan2");[n,i]=ws(n,i);const o={a:n,b:i};return ft.runKernel(Dm,o)}const JZ=pt({atan2_:ZZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QZ(r){const n={x:K(r,"x","atanh")};return ft.runKernel(Mm,n)}const tJ=pt({atanh_:QZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _g(r,t,n,i,o="NHWC",a){const l=r[3],c=[...t,l],u=Al(o);return dr(r,c,n,a,i,null,null,u)}function ko(r,t,n,i,o,a,l="channelsLast"){const[c,u]=a2(t);let h;if(l==="channelsLast")h=[c,u,r[3],r[3]];else if(l==="channelsFirst")h=[c,u,r[1],r[1]];else throw new Error(`Unknown dataFormat ${l}`);return dr(r,h,n,i,o,a,!1,l)}function Nl(r,t,n,i,o,a,l="NDHWC"){const[c,u,h]=J3(t);let d,f;if(l==="NDHWC")f="channelsLast",d=[c,u,h,r[4],r[4]];else if(l==="NCDHW")f="channelsFirst",d=[c,u,h,r[1],r[1]];else throw new Error(`Unknown dataFormat ${l}`);return Pc(r,d,n,i,o,!1,f,a)}function dr(r,t,n,i,o,a,l=!1,c="channelsLast"){let[u,h,d,f]=[-1,-1,-1,-1];if(c==="channelsLast")[u,h,d,f]=r;else if(c==="channelsFirst")[u,f,h,d]=r;else throw new Error(`Unknown dataFormat ${c}`);const[p,m,,g]=t,[y,v]=a2(n),[x,b]=a2(i),w=Sd(p,x),S=Sd(m,b),{padInfo:_,outHeight:$,outWidth:N}=sJ(o,h,d,y,v,w,S,a,c),k=l?g*f:g;let I;return c==="channelsFirst"?I=[u,k,$,N]:c==="channelsLast"&&(I=[u,$,N,k]),{batchSize:u,dataFormat:c,inHeight:h,inWidth:d,inChannels:f,outHeight:$,outWidth:N,outChannels:k,padInfo:_,strideHeight:y,strideWidth:v,filterHeight:p,filterWidth:m,effectiveFilterHeight:w,effectiveFilterWidth:S,dilationHeight:x,dilationWidth:b,inShape:r,outShape:I,filterShape:t}}function Pc(r,t,n,i,o,a=!1,l="channelsLast",c){let[u,h,d,f,p]=[-1,-1,-1,-1,-1];if(l==="channelsLast")[u,h,d,f,p]=r;else if(l==="channelsFirst")[u,p,h,d,f]=r;else throw new Error(`Unknown dataFormat ${l}`);const[m,g,y,,v]=t,[x,b,w]=J3(n),[S,_,$]=J3(i),N=Sd(m,S),k=Sd(g,_),I=Sd(y,$),{padInfo:O,outDepth:B,outHeight:F,outWidth:D}=rJ(o,h,d,f,x,b,w,N,k,I,c),L=a?v*p:v;let V;return l==="channelsFirst"?V=[u,L,B,F,D]:l==="channelsLast"&&(V=[u,B,F,D,L]),{batchSize:u,dataFormat:l,inDepth:h,inHeight:d,inWidth:f,inChannels:p,outDepth:B,outHeight:F,outWidth:D,outChannels:L,padInfo:O,strideDepth:x,strideHeight:b,strideWidth:w,filterDepth:m,filterHeight:g,filterWidth:y,effectiveFilterDepth:N,effectiveFilterHeight:k,effectiveFilterWidth:I,dilationDepth:S,dilationHeight:_,dilationWidth:$,inShape:r,outShape:V,filterShape:t}}function eJ(r,t,n,i,o){i==null&&(i=R_(r,t,n));const a=r[0],l=r[1],c=Mu((a-t+2*i)/n+1,o),u=Mu((l-t+2*i)/n+1,o);return[c,u]}function nJ(r,t,n,i,o,a){o==null&&(o=R_(r,t,i));const l=r[0],c=r[1],u=r[2],h=Mu((l-t+2*o)/i+1,a),d=Mu((c-t+2*o)/i+1,a),f=Mu((u-t+2*o)/i+1,a);return[h,d,f,n]}function R_(r,t,n,i=1){const o=Sd(t,i);return Math.floor((r[0]*(n-1)-n+o)/2)}function a2(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function J3(r){return typeof r=="number"?[r,r,r]:r}function Sd(r,t){return t<=1?r:r+(r-1)*(t-1)}function sJ(r,t,n,i,o,a,l,c,u){let h,d,f;if(typeof r=="number"){h={top:r,bottom:r,left:r,right:r,type:r===0?"VALID":"NUMBER"};const m=eJ([t,n],a,i,r,c);d=m[0],f=m[1]}else if(r==="same"){d=Math.ceil(t/i),f=Math.ceil(n/o);const p=Math.max(0,(d-1)*i+a-t),m=Math.max(0,(f-1)*o+l-n),g=Math.floor(p/2),y=p-g,v=Math.floor(m/2),x=m-v;h={top:g,bottom:y,left:v,right:x,type:"SAME"}}else if(r==="valid")h={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((t-a+1)/i),f=Math.ceil((n-l+1)/o);else if(typeof r=="object"){const p=u==="channelsLast"?r[1][0]:r[2][0],m=u==="channelsLast"?r[1][1]:r[2][1],g=u==="channelsLast"?r[2][0]:r[3][0],y=u==="channelsLast"?r[2][1]:r[3][1];h={top:p,bottom:m,left:g,right:y,type:p===0&&m===0&&g===0&&y===0?"VALID":"EXPLICIT"},d=Mu((t-a+p+m)/i+1,c),f=Mu((n-l+g+y)/o+1,c)}else throw Error(`Unknown padding parameter: ${r}`);return{padInfo:h,outHeight:d,outWidth:f}}function rJ(r,t,n,i,o,a,l,c,u,h,d){let f,p,m,g;if(typeof r=="number"){f={top:r,bottom:r,left:r,right:r,front:r,back:r,type:r===0?"VALID":"NUMBER"};const v=nJ([t,n,i,1],c,1,o,r,d);p=v[0],m=v[1],g=v[2]}else if(r==="same"){p=Math.ceil(t/o),m=Math.ceil(n/a),g=Math.ceil(i/l);const y=(p-1)*o+c-t,v=(m-1)*a+u-n,x=(g-1)*l+h-i,b=Math.floor(y/2),w=y-b,S=Math.floor(v/2),_=v-S,$=Math.floor(x/2),N=x-$;f={top:S,bottom:_,left:$,right:N,front:b,back:w,type:"SAME"}}else if(r==="valid")f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((t-c+1)/o),m=Math.ceil((n-u+1)/a),g=Math.ceil((i-h+1)/l);else throw Error(`Unknown padding parameter: ${r}`);return{padInfo:f,outDepth:p,outHeight:m,outWidth:g}}function Mu(r,t){if(!t)return Math.trunc(r);switch(t){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error(`Unknown roundingMode ${t}`)}}function qu(r){const[t,n,i]=a2(r);return t===1&&n===1&&i===1}function _r(r,t){return qu(r)||qu(t)}function Al(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${r}`)}function si(r,t,n){if(n!=null){if(typeof t=="string")throw Error(`Error in ${r}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if(typeof t=="number")W(Rd(t),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);else if(typeof t=="object")t.forEach(i=>{i.forEach(o=>{W(Rd(o),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${n} but got pad ${o}.`)})});else throw Error(`Error in ${r}: Unknown padding parameter: ${t}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iJ(r,t){const i={x:K(r,"x","reshape","string_or_numeric")},o={shape:t};return ft.runKernel(Wv,i,o)}const gt=pt({reshape_:iJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oJ(r,t,n,i,o){const a=K(r,"x","avgPool","float32"),l=1;W(_r(n,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${l}'`);let c=a,u=!1;a.rank===3&&(u=!0,c=gt(a,[1,a.shape[0],a.shape[1],a.shape[2]])),W(c.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${c.rank}.`),si("avgPool",i,o);const h={x:c},d={filterSize:t,strides:n,pad:i,dimRoundingMode:o};let f=ft.runKernel(iv,h,d);return f=de(f,a.dtype),u?gt(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const O_=pt({avgPool_:oJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aJ(r,t,n,i,o,a="NDHWC"){const l=K(r,"x","avgPool3d","float32");let c=l,u=!1;l.rank===4&&(u=!0,c=gt(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),W(c.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${c.rank}.`),W(a==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${a}`),si("avgPool3d",i,o);const h={x:c},d={filterSize:t,strides:n,pad:i,dimRoundingMode:o,dataFormat:a};let f=ft.runKernel(ov,h,d);return f=de(f,c.dtype),u?gt(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const lJ=pt({avgPool3d_:aJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cJ(r,t=0){W(r.length>=1,()=>"Pass at least one tensor to concat");const n=PR(r,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(a=>{if(a.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${a.dtype}. `)}),n.length===1)return Au(n[0]);const i=n,o={axis:t};return ft.runKernel(uv,i,o)}const br=pt({concat_:cJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uJ(r){const n={x:K(r,"x","sigmoid","float32")};return ft.runKernel(fg,n)}const pf=pt({sigmoid_:uJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hJ(r,t,n){const i=K(r,"x","slice","string_or_numeric");if(i.rank===0)throw new Error("Slicing scalar is not possible");const o={x:i},a={begin:t,size:n};return ft.runKernel(Kv,o,a)}const Fn=pt({slice_:hJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dJ(r){const n={x:K(r,"x","tanh","float32")};return ft.runKernel(xg,n)}const L_=pt({tanh_:dJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fJ(r,t,n){const i=K(r,"x","batchToSpaceND"),o=t.reduce((c,u)=>c*u);W(i.rank>=1+t.length,()=>`input rank is ${i.rank} but should be > than blockShape.length ${t.length}`),W(n.length===t.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`),W(i.shape[0]%o===0,()=>`input tensor batch is ${i.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${o}`);const a={x:i},l={blockShape:t,crops:n};return ft.runKernel(lv,a,l)}const F_=pt({batchToSpaceND_:fJ});function pJ(r){let t;return r.rank===0||r.rank===1?t=gt(r,[1,1,1,r.size]):r.rank===2?t=gt(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?t=gt(r,[1,r.shape[0],r.shape[1],r.shape[2]]):t=r,t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mJ(r,t,n,i,o,a){a==null&&(a=.001);const l=K(r,"x","batchNorm"),c=K(t,"mean","batchNorm"),u=K(n,"variance","batchNorm");let h;o!=null&&(h=K(o,"scale","batchNorm"));let d;i!=null&&(d=K(i,"offset","batchNorm")),W(c.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),W(d==null||c.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),W(h==null||c.rank===h.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:pJ(l),scale:h,offset:d,mean:c,variance:u},m={varianceEpsilon:a},g=ft.runKernel(xv,p,m);return gt(g,l.shape)}const ay=pt({batchNorm_:mJ});function gJ(r,t,n,i,o,a){const l=K(r,"x","batchNorm"),c=K(t,"mean","batchNorm"),u=K(n,"variance","batchNorm");let h;o!=null&&(h=K(o,"scale","batchNorm"));let d;return i!=null&&(d=K(i,"offset","batchNorm")),W(l.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${l.rank}.`),W(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${c.rank}.`),W(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),h!=null&&W(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${h.rank}.`),d!=null&&W(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),ay(l,c,u,d,h,a)}const vJ=pt({batchNorm2d_:gJ});function yJ(r,t,n,i,o,a){const l=K(r,"x","batchNorm"),c=K(t,"mean","batchNorm"),u=K(n,"variance","batchNorm");let h;o!=null&&(h=K(o,"scale","batchNorm"));let d;return i!=null&&(d=K(i,"offset","batchNorm")),W(l.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${l.rank}.`),W(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${c.rank}.`),W(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),h!=null&&W(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${h.rank}.`),d!=null&&W(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),ay(l,c,u,d,h,a)}const xJ=pt({batchNorm3d_:yJ});function bJ(r,t,n,i,o,a){const l=K(r,"x","batchNorm"),c=K(t,"mean","batchNorm"),u=K(n,"variance","batchNorm");let h;o!=null&&(h=K(o,"scale","batchNorm"));let d;return i!=null&&(d=K(i,"offset","batchNorm")),W(l.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${l.rank}.`),W(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${c.rank}.`),W(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),h!=null&&W(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${h.rank}.`),d!=null&&W(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),ay(l,c,u,d,h,a)}const wJ=pt({batchNorm4d_:bJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SJ(r,t,n){const i=K(r,"x","bincount"),o=K(t,"weights","bincount");W(i.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${i.dtype}`),W(n>=0,()=>`size must be non-negative, but got ${n}.`),W(o.size===i.size||o.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${i.shape}, weights shape: ${o.shape}.`);const a={x:i,weights:o},l={size:n};return ft.runKernel(F4,a,l)}const _J=pt({bincount_:SJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TJ(r,t){let n=K(r,"broadcastTo","x");const i=n.shape;if(El(t),t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){const h=n.shape.slice();for(;h.length<t.length;)h.unshift(1);n=gt(n,h)}const o=n.shape,a=Array.from(t);for(let h=t.length-1;h>=0;h--)if(o[h]===t[h])a[h]=1;else if(n.shape[h]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${t}].`);if(a.map((h,d)=>h>1?d:-1).filter(h=>h>=0).length===0)return Au(n);const c={x:n},u={reps:a};return ft.runKernel(bg,c,u)}const Mp=pt({broadcastTo_:TJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CJ(r){const n={x:K(r,"x","ceil","float32")};return ft.runKernel(Om,n)}const kJ=pt({ceil_:CJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tg(r,t,n){El(r);const i={shape:r,value:t,dtype:n};return ft.runKernel(Y4,{},i)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $J(r,t,n){const i=K(r,"x","clipByValue");if(W(t<=n,()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`),t===n)return Tg(i.shape,t,i.dtype);const o={x:i},a={clipValueMin:t,clipValueMax:n};return ft.runKernel(Lm,o,a)}const zi=pt({clipByValue_:$J});function IJ(r){return br(r,0)}const EJ=pt({concat1d_:IJ});function NJ(r,t){return br(r,t)}const AJ=pt({concat2d_:NJ});function MJ(r,t){return br(r,t)}const DJ=pt({concat3d_:MJ});function RJ(r,t){return br(r,t)}const OJ=pt({concat4d_:RJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LJ(r,t,n,i,o="NHWC",a=[1,1],l){const c=K(r,"x","conv2d","float32"),u=K(t,"filter","conv2d","float32");let h=c,d=!1;c.rank===3&&(d=!0,h=gt(c,[1,c.shape[0],c.shape[1],c.shape[2]])),W(h.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${h.rank}.`),W(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),si("conv2d",i,l);const f=o==="NHWC"?h.shape[3]:h.shape[1];W(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),W(_r(n,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`);const p={x:h,filter:u},m={strides:n,pad:i,dataFormat:o,dilations:a,dimRoundingMode:l},g=ft.runKernel(hv,p,m);return d?gt(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const Ku=pt({conv2d_:LJ});function FJ(r,t,n,i,o="NWC",a=1,l){const c=K(r,"x","conv1d"),u=K(t,"filter","conv1d");let h=c,d=!1;c.rank===2&&(d=!0,h=gt(c,[1,c.shape[0],c.shape[1]])),W(h.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${h.rank}.`),W(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),si("conv1d",i,l),W(h.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${h.shape[2]}) must match input depth for filter ${u.shape[1]}.`),W(_r(n,a),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${a}'`),W(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);const f=gt(u,[1,u.shape[0],u.shape[1],u.shape[2]]),p=gt(h,[h.shape[0],1,h.shape[1],h.shape[2]]),v=Ku(p,f,[1,n],i,"NHWC",[1,a],l);return d?gt(v,[v.shape[2],v.shape[3]]):gt(v,[v.shape[0],v.shape[2],v.shape[3]])}const l9=pt({conv1d_:FJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PJ(r,t,n,i,o,a="NHWC",l){W(r.length===t.rank,()=>`Length of inShape (${r.length}) and rank of dy (${t.rank}) must match`);let c=r,u=t,h=!1;t.rank===3&&(h=!0,u=gt(t,[1,t.shape[0],t.shape[1],t.shape[2]]),c=[1,r[0],r[1],r[2]]),W(c.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${c.length}.`),W(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),W(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const d=a==="NHWC"?c[3]:c[1],f=a==="NHWC"?u.shape[3]:u.shape[1];W(d===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${n.shape[2]}.`),W(f===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[3]}.`),si("conv2dDerInput",o,l);const p={dy:u,filter:n},m={strides:i,pad:o,dataFormat:a,dimRoundingMode:l,inputShape:c},g=ft.runKernel(dv,p,m);return h?gt(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const P_=pt({conv2DBackpropInput_:PJ});function BJ(r,t,n,i,o,a){const l=K(r,"x","conv2dTranspose"),c=K(t,"filter","conv2dTranspose");return P_(n,l,c,i,o,"NHWC",a)}const c9=pt({conv2dTranspose_:BJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zJ(r,t,n,i,o="NDHWC",a=[1,1,1]){const l=K(r,"x","conv3d"),c=K(t,"filter","conv3d");let u=l,h=!1;l.rank===4&&(h=!0,u=gt(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),W(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),W(c.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${c.rank}.`),W(u.shape[4]===c.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${c.shape[3]}.`),W(_r(n,a),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`),W(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`);const d={x:u,filter:c},f={strides:n,pad:i,dataFormat:o,dilations:a},p=ft.runKernel(fv,d,f);return h?gt(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const VJ=pt({conv3d_:zJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UJ(r,t,n,i,o){W(r.length===t.rank,()=>`Length of inShape (${r.length}) and rank of dy (${t.rank}) must match`);let a=r,l=t,c=!1;t.rank===4&&(c=!0,l=gt(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),a=[1,r[0],r[1],r[2],r[3]]);const u=a[4],h=l.shape[4];W(a.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${a.length}.`),W(l.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${l.rank}`),W(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),W(u===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`),W(h===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[4]}.`);const d={dy:l,filter:n},f={pad:o,strides:i,inputShape:a},p=ft.runKernel(V4,d,f);return c?gt(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const u9=pt({conv3DBackpropInput_:UJ});function WJ(r,t,n,i,o){const a=K(r,"x","conv3dTranspose"),l=K(t,"filter","conv3dTranspose");return u9(n,a,l,i,o)}const GJ=pt({conv3dTranspose_:WJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HJ(r){const n={x:K(r,"x","cos","float32")};return ft.runKernel(Fm,n)}const B_=pt({cos_:HJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jJ(r){const n={x:K(r,"x","cosh","float32")};return ft.runKernel(Pm,n)}const h9=pt({cosh_:jJ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qJ(r,t=0,n=!1,i=!1){const a={x:K(r,"x","cumprod")},l={axis:t,exclusive:n,reverse:i};return ft.runKernel(U4,a,l)}const Q3=pt({cumprod_:qJ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KJ(r,t=0,n=!1,i=!1){const a={x:K(r,"x","cumsum")},l={axis:t,exclusive:n,reverse:i};return ft.runKernel(pv,a,l)}const d9=pt({cumsum_:KJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XJ(r,t,n,i=!1){const o=K(r,"x","denseBincount"),a=K(t,"weights","denseBincount");W(o.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${o.dtype}`),W(o.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${o.rank}.`),W(n>=0,()=>`size must be non-negative, but got ${n}.`),W(a.size===o.size||a.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${o.shape}, weights shape: ${a.shape}.`);const l={x:o,weights:a},c={size:n,binaryOutput:i};return ft.runKernel(G4,l,c)}const fI=pt({denseBincount_:XJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YJ(r,t,n="NHWC"){const i=K(r,"x","depthToSpace","float32"),o=n==="NHWC"?i.shape[1]:i.shape[2],a=n==="NHWC"?i.shape[2]:i.shape[3],l=n==="NHWC"?i.shape[3]:i.shape[1];W(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),W(o*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${t}  for depthToSpace with input shape
    ${i.shape}`),W(a*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${t} for depthToSpace with input shape
        ${i.shape}`),W(l%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${l} for depthToSpace with input shape ${i.shape}`);const c={x:i},u={blockSize:t,dataFormat:n};return ft.runKernel(H4,c,u)}const ZJ=pt({depthToSpace_:YJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JJ(r,t,n,i,o="NHWC",a=[1,1],l){const c=K(r,"x","depthwiseConv2d","float32"),u=K(t,"filter","depthwiseConv2d","float32");let h=c,d=!1;c.rank===3&&(d=!0,h=gt(c,[1,c.shape[0],c.shape[1],c.shape[2]])),W(h.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${h.rank}.`),W(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);const f=o==="NHWC"?h.shape[3]:h.shape[1];W(f===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${u.shape[2]}.`),si("depthwiseConv2d",i,l);const p={x:h,filter:u},m={strides:n,pad:i,dataFormat:o,dilations:a,dimRoundingMode:l},g=ft.runKernel(mv,p,m);return d?gt(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const z_=pt({depthwiseConv2d_:JJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QJ(r,t,n,i,o=[1,1],a="NHWC"){const l=K(r,"x","dilation2d"),c=K(t,"filter","dilation2d");W(l.rank===3||l.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${l.rank}.`),W(c.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${c.rank}.`),W(a==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${a}`);let u=l,h=!1;l.rank===3&&(u=gt(l,[1,l.shape[0],l.shape[1],l.shape[2]]),h=!0);const d={x:u,filter:c},f={strides:n,pad:i,dilations:o},p=ft.runKernel(gv,d,f);return h?gt(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const tQ=pt({dilation2d_:QJ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eQ(r,t){let n=K(r,"a","equal","string_or_numeric"),i=K(t,"b","equal","string_or_numeric");[n,i]=ws(n,i),qe(n.shape,i.shape);const o={a:n,b:i};return ft.runKernel(vv,o)}const Pa=pt({equal_:eQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nQ(r,t,n){const i=K(t,"a","where"),o=K(n,"b","where"),a=K(r,"condition","where","bool"),l=qe(qe(a.shape,i.shape),o.shape),c=Mp(a,l),u=Mp(i,l),h=Mp(o,l),d={condition:c,t:u,e:h};return ft.runKernel(qv,d)}const vi=pt({where_:nQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sQ(r){const n={x:K(r,"x","zerosLike")};return ft.runKernel(ey,n)}const Sn=pt({zerosLike_:sQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rQ(r,t){let n=K(r,"a","div"),i=K(t,"b","div");[n,i]=ws(n,i);const o=$e(n,i),a=Sn(o),l=Pa(i,a);return vi(l,a,o)}const iQ=pt({divNoNan_:rQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oQ(r,t){const n=K(r,"t1","dot"),i=K(t,"t2","dot");W((n.rank===1||n.rank===2)&&(i.rank===1||i.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${i.rank}.`);const o=n.rank===1?n.size:n.shape[1],a=i.rank===1?i.size:i.shape[0];if(W(o===a,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${a}.`),n.rank===1&&i.rank===1){const l=gt(n,[1,-1]),c=gt(i,[-1,1]),u=Nn(l,c);return gt(u,[])}else if(n.rank===1&&i.rank===2){const l=gt(n,[1,-1]),c=gt(i,[i.shape[0],i.shape[1]]),u=Nn(l,c);return gt(u,[u.size])}else if(n.rank===2&&i.rank===1){const l=gt(i,[-1,1]),c=Nn(n,l);return gt(c,[c.size])}else{const l=gt(i,[i.shape[0],i.shape[1]]);return Nn(n,l)}}const aQ=pt({dot_:oQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lQ(r){const n={x:K(r,"x","elu","float32")};return ft.runKernel(zm,n)}const ly=pt({elu_:lQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cQ(r){let t=K(r,"x","erf");W(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=de(t,"float32"));const n={x:t};return ft.runKernel(Vm,n)}const uQ=pt({erf_:cQ});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V_(r,t){for(let n=0;n<r.length;++n)if(r[r.length-n-1]!==t-1-n)return!1;return!0}function f9(r,t,n){const i=r.length+t.length,o=[];let a=0,l=0;for(let c=0;c<i;c++)n.indexOf(c)===-1?o.push(r[a++]):o.push(t[l++]);return o}function Zs(r,t){const n=[],i=r.length;for(let a=0;a<i;a++)t.indexOf(a)===-1&&n.push(r[a]);const o=t.map(a=>r[a]);return[n,o]}function Ss(r,t){const n=t.map(i=>1);return f9(r,n,t)}function fr(r,t,n){W(V_(t,n),()=>`${r} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`)}function ms(r,t){if(V_(r,t))return null;const n=[];for(let i=0;i<t;++i)r.indexOf(i)===-1&&n.push(i);return r.forEach(i=>n.push(i)),n}function Bc(r){return r.map((t,n)=>[n,t]).sort((t,n)=>t[1]-n[1]).map(t=>t[0])}function _s(r,t){const n=[];for(let i=t-r;i<t;++i)n.push(i);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hQ(r,t=null,n=!1){const o={x:K(r,"x","max")},a={reductionIndices:t,keepDims:n};return ft.runKernel(Ev,o,a)}const Ko=pt({max_:hQ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dQ(r,t=null,n=!1){const o={x:K(r,"x","min")},a={axis:t,keepDims:n};return ft.runKernel(Dv,o,a)}const l2=pt({min_:dQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fQ(r,t){let n=K(r,"base","pow"),i=K(t,"exp","pow");[n,i]=ws(n,i);const o={a:n,b:i};return ft.runKernel(sg,o)}const Bd=pt({pow_:fQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pe(r,t){if((Fa(r)&&t!=="string"||Array.isArray(r))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&Fa(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ry(r,[],[],t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pQ(r){const n={x:K(r,"x","sqrt","float32")};return ft.runKernel(mg,n)}const Br=pt({sqrt_:pQ});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mQ(r){const t=K(r,"x","square"),n={};return ft.runKernel("Square",{x:t},n)}const jn=pt({square_:mQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gQ(r,t=null,n=!1){let i=K(r,"x","sum");i.dtype==="bool"&&(i=de(i,"int32"));const o={x:i},a={axis:t,keepDims:n};return ft.runKernel(Xv,o,a)}const we=pt({sum_:gQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vQ(r,t="euclidean",n=null,i=!1){r=K(r,"x","norm");const o=p9(r,t,n);let a=o.shape;if(i){const l=on(n,r.shape);a=Ss(o.shape,l)}return gt(o,a)}function p9(r,t,n=null){if(r.rank===0)return Ws(r);if(r.rank!==1&&n===null)return p9(gt(r,[-1]),t,n);if(r.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(t===1)return we(Ws(r),n);if(t===1/0)return Ko(Ws(r),n);if(t===-1/0)return l2(Ws(r),n);if(t==="euclidean"||t===2)return Br(we(Bd(Ws(r),Pe(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&n.length===2){if(t===1)return Ko(we(Ws(r),n[0]),n[1]-1);if(t===1/0)return Ko(we(Ws(r),n[1]),n[0]);if(t===-1/0)return l2(we(Ws(r),n[1]),n[0]);if(t==="fro"||t==="euclidean")return Br(we(jn(r),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const cy=pt({norm_:vQ});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yQ(r,t=null,n=!1){return cy(r,"euclidean",t,n)}const xQ=pt({euclideanNorm_:yQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bQ(r){const n={x:K(r,"x","exp")};return ft.runKernel(Um,n)}const bo=pt({exp_:bQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wQ(r,t=0){const n=K(r,"x","expandDims","string_or_numeric");W(t<=n.rank,()=>"Axis must be <= rank of the tensor");const i={input:n},o={dim:t};return ft.runKernel(yv,i,o)}const ui=pt({expandDims_:wQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SQ(r){const n={x:K(r,"x","expm1")};return ft.runKernel(Wm,n)}const _Q=pt({expm1_:SQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TQ(r,t){const n=K(r,"x","tile","string_or_numeric");W(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`);const i={x:n},o={reps:t};return ft.runKernel(bg,i,o)}const Wo=pt({tile_:TQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CQ(r,t,n,i="float32"){t==null&&(t=r);const o=rn([r,t],i),a=r<=t?r:t;for(let c=0;c<a;++c)o.set(1,c,c);const l=gt(o.toTensor(),[r,t]);if(n==null)return l;if(n.length===1)return Wo(ui(l,0),[n[0],1,1]);if(n.length===2)return Wo(ui(ui(l,0),0),[n[0],n[1],1,1]);if(n.length===3)return Wo(ui(ui(ui(l,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const m9=pt({eye_:CQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kQ(r){const n={x:K(r,"x","floor","float32")};return ft.runKernel(Gm,n)}const uy=pt({floor_:kQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Q(r,t,n=0,i=0){const o=K(r,"x","gather"),a=K(t,"indices","gather","int32"),l={x:o,indices:a},c={axis:n,batchDims:i};return ft.runKernel(bv,l,c)}const U_=pt({gather_:$Q});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IQ(r,t){let n=K(r,"a","greater","string_or_numeric"),i=K(t,"b","greater","string_or_numeric");[n,i]=ws(n,i),qe(n.shape,i.shape);const o={a:n,b:i};return ft.runKernel(wv,o)}const Ui=pt({greater_:IQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EQ(r,t){let n=K(r,"a","greaterEqual","string_or_numeric"),i=K(t,"b","greaterEqual","string_or_numeric");[n,i]=ws(n,i),qe(n.shape,i.shape);const o={a:n,b:i};return ft.runKernel(jm,o)}const bh=pt({greaterEqual_:EQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NQ(r){const n={x:K(r,"x","isFinite")};return ft.runKernel(Km,n)}const AQ=pt({isFinite_:NQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MQ(r){const n={x:K(r,"x","isInf")};return ft.runKernel(Xm,n)}const DQ=pt({isInf_:MQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RQ(r){const n={x:K(r,"x","isNaN")};return ft.runKernel(Ym,n)}const OQ=pt({isNaN_:RQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LQ(r,t=.2){const i={x:K(r,"x","leakyRelu")},o={alpha:t};return ft.runKernel(Sv,i,o)}const W_=pt({leakyRelu_:LQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FQ(r,t){let n=K(r,"a","less","string_or_numeric"),i=K(t,"b","less","string_or_numeric");[n,i]=ws(n,i),qe(n.shape,i.shape);const o={a:n,b:i};return ft.runKernel(_v,o)}const g9=pt({less_:FQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PQ(r,t){let n=K(r,"a","lessEqual","string_or_numeric"),i=K(t,"b","lessEqual","string_or_numeric");[n,i]=ws(n,i),qe(n.shape,i.shape);const o={a:n,b:i};return ft.runKernel(Tv,o)}const mf=pt({lessEqual_:PQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BQ(r,t=5,n=1,i=1,o=.5){const a=K(r,"x","localResponseNormalization");W(a.rank===4||a.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${a.rank}.`),W(Rd(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let l=a,c=!1;a.rank===3&&(c=!0,l=gt(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const u={x:l},h={depthRadius:t,bias:n,alpha:i,beta:o},d=ft.runKernel(Iv,u,h);return c?gt(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const zQ=pt({localResponseNormalization_:BQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VQ(r){const n={x:K(r,"x","log","float32")};return ft.runKernel(Zm,n)}const wo=pt({log_:VQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UQ(r){const n={x:K(r,"x","log1p")};return ft.runKernel(Jm,n)}const G_=pt({log1p_:UQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WQ(r,t){W(R3(r),()=>"The f passed in variableGrads(f) must be a function"),W(t==null||Array.isArray(t)&&t.every(h=>h instanceof i2),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=t!=null;if(!n){t=[];for(const h in ft.registeredVariables)t.push(ft.registeredVariables[h])}const i=n?t.filter(h=>!h.trainable):null,o=t.length;t=t.filter(h=>h.trainable),W(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);const a=!0,{value:l,grads:c}=ft.gradients(r,t,null,a);W(c.some(h=>h!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),W(l.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${l.rank} tensor`);const u={};return t.forEach((h,d)=>{c[d]!=null&&(u[h.name]=c[d])}),i!=null&&i.forEach(h=>u[h.name]=null),{value:l,grads:u}}function Xu(r){return ft.customGrad(r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GQ(r){const n={x:K(r,"x","softplus")};return ft.runKernel(pg,n)}const Cg=pt({softplus_:GQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HQ(r){const t=K(r,"x","logSigmoid");return Xu(i=>({value:fs(Cg(fs(i))),gradFunc:l=>ct(l,pf(fs(i)))}))(t)}const jQ=pt({logSigmoid_:HQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qQ(r,t){let n=K(r,"a","sub"),i=K(t,"b","sub");[n,i]=ws(n,i);const o={a:n,b:i};return ft.runKernel(vg,o)}const Se=pt({sub_:qQ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KQ(r,t=-1){const n=K(r,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return Xu((o,a)=>{const c=Ko(o,t,!0),u=Se(o,c),h=Se(de(u,"float32"),wo(we(bo(u),t,!0)));return a([h]),{value:h,gradFunc:(f,p)=>{const[m]=p,g=!0,y=bo(m);return Se(f,ct(we(f,t,g),y))}}})(n)}const v9=pt({logSoftmax_:KQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XQ(r,t=null,n=!1){const i=K(r,"x","logSumExp"),o=on(t,i.shape),a=Ko(i,o,!0),l=Se(i,a),c=bo(l),u=we(c,o),h=wo(u),d=Xt(gt(a,h.shape),h);if(n){const f=Ss(d.shape,o);return gt(d,f)}return d}const y9=pt({logSumExp_:XQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YQ(r,t){const n=K(r,"a","logicalAnd","bool"),i=K(t,"b","logicalAnd","bool");qe(n.shape,i.shape);const o={a:n,b:i};return ft.runKernel(Cv,o)}const wl=pt({logicalAnd_:YQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZQ(r){const n={x:K(r,"x","logicalNot","bool")};return ft.runKernel(kv,n)}const H_=pt({logicalNot_:ZQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JQ(r,t){const n=K(r,"a","logicalOr","bool"),i=K(t,"b","logicalOr","bool");qe(n.shape,i.shape);const o={a:n,b:i};return ft.runKernel($v,o)}const x9=pt({logicalOr_:JQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QQ(r,t){const n=K(r,"a","logicalXor","bool"),i=K(t,"b","logicalXor","bool");return qe(n.shape,i.shape),wl(x9(r,t),H_(wl(r,t)))}const ttt=pt({logicalXor_:QQ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ett(r,t,n,i,o){const a=K(r,"x","maxPool"),l=1;let c=a,u=!1;a.rank===3&&(u=!0,c=gt(a,[1,a.shape[0],a.shape[1],a.shape[2]])),W(c.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${c.rank}.`),W(_r(n,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${l}'`),si("maxPool",i,o);const h={x:c},d={filterSize:t,strides:n,pad:i,dimRoundingMode:o},f=ft.runKernel(Nv,h,d);return u?gt(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const j_=pt({maxPool_:ett});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ntt(r,t=[1,1,1],n,i,o,a="NDHWC"){const l=K(r,"x","maxPool3d");let c=l,u=!1;l.rank===4&&(u=!0,c=gt(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),W(c.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${c.rank}.`),W(a==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${a}`),si("maxPool3d",i,o);const h={x:c},d={filterSize:t,strides:n,pad:i,dimRoundingMode:o,dataFormat:a},f=ft.runKernel(Av,h,d);return u?gt(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const stt=pt({maxPool3d_:ntt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rtt(r,t){let n=K(r,"a","maximum"),i=K(t,"b","maximum");[n,i]=ws(n,i),n.dtype==="bool"&&(n=de(n,"int32"),i=de(i,"int32")),qe(n.shape,i.shape);const o={a:n,b:i};return ft.runKernel(Qm,o)}const zc=pt({maximum_:rtt});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function itt(r,t=null,n=!1){const o={x:K(r,"x","mean")},a={axis:t,keepDims:n};return ft.runKernel(Mv,o,a)}const bs=pt({mean_:itt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hs(r,t="float32"){if(El(r),t==="complex64"){const i=Hs(r,"float32"),o=Hs(r,"float32");return Ld(i,o)}const n=Sr(Nt(r),t);return ft.makeTensor(n,r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vc(r,t="float32"){if(El(r),t==="complex64"){const i=Vc(r,"float32"),o=Hs(r,"float32");return Ld(i,o)}const n=N4(Nt(r),t);return ft.makeTensor(n,r,t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ott(r,t){let n=K(r,"a","minimum"),i=K(t,"b","minimum");[n,i]=ws(n,i),n.dtype==="bool"&&(n=de(n,"int32"),i=de(i,"int32")),qe(n.shape,i.shape);const o={a:n,b:i};return ft.runKernel(tg,o)}const hy=pt({minimum_:ott});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function att(r,t,n){W(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const i=K(r,"x","mirrorPad");if(i.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");W(t.length===i.rank,()=>`Padding doesn't match input. Must be ${i.rank}. Got ${t.length}.`);const o=n==="reflect"?1:0;for(let c=0;c<i.rank;c++)W(t[c].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),W(t[c][0]>=0&&t[c][0]<=i.shape[c]-o&&t[c][1]>=0&&t[c][1]<=i.shape[c]-o,()=>`Padding in dimension ${c} cannot be greater than or equal to ${i.shape[c]-o} or less than 0 for input of shape ${i.shape}`);const a={paddings:t,mode:n},l={x:i};return ft.runKernel(Rv,l,a)}const ltt=pt({mirrorPad_:att});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ctt(r,t){let n=K(r,"a","mod"),i=K(t,"b","mod");[n,i]=ws(n,i);const o={a:n,b:i};return ft.runKernel(eg,o)}const utt=pt({mod_:ctt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function htt(r,t=null,n=!1){r=K(r,"x","moments");const i=on(t,r.shape),o=bs(r,i,n);let a=o.shape;n||(a=Ss(o.shape,i));const l=jn(Se(de(r,"float32"),gt(o,a))),c=bs(l,i,n);return{mean:o,variance:c}}const q_=pt({moments_:htt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dtt(r,t){let n=K(r,"a","notEqual","string_or_numeric"),i=K(t,"b","notEqual","string_or_numeric");[n,i]=ws(n,i),qe(n.shape,i.shape);const o={a:n,b:i};return ft.runKernel(Lv,o)}const Yp=pt({notEqual_:dtt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ftt(r){const n={x:K(r,"x","onesLike")};return ft.runKernel(Fv,n)}const So=pt({onesLike_:ftt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ptt(r,t,n=0){const i=K(r,"x","pad");if(i.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const o={paddings:t,constantValue:n},a={x:i};return ft.runKernel(zv,a,o)}const K_=pt({pad_:ptt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mtt(r,t,n){const i=K(r,"x","spaceToBatchND");W(i.rank>=1+t.length,()=>`input rank ${i.rank} should be > than [blockShape] ${t.length}`),W(n.length===t.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`),W(i.shape.reduce((l,c,u)=>u>0&&u<=t.length?l&&(c+n[u-1][0]+n[u-1][1])%t[u-1]===0:l,!0),()=>`input spatial dimensions ${i.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`);const o={x:i},a={blockShape:t,paddings:n};return ft.runKernel(Yv,o,a)}const X_=pt({spaceToBatchND_:mtt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gtt(r,t,n,i,o,a,l){o==null&&(o=[1,1]),a==null&&(a=1),i===0&&(i="valid");const c=K(r,"x","maxPool");let u=c,h=!1;c.rank===3&&(h=!0,u=gt(c,[1,c.shape[0],c.shape[1],c.shape[2]])),W(_r(a,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${a} and dilations '${o}'`);const d=ko(u.shape,t,a,o,i),f=[d.dilationHeight,d.dilationWidth];let p;i==="same"?p=ytt([d.filterHeight,d.filterWidth],f):p=[[0,0],[0,0]];const m=f[0]===1&&f[1]===1,[g,y]=vtt([d.inHeight,d.inWidth],f,p),v=m?i:"valid",x=m?u:X_(u,f,g),w=(n==="avg"?()=>O_(x,t,a,v,l):()=>j_(x,t,a,v,l))(),S=m?w:F_(w,f,y);return h?gt(S,[S.shape[1],S.shape[2],S.shape[3]]):S}function vtt(r,t,n){const i=n.map(d=>d[0]),o=n.map(d=>d[1]),a=r.concat(i,o),l=t.map((d,f)=>(d-a[f]%d)%d),c=o.map((d,f)=>d+l[f]),u=t.map((d,f)=>[i[f],c[f]]),h=t.map((d,f)=>[0,l[f]]);return[u,h]}function ytt(r,t){const i=r.map((l,c)=>l+(l-1)*(t[c]-1)).map(l=>l-1),o=i.map(l=>Math.floor(l/2)),a=i.map((l,c)=>l-o[c]);return i.map((l,c)=>[o[c],a[c]])}const xtt=pt({pool_:gtt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function btt(r,t){const n=K(r,"x","prelu"),i=K(t,"alpha","prelu"),o={x:n,alpha:i};return ft.runKernel(Vv,o)}const Y_=pt({prelu_:btt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wtt(r,t=null,n=!1){let i=K(r,"x","prod");i.dtype==="bool"&&(i=de(i,"int32"));const o={x:i},a={axis:t,keepDims:n};return ft.runKernel(Uv,o,a)}const Stt=pt({prod_:wtt});var tw={},_tt={get exports(){return tw},set exports(r){tw=r}};(function(r){(function(t,n,i){function o(u){var h=this,d=c();h.next=function(){var f=2091639*h.s0+h.c*23283064365386963e-26;return h.s0=h.s1,h.s1=h.s2,h.s2=f-(h.c=f|0)},h.c=1,h.s0=d(" "),h.s1=d(" "),h.s2=d(" "),h.s0-=d(u),h.s0<0&&(h.s0+=1),h.s1-=d(u),h.s1<0&&(h.s1+=1),h.s2-=d(u),h.s2<0&&(h.s2+=1),d=null}function a(u,h){return h.c=u.c,h.s0=u.s0,h.s1=u.s1,h.s2=u.s2,h}function l(u,h){var d=new o(u),f=h&&h.state,p=d.next;return p.int32=function(){return d.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,f&&(typeof f=="object"&&a(f,d),p.state=function(){return a(d,{})}),p}function c(){var u=4022871197,h=function(d){d=String(d);for(var f=0;f<d.length;f++){u+=d.charCodeAt(f);var p=.02519603282416938*u;u=p>>>0,p-=u,p*=u,u=p>>>0,p-=u,u+=p*4294967296}return(u>>>0)*23283064365386963e-26};return h}n&&n.exports?n.exports=l:i&&i.amd?i(function(){return l}):this.alea=l})(Ea,r,!1)})(_tt);var ew={},Ttt={get exports(){return ew},set exports(r){ew=r}};(function(r){(function(t,n,i){function o(c){var u=this,h="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},c===(c|0)?u.x=c:h+=c;for(var d=0;d<h.length+64;d++)u.x^=h.charCodeAt(d)|0,u.next()}function a(c,u){return u.x=c.x,u.y=c.y,u.z=c.z,u.w=c.w,u}function l(c,u){var h=new o(c),d=u&&u.state,f=function(){return(h.next()>>>0)/4294967296};return f.double=function(){do var p=h.next()>>>11,m=(h.next()>>>0)/4294967296,g=(p+m)/(1<<21);while(g===0);return g},f.int32=h.next,f.quick=f,d&&(typeof d=="object"&&a(d,h),f.state=function(){return a(h,{})}),f}n&&n.exports?n.exports=l:i&&i.amd?i(function(){return l}):this.xor128=l})(Ea,r,!1)})(Ttt);var nw={},Ctt={get exports(){return nw},set exports(r){nw=r}};(function(r){(function(t,n,i){function o(c){var u=this,h="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,c===(c|0)?u.x=c:h+=c;for(var d=0;d<h.length+64;d++)u.x^=h.charCodeAt(d)|0,d==h.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function a(c,u){return u.x=c.x,u.y=c.y,u.z=c.z,u.w=c.w,u.v=c.v,u.d=c.d,u}function l(c,u){var h=new o(c),d=u&&u.state,f=function(){return(h.next()>>>0)/4294967296};return f.double=function(){do var p=h.next()>>>11,m=(h.next()>>>0)/4294967296,g=(p+m)/(1<<21);while(g===0);return g},f.int32=h.next,f.quick=f,d&&(typeof d=="object"&&a(d,h),f.state=function(){return a(h,{})}),f}n&&n.exports?n.exports=l:i&&i.amd?i(function(){return l}):this.xorwow=l})(Ea,r,!1)})(Ctt);var sw={},ktt={get exports(){return sw},set exports(r){sw=r}};(function(r){(function(t,n,i){function o(c){var u=this;u.next=function(){var d=u.x,f=u.i,p,m;return p=d[f],p^=p>>>7,m=p^p<<24,p=d[f+1&7],m^=p^p>>>10,p=d[f+3&7],m^=p^p>>>3,p=d[f+4&7],m^=p^p<<7,p=d[f+7&7],p=p^p<<13,m^=p^p<<9,d[f]=m,u.i=f+1&7,m};function h(d,f){var p,m=[];if(f===(f|0))m[0]=f;else for(f=""+f,p=0;p<f.length;++p)m[p&7]=m[p&7]<<15^f.charCodeAt(p)+m[p+1&7]<<13;for(;m.length<8;)m.push(0);for(p=0;p<8&&m[p]===0;++p);for(p==8?m[7]=-1:m[p],d.x=m,d.i=0,p=256;p>0;--p)d.next()}h(u,c)}function a(c,u){return u.x=c.x.slice(),u.i=c.i,u}function l(c,u){c==null&&(c=+new Date);var h=new o(c),d=u&&u.state,f=function(){return(h.next()>>>0)/4294967296};return f.double=function(){do var p=h.next()>>>11,m=(h.next()>>>0)/4294967296,g=(p+m)/(1<<21);while(g===0);return g},f.int32=h.next,f.quick=f,d&&(d.x&&a(d,h),f.state=function(){return a(h,{})}),f}n&&n.exports?n.exports=l:i&&i.amd?i(function(){return l}):this.xorshift7=l})(Ea,r,!1)})(ktt);var rw={},$tt={get exports(){return rw},set exports(r){rw=r}};(function(r){(function(t,n,i){function o(c){var u=this;u.next=function(){var d=u.w,f=u.X,p=u.i,m,g;return u.w=d=d+1640531527|0,g=f[p+34&127],m=f[p=p+1&127],g^=g<<13,m^=m<<17,g^=g>>>15,m^=m>>>12,g=f[p]=g^m,u.i=p,g+(d^d>>>16)|0};function h(d,f){var p,m,g,y,v,x=[],b=128;for(f===(f|0)?(m=f,f=null):(f=f+"\0",m=0,b=Math.max(b,f.length)),g=0,y=-32;y<b;++y)f&&(m^=f.charCodeAt((y+32)%f.length)),y===0&&(v=m),m^=m<<10,m^=m>>>15,m^=m<<4,m^=m>>>13,y>=0&&(v=v+1640531527|0,p=x[y&127]^=m+v,g=p==0?g+1:0);for(g>=128&&(x[(f&&f.length||0)&127]=-1),g=127,y=4*128;y>0;--y)m=x[g+34&127],p=x[g=g+1&127],m^=m<<13,p^=p<<17,m^=m>>>15,p^=p>>>12,x[g]=m^p;d.w=v,d.X=x,d.i=g}h(u,c)}function a(c,u){return u.i=c.i,u.w=c.w,u.X=c.X.slice(),u}function l(c,u){c==null&&(c=+new Date);var h=new o(c),d=u&&u.state,f=function(){return(h.next()>>>0)/4294967296};return f.double=function(){do var p=h.next()>>>11,m=(h.next()>>>0)/4294967296,g=(p+m)/(1<<21);while(g===0);return g},f.int32=h.next,f.quick=f,d&&(d.X&&a(d,h),f.state=function(){return a(h,{})}),f}n&&n.exports?n.exports=l:i&&i.amd?i(function(){return l}):this.xor4096=l})(Ea,r,!1)})($tt);var iw={},Itt={get exports(){return iw},set exports(r){iw=r}};(function(r){(function(t,n,i){function o(c){var u=this,h="";u.next=function(){var f=u.b,p=u.c,m=u.d,g=u.a;return f=f<<25^f>>>7^p,p=p-m|0,m=m<<24^m>>>8^g,g=g-f|0,u.b=f=f<<20^f>>>12^p,u.c=p=p-m|0,u.d=m<<16^p>>>16^g,u.a=g-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,c===Math.floor(c)?(u.a=c/4294967296|0,u.b=c|0):h+=c;for(var d=0;d<h.length+20;d++)u.b^=h.charCodeAt(d)|0,u.next()}function a(c,u){return u.a=c.a,u.b=c.b,u.c=c.c,u.d=c.d,u}function l(c,u){var h=new o(c),d=u&&u.state,f=function(){return(h.next()>>>0)/4294967296};return f.double=function(){do var p=h.next()>>>11,m=(h.next()>>>0)/4294967296,g=(p+m)/(1<<21);while(g===0);return g},f.int32=h.next,f.quick=f,d&&(typeof d=="object"&&a(d,h),f.state=function(){return a(h,{})}),f}n&&n.exports?n.exports=l:i&&i.amd?i(function(){return l}):this.tychei=l})(Ea,r,!1)})(Itt);var ow={},Ett={get exports(){return ow},set exports(r){ow=r}};const Ntt={},Att=Object.freeze(Object.defineProperty({__proto__:null,default:Ntt},Symbol.toStringTag,{value:"Module"})),Mtt=rW(Att);(function(r){(function(t,n,i){var o=256,a=6,l=52,c="random",u=i.pow(o,a),h=i.pow(2,l),d=h*2,f=o-1,p;function m(S,_,$){var N=[];_=_==!0?{entropy:!0}:_||{};var k=x(v(_.entropy?[S,w(n)]:S??b(),3),N),I=new g(N),O=function(){for(var B=I.g(a),F=u,D=0;B<h;)B=(B+D)*o,F*=o,D=I.g(1);for(;B>=d;)B/=2,F/=2,D>>>=1;return(B+D)/F};return O.int32=function(){return I.g(4)|0},O.quick=function(){return I.g(4)/4294967296},O.double=O,x(w(I.S),n),(_.pass||$||function(B,F,D,L){return L&&(L.S&&y(L,I),B.state=function(){return y(I,{})}),D?(i[c]=B,F):B})(O,k,"global"in _?_.global:this==i,_.state)}function g(S){var _,$=S.length,N=this,k=0,I=N.i=N.j=0,O=N.S=[];for($||(S=[$++]);k<o;)O[k]=k++;for(k=0;k<o;k++)O[k]=O[I=f&I+S[k%$]+(_=O[k])],O[I]=_;(N.g=function(B){for(var F,D=0,L=N.i,V=N.j,j=N.S;B--;)F=j[L=f&L+1],D=D*o+j[f&(j[L]=j[V=f&V+F])+(j[V]=F)];return N.i=L,N.j=V,D})(o)}function y(S,_){return _.i=S.i,_.j=S.j,_.S=S.S.slice(),_}function v(S,_){var $=[],N=typeof S,k;if(_&&N=="object")for(k in S)try{$.push(v(S[k],_-1))}catch{}return $.length?$:N=="string"?S:S+"\0"}function x(S,_){for(var $=S+"",N,k=0;k<$.length;)_[f&k]=f&(N^=_[f&k]*19)+$.charCodeAt(k++);return w(_)}function b(){try{var S;return p&&(S=p.randomBytes)?S=S(o):(S=new Uint8Array(o),(t.crypto||t.msCrypto).getRandomValues(S)),w(S)}catch{var _=t.navigator,$=_&&_.plugins;return[+new Date,t,$,t.screen,w(n)]}}function w(S){return String.fromCharCode.apply(0,S)}if(x(i.random(),n),r.exports){r.exports=m;try{p=Mtt}catch{}}else i["seed"+c]=m})(typeof self<"u"?self:Ea,[],Math)})(Ett);var Dtt=tw,Rtt=ew,Ott=nw,Ltt=sw,Ftt=rw,Ptt=iw,wh=ow;wh.alea=Dtt;wh.xor128=Rtt;wh.xorwow=Ott;wh.xorshift7=Ltt;wh.xor4096=Ftt;wh.tychei=Ptt;var gf=wh;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let b9=class{constructor(t,n,i,o,a){this.mean=t,this.stdDev=n,this.dtype=i,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const l=a||Math.random();this.random=gf.alea(l.toString())}nextValue(){if(!isNaN(this.nextVal)){const o=this.nextVal;return this.nextVal=NaN,o}let t,n,i=!1;for(;!i;){let o,a,l;do o=2*this.random()-1,a=2*this.random()-1,l=o*o+a*a;while(l>=1||l===0);const c=Math.sqrt(-2*Math.log(l)/l);t=this.mean+this.stdDev*o*c,n=this.mean+this.stdDev*a*c,(!this.truncated||this.isValidTruncated(t))&&(i=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}},Btt=class{constructor(t=0,n=1,i,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=n-t,this.dtype=i,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${n} <= 1 and dtype is not float`);this.random=gf.alea(o)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ztt(r,t=0,n=1,i,o){if(El(r),i!=null&&i==="bool")throw new Error(`Unsupported data type ${i}`);const a=new b9(t,n,i,!1,o),l=rn(r,i);for(let c=0;c<l.values.length;c++)l.values[c]=a.nextValue();return l.toTensor()}const Vtt=pt({randomNormal_:ztt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Utt(r,t=0,n=1,i="float32",o){El(r);const a=rn(r,i),l=new Btt(t,n,null,o);for(let c=0;c<a.values.length;c++)a.values[c]=l.nextValue();return a.toTensor()}const dy=pt({randomUniform_:Utt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zp(r,t,n=1,i="float32"){if(n===0)throw new Error("Cannot have a step of zero");const o={start:r,stop:t,step:n,dtype:i};return ft.runKernel(o_,{},o)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wtt(r){const n={x:K(r,"x","reciprocal")};return ft.runKernel(rg,n)}const Gtt=pt({reciprocal_:Wtt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Htt(r){const n={x:K(r,"x","relu")};return ft.runKernel(ig,n)}const Ml=pt({relu_:Htt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jtt(r){const n={x:K(r,"x","relu6")};return ft.runKernel(og,n)}const w9=pt({relu6_:jtt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qtt(r,t){const i={x:K(r,"x","reverse")},o={dims:t};return ft.runKernel(jv,i,o)}const Yu=pt({reverse_:qtt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ktt(r){const n={x:K(r,"x","round")};return ft.runKernel(ag,n)}const S9=pt({round_:Ktt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xtt(r){const n={x:K(r,"x","rsqrt","float32")};return ft.runKernel(lg,n)}const _9=pt({rsqrt_:Xtt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ytt(r){const n={x:K(r,"x","selu")};return ft.runKernel(cg,n)}const T9=pt({selu_:Ytt});function Ztt(r,t,n,i,o,a=[1,1],l="NHWC"){const c=K(r,"x","separableConv2d"),u=K(t,"depthwiseFilter","separableConv2d"),h=K(n,"pointwiseFilter","separableConv2d");let d=c,f=!1;if(c.rank===3&&(f=!0,d=gt(c,[1,c.shape[0],c.shape[1],c.shape[2]])),l==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");W(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),W(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),W(h.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),W(h.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${h.shape[0]}.`),W(h.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${h.shape[1]}.`);const p=u.shape[2],m=u.shape[3];W(h.shape[2]===p*m,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*m}, but got ${h.shape[2]}.`);const g=z_(d,u,i,o,l,a),v=Ku(g,h,1,"valid",l);return f?gt(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const C9=pt({separableConv2d_:Ztt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jtt(r){const n={x:K(r,"x","sign")};return ft.runKernel(dg,n)}const Qtt=pt({sign_:Jtt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tet(r){const n={x:K(r,"x","sin","float32")};return ft.runKernel(ug,n)}const k9=pt({sin_:tet});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eet(r){const n={x:K(r,"x","sinh")};return ft.runKernel(hg,n)}const $9=pt({sinh_:eet});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function net(r,t,n){const i=K(r,"x","slice1d");return W(i.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${i.rank} tensor`),Fn(i,[t],[n])}const Z_=pt({slice1d_:net});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function set(r,t,n){const i=K(r,"x","slice2d");return W(i.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${i.rank} tensor`),Fn(i,t,n)}const I9=pt({slice2d_:set});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ret(r,t,n){const i=K(r,"x","slice3d");return W(i.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${i.rank} tensor`),Fn(i,t,n)}const J_=pt({slice3d_:ret});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iet(r,t,n){const i=K(r,"x","slice4d");return W(i.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${i.rank} tensor`),Fn(i,t,n)}const c2=pt({slice4d_:iet});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oet(r,t=-1){const n=K(r,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);const i={logits:n},o={dim:t};return ft.runKernel(Jv,i,o)}const Q_=pt({softmax_:oet});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aet(r){W(r.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${r.dtype}.`);const t={input:r};return ft.runKernel(X4,t)}const E9=pt({fft_:aet});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cet(r){W(r.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${r.dtype}.`);const t={input:r};return ft.runKernel(J4,t)}const aw=pt({ifft_:cet});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uet(r){const t=r.shape[r.shape.length-1],n=r.size/t;let i;if(t<=2){const o=gt(r,[n,t]);i=aw(o)}else{const o=[n,2*(t-1)],a=gt(o2(r),[n,t]),l=gt($_(r),[n,t]),c=Yu(Fn(a,[0,1],[n,t-2]),1),u=ct(Yu(Fn(l,[0,1],[n,t-2]),1),Pe(-1)),h=br([a,c],1),d=br([l,u],1),f=gt(Ld(h,d),[o[0],o[1]]);i=aw(f)}if(i=o2(i),r.rank===3&&r.shape[0]!==0){const o=i,a=r.shape[0];i=gt(i,[a,i.shape[0]/a,i.shape[1]]),o.dispose()}return i}const het=pt({irfft_:uet});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function det(r,t,n=0){const o={x:K(r,"x","split")},a={numOrSizeSplits:t,axis:n};return ft.runKernel(Zv,o,a)}const Li=pt({split_:det});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fet(r,t){W(r.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${r.dtype}`);let n=r.shape[r.shape.length-1];const i=r.size/n;let o;if(t!=null&&t<n){const g=r.shape.map(v=>0),y=r.shape.map(v=>v);y[r.shape.length-1]=t,o=Fn(r,g,y),n=t}else if(t!=null&&t>n){const g=r.shape.map(y=>y);g[r.shape.length-1]=t-n,o=br([r,Hs(g)],r.shape.length-1),n=t}else o=r;const a=Sn(o),l=gt(Ld(o,a),[i,n]),c=E9(l),u=Math.floor(n/2)+1,h=o2(c),d=$_(c),f=Li(h,[u,n-u],h.shape.length-1),p=Li(d,[u,n-u],d.shape.length-1),m=o.shape.slice();return m[o.shape.length-1]=u,gt(Ld(f[0],p[0]),m)}const N9=pt({rfft_:fet});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pet(r,t){let n=K(r,"a","squaredDifference"),i=K(t,"b","squaredDifference");[n,i]=ws(n,i),qe(n.shape,i.shape);const o={a:n,b:i},a={};return ft.runKernel(gg,o,a)}const A9=pt({squaredDifference_:pet});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function met(r,t){const n=K(r,"x","squeeze","string_or_numeric");return gt(n,Lc(n.shape,t).newShape)}const kg=pt({squeeze_:met});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function get(r,t=0){const n=PR(r,"tensors","stack","string_or_numeric");W(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&W(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");const i=n,o={axis:t};return ft.runKernel(Bv,i,o)}const _c=pt({stack_:get});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vet(r,t=0){const i={x:K(r,"x","step")},o={alpha:t};return ft.runKernel(wg,i,o)}const $g=pt({step_:vet});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yet(r,t,n,i,o=0,a=0,l=0,c=0,u=0){const d={x:K(r,"x","stridedSlice","string_or_numeric")},f={begin:t,end:n,strides:i,beginMask:o,endMask:a,ellipsisMask:l,newAxisMask:c,shrinkAxisMask:u};return ft.runKernel(m_,d,f)}const xet=pt({stridedSlice_:yet});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bet(r){const n={x:K(r,"x","tan","float32")};return ft.runKernel(yg,n)}const wet=pt({tan_:bet});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pi(r,t){eR(r);const n=sy(r,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ry(r,null,n,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T1(r,t,n){if(eR(r),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const i=sy(r,n);if(i.length!==2&&i.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(i.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ry(r,t,i,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _et(r,t=1,n=!0){const i=K(r,"x","topk");if(i.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const o=i.shape[i.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${t}`);const a={x:i},l={k:t,sorted:n},[c,u]=ft.runKernel(x_,a,l);return{values:c,indices:u}}const Tet=pt({topk_:_et});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cet(r,t=0,n=1,i,o){if(El(r),i!=null&&i==="bool")throw new Error("Unsupported data type $ { dtype }");const a=new b9(t,n,i,!0,o),l=rn(r,i);for(let c=0;c<l.values.length;c++)l.values[c]=a.nextValue();return l.toTensor()}const M9=pt({truncatedNormal_:Cet});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ket(r,t=0){const n=K(r,"x","unique","string_or_numeric");W(n.rank>0,()=>"The input tensor must be at least 1D");const i={x:n},o={axis:t},[a,l]=ft.runKernel(w_,i,o);return{values:a,indices:l}}const $et=pt({unique_:ket});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iet(r,t,n){const i=K(r,"x","unsortedSegmentSum"),o=K(t,"segmentIds","unsortedSegmentSum","int32");W(Rd(n),()=>"numSegments must be of dtype int");const a={x:i,segmentIds:o},l={numSegments:n};return ft.runKernel(ty,a,l)}const D9=pt({unsortedSegmentSum_:Iet});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eet(r,t=0){const n=K(r,"x","unstack","string_or_numeric");W(t>=-n.shape.length&&t<n.shape.length,()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`);const i={value:n},o={axis:t};return ft.runKernel(Qv,i,o)}const Zu=pt({unstack_:Eet});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Net(r,t=!0,n,i){return ft.makeVariable(r,t,n,i)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R9(r,t){const n=[];for(let a=0;a<t.length;a++)t[a]&&n.push(a);const i=rn(r,"int32"),o=rn([n.length,r.length],"int32");for(let a=0;a<n.length;a++){const l=i.indexToLoc(n[a]),c=a*r.length;o.values.set(l,c)}return o.toTensor()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aet(r,t){if(t==null)return r.shape.slice();if(An(r.shape,t))return t;if(r.shape.length===t.length){const n=[];for(let i=0;i<r.shape.length;i++)t[i]==null&&r.shape[i]!=null?n.push(r.shape[i]):n.push(t[i]);return n}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Met(r,t,n,i){const o=K(r,"x","dropout");if(W(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),W(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return r instanceof Cs?o.clone():o;const a=Aet(o,n),l=1-t,c=$e(uy(Xt(dy(a,0,1,"float32",i),l)),l);return ct(o,c)}const Det=pt({dropout_:Met});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ret(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function O9(r,t,n){const i=1-r%2,o=new Float32Array(r);for(let a=0;a<r;++a){const l=2*Math.PI*a/(r+i-1);o[a]=t-n*Math.cos(l)}return pi(o,"float32")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oet(r,t,n,i,o,a="NHWC",l){let c=r;r.rank===3&&(c=gt(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=t;u.rank===3&&(u=gt(t,[1,t.shape[0],t.shape[1],t.shape[2]])),W(c.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${c.shape}.`),W(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),W(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const h=a==="NHWC"?c.shape[3]:c.shape[1],d=a==="NHWC"?u.shape[3]:u.shape[1];W(h===n[2],()=>`Error in conv2dDerFilter: depth of input ${h}) must match input depth in filter (${n[2]}.`),W(d===n[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${n[3]}).`),si("conv2dDerFilter",o,l);const f={x:c,dy:u},p={strides:i,pad:o,dataFormat:a,dimRoundingMode:l,filterShape:n};return ft.runKernel(B4,f,p)}const tT=pt({conv2DBackpropFilter_:Oet});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eT(r,t,n){if(n==null||n==="linear")return r;if(n==="relu")return ct(r,$g(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function nT(r,t){let n=t;const i=Fs(r.shape,t.shape);return i.length>0&&(n=we(n,i)),gt(n,r.shape)}function sT(r,t,n,i){if(t==="linear")return r;if(t==="relu")return Ml(r);if(t==="elu")return ly(r);if(t==="relu6")return w9(r);if(t==="prelu")return Y_(r,n);if(t==="leakyrelu")return W_(r,i);if(t==="sigmoid")return pf(r);throw new Error(`Unknown fused activation ${t}.`)}const rT=(r,t)=>!(r>0)||t==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Let({x:r,filter:t,strides:n,pad:i,dataFormat:o="NHWC",dilations:a=[1,1],dimRoundingMode:l,bias:c,activation:u="linear",preluActivationWeights:h,leakyreluAlpha:d}){if(u=u||"linear",rT(ft.state.gradientDepth,u)===!1){W(o==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${o} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let $=Ku(r,t,n,i,o,a,l);return c!=null&&($=Xt($,c)),sT($,u,h,d)}const f=K(r,"x","conv2d","float32"),p=K(t,"filter","conv2d","float32");let m=f,g=!1;f.rank===3&&(g=!0,m=gt(f,[1,f.shape[0],f.shape[1],f.shape[2]])),W(m.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${m.rank}.`),W(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),si("fused conv2d",i,l);const y=o==="NHWC"?m.shape[3]:m.shape[1];W(p.shape[2]===y,()=>`Error in conv2d: depth of input (${y}) must match input depth for filter ${p.shape[2]}.`),W(_r(n,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`);const v=dr(m.shape,p.shape,n,a,i,l);let x;c!=null&&(x=K(c,"bias","fused conv2d"),[x]=ws(x,f),o==="NHWC"?qe(v.outShape,x.shape):(W(x.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${x.shape.length}.`),W(x.shape.length===0||x.shape[0]===v.outChannels||x.shape[0]===1,()=>`Error in fused conv2d: bias shape (${x.shape}) is not compatible with the number of output channels (${v.outChannels})`)));let b;if(h!=null){const $=h.shape;if(W($.length<=1||$.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${$.length}.`),$.length===1)W($[0]===1||$[0]===v.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the number of output channels (${v.outChannels}).`);else if($.length===3)try{qe($,v.outShape)}catch{const k=`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the output shape of the conv2d (${v.outShape}).`;throw Error(k)}b=K(h,"prelu weights","fused conv2d")}const w=($,N)=>{W(o==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${o} but only NHWC is currently supported.`);const[k,I,O,B]=N,F=eT($,O,u);W(qu(a),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`);const D=P_(I.shape,F,k,n,i),L=tT(I,F,k.shape,n,i),V=[D,L];if(B!=null){const j=nT(B,F);V.push(j)}return V},S={x:m,filter:p,bias:x,preluActivationWeights:b},_={strides:n,pad:i,dataFormat:o,dilations:a,dimRoundingMode:l,activation:u,leakyreluAlpha:d};return c==null?Xu((N,k,I)=>{let O=ft.runKernel(n2,S,_);return I([k,N,O]),g&&(O=gt(O,[O.shape[1],O.shape[2],O.shape[3]])),{value:O,gradFunc:w}})(m,p):Xu((N,k,I,O)=>{let B=ft.runKernel(n2,S,_);return O([k,N,B,I]),g&&(B=gt(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:w}})(m,p,x)}const Fet=pt({fusedConv2d_:Let});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pet(r,t,n,i,o,a=[1,1],l){let c=r;r.rank===3&&(c=gt(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=t;u.rank===3&&(u=gt(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const h={x:c,dy:u},d={strides:i,pad:o,dimRoundingMode:l,dilations:a,filterShape:n};return ft.runKernel(j4,h,d)}const Bet=pt({depthwiseConv2dNativeBackpropFilter_:Pet});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zet(r,t,n,i,o,a=[1,1],l){let c=t,u=!1;t.rank===3&&(u=!0,c=gt(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const h={dy:c,filter:n},d={strides:i,pad:o,dimRoundingMode:l,dilations:a,inputShape:r},f=ft.runKernel(q4,h,d);return u?gt(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Vet=pt({depthwiseConv2dNativeBackpropInput_:zet});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uet({a:r,b:t,transposeA:n=!1,transposeB:i=!1,bias:o,activation:a="linear",preluActivationWeights:l,leakyreluAlpha:c=.2}){if(rT(ft.state.gradientDepth,a)===!1){let B=Nn(r,t,n,i);return o!=null&&(B=Xt(B,o)),sT(B,a,l,c)}let u=K(r,"a","fused matMul"),h=K(t,"b","fused matMul");[u,h]=ws(u,h);const d=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=i?h.shape[h.rank-1]:h.shape[h.rank-2],p=n?u.shape[u.rank-1]:u.shape[u.rank-2],m=i?h.shape[h.rank-2]:h.shape[h.rank-1],g=u.shape.slice(0,-2),y=h.shape.slice(0,-2),v=Nt(g),x=Nt(y);W(d===f,()=>`Error in fused matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${u.shape} and ${h.shape} and transposeA=${n} and transposeB=${i} must match.`);const w=qe(u.shape.slice(0,-2),h.shape.slice(0,-2)).concat([p,m]),S=n?gt(u,[v,d,p]):gt(u,[v,p,d]),_=i?gt(h,[x,m,f]):gt(h,[x,f,m]);let $;o!=null&&($=K(o,"bias","fused matMul"),[$]=ws($,u),qe(w,$.shape));let N;l!=null&&(N=K(l,"prelu weights","fused matMul"));const k=(B,F)=>{const[D,L,V,j]=F,Y=eT(gt(B,V.shape),V,a);let H,et;if(!n&&!i?(H=Nn(Y,L,!1,!0),et=Nn(D,Y,!0,!1)):!n&&i?(H=Nn(Y,L,!1,!1),et=Nn(Y,D,!0,!1)):n&&!i?(H=Nn(L,Y,!1,!0),et=Nn(D,Y,!1,!1)):(H=Nn(L,Y,!0,!0),et=Nn(Y,D,!0,!0)),o!=null){const it=nT(j,Y);return[H,et,it]}else return[H,et]},I={a:S,b:_,bias:$,preluActivationWeights:N},O={transposeA:n,transposeB:i,activation:a,leakyreluAlpha:c};return o==null?Xu((F,D,L)=>{const V=ft.runKernel(e2,I,O);return L([F,D,V]),{value:gt(V,w),gradFunc:k}})(S,_):Xu((F,D,L,V)=>{const j=ft.runKernel(e2,I,O);return V([F,D,j,L]),{value:gt(j,w),gradFunc:k}})(S,_,$)}const pI=pt({fusedMatMul_:Uet});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wet(r){return O9(r,.54,.46)}const fFt=pt({hammingWindow_:Wet});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Get(r){return O9(r,.5,.5)}const Het=pt({hannWindow_:Get});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jet(r,t,n,i=!1,o=0){let a=0;const l=[];for(;a+t<=r.size;)l.push(Fn(r,a,t)),a+=n;if(i)for(;a<r.size;){const c=a+t-r.size,u=br([Fn(r,a,t-c),Tg([c],o)]);l.push(u),a+=n}return l.length===0?T1([],[0,t]):gt(br(l),[l.length,t])}const qet=pt({frame_:jet});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ket(r,t,n,i,o=Het){i==null&&(i=Ret(t));const a=qet(r,t,n),l=ct(a,o(t));return N9(l,i)}const pFt=pt({stft_:Ket});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xet(r,t,n,i,o="bilinear",a=0){const l=K(r,"image","cropAndResize"),c=K(t,"boxes","cropAndResize","float32"),u=K(n,"boxInd","cropAndResize","int32"),h=c.shape[0];W(l.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${l.rank}.`),W(c.rank===2&&c.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${h},4] but had shape ${c.shape}.`),W(u.rank===1&&u.shape[0]===h,()=>`Error in cropAndResize: boxInd must be have size [${h}] but had shape ${c.shape}.`),W(i.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${i.length}.`),W(i[0]>=1&&i[1]>=1,()=>`cropSize must be atleast [1,1], but was ${i}`),W(o==="bilinear"||o==="nearest",()=>`method must be bilinear or nearest, but was ${o}`);const d={image:l,boxes:c,boxInd:u},f={method:o,extrapolationValue:a,cropSize:i};return ft.runKernel(W4,d,f)}const Yet=pt({cropAndResize_:Xet});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zet(r){const t=K(r,"image","flipLeftRight","float32");W(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);const n={image:t};return ft.runKernel(Z4,n,{})}const Jet=pt({flipLeftRight_:Zet});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qet(r){const t=K(r,"image","grayscaleToRGB"),n=t.rank-1,i=t.shape[n];W(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),W(i===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${i}.`);const o=new Array(t.rank);return o.fill(1,0,n),o[n]=3,Wo(t,o)}const tnt=pt({grayscaleToRGB_:Qet});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ent(r,t,n=0,i=.5){const o=K(r,"image","rotateWithOffset","float32");W(o.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${o.rank}.`);const a={image:o},l={radians:t,fillValue:n,center:i};return ft.runKernel(S_,a,l)}const nnt=pt({rotateWithOffset_:ent});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vf(r,t,n,i,o,a){i==null&&(i=.5),o==null&&(o=Number.NEGATIVE_INFINITY),a==null&&(a=0);const l=r.shape[0];return n=Math.min(n,l),W(0<=i&&i<=1,()=>`iouThreshold must be in [0, 1], but was '${i}'`),W(r.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${r.rank}'`),W(r.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${r.shape[1]}`),W(t.rank===1,()=>"scores must be a 1D tensor"),W(t.shape[0]===l,()=>`scores has incompatible shape with boxes. Expected ${l}, but was ${t.shape[0]}`),W(0<=a&&a<=1,()=>`softNmsSigma must be in [0, 1], but was '${a}'`),{maxOutputSize:n,iouThreshold:i,scoreThreshold:o,softNmsSigma:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function snt(r,t,n,i=.5,o=Number.NEGATIVE_INFINITY){const a=K(r,"boxes","nonMaxSuppression","float32"),l=K(t,"scores","nonMaxSuppression","float32"),c=vf(a,l,n,i,o);n=c.maxOutputSize,i=c.iouThreshold,o=c.scoreThreshold;const u={maxOutputSize:n,iouThreshold:i,scoreThreshold:o};return ft.runKernel(s_,{boxes:a,scores:l},u)}const rnt=pt({nonMaxSuppression_:snt});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function int(r,t,n){const i=ont(r,t,n),o=i<0?-(i+1):i;r.splice(o,0,t)}function ont(r,t,n){return lnt(r,t,n||ant)}function ant(r,t){return r>t?1:r<t?-1:0}function lnt(r,t,n){let i=0,o=r.length,a=0,l=!1;for(;i<o;){a=i+(o-i>>>1);const c=n(t,r[a]);c>0?i=a+1:(o=a,l=!c)}return l?i:-i-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iT(r,t,n,i,o){return lT(r,t,n,i,o,0)}function oT(r,t,n,i,o,a){return lT(r,t,n,i,o,0,!1,a,!0)}function aT(r,t,n,i,o,a){return lT(r,t,n,i,o,a,!0)}function lT(r,t,n,i,o,a,l=!1,c=!1,u=!1){const h=[];for(let v=0;v<t.length;v++)t[v]>o&&h.push({score:t[v],boxIndex:v,suppressBeginIndex:0});h.sort(mI);const d=a>0?-.5/a:0,f=[],p=[];for(;f.length<n&&h.length>0;){const v=h.pop(),{score:x,boxIndex:b,suppressBeginIndex:w}=v;if(x<o)break;let S=!1;for(let _=f.length-1;_>=w;--_){const $=cnt(r,b,f[_]);if($>=i){S=!0;break}if(v.score=v.score*unt(i,d,$),v.score<=o)break}v.suppressBeginIndex=f.length,S||(v.score===x?(f.push(b),p.push(v.score)):v.score>o&&int(h,v,mI))}const m=f.length,g=n-m;c&&g>0&&(f.push(...new Array(g).fill(0)),p.push(...new Array(g).fill(0)));const y={selectedIndices:f};return l&&(y.selectedScores=p),u&&(y.validOutputs=m),y}function cnt(r,t,n){const i=r.subarray(t*4,t*4+4),o=r.subarray(n*4,n*4+4),a=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),c=Math.max(i[0],i[2]),u=Math.max(i[1],i[3]),h=Math.min(o[0],o[2]),d=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),p=Math.max(o[1],o[3]),m=(c-a)*(u-l),g=(f-h)*(p-d);if(m<=0||g<=0)return 0;const y=Math.max(a,h),v=Math.max(l,d),x=Math.min(c,f),b=Math.min(u,p),w=Math.max(x-y,0)*Math.max(b-v,0);return w/(m+g-w)}function unt(r,t,n){const i=Math.exp(t*n*n);return n<=r?i:0}function mI(r,t){return r.score-t.score||r.score===t.score&&t.boxIndex-r.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function hnt(r,t,n,i=.5,o=Number.NEGATIVE_INFINITY){const a=K(r,"boxes","nonMaxSuppressionAsync"),l=K(t,"scores","nonMaxSuppressionAsync"),c=vf(a,l,n,i,o);n=c.maxOutputSize,i=c.iouThreshold,o=c.scoreThreshold;const u=await Promise.all([a.data(),l.data()]),h=u[0],d=u[1],{selectedIndices:f}=iT(h,d,n,i,o);return a!==r&&a.dispose(),l!==t&&l.dispose(),pi(f,"int32")}const dnt=hnt;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fnt(r,t,n,i=.5,o=Number.NEGATIVE_INFINITY,a=0){const l=K(r,"boxes","nonMaxSuppression"),c=K(t,"scores","nonMaxSuppression"),u=vf(l,c,n,i,o,a);n=u.maxOutputSize,i=u.iouThreshold,o=u.scoreThreshold,a=u.softNmsSigma;const h={boxes:l,scores:c},d={maxOutputSize:n,iouThreshold:i,scoreThreshold:o,softNmsSigma:a},f=ft.runKernel(i_,h,d);return{selectedIndices:f[0],selectedScores:f[1]}}const pnt=pt({nonMaxSuppressionWithScore_:fnt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function mnt(r,t,n,i=.5,o=Number.NEGATIVE_INFINITY,a=0){const l=K(r,"boxes","nonMaxSuppressionAsync"),c=K(t,"scores","nonMaxSuppressionAsync"),u=vf(l,c,n,i,o,a);n=u.maxOutputSize,i=u.iouThreshold,o=u.scoreThreshold,a=u.softNmsSigma;const h=await Promise.all([l.data(),c.data()]),d=h[0],f=h[1],{selectedIndices:p,selectedScores:m}=aT(d,f,n,i,o,a);return l!==r&&l.dispose(),c!==t&&c.dispose(),{selectedIndices:pi(p,"int32"),selectedScores:pi(m)}}const gnt=mnt;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vnt(r,t,n,i=.5,o=Number.NEGATIVE_INFINITY,a=!1){const l=K(r,"boxes","nonMaxSuppression"),c=K(t,"scores","nonMaxSuppression"),u=vf(l,c,n,i,o,null),h=u.maxOutputSize,d=u.iouThreshold,f=u.scoreThreshold,p={boxes:l,scores:c},m={maxOutputSize:h,iouThreshold:d,scoreThreshold:f,padToMaxOutputSize:a},g=ft.runKernel(r_,p,m);return{selectedIndices:g[0],validOutputs:g[1]}}const ynt=pt({nonMaxSuppressionPadded_:vnt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function xnt(r,t,n,i=.5,o=Number.NEGATIVE_INFINITY,a=!1){const l=K(r,"boxes","nonMaxSuppressionAsync"),c=K(t,"scores","nonMaxSuppressionAsync"),u=vf(l,c,n,i,o,null),h=u.maxOutputSize,d=u.iouThreshold,f=u.scoreThreshold,[p,m]=await Promise.all([l.data(),c.data()]),{selectedIndices:g,validOutputs:y}=oT(p,m,h,d,f,a);return l!==r&&l.dispose(),c!==t&&c.dispose(),{selectedIndices:pi(g,"int32"),validOutputs:Pe(y,"int32")}}const bnt=xnt;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wnt(r,t,n=!1,i=!1){const o=K(r,"images","resizeBilinear");W(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),W(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),W(i===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let a=o,l=!1;o.rank===3&&(l=!0,a=gt(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const c={images:a},u={alignCorners:n,halfPixelCenters:i,size:t},h=ft.runKernel(Hv,c,u);return l?gt(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const L9=pt({resizeBilinear_:wnt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Snt(r,t,n=!1,i=!1){const o=K(r,"images","resizeNearestNeighbor");W(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),W(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),W(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),W(i===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let a=o,l=!1;o.rank===3&&(l=!0,a=gt(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const c={images:a},u={alignCorners:n,halfPixelCenters:i,size:t},h=ft.runKernel(Gv,c,u);return l?gt(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const F9=pt({resizeNearestNeighbor_:Snt});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _nt(r,t="binary",n=!1,i=.5){const o=K(r,"image","threshold"),a=.2989,l=.587,c=.114,u=o.shape[0]*o.shape[1];let h=ct(pi([i]),255),d,f,p,m;if(W(o.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${o.rank}.`),W(o.shape[2]===3||o.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${o.shape[2]}.`),W(o.dtype==="int32"||o.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${o.dtype}.`),W(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),o.shape[2]===3){[d,f,p]=Li(o,[1,1,1],-1);const v=ct(d,a),x=ct(f,l),b=ct(p,c);m=Xt(Xt(v,x),b)}else m=r;if(t==="otsu"){const v=_J(de(S9(m),"int32"),BR([]),256);h=Tnt(v,u)}const g=n?mf(m,h):Ui(m,h);return de(ct(g,255),"int32")}function Tnt(r,t){let n=pi([-1]),i=pi([0]),o=pi([0]),a,l,c,u,h,d;for(let f=0;f<r.size-1;f++){a=Fn(r,0,f+1),l=Fn(r,f+1),h=$e(we(a),t),d=$e(we(l),t);const p=we(ct(a,Zp(0,a.size)));c=$e(p,we(a));const m=Tg(l.shape,a.size),g=Xt(Zp(0,l.size),m),y=ct(l,g);u=$e(we(y),we(l));const v=Se(c,u),x=Se(c,u),b=ct(h,d);o=ct(ct(b,v),x);const w=Ui(o,i);i=vi(w,o,i),n=vi(w,pi([f]),n)}return n}const Cnt=pt({threshold_:_nt});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function knt(r,t,n="nearest",i="constant",o=0,a){const l=K(r,"image","transform","float32"),c=K(t,"transforms","transform","float32");W(l.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${l.rank}.`),W(c.rank===2&&(c.shape[0]===l.shape[0]||c.shape[0]===1)&&c.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),W(a==null||a.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${a}.`);const u={image:l,transforms:c},h={interpolation:n,fillMode:i,fillValue:o,outputShape:a};return ft.runKernel(b_,u,h)}const $nt=pt({transform_:knt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Int(r,t,n){W(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),W(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`);const i=K(r,"a","bandPart");W(i.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${i.rank}.`);const o=i.shape,[a,l]=i.shape.slice(-2);if(!(t<=a))throw new Error(`bandPart(): numLower (${t}) must not be greater than the number of rows (${a}).`);if(!(n<=l))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${l}).`);t<0&&(t=a),n<0&&(n=l);const c=gt(Zp(0,a,1,"int32"),[-1,1]),u=Zp(0,l,1,"int32"),h=Se(c,u),d=wl(mf(h,Pe(+t,"int32")),bh(h,Pe(-n,"int32"))),f=Hs([a,l],i.dtype);return gt(_c(Zu(gt(i,[-1,a,l])).map(p=>vi(d,p,f))),o)}const Ent=pt({bandPart_:Int});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nnt(r){let t;if(Array.isArray(r)){t=!1,W(r!=null&&r.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const o=r[0].shape[0];for(let a=1;a<r.length;++a)W(r[a].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${r[a].shape[0]} vs. ${o})`)}else t=!0,r=Li(r,r.shape[0],0).map(o=>kg(o,[0]));W(r.length<=r[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${r.length}) exceeds number of dimensions (${r[0].shape[0]}).`);const n=[],i=r;for(let o=0;o<r.length;++o)n.push(ft.tidy(()=>{let a=i[o];if(o>0)for(let l=0;l<o;++l){const c=ct(we(ct(n[l],a)),n[l]);a=Se(a,c)}return $e(a,cy(a,"euclidean"))}));return t?_c(n,0):n}const Ant=pt({gramSchmidt_:Nnt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mnt(r,t=!1){if(W(r.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${r.rank}`),r.rank===2)return gI(r,t);{const n=r.shape.slice(0,r.shape.length-2).reduce((u,h)=>u*h),i=Zu(gt(r,[n,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),o=[],a=[];i.forEach(u=>{const[h,d]=gI(u,t);o.push(h),a.push(d)});const l=gt(_c(o,0),r.shape),c=gt(_c(a,0),r.shape);return[l,c]}}function gI(r,t=!1){return ft.tidy(()=>{W(r.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${r.shape.length}D Tensor.`);const n=r.shape[0],i=r.shape[1];let o=m9(n),a=Au(r);const l=T1([[1]],[1,1]);let c=Au(l);const u=n>=i?i:n;for(let h=0;h<u;++h){const d=a,f=c,p=o;[c,a,o]=ft.tidy(()=>{const m=Fn(a,[h,h],[n-h,1]),g=cy(m),y=Fn(a,[h,h],[1,1]),v=vi(Ui(y,0),T1([[-1]]),T1([[1]])),x=Se(y,ct(v,g)),b=$e(m,x);b.shape[0]===1?c=Au(l):c=br([l,Fn(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);const w=fs($e(Nn(v,x),g)),S=Fn(a,[h,0],[n-h,i]),_=ct(w,c),$=vn(c);if(h===0)a=Se(S,Nn(_,Nn($,S)));else{const I=Se(S,Nn(_,Nn($,S)));a=br([Fn(a,[0,0],[h,i]),I],0)}const N=vn(_),k=Fn(o,[0,h],[n,o.shape[1]-h]);if(h===0)o=Se(k,Nn(Nn(k,c),N));else{const I=Se(k,Nn(Nn(k,c),N));o=br([Fn(o,[0,0],[n,h]),I],1)}return[c,a,o]}),ln([d,f,p])}return!t&&n>i&&(o=Fn(o,[0,0],[n,i]),a=Fn(a,[0,0],[i,i])),[o,a]})}const Dnt=pt({qr_:Mnt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Zr;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Zr||(Zr={}));function Rnt(r,t,n=Zr.SUM_BY_NONZERO_WEIGHTS){const i=K(r,"losses","computeWeightedLoss");let o=null;t!=null&&(o=K(t,"weights","computeWeightedLoss"));const a=o==null?i:ct(i,o);if(n===Zr.NONE)return a;if(n===Zr.SUM)return we(a);if(n===Zr.MEAN){if(o==null)return bs(a);{const l=i.size/o.size,c=$e(we(a),we(o));return l>1?$e(c,Pe(l)):c}}if(n===Zr.SUM_BY_NONZERO_WEIGHTS){if(o==null)return $e(we(a),Pe(i.size));{const l=ct(o,Vc(i.shape)),c=de(we(Yp(l,Pe(0))),"float32");return $e(we(a),c)}}throw Error(`Unknown reduction: ${n}`)}const Uc=pt({computeWeightedLoss_:Rnt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ont(r,t,n,i=Zr.SUM_BY_NONZERO_WEIGHTS){const o=K(r,"labels","absoluteDifference"),a=K(t,"predictions","absoluteDifference");let l=null;n!=null&&(l=K(n,"weights","absoluteDifference")),Co(o.shape,a.shape,"Error in absoluteDifference: ");const c=Ws(Se(o,a));return Uc(c,l,i)}const mFt=pt({absoluteDifference_:Ont});function Lnt(r,t,n,i,o=Zr.SUM_BY_NONZERO_WEIGHTS){const a=K(r,"labels","cosineDistance"),l=K(t,"predictions","cosineDistance");let c=null;i!=null&&(c=K(i,"weights","cosineDistance")),Co(a.shape,l.shape,"Error in cosineDistance: ");const u=Pe(1),h=Se(u,we(ct(a,l),n,!0));return Uc(h,c,o)}const gFt=pt({cosineDistance_:Lnt});function Fnt(r,t,n,i=Zr.SUM_BY_NONZERO_WEIGHTS){let o=K(r,"labels","hingeLoss");const a=K(t,"predictions","hingeLoss");let l=null;n!=null&&(l=K(n,"weights","hingeLoss")),Co(o.shape,a.shape,"Error in hingeLoss: ");const c=Pe(1);o=Se(ct(Pe(2),o),c);const u=Ml(Se(c,ct(o,a)));return Uc(u,l,i)}const vFt=pt({hingeLoss_:Fnt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pnt(r,t,n,i=1,o=Zr.SUM_BY_NONZERO_WEIGHTS){const a=K(r,"labels","huberLoss"),l=K(t,"predictions","huberLoss");let c=null;n!=null&&(c=K(n,"weights","huberLoss")),Co(a.shape,l.shape,"Error in huberLoss: ");const u=Pe(i),h=Ws(Se(l,a)),d=hy(h,u),f=Se(h,d),p=Xt(ct(Pe(.5),jn(d)),ct(u,f));return Uc(p,c,o)}const yFt=pt({huberLoss_:Pnt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bnt(r,t,n,i=1e-7,o=Zr.SUM_BY_NONZERO_WEIGHTS){const a=K(r,"labels","logLoss"),l=K(t,"predictions","logLoss");let c=null;n!=null&&(c=K(n,"weights","logLoss")),Co(a.shape,l.shape,"Error in logLoss: ");const u=Pe(1),h=Pe(i),d=fs(ct(a,wo(Xt(l,h)))),f=ct(Se(u,a),wo(Xt(Se(u,l),h))),p=Se(d,f);return Uc(p,c,o)}const xFt=pt({logLoss_:Bnt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function znt(r,t,n,i=Zr.SUM_BY_NONZERO_WEIGHTS){const o=K(r,"labels","meanSquaredError"),a=K(t,"predictions","meanSquaredError");let l=null;n!=null&&(l=K(n,"weights","meanSquaredError")),Co(o.shape,a.shape,"Error in meanSquaredError: ");const c=A9(o,a);return Uc(c,l,i)}const bFt=pt({meanSquaredError_:znt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vnt(r,t){const n=K(r,"labels","sigmoidCrossEntropyWithLogits"),i=K(t,"logits","sigmoidCrossEntropyWithLogits");Co(n.shape,i.shape,"Error in sigmoidCrossEntropyWithLogits: ");const o=Ml(i),a=ct(i,n),l=G_(bo(fs(Ws(i))));return Xt(Se(o,a),l)}function Unt(r,t,n,i=0,o=Zr.SUM_BY_NONZERO_WEIGHTS){let a=K(r,"multiClassLabels","sigmoidCrossEntropy");const l=K(t,"logits","sigmoidCrossEntropy");let c=null;if(n!=null&&(c=K(n,"weights","sigmoidCrossEntropy")),Co(a.shape,l.shape,"Error in sigmoidCrossEntropy: "),i>0){const h=Pe(i),d=Pe(1),f=Pe(.5);a=Xt(ct(a,Se(d,h)),ct(f,h))}const u=Vnt(a,l);return Uc(u,c,o)}const wFt=pt({sigmoidCrossEntropy_:Unt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wnt(r,t,n=-1){if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);return Xu((o,a,l)=>{const u=y9(a,[n],!0),h=Se(de(a,"float32"),u);l([o,h]);const d=fs(ct(h,o));return{value:we(d,[n]),gradFunc:(m,g)=>{const[y,v]=g,x=Ss(m.shape,[n]);return[ct(gt(m,x),Se(de(y,"float32"),bo(v))),ct(gt(m,x),Se(bo(v),de(y,"float32")))]}}})(r,t)}function Gnt(r,t,n,i=0,o=Zr.SUM_BY_NONZERO_WEIGHTS){let a=K(r,"onehotLabels","softmaxCrossEntropy");const l=K(t,"logits","softmaxCrossEntropy");let c=null;if(n!=null&&(c=K(n,"weights","softmaxCrossEntropy")),Co(a.shape,l.shape,"Error in softmaxCrossEntropy: "),i>0){const h=Pe(i),d=Pe(1),f=Pe(a.shape[1]);a=Xt(ct(a,Se(d,h)),$e(h,f))}const u=Wnt(a,l);return Uc(u,c,o)}const SFt=pt({softmaxCrossEntropy_:Gnt});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hnt(r,t,n,i){const o=K(r,"indices","sparseFillEmptyRows","int32"),a=K(t,"values","sparseFillEmptyRows"),l=K(n,"denseShape","sparseFillEmptyRows","int32"),c=K(i,"defaultValue","sparseFillEmptyRows",a.dtype);if(o.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${o.shape}`);if(a.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${a.shape}`);if(l.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${l.shape}`);if(c.rank!==0)throw new Error(`Default value should be a scalar but received shape ${c.shape}`);const u={indices:o,values:a,denseShape:l,defaultValue:c},h=ft.runKernel(u_,u);return{outputIndices:h[0],outputValues:h[1],emptyRowIndicator:h[2],reverseIndexMap:h[3]}}const _Ft=pt({sparseFillEmptyRows_:Hnt});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jnt(r,t,n){const i=K(r,"inputIndices","sparseReshape","int32"),o=K(t,"inputShape","sparseReshape","int32"),a=K(n,"newShape","sparseReshape","int32");if(i.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${i.shape}`);if(o.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${o.shape}`);if(a.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${a.shape}`);const l={inputIndices:i,inputShape:o,newShape:a},c=ft.runKernel(h_,l);return{outputIndices:c[0],outputShape:c[1]}}const TFt=pt({sparseReshape_:jnt});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qnt(r,t,n){const i=K(r,"data","sparseSegmentMean"),o=K(t,"indices","sparseSegmentMean","int32"),a=K(n,"segmentIds","sparseSegmentMean","int32");if(i.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${o.shape}`);if(a.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${a.shape}`);const l={data:i,indices:o,segmentIds:a};return ft.runKernel(d_,l)}const CFt=pt({sparseSegmentMean_:qnt});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Knt(r,t,n){const i=K(r,"data","sparseSegmentSum"),o=K(t,"indices","sparseSegmentSum","int32"),a=K(n,"segmentIds","sparseSegmentSum","int32");if(i.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${o.shape}`);if(a.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${a.shape}`);const l={data:i,indices:o,segmentIds:a};return ft.runKernel(f_,l)}const kFt=pt({sparseSegmentSum_:Knt});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xnt(r,t,n,i,o,a,l,c){const u=K(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error(`Data must be a vector, saw: ${u.shape}`);const h=K(t,"dataSplits","stringNGrams");if(h.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const d={separator:n,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c},f={data:u,dataSplits:h},p=ft.runKernel(g_,f,d);return{nGrams:p[0],nGramsSplits:p[1]}}const $Ft=pt({stringNGrams_:Xnt});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ynt(r,t,n=!0){const i=K(r,"input","stringSplit","string"),o=K(t,"delimiter","stringSplit","string");if(i.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${i.shape}`);if(o.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${o.shape}`);const a={skipEmpty:n},l={input:i,delimiter:o},c=ft.runKernel(v_,l,a);return{indices:c[0],values:c[1],shape:c[2]}}const IFt=pt({stringSplit_:Ynt});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Znt(r,t){const n=K(r,"input","stringToHashBucketFast","string"),i={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");const o={input:n};return ft.runKernel(y_,o,i)}const EFt=pt({stringToHashBucketFast_:Znt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wu={flipLeftRight:Jet,grayscaleToRGB:tnt,resizeNearestNeighbor:F9,resizeBilinear:L9,rotateWithOffset:nnt,cropAndResize:Yet,nonMaxSuppression:rnt,nonMaxSuppressionAsync:dnt,nonMaxSuppressionWithScore:pnt,nonMaxSuppressionWithScoreAsync:gnt,nonMaxSuppressionPadded:ynt,nonMaxSuppressionPaddedAsync:bnt,threshold:Cnt,transform:$nt},Jnt={bandPart:Ent,gramSchmidt:Ant,qr:Dnt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wc extends ff{minimize(t,n=!1,i){const{value:o,grads:a}=this.computeGradients(t,i);if(i!=null){const l=i.map(c=>({name:c.name,tensor:a[c.name]}));this.applyGradients(l)}else this.applyGradients(a);return ln(a),n?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,n){return WQ(t,n)}dispose(){this.iterations_!=null&&ln(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Pe(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(Wc,Symbol.hasInstance,{value:r=>r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cT extends Wc{constructor(t,n,i=null){super(),this.learningRate=t,this.rho=n,this.epsilon=i,this.accumulatedGrads=[],this.accumulatedUpdates=[],i==null&&(this.epsilon=ft.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map(i=>i.name):Object.keys(t)).forEach((i,o)=>{const a=ft.registeredVariables[i],l=!1;this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${i}/accum_grad`,variable:_t(()=>Sn(a).variable(l))}),this.accumulatedUpdates[o]==null&&(this.accumulatedUpdates[o]={originalName:`${i}/accum_var`,variable:_t(()=>Sn(a).variable(l))});const c=Array.isArray(t)?t[o].tensor:t[i];if(c==null)return;const u=this.accumulatedGrads[o].variable,h=this.accumulatedUpdates[o].variable;_t(()=>{const d=Xt(ct(u,this.rho),ct(jn(c),1-this.rho)),f=ct($e(Br(Xt(h,this.epsilon)),Br(Xt(u,this.epsilon))),c),p=Xt(ct(h,this.rho),ct(jn(f),1-this.rho));u.assign(d),h.assign(p);const m=Xt(ct(f,-this.learningRate),a);a.assign(m)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(ln(this.accumulatedGrads.map(t=>t.variable)),ln(this.accumulatedUpdates.map(t=>t.variable)))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=t.length/2,i=!1;this.accumulatedGrads=t.slice(0,n).map(o=>({originalName:o.name,variable:o.tensor.variable(i)})),this.accumulatedUpdates=t.slice(n,n*2).map(o=>({originalName:o.name,variable:o.tensor.variable(i)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,n){return new t(n.learningRate,n.rho,n.epsilon)}}cT.className="Adadelta";Gt(cT);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uT extends Wc{constructor(t,n=.1){super(),this.learningRate=t,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map(i=>i.name):Object.keys(t)).forEach((i,o)=>{const a=ft.registeredVariables[i];this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${i}/accumulator`,variable:_t(()=>Tg(a.shape,this.initialAccumulatorValue).variable(!1))});const l=Array.isArray(t)?t[o].tensor:t[i];if(l==null)return;const c=this.accumulatedGrads[o].variable;_t(()=>{const u=Xt(c,jn(l));c.assign(u);const h=Xt(ct($e(l,Br(Xt(u,ft.backend.epsilon()))),-this.learningRate),a);a.assign(h)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&ln(this.accumulatedGrads.map(t=>t.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=!1;this.accumulatedGrads=t.map(i=>({originalName:i.name,variable:i.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,n){return new t(n.learningRate,n.initialAccumulatorValue)}}uT.className="Adagrad";Gt(uT);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hT extends Wc{constructor(t,n,i,o=null){super(),this.learningRate=t,this.beta1=n,this.beta2=i,this.epsilon=o,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],_t(()=>{this.accBeta1=Pe(n).variable(),this.accBeta2=Pe(i).variable()}),o==null&&(this.epsilon=ft.backend.epsilon())}applyGradients(t){const n=Array.isArray(t)?t.map(i=>i.name):Object.keys(t);_t(()=>{const i=Se(1,this.accBeta1),o=Se(1,this.accBeta2);n.forEach((a,l)=>{const c=ft.registeredVariables[a],u=!1;this.accumulatedFirstMoment[l]==null&&(this.accumulatedFirstMoment[l]={originalName:`${a}/m`,variable:_t(()=>Sn(c).variable(u))}),this.accumulatedSecondMoment[l]==null&&(this.accumulatedSecondMoment[l]={originalName:`${a}/v`,variable:_t(()=>Sn(c).variable(u))});const h=Array.isArray(t)?t[l].tensor:t[a];if(h==null)return;const d=this.accumulatedFirstMoment[l].variable,f=this.accumulatedSecondMoment[l].variable,p=Xt(ct(d,this.beta1),ct(h,1-this.beta1)),m=Xt(ct(f,this.beta2),ct(jn(h),1-this.beta2)),g=$e(p,i),y=$e(m,o);d.assign(p),f.assign(m);const v=Xt(ct($e(g,Xt(Br(y),this.epsilon)),-this.learningRate),c);c.assign(v)}),this.accBeta1.assign(ct(this.accBeta1,this.beta1)),this.accBeta2.assign(ct(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ln(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedSecondMoment!=null&&ln(this.accumulatedSecondMoment.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t),_t(()=>{this.accBeta1.assign(Bd(this.beta1,this.iterations_+1)),this.accBeta2.assign(Bd(this.beta2,this.iterations_+1))});const n=t.length/2,i=!1;this.accumulatedFirstMoment=t.slice(0,n).map(o=>({originalName:o.name,variable:o.tensor.variable(i)})),this.accumulatedSecondMoment=t.slice(n,n*2).map(o=>({originalName:o.name,variable:o.tensor.variable(i)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)}}hT.className="Adam";Gt(hT);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dT extends Wc{constructor(t,n,i,o=null,a=0){super(),this.learningRate=t,this.beta1=n,this.beta2=i,this.epsilon=o,this.decay=a,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],_t(()=>{this.iteration=Pe(0).variable(),this.accBeta1=Pe(n).variable()}),o==null&&(this.epsilon=ft.backend.epsilon())}applyGradients(t){const n=Array.isArray(t)?t.map(i=>i.name):Object.keys(t);_t(()=>{const i=Se(1,this.accBeta1),o=$e(-this.learningRate,Xt(ct(this.iteration,this.decay),1));n.forEach((a,l)=>{const c=ft.registeredVariables[a],u=!1;this.accumulatedFirstMoment[l]==null&&(this.accumulatedFirstMoment[l]={originalName:`${a}/m`,variable:Sn(c).variable(u)}),this.accumulatedWeightedInfNorm[l]==null&&(this.accumulatedWeightedInfNorm[l]={originalName:`${a}/v`,variable:Sn(c).variable(u)});const h=Array.isArray(t)?t[l].tensor:t[a];if(h==null)return;const d=this.accumulatedFirstMoment[l].variable,f=this.accumulatedWeightedInfNorm[l].variable,p=Xt(ct(d,this.beta1),ct(h,1-this.beta1)),m=ct(f,this.beta2),g=Ws(h),y=zc(m,g);d.assign(p),f.assign(y);const v=Xt(ct($e(o,i),$e(p,Xt(y,this.epsilon))),c);c.assign(v)}),this.iteration.assign(Xt(this.iteration,1)),this.accBeta1.assign(ct(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ln(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedWeightedInfNorm!=null&&ln(this.accumulatedWeightedInfNorm.map(t=>t.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}dT.className="Adamax";Gt(dT);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fy extends Wc{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map(i=>i.name):Object.keys(t)).forEach((i,o)=>{const a=Array.isArray(t)?t[o].tensor:t[i];if(a==null)return;const l=ft.registeredVariables[i];_t(()=>{const c=Xt(ct(this.c,a),l);l.assign(c)})}),this.incrementIterations()}setLearningRate(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=Aa(Pe(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(t=await this.extractIterations(t),t.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,n){return new t(n.learningRate)}}fy.className="SGD";Gt(fy);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fT extends fy{constructor(t,n,i=!1){super(t),this.learningRate=t,this.momentum=n,this.useNesterov=i,this.accumulations=[],this.m=Pe(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map(i=>i.name):Object.keys(t)).forEach((i,o)=>{const a=ft.registeredVariables[i];this.accumulations[o]==null&&(this.accumulations[o]={originalName:`${i}/momentum`,variable:_t(()=>Sn(a).variable(!1))});const l=this.accumulations[o].variable,c=Array.isArray(t)?t[o].tensor:t[i];c!=null&&_t(()=>{let u;const h=Xt(ct(this.m,l),c);this.useNesterov?u=Xt(ct(this.c,Xt(c,ct(h,this.m))),a):u=Xt(ct(this.c,h),a),l.assign(h),a.assign(u)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&ln(this.accumulations.map(t=>t.variable))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=!1;this.accumulations=t.map(i=>({originalName:i.name,variable:i.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)}}fT.className="Momentum";Gt(fT);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pT extends Wc{constructor(t,n=.9,i=0,o=null,a=!1){if(super(),this.learningRate=t,this.decay=n,this.momentum=i,this.epsilon=o,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=a,o==null&&(this.epsilon=ft.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map(i=>i.name):Object.keys(t)).forEach((i,o)=>{const a=ft.registeredVariables[i],l=!1;this.accumulatedMeanSquares[o]==null&&(this.accumulatedMeanSquares[o]={originalName:`${i}/rms`,variable:_t(()=>Sn(a).variable(l))}),this.accumulatedMoments[o]==null&&(this.accumulatedMoments[o]={originalName:`${i}/momentum`,variable:_t(()=>Sn(a).variable(l))}),this.accumulatedMeanGrads[o]==null&&this.centered&&(this.accumulatedMeanGrads[o]={originalName:`${i}/mg`,variable:_t(()=>Sn(a).variable(l))});const c=Array.isArray(t)?t[o].tensor:t[i];if(c==null)return;const u=this.accumulatedMeanSquares[o].variable,h=this.accumulatedMoments[o].variable;_t(()=>{const d=Xt(ct(u,this.decay),ct(jn(c),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[o].variable,p=Xt(ct(f,this.decay),ct(c,1-this.decay)),m=$e(ct(c,this.learningRate),Br(Se(d,Xt(jn(p),this.epsilon)))),g=Xt(ct(h,this.momentum),m);u.assign(d),f.assign(p),h.assign(g);const y=Se(a,g);a.assign(y)}else{const f=Xt(ct(u,this.decay),ct(jn(c),1-this.decay)),p=Xt(ct(h,this.momentum),$e(ct(c,this.learningRate),Br(Xt(f,this.epsilon))));u.assign(f),h.assign(p);const m=Se(a,p);a.assign(m)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&ln(this.accumulatedMeanSquares.map(t=>t.variable)),this.accumulatedMeanGrads!=null&&this.centered&&ln(this.accumulatedMeanGrads.map(t=>t.variable)),this.accumulatedMoments!=null&&ln(this.accumulatedMoments.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=this.centered?t.length/3:t.length/2,i=!1;this.accumulatedMeanSquares=t.slice(0,n).map(o=>({originalName:o.name,variable:o.tensor.variable(i)})),this.accumulatedMoments=t.slice(n,n*2).map(o=>({originalName:o.name,variable:o.tensor.variable(i)})),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(o=>({originalName:o.name,variable:o.tensor.variable(i)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}pT.className="RMSProp";Gt(pT);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class su{static sgd(t){return new fy(t)}static momentum(t,n,i=!1){return new fT(t,n,i)}static rmsprop(t,n=.9,i=0,o=null,a=!1){return new pT(t,n,i,o,a)}static adam(t=.001,n=.9,i=.999,o=null){return new hT(t,n,i,o)}static adadelta(t=.001,n=.95,i=null){return new cT(t,n,i)}static adamax(t=.002,n=.9,i=.999,o=null,a=0){return new dT(t,n,i,o,a)}static adagrad(t,n=.1){return new uT(t,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zh={sgd:su.sgd,momentum:su.momentum,adadelta:su.adadelta,adagrad:su.adagrad,rmsprop:su.rmsprop,adamax:su.adamax,adam:su.adam};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qnt=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:r=>r())();function P9(){return new Promise(r=>Qnt(()=>r()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mT(r,t){const n=r[0].length;r.forEach((o,a)=>{W(o.length===n,()=>`Error in concat${n}D: rank of tensors[${a}] must be the same as the rank of the rest (${n})`)}),W(t>=0&&t<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const i=r[0];r.forEach((o,a)=>{for(let l=0;l<n;l++)W(l===t||o[l]===i[l],()=>`Error in concat${n}D: Shape of tensors[${a}] (${o}) does not match the shape of the rest (${i}) along the non-concatenated axis ${a}.`)})}function Ma(r,t){const n=r[0].slice();for(let i=1;i<r.length;i++)n[t]+=r[i][t];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Bo;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(Bo||(Bo={}));function B9(r,t,n){let i=new Array;if(n==null&&t==null)return i;if(t==null)for(;i.length<r+n.length;)i.push(-1);else i=t.slice();if(n==null)return i;if(r+n.length!==i.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${r+n.length}, but shape.rank = ${i.length}`);for(let o=1;o<n.length;++o){const a=n[o],l=i[i.length-n.length+o],c=i[l];if(a>=0)if(c>=0){if(c!==a)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${o+r}] = ${a} but shape[${o+r}] = ${c}`)}else i[l]=a}return i}function z9(r){const t={FIRST_DIM_SIZE:Bo.FIRST_DIM_SIZE,VALUE_ROWIDS:Bo.VALUE_ROWIDS,ROW_LENGTHS:Bo.ROW_LENGTHS,ROW_SPLITS:Bo.ROW_SPLITS,ROW_LIMITS:Bo.ROW_LIMITS,ROW_STARTS:Bo.ROW_STARTS},n=[];for(const i of r)if(i in t)n.push(t[i]);else break;return n}function V9(r){return r.length===0?0:r[0]===Bo.FIRST_DIM_SIZE?r.length-1:r.length}function U9(r,t){if(r==null||t==null)return;const n=r.length,i=t.length;if(n>=i)throw new Error(`defaultValue.shape=${r} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${i})`);for(let o=0;o<Math.min(n,i-1);++o){const a=r[o],l=t[o+1];if(a>=0&&l>=0&&a!==1&&a!==l)throw new Error(`defaultValue.shape=${r}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${o-r.length}] = ${a} but ragged tensor input.flatValues.shape[${o-r.length}] = ${l}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gT=30;function py(r){return r<=gT?r:O3(r,Math.floor(Math.sqrt(r)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vT(r,t,n){const i=n*(typeof r=="number"?r:r[0]),o=t*(typeof r=="number"?r:r[1]);return[i,o]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ig(r,t,n,i=!0){let o=[];if(i)o=o.concat(t.slice(0)),o.push(r[0]/n),o=o.concat(r.slice(1));else{o=o.concat(r[0]);const a=t.length;for(let l=0;l<a;++l)o=o.concat([r[l+1]/t[l],t[l]]);o=o.concat(r.slice(a+1))}return o}function Eg(r,t,n=!0){const i=[];if(n){i.push(t);for(let o=t+1;o<r;++o)o<=2*t?(i.push(o),i.push(o-(t+1))):i.push(o)}else{const o=[],a=[];for(let l=1;l<r;++l)l>=t*2+1||l%2===1?a.push(l):o.push(l);i.push(...o),i.push(0),i.push(...a)}return i}function Ng(r,t,n,i=!0){const o=[];i?o.push(r[0]/n):o.push(r[0]*n);for(let a=1;a<r.length;++a)a<=t.length?i?o.push(t[a-1]*r[a]):o.push(r[a]/t[a-1]):o.push(r[a]);return o}function yT(r,t){const n=[0];for(let i=0;i<t;++i)n.push(r[i][0]);return n}function xT(r,t,n){const i=r.slice(0,1);for(let o=0;o<n;++o)i.push(r[o+1]-t[o][0]-t[o][1]);return i}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const my=1.7580993408473768,gy=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bT=.3275911,wT=.254829592,ST=-.284496736,_T=1.421413741,TT=-1.453152027,CT=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sl(r,t){if(r.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${r.length}, imag: ${t.length}.`);const n=new Float32Array(r.length*2);for(let i=0;i<n.length;i+=2)n[i]=r[i/2],n[i+1]=t[i/2];return n}function W9(r){const t=new Float32Array(r.length/2),n=new Float32Array(r.length/2);for(let i=0;i<r.length;i+=2)t[i/2]=r[i],n[i/2]=r[i+1];return{real:t,imag:n}}function G9(r){const t=Math.ceil(r.length/4),n=new Float32Array(t),i=new Float32Array(t);for(let o=0;o<r.length;o+=4)n[Math.floor(o/4)]=r[o],i[Math.floor(o/4)]=r[o+1];return{real:n,imag:i}}function H9(r){const t=Math.floor(r.length/4),n=new Float32Array(t),i=new Float32Array(t);for(let o=2;o<r.length;o+=4)n[Math.floor(o/4)]=r[o],i[Math.floor(o/4)]=r[o+1];return{real:n,imag:i}}function kT(r,t){const n=r[t*2],i=r[t*2+1];return{real:n,imag:i}}function j9(r,t,n,i){r[i*2]=t,r[i*2+1]=n}function q9(r,t){const n=new Float32Array(r/2),i=new Float32Array(r/2);for(let o=0;o<Math.ceil(r/2);o++){const a=(t?2:-2)*Math.PI*(o/r);n[o]=Math.cos(a),i[o]=Math.sin(a)}return{real:n,imag:i}}function K9(r,t,n){const i=(n?2:-2)*Math.PI*(r/t),o=Math.cos(i),a=Math.sin(i);return{real:o,imag:a}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Px="->",tst=/->/g,vI=",",yI="...";function $T(r,t){r=r.replace(/\s/g,"");const n=(r.length-r.replace(tst,"").length)/Px.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${Px}").`);const[i,o]=r.split(Px);W(i.indexOf(yI)===-1,()=>`The ellipsis notation ("${yI}") is not supported yet.`);const a=i.split(vI),l=a.length;if(t!==l)throw new Error(`Expected ${l} input tensors, received ${t}`);if(l>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const c=[];for(let p=0;p<o.length;++p){const m=o[p];if(!a.some(g=>g.indexOf(m)!==-1))throw new Error(`Output subscripts contain the label ${m} not present in the input subscripts.`);c.indexOf(m)===-1&&c.push(m)}for(let p=0;p<i.length;++p){const m=i[p];c.indexOf(m)===-1&&m!==vI&&c.push(m)}const u=new Array(a.length);for(let p=0;p<l;++p){if(new Set(a[p].split("")).size!==a[p].length)throw new Error(`Found duplicate axes in input component ${a[p]}. Support for duplicate axes in input is not implemented yet.`);u[p]=[];for(let m=0;m<a[p].length;++m)u[p].push(c.indexOf(a[p][m]))}const h=c.length,d=o.length,f=[];for(let p=d;p<h;++p)f.push(p);return{allDims:c,summedDims:f,idDims:u}}function IT(r,t){let n=new Array(r);n.fill(-1);for(let o=0;o<t.length;++o)n[t[o]]=o;const i=[];for(let o=0;o<r;++o)n[o]===-1&&i.push(o);return n=n.filter(o=>o!==-1),{permutationIndices:n,expandDims:i}}function ET(r,t,n){const i=new Array(r);for(let o=0;o<n.length;++o){const a=n[o].shape;for(let l=0;l<t[o].length;++l)i[t[o][l]]===void 0?i[t[o][l]]=a[l]:W(i[t[o][l]]===a[l],()=>`Expected dimension ${i[t[o][l]]} at axis ${l} of input shaped ${JSON.stringify(a)}, but got dimension ${a[l]}`)}}function NT(r,t){const n=r,i=[];let o=0;r.length===0&&n.push(-1),o=r.length+1;for(let l=0;l<o;++l)i.push([]);const a=[];for(let l=0;l<n.length;++l){const c=n[l],u=est(t,c);for(const h of u)a.indexOf(h)===-1&&(i[l].push(h),a.push(h))}return{path:n,steps:i}}function AT(r){return r.every((t,n)=>t===n)}function est(r,t){const n=[];for(let i=0;i<r.length;++i)(r[i].length===0||r[i].indexOf(t)!==-1||t===-1)&&n.push(i);return n}function MT(r,t,n=0){let i=[];if(typeof t=="number")W(r.shape[n]%t===0,()=>"Number of splits must evenly divide the axis."),i=new Array(t).fill(r.shape[n]/t);else{const o=t.reduce((l,c)=>(c===-1&&(l+=1),l),0);W(o<=1,()=>"There should be only one negative value in split array.");const a=t.indexOf(-1);if(a!==-1){const l=t.reduce((c,u)=>u>0?c+u:c);t[a]=r.shape[n]-l}W(r.shape[n]===t.reduce((l,c)=>l+c),()=>"The sum of sizes must match the size of the axis dimension."),i=t}return i}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X9(r){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${r}`}function Y9(r,t){return`indices(${r}, 0) is invalid: ${t} < 0`}function Z9(r,t,n){return`indices(${r}, 0) is invalid: ${t} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J9(r,t){return`only one output dimension may be -1, not both ${r} and ${t}`}function Q9(r,t){return`size ${r} must be non-negative, not ${t}`}function t8(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function e8(r,t){const n=Nt(r),i=Nt(t);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${i}. inputShape=${r} outputShape= ${t}`}function n8(r,t){const n=Nt(r),i=Nt(t);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${i}. inputShape=${r} outputShape=${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lw(){return"segment ids must be >= 0"}function s8(){return"segment ids are not increasing"}function r8(r,t){return`Segment id ${r} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function i8(r,t,n){return`Bad: indices[${r}] == ${t} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o8(r,t){let n=!1,i;for(r<=gT?(i=r,n=!0):i=O3(r,Math.floor(Math.sqrt(r)));!n;)i>t||i===r?n=!0:i=O3(r,i+1);return i}function a8(r,t,n){const i=[],o=r.length;for(let a=0;a<o;a++)a!==t?i.push(r[a]):i.push(n);return i}function DT(r,t,n,i){const o=t.shape.length,a=r.shape.length;if(i!==0&&(i<-o||i>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${i}`);if(i<0&&(i+=o),i>a)throw new Error(`batchDims (${i}) must be less than rank(x) (
    ${a}).`);if(n<i)throw new Error(`batchDims (${i}) must be less than or equal to axis (${n}).`);for(let f=0;f<i;++f)if(r.shape[f]!==t.shape[f])throw new Error(`x.shape[${f}]: ${r.shape[f]} should be equal to indices.shape[${f}]: ${t.shape[f]}.`);const l=r.shape[n],c=[];let u=1,h=1,d=1;for(let f=0;f<i;++f)c.push(r.shape[f]),u*=r.shape[f];for(let f=i;f<n;f++)c.push(r.shape[f]),h*=r.shape[f];for(let f=i;f<o;f++)c.push(t.shape[f]);for(let f=n+1;f<a;f++)c.push(r.shape[f]),d*=r.shape[f];return{batchSize:u,sliceSize:d,outerSize:h,dimSize:l,outputShape:c}}const nst=Object.freeze(Object.defineProperty({__proto__:null,segOpComputeOptimalWindowSize:o8,computeOutShape:a8,collectGatherOpShapeInfo:DT},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ju(r){try{return r.map(t=>Sc(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function l8(r){return r.map(t=>hc(t))}const sst=Object.freeze(Object.defineProperty({__proto__:null,slice_util:NZ,segment_util:nst,fromUint8ToStringArray:Ju,fromStringArrayToUint8:l8,upcastType:gi,axesAreInnerMostDims:V_,combineLocations:f9,computeOutAndReduceShapes:Zs,expandShapeToKeepDim:Ss,assertAxesAreInnerMostDims:fr,getAxesPermutation:ms,getUndoAxesPermutation:Bc,getInnerMostAxes:_s,getBroadcastDims:Pd,getReductionAxes:Fs,assertAndGetBroadcastShape:qe,assertParamsConsistent:mT,computeOutShape:Ma,computeDilation2DInfo:_g,computePool2DInfo:ko,computePool3DInfo:Nl,computeConv2DInfo:dr,computeConv3DInfo:Pc,computeDefaultPad:R_,tupleValuesAreOne:qu,eitherStridesOrDilationsAreOne:_r,convertConv2DDataFormat:Al,checkPadOnDimRoundingMode:si,getFusedDyActivation:eT,getFusedBiasGradient:nT,applyActivation:sT,shouldFuse:rT,get RowPartitionType(){return Bo},combineRaggedTensorToTensorShapes:B9,getRowPartitionTypesHelper:z9,getRaggedRank:V9,validateDefaultValueShape:U9,PARALLELIZE_THRESHOLD:gT,computeOptimalWindowSize:py,getImageCenter:vT,getReshaped:Ig,getPermuted:Eg,getReshapedPermuted:Ng,getSliceBeginCoords:yT,getSliceSize:xT,prepareAndValidate:I_,validateUpdateShape:ZR,validateInput:CZ,calculateShapes:Sg,SELU_SCALEALPHA:my,SELU_SCALE:gy,ERF_P:bT,ERF_A1:wT,ERF_A2:ST,ERF_A3:_T,ERF_A4:TT,ERF_A5:CT,warn:Di,log:uY,mergeRealAndImagArrays:Sl,splitRealAndImagArrays:W9,complexWithEvenIndex:G9,complexWithOddIndex:H9,getComplexWithIndex:kT,assignToTypedArray:j9,exponents:q9,exponent:K9,decodeEinsumEquation:$T,getEinsumPermutation:IT,checkEinsumDimSizes:ET,getEinsumComputePath:NT,isIdentityPermutation:AT,prepareSplitSize:MT,getSparseFillEmptyRowsIndicesDenseShapeMismatch:X9,getSparseFillEmptyRowsNegativeIndexErrorMessage:Y9,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Z9,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:J9,getSparseReshapeNegativeOutputDimErrorMessage:Q9,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:t8,getSparseReshapeInputOutputMultipleErrorMessage:e8,getSparseReshapeInputOutputMismatchErrorMessage:n8,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:lw,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:s8,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:r8,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:i8},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c8={kernelName:nv,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>ct(r,$g(de(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rst={kernelName:$m,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>{const i=jn(de(n,"float32")),o=Br(Se(Pe(1),i));return fs($e(r,o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ist={kernelName:Im,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>{const i=Br(Se(jn(de(n,"float32")),1));return $e(r,i)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ost={kernelName:df,inputsToSave:["a","b"],gradFunc:(r,t)=>{const[n,i]=t,o=qe(n.shape,i.shape);return{a:()=>{let c=r;const u=Fs(n.shape,o);return u.length>0&&(c=we(c,u)),gt(c,n.shape)},b:()=>{let c=r;const u=Fs(i.shape,o);return u.length>0&&(c=we(c,u)),gt(c,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ast={kernelName:M4,saveAllInputs:!0,gradFunc:(r,t)=>{const n={};return t.forEach((i,o)=>{n[o]=()=>r.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lst={kernelName:sv,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>Sn(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cst={kernelName:rv,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>Sn(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ust={kernelName:Em,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>$e(r,Br(Se(Pe(1),jn(de(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hst={kernelName:Nm,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>{const i=Br(Xt(Pe(1),jn(de(n,"float32"))));return $e(r,i)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dst={kernelName:Dm,inputsToSave:["a","b"],gradFunc:(r,t)=>{const[n,i]=t,o=qe(n.shape,i.shape);return{a:()=>{const c=Xt(jn(n),jn(i));let u=ct(r,$e(i,c));const h=Fs(n.shape,o);return h.length>0&&(u=we(u,h)),gt(u,n.shape)},b:()=>{const c=Xt(jn(n),jn(i));let u=fs(ct(r,$e(n,c)));const h=Fs(i.shape,o);return h.length>0&&(u=we(u,h)),gt(u,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fst={kernelName:Am,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>$e(r,Xt(jn(de(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pst={kernelName:Mm,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>$e(r,Se(Pe(1),jn(de(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mst(r,t,n,i,o,a){const l=K(r,"dy","avgPool3dGrad"),c=K(t,"input","avgPool3dGrad");let u=l,h=c,d=!1;c.rank===4&&(d=!0,u=gt(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=gt(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),W(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),W(h.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),si("avgPool3dGrad",o,a);const f={dy:u,input:h},p={filterSize:n,strides:i,pad:o,dimRoundingMode:a},m=ft.runKernel(L4,f,p);return d?gt(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const gst=pt({avgPool3dGrad_:mst});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vst={kernelName:ov,inputsToSave:["x"],gradFunc:(r,t,n)=>{const[i]=t,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=n;return{x:()=>gst(r,i,o,a,l,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yst(r,t,n,i,o){const a=K(r,"dy","avgPoolGrad"),l=K(t,"input","avgPoolGrad");W(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`);let c=l,u=a,h=!1;l.rank===3&&(h=!0,c=gt(l,[1,l.shape[0],l.shape[1],l.shape[2]]),u=gt(a,[1,a.shape[0],a.shape[1],a.shape[2]])),W(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),W(c.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${c.rank}.`);const d={dy:u,input:c},f={filterSize:n,strides:i,pad:o},p=ft.runKernel(O4,d,f);return h?gt(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const xst=pt({avgPoolGrad_:yst});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bst={kernelName:iv,inputsToSave:["x"],gradFunc:(r,t,n)=>{const[i]=t,{filterSize:o,strides:a,pad:l}=n;return{x:()=>xst(r,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wst={kernelName:av,inputsToSave:["a","b"],gradFunc:(r,t,n)=>{const[i,o]=t,{transposeA:a,transposeB:l}=n;return!a&&!l?{a:()=>Nn(r,o,!1,!0),b:()=>Nn(i,r,!0,!1)}:!a&&l?{a:()=>Nn(r,o,!1,!1),b:()=>Nn(r,i,!0,!1)}:a&&!l?{a:()=>Nn(o,r,!1,!0),b:()=>Nn(i,r,!1,!1)}:{a:()=>Nn(o,r,!0,!0),b:()=>Nn(r,i,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sst={kernelName:lv,gradFunc:(r,t,n)=>{const{blockShape:i,crops:o}=n;return{x:()=>X_(r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _st={kernelName:aY,gradFunc:(r,t,n)=>{const i=n,o=i.inputShape,a=i.shape,l=Array.from(a);for(let u=o.length-1;u>=0;u--)if(o[u]===a[u])l[u]=1;else if(o[u]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${a}].`);const c=[];for(let u=0;u<l.length;u++)l[u]>1&&c.push(u);return{x:()=>we(r,c,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tst={kernelName:Rm,gradFunc:r=>({x:()=>r.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cst={kernelName:Om,gradFunc:r=>({x:()=>Sn(r)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kst={kernelName:Lm,inputsToSave:["x"],gradFunc:(r,t,n)=>{const[i]=t,{clipValueMin:o,clipValueMax:a}=n;return{x:()=>vi(wl(bh(i,o),mf(i,a)),r,Sn(r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $st={kernelName:cv,inputsToSave:["x"],gradFunc:c8.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ist={kernelName:uv,saveAllInputs:!0,gradFunc:(r,t,n)=>{const i=t.map(u=>u.shape),{axis:o}=n,a=on(o,t[0].shape)[0],l=i.map(u=>u[a]);return Li(r,l,a).map(u=>()=>u)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Est={kernelName:hv,inputsToSave:["x","filter"],gradFunc:(r,t,n)=>{const[i,o]=t,{dilations:a,strides:l,pad:c,dataFormat:u}=n;return W(qu(a),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`),{x:()=>P_(i.shape,r,o,l,c,u),filter:()=>tT(i,r,o.shape,l,c,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nst={kernelName:dv,inputsToSave:["dy","filter"],gradFunc:(r,t,n)=>{const[i,o]=t,{strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=n;return{dy:()=>Ku(r,o,a,l,c,1,u),filter:()=>tT(r,i,o.shape,a,l,c,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ast(r,t,n,i,o){let a=r;r.rank===4&&(a=gt(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));let l=t;l.rank===4&&(l=gt(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),W(a.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${a.shape}.`),W(l.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${l.shape}.`),W(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),W(a.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${a.shape[4]}) must match input depth in filter (${n[3]}.`),W(l.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${l.shape[4]}) must match output depth for filter (${n[4]}).`);const c={x:a,dy:l},u={strides:i,pad:o,filterShape:n};return ft.runKernel(z4,c,u)}const Mst=pt({conv3DBackpropFilter_:Ast});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dst={kernelName:fv,inputsToSave:["x","filter"],gradFunc:(r,t,n)=>{const{dilations:i,strides:o,pad:a}=n;W(qu(i),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const[l,c]=t;return{x:()=>u9(l.shape,r,c,o,a),filter:()=>Mst(l,r,c.shape,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rst={kernelName:Fm,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>ct(fs(k9(de(n,"float32"))),r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ost={kernelName:Pm,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>ct($9(de(n,"float32")),r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lst={kernelName:pv,inputsToSave:["x"],gradFunc:(r,t,n)=>{const[i]=t,{axis:o,exclusive:a,reverse:l}=n;return{x:()=>{const c=ms([o],i.rank);let u=d9(r,o,a,!l);return c!=null&&(u=vn(u,c)),u}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fst={kernelName:mv,inputsToSave:["x","filter"],gradFunc:(r,t,n)=>{const{dilations:i,strides:o,pad:a,dimRoundingMode:l}=n,c=i??[1,1];W(qu(c),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${c}'`);const[u,h]=t;return W(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),W(h.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${h.rank}.`),W(u.shape[3]===h.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`),W(_r(o,c),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${c}'.`),si("depthwiseConv2d",a,l),{x:()=>Vet(u.shape,r,h,o,a,c,l),filter:()=>Bet(u,r,h.shape,o,a,c,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pst={kernelName:gv,inputsToSave:["x","filter"],gradFunc:(r,t,n)=>{const[i,o]=t,a={x:i,filter:o,dy:r},l={x:i,filter:o,dy:r};return{x:()=>ft.runKernel(L3,a,n),filter:()=>ft.runKernel(F3,l,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bst={kernelName:zm,outputsToSave:[!0],gradFunc:(r,t)=>{const[n]=t,i={dy:r,y:n};return{x:()=>ft.runKernel(K4,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zst={kernelName:Vm,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t,i=ct(bo(fs(jn(n))),2/Math.sqrt(Math.PI));return{x:()=>ct(r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vst={kernelName:Um,outputsToSave:[!0],gradFunc:(r,t)=>{const[n]=t;return{x:()=>ct(r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ust={kernelName:yv,inputsToSave:["input"],gradFunc:(r,t)=>{const[n]=t;return{input:()=>gt(r,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wst={kernelName:Wm,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>ct(r,bo(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gst={kernelName:Gm,gradFunc:r=>({x:()=>Sn(r)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hst={kernelName:Hm,inputsToSave:["a","b"],gradFunc:(r,t)=>{const[n,i]=t,o=qe(n.shape,i.shape);return{a:()=>{const c=$e(r,de(i,"float32")),u=Fs(n.shape,o);return u.length>0?gt(we(c,u),n.shape):c},b:()=>{let c=ct(r,de(n,"float32"));const u=Fs(i.shape,o);u.length>0&&(c=gt(we(c,u),i.shape));const h=jn(i);return fs($e(c,de(h,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jst={kernelName:xv,inputsToSave:["x","mean","variance","scale"],gradFunc:(r,t,n)=>{const{varianceEpsilon:i}=n,[o,a,l,c]=t,u=c??Pe(1),h=Fs(a.shape,o.shape),d=[];if(a.rank===1){for(let S=0;S<o.shape.length-1;++S)d.push(o.shape[S]);d.push(1)}const f=Se(o,a),p=ct(r,u),m=_9(Xt(l,Pe(i))),g=ct(ct(ct(m,m),m),Pe(-.5));return{x:()=>a.rank===1?gt(ct(ct(r,Wo(gt(m,[1,1,1,a.shape[0]]),d)),u),o.shape):gt(ct(ct(r,m),u),o.shape),mean:()=>{let S=ct(ct(m,Pe(-1)),p);return a.rank===1&&(S=we(S,h)),gt(S,a.shape)},variance:()=>{let S=ct(ct(g,f),p);return a.rank===1&&(S=we(S,h)),gt(S,a.shape)},scale:()=>{const S=ct(f,m);let _=ct(r,S);return a.rank===1&&(_=we(_,h)),gt(_,a.shape)},offset:()=>{let S=r;return a.rank===1&&(S=we(S,h)),gt(S,a.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qst={kernelName:bv,inputsToSave:["x","indices"],gradFunc:(r,t,n)=>{const[i,o]=t,{axis:a}=n,l=on(a,i.shape)[0];return{x:()=>{const u=i.shape,h=o.size,d=u.slice(0,l),f=d.length,p=u.slice(a,u.length).slice(1),m=p.length,g=xI(0,f),y=xI(f+1,f+1+m),v=bI([d,[h],p]),x=gt(r,v),b=gt(o,[h]),w=bI([[f],g,y]),S=vn(x,w);let _=D9(S,b,i.shape[l]);const $=Bc(w);return _=vn(_,$),_},indices:()=>o}}};function xI(r,t){const n=[];for(let i=r;i<t;++i)n.push(i);return n}function bI(r){const t=[];for(let n=0;n<r.length;++n)for(let i=0;i<r[n].length;++i)t.push(r[n][i]);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kst={kernelName:jm,inputsToSave:["a","b"],gradFunc:(r,t)=>{const[n,i]=t;return{a:()=>Sn(n),b:()=>Sn(i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xst={kernelName:qm,gradFunc:r=>({x:()=>de(r,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yst={kernelName:Km,gradFunc:r=>({x:()=>Sn(r)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zst={kernelName:Xm,gradFunc:r=>({x:()=>Sn(r)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jst={kernelName:Ym,gradFunc:r=>({x:()=>Sn(r)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qst={kernelName:Sv,inputsToSave:["x"],gradFunc:(r,t,n)=>{const[i]=t,{alpha:o}=n,a=Ui(i,0);return{x:()=>vi(a,r,ct(r,o))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const trt={kernelName:Jm,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>$e(r,Xt(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ert={kernelName:Zm,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>$e(r,de(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nrt={kernelName:lY,inputsToSave:[],outputsToSave:[!0],gradFunc:(r,t,n)=>{const[i]=t,{axis:o}=n;return{logits:()=>{const l=bo(i);return Se(r,ct(we(r,o,!0),l))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function srt(r,t,n,i=5,o=1,a=1,l=.5){const c={x:r,y:t,dy:n},u={depthRadius:i,bias:o,alpha:a,beta:l};return ft.runKernel(t_,c,u)}const rrt=pt({localResponseNormalizationBackprop_:srt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const irt={kernelName:Iv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,t,n)=>{const[i,o]=t,{depthRadius:a,bias:l,alpha:c,beta:u}=n;return{x:()=>rrt(i,o,r,a,l,c,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u8(r,t,n,i){return t.rank<n.rank&&(t=gt(t,Ss(t.shape,i))),r.rank<n.rank&&(r=gt(r,Ss(r.shape,i))),{x:()=>ct(r,de(Pa(n,t),r.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wI={kernelName:Ev,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,t,n)=>{const i=n,{reductionIndices:o}=i,a=t[0],l=t[1],c=on(o,a.shape),u=u8(r,l,a,c);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ort={kernelName:Qm,inputsToSave:["a","b"],gradFunc:(r,t)=>{const[n,i]=t;return{a:()=>ct(r,de(bh(n,i),"float32")),b:()=>ct(r,de(g9(n,i),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function art(r,t,n,i,o,a,l){const c=K(r,"dy","maxPool3dGrad"),u=K(t,"input","maxPool3dGrad"),h=K(n,"output","maxPool3dGrad");let d=c,f=u,p=h,m=!1;u.rank===4&&(m=!0,d=gt(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),f=gt(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),p=gt(h,[1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]])),W(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),W(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),W(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),si("maxPool3dGrad",a,l);const g={dy:d,input:f,output:p},y={filterSize:i,strides:o,pad:a,dimRoundingMode:l},v=ft.runKernel(n_,g,y);return m?gt(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}const lrt=pt({maxPool3dGrad_:art});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const crt={kernelName:Av,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,t,n)=>{const[i,o]=t,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=n;return{x:()=>lrt(r,i,o,a,l,c,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function urt(r,t,n,i,o,a,l){const c=K(r,"dy","maxPoolGrad"),u=K(t,"input","maxPoolGrad"),h=K(n,"output","maxPoolGrad");W(u.rank===c.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${c.rank})`),W(c.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${c.rank}.`),W(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),si("maxPoolGrad",a,l);const d={dy:c,input:u,output:h},f={filterSize:i,strides:o,pad:a,dimRoundingMode:l};return ft.runKernel(e_,d,f)}const hrt=pt({maxPoolGrad_:urt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const drt={kernelName:Nv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,t,n)=>{const[i,o]=t,{filterSize:a,strides:l,pad:c}=n;return{x:()=>hrt(r,i,o,a,l,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const frt={kernelName:Mv,inputsToSave:["x"],gradFunc:(r,t,n)=>{const[i]=t,{axis:o}=n,a=on(o,i.shape),c=Zs(i.shape,a)[1],u=Nt(c);return{x:()=>{const d=i.shape.slice();a.forEach(m=>{d[m]=1});const f=gt(r,d);return $e(ct(f,Vc(i.shape,"float32")),u)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const prt={kernelName:Dv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,t,n)=>{const i=n,{axis:o}=i,[a,l]=t,c=on(o,a.shape),u=u8(r,l,a,c);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mrt={kernelName:tg,inputsToSave:["a","b"],gradFunc:(r,t)=>{const[n,i]=t;return{a:()=>ct(r,de(mf(n,i),"float32")),b:()=>ct(r,de(Ui(n,i),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const grt={kernelName:Rv,inputsToSave:["x"],gradFunc:(r,t,n)=>{const i=t[0],{paddings:o}=n,a=o.map(l=>l[0]);return{x:()=>Fn(r,a,i.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vrt={kernelName:eg,inputsToSave:["a","b"],gradFunc:(r,t)=>{const[n,i]=t,o=qe(n.shape,i.shape);return{a:()=>{const c=Fs(n.shape,o);return c.length>0?gt(we(r,c),n.shape):r},b:()=>{const c=ct(r,fs(uy($e(n,i)))),u=Fs(i.shape,o);return u.length>0?gt(we(c,u),i.shape):c}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yrt={kernelName:ng,inputsToSave:["a","b"],gradFunc:(r,t)=>{const[n,i]=t,o=qe(n.shape,i.shape);return{a:()=>{const c=ct(r,de(i,"float32")),u=Fs(n.shape,o);return u.length>0?gt(we(c,u),n.shape):c},b:()=>{const c=ct(r,de(n,"float32")),u=Fs(i.shape,o);return u.length>0?gt(we(c,u),i.shape):c}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xrt={kernelName:Ov,gradFunc:r=>({x:()=>fs(r)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const brt={kernelName:Pv,inputsToSave:["indices"],gradFunc:(r,t)=>{const n=t[0];return{indices:()=>Hs(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wrt={kernelName:Fv,gradFunc:r=>({x:()=>Sn(r)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Srt={kernelName:Bv,saveAllInputs:!0,gradFunc:(r,t,n)=>{const{axis:i}=n;return Zu(r,i).map(a=>()=>a)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SI={kernelName:zv,inputsToSave:["x"],gradFunc:(r,t,n)=>{const i=t[0],{paddings:o}=n,a=o.map(l=>l[0]);return{x:()=>Fn(r,a,i.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _rt={kernelName:sg,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(r,t)=>{const[n,i,o]=t,a=n,l=i,c=qe(a.shape,l.shape);return{a:()=>{const d=de(l,"float32");let f=ct(r,ct(d,Bd(a,Se(d,Pe(1)))));const p=Fs(a.shape,c);return p.length>0&&(f=we(f,p)),gt(f,a.shape)},b:()=>{const d=Ui(a,0),f=vi(d,wo(a),Sn(a));let p=ct(r,ct(o,f));const m=Fs(l.shape,c);return m.length>0&&(p=we(p,m)),gt(p,l.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Trt={kernelName:Vv,inputsToSave:["x","alpha"],gradFunc:(r,t)=>{const[n,i]=t,o=Ui(n,0);return{x:()=>vi(o,r,ct(r,i)),alpha:()=>{let a=vi(o,Sn(r),ct(r,n));const l=Fs(i.shape,r.shape);return l.length>0&&(a=we(a,l)),gt(a,i.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Crt(r,t,n){const i=r.shape.slice();i[n]=1;const o=gt(t,i),a=Q3(r,n,!0,!1),l=Q3(r,n,!0,!0),c=ct(a,l);return ct(o,c)}function krt(r,t,n){const i=r.shape.length,o=i-n.length,a=ms(n,i);let l=r;a!=null&&(l=vn(r,a));const c=l.shape.slice(),h=c.splice(i-n.length,n.length).reduce((p,m)=>p*m,1);c.push(h);const d=l.reshape(c);let f=Crt(d,t,o);if(f=f.reshape(l.shape),a!=null){const p=Bc(a);f=vn(f,p)}return f}const $rt={kernelName:Uv,inputsToSave:["x"],gradFunc:(r,t,n)=>{const[i]=t,{axis:o}=n;let a=[];return o==null?a=i.shape.map((l,c)=>c):typeof o=="number"?a=[o]:a=o,{x:()=>krt(i,r,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Irt={kernelName:Bm,inputsToSave:["a","b"],gradFunc:(r,t)=>{const[n,i]=t,o=qe(n.shape,i.shape);return{a:()=>{const c=$e(r,de(i,"float32")),u=Fs(n.shape,o);return u.length>0?gt(we(c,u),n.shape):c},b:()=>{let c=ct(r,de(n,"float32"));const u=Fs(i.shape,o);u.length>0&&(c=gt(we(c,u),i.shape));const h=jn(i);return fs($e(c,de(h,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ert={kernelName:rg,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>$e(r,fs(jn(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nrt={kernelName:og,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t,i=ct(mf(n,6),$g(n));return{x:()=>ct(r,de(i,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Art={kernelName:ig,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>ct(r,de($g(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mrt={kernelName:Wv,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>gt(r,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Drt={kernelName:Hv,inputsToSave:["images"],gradFunc:(r,t,n)=>{const[i]=t,o={dy:r,images:i};return{images:()=>ft.runKernel(c_,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rrt={kernelName:Gv,inputsToSave:["images"],gradFunc:(r,t,n)=>{const[i]=t,o={dy:r,images:i};return{images:()=>ft.runKernel(l_,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ort={kernelName:jv,gradFunc:(r,t,n)=>{const{dims:i}=n,o=on(i,r.shape);return{x:()=>Yu(r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lrt={kernelName:ag,gradFunc:r=>({x:()=>Sn(r)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Frt={kernelName:lg,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>fs($e(r,ct(Bd(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Prt={kernelName:qv,inputsToSave:["condition"],gradFunc:(r,t)=>{const[n]=t;return{condition:()=>de(Sn(n),"float32"),t:()=>ct(r,de(n,r.dtype)),e:()=>ct(r,de(H_(n),r.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Brt={kernelName:cg,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>{const i=Ui(n,Pe(0)),o=Pe(my),a=Pe(gy),l=ct(r,a),c=ct(ct(r,o),bo(de(n,"float32")));return vi(i,l,c)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zrt={kernelName:fg,outputsToSave:[!0],gradFunc:(r,t)=>{const[n]=t;return{x:()=>ct(r,ct(n,Se(Pe(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vrt={kernelName:dg,gradFunc:r=>({x:()=>Sn(r)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Urt={kernelName:ug,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>ct(B_(de(n,"float32")),r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wrt={kernelName:hg,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>ct(h9(de(n,"float32")),r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Grt={kernelName:Kv,inputsToSave:["x"],gradFunc:(r,t,n)=>{const[i]=t,{begin:o,size:a}=n,l=i.shape,[c,u]=oy(i,o,a),h=[];for(let d=0;d<r.rank;d++)h.push([c[d],l[d]-c[d]-u[d]]);return{x:()=>K_(r,h)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hrt={kernelName:Jv,outputsToSave:[!0],gradFunc:(r,t,n)=>{const[i]=t,{dim:o}=n,a=!0,l=ct(r,i);return{logits:()=>Se(l,ct(we(l,[o],a),i))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jrt={kernelName:pg,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>ct(r,pf(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _I={kernelName:Yv,gradFunc:(r,t,n)=>{const{blockShape:i,paddings:o}=n;return{x:()=>F_(r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TI={kernelName:Zv,gradFunc:(r,t,n)=>{const{axis:i}=n;return{x:()=>br(r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qrt={kernelName:mg,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>$e(r,ct(Br(de(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Krt={kernelName:p_,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>ct(r,ct(de(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xrt={kernelName:gg,inputsToSave:["a","b"],gradFunc:(r,t)=>{const[n,i]=t,o=Pe(2);return{a:()=>ct(r,ct(o,Se(n,i))),b:()=>ct(r,ct(o,Se(i,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yrt={kernelName:wg,gradFunc:r=>({x:()=>Sn(r)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zrt={kernelName:vg,inputsToSave:["a","b"],gradFunc:(r,t)=>{const[n,i]=t,o=qe(n.shape,i.shape);return{a:()=>{let c=r;const u=Fs(n.shape,o);return u.length>0&&(c=we(c,u)),gt(c,n.shape)},b:()=>{let c=r;const u=Fs(i.shape,o);return u.length>0&&(c=we(c,u)),gt(fs(c),i.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jrt={kernelName:Xv,inputsToSave:["x"],gradFunc:(r,t,n)=>{const[i]=t,o=i.shape.slice(),{axis:a}=n;on(a,i.shape).forEach(h=>{o[h]=1});const c=gt(r,o),u=ct(c,Vc(i.shape,"float32"));return{x:()=>u}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qrt={kernelName:yg,inputsToSave:["x"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>$e(r,jn(B_(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tit={kernelName:xg,outputsToSave:[!0],gradFunc:(r,t)=>{const[n]=t;return{x:()=>ct(Se(Pe(1),jn(n)),r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eit={kernelName:bg,inputsToSave:["x"],gradFunc:(r,t,n)=>{const[i]=t,{reps:o}=n;return{x:()=>{let l=Sn(i);if(i.rank===1)for(let c=0;c<o[0];++c)l=Xt(l,Fn(r,[c*i.shape[0]],[i.shape[0]]));else if(i.rank===2)for(let c=0;c<o[0];++c)for(let u=0;u<o[1];++u)l=Xt(l,Fn(r,[c*i.shape[0],u*i.shape[1]],[i.shape[0],i.shape[1]]));else if(i.rank===3)for(let c=0;c<o[0];++c)for(let u=0;u<o[1];++u)for(let h=0;h<o[2];++h)l=Xt(l,Fn(r,[c*i.shape[0],u*i.shape[1],h*i.shape[2]],[i.shape[0],i.shape[1],i.shape[2]]));else if(i.rank===4)for(let c=0;c<o[0];++c)for(let u=0;u<o[1];++u)for(let h=0;h<o[2];++h)for(let d=0;d<o[3];++d)l=Xt(l,Fn(r,[c*i.shape[0],u*i.shape[1],h*i.shape[2],d*i.shape[3]],[i.shape[0],i.shape[1],i.shape[2],i.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${i.rank} tensors yet.`);return l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nit={kernelName:wd,gradFunc:(r,t,n)=>{const i=n,{perm:o}=i,a=Bc(o);return{x:()=>vn(r,a)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sit={kernelName:Qv,gradFunc:(r,t,n)=>{const i=n,{axis:o}=i;return{value:()=>_c(r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rit={kernelName:ty,inputsToSave:["segmentIds"],gradFunc:(r,t)=>{const[n]=t;return{x:()=>iit(r,n)}}};function iit(r,t){const n=zc(t,Sn(t)),i=U_(r,n);let o=bh(t,Pe(0,"int32"));const a=i.rank-o.rank;for(let c=0;c<a;++c)o=ui(o,c+1);o=wl(o,Vc(i.shape,"bool"));const l=Sn(i);return vi(o,i,l)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oit={kernelName:ey,gradFunc:r=>({x:()=>Sn(r)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ait=[c8,rst,ist,ost,ast,lst,cst,ust,hst,dst,fst,pst,vst,bst,wst,Sst,_st,Tst,Cst,kst,$st,Ist,Nst,Est,Dst,Rst,Ost,Lst,Fst,Pst,Irt,Bst,zst,Vst,Ust,Wst,Hst,Gst,jst,qst,Kst,Xst,Yst,Zst,Jst,Qst,trt,ert,nrt,irt,wI,wI,ort,crt,drt,frt,prt,mrt,grt,vrt,yrt,xrt,brt,wrt,Srt,SI,SI,_rt,Trt,$rt,Ert,Nrt,Art,Mrt,Drt,Rrt,Ort,Lrt,Frt,Prt,Brt,zrt,Vrt,Urt,Wrt,Grt,Hrt,jrt,_I,_I,TI,TI,qrt,Xrt,Krt,Yrt,Zrt,Jrt,Qrt,tit,eit,nit,sit,rit,oit];for(const r of ait)hY(r);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.abs=function(){return this.throwIfDisposed(),Ws(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.acos=function(){return this.throwIfDisposed(),FZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.acosh=function(){return this.throwIfDisposed(),BZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.add=function(r){return this.throwIfDisposed(),Xt(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.all=function(r,t){return this.throwIfDisposed(),a9(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.any=function(r,t){return this.throwIfDisposed(),Z3(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.argMax=function(r){return this.throwIfDisposed(),Xp(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.argMin=function(r){return this.throwIfDisposed(),GZ(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.asScalar=function(){return this.throwIfDisposed(),W(this.size===1,()=>"The array must have only 1 element."),gt(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.asType=function(r){return this.throwIfDisposed(),de(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.as1D=function(){return this.throwIfDisposed(),gt(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.as2D=function(r,t){return this.throwIfDisposed(),gt(this,[r,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.as3D=function(r,t,n){return this.throwIfDisposed(),gt(this,[r,t,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.as4D=function(r,t,n,i){return this.throwIfDisposed(),gt(this,[r,t,n,i])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.as5D=function(r,t,n,i,o){return this.throwIfDisposed(),gt(this,[r,t,n,i,o])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.asin=function(){return this.throwIfDisposed(),jZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.asinh=function(){return this.throwIfDisposed(),KZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.atan=function(){return this.throwIfDisposed(),YZ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.atan2=function(r){return this.throwIfDisposed(),JZ(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.atanh=function(){return this.throwIfDisposed(),tJ(this)};It().prototype.avgPool=function(r,t,n,i){return this.throwIfDisposed(),O_(this,r,t,n,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.batchToSpaceND=function(r,t){return this.throwIfDisposed(),F_(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.batchNorm=function(r,t,n,i,o){return this.throwIfDisposed(),ay(this,r,t,n,i,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.broadcastTo=function(r){return this.throwIfDisposed(),Mp(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.cast=function(r){return this.throwIfDisposed(),de(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.ceil=function(){return this.throwIfDisposed(),kJ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.clipByValue=function(r,t){return this.throwIfDisposed(),zi(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.concat=function(r,t){return this.throwIfDisposed(),r instanceof Cs&&(r=[r]),br([this,...r],t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.conv1d=function(r,t,n,i,o,a){return this.throwIfDisposed(),l9(this,r,t,n,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.conv2dTranspose=function(r,t,n,i,o){return this.throwIfDisposed(),c9(this,r,t,n,i,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.conv2d=function(r,t,n,i,o,a){return this.throwIfDisposed(),Ku(this,r,t,n,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.cos=function(){return this.throwIfDisposed(),B_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.cosh=function(){return this.throwIfDisposed(),h9(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.cumprod=function(r,t,n){return this.throwIfDisposed(),Q3(this,r,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.cumsum=function(r,t,n){return this.throwIfDisposed(),d9(this,r,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.depthToSpace=function(r,t){return this.throwIfDisposed(),ZJ(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.depthwiseConv2d=function(r,t,n,i,o,a){return this.throwIfDisposed(),z_(this,r,t,n,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.dilation2d=function(r,t,n,i,o){return this.throwIfDisposed(),tQ(this,r,t,n,i,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.divNoNan=function(r){return this.throwIfDisposed(),iQ(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.div=function(r){return this.throwIfDisposed(),$e(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.dot=function(r){return this.throwIfDisposed(),aQ(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.elu=function(){return this.throwIfDisposed(),ly(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.equal=function(r){return this.throwIfDisposed(),Pa(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.erf=function(){return this.throwIfDisposed(),uQ(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.euclideanNorm=function(r,t){return this.throwIfDisposed(),xQ(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.exp=function(){return this.throwIfDisposed(),bo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.expandDims=function(r){return this.throwIfDisposed(),ui(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.expm1=function(){return this.throwIfDisposed(),_Q(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.fft=function(){return this.throwIfDisposed(),E9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.flatten=function(){return this.throwIfDisposed(),gt(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.floor=function(){return this.throwIfDisposed(),uy(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.floorDiv=function(r){return this.throwIfDisposed(),o9(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.gather=function(r,t){return this.throwIfDisposed(),U_(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.greaterEqual=function(r){return this.throwIfDisposed(),bh(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.greater=function(r){return this.throwIfDisposed(),Ui(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.ifft=function(){return this.throwIfDisposed(),aw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.irfft=function(){return this.throwIfDisposed(),het(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.isFinite=function(){return this.throwIfDisposed(),AQ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.isInf=function(){return this.throwIfDisposed(),DQ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.isNaN=function(){return this.throwIfDisposed(),OQ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.leakyRelu=function(r){return this.throwIfDisposed(),W_(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.lessEqual=function(r){return this.throwIfDisposed(),mf(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.less=function(r){return this.throwIfDisposed(),g9(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.localResponseNormalization=function(r,t,n,i){return this.throwIfDisposed(),zQ(this,r,t,n,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.logSigmoid=function(){return this.throwIfDisposed(),jQ(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.logSoftmax=function(r){return this.throwIfDisposed(),v9(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.logSumExp=function(r,t){return this.throwIfDisposed(),y9(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.log=function(){return this.throwIfDisposed(),wo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.log1p=function(){return this.throwIfDisposed(),G_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.logicalAnd=function(r){return this.throwIfDisposed(),wl(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.logicalNot=function(){return this.throwIfDisposed(),H_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.logicalOr=function(r){return this.throwIfDisposed(),x9(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.logicalXor=function(r){return this.throwIfDisposed(),ttt(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.matMul=function(r,t,n){return this.throwIfDisposed(),Nn(this,r,t,n)};It().prototype.maxPool=function(r,t,n,i){return this.throwIfDisposed(),j_(this,r,t,n,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.max=function(r,t){return this.throwIfDisposed(),Ko(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.maximum=function(r){return this.throwIfDisposed(),zc(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.mean=function(r,t){return this.throwIfDisposed(),bs(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.min=function(r,t){return this.throwIfDisposed(),l2(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.minimum=function(r){return this.throwIfDisposed(),hy(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.mirrorPad=function(r,t){return this.throwIfDisposed(),ltt(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.mod=function(r){return this.throwIfDisposed(),utt(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.mul=function(r){return this.throwIfDisposed(),ct(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.neg=function(){return this.throwIfDisposed(),fs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.norm=function(r,t,n){return this.throwIfDisposed(),cy(this,r,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.notEqual=function(r){return this.throwIfDisposed(),Yp(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.oneHot=function(r,t=1,n=0){return this.throwIfDisposed(),XR(this,r,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.onesLike=function(){return this.throwIfDisposed(),So(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.pad=function(r,t){return this.throwIfDisposed(),K_(this,r,t)};It().prototype.pool=function(r,t,n,i,o,a){return this.throwIfDisposed(),xtt(this,r,t,n,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.pow=function(r){return this.throwIfDisposed(),Bd(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.prelu=function(r){return this.throwIfDisposed(),Y_(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.prod=function(r,t){return this.throwIfDisposed(),Stt(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.reciprocal=function(){return this.throwIfDisposed(),Gtt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.relu=function(){return this.throwIfDisposed(),Ml(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.relu6=function(){return this.throwIfDisposed(),w9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.reshapeAs=function(r){return this.throwIfDisposed(),gt(this,r.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.reshape=function(r){return this.throwIfDisposed(),gt(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.resizeBilinear=function(r,t,n){return this.throwIfDisposed(),L9(this,r,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.resizeNearestNeighbor=function(r,t,n){return this.throwIfDisposed(),F9(this,r,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.reverse=function(r){return this.throwIfDisposed(),Yu(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.rfft=function(){return this.throwIfDisposed(),N9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.round=function(){return this.throwIfDisposed(),S9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.rsqrt=function(){return this.throwIfDisposed(),_9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.selu=function(){return this.throwIfDisposed(),T9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.separableConv2d=function(r,t,n,i,o,a){return this.throwIfDisposed(),C9(this,r,t,n,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.sigmoid=function(){return this.throwIfDisposed(),pf(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.sign=function(){return this.throwIfDisposed(),Qtt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.sin=function(){return this.throwIfDisposed(),k9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.sinh=function(){return this.throwIfDisposed(),$9(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.slice=function(r,t){return this.throwIfDisposed(),Fn(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.softmax=function(r){return this.throwIfDisposed(),Q_(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.softplus=function(){return this.throwIfDisposed(),Cg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.spaceToBatchND=function(r,t){return this.throwIfDisposed(),X_(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.split=function(r,t){return this.throwIfDisposed(),Li(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.sqrt=function(){return this.throwIfDisposed(),Br(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.square=function(){return this.throwIfDisposed(),jn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.squaredDifference=function(r){return this.throwIfDisposed(),A9(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.squeeze=function(r){return this.throwIfDisposed(),kg(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.stack=function(r,t){this.throwIfDisposed();const n=r instanceof Cs?[this,r]:[this,...r];return _c(n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.step=function(r){return this.throwIfDisposed(),$g(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.stridedSlice=function(r,t,n,i,o,a,l,c){return this.throwIfDisposed(),xet(this,r,t,n,i,o,a,l,c)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.sub=function(r){return this.throwIfDisposed(),Se(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.sum=function(r,t){return this.throwIfDisposed(),we(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.tan=function(){return this.throwIfDisposed(),wet(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.tanh=function(){return this.throwIfDisposed(),L_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.tile=function(r){return this.throwIfDisposed(),Wo(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.toBool=function(){return this.throwIfDisposed(),de(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.toFloat=function(){return this.throwIfDisposed(),de(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.toInt=function(){return this.throwIfDisposed(),de(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.topk=function(r,t){return this.throwIfDisposed(),Tet(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.transpose=function(r){return this.throwIfDisposed(),vn(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.unique=function(r){return this.throwIfDisposed(),$et(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.unsortedSegmentSum=function(r,t){return this.throwIfDisposed(),D9(this,r,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.unstack=function(r){return this.throwIfDisposed(),Zu(this,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.where=function(r,t){return this.throwIfDisposed(),vi(r,this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */It().prototype.zerosLike=function(){return this.throwIfDisposed(),Sn(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class xa extends Error{constructor(t){super(t),Object.setPrototypeOf(this,xa.prototype)}}class fo extends Error{constructor(t){super(t),Object.setPrototypeOf(this,fo.prototype)}}class dt extends Error{constructor(t){super(t),Object.setPrototypeOf(this,dt.prototype)}}class je extends Error{constructor(t){super(t),Object.setPrototypeOf(this,je.prototype)}}class RT extends Error{constructor(t){super(t),Object.setPrototypeOf(this,RT.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class h8{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let n;return this.cache.has(t)&&(n=this.cache.get(t),this.cache.delete(t),this.cache.set(t,n)),n}put(t,n){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const i=this.cache.keys().next().value;this.cache.delete(i)}this.cache.set(t,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let n=0;n<this.maxEntries-t;n++){const i=this.cache.keys().next().value;this.cache.delete(i)}this.maxEntries=t}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qu(r,t){if(Array.isArray(r)){let n=[];for(let i=0;i<t;i++)n=n.concat(r);return n}else{const n=new Array(t);return n.fill(r),n}}function ba(r,t){if(!r)throw new RT(t)}function CI(r,t){let n=0;for(const i of r)i===t&&n++;return n}function Xr(r){return r.length===1?r[0]:r}function ts(r){return Array.isArray(r)?r:[r]}function sl(r){const n=r.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function mu(r){return r.length<=1||r.indexOf("_")===-1?r:r.replace(/[_]+(\w|$)/g,(t,n)=>n.toUpperCase())}let Ki={};function OT(r){if(r==null)return null;const t={};return t.className=r.getClassName(),t.config=r.getConfig(),t}function cw(r){if(!(r==null||typeof r!="object"))if(Array.isArray(r))r.forEach(t=>cw(t));else{const t=Object.keys(r);for(const n of t){const i=r[n];i!=null&&typeof i=="object"&&(!Array.isArray(i)&&i.type==="ndarray"&&typeof i.value=="number"?r[n]=i.value:cw(i))}}}function Ag(r,t={},n={},i="object",o=!1){if(typeof r=="string"){const a=r;let l;if(a in n)l=n[a];else if(a in Ki)l=Ki[a];else if(l=t[a],l==null)throw new dt(`Unknown ${i}: ${r}. This may be due to one of the following reasons:
1. The ${i} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${i} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return l}else{const a=r;if(a.className==null||a.config==null)throw new dt(`${i}: Improper config format: ${JSON.stringify(a)}.
'className' and 'config' must set.`);const l=a.className;let c,u;if(l in n?[c,u]=n[l]:l in Ki?[c,u]=Ki.className:l in t&&([c,u]=t[l]),c==null)throw new dt(`Unknown ${i}: ${l}. This may be due to one of the following reasons:
1. The ${i} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${i} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(u!=null){const h={};for(const m of Object.keys(Ki))h[m]=Ki[m];for(const m of Object.keys(n))h[m]=n[m];const d=a.config;d.customObjects=h;const f=Object.assign({},Ki);for(const m of Object.keys(n))Ki[m]=n[m];cw(a.config);const p=u(c,a.config,n,o);return Ki=Object.assign({},f),p}else{const h=Object.assign({},Ki);for(const f of Object.keys(n))Ki[f]=n[f];const d=new c(a.config);return Ki=Object.assign({},h),d}}}function lit(r,t){return r<t?-1:r>t?1:0}function R0(r,t){return-1*lit(r,t)}function dc(r){if(r==null)return r;const t=[];for(const n of r)t.indexOf(n)===-1&&t.push(n);return t}function cit(r){if(r==null)throw new dt(`Invalid value in obj: ${JSON.stringify(r)}`);for(const t in r)if(r.hasOwnProperty(t))return!1;return!0}function Sh(r,t,n){if(n!=null&&r.indexOf(n)<0)throw new dt(`${n} is not a valid ${t}.  Valid values are ${r} or null/undefined.`)}function LT(r,t,n=0,i=1/0){return ba(n>=0),ba(i>=n),Array.isArray(r)&&r.length>=n&&r.length<=i&&r.every(o=>typeof o===t)}function js(r,t){Array.isArray(r)?(W(r.length>0,()=>`${t} is unexpectedly an empty array.`),r.forEach((n,i)=>js(n,`element ${i+1} of ${t}`))):W(Number.isInteger(r)&&r>0,()=>`Expected ${t} to be a positive integer, but got ${d8(r)}.`)}function d8(r){return r===null?"null":Array.isArray(r)?"["+r.map(t=>d8(t)).join(",")+"]":typeof r=="string"?`"${r}"`:`${r}`}function uit(r,t,n){let i=n!=null?n():Kr(),o;return(...l)=>{const c=n!=null?n():Kr();return c-i<t||(i=c,o=r(...l)),o}}function f8(r){return r==="relu"?"relu":r==="linear"?"linear":r==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let hit=0;function p8(){return hit++}const O0={};function vy(r=""){return r in O0||(O0[r]=0),O0[r]+=1,r+O0[r].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const dit=["channelsFirst","channelsLast"],fit=["nearest","bilinear"],pit=["valid","same","causal"],mit=["max","avg"],git=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Vh=new Map;function Ts(r){Sh(dit,"DataFormat",r)}function vit(r){Sh(fit,"InterpolationFormat",r)}function Wi(r){Sh(pit,"PaddingMode",r)}function m8(r){Sh(mit,"PoolMode",r)}const Dp=[],kI="/";function Du(r,t){Dp.push(r);try{const n=t();return Dp.pop(),n}catch(n){throw Dp.pop(),n}}function yit(){return Dp.length===0?"":Dp.join(kI)+kI}function g8(r){if(!y8(r))throw new Error("Not a valid tensor name: '"+r+"'");return yit()+r}function v8(r){if(!y8(r))throw new Error("Not a valid tensor name: '"+r+"'");Vh.has(r)||Vh.set(r,0);const t=Vh.get(r);if(Vh.set(r,Vh.get(r)+1),t>0){const n=`${r}_${t}`;return Vh.set(n,1),n}else return r}const xit=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function y8(r){return!!r.match(xit)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bit(r){return r===parseInt(r.toString(),10)}function fc(r,t,n){t==null&&(t=0),n==null&&(n=r.length);let i=1;for(let o=t;o<n;++o)i*=r[o];return i}function zd(r){if(r.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<r.length;n++){const i=r[n];i<t&&(t=i)}return t}function Tc(r){if(r.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n++){const i=r[n];i>t&&(t=i)}return t}function Qo(r,t){if(t<r)throw new dt(`end (${t}) < begin (${r}) is forbidden.`);const n=[];for(let i=r;i<t;++i)n.push(i);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Bx;function Ds(){return Bx==null&&(Bx=bZ().epsilon()),Bx}function ta(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Da(r,t){return de(r,t)}function Mg(r,t=-1){const n=r.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),gt(r,n)}function wit(r,t){return _t(()=>{if(r.shape.length!==2)throw new dt(`repeat() expects a rank-2 tensor, but received a rank-${r.shape.length} tensor.`);const n=Mg(r,1);return uw(n,[1,t,1])})}function Sit(r){const t=[fc(r.shape)];return gt(r,t)}function _it(r){if(r.rank<=1)throw new dt(`batchFlatten requires a minimum rank of 2. Got rank: ${r.rank}.`);const t=[r.shape[0],fc(r.shape,1)];return gt(r,t)}function Ru(r,t,n){return _t(()=>{switch(r.rank){case 1:return Z_(r,t,n);case 2:return I9(r,[t,0],[n,r.shape[1]]);case 3:return J_(r,[t,0,0],[n,r.shape[1],r.shape[2]]);case 4:return c2(r,[t,0,0,0],[n,r.shape[1],r.shape[2],r.shape[3]]);case 5:return Fn(r,[t,0,0,0,0],[n,r.shape[1],r.shape[2],r.shape[3],r.shape[4]]);case 6:return Fn(r,[t,0,0,0,0,0],[n,r.shape[1],r.shape[2],r.shape[3],r.shape[4],r.shape[5]]);default:throw new dt(`sliceAlongFirstAxis() received an unsupported tensor rank: ${r.rank}`)}})}function zx(r,t,n){return _t(()=>{switch(r.rank){case 1:return Z_(r,t,n);case 2:return I9(r,[0,t],[r.shape[0],n]);case 3:return J_(r,[0,0,t],[r.shape[0],r.shape[1],n]);case 4:return c2(r,[0,0,0,t],[r.shape[0],r.shape[1],r.shape[2],n]);default:throw new dt(`sliceAlongLastAxis() received an unsupported tensor rank: ${r.rank}`)}})}function L0(r,t,n,i){return _t(()=>{switch(r.rank){case 1:return Z_(r,t,n);case 2:switch(i){case 1:return Ru(r,t,n);case 2:return zx(r,t,n);default:throw new dt(`The axis is not within the rank of the tensor ${i}`)}case 3:switch(i){case 1:return Ru(r,t,n);case 2:return J_(r,[0,t,0],[r.shape[0],n,r.shape[2]]);case 3:return zx(r,t,n);default:throw new dt(`The axis is not within the rank of the tensor ${i}`)}case 4:switch(i){case 1:return Ru(r,t,n);case 2:return c2(r,[0,t,0,0],[r.shape[0],n,r.shape[2],r.shape[3]]);case 3:return c2(r,[0,0,t,0],[r.shape[0],r.shape[1],n,r.shape[3]]);case 4:return zx(r,t,n);default:throw new dt(`The axis is not within the rank of the tensor ${i}`)}default:throw new dt(`sliceAlongLastAxis() received an unsupported tensor rank: ${r.rank}`)}})}function FT(r,t=-1){let n;return t<0&&(n=r[0].rank,n!==0?t=n:t=0),t===r[0].rank&&(t=-1),br(r,t)}function $I(r,t){switch(r.rank){case 1:return EJ([r,t]);case 2:return AJ([r,t],0);case 3:return DJ([r,t],0);case 4:return OJ([r,t],0);default:throw new dt(`concatAlongFirstAxis() received an unsupported tensor rank: ${r.rank}`)}}function uw(r,t){if(Array.isArray(t)||(t=[t]),r.rank!==t.length)throw new dt(`The length of input n (${t.length}) does not match the number of dimensions in input x (${r.rank})`);return Wo(r,t)}function yy(r,t=0,n=1,i,o){return Vtt(r,t,n,i,o)}function Ra(r,t,n,i){if(r.rank<2||t.rank<2)throw new je(`dot requires both inputs to be rank >= 2 but got x shape = ${r.shape} and y shape = ${t.shape}`);if(t.rank>=3){const o=r.shape.slice(-1)[0],a=t.shape.slice(-2)[0];if(o!==a)throw new je(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${r.shape} and  y shape = ${t.shape}`)}if(r.rank===2&&t.rank===2)return pI({a:r,b:t,transposeA:!1,transposeB:!1,bias:i?hw(r.rank,i,ta()):null,activation:n});{const o=r.shape.slice(),a=o.pop();r=gt(r,[-1,a]);const l=t.shape.slice(),c=l.pop(),u=l.pop(),h=[...l,c],d=Array.from({length:t.rank},(g,y)=>y===0?t.rank-2:y<=t.rank-2?y-1:y);t=gt(vn(t,d),[u,-1]);const f=[...o,...h];return gt(pI({a:r,b:t,transposeA:!1,transposeB:!1,bias:i?hw(r.rank,i,ta()):null,activation:n}),f)}}function x8(r,t,n){return _t(()=>(Array.isArray(t)?t=pi(t,"int32"):t=de(t,"int32"),U_(r,t,n)))}function Dg(r){return ct(r,r)}function hw(r,t,n){const i=t.shape;if(t.rank!==1&&t.rank!==r)throw new dt(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${r}`);if(r===5){if(n==="channelsFirst")return i.length===1?gt(t,[1,i[0],1,1,1]):gt(t,[1,i[3],i[0],i[1],i[2]]);if(n==="channelsLast")return i.length===1?gt(t,[1,1,1,1,i[0]]):gt(t,[1].concat(i))}else if(r===4){if(n==="channelsFirst")return i.length===1?gt(t,[1,i[0],1,1]):gt(t,[1,i[2],i[0],i[1]]);if(n==="channelsLast")return i.length===1?gt(t,[1,1,1,i[0]]):gt(t,[1].concat(i))}else if(r===3){if(n==="channelsFirst")return i.length===1?gt(t,[1,i[0],1]):gt(t,[1,i[1],i[0]]);if(n==="channelsLast")return i.length===1?gt(t,[1,1,i[0]]):gt(t,[1].concat(i))}else if(r<3)return t;throw new dt(`Unsupported input rank by biasAdd: ${t.rank}`)}function ca(r,t,n){return _t(()=>(n==null&&(n=ta()),Ts(n),Xt(r,hw(r.rank,t,n))))}function Tit(r,t=1){if(t!==1)throw new je(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return ly(r)}function Cit(r){return _t(()=>$e(r,Xt(Ws(r),1)))}function b8(r,t,n,i){return _t(()=>Det(r,t,n,i))}function kit(r){return _t(()=>{const t=Xt(.5,ct(.2,r));return zi(t,0,1)})}function Rg(r,t,n=!1){return n?r():t()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const $it=["fanIn","fanOut","fanAvg"],Iit=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Eit(r){Sh($it,"FanMode",r)}function Nit(r){Sh(Iit,"Distribution",r)}class $o extends ff{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class w8 extends $o{apply(t,n){return Hs(t,n)}}w8.className="Zeros";Gt(w8);class PT extends $o{apply(t,n){return Vc(t,n)}}PT.className="Ones";Gt(PT);class S8 extends $o{constructor(t){if(super(),typeof t!="object")throw new dt(`Expected argument of type ConstantConfig but got ${t}`);if(t.value===void 0)throw new dt(`config must have value set but got ${t}`);this.value=t.value}apply(t,n){return _t(()=>ct(Pe(this.value),Vc(t,n)))}getConfig(){return{value:this.value}}}S8.className="Constant";Gt(S8);class _8 extends $o{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,n){return dy(t,this.minval,this.maxval,n)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}_8.className="RandomUniform";Gt(_8);class T8 extends $o{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new je(`randomNormal does not support dType ${n}.`);return yy(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}T8.className="RandomNormal";Gt(T8);class C8 extends $o{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new je(`truncatedNormal does not support dType ${n}.`);return M9(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}C8.className="TruncatedNormal";Gt(C8);let k8=class extends $o{constructor(t){super(),this.gain=t.gain!=null?t.gain:1}apply(t,n){return _t(()=>{if(t.length!==2||t[0]!==t[1])throw new dt("Identity matrix initializer can only be used for 2D square matrices.");return ct(this.gain,m9(t[0]))})}getConfig(){return{gain:this.gain}}};k8.className="Identity";Gt(k8);function Ait(r,t="channelsLast"){let n,i;if(Ts(t),r.length===2)n=r[0],i=r[1];else if([3,4,5].indexOf(r.length)!==-1){if(t==="channelsFirst"){const o=fc(r,2);n=r[1]*o,i=r[0]*o}else if(t==="channelsLast"){const o=fc(r,0,r.length-2);n=r[r.length-2]*o,i=r[r.length-1]*o}}else{const o=fc(r);n=Math.sqrt(o),i=Math.sqrt(o)}return[n,i]}class yi extends $o{constructor(t){if(super(),t.scale<0)throw new dt(`scale must be a positive float. Got: ${t.scale}`);this.scale=t.scale==null?1:t.scale,this.mode=t.mode==null?"fanIn":t.mode,Eit(this.mode),this.distribution=t.distribution==null?"normal":t.distribution,Nit(this.distribution),this.seed=t.seed}apply(t,n){const i=Ait(t),o=i[0],a=i[1];let l=this.scale;if(this.mode==="fanIn"?l/=Math.max(1,o):this.mode==="fanOut"?l/=Math.max(1,a):l/=Math.max(1,(o+a)/2),this.distribution==="normal"){const c=Math.sqrt(l);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new je(`${this.getClassName()} does not support dType ${n}.`);return M9(t,0,c,n,this.seed)}else{const c=Math.sqrt(3*l);return dy(t,-c,c,n)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}yi.className="VarianceScaling";Gt(yi);class BT extends yi{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return yi.className}}BT.className="GlorotUniform";Gt(BT);class zT extends yi{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return yi.className}}zT.className="GlorotNormal";Gt(zT);class VT extends yi{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return yi.className}}VT.className="HeNormal";Gt(VT);class UT extends yi{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return yi.className}}UT.className="HeUniform";Gt(UT);class WT extends yi{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return yi.className}}WT.className="LeCunNormal";Gt(WT);class GT extends yi{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return yi.className}}GT.className="LeCunNormal";Gt(GT);class $8 extends $o{constructor(t){if(super(),this.DEFAULT_GAIN=1,this.gain=t.gain==null?this.DEFAULT_GAIN:t.gain,this.seed=t.seed,this.seed!=null)throw new je("Random seed is not implemented for Orthogonal Initializer yet.")}apply(t,n){return _t(()=>{if(t.length<2)throw new je("Shape must be at least 2D.");t[0]*t[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${t[0]*t[1]}) elements: Slowness may result.`);const i=t[0]>t[1]?[t[1],t[0]]:t,o=yy(i,0,1,"float32");let a=Jnt.gramSchmidt(o);return t[0]>t[1]&&(a=vn(a)),ct(this.gain,a)})}getConfig(){return{gain:this.gain,seed:this.seed}}}$8.className="Orthogonal";Gt($8);const II={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function EI(r,t={}){return Ag(r,ro.getMap().classNameMap,t,"initializer")}function ds(r){return OT(r)}function is(r){if(typeof r=="string"){const t=r in II?II[r]:r;if(t==="GlorotNormal")return new zT;if(t==="GlorotUniform")return new BT;if(t==="HeNormal")return new VT;if(t==="HeUniform")return new UT;if(t==="LeCunNormal")return new WT;if(t==="LeCunUniform")return new GT;{const n={};return n.className=t,n.config={},EI(n)}}else return r instanceof $o?r:EI(r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function dw(r){return Array.isArray(r)&&Array.isArray(r[0])}function u2(r){return r.length===0?[]:Array.isArray(r[0])?r:[r]}function Fe(r){let t;if(Array.isArray(r)){if(r.length!==1)throw new dt(`Expected Tensor length to be 1; got ${r.length}`);t=r[0]}else t=r;return t}function In(r){if(Array.isArray(r)&&Array.isArray(r[0])){if(r.length===1)return r=r,r[0];throw new dt(`Expected exactly 1 Shape; got ${r.length}`)}else return r}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function h2(r){let t=0;for(const n of r)n.shape.length===0?t+=1:t+=n.shape.reduce((i,o)=>i*o);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const NI="Variable";class Mit{constructor(t,n="float32",i=NI,o=!0,a=null){this.dtype=n??"float32",this.shape=t.shape,this.id=p8(),i=i??NI,this.originalName=g8(i),this.name=v8(this.originalName),this.trainable_=o,this.constraint=a,this.val=Net(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),Dit(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function Dit(r,t){if(r.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(r.shape)+" vs. "+JSON.stringify(t.shape))}function fw(r){return r.map(t=>t.read())}function HT(r){r.forEach(t=>{t[0].write(t[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Rs{constructor(t){this.dtype=t.dtype,this.shape=t.shape,t.shape!=null?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class Ca{constructor(t,n,i,o,a,l,c){this.dtype=t,this.shape=n,this.sourceLayer=i,this.inputs=o,this.callArgs=a,this.outputTensorIndex=c,this.id=p8(),l!=null&&(this.originalName=g8(l),this.name=v8(this.originalName)),this.rank=n.length}}let Rit=0;class xy{constructor(t,n){this.callArgs=n,this.id=Rit++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const i of t.inboundLayers)i!=null&&i.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const n of this.inboundLayers)n!=null?t.push(n.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let Oit=0;class un extends ff{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Oit++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=t.name;if(!n){const i=this.getClassName();n=sl(i)+"_"+vy(i)}if(this.name=n,this.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){let i;if(t.batchInputShape!=null)i=t.batchInputShape;else if(t.inputShape!=null){let a=null;t.batchSize!=null&&(a=t.batchSize),i=[a].concat(t.inputShape)}this.batchInputShape=i;let o=t.dtype;o==null&&(o=t.inputDType),o==null&&(o="float32"),this.dtype=o}t.weights!=null?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,n){return t.name+"_ib-"+n.toString()}getNodeAtIndex(t,n){if(this.inboundNodes.length===0)throw new fo(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=t)throw new dt(`Asked to get ${n} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return Xr(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return Xr(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new xa(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new xa(`Layer ${this.name} is not connected, no input to return.`);return Xr(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new xa(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new xa(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Xr(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(n=>n.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=ts(t),this.inputSpec==null||this.inputSpec.length===0)return;const n=ts(this.inputSpec);if(t.length!==n.length)throw new dt(`Layer ${this.name} expects ${n.length} inputs, but it received ${t.length} input tensors. Input received: ${t}`);for(let i=0;i<t.length;i++){const o=t[i],a=n[i];if(a==null)continue;const l=o.rank;if(a.ndim!=null&&l!==a.ndim)throw new dt(`Input ${i} is incompatible with layer ${this.name}: expected ndim=${a.ndim}, found ndim=${l}`);if(a.maxNDim!=null&&l>a.maxNDim)throw new dt(`Input ${i} is incompatible with layer ${this.name}: expected max_ndim=${a.maxNDim}, found ndim=${l}`);if(a.minNDim!=null&&l<a.minNDim)throw new dt(`Input ${i} is incompatible with layer ${this.name}: expected min_ndim=${a.minNDim}, found ndim=${l}.`);if(a.dtype!=null&&o.dtype!==a.dtype)throw new dt(`Input ${i} is incompatible with layer ${this.name} : expected dtype=${a.dtype}, found dtype=${o.dtype}.`);if(a.axes){const c=o.shape;for(const u in a.axes){const h=Number(u),d=a.axes[u],f=h>=0?c[h]:c[c.length+h];if(d!=null&&[d,null].indexOf(f)===-1)throw new dt(`Input ${i} is incompatible with layer ${this.name}: expected axis ${h} of input shape to have value ${d} but got shape ${c}.`)}}if(a.shape!=null)for(let c=0;c<a.shape.length;++c){const u=a.shape[c],h=o.shape[c];if(u!=null&&h!=null&&u!==h)throw new dt(`Input ${i} is incompatible with layer ${this.name}: expected shape=${a.shape}, found shape=${o.shape}.`)}}}call(t,n){return t}invokeCallHook(t,n){this._callHook!=null&&this._callHook(t,n)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,n){n=n||{},this.assertNotDisposed();const i=ts(t);let o=!0;for(const l of i)if(!(l instanceof Ca)){o=!1;break}let a=!0;for(const l of i)if(l instanceof Ca){a=!1;break}if(o===a)throw new dt("Arguments to apply() must be all SymbolicTensors or all Tensors");return Du(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);const l=[];for(const c of ts(t))l.push(c.shape);this.build(Xr(l)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&a&&(this._refCount=1)}if(this.assertInputCompatibility(t),a){let l=this.call(t,n);const c=ts(l),u=[];for(let h of c)i.indexOf(h)!==-1&&(h=h.clone()),u.push(h);if(l=Xr(u),this.activityRegularizer!=null)throw new je("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}else{const l=Lit(t),c=this.computeOutputShape(l);let u;const h=Fit(t);if(this.warnOnIncompatibleInputShape(Array.isArray(t)?l[0]:l),c!=null&&c.length>0&&Array.isArray(c[0])?u=c.map((d,f)=>new Ca(h,d,this,ts(t),n,this.name,f)):u=new Ca(h,c,this,ts(t),n,this.name),this.addInboundNode(t,u,null,null,l,c,n),this._refCount++,this.activityRegularizer!=null)throw new je("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return u}})}warnOnIncompatibleInputShape(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((i,o)=>{i!=null&&t[o]!=null&&t[o]!==i&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new xa(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const n of this.inboundNodes){const i=JSON.stringify(n.outputShapes);t.indexOf(i)===-1&&t.push(i)}if(t.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new xa(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new fo(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return h2(this.weights)}build(t){this.built=!0}getWeights(t=!1){return fw(t?this.trainableWeights:this.weights)}setWeights(t){_t(()=>{const n=this.weights;if(n.length!==t.length)throw new dt(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${n.length} weights. Provided weights: ${t}...`);if(n.length===0)return;const i=[],o=fw(n);for(let a=0;a<o.length;++a){const l=o[a],c=n[a],u=t[a];if(!An(l.shape,u.shape))throw new dt(`Layer weight shape ${l.shape} not compatible with provided weight shape ${u.shape}`);i.push([c,u])}HT(i)})}addWeight(t,n,i,o,a,l,c,u){if(this._addedWeightNames.indexOf(t)!==-1)throw new dt(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),i==null&&(i="float32"),this.fastWeightInitDuringBuild&&(o=u!=null?u():is("zeros"));const h=o.apply(n,i),d=new Mit(h,i,t,l,c);return h.dispose(),a!=null&&this.addLoss(()=>a.apply(d.read())),l==null&&(l=!0),l?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){t==null||Array.isArray(t)&&t.length===0||(t=ts(t),this._losses!==void 0&&this._losses!==null&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(i=>{if(i!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}addInboundNode(t,n,i,o,a,l,c=null){const u=ts(t);n=ts(n),i=ts(i),o=ts(o),a=u2(a),l=u2(l);const h=[],d=[],f=[];for(const p of u)h.push(p.sourceLayer),d.push(p.nodeIndex),f.push(p.tensorIndex);new xy({outboundLayer:this,inboundLayers:h,nodeIndices:d,tensorIndices:f,inputTensors:u,outputTensors:n,inputMasks:i,outputMasks:o,inputShapes:a,outputShapes:l},c);for(let p=0;p<n.length;p++)n[p].sourceLayer=this,n[p].nodeIndex=this.inboundNodes.length-1,n[p].tensorIndex=p}getConfig(){const t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function Lit(r){r=ts(r);const t=[];for(const n of r)t.push(n.shape);return Xr(t)}function Fit(r){return"float32"}function I8(r,t,n){if((t==null||n!=null&&n>0)&&(t=r.sourceLayer,n=r.nodeIndex),t.inboundNodes.length===0)return[r];{const i=t.inboundNodes[n];if(i.inboundLayers.length===0)return i.inputTensors;{const o=[];for(let a=0;a<i.inboundLayers.length;a++){const l=i.inputTensors[a],c=i.inboundLayers[a],u=i.nodeIndices[a],h=I8(l,c,u);for(const d of h)o.indexOf(d)===-1&&o.push(d)}return o}}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Og extends un{constructor(t){if(super({dtype:t.dtype,name:t.name!=null?t.name:vy("input").toString()}),t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new dt("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=t.batchInputShape;if(n==null){if(t.inputShape==null)throw new dt("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new dt("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const i=t.dtype||"float32";this.batchInputShape=n,this.dtype=i,this.inputSpec=[{shape:n}];const o=new Ca(this.dtype,this.batchInputShape,this,[],{},this.name);o.nodeIndex=0,o.tensorIndex=0,new xy({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(t,n){throw new dt(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Og.className="InputLayer";Gt(Og);function Pit(r){if(r.batchShape==null&&r.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(r.batchShape!=null&&r.shape!=null)throw new dt("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=r.batchShape;r.shape!=null&&t==null&&(t=[null].concat(r.shape));let n=r.dtype;return n==null&&(n="float32"),new Og({batchInputShape:t,name:r.name,dtype:n,sparse:r.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bit(r,t){if(r.dtype==null||r.dtype===t.dtype)return t;try{return de(t,r.dtype)}catch{throw new dt(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${r.name}' (${r.dtype}).`)}}class sc{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof sc)for(const n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(t==null)return;for(const n of t)this.add(n.key,n.value)}}add(t,n,i){if(this.id2Value[t.id]==null)this.id2Value[t.id]=Bit(t,n),this.name2Id[t.name]=t.id,i!=null&&(this.id2Mask[t.id]=i);else throw new dt(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof Ca){if(this.id2Value[t.id]==null)throw new dt(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{const n=this.name2Id[t];if(n==null)throw new dt(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[n]}}getMask(t){if(t instanceof Ca){if(this.id2Value[t.id]==null)throw new dt(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{const n=this.name2Id[t];if(n==null)throw new dt(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&ln(this.id2Mask)}}const d2=new h8,f2=new h8;function zit(r){d2!=null&&d2.setMaxEntries(r),f2!=null&&f2.setMaxEntries(r)}function bp(r,t,n,i){const o=n==null?!1:n.training,a=Array.isArray(r),l=a?r:[r],c=l.map(g=>g.name),u=[],h=t.names();for(const g of c)h.indexOf(g)!==-1?u.push(t.getValue(g)):u.push(null);i!=null&&(i.maxNumTensors=-1/0,i.minNumTensors=1/0);const d=c.join(",")+"|"+t.names().sort().join(",");let f=d2.get(d),p;if(f==null){const g=Vit(l,t);f=g.sorted,p=g.recipientCounts,d2.put(d,f),f2.put(d,p)}p={},o||Object.assign(p,f2.get(d));const m=new sc(t);for(let g=0;g<f.length;++g){if(i!=null){const I=X3().numTensors;I>i.maxNumTensors&&(i.maxNumTensors=I),I<i.minNumTensors&&(i.minNumTensors=I)}const y=f[g],v=y.sourceLayer;if(v instanceof Og)continue;const x=[],b=[],w=[];let S=!1;for(const I of y.inputs){const O=m.getValue(I),B=m.getMask(I);x.push(O),b.push(B),B!=null&&(S=!0),o||(p[I.name]--,p[I.name]===0&&!t.hasKey(I)&&c.indexOf(I.name)===-1&&!O.isDisposed&&I.sourceLayer.stateful!==!0&&w.push(O))}S&&(n=n||{},n.mask=b[0]);const _=ts(v.apply(x,n));let $=null;v.supportsMasking&&($=v.computeMask(x,b));const N=Wit(y),k=Array.isArray(N)?N:[N];for(let I=0;I<k.length;++I){m.hasKey(k[I])||m.add(k[I],_[I],Array.isArray($)?$[0]:$);const O=c.indexOf(k[I].name);O!==-1&&(u[O]=_[I])}o||ln(w)}return m.disposeMasks(),a?u:u[0]}function Vit(r,t){W(r!=null&&r.length>0,()=>"Expected at least one fetch, got none");let n=[],i={};if(r.length===1){const o=AI(r[0],t);n=o.sorted,i=o.recipientMap}else{const o=new Set;for(const a of r){const{sorted:l,recipientMap:c}=AI(a,t);for(const u of l)o.has(u.name)||(n.push(u),o.add(u.name));for(const u in c)i[u]==null&&(i[u]=new Set),c[u].forEach(h=>i[u].add(h))}}return{sorted:n,recipientCounts:Uit(i)}}function Uit(r){const t={};for(const n in r)t[n]=r[n].size;return t}function AI(r,t){const n=new Set,i=[],o={};for(const c of t.names())n.add(c);const a=[],l=[];for(a.push(r);a.length>0;){const c=a[a.length-1];if(n.has(c.name)){a.pop();continue}const u=l[l.length-1]===a.length-1;if(c.inputs.length===0||u)a.pop(),i.push(c),n.add(c.name),u&&l.pop();else{l.push(a.length-1);for(const h of c.inputs)o[h.name]==null&&(o[h.name]=new Set),o[h.name].add(c.name),!n.has(h.name)&&a.push(h)}}return{sorted:i,recipientMap:o}}function Wit(r){let t;if(r.sourceLayer.inboundNodes.length===1)t=r.sourceLayer.output;else{let n=null;for(let i=0;i<r.sourceLayer.inboundNodes.length;++i)for(const o of r.sourceLayer.inboundNodes[i].outputTensors)if(o.id===r.id){n=i;break}t=r.sourceLayer.getOutputAt(n)}return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Git=kt();Git.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,zit);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jT(r,t){return _t(()=>Br(we(ct(r,r),t,!0)))}class Lg extends ff{getConfig(){return{}}}class E8 extends Lg{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return _t(()=>{const n=jT(t,this.axis),i=zi(n,0,this.maxValue);return ct(t,$e(i,Xt(Ds(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}E8.className="MaxNorm";Gt(E8);class N8 extends Lg{constructor(t){super(),this.defaultAxis=0,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return _t(()=>$e(t,Xt(Ds(),jT(t,this.axis))))}getConfig(){return{axis:this.axis}}}N8.className="UnitNorm";Gt(N8);class A8 extends Lg{apply(t){return Ml(t)}}A8.className="NonNeg";Gt(A8);class M8 extends Lg{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=t.minValue!=null?t.minValue:this.defaultMinValue,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.rate=t.rate!=null?t.rate:this.defaultRate,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return _t(()=>{const n=jT(t,this.axis),i=Xt(ct(this.rate,zi(n,this.minValue,this.maxValue)),ct(1-this.rate,n));return ct(t,$e(i,Xt(Ds(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}M8.className="MinMaxNorm";Gt(M8);const MI={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Os(r){return OT(r)}function DI(r,t={}){return Ag(r,ro.getMap().classNameMap,t,"constraint")}function Ls(r){if(r==null)return null;if(typeof r=="string"){const n={className:r in MI?MI[r]:r,config:{}};return DI(n)}else return r instanceof Lg?r:DI(r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function ru(r){if(r==null)return;const t=[],n=[],i=[];for(const o in r){const a=r[o];if(typeof a!="number"){const l=a;t.push(l.data()),n.push(o),i.push(l)}}if(t.length>0){const o=await Promise.all(t);for(let a=0;a<o.length;++a)r[n[a]]=o[a][0];ln(i)}}function D8(r){if(r!=null)for(const t in r){const n=r[t];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var RI;(function(r){r[r.SILENT=0]="SILENT",r[r.VERBOSE=1]="VERBOSE"})(RI||(RI={}));const Hit=125;class Jp{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,n){}async onEpochEnd(t,n){}async onBatchBegin(t,n){}async onBatchEnd(t,n){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class jit{constructor(t,n=10){t==null&&(t=[]),this.callbacks=t,this.queueLength=n}append(t){this.callbacks.push(t)}setParams(t){for(const n of this.callbacks)n.setParams(t)}setModel(t){for(const n of this.callbacks)n.setModel(t)}async onEpochBegin(t,n){n==null&&(n={});for(const i of this.callbacks)await i.onEpochBegin(t,n)}async onEpochEnd(t,n){n==null&&(n={});for(const i of this.callbacks)await i.onEpochEnd(t,n)}async onBatchBegin(t,n){n==null&&(n={});for(const i of this.callbacks)await i.onBatchBegin(t,n)}async onBatchEnd(t,n){n==null&&(n={});for(const i of this.callbacks)await i.onBatchEnd(t,n)}async onTrainBegin(t){t==null&&(t={});for(const n of this.callbacks)await n.onTrainBegin(t)}async onTrainEnd(t){t==null&&(t={});for(const n of this.callbacks)await n.onTrainEnd(t)}}class qit extends Jp{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,n){n==null&&(n={});const i=n.size==null?0:n.size;this.seen+=i;for(const o in n){const a=n[o];if(typeof a=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+a*i;else{let l;o in this.totals?l=this.totals[o]:this.totals[o]=0;const c=_t(()=>Xt(this.totals[o],ct(a,i)));this.totals[o]=c,l!=null&&l.dispose()}}}async onEpochEnd(t,n){if(n!=null)for(const i of this.params.metrics)this.totals[i]!=null&&(typeof this.totals[i]=="number"?n[i]=this.totals[i]/this.seen:_t(()=>{const o=ct($e(1,this.seen),this.totals[i]);n[i]=o,this.totals[i].dispose(),Aa(n[i])}))}}class Kit extends Jp{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,n){n==null&&(n={}),this.epoch.push(t);for(const i in n)this.history[i]==null&&(this.history[i]=[]),this.history[i].push(n[i])}async syncData(){const t=[],n=[],i=[];for(const a in this.history){const l=this.history[a];for(let c=0;c<l.length;++c)if(typeof l[c]!="number"){const u=l[c];t.push(u.data()),n.push(a),i.push(c)}}const o=await Promise.all(t);for(let a=0;a<o.length;++a)this.history[n[a]][i[a]].dispose(),this.history[n[a]][i[a]]=o[a][0]}}class Xit extends Jp{constructor(t,n){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||P9,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=Hit),this.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");D3(this.yieldEvery)&&(this.maybeWait=uit(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,n,i){const o=[];this.yield!=null&&(await ru(i),o.push(this.yield(t,n,i))),o.push(this.nextFrameFunc()),await Promise.all(o)}async onEpochBegin(t,n){this.currentEpoch=t,this.epochBegin!=null&&(await ru(n),await this.epochBegin(t,n))}async onEpochEnd(t,n){const i=[];this.epochEnd!=null&&(await ru(n),i.push(this.epochEnd(t,n))),this.yieldEvery==="epoch"&&i.push(this.nextFrameFunc()),await Promise.all(i)}async onBatchBegin(t,n){this.batchBegin!=null&&(await ru(n),await this.batchBegin(t,n))}async onBatchEnd(t,n){const i=[];this.batchEnd!=null&&(await ru(n),i.push(this.batchEnd(t,n))),this.yieldEvery==="batch"?i.push(this.nextFrameFunc()):D3(this.yieldEvery)&&i.push(this.maybeWait(this.currentEpoch,t,n)),await Promise.all(i)}async onTrainBegin(t){this.trainBegin!=null&&(await ru(t),await this.trainBegin(t))}async onTrainEnd(t){this.trainEnd!=null&&(await ru(t),await this.trainEnd(t))}}function R8(r,t){return r==null&&(r={}),r instanceof Jp?[r]:Array.isArray(r)&&r[0]instanceof Jp?r:ts(r).map(i=>new Xit(i,t))}class Qi{constructor(){}static registerCallbackConstructor(t,n){W(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),Qi.checkForDuplicate(n),Qi.constructors[t]==null&&(Qi.constructors[t]=[]),Qi.constructors[t].push(n)}static checkForDuplicate(t){for(const n in Qi.constructors)Qi.constructors[+n].forEach(o=>{if(o===t)throw new dt("Duplicate callback constructor.")})}static clear(){Qi.constructors={}}static createCallbacks(t){const n=[];for(const i in Qi.constructors){const o=+i;t>=o&&n.push(...Qi.constructors[o])}return n.map(i=>new i)}}Qi.constructors={};function O8(r,t,n,i,o,a,l,c,u){const h=new Kit,d=[new qit,...Qi.createCallbacks(t)];r!=null&&d.push(...r),d.push(h);const f=new jit(d);return f.setParams({epochs:n,initialEpoch:i,samples:o,steps:a,batchSize:l,verbose:t,doValidation:c,metrics:u}),{callbackList:f,history:h}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pl(r,t={},n=!1){return Ag(r,ro.getMap().classNameMap,t,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function p2(r,t){return _t(()=>{r.dtype!=="float32"&&(r=de(r,"float32"));const n=we(Dg(r),t,!0),i=Tg(n.shape,Ds()),o=Br(zc(n,i));return $e(r,o)})}function by(r,t){return _t(()=>bs(Dg(Se(t,r)),-1))}function qT(r,t){return _t(()=>bs(Ws(Se(t,r)),-1))}function KT(r,t){return _t(()=>{const n=Se(r,t),i=zi(Ws(r),Ds(),Number.MAX_VALUE),o=Ws($e(n,i));return ct(100,bs(o,-1))})}function Yit(r,t){return _t(()=>{const n=zi(t,Ds(),Number.MAX_VALUE),i=wo(Xt(1,n)),o=zi(r,Ds(),Number.MAX_VALUE),a=wo(Xt(1,o));return bs(Dg(Se(i,a)),-1)})}function Zit(r,t){return _t(()=>{const n=zc(0,Se(1,ct(r,t)));return bs(Dg(n),-1)})}function Jit(r,t){return _t(()=>{const n=zc(0,Se(1,ct(r,t)));return bs(n,-1)})}function Qit(r,t){return _t(()=>{const n=we(ct(r,t),-1),i=Ko(ct(Se(1,r),t),-1);return zc(0,Xt(1,Se(i,n)))})}function tot(r,t){return _t(()=>{const n=Math.log(2),i=Se(t,r),o=Se(Xt(i,Cg(ct(-2,i))),n);return bs(o,-1)})}function Qp(r,t,n=!1){return _t(()=>{if(n)t=Q_(t);else{const i=we(t,t.shape.length-1,!0);t=$e(t,i)}return t=zi(t,Ds(),1-Ds()),fs(we(ct(de(r,"float32"),wo(t)),t.shape.length-1))})}function m2(r,t,n=!1){return _t(()=>{const i=de(uy(Sit(r)),"int32");t=zi(t,Ds(),1-Ds());const o=t.shape,a=gt(XR(i,o[o.length-1]),o);return Qp(a,t,n)})}function eot(r,t){if(!An(r.shape,t.shape))throw new dt(`logits and labels must have the same shape, but got shapes ${JSON.stringify(r.shape)} and ${JSON.stringify(t.shape)}`);return _t(()=>{const n=Ml(t),i=fs(Ws(t));return Xt(Se(n,ct(t,r)),G_(bo(i)))})}function wy(r,t){return _t(()=>{let n;return n=zi(t,Ds(),1-Ds()),n=wo($e(n,Se(1,n))),bs(eot(r,n),-1)})}function not(r,t){return _t(()=>{const n=zi(r,Ds(),1),i=zi(t,Ds(),1);return we(ct(r,wo($e(n,i))),-1)})}function sot(r,t){return _t(()=>{const n=wo(Xt(Ds(),t));return bs(Se(t,ct(r,n)),-1)})}function L8(r,t){return _t(()=>{const n=p2(r,-1),i=p2(t,-1),o=ct(n,i);return fs(we(o,-1))})}const g2={meanSquaredError:by,meanAbsoluteError:qT,meanAbsolutePercentageError:KT,meanSquaredLogarithmicError:Yit,squaredHinge:Zit,hinge:Jit,categoricalHinge:Qit,logcosh:tot,categoricalCrossentropy:Qp,sparseCategoricalCrossentropy:m2,binaryCrossentropy:wy,kullbackLeiblerDivergence:not,poisson:sot,cosineProximity:L8};function Vx(r){if(typeof r=="string"){if(r in g2)return g2[r];let t=`Unknown loss ${r}`;throw r.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${r}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new dt(t)}else return r}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function F8(r,t){return _t(()=>{const n=ct(.5,So(t)),i=Da(Ui(t,n),r.dtype);return bs(Pa(r,i),-1)})}function P8(r,t){return _t(()=>Da(Pa(Xp(r,-1),Xp(t,-1)),"float32"))}function rot(r,t){return _t(()=>de(we(wl(Pa(r,1),Pa(t,1))),"float32"))}function iot(r,t){return _t(()=>de(we(wl(Pa(r,0),Pa(t,1))),"float32"))}function oot(r,t){return _t(()=>{const n=rot(r,t),i=iot(r,t),o=Xt(n,i);return de(vi(Ui(o,0),$e(n,o),0),"float32")})}function aot(r,t){return wy(r,t)}function lot(r,t){return r.rank===t.rank&&(r=kg(r,[r.rank-1])),t=Xp(t,-1),t.dtype!==r.dtype&&(t=de(t,r.dtype)),de(Pa(r,t),"float32")}const cot=by,uot=by,hot=qT,dot=qT,fot=KT,pot=KT,B8=Qp,mot=L8,z8=m2,v2={binaryAccuracy:F8,categoricalAccuracy:P8,precision:oot,categoricalCrossentropy:B8,sparseCategoricalCrossentropy:z8,mse:cot,MSE:uot,mae:hot,MAE:dot,mape:fot,MAPE:pot,cosine:mot};function got(r){if(typeof r=="string"&&r in v2)return v2[r];if(typeof r!="string"&&r!=null)return r;throw new dt(`Unknown metric ${r}`)}function F0(r){if(ba(r!==null,`Unknown LossOrMetricFn ${r}`),typeof r=="string")return r;{let t;for(const n of Object.keys(g2))if(g2[n]===r){t=n;break}if(t!==void 0)return t;for(const n of Object.keys(v2))if(v2[n]===r){t=n;break}return t!==void 0?t:r.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vot(r){const t={Adagrad:()=>zh.adagrad(.01),Adadelta:()=>zh.adadelta(1,.95,Ds()),Adam:()=>zh.adam(.001,.9,.999,Ds()),Adamax:()=>zh.adamax(.002,.9,.999,Ds(),0),RMSProp:()=>zh.rmsprop(.001,.9,0,Ds()),SGD:()=>zh.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,r in t)return t[r]();throw new dt(`Unknown Optimizer ${r}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const OI=1*1024*1024;function LI(r,t,n=!1){if(r==null||typeof r!="object"||Object.getPrototypeOf(r)!==Object.prototype||!pw(r))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const i=JSON.stringify(r);i.length>OI&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${i.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${OI}.`)}}function pw(r){if(r===null)return!0;if(typeof r=="object")if(Object.getPrototypeOf(r)===Object.prototype){const t=Object.keys(r);for(const n of t)if(typeof n!="string"||!pw(r[n]))return!1;return!0}else if(Array.isArray(r)){for(const t of r)if(!pw(t))return!1;return!0}else return!1;else{const t=typeof r;return t==="string"||t==="number"||t==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yot(r,t,n,i=console.log){const o=bot(r),a=["Layer (type)","Input Shape","Output shape","Param #"];o?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(d=>Math.floor(t*d)));let l;if(!o){a.push("Receives inputs"),l=[];for(const d in r.nodesByDepth)l.push(...r.nodesByDepth[d])}i("_".repeat(t)),y2(a,n,i),i("=".repeat(t));const c=r.layers;for(let d=0;d<c.length;++d)o?wot(c[d],n,i):Sot(c[d],n,l,i),i((d===c.length-1?"=":"_").repeat(t));r.checkTrainableWeightsConsistency();const u=xot(r),h=h2(r.nonTrainableWeights);i(`Total params: ${u+h}`),i(`Trainable params: ${u}`),i(`Non-trainable params: ${h}`),i("_".repeat(t))}function xot(r){let t;return r.collectedTrainableWeights!=null?t=h2(r.collectedTrainableWeights):t=h2(r.trainableWeights),t}function bot(r){let t=!0;const n=[],i=[];for(const o in r.nodesByDepth)n.push(r.nodesByDepth[o]);for(const o of n){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){t=!1;break}i.push(...o)}if(t)for(const o of r.layers){let a=!1;for(const l of o.inboundNodes)if(i.indexOf(l)!==-1)if(a){t=!1;break}else a=!0;if(!t)break}return t}function y2(r,t,n=console.log){let i="";for(let o=0;o<r.length;++o)o>0&&(i=i.slice(0,i.length-1)+" "),i+=r[o],i=i.slice(0,t[o]),i+=" ".repeat(t[o]-i.length);n(i)}function wot(r,t,n){let i,o;try{o=r.inboundNodes.map(u=>JSON.stringify(u.inputShapes)).join(",")}catch{o="multiple"}try{i=JSON.stringify(r.outputShape)}catch{i="multiple"}const a=r.name,l=r.getClassName(),c=[`${a} (${l})`,o,i,r.countParams().toString()];y2(c,t,n)}function Sot(r,t,n,i){let o,a;try{a=r.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{a="multiple"}try{o=JSON.stringify(r.outputShape)}catch{o="multiple"}const l=[];for(const f of r.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(f)===-1))for(let p=0;p<f.inboundLayers.length;++p){const m=f.inboundLayers[p].name,g=f.nodeIndices[p],y=f.tensorIndices[p];l.push(`${m}[${g}][${y}]`)}const c=r.name,u=r.getClassName(),h=l.length===0?"":l[0],d=[`${c} (${u})`,a,o,r.countParams().toString(),h];y2(d,t,i);for(let f=1;f<l.length;++f)y2(["","","","",l[f]],t,i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function V8(r,t,n){return(r==="inboundNodes"||r==="outputLayers"||r==="inputLayers")&&t===0&&typeof n=="string"}function mw(r,t){if(r===null)return null;if(typeof r=="string")return mu(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){const n=[],i=r.length;for(let o=0;o<i;++o){const a=r[o];V8(t,o,a)?n.push(a):n.push(mw(a,t))}return n}else{const n={};for(const i of Object.keys(r)){const o=r[i];if(i==="name"&&typeof o=="string")n[i]=o;else{const a=mu(i);n[a]=mw(o,a)}}return n}}function gw(r,t){if(r==null)return null;if(typeof r=="string")return sl(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){const n=[],i=r.length;for(let o=0;o<i;++o){const a=r[o];V8(t,o,a)?n.push(a):n.push(gw(a,t))}return n}else{const n={};for(const i of Object.keys(r)){const o=r[i],a=sl(i);(i==="name"||i==="className")&&typeof o=="string"?n[a]=o:n[a]=gw(o,i)}return n}}/** @license See the LICENSE file. */const U8="4.1.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Fo extends un{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){const b=this.getClassName().toLowerCase();this.name=vy(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],dc(this.inputs).length!==this.inputs.length)throw new dt(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);dc(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const b of this.outputs){const w=b.sourceLayer,S=b.nodeIndex,_=b.tensorIndex;this.outputLayers.push(w),this.outputLayersNodeIndices.push(S),this.outputLayersTensorIndices.push(_)}for(const b of this.inputs){const w=b.sourceLayer,S=b.nodeIndex,_=b.tensorIndex;ba(S===0,"input layer has >1 nodes"),ba(_===0,"input layer has >1 tensors"),this.inputLayers.push(w),this.inputLayersNodeIndices.push(S),this.inputLayersTensorIndices.push(_)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){const w=this.inputLayers[b];if(!(w instanceof Og))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${b} (0-based) originates from layer type ${w.getClassName()}.`);this.inputNames.push(w.name),this.feedInputShapes.push(w.batchInputShape),this.feedInputNames.push(w.name)}for(const b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);const n={},i={},o={},a={},l={},c=[],u=(b,w,S,_,$,N)=>{(_==null||$==null||N==null)&&(_=b.sourceLayer,$=b.nodeIndex,N=b.tensorIndex);const k=_.inboundNodes[$];if(S.indexOf(k)!==-1)throw new fo(`The tensor ${b.name} at layer "${_.name}" is part of a cycle.`);if(w.indexOf(k)!==-1)return;this.containerNodes.add(Fo.nodeKey(_,$)),_.id in l||(l[_.id]=Object.keys(l).length),S.indexOf(k)===-1&&S.push(k);const I=k.inboundLayers.length;for(let O=0;O<I;O++){const B=k.inputTensors[O],F=k.inboundLayers[O],D=k.nodeIndices[O],L=k.tensorIndices[O];u(B,w,S,F,D,L)}for(w.push(k);S.indexOf(k)>=0;)S.splice(S.indexOf(k),1);c.push(k)},h=[],d=[];for(const b of this.outputs)u(b,h,d);const f=c.slice().reverse();for(const b of f){i[b.id]=b,b.id in n||(n[b.id]=0);let w=n[b.id];const S=o[b.outboundLayer.id]==null?0:o[b.outboundLayer.id];w=Math.max(w,S),o[b.outboundLayer.id]=w,a[b.outboundLayer.id]=b.outboundLayer,n[b.id]=w;for(let _=0;_<b.inboundLayers.length;_++){const $=b.inboundLayers[_],N=b.nodeIndices[_],k=$.inboundNodes[N],I=n[k.id]==null?0:n[k.id];n[k.id]=Math.max(w+1,I),i[k.id]=k}}const p={};for(const b in n){const w=n[b];w in p||(p[w]=[]),p[w].push(i[b])}const m={};for(const b in o){const w=o[b];w in m||(m[w]=[]),m[w].push(a[b])}let g=Object.keys(m).map(b=>parseInt(b,10)).sort(R0);this.layers=[];for(const b of g){const w=m[b];w.sort((S,_)=>{const $=l[S.id],N=l[_.id];return $<N?-1:$>N?1:0});for(const S of w)S instanceof Fo&&this.internalContainerRefs.push(S),this.layers.push(S)}this.layersByDepth=m,g=Object.keys(p).map(b=>parseInt(b,10)).sort(R0);const y=this.inputs.slice(),v=[];for(const b of g)for(const w of p[b]){const S=w.outboundLayer;if(S!=null){for(const _ of w.inputTensors)if(y.indexOf(_)===-1)throw new fo(`Graph disconnected: cannot obtain value for tensor ${_} at layer "${S.name}". The following previous layers were accessed without issue: ${v}`);for(const _ of w.outputTensors)y.push(_);v.push(S.name)}}this.nodesByDepth=p;const x=this.layers.map(b=>b.name);for(const b of x){const w=x.filter(S=>S===b).length;if(w!==1)throw new fo(`The name "${b}" is used ${w} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(x))}this.outboundNodes=[],this.inboundNodes=[],new xy({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)t.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)t.numDisposedVariables+=n.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(n=>{n._trainableWeights.forEach(i=>i.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new dt("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const n of this.layers)t=t.concat(n.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const n of this.layers)t.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const i of this.layers)n.push(...i.trainableWeights);return n.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,n=!0){const i={};let o=0;for(const l of this.layers)for(const c of l.weights){if(i[c.originalName]!=null)throw new dt(`Duplicate weight name: ${c.originalName}`);i[c.originalName]=c,o++}const a=[];for(const l in t){let c=l;if(i[l]==null){const u=l.split("/");c=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(i[c]!=null)a.push([i[c],t[l]]);else if(n)throw new dt(`Provided weight data has no target variable: ${l}`);delete i[c]}if(n){const l=[];for(const c in i)l.push(c);if(l.length>0)throw new dt(`${l.length} of ${o} weights are not set: ${l}`)}HT(a)}updatedConfig(){const t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion=`tfjs-layers ${U8}`,n.backend="TensorFlow.js",n}toJSON(t,n=!0){const i=gw(this.updatedConfig());return n?JSON.stringify(i):i}call(t,n){return _t(()=>{t=ts(t);const i=new sc;for(let o=0;o<this.inputs.length;++o)i.add(this.inputs[o],t[o]);return bp(this.outputs,i,n)})}computeMask(t,n){return _t(()=>{t=ts(t);let i;return n==null?i=Qu(null,t.length):i=ts(n),this.runInternalGraph(t,i)[1]})}computeOutputShape(t){const n=u2(t);if(n.length!==this.inputLayers.length)throw new dt(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const i={};for(let c=0;c<n.length;c++){const u=this.inputLayers[c],h=n[c],d=u.name+"_0_0";i[d]=h}const o=Object.keys(this.nodesByDepth).map(c=>parseInt(c,10)).sort(R0);if(o.length>1)for(const c of o){const u=this.nodesByDepth[c];for(const h of u){const d=h.outboundLayer;if(this.inputLayers.map(y=>y.id).indexOf(d.id)!==-1)continue;const f=[];for(let y=0;y<h.inboundLayers.length;y++){const v=h.inboundLayers[y],x=h.nodeIndices[y],b=h.tensorIndices[y],w=`${v.name}_${x}_${b}`,S=i[w];f.push(S)}const p=d.computeOutputShape(Xr(f)),m=u2(p),g=d.inboundNodes.indexOf(h);for(let y=0;y<m.length;y++){const v=`${d.name}_${g}_${y}`;i[v]=m[y]}}}const a=[],l=[];for(let c=0;c<this.outputLayers.length;c++){const u=this.outputLayers[c],h=this.outputLayersNodeIndices[c],d=this.outputLayersTensorIndices[c],f=`${u.name}_${h}_${d}`;l.push(f)}for(let c=0;c<l.length;c++){const u=l[c];ba(u in i),a.push(i[u])}return Xr(a)}runInternalGraph(t,n){n==null&&(n=Qu(null,t.length));const i={};for(let u=0;u<this.inputs.length;++u){const h=this.inputs[u],d=t[u],f=n[u];i[h.id]=[d,f]}const o=Object.keys(this.nodesByDepth).map(u=>parseInt(u,10)).sort(R0);for(const u of o){const h=this.nodesByDepth[u];for(const d of h){const f=d.outboundLayer,p=d.inputTensors,m=d.outputTensors,g=new Array;for(const y of p)y.id in i&&g.push(i[y.id]);if(g.length===p.length){let y={},v,x,b,w;if(d.callArgs!=null&&(y=d.callArgs),g.length===1){const[S,_]=g[0];y.mask==null&&(y.mask=_),b=ts(f.call(S,y)),w=ts(f.computeMask(S,_)),v=[S],x=[_]}else v=g.map(S=>S[0]),x=g.map(S=>S[1]),y.mask==null&&(y.mask=x),b=ts(f.call(v,y)),w=ts(f.computeMask(v,x));if(f.activityRegularizer)throw new je("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let S=0;S<m.length;++S){const _=m[S],$=b[S],N=w[S];i[_.id]=[$,N]}}}}const a=[],l=[],c=[];for(const u of this.outputs){ba(u.id in i,`Could not compute output ${u.name} : ${u.id}`);const[h,d]=i[u.id];c.push(h.shape),a.push(h),l.push(d)}return[a,l,c]}buildNodeConversionMap(t){const n={};let i;for(const o of this.layers){i=o instanceof Fo?1:0;for(let a=0;a<o.inboundNodes.length;a++){const l=Fo.nodeKey(o,a);this.containerNodes.has(l)&&(n[l]=i,i+=1)}}return n}getLayer(t,n){if(n!=null){if(this.layers.length<=n)throw new dt(`Was asked to retrieve layer at index ${n}, but model only has ${this.layers.length} layer(s).`);return this.layers[n]}else if(t==null)throw new dt("Provide either a layer name or layer index");for(const i of this.layers)if(i.name===t)return i;throw new dt(`No such layer: ${t}`)}calculateLosses(){return _t(()=>{const t=[];for(const n of this.layers)for(let i=0;i<n.inboundNodes.length;++i){const o=Fo.nodeKey(n,i);this.containerNodes.has(o)&&t.push(...n.calculateLosses())}return t})}getConfig(){const t={name:this.name},n=this.buildNodeConversionMap(this.layers),i=[];for(const l of this.layers){const c=l.getClassName(),u=l.getConfig(),h=[];for(let f=0;f<l.inboundNodes.length;f++){const p=l.inboundNodes[f],m=Fo.nodeKey(l,f);let g={};if(this.containerNodes.has(m)){if(p.callArgs)try{JSON.stringify(p.callArgs),g=p.callArgs}catch{console.warn(`Layer ${l.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),g={}}if(p.inboundLayers.length>0){const y=[];for(let v=0;v<p.inboundLayers.length;v++){const x=p.inboundLayers[v],b=p.nodeIndices[v],w=p.tensorIndices[v],S=Fo.nodeKey(x,b);let _=n[S];_==null&&(_=0),y.push([x.name,_,w,g])}h.push(y)}}}const d={};d.name=l.name,d.className=c,d.config=u,d.inboundNodes=h,i.push(d)}t.layers=i;const o=[];for(let l=0;l<this.inputLayers.length;l++){const c=this.inputLayers[l],u=this.inputLayersNodeIndices[l],h=Fo.nodeKey(c,u);if(!this.containerNodes.has(h))continue;let d=n[h];d==null&&(d=0);const f=this.inputLayersTensorIndices[l];o.push([c.name,d,f])}t.inputLayers=o;const a=[];for(let l=0;l<this.outputLayers.length;l++){const c=this.outputLayers[l],u=this.outputLayersNodeIndices[l],h=Fo.nodeKey(c,u);if(!this.containerNodes.has(h))continue;let d=n[h];d==null&&(d=0);const f=this.outputLayersTensorIndices[l];a.push([c.name,d,f])}return t.outputLayers=a,t}static fromConfig(t,n,i={},o=!1){const a={},l={};function c(v,x){v.name in l?l[v.name].push(x):l[v.name]=[x]}function u(v,x){const b=[];let w;for(const S of x){const _=S[0],$=S[1],N=S[2];if(w=S[3]==null?{}:S[3],!(_ in a)){c(v,x);return}const k=a[_];if(k.inboundNodes.length<=$){c(v,x);return}const I=k.inboundNodes[$];b.push(I.outputTensors[N])}b.length>0&&v.apply(Xr(b),w)}function h(v){const x=v.name,b=pl(v,n.customObjects!=null?n.customObjects:{});b.setFastWeightInitDuringBuild(o),a[x]=b,v.inboundNodes.forEach(S=>{if(!(S instanceof Array))throw new dt(`Corrupted configuration, expected array for nodeData: ${S}`);c(b,S)})}const d=n.name,f=n.layers;for(const v of f)h(v);for(;!cit(l);)for(const v of f){const x=a[v.name];if(x.name in l){const b=l[x.name];delete l[x.name];for(const w of b)u(x,w)}}const p=[],m=[],g=n.inputLayers;for(const v of g){const x=v[0],b=v[1],w=v[2];ba(x in a);const _=a[x].inboundNodes[b].outputTensors;p.push(_[w])}const y=n.outputLayers;for(const v of y){const x=v[0],b=v[1],w=v[2];ba(x in a);const _=a[x].inboundNodes[b].outputTensors;m.push(_[w])}return new t({inputs:p,outputs:m,name:d})}get stateful(){if(this._stateful)throw new dt("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){_t(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _ot(r,t,n){const i=t.length;if(r==null||Array.isArray(r)&&r.length===0)return t.map(o=>null);if(i===1)return Array.isArray(r)&&r.length===1?r:typeof r=="object"&&t[0]in r?[r[t[0]]]:[r];if(Array.isArray(r)){if(r.length!==i)throw new Error(`Provided ${n} is an array of ${r.length} element(s), but the model has ${i} outputs. Make sure a set of weights is provided for each model output.`);return r}else if(typeof r=="object"&&Object.keys(r).length>0&&typeof r[Object.keys(r)[0]]=="object"){const o=[];return t.forEach(a=>{a in r?o.push(r[a]):o.push(null)}),o}else throw new Error(`The model has multiple (${i}) outputs, so ${n} must be either an array with ${i} elements or an object with ${t} keys. Provided ${n} not understood: ${JSON.stringify(r)}`)}function W8(r,t){return _ot(r,t,"classWeight")}async function G8(r,t,n,i){if(t!=null||i!=null)throw new Error("Support sampleWeight is not implemented yet");if(n!=null){const o=_t(()=>{if(r.shape.length===1)return Au(r);if(r.shape.length===2){if(r.shape[1]>1)return Xp(r,1);if(r.shape[1]===1)return gt(r,[r.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${r.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${r.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),a=Array.from(await o.data());ln(o);const l=[];return a.forEach(c=>{if(n[c]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${c} exists in the data but not in classWeight`);l.push(n[c])}),pi(l,"float32")}else return null}function Tot(r,t){return ct(r,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Cot=32;function H8(r,t){let n,i;const o=t;n=o.xs,i=o.ys,W(n!=null&&i!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);const a=FI("input",r.inputNames,n),l=FI("output",r.outputNames,i),c=a[0].shape[0];W(a.length===r.inputs.length,()=>`LayersModel has ${r.inputs.length} inputs, but the dataset provides ${a.length} inputs.  (Expected input keys: ${JSON.stringify(r.inputNames)})`),W(l.length===r.outputs.length,()=>`LayersModel has ${r.outputs.length} outputs, but the dataset provides ${l.length} outputs.  (Expected output keys: ${JSON.stringify(r.outputNames)})`);for(let u=0;u<a.length;u++)W(a[u].shape[0]===c,()=>`Batch size mismatch: input ${r.inputNames[u]} has ${a[u].shape[0]}; expected  ${c} based on input ${r.inputNames[0]}.`);for(let u=0;u<l.length;u++)W(l[u].shape[0]===c,()=>`Batch size mismatch: output ${r.outputNames[u]} has ${l[u].shape[0]}; expected  ${c} based on input ${r.inputNames[0]}.`);return{xs:a,ys:l}}function FI(r,t,n){if(n instanceof Cs)return[n];if(Array.isArray(n))return W(n.length===t.length,()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${r} keys ${t}.`),n;{const i=[];for(const o of t){if(n[o]==null)throw new dt(`The feature data generated by the dataset lacks the required ${r} key '${o}'.`);i.push(n[o])}return i}}function kot(r){if(r.length===3)throw new je("Validation with sample weights is not implemented yet.");return{xs:r[0],ys:r[1]}}async function $ot(r,t,n){const i=n.batchesPerEpoch!=null;if(W(r.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),W(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),W(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),W(!i||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),W(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),r.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");r.isTraining=!0;try{const o=n.validationData!=null;let a,l;if(o)if(PI(n.validationData))W(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const v=kot(n.validationData);a=v.xs,l=v.ys}const c=r.makeTrainFunction(),u=r.getDedupedMetricsNames();let h;o?h=u.slice().concat(u.map(v=>"val_"+v)):h=u.slice();const d=R8(n.callbacks,n.yieldEvery),f=n.verbose==null?1:n.verbose,{callbackList:p,history:m}=O8(d,f,n.epochs,null,null,Iot(t,n),null,o,h);p.setModel(r),r.history=m,await p.onTrainBegin(),r.stopTraining_=!1;let g=n.initialEpoch==null?0:n.initialEpoch,y=await t.iterator();for(;g<n.epochs;){const v={};await p.onEpochBegin(g);let x=0,b=0;for(i||(y=await t.iterator());!i||x<n.batchesPerEpoch;){const w=await y.next();if(i&&w.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${x} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(w.value!=null){const{xs:S,ys:_}=H8(r,w.value),$={};$.batch=b,$.size=S[0].shape[0],await p.onBatchBegin(b,$);const N=[];if(n.classWeight!=null){const O=W8(n.classWeight,r.outputNames);for(let B=0;B<O.length;++B)N.push(await G8(_[B],null,O[B]))}const k=S.concat(_).concat(N),I=c(k);ln(k);for(let O=0;O<u.length;++O){const B=u[O],F=I[O];$[B]=F,Aa(F)}await p.onBatchEnd(b,$),D8($),b++,x++}if(i?x>=n.batchesPerEpoch:w.done){if(o){let S;PI(n.validationData)?S=ts(await r.evaluateDataset(n.validationData,{batches:n.validationBatches})):S=ts(r.evaluate(a,l,{batchSize:n.validationBatchSize==null?Cot:n.validationBatchSize,verbose:0}));for(let _=0;_<r.metricsNames.length;++_)v[`val_${r.metricsNames[_]}`]=S[_]}break}if(r.stopTraining_)break}if(await p.onEpochEnd(g,v),g++,r.stopTraining_)break}return await p.onTrainEnd(),await r.history.syncData(),r.history}finally{r.isTraining=!1}}function Iot(r,t){let n=null;return t.batchesPerEpoch!=null?n=t.batchesPerEpoch:Number.isFinite(r.size)&&(n=r.size),n}function PI(r){return typeof r.iterator=="function"}function Eot(r){return typeof r.next=="function"}async function Not(r,t,n){n=n||{};const i=n.batches!=null,o=r.testFunction;let a=[];if(n.verbose>0)throw new je("Verbose mode is not implemented yet.");W(!i||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const l=Eot(t)?t:await t.iterator();let c=0,u=0;for(;!i||u<n.batches;){const h=await l.next();if(a=_t(()=>{if(h.value){const{xs:d,ys:f}=H8(r,h.value),p=d.concat(f),m=_t(()=>o(p));if(ln(p),u===0)for(let y=0;y<m.length;++y)a.push(Pe(0));const g=p[0].shape[0];for(let y=0;y<m.length;++y){const v=m[y],x=a[y];a[y]=_t(()=>Xt(a[y],ct(g,v))),u>0&&ln(x)}ln(m),c+=g,++u}return a}),h.done){i&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let h=0;h<a.length;++h){const d=a[h];a[h]=$e(a[h],c),ln(d)}return Xr(a)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ux(r){W(r>0&&Number.isInteger(r),()=>`batchSize is required to be a positive integer, but got ${r}`)}function ep(r,t,n){return r==null?[null]:Array.isArray(r)?r.map(i=>Ru(i,t,n-t)):Ru(r,t,n-t)}function vw(r,t){return _t(()=>r==null?null:Array.isArray(r)?r.map(n=>vw(n,t)):x8(r,t.dtype==="int32"?t:de(t,"int32")))}function Wx(r,t){const n=[];let i=0,o=null;for(;i<r;)o=i+t,o>=r&&(o=r),n.push([i,o]),i=o;return n}function j8(r){const t=[];r instanceof Cs&&(r=[r]);for(let n=0;n<r.length;++n){const i=r[n];if(i.rank===1)t.push(Mg(i,1));else{if(i.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(i)}}return t}function Mo(r,t){if(r==null)return;const n=[];if(t instanceof Cs)n.push(t.id);else if(Array.isArray(t))t.forEach(o=>n.push(o.id));else if(t!=null)for(const o in t){const a=t[o];n.push(a.id)}const i=[];if(r instanceof Cs)n.indexOf(r.id)===-1&&i.push(r);else if(Array.isArray(r))r.forEach(o=>{n.indexOf(o.id)===-1&&i.push(o)});else if(r!=null)for(const o in r){const a=r[o];n.indexOf(a.id)===-1&&i.push(a)}i.forEach(o=>{o.isDisposed||o.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Aot(r){return r instanceof Cs}function yw(r){return Array.isArray(r)}function BI(r){return!Aot(r)&&!yw(r)}function zI(r,t,n,i=!0,o=""){if(t==null||t.length===0){if(r!=null){let l=!1;if(yw(r)&&r.length>0)l=!0;else if(BI(r)){for(const c in r)if(r.hasOwnProperty(c)){l=!0;break}}else l=!0;if(l)throw new dt(`Error when checking model ${o} expected no data, but got ${r}`)}return[]}if(r==null)return t.map(l=>null);let a;if(BI(r)){r=r,a=[];for(const l of t){if(r[l]==null)throw new dt(`No data provided for "${l}". Need data for each key in: ${t}`);a.push(r[l])}}else if(yw(r)){if(r=r,r.length!==t.length)throw new dt(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${r}`);a=r}else{if(r=r,t.length>1)throw new dt(`The model ${o} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${r.shape}`);a=[r]}if(a=j8(a),n!=null)for(let l=0;l<t.length;++l){if(n[l]==null)continue;const c=a[l];if(c.shape.length!==n[l].length)throw new dt(`Error when checking ${o}: expected ${t[l]} to have ${n[l].length} dimension(s). but got array with shape ${c.shape}`);for(let u=0;u<n[l].length;++u){if(u===0&&!i)continue;const h=c.shape[u],d=n[l][u];if(d!=null&&d>=0&&h!==d)throw new dt(`${o} expected a batch of elements where each example has shape [${n[l].slice(1,n[l].length)}] (i.e.,tensor shape [*,${n[l].slice(1,n[l].length)}]) but the ${o} received an input with ${c.shape[0]} examples, each with shape [${c.shape.slice(1,c.shape.length)}] (tensor shape [${c.shape}])`)}}return a}function Mot(r,t,n){const i=dc(r.map(a=>a.shape[0]));i.sort();const o=dc(t.map(a=>a.shape[0]));if(o.sort(),i.length>1)throw new dt(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(r.map(a=>a.shape))}`);if(o.length>1)throw new dt(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(a=>a.shape))}`);if(i.length>0&&o.length>0&&!An(i,o))throw new dt(`Input Tensors should have the same number of samples as target Tensors. Found ${i[0]} input sample(s) and ${o[0]} target sample(s).`)}function Dot(r,t,n){const i=[by,wy,Qp];for(let o=0;o<r.length;++o){const a=r[o],l=t[o],c=n[o];if(l!=null){if(l===Qp&&a.shape[a.shape.length-1]===1)throw new dt(`You are passing a target array of shape ${a.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(i.indexOf(l)!==-1){const u=a.shape.slice(1),h=c.slice(1);for(let d=0;d<u.length;++d){const f=u[d],p=h[d];if(p!=null&&f!==p)throw new dt(`A target Tensor with shape ${a.shape} was passed for an output of shape ${c}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function VI(r,t,n,i=!0,o=""){let a;if(Array.isArray(r)){if(r.length!==t.length)throw new dt(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${r.length} Tensors(s).`);a=r}else{if(t.length>1)throw new dt(`The model expects ${t.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(r.shape)}.`);a=[r]}if(n!=null)for(let l=0;l<t.length;++l){if(n[l]==null)continue;const c=a[l];if(c.shape.length!==n[l].length)throw new dt(`Error when checking ${o}: expected ${t[l]} to have ${n[l].length} dimension(s), but got array with shape ${JSON.stringify(c.shape)}`);for(let u=0;u<n[l].length;++u){if(u===0&&!i)continue;const h=c.shape[u],d=n[l][u];if(d!=null&&d!==h)throw new dt(`Error when checking ${o}: expected ${t[l]} to have shape ${JSON.stringify(n[l])} but got array with shape ${JSON.stringify(c.shape)}.`)}}}function Rot(r,t){if(r==null||Array.isArray(r)&&r.length===0)return t.map(i=>[]);let n;if(typeof r=="string"||typeof r=="function")n=[r];else if(Array.isArray(r)||typeof r=="object")n=r;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${r}`);if(Array.isArray(n))return t.map(i=>n);{const i=[];for(const o of t){let a=n.hasOwnProperty(o)?n[o]:[];Array.isArray(a)||(a=[a]),i.push(a)}return i}}const Oot="layers-model";class _d extends Fo{constructor(t){super(t),this.isTraining=!1}summary(t,n,i=console.log){if(!this.built)throw new dt("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");yot(this,t,n,i)}compile(t){if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=vot(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof Wc))throw new dt("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(const l in t.loss)if(this.outputNames.indexOf(l)===-1)throw new dt(`Unknown entry in loss dictionary: "${l}". Only expected the following keys: ${this.outputNames}`);for(const l of this.outputNames)t.loss[l]==null&&console.warn(`Output "${l}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${l} during training`),n.push(Vx(t.loss[l]))}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new dt(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);n=t.loss.map(c=>Vx(c))}else{const l=Vx(t.loss);this.outputs.forEach(c=>{n.push(l)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let l=0;l<this.outputs.length;++l){const c=this.internalOutputShapes[l],u=this.outputNames[l];this.feedOutputNames.push(u),this.feedOutputShapes.push(c),this.feedLossFns.push(this.lossFunctions[l])}const i=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Du("loss",()=>{for(let l=0;l<this.outputs.length;++l){if(i.indexOf(l)!==-1)continue;const c=this.lossFunctions[l];this.outputs.length>1&&(this.metricsTensors.push([c,l]),this.metricsNames.push(this.outputNames[l]+"_loss"))}});const o=Rot(t.metrics,this.outputNames),a=(l,c,u)=>{this.outputNames.length>1&&(c=this.outputNames[l]+"_"+c),this.metricsNames.push(c),this.metricsTensors.push([u,l])};Du("metric",()=>{for(let l=0;l<this.outputs.length;++l){if(i.indexOf(l)!==-1)continue;const c=o[l];(h=>{const d="";let f,p,m;for(const g of h){if(typeof g=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(g)!==-1){const v=this.internalOutputShapes[l];v[v.length-1]===1||this.lossFunctions[l]===wy?["accuracy","acc"].indexOf(g)!==-1?p=F8:["crossentropy","ce"].indexOf(g)!==-1&&(p=aot):this.lossFunctions[l]===m2?["accuracy","acc"].indexOf(g)!==-1?p=lot:["crossentropy","ce"].indexOf(g)!==-1&&(p=z8):["accuracy","acc"].indexOf(g)!==-1?p=P8:["crossentropy","ce"].indexOf(g)!==-1&&(p=B8);let x;["accuracy","acc"].indexOf(g)!==-1?x="acc":["crossentropy","ce"].indexOf(g)!==-1&&(x="ce"),m=p,f=d+x}else m=got(g),f=d+F0(g);let y;Du(f,()=>{y=m}),a(l,f,y)}})(c)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,n,i={}){const o=i.batchSize==null?32:i.batchSize;Ux(o);const a=!0,l=this.standardizeUserDataXY(t,n,a,o);try{const c=l[0].concat(l[1]);this.makeTestFunction();const u=this.testFunction,h=this.testLoop(u,c,o,i.verbose,i.steps);return Xr(h)}finally{Mo(l[0],t),Mo(l[1],n)}}async evaluateDataset(t,n){return this.makeTestFunction(),Not(this,t,n)}checkNumSamples(t,n,i,o="steps"){let a;if(i!=null){if(a=null,n!=null)throw new dt(`If ${o} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(t!=null)Array.isArray(t)?a=t[0].shape[0]:a=t.shape[0];else throw new dt(`Either the input data should have a defined shape, or ${o} shoud be specified.`);return a}execute(t,n){if(Array.isArray(n)&&n.length===0)throw new dt("`outputs` is an empty Array, which is not allowed.");const i=Array.isArray(n),o=i?n:[n],a=this.retrieveSymbolicTensors(o),l=new sc;if(t instanceof Cs&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new dt(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let u=0;u<this.inputs.length;++u)l.add(this.inputs[u],t[u])}else for(const u of this.inputs){const h=t[u.name];if(h==null)throw new dt(`No value is provided for the model's input ${u.name}`);l.add(u,h)}const c=bp(a,l);return i?c:c[0]}retrieveSymbolicTensors(t){const n=Qu(null,t.length);let i=t.length;for(const o of this.layers){const a=Array.isArray(o.output)?o.output:[o.output],l=a.map(c=>c.name);for(let c=0;c<t.length;++c){const u=l.indexOf(t[c]);if(u!==-1&&(n[c]=a[u],i--),i===0)break}if(i===0)break}if(i>0){const o=[];throw n.forEach((a,l)=>{a==null&&o.push(t[l])}),new dt(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(o)}`)}return n}predictLoop(t,n=32,i=!1){return _t(()=>{const o=this.checkNumSamples(t);if(i)throw new je("Verbose predictLoop() is not implemented yet.");const a=Wx(o,n),l=this.outputs.map(c=>[]);for(let c=0;c<a.length;++c)_t(()=>{const h=a[c][0],d=a[c][1],f=ep(t,h,d),p=[];if(Array.isArray(f))for(let g=0;g<f.length;++g)p.push({key:this.inputs[g],value:f[g]});else p.push({key:this.inputs[0],value:f});const m=new sc(p);return bp(this.outputs,m)}).forEach((h,d)=>l[d].push(h));return Xr(l.map(c=>br(c,0)))})}predict(t,n={}){const i=j8(t);VI(i,this.inputNames,this.feedInputShapes,!1);try{const o=n.batchSize==null?32:n.batchSize;return Ux(o),this.predictLoop(i,o)}finally{Mo(i,t)}}predictOnBatch(t){VI(t,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,n)}standardizeUserDataXY(t,n,i=!0,o){if(this.optimizer_==null)throw new fo("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const a=[];for(let l=0;l<this.feedOutputShapes.length;++l){const c=this.feedOutputShapes[l];this.feedLossFns[l]===m2?a.push(c.slice(0,c.length-1).concat([1])):a.push(c)}if(t=zI(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=zI(n,this.feedOutputNames,a,!1,"target"),Mot(t,n),Dot(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&o!=null&&o>0&&t[0].shape[0]%o!==0)throw new dt(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${o}. Found: ${t[0].shape[0]} sample(s).`);return[t,n]}async standardizeUserData(t,n,i,o,a=!0,l){const[c,u]=this.standardizeUserDataXY(t,n,a,l);if(i!=null)throw new Error("sample weight is not supported yet.");let h=null;if(o!=null){const d=W8(o,this.outputNames);h=[];for(let f=0;f<d.length;++f)h.push(await G8(u[f],null,d[f]))}return[c,u,h]}testLoop(t,n,i,o=0,a){return _t(()=>{const l=this.checkNumSamples(n,i,a,"steps"),c=[];if(o>0)throw new je("Verbose mode is not implemented yet.");if(a!=null)throw new je("steps mode in testLoop() is not implemented yet");{const u=Wx(l,i),h=pi(Qo(0,l));for(let d=0;d<u.length;++d){const f=u[d][0],p=u[d][1],m=Ru(h,f,p-f),g=vw(n,m),y=t(g);if(d===0)for(let v=0;v<y.length;++v)c.push(Pe(0));for(let v=0;v<y.length;++v){const x=y[v];c[v]=Xt(c[v],ct(p-f,x))}}for(let d=0;d<c.length;++d)c[d]=$e(c[d],l)}return c})}getDedupedMetricsNames(){const t=this.metricsNames,n=[];for(let i=0;i<t.length;++i){const o=t[i];let a=o;if(CI(t,o)>1){const l=CI(t.slice(0,i),o);a+=`_${l}`}n.push(a)}return n}makeTrainFunction(){return t=>{const n=[],i=t.slice(0,this.inputs.length),o=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),l=[],c=()=>{const f=[];for(let y=0;y<this.inputs.length;++y)f.push({key:this.inputs[y],value:i[y]});const p=new sc(f),m=bp(this.outputs,p,{training:!0});let g;for(let y=0;y<this.lossFunctions.length;++y){const v=this.lossFunctions[y];let x=v(o[y],m[y]);a[y]!=null&&(x=Tot(x,a[y]));const b=bs(x);n.push(b),y===0?g=x:g=Xt(g,x)}for(let y=0;y<this.metricsTensors.length;++y){let v;if(this.outputs.length>1&&y<this.outputs.length)v=n[y];else{const x=this.metricsTensors[y][0],b=this.metricsTensors[y][1];v=bs(x(o[b],m[b]))}Aa(v),l.push(v)}return g=bs(g),this.calculateLosses().forEach(y=>{g=Xt(g,y)}),g},u=this.collectedTrainableWeights.map(f=>f.read()),h=!0;return[this.optimizer_.minimize(c,h,u)].concat(l)}}makeTestFunction(){this.testFunction=t=>_t(()=>{const n=[];let i;const o=t.slice(0,this.inputs.length),a=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),l=[];for(let h=0;h<this.inputs.length;++h)l.push({key:this.inputs[h],value:o[h]});const c=new sc(l),u=bp(this.outputs,c);for(let h=0;h<this.lossFunctions.length;++h){const d=this.lossFunctions[h],f=bs(d(a[h],u[h]));h===0?i=f:i=Xt(i,f),n.push(i)}for(let h=0;h<this.metricsTensors.length;++h){const d=this.metricsTensors[h][0],f=this.metricsTensors[h][1],p=bs(d(a[f],u[f]));n.push(p)}return n})}async fit(t,n,i={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let o,a,l,c,u,h,d,f,p;try{const m=i.batchSize==null?32:i.batchSize;Ux(m);const g=!1,y=await this.standardizeUserData(t,n,i.sampleWeight,i.classWeight,g,m);o=y[0],a=y[1],p=y[2];let v=!1,x;if(i.validationData!=null&&i.validationData.length>0){if(v=!0,i.validationData.length===2)u=i.validationData[0],h=i.validationData[1];else throw i.validationData.length===3?new je("validationData including sample weights is not supported yet."):new dt(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${i.validationData} is invalid.`);const I=!0,O=await this.standardizeUserData(u,h,null,null,I,m);d=O[0],f=O[1],x=d.concat(f)}else if(i.validationSplit!=null&&i.validationSplit>0&&i.validationSplit<1){v=!0;const I=Math.floor(o[0].shape[0]*(1-i.validationSplit)),O=o[0].shape[0];d=ep(o,I,O),l=o,o=ep(o,0,I),f=ep(a,I,O),c=a,a=ep(a,0,I),x=d.concat(f)}else i.validationSteps!=null&&(v=!0);const b=o.concat(a).concat(p);this.checkTrainableWeightsConsistency();const w=this.makeTrainFunction(),S=this.getDedupedMetricsNames();let _,$;v?(this.makeTestFunction(),_=this.testFunction,$=S.slice().concat(S.map(I=>"val_"+I))):(_=null,x=[],$=S.slice());const N=R8(i.callbacks,i.yieldEvery);return await this.fitLoop(w,b,S,m,i.epochs,i.verbose,N,_,x,i.shuffle,$,i.initialEpoch,null,null)}finally{this.isTraining=!1,Mo(o,t),Mo(a,n),Mo(l,t),Mo(c,n),Mo(d,u),Mo(f,h),p!=null&&ln(p)}}async fitLoop(t,n,i,o,a,l,c,u,h,d,f,p,m,g){o==null&&(o=32),a==null&&(a=1),d==null&&(d=!0),p==null&&(p=0);let y=!1;if(u!=null&&h!=null&&(y=!0),g!=null&&(y=!0,m==null))throw new dt("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const v=this.checkNumSamples(n,o,m,"steps_per_epoch");let x;v!=null&&(x=Qo(0,v)),l==null&&(l=1);const{callbackList:b,history:w}=O8(c,l,a,p,v,m,o,y,f);b.setModel(this),this.history=w,await b.onTrainBegin(),this.stopTraining_=!1;for(let S=p;S<a;++S){await b.onEpochBegin(S);const _={};if(m!=null)throw new je("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new je("batch shuffling is not implemneted yet");d&&XX(x);const $=pi(x),N=Wx(v,o);for(let k=0;k<N.length;++k){const I={};if(await b.onBatchBegin(k,I),_t(()=>{const O=N[k][0],B=N[k][1],F=Ru($,O,B-O);I.batch=k,I.size=B-O;const D=vw(n,F),L=t(D);for(let V=0;V<i.length;++V){const j=i[V],Y=L[V];I[j]=Y,Aa(Y)}if(k===N.length-1&&y){const V=this.testLoop(u,h,o);for(let j=0;j<i.length;++j){const Y=i[j],H=V[j];Aa(H),_["val_"+Y]=H}}}),await b.onBatchEnd(k,I),D8(I),this.stopTraining_)break}$.dispose()}if(await b.onEpochEnd(S,_),this.stopTraining_)break}return await b.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(t,n){return $ot(this,t,n)}async trainOnBatch(t,n){const i=await this.standardizeUserData(t,n),o=i[0],a=i[1],c=this.makeTrainFunction()(o.concat(a)),u=[];for(const h of c){const d=await h.data();u.push(d[0])}return ln(c),Mo(i[0],t),Mo(i[1],n),Xr(u)}getNamedWeights(t){const n=[],i=t!=null&&t.trainableOnly,o=i?this.trainableWeights:this.weights,a=this.getWeights(i);for(let l=0;l<o.length;++l)i&&!o[l].trainable||n.push({name:o[l].originalName,tensor:a[l]});return n}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=X3().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-X3().numTensors}return t}getLossIdentifiers(){let t;if(typeof this.loss=="string")t=sl(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(n=>sl(n))}else{const n=Object.keys(this.loss);t={};const i=this.loss;for(const o of n)if(typeof i[o]=="string")t[o]=sl(i[o]);else throw new Error("Serialization of non-string loss is not supported.")}return t}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[sl(F0(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(t=>sl(F0(t)));{const t={};for(const n in this.metrics)t[n]=sl(F0(this.metrics[n]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=mw(t.optimizer_config),i=pl(n);let o;if(typeof t.loss=="string")o=mu(t.loss);else if(Array.isArray(t.loss))o=t.loss.map(l=>mu(l));else if(t.loss!=null){o={};for(const l in t.loss)o[l]=mu(t.loss[l])}let a;if(Array.isArray(t.metrics))a=t.metrics.map(l=>mu(l));else if(t.metrics!=null){a={};for(const l in t.metrics)a[l]=mu(t.metrics[l])}this.compile({loss:o,metrics:a,optimizer:i})}async save(t,n){if(typeof t=="string"){const h=UY(t);if(h.length===0)throw new dt(`Cannot find any save handlers for URL '${t}'`);if(h.length>1)throw new dt(`Found more than one (${h.length}) save handlers for URL '${t}'`);t=h[0]}if(t.save==null)throw new dt("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const i=await oI(this.getNamedWeights(n)),o=!1,a=null,c={modelTopology:this.toJSON(a,o),format:Oot,generatedBy:`TensorFlow.js tfjs-layers v${U8}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){c.trainingConfig=this.getTrainingConfig();const h="optimizer",{data:d,specs:f}=await oI(await this.optimizer.getWeights(),h);i.specs.push(...f),i.data=zR([i.data,d])}return this.userDefinedMetadata!=null&&(LI(this.userDefinedMetadata,this.name,!0),c.userDefinedMetadata=this.userDefinedMetadata),c.weightData=i.data,c.weightSpecs=i.specs,t.save(c)}setUserDefinedMetadata(t){LI(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}_d.className="Model";Gt(_d);class q8 extends _d{}q8.className="Functional";Gt(q8);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class tm extends _d{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:vy("sequential_"),t.layers!=null)for(const n of t.layers)this.add(n)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(i=>i<0))throw new dt(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const n=t instanceof tm||t instanceof _d;let i;if(n){if(i=t,i.outputs.length!==1)throw new dt("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(i.inputs.length!==1)throw new dt("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new dt("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const o=Pit({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(o)}if(n)this.outputs=i.outputs,this.inputs=i.inputs;else{if(t.inboundNodes.length!==1)throw new dt(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new dt("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=I8(this.outputs[0])}this.inboundNodes=[],new xy({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Qu(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(o=>o.shape),outputShapes:this.outputs[0].shape})}else{const o=t.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,n){return this.model==null&&this.build(),this.model.call(t,n)}build(t){if(In(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new _d({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,n,i=console.log){this.built||this.build(),super.summary(t,n,i)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,n,i={}){if(!this.built)throw new fo("The model needs to be compiled before being used.");return this.model.evaluate(t,n,i)}async evaluateDataset(t,n){if(!this.built)throw new fo("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,n)}predict(t,n={}){return this.model==null&&this.build(),this.model.predict(t,n)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,n,i={}){if(!this.built)throw new fo("The model needs to be compiled before being used.");return this.model.fit(t,n,i)}async fitDataset(t,n){if(!this.built)throw new fo("The model needs to be compiled before being used.");return this.model.fitDataset(t,n)}async trainOnBatch(t,n){return this.model.trainOnBatch(t,n)}static fromConfig(t,n,i={},o=!1){let a,l={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new dt("Legacy serialization format not supported yet.");a=n}else W(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),a=n.layers,delete n.layers,l=n;const c=new t(l);if(!(c instanceof tm))throw new je(`Sequential.fromConfig called on non-Sequential input: ${c}`);for(const u of a){const d=pl(u,void 0,o);o&&d.setFastWeightInitDuringBuild(!0),c.add(d)}return c}set stopTraining(t){if(this.model==null)throw new dt("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new dt("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const n of this.layers){const i={};i.className=n.getClassName(),i.config=n.getConfig(),t.push(i)}return{name:this.name,layers:t}}}tm.className="Sequential";Gt(tm);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let ri=class extends ff{getConfig(){return{}}},K8=class extends ri{apply(t,n=1){return Tit(t,n)}};K8.className="elu";Gt(K8);let X8=class extends ri{apply(t){return T9(t)}};X8.className="selu";Gt(X8);let Y8=class extends ri{apply(t){return Ml(t)}};Y8.className="relu";Gt(Y8);let Z8=class extends ri{apply(t){return _t(()=>hy(6,Ml(t)))}};Z8.className="relu6";Gt(Z8);class J8 extends ri{apply(t){return t}}J8.className="linear";Gt(J8);let Q8=class extends ri{apply(t){return pf(t)}};Q8.className="sigmoid";Gt(Q8);class tO extends ri{apply(t){return kit(t)}}tO.className="hardSigmoid";Gt(tO);let eO=class extends ri{apply(t){return Cg(t)}};eO.className="softplus";Gt(eO);class nO extends ri{apply(t){return Cit(t)}}nO.className="softsign";Gt(nO);let sO=class extends ri{apply(t){return L_(t)}};sO.className="tanh";Gt(sO);let XT=class extends ri{apply(t,n=-1){return Q_(t,n)}};XT.className="softmax";Gt(XT);class rO extends ri{apply(t,n=-1){return v9(t,n)}}rO.className="logSoftmax";Gt(rO);class iO extends ri{apply(t,n=1){return _t(()=>ct(pf(ct(t,n)),t))}}iO.className="swish";Gt(iO);class oO extends ri{apply(t){return _t(()=>ct(t,L_(Cg(t))))}}oO.className="mish";Gt(oO);function Cc(r){return r.getClassName()}function Gx(r,t={}){return Ag(r,ro.getMap().classNameMap,t,"activation")}function kc(r){if(r==null){const t={};return t.className="linear",t.config={},Gx(t)}if(typeof r=="string"){const t={};return t.className=r,t.config={},Gx(t)}else return r instanceof ri?r:Gx(r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Lot(r){if(r!=null&&typeof r!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${r}`)}class aO extends ff{}class lO extends aO{constructor(t){super(),Lot(t),this.l1=t==null||t.l1==null?.01:t.l1,this.l2=t==null||t.l2==null?.01:t.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(t){return _t(()=>{let n=Hs([1]);return this.hasL1&&(n=Xt(n,we(ct(this.l1,Ws(t))))),this.hasL2&&(n=Xt(n,we(ct(this.l2,Dg(t))))),gt(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,n){return new t({l1:n.l1,l2:n.l2})}}lO.className="L1L2";Gt(lO);const UI={l1l2:"L1L2"};function Vn(r){return OT(r)}function WI(r,t={}){return Ag(r,ro.getMap().classNameMap,t,"regularizer")}function os(r){if(r==null)return null;if(typeof r=="string"){const n={className:r in UI?UI[r]:r,config:{}};return WI(n)}else return r instanceof aO?r:WI(r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class cO extends un{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null&&(this.maxValue=t.maxValue)}call(t,n){t=Fe(t);let i=Ml(t);return this.maxValue!=null&&(i=zi(i,0,this.maxValue)),i}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},n=super.getConfig();return Object.assign(t,n),t}}cO.className="ReLU";Gt(cO);class uO extends un{constructor(t){super(t??{}),this.DEFAULT_ALPHA=.3,t==null&&(t={}),this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){const i=Fe(t);return W_(i,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}}uO.className="LeakyReLU";Gt(uO);class hO extends un{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),this.supportsMasking=!0,this.alphaInitializer=is(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=os(t.alphaRegularizer),this.alphaConstraint=Ls(t.alphaConstraint),t.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")this.sharedAxes=[t.sharedAxes];else throw new dt(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`)}build(t){t=In(t);const n=t.slice(1);if(this.sharedAxes!=null)for(const o of this.sharedAxes)n[o-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const i={};if(this.sharedAxes!=null)for(let o=1;o<t.length;++o)i[o]=t[o];this.inputSpec=[new Rs({ndim:t.length,axes:i})],this.built=!0}call(t,n){return t=Fe(t),Y_(t,this.alpha.read())}getConfig(){const t={alphaInitializer:ds(this.alphaInitializer),alphaRegularizer:Vn(this.alphaRegularizer),alphaConstraint:Os(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(t,n),t}}hO.className="PReLU";Gt(hO);let dO=class extends un{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==this.DEFAULT_ALPHA)throw new je(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){const i=Fe(t);return ly(i)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}};dO.className="ELU";Gt(dO);class fO extends un{constructor(t){super(t??{}),this.DEFAULT_THETA=1,t==null&&(t={}),this.theta=t.theta==null?this.DEFAULT_THETA:t.theta}call(t,n){const i=Fe(t);return ct(i,de(Ui(i,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},n=super.getConfig();return Object.assign(t,n),t}}fO.className="ThresholdedReLU";Gt(fO);let pO=class extends un{constructor(t){super(t??{}),this.DEFAULT_AXIS=1,t==null&&(t={}),this.softmax=new XT().apply,this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis}call(t,n){const i=Fe(t);return this.softmax(i,this.axis)}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}};pO.className="Softmax";Gt(pO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Td(r,t,n){if(typeof r=="number")return Qu(r,t);if(r.length!==t)throw new dt(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${r.length} elements.`);for(let i=0;i<t;++i){const o=r[i];if(!bit(o))throw new dt(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(r)} including a non-integer number ${o}`)}return r}function Xo(r,t,n,i,o=1){if(r==null)return r;const a=t+(t-1)*(o-1);let l;return n==="same"?l=r:l=r-a+1,Math.floor((l+i-1)/i)}function wa(r,t,n,i){if(r==null)return null;if(i==="valid")r=r*t+Tc([n-t,0]);else if(i==="same")r=r*t;else throw new dt(`Unsupport padding mode: ${i}.`);return r}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function YT(r,t){return _t(()=>(Ts(t),t==="channelsFirst"?vn(r,[0,2,3,1]):r))}function mO(r,t){return _t(()=>(Ts(t),t==="channelsFirst"?vn(r,[0,2,3,4,1]):r))}function Fot(r,t,n,i=1,o="valid",a,l=1){return _t(()=>{if(a==null&&(a=ta()),Ts(a),r.shape.length!==3)throw new dt(`The input of a conv1dWithBias operation should be 3, but is ${r.shape.length} instead.`);if(t.shape.length!==3)throw new dt(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new dt(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(a==="channelsFirst"&&(r=vn(r,[0,2,1])),o==="causal")throw new je("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let c=l9(r,t,i,o==="same"?"same":"valid","NWC",l);return n!=null&&(c=ca(c,n)),c})}function GI(r,t,n,i=[1,1],o="valid",a,l,c=null){return _t(()=>{if(a==null&&(a=ta()),Ts(a),r.rank!==3&&r.rank!==4)throw new dt(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${r.rank}.`);if(t.rank!==3&&t.rank!==4)throw new dt(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${r.rank}.`);let u=YT(r,a);if(o==="causal")throw new je("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=Fet({x:u,filter:t,strides:i,pad:o==="same"?"same":"valid",dilations:l,dataFormat:"NHWC",bias:n,activation:c}),a==="channelsFirst"&&(u=vn(u,[0,3,1,2])),u})}function Pot(r,t,n,i=[1,1,1],o="valid",a,l){return _t(()=>{if(a==null&&(a=ta()),Ts(a),r.rank!==4&&r.rank!==5)throw new dt(`conv3dWithBias expects input to be of rank 4 or 5, but received ${r.rank}.`);if(t.rank!==4&&t.rank!==5)throw new dt(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${r.rank}.`);let c=mO(r,a);if(o==="causal")throw new je("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return c=VJ(c,t,i,o==="same"?"same":"valid","NDHWC",l),n!=null&&(c=ca(c,n)),a==="channelsFirst"&&(c=vn(c,[0,4,1,2,3])),c})}class Sy extends un{constructor(t,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Sy.verifyArgs(n),this.rank=t,js(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new je(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Td(n.kernelSize,t,"kernelSize"),this.strides=Td(n.strides==null?1:n.strides,t,"strides"),this.padding=n.padding==null?"valid":n.padding,Wi(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Ts(this.dataFormat),this.activation=kc(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=is(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Ls(n.biasConstraint),this.biasRegularizer=os(n.biasRegularizer),this.activityRegularizer=os(n.activityRegularizer),this.dilationRate=Td(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new dt(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new dt(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new dt(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(ba("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!LT(t.kernelSize,"number",1,3))throw new dt(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Cc(this.activation),useBias:this.useBias,biasInitializer:ds(this.biasInitializer),biasRegularizer:Vn(this.biasRegularizer),activityRegularizer:Vn(this.activityRegularizer),biasConstraint:Os(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}}class yf extends Sy{constructor(t,n){super(t,n),this.kernel=null,yf.verifyArgs(n),this.filters=n.filters,js(this.filters,"filters"),this.kernelInitializer=is(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Ls(n.kernelConstraint),this.kernelRegularizer=os(n.kernelRegularizer)}build(t){t=In(t);const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new dt(`The channel dimension of the input should be defined. Found ${t[n]}`);const i=t[n],o=this.kernelSize.concat([i,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:i}}],this.built=!0}call(t,n){return _t(()=>{t=Fe(t);let i;const o=this.bias==null?null:this.bias.read(),a=f8(this.activation.getClassName());if(a!=null&&this.rank===2)i=GI(t,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,a);else{if(this.rank===1)i=Fot(t,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)i=GI(t,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)i=Pot(t,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new je("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(i=this.activation.apply(i))}return i})}computeOutputShape(t){t=In(t);const n=[],i=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let a=0;a<i.length;++a){const l=Xo(i[a],this.kernelSize[a],this.padding,this.strides[a],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[a]);n.push(l)}let o=[t[0]];return this.dataFormat==="channelsLast"?(o=o.concat(n),o.push(this.filters)):(o.push(this.filters),o=o.concat(n)),o}getConfig(){const t={filters:this.filters,kernelInitializer:ds(this.kernelInitializer),kernelRegularizer:Vn(this.kernelRegularizer),kernelConstraint:Os(this.kernelConstraint)},n=super.getConfig();return Object.assign(t,n),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new dt(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}let _y=class extends yf{constructor(t){super(2,t),_y.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!LT(t.kernelSize,"number",1,2))throw new dt(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}};_y.className="Conv2D";Gt(_y);let Ty=class extends yf{constructor(t){super(3,t),Ty.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new dt(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}};Ty.className="Conv3D";Gt(Ty);class gO extends _y{constructor(t){if(super(t),this.inputSpec=[new Rs({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new dt(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=In(t),t.length!==4)throw new dt("Input should have rank 4; Received input shape: "+JSON.stringify(t));const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new dt("The channel dimension of the inputs should be defined. Found `None`.");const i=t[n],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Rs({ndim:4,axes:{[n]:i}})],this.built=!0}call(t,n){return _t(()=>{let i=Fe(t);if(i.shape.length!==4)throw new dt(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${i.shape.length}`);const o=i.shape,a=o[0];let l,c;this.dataFormat==="channelsFirst"?(l=2,c=3):(l=1,c=2);const u=o[l],h=o[c],d=this.kernelSize[0],f=this.kernelSize[1],p=this.strides[0],m=this.strides[1],g=wa(u,p,d,this.padding),y=wa(h,m,f,this.padding),v=[a,g,y,this.filters];this.dataFormat!=="channelsLast"&&(i=vn(i,[0,2,3,1]));let x=c9(i,this.kernel.read(),v,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(x=vn(x,[0,3,1,2])),this.bias!=null&&(x=ca(x,this.bias.read(),this.dataFormat)),this.activation!=null&&(x=this.activation.apply(x)),x})}computeOutputShape(t){t=In(t);const n=t.slice();let i,o,a;this.dataFormat==="channelsFirst"?(i=1,o=2,a=3):(i=3,o=1,a=2);const l=this.kernelSize[0],c=this.kernelSize[1],u=this.strides[0],h=this.strides[1];return n[i]=this.filters,n[o]=wa(n[o],u,l,this.padding),n[a]=wa(n[a],h,c,this.padding),n}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}gO.className="Conv2DTranspose";Gt(gO);class vO extends Ty{constructor(t){if(super(t),this.inputSpec=[new Rs({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new dt(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=In(t),t.length!==5)throw new dt("Input should have rank 5; Received input shape: "+JSON.stringify(t));const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new dt("The channel dimension of the inputs should be defined. Found `None`.");const i=t[n],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Rs({ndim:5,axes:{[n]:i}})],this.built=!0}call(t,n){return _t(()=>{let i=Fe(t);if(i.shape.length!==5)throw new dt(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${i.shape.length}`);const o=i.shape,a=o[0];let l,c,u;this.dataFormat==="channelsFirst"?(u=2,l=3,c=4):(u=1,l=2,c=3);const h=o[u],d=o[l],f=o[c],p=this.kernelSize[0],m=this.kernelSize[1],g=this.kernelSize[2],y=this.strides[0],v=this.strides[1],x=this.strides[2],b=wa(h,y,p,this.padding),w=wa(d,v,m,this.padding),S=wa(f,x,g,this.padding),_=[a,b,w,S,this.filters];this.dataFormat!=="channelsLast"&&(i=vn(i,[0,2,3,4,1]));let $=GJ(i,this.kernel.read(),_,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&($=vn($,[0,4,1,2,3])),this.bias!==null&&($=ca($,this.bias.read(),this.dataFormat)),this.activation!==null&&($=this.activation.apply($)),$})}computeOutputShape(t){t=In(t);const n=t.slice();let i,o,a,l;this.dataFormat==="channelsFirst"?(i=1,o=2,a=3,l=4):(i=4,o=1,a=2,l=3);const c=this.kernelSize[0],u=this.kernelSize[1],h=this.kernelSize[2],d=this.strides[0],f=this.strides[1],p=this.strides[2];return n[i]=this.filters,n[o]=wa(n[o],d,c,this.padding),n[a]=wa(n[a],f,u,this.padding),n[l]=wa(n[l],p,h,this.padding),n}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}vO.className="Conv3DTranspose";Gt(vO);class yO extends yf{constructor(t,n){if(super(t,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new dt("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new dt("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new dt(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=is(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=os(n.depthwiseRegularizer),this.depthwiseConstraint=Ls(n.depthwiseConstraint),this.pointwiseInitializer=is(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=os(n.pointwiseRegularizer),this.pointwiseConstraint=Ls(n.pointwiseConstraint)}build(t){if(t=In(t),t.length<this.rank+2)throw new dt(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null||t[n]<0)throw new dt(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[n])}`);const i=t[n],o=this.kernelSize.concat([i,this.depthMultiplier]),a=[];for(let c=0;c<this.rank;++c)a.push(1);a.push(i*this.depthMultiplier,this.filters);const l=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,l,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,l,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,l,this.biasConstraint):this.bias=null,this.inputSpec=[new Rs({ndim:this.rank+2,axes:{[n]:i}})],this.built=!0}call(t,n){return _t(()=>{t=Fe(t);let i;if(this.rank===1)throw new je("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(t=vn(t,[0,2,3,1])),i=C9(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(i=ca(i,this.bias.read(),this.dataFormat)),this.activation!=null&&(i=this.activation.apply(i)),this.dataFormat==="channelsFirst"&&(i=vn(i,[0,3,1,2])),i})}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=ds(this.depthwiseInitializer),t.pointwiseInitializer=ds(this.pointwiseInitializer),t.depthwiseRegularizer=Vn(this.depthwiseRegularizer),t.pointwiseRegularizer=Vn(this.pointwiseRegularizer),t.depthwiseConstraint=Os(this.depthwiseConstraint),t.pointwiseConstraint=Os(this.pointwiseConstraint),t}}yO.className="SeparableConv";class xO extends yO{constructor(t){super(2,t)}}xO.className="SeparableConv2D";Gt(xO);class Cy extends yf{constructor(t){super(1,t),Cy.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!LT(t.kernelSize,"number",1,1))throw new dt(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}Cy.className="Conv1D";Gt(Cy);class bO extends un{constructor(t){super(t),typeof t.cropping=="number"?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,n){return _t(()=>{if(t=Fe(t),this.dataFormat==="channelsLast"){const i=L0(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return L0(i,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const i=L0(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return L0(i,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}bO.className="Cropping2D";Gt(bO);class wO extends un{constructor(t){super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=t.size==null?this.DEFAULT_SIZE:t.size,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Ts(this.dataFormat),this.interpolation=t.interpolation==null?"nearest":t.interpolation,vit(this.interpolation)}computeOutputShape(t){if(this.dataFormat==="channelsFirst"){const n=t[2]==null?null:this.size[0]*t[2],i=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],n,i]}else{const n=t[1]==null?null:this.size[0]*t[1],i=t[2]==null?null:this.size[1]*t[2];return[t[0],n,i,t[3]]}}call(t,n){return _t(()=>{let i=Fe(t);const o=i.shape;if(this.dataFormat==="channelsFirst"){i=vn(i,[0,2,3,1]);const a=this.size[0]*o[2],l=this.size[1]*o[3],c=this.interpolation==="nearest"?wu.resizeNearestNeighbor(i,[a,l]):wu.resizeBilinear(i,[a,l]);return vn(c,[0,3,1,2])}else{const a=this.size[0]*o[1],l=this.size[1]*o[2];return this.interpolation==="nearest"?wu.resizeNearestNeighbor(i,[a,l]):wu.resizeBilinear(i,[a,l])}})}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(t,n),t}}wO.className="UpSampling2D";Gt(wO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bot(r,t,n=[1,1],i="valid",o,a){return _t(()=>{o==null&&(o=ta()),Ts(o);let l=YT(r,o);if(r.rank!==4)throw new dt(`Input for depthwiseConv2d is required to be 4-D, but is instead ${r.rank}-D`);if(t.rank!==4)throw new dt(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return l=z_(l,t,n,i==="same"?"same":"valid","NHWC",a),o==="channelsFirst"&&(l=vn(l,[0,3,1,2])),l})}class SO extends Sy{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=is(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Ls(t.depthwiseConstraint),this.depthwiseRegularizer=os(t.depthwiseRegularizer)}build(t){if(t=In(t),t.length<4)throw new dt(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(t[n]==null||t[n]<0)throw new dt(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[n]}).`);const i=t[n],o=[this.kernelSize[0],this.kernelSize[1],i,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",o,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[i*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return _t(()=>{t=Fe(t);let i=Bot(t,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(i=ca(i,this.bias.read(),this.dataFormat)),this.activation!=null&&(i=this.activation.apply(i)),i})}computeOutputShape(t){t=In(t);const n=this.dataFormat==="channelsFirst"?t[2]:t[1],i=this.dataFormat==="channelsFirst"?t[3]:t[2],o=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,a=Xo(n,this.kernelSize[0],this.padding,this.strides[0]),l=Xo(i,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],o,a,l]:[t[0],a,l,o]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=ds(this.depthwiseInitializer),t.depthwiseRegularizer=Vn(this.depthwiseRegularizer),t.depthwiseConstraint=Os(this.depthwiseRegularizer),t}}SO.className="DepthwiseConv2D";Gt(SO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _O(r,t,n,i){if(Array.isArray(r)){if(t!=null||n!=null)throw new dt("When inputs is an array, neither initialState or constants should be provided");i!=null&&(n=r.slice(r.length-i,r.length),r=r.slice(0,r.length-i)),r.length>1&&(t=r.slice(1,r.length)),r=r[0]}function o(a){return a==null||Array.isArray(a)?a:[a]}return t=o(t),n=o(n),{inputs:r,initialState:t,constants:n}}function TO(r,t,n,i=!1,o,a,l=!1,c=!1){return _t(()=>{const u=t.shape.length;if(u<3)throw new dt(`Input should be at least 3D, but is ${u}D.`);const h=[1,0].concat(Qo(2,u));if(t=vn(t,h),a!=null)throw new je("The rnn() functoin of the deeplearn.js backend does not support constants yet.");l&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=de(de(o,"bool"),"float32"),o.rank===u-1&&(o=ui(o,-1)),o=vn(o,h)),i&&(t=Yu(t,0),o!=null&&(o=Yu(o,0)));const d=[];let f,p=n;const m=t.shape[0],g=Zu(t);let y;o!=null&&(y=Zu(o));for(let x=0;x<m;++x){const b=g[x],w=_t(()=>r(b,p));if(o==null)f=w[0],p=w[1];else{const S=_t(()=>{const _=y[x],$=Se(So(_),_),N=Xt(ct(w[0],_),ct(p[0],$)),k=p.map((I,O)=>Xt(ct(w[1][O],_),ct(I,$)));return{output:N,newStates:k}});f=S.output,p=S.newStates}c&&d.push(f)}let v;return c&&(v=_c(d,1)),[f,v,p]})}class Gc extends un{constructor(t){super(t);let n;if(t.cell==null)throw new dt("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?n=new QT({cells:t.cell}):n=t.cell,n.stateSize==null)throw new dt("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new Rs({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Qo(0,t).map(n=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){dw(t)&&(t=t[0]),t=t;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const i=n[0];let o;if(this.returnSequences?o=[t[0],t[1],i]:o=[t[0],i],this.returnState){const a=[];for(const l of n)a.push([t[0],l]);return[o].concat(a)}else return o}computeMask(t,n){return _t(()=>{Array.isArray(n)&&(n=n[0]);const i=this.returnSequences?n:null;if(this.returnState){const o=this.states.map(a=>null);return[i].concat(o)}else return i})}get states(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let i=0;i<t;++i)n.push(null);return n}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new je("Constants support is not implemented in RNN yet.");dw(t)&&(t=t[0]),t=t;const n=this.stateful?t[0]:null,i=t.slice(2);this.inputSpec[0]=new Rs({shape:[n,null,...i]});const o=[t[0]].concat(t.slice(2));this.cell.build(o);let a;if(Array.isArray(this.cell.stateSize)?a=this.cell.stateSize:a=[this.cell.stateSize],this.stateSpec!=null){if(!An(this.stateSpec.map(l=>l.shape[l.shape.length-1]),a))throw new dt(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=a.map(l=>new Rs({shape:[null,l]}));this.stateful&&this.resetStates()}resetStates(t,n=!1){_t(()=>{if(!this.stateful)throw new xa("Cannot call resetStates() on an RNN Layer that is not stateful.");const i=this.inputSpec[0].shape[0];if(i==null)throw new dt("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(o=>Hs([i,o])):this.states_=[Hs([i,this.cell.stateSize])];else if(t==null)ln(this.states_),this.keptStates!=null&&(ln(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(o=>Hs([i,o])):this.states_[0]=Hs([i,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new dt(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n===!0?this.keptStates.push(this.states_.slice()):ln(this.states_);for(let o=0;o<this.states_.length;++o){const a=t[o],l=Array.isArray(this.cell.stateSize)?this.cell.stateSize[o]:this.cell.stateSize,c=[i,l];if(!An(a.shape,c))throw new dt(`State ${o} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${a.shape}`);this.states_[o]=a}}this.states_=this.states_.map(o=>Aa(o.clone()))})}apply(t,n){let i=n==null?null:n.initialState,o=n==null?null:n.constants;n==null&&(n={});const a=_O(t,i,o,this.numConstants);t=a.inputs,i=a.initialState,o=a.constants;let l=[],c=[];if(i!=null){n.initialState=i,l=l.concat(i),this.stateSpec=[];for(const h of i)this.stateSpec.push(new Rs({shape:h.shape}));c=c.concat(this.stateSpec)}if(o!=null&&(n.constants=o,l=l.concat(o),this.numConstants=o.length),l[0]instanceof Ca){const h=[t].concat(l),d=this.inputSpec.concat(c),f=this.inputSpec;this.inputSpec=d;const p=super.apply(h,n);return this.inputSpec=f,p}else return super.apply(t,n)}call(t,n){return _t(()=>{const i=n==null?null:n.mask,o=n==null?null:n.training;let a=n==null?null:n.initialState;t=Fe(t),a==null&&(this.stateful?a=this.states_:a=this.getInitialState(t));const l=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(a.length!==l)throw new dt(`RNN Layer has ${l} state(s) but was passed ${a.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const c={training:o},h=TO((g,y)=>{const v=this.cell.call([g].concat(y),c);return[v[0],v.slice(1)]},t,a,this.goBackwards,i,null,this.unroll,this.returnSequences),d=h[0],f=h[1],p=h[2];this.stateful&&this.resetStates(p,o);const m=this.returnSequences?f:d;return this.returnState?[m].concat(p):m})}getInitialState(t){return _t(()=>{let n=Hs(t.shape);return n=we(n,[1,2]),n=Mg(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(i=>i>1?uw(n,[1,i]):n):this.cell.stateSize>1?[uw(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const i=this.cell.getConfig();return this.getClassName()===Gc.className&&(n.cell={className:this.cell.getClassName(),config:i}),Object.assign(Object.assign(Object.assign({},i),t),n)}static fromConfig(t,n,i={}){const o=n.cell,a=pl(o,i);return new t(Object.assign(n,{cell:a}))}}Gc.className="RNN";Gt(Gc);class ky extends un{}class ZT extends ky{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,js(this.units,"units"),this.activation=kc(t.activation==null?this.DEFAULT_ACTIVATION:t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=is(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=is(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=is(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=os(t.kernelRegularizer),this.recurrentRegularizer=os(t.recurrentRegularizer),this.biasRegularizer=os(t.biasRegularizer),this.kernelConstraint=Ls(t.kernelConstraint),this.recurrentConstraint=Ls(t.recurrentConstraint),this.biasConstraint=Ls(t.biasConstraint),this.dropout=zd([1,Tc([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=zd([1,Tc([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=In(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return _t(()=>{if(t=t,t.length!==2)throw new dt(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let i=t[1];t=t[0];const o=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=$c({ones:()=>So(t),rate:this.dropout,training:o,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=$c({ones:()=>So(i),rate:this.recurrentDropout,training:o,dropoutFunc:this.dropoutFunc}));let a;const l=this.dropoutMask,c=this.recurrentDropoutMask;l!=null?a=Ra(ct(t,l),this.kernel.read()):a=Ra(t,this.kernel.read()),this.bias!=null&&(a=ca(a,this.bias.read())),c!=null&&(i=ct(i,c));let u=Xt(a,Ra(i,this.recurrentKernel.read()));return this.activation!=null&&(u=this.activation.apply(u)),[u,u]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:Cc(this.activation),useBias:this.useBias,kernelInitializer:ds(this.kernelInitializer),recurrentInitializer:ds(this.recurrentInitializer),biasInitializer:ds(this.biasInitializer),kernelRegularizer:Vn(this.kernelRegularizer),recurrentRegularizer:Vn(this.recurrentRegularizer),biasRegularizer:Vn(this.biasRegularizer),activityRegularizer:Vn(this.activityRegularizer),kernelConstraint:Os(this.kernelConstraint),recurrentConstraint:Os(this.recurrentConstraint),biasConstraint:Os(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),n)}}ZT.className="SimpleRNNCell";Gt(ZT);class CO extends Gc{constructor(t){t.cell=new ZT(t),super(t)}call(t,n){return _t(()=>{this.cell.dropoutMask!=null&&(ln(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ln(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const i=n==null?null:n.mask,o=n==null?null:n.training,a=n==null?null:n.initialState;return super.call(t,{mask:i,training:o,initialState:a})})}static fromConfig(t,n){return new t(n)}}CO.className="SimpleRNN";Gt(CO);class JT extends ky{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new dt("GRUCell does not support reset_after parameter set to true.");this.units=t.units,js(this.units,"units"),this.activation=kc(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=kc(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=is(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=is(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=is(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=os(t.kernelRegularizer),this.recurrentRegularizer=os(t.recurrentRegularizer),this.biasRegularizer=os(t.biasRegularizer),this.kernelConstraint=Ls(t.kernelConstraint),this.recurrentConstraint=Ls(t.recurrentConstraint),this.biasConstraint=Ls(t.biasConstraint),this.dropout=zd([1,Tc([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=zd([1,Tc([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=In(t);const n=t[t.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return _t(()=>{if(t=t,t.length!==2)throw new dt(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const i=n.training==null?!1:n.training;let o=t[1];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=$c({ones:()=>So(t),rate:this.dropout,training:i,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=$c({ones:()=>So(o),rate:this.recurrentDropout,training:i,count:3,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,l=this.recurrentDropoutMask;let c,u,h;0<this.dropout&&this.dropout<1&&(t=ct(t,a[0]));let d=Ra(t,this.kernel.read());this.useBias&&(d=ca(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(o=ct(o,l[0]));const f=this.recurrentKernel.read(),[p,m]=Li(f,[2*this.units,this.units],f.rank-1),g=Ra(o,p),[y,v,x]=Li(d,3,d.rank-1),[b,w]=Li(g,2,g.rank-1);c=this.recurrentActivation.apply(Xt(y,b)),u=this.recurrentActivation.apply(Xt(v,w));const S=Ra(ct(u,o),m);h=this.activation.apply(Xt(x,S));const _=Xt(ct(c,o),ct(Xt(1,fs(c)),h));return[_,_]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:Cc(this.activation),recurrentActivation:Cc(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ds(this.kernelInitializer),recurrentInitializer:ds(this.recurrentInitializer),biasInitializer:ds(this.biasInitializer),kernelRegularizer:Vn(this.kernelRegularizer),recurrentRegularizer:Vn(this.recurrentRegularizer),biasRegularizer:Vn(this.biasRegularizer),activityRegularizer:Vn(this.activityRegularizer),kernelConstraint:Os(this.kernelConstraint),recurrentConstraint:Os(this.recurrentConstraint),biasConstraint:Os(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),n)}}JT.className="GRUCell";Gt(JT);class kO extends Gc{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new JT(t),super(t)}call(t,n){return _t(()=>{this.cell.dropoutMask!=null&&(ln(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ln(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const i=n==null?null:n.mask,o=n==null?null:n.training,a=n==null?null:n.initialState;return super.call(t,{mask:i,training:o,initialState:a})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}kO.className="GRU";Gt(kO);class $y extends ky{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,js(this.units,"units"),this.activation=kc(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=kc(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=is(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=is(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=is(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=os(t.kernelRegularizer),this.recurrentRegularizer=os(t.recurrentRegularizer),this.biasRegularizer=os(t.biasRegularizer),this.kernelConstraint=Ls(t.kernelConstraint),this.recurrentConstraint=Ls(t.recurrentConstraint),this.biasConstraint=Ls(t.biasConstraint),this.dropout=zd([1,Tc([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=zd([1,Tc([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var n;t=In(t);const i=t[t.length-1];this.kernel=this.addWeight("kernel",[i,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let o;if(this.useBias){if(this.unitForgetBias){const a=this.biasInitializer,l=this.units;o=new(n=class extends $o{apply(u,h){const d=a.apply([l]),f=new PT().apply([l]),p=a.apply([l*2]);return $I($I(d,f),p)}},n.className="CustomInit",n)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,o,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,n){return _t(()=>{const i=n.training==null?!1:n.training;if(t=t,t.length!==3)throw new dt(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let o=t[1];const a=t[2];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=$c({ones:()=>So(t),rate:this.dropout,training:i,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=$c({ones:()=>So(o),rate:this.recurrentDropout,training:i,count:4,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=this.recurrentDropoutMask;let u,h,d,f;0<this.dropout&&this.dropout<1&&(t=ct(t,l[0]));let p=Ra(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(o=ct(o,c[0])),p=Xt(p,Ra(o,this.recurrentKernel.read())),this.useBias&&(p=ca(p,this.bias.read()));const[m,g,y,v]=Li(p,4,p.rank-1);u=this.recurrentActivation.apply(m),h=this.recurrentActivation.apply(g),d=Xt(ct(h,a),ct(u,this.activation.apply(y))),f=this.recurrentActivation.apply(v);const x=ct(f,this.activation.apply(d));return[x,x,d]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:Cc(this.activation),recurrentActivation:Cc(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ds(this.kernelInitializer),recurrentInitializer:ds(this.recurrentInitializer),biasInitializer:ds(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Vn(this.kernelRegularizer),recurrentRegularizer:Vn(this.recurrentRegularizer),biasRegularizer:Vn(this.biasRegularizer),activityRegularizer:Vn(this.activityRegularizer),kernelConstraint:Os(this.kernelConstraint),recurrentConstraint:Os(this.recurrentConstraint),biasConstraint:Os(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),n)}}$y.className="LSTMCell";Gt($y);class $O extends Gc{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new $y(t),super(t)}call(t,n){return _t(()=>{this.cell.dropoutMask!=null&&(ln(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ln(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const i=n==null?null:n.mask,o=n==null?null:n.training,a=n==null?null:n.initialState;return super.call(t,{mask:i,training:o,initialState:a})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}$O.className="LSTM";Gt($O);class QT extends ky{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?t.push(...n.stateSize):t.push(n.stateSize);return t}call(t,n){return _t(()=>{t=t;let i=t.slice(1);const o=[];for(const c of this.cells.slice().reverse())Array.isArray(c.stateSize)?o.push(i.splice(0,c.stateSize.length)):o.push(i.splice(0,1));o.reverse();const a=[];let l;for(let c=0;c<this.cells.length;++c){const u=this.cells[c];i=o[c],c===0?l=[t[0]].concat(i):l=[l[0]].concat(i),l=u.call(l,n),a.push(l.slice(1))}i=[];for(const c of a.slice().reverse())i.push(...c);return[l[0]].concat(i)})}build(t){dw(t)&&(t=t[0]),t=t;let n;this.cells.forEach((i,o)=>{Du(`RNNCell_${o}`,()=>{i.build(t),Array.isArray(i.stateSize)?n=i.stateSize[0]:n=i.stateSize,t=[t[0],n]})}),this.built=!0}getConfig(){const t=super.getConfig(),n=a=>({className:a.getClassName(),config:a.getConfig()}),o={cells:this.cells.map(n)};return Object.assign(Object.assign({},t),o)}static fromConfig(t,n,i={}){const o=[];for(const a of n.cells)o.push(pl(a,i));return new t({cells:o})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const n of this.cells)t.push(...n.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const n of this.cells)t.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const i of this.cells)n.push(...i.trainableWeights);return n.concat(t)}return t}getWeights(){const t=[];for(const n of this.cells)t.push(...n.weights);return fw(t)}setWeights(t){const n=[];for(const i of this.cells){const o=i.weights.length,a=t.splice(o);for(let l=0;l<i.weights.length;++l)n.push([i.weights[l],a[l]])}HT(n)}}QT.className="StackedRNNCells";Gt(QT);function $c(r){const{ones:t,rate:n,training:i=!1,count:o=1,dropoutFunc:a}=r,l=()=>a!=null?a(t(),n):b8(t(),n),c=()=>Rg(l,t,i);return!o||o<=1?Aa(c().clone()):Array(o).fill(void 0).map(c).map(h=>Aa(h.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var zot=globalThis&&globalThis.__rest||function(r,t){var n={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(n[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,i=Object.getOwnPropertySymbols(r);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(r,i[o])&&(n[i[o]]=r[i[o]]);return n};class IO extends Gc{constructor(t){if(t.unroll)throw new je("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new je("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new Rs({ndim:5})]}call(t,n){return _t(()=>{if(this.cell.dropoutMask!=null&&(ln(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ln(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new dt("ConvRNN2D cell does not support constants");const i=n==null?null:n.mask,o=n==null?null:n.training,a=n==null?null:n.initialState;return super.call(t,{mask:i,training:o,initialState:a})})}computeOutputShape(t){let n=this.computeSingleOutputShape(t);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([t[0],...n.slice(-3)])]),n}getInitialState(t){return _t(()=>{const{stateSize:n}=this.cell,i=t.shape,o=this.computeSingleOutputShape(i),a=[o[0],...o.slice(2)],l=Hs(a);return Array.isArray(n)?Array(n.length).fill(l):[l]})}resetStates(t,n=!1){_t(()=>{if(!this.stateful)throw new xa("Cannot call resetStates() on an RNN Layer that is not stateful.");const i=this.inputSpec[0].shape,o=this.computeSingleOutputShape(i),a=[o[0],...o.slice(2)];if(i[0]==null)throw new dt("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Hs(a)):this.states_=[Hs(a)];else if(t==null)ln(this.states_),this.keptStates!=null&&(ln(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Hs(a)):this.states_[0]=Hs(a);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new dt(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n?this.keptStates.push(this.states_.slice()):ln(this.states_);for(let c=0;c<this.states_.length;++c){const u=t[c],h=a;if(!An(u.shape,h))throw new dt(`State ${c} is incompatible with layer ${this.name}: expected shape=${h}, received shape=${u.shape}`);this.states_[c]=u}}this.states_=this.states_.map(c=>Aa(c.clone()))})}computeSingleOutputShape(t){const{dataFormat:n,filters:i,kernelSize:o,padding:a,strides:l,dilationRate:c}=this.cell,u=n==="channelsFirst",h=t[u?3:2],d=t[u?4:3],f=Xo(h,o[0],a,l[0],c[0]),p=Xo(d,o[1],a,l[1],c[1]);return[...t.slice(0,2),...u?[i,f,p]:[f,p,i]]}}IO.className="ConvRNN2D";class tC extends $y{constructor(t){const{filters:n,kernelSize:i,strides:o,padding:a,dataFormat:l,dilationRate:c}=t;super(Object.assign(Object.assign({},t),{units:n})),this.filters=n,js(this.filters,"filters"),this.kernelSize=Td(i,2,"kernelSize"),this.kernelSize.forEach(u=>js(u,"kernelSize")),this.strides=Td(o||1,2,"strides"),this.strides.forEach(u=>js(u,"strides")),this.padding=a||"valid",Wi(this.padding),this.dataFormat=l||"channelsLast",Ts(this.dataFormat),this.dilationRate=Td(c||1,2,"dilationRate"),this.dilationRate.forEach(u=>js(u,"dilationRate"))}build(t){var n;t=In(t);const i=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[i]==null)throw new dt(`The channel dimension of the input should be defined. Found ${t[i]}`);const o=t[i],a=4,l=this.kernelSize.concat([o,this.filters*a]);this.kernel=this.addWeight("kernel",l,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const c=this.kernelSize.concat([this.filters,this.filters*a]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",c,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let u;if(this.unitForgetBias){const h=this.biasInitializer,d=this.filters;u=new(n=class extends $o{apply(p,m){const g=h.apply([d]),y=Vc([d]),v=h.apply([d*2]);return FT([g,y,v])}},n.className="CustomInit",n)}else u=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*a],null,u,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,n){return _t(()=>{if(t.length!==3)throw new dt(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const i=n.training||!1,o=t[0],a=t[1],l=t[2],c=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=$c({ones:()=>So(o),rate:this.dropout,training:i,count:c,dropoutFunc:this.dropoutFunc}));const u=this.dropoutMask,h=(it,J,rt)=>!J||!J[rt]?it:ct(J[rt],it);let d=h(o,u,0),f=h(o,u,1),p=h(o,u,2),m=h(o,u,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=$c({ones:()=>So(a),rate:this.recurrentDropout,training:i,count:c,dropoutFunc:this.dropoutFunc}));const g=this.recurrentDropoutMask;let y=h(a,g,0),v=h(a,g,1),x=h(a,g,2),b=h(a,g,3);const w=3,[S,_,$,N]=Li(this.kernel.read(),c,w),[k,I,O,B]=this.useBias?Li(this.bias.read(),c):[null,null,null,null];d=this.inputConv(d,S,k,this.padding),f=this.inputConv(f,_,I,this.padding),p=this.inputConv(p,$,O,this.padding),m=this.inputConv(m,N,B,this.padding);const[F,D,L,V]=Li(this.recurrentKernel.read(),c,w);y=this.recurrentConv(y,F),v=this.recurrentConv(v,D),x=this.recurrentConv(x,L),b=this.recurrentConv(b,V);const j=this.recurrentActivation.apply(Xt(d,y)),Y=this.recurrentActivation.apply(Xt(f,v)),H=Xt(ct(Y,l),ct(j,this.activation.apply(Xt(p,x)))),et=ct(this.recurrentActivation.apply(Xt(m,b)),this.activation.apply(H));return[et,et,H]})}getConfig(){const t=super.getConfig(),n=zot(t,["units"]),i={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),i)}inputConv(t,n,i,o){const a=Ku(t,n,this.strides,o||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return i?ca(a,i,this.dataFormat):a}recurrentConv(t,n){return Ku(t,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}tC.className="ConvLSTM2DCell";Gt(tC);class EO extends IO{constructor(t){const n=new tC(t);super(Object.assign(Object.assign({},t),{cell:n}))}static fromConfig(t,n){return new t(n)}}EO.className="ConvLSTM2D";Gt(EO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class eC extends un{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(this.noiseShape==null)return this.noiseShape;const n=t.shape,i=[];for(let o=0;o<this.noiseShape.length;++o)i.push(this.noiseShape[o]==null?n[o]:this.noiseShape[o]);return i}call(t,n){return _t(()=>{this.invokeCallHook(t,n);const i=Fe(t);if(0<this.rate&&this.rate<1){const o=n.training==null?!1:n.training,a=this.getNoiseShape(i);return Rg(()=>b8(i,this.rate,a,this.seed),()=>i,o)}return t})}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(t,n),t}dispose(){return super.dispose()}}eC.className="Dropout";Gt(eC);class NO extends eC{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const n=t.shape;return[n[0],1,n[2]]}}NO.className="SpatialDropout1D";Gt(NO);class AO extends un{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){let n=null;t.batchSize!=null&&(n=t.batchSize),this.batchInputShape=[n,t.inputDim]}this.units=t.units,js(this.units,"units"),this.activation=kc(t.activation),t.useBias!=null&&(this.useBias=t.useBias),this.kernelInitializer=is(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=is(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Ls(t.kernelConstraint),this.biasConstraint=Ls(t.biasConstraint),this.kernelRegularizer=os(t.kernelRegularizer),this.biasRegularizer=os(t.biasRegularizer),this.activityRegularizer=os(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){t=In(t);const n=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(t){t=In(t);const n=t.slice();return n[n.length-1]=this.units,n}call(t,n){return _t(()=>{this.invokeCallHook(t,n);const i=Fe(t),o=f8(this.activation.getClassName());let a;return o!=null?a=Ra(i,this.kernel.read(),o,this.bias?this.bias.read():null):(a=Ra(i,this.kernel.read()),this.bias!=null&&(a=ca(a,this.bias.read())),this.activation!=null&&(a=this.activation.apply(a))),a})}getConfig(){const t={units:this.units,activation:Cc(this.activation),useBias:this.useBias,kernelInitializer:ds(this.kernelInitializer),biasInitializer:ds(this.biasInitializer),kernelRegularizer:Vn(this.kernelRegularizer),biasRegularizer:Vn(this.biasRegularizer),activityRegularizer:Vn(this.activityRegularizer),kernelConstraint:Os(this.kernelConstraint),biasConstraint:Os(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}}AO.className="Dense";Gt(AO);class MO extends un{constructor(t){t=t||{},super(t),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=In(t);for(const n of t.slice(1))if(n==null)throw new dt(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],fc(t,1)]}call(t,n){return _t(()=>{this.invokeCallHook(t,n);let i=Fe(t);if(this.dataFormat==="channelsFirst"&&i.rank>1){const o=[0];for(let a=2;a<i.rank;++a)o.push(a);o.push(1),i=vn(i,o)}return _it(i)})}getConfig(){const t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(t,n),t}}MO.className="Flatten";Gt(MO);class DO extends un{constructor(t){super(t),this.supportsMasking=!0,this.activation=kc(t.activation)}call(t,n){return _t(()=>{this.invokeCallHook(t,n);const i=Fe(t);return this.activation.apply(i)})}getConfig(){const t={activation:Cc(this.activation)},n=super.getConfig();return Object.assign(t,n),t}}DO.className="Activation";Gt(DO);class RO extends un{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,n){return _t(()=>(t=Fe(t),wit(t,this.n)))}getConfig(){const t={n:this.n},n=super.getConfig();return Object.assign(t,n),t}}RO.className="RepeatVector";Gt(RO);let OO=class extends un{constructor(t){super(t),this.targetShape=t.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(t){return t<0||t==null}fixUnknownDimension(t,n){const i="Total size of new array must be unchanged.",o=n.slice();let a=1,l=null;for(let u=0;u<o.length;++u){const h=o[u];if(this.isUnknown(h))if(l===null)l=u;else throw new dt("Can only specifiy one unknown dimension.");else a*=h}const c=fc(t);if(l!==null){if(a===0||c%a!==0)throw new dt(i);o[l]=c/a}else if(c!==a)throw new dt(i);return o}computeOutputShape(t){let n=!1;for(let i=0;i<t.length;++i)if(this.isUnknown(t[i])){n=!0;break}return n?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,n){return _t(()=>{this.invokeCallHook(t,n);const i=Fe(t),o=i.shape,a=o.slice(0,1).concat(this.fixUnknownDimension(o.slice(1),this.targetShape));return gt(i,a)})}getConfig(){const t={targetShape:this.targetShape},n=super.getConfig();return Object.assign(t,n),t}};OO.className="Reshape";Gt(OO);class LO extends un{constructor(t){if(super(t),t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const n=Qo(1,t.dims.length+1);if(!An(t.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Rs({ndim:this.dims.length+1})]}computeOutputShape(t){t=In(t);const n=t.slice();return this.dims.forEach((i,o)=>{n[o+1]=t[i]}),n}call(t,n){return vn(Fe(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},n=super.getConfig();return Object.assign(t,n),t}}LO.className="Permute";Gt(LO);class FO extends un{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null?this.maskValue=t.maskValue==null?0:t.maskValue:this.maskValue=0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,t),n}computeMask(t,n){const i=Fe(t),o=-1;return Z3(Yp(i,this.maskValue),o)}call(t,n){return _t(()=>{this.invokeCallHook(t,n);const i=Fe(t),o=-1,a=!0,l=Z3(Yp(i,this.maskValue),o,a);return ct(i,de(l,i.dtype))})}}FO.className="Masking";Gt(FO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class PO extends un{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){let n=null;t.batchSize!=null&&(n=t.batchSize),t.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(ts(t.inputLength))}this.inputDim=t.inputDim,js(this.inputDim,"inputDim"),this.outputDim=t.outputDim,js(this.outputDim,"outputDim"),this.embeddingsInitializer=is(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=os(t.embeddingsRegularizer),this.activityRegularizer=os(t.activityRegularizer),this.embeddingsConstraint=Ls(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,n){return _t(()=>this.maskZero?(t=Fe(t),Yp(t,Sn(t))):null)}computeOutputShape(t){if(t=In(t),this.inputLength==null)return[...t,this.outputDim];const n=ts(this.inputLength);if(n.length!==t.length-1)throw new dt(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let i=0;for(let o=0;o<n.length;++o){const a=n[o],l=t[o+1];if(a!=null&&l!=null&&a!==l)throw new dt(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);a==null&&(n[i]=l),i++}}return[t[0],...n,this.outputDim]}call(t,n){return _t(()=>{this.invokeCallHook(t,n);let i=Fe(t);i.dtype!=="int32"&&(i=Da(i,"int32"));const o=x8(this.embeddings.read(),gt(i,[i.size]));return gt(o,In(this.computeOutputShape(i.shape)))})}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:ds(this.embeddingsInitializer),embeddingsRegularizer:Vn(this.embeddingsRegularizer),activityRegularizer:Vn(this.activityRegularizer),embeddingsConstraint:Os(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(t,n),t}}PO.className="Embedding";Gt(PO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _h extends un{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new je}computeElementwiseOpOutputShape(t,n){if(t==null||n==null)return null;if(t.length<n.length)return this.computeElementwiseOpOutputShape(n,t);if(n.length===0)return t;const i=t.slice(0,t.length-n.length);for(let o=0;o<n.length;++o){const a=t[t.length-n.length+o],l=n[o];if(a==null||l==null||a<0||l<0)i.push(null);else if(a===1)i.push(l);else if(l===1)i.push(a);else{if(a!==l)throw new dt("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(n));i.push(a)}}return i}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[In(t)]),t=t,t.length<2)throw new dt(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let n=[];for(const a of t)a!=null&&a[0]!==null&&n.push(a[0]);if(n=dc(n),n.length>1)throw new dt(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let i=t[0]==null?null:t[0].slice(1);for(let a=1;a<t.length;++a){const l=t[a]==null?null:t[a].slice(1);i=this.computeElementwiseOpOutputShape(i,l)}const o=t.map(a=>a.length);t.indexOf(null)===-1&&dc(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,n){return _t(()=>{if(t=t,this.reshapeRequired){const i=[],o=t.map(a=>a.rank);if(o.indexOf(null)===-1){const a=Tc(o);for(let l of t){const c=l.rank;for(let u=0;u<a-c;++u)l=Mg(l,1);i.push(l)}return this.mergeFunction(i)}else{let a=!1;for(const u of t){const h=u.rank;if(h==null){const d=u.shape,f=d[0],p=d.slice(1).concat([f]);let m=gt(u,[f].concat(fc(d.slice(1))));m=vn(m,[1,0]),m=gt(m,p),i.push(m),a=!0}else if(h>1){const d=Qo(1,h).concat([0]);i.push(vn(u,d)),a=!0}else i.push(u)}let l=this.mergeFunction(i);const c=l.rank;if(a){if(c==null){const u=l.shape,h=u.length,d=u[h-1],f=[d].concat(u.slice(0,u.length-1));l=gt(vn(gt(l,[-1,d]),[1,0]),f)}else if(c>1){const u=[c-1].concat(Qo(0,c-1));l=vn(l,u)}}return l}}else return this.mergeFunction(t)})}computeOutputShape(t){t=t;let n;t[0]==null?n=null:n=t[0].slice(1);for(let o=1;o<t.length;++o){const a=t[o]==null?null:t[o].slice(1);n=this.computeElementwiseOpOutputShape(n,a)}let i=[];for(const o of t)o!=null&&o[0]!==null&&i.push(o[0]);return i=dc(i),i.length===1?n=i.concat(n):n=[null].concat(n),n}computeMask(t,n){return _t(()=>{if(n==null)return null;if(!Array.isArray(n))throw new dt("`mask` should be an Array");if(!Array.isArray(t))throw new dt("`inputs` should be an Array");if(n.length!==t.length)throw new dt(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${n.length})`);if(n.every(o=>o==null))return null;n=n.map(o=>o==null?o:ui(o,0));let i=n[0];for(let o=1;o<n.length-1;++o)i=wl(i,n[o]);return i})}}let BO=class extends _h{constructor(t){super(t)}mergeFunction(t){return _t(()=>{let n=t[0].clone();for(let i=1;i<t.length;++i)n=Xt(n,t[i]);return n})}};BO.className="Add";Gt(BO);let zO=class extends _h{constructor(t){super(t)}mergeFunction(t){return _t(()=>{let n=t[0].clone();for(let i=1;i<t.length;++i)n=ct(n,t[i]);return n})}};zO.className="Multiply";Gt(zO);class VO extends _h{constructor(t){super(t)}mergeFunction(t){return _t(()=>{let n=t[0].clone();for(let i=1;i<t.length;++i)n=Xt(n,t[i]);return ct(1/t.length,n)})}}VO.className="Average";Gt(VO);let UO=class extends _h{constructor(t){super(t)}mergeFunction(t){return _t(()=>{let n=t[0];for(let i=1;i<t.length;++i)n=zc(n,t[i]);return n})}};UO.className="Maximum";Gt(UO);let WO=class extends _h{constructor(t){super(t)}mergeFunction(t){return _t(()=>{let n=t[0];for(let i=1;i<t.length;++i)n=hy(n,t[i]);return n})}};WO.className="Minimum";Gt(WO);class GO extends _h{constructor(t){super(t),this.DEFAULT_AXIS=-1,t==null&&(t={}),this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new dt("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let n=!0;for(const o of t)if(o!=null){n=!1;break}if(n)return;const i=[];for(let o=0;o<t.length;++o){const a=t[o].slice();a.splice(this.axis,1);let l=!1;for(const c of i)if(An(c,a)){l=!0;break}l||i.push(a)}if(i.length>1)throw new dt("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return _t(()=>FT(t,this.axis))}computeOutputShape(t){if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new dt("A `Concatenate` layer should be called on a list of inputs.");const n=t,i=n[0].slice(),o=this.axis<0?i.length+this.axis:this.axis;for(const a of n.slice(1)){if(i[o]==null||a[o]==null){i[o]=null;break}i[o]+=a[o]}return i}computeMask(t,n){if(n==null)return null;if(!Array.isArray(n))throw new dt("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new dt("`inputs` should be an array for Concatenate");if(n.length!==t.length)throw new dt(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${t.length})`);return _t(()=>{let i=!0;if(n.forEach(l=>{if(l!=null){i=!1;return}}),i)return null;const o=[];for(let l=0;l<t.length;++l)n[l]==null?o.push(de(So(t[l]),"bool")):n[l].rank<t[l].rank?o.push(ui(n[l],-1)):o.push(n[l]);const a=br(o,this.axis);return a9(a,-1,!1)})}getConfig(){const t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}}GO.className="Concatenate";Gt(GO);function np(r,t){for(;r<0;)r+=t;return r}function Vot(r,t,n){if(r.shape.length>3||t.shape.length>3)throw new je("batchDot is not implemented for tensors of 4D or higher rank yet");if(W(r.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${r.shape.length}`),W(r.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof n=="number"&&(n=[n,n]),r.dtype==="complex64"||t.dtype==="complex64")throw new je("batchDot is not implemented for complex64-type Tensors yet.");const i=r.shape.length,o=t.shape.length;n==null&&(n=[i-1,o-2]);const a=n;return _t(()=>{let l;if(i>o){l=i-o;const u=[];for(let h=0;h<l;++h)u.push(1);t=gt(t,t.shape.concat(u))}else if(o>i){l=o-i;const u=[];for(let h=0;h<l;++h)u.push(1);r=gt(r,r.shape.concat(u))}else l=0;let c;if(r.shape.length===2&&t.shape.length===2)a[0]===a[1]?c=we(ct(r,t),a[0]):c=we(ct(vn(r,[1,0]),t),a[1]);else{const u=a[0]!==r.shape.length-1,h=a[1]===t.shape.length-1;c=Nn(r,t,u,h)}if(l>0){let u;i>o?u=i+o-3:u=i-1;const h=[];for(let d=u;d<u+l;++d)h.push(d);c=kg(c,h)}return c.shape.length===1&&(c=ui(c,1)),c})}class HO extends _h{constructor(t){super(t),this.axes=t.axes,this.normalize=t.normalize==null?!1:t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){W(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=t[0],i=t[1];if(n.length>3||i.length>3)throw new je("Dot layer does not support tensors of 4D or higher rank yet.");const o=this.interpretAxes(n,i);if(n[o[0]]!==i[o[1]])throw new dt(`Dimension incompatibility: ${n[o[0]]} !== ${i[o[1]]}`)}mergeFunction(t){if(t.length!==2)throw new dt(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let n=t[0],i=t[1],o;return Array.isArray(this.axes)?o=this.axes.map((a,l)=>np(a,t[l].shape.length)):o=[np(this.axes,n.shape.length),np(this.axes,i.shape.length)],this.normalize&&(n=p2(n,o[0]),i=p2(i,o[1])),Vot(n,i,o)}interpretAxes(t,n){let i;return Array.isArray(this.axes)?i=this.axes:i=[np(this.axes,t.length),np(this.axes,n.length)],i}computeOutputShape(t){W(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=t[0].slice(),i=t[1].slice();if(n.length>3||i.length>3)throw new je("Dot layer does not support tensors of 4D or higher rank yet.");const o=this.interpretAxes(n,i);n.splice(o[0],1),i.splice(o[1],1),i.splice(0,1);const a=n.concat(i);return a.length===1&&a.push(1),a}computeMask(t,n){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(t,n),t}}HO.className="Dot";Gt(HO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class jO extends un{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,t),n}call(t,n){return _t(()=>{this.invokeCallHook(t,n);const i=Fe(t);return Rg(()=>Xt(yy(i.shape,0,this.stddev),i),()=>i,n.training||!1)})}}jO.className="GaussianNoise";Gt(jO);class qO extends un{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return _t(()=>{this.invokeCallHook(t,n);const i=Fe(t);return this.rate>0&&this.rate<1?Rg(()=>{const a=Math.sqrt(this.rate/(1-this.rate));return ct(i,yy(i.shape,1,a))},()=>i,n.training||!1):i})}}qO.className="GaussianDropout";Gt(qO);class KO extends un{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||Fe(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return _t(()=>{if(this.rate<1&&this.rate>0){const i=this._getNoiseShape(t);return Rg(()=>{const a=Fe(t),l=1.6732632423543772,c=1.0507009873554805,u=-l*c;let h=bh(dy(i),this.rate);h=Da(h,"float32");const d=((1-this.rate)*(1+this.rate*u**2))**-.5,f=-d*u*this.rate,p=Xt(ct(a,h),ct(Xt(h,-1),u));return Xt(ct(p,d),f)},()=>Fe(t),n.training||!1)}return t})}}KO.className="AlphaDropout";Gt(KO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function em(r,t,n,i,o,a=.001){let l;if(r.rank===2)l=vJ(r,t,n,i,o,a);else if(r.rank===3)l=xJ(r,t,n,i,o,a);else if(r.rank===4)l=wJ(r,t,n,i,o,a);else throw new je(`batchNormalization is not implemented for array of rank ${r.rank} yet`);return l}function Uot(r,t,n,i,o=.001){return _t(()=>{const a=q_(r,i),l=a.mean,c=a.variance;return[em(r,l,c,n,t,o),l,c]})}function Wot(r,t,n,i,o=.001){return _t(()=>{const a=q_(r,i),l=a.mean,c=a.variance,u=[];for(const g of Qo(0,r.rank))i.indexOf(g)!==-1?u.push(1):u.push(r.shape[g]);const h=gt(l,u),d=gt(c,u),f=t==null?null:gt(t,u),p=n==null?null:gt(n,u);return[em(r,h,d,p,f,o),l,c]})}function Got(r,t,n,i,o=.001){return An(i.slice().sort(),Qo(0,r.rank-1))?Uot(r,t,n,i,o):Wot(r,t,n,i,o)}class XO extends un{constructor(t){t==null&&(t={}),super(t),this.supportsMasking=!0,this.axis=t.axis==null?-1:t.axis,this.momentum=t.momentum==null?.99:t.momentum,this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=is(t.betaInitializer||"zeros"),this.gammaInitializer=is(t.gammaInitializer||"ones"),this.movingMeanInitializer=is(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=is(t.movingVarianceInitializer||"ones"),this.betaConstraint=Ls(t.betaConstraint),this.gammaConstraint=Ls(t.gammaConstraint),this.betaRegularizer=os(t.betaRegularizer),this.gammaRegularizer=os(t.gammaRegularizer)}build(t){t=In(t);const n=this.axis>=0?this.axis:this.axis+t.length,i=t[n];if(i==null)throw new dt(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new Rs({ndim:t.length,axes:{[n]:i}})];const o=[i];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,n){return _t(()=>{const i=n.training==null?!1:n.training,o=Fe(t),a=o.shape,l=a.length,c=Qo(0,l),u=this.axis>=0?this.axis:this.axis+l;c.splice(u,1);const h=Qu(1,l);h[u]=a[u];const d=c.slice();d.sort();const f=!An(d,Qo(0,l).slice(0,l-1)),p=()=>{if(f){const b=gt(this.movingMean.read(),h),w=gt(this.movingVariance.read(),h),S=this.center?gt(this.beta.read(),h):null,_=this.scale?gt(this.gamma.read(),h):null;return em(o,b,w,S,_,this.epsilon)}else return em(o,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!i)return p();const[m,g,y]=Got(o,this.gamma.read(),this.beta.read(),c,this.epsilon),v=(b,w,S)=>{_t(()=>{const _=1-S,$=b.read(),N=ct(Se($,w),_);b.write(Se($,N))})};return(()=>{v(this.movingMean,g,this.momentum),v(this.movingVariance,y,this.momentum)})(),m})}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ds(this.betaInitializer),gammaInitializer:ds(this.gammaInitializer),movingMeanInitializer:ds(this.movingMeanInitializer),movingVarianceInitializer:ds(this.movingVarianceInitializer),betaRegularizer:Vn(this.betaRegularizer),gammaRegularizer:Vn(this.gammaRegularizer),betaConstraint:Os(this.betaConstraint),gammaConstraint:Os(this.gammaConstraint)},n=super.getConfig();return Object.assign(t,n),t}}XO.className="BatchNormalization";Gt(XO);class YO extends un{constructor(t){if(t==null&&(t={}),super(t),this.axis=t.axis==null?-1:t.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=is(t.betaInitializer||"zeros"),this.gammaInitializer=is(t.gammaInitializer||"ones"),this.betaRegularizer=os(t.betaRegularizer),this.gammaRegularizer=os(t.gammaRegularizer),this.supportsMasking=!0}build(t){t=In(t);const n=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let a=0;a<this.axis.length;++a)this.axis[a]<0&&(this.axis[a]+=n);for(const a of this.axis)if(a<0||a>=n)throw new Error(`Invalid axis: ${a}`);if(this.axis.length!==dc(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const i=this.axis.map(a=>t[a]),o=!0;this.scale?this.gamma=this.addWeight("gamma",i,"float32",this.gammaInitializer,this.gammaRegularizer,o):this.gamma=null,this.center?this.beta=this.addWeight("beta",i,"float32",this.betaInitializer,this.betaRegularizer,o):this.beta=null,this.built=!0}call(t,n){const i=Fe(t),o=i.shape,a=o.length;return _t(()=>{let{mean:c,variance:u}=q_(i,this.axis,!0);const h=Qu(1,a);for(const y of this.axis)h[y]=o[y];const d=y=>y!=null&&y.shape.length!==a?gt(y,h):y;let f=this.scale?d(this.gamma.read()):null,p=this.center?d(this.beta.read()):null;const m=[],g=[];for(let y=0;y<a;++y)this.axis.indexOf(y)!==-1?(m.push(o[y]),g.push(1)):(m.push(1),g.push(o[y]));return c=Wo(c,m),u=Wo(u,m),f!=null&&(f=Wo(f,g)),p!=null&&(p=Wo(p,g)),em(i,c,u,p,f,this.epsilon)})}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ds(this.betaInitializer),gammaInitializer:ds(this.gammaInitializer),betaRegularizer:Vn(this.betaRegularizer),gammaRegularizer:Vn(this.gammaRegularizer)},n=super.getConfig();return Object.assign(t,n),t}}YO.className="LayerNormalization";Gt(YO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hot(r,t,n){return _t(()=>{if(r.rank!==4)throw new dt(`temporalPadding expects input tensor to be 4-D, but received a ${r.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new dt("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=ta()),n!=="channelsLast"&&n!=="channelsFirst")throw new dt(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let i;return n==="channelsFirst"?i=[[0,0],[0,0],t[0],t[1]]:i=[[0,0],t[0],t[1],[0,0]],K_(r,i)})}class ZO extends un{constructor(t){if(t==null&&(t={}),super(t),this.dataFormat=t.dataFormat==null?ta():t.dataFormat,t.padding==null)this.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new dt(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let n,i;if(typeof t.padding[0]=="number")n=[t.padding[0],t.padding[0]],i=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new dt(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(n=t.padding[0],t.padding[1].length!==2)throw new dt(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);i=t.padding[1]}this.padding=[n,i]}this.inputSpec=[new Rs({ndim:4})]}computeOutputShape(t){t=In(t);let n,i;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?n=t[2]+this.padding[0][0]+this.padding[0][1]:n=null,t[3]!=null&&t[3]>=0?i=t[3]+this.padding[1][0]+this.padding[1][1]:i=null,[t[0],t[1],n,i]):(t[1]!=null&&t[1]>=0?n=t[1]+this.padding[0][0]+this.padding[0][1]:n=null,t[2]!=null&&t[2]>=0?i=t[2]+this.padding[1][0]+this.padding[1][1]:i=null,[t[0],n,i,t[3]])}call(t,n){return _t(()=>Hot(Fe(t),this.padding,this.dataFormat))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}ZO.className="ZeroPadding2D";Gt(ZO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Iy(r,t,n,i,o,a){return _t(()=>{Ts(o),m8(a),Wi(i),n==null&&(n=[1,1]),i==null&&(i="valid"),o==null&&(o=ta()),a==null&&(a="max"),r=YT(r,o);let l;const c=i==="same"?"same":"valid";return a==="max"?l=j_(r,t,n,c):l=O_(r,t,n,c),o==="channelsFirst"&&(l=vn(l,[0,3,1,2])),l})}function JO(r,t,n,i,o,a){return _t(()=>{Ts(o),m8(a),Wi(i),n==null&&(n=[1,1,1]),i==null&&(i="valid"),o==null&&(o=ta()),a==null&&(a="max"),r=mO(r,o);let l;const c=i==="same"?"same":"valid";return a==="max"?l=stt(r,t,n,c):l=lJ(r,t,n,c),o==="channelsFirst"&&(l=vn(l,[0,4,1,2,3])),l})}class QO extends un{constructor(t){if(t.poolSize==null&&(t.poolSize=2),super(t),typeof t.poolSize=="number")this.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")this.poolSize=t.poolSize;else throw new dt(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);if(js(this.poolSize,"poolSize"),t.strides==null)this.strides=this.poolSize;else if(typeof t.strides=="number")this.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")this.strides=t.strides;else throw new dt(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);js(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,Wi(this.padding),this.inputSpec=[new Rs({ndim:3})]}computeOutputShape(t){t=In(t);const n=Xo(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],n,t[2]]}call(t,n){return _t(()=>{this.invokeCallHook(t,n),t=Mg(Fe(t),2);const i=this.poolingFunction(Fe(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return kg(i,[2])})}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(t,n),t}}class t7 extends QO{constructor(t){super(t)}poolingFunction(t,n,i,o,a){return Ts(a),Wi(o),Iy(t,n,i,o,a,"max")}}t7.className="MaxPooling1D";Gt(t7);class e7 extends QO{constructor(t){super(t)}poolingFunction(t,n,i,o,a){return Ts(a),Wi(o),Iy(t,n,i,o,a,"avg")}}e7.className="AveragePooling1D";Gt(e7);class n7 extends un{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new dt(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];js(this.poolSize,"poolSize"),js(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Ts(this.dataFormat),Wi(this.padding),this.inputSpec=[new Rs({ndim:4})]}computeOutputShape(t){t=In(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],i=this.dataFormat==="channelsFirst"?t[3]:t[2];return n=Xo(n,this.poolSize[0],this.padding,this.strides[0]),i=Xo(i,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,i]:[t[0],n,i,t[3]]}call(t,n){return _t(()=>(this.invokeCallHook(t,n),this.poolingFunction(Fe(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class s7 extends n7{constructor(t){super(t)}poolingFunction(t,n,i,o,a){return Ts(a),Wi(o),Iy(t,n,i,o,a,"max")}}s7.className="MaxPooling2D";Gt(s7);class r7 extends n7{constructor(t){super(t)}poolingFunction(t,n,i,o,a){return Ts(a),Wi(o),Iy(t,n,i,o,a,"avg")}}r7.className="AveragePooling2D";Gt(r7);class i7 extends un{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new dt(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];js(this.poolSize,"poolSize"),js(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Ts(this.dataFormat),Wi(this.padding),this.inputSpec=[new Rs({ndim:5})]}computeOutputShape(t){t=In(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],i=this.dataFormat==="channelsFirst"?t[3]:t[2],o=this.dataFormat==="channelsFirst"?t[4]:t[3];return n=Xo(n,this.poolSize[0],this.padding,this.strides[0]),i=Xo(i,this.poolSize[1],this.padding,this.strides[1]),o=Xo(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,i,o]:[t[0],n,i,o,t[4]]}call(t,n){return _t(()=>(this.invokeCallHook(t,n),this.poolingFunction(Fe(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class o7 extends i7{constructor(t){super(t)}poolingFunction(t,n,i,o,a){return Ts(a),Wi(o),JO(t,n,i,o,a,"max")}}o7.className="MaxPooling3D";Gt(o7);class a7 extends i7{constructor(t){super(t)}poolingFunction(t,n,i,o,a){return Ts(a),Wi(o),JO(t,n,i,o,a,"avg")}}a7.className="AveragePooling3D";Gt(a7);class l7 extends un{constructor(t){super(t),this.inputSpec=[new Rs({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,n){throw new je}}class c7 extends l7{constructor(t){super(t||{})}call(t,n){return _t(()=>{const i=Fe(t);return bs(i,1)})}}c7.className="GlobalAveragePooling1D";Gt(c7);class u7 extends l7{constructor(t){super(t||{})}call(t,n){return _t(()=>{const i=Fe(t);return Ko(i,1)})}}u7.className="GlobalMaxPooling1D";Gt(u7);class h7 extends un{constructor(t){super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Ts(this.dataFormat),this.inputSpec=[new Rs({ndim:4})]}computeOutputShape(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]}call(t,n){throw new je}getConfig(){const t={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class d7 extends h7{call(t,n){return _t(()=>{const i=Fe(t);return this.dataFormat==="channelsLast"?bs(i,[1,2]):bs(i,[2,3])})}}d7.className="GlobalAveragePooling2D";Gt(d7);class f7 extends h7{call(t,n){return _t(()=>{const i=Fe(t);return this.dataFormat==="channelsLast"?Ko(i,[1,2]):Ko(i,[2,3])})}}f7.className="GlobalMaxPooling2D";Gt(f7);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class p7 extends un{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(t){this.layer!=null&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(t,n),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,n,i={}){const o=n.layer,a=pl(o,i);delete n.layer;const l={layer:a};return Object.assign(l,n),new t(l)}}class m7 extends p7{constructor(t){super(t),this.supportsMasking=!0}build(t){if(t=In(t),t.length<3)throw new dt(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(t)}computeOutputShape(t){t=In(t);const n=[t[0]].concat(t.slice(2)),i=this.layer.computeOutputShape(n),o=t[1];return[i[0],o].concat(i.slice(1))}call(t,n){return _t(()=>(t=Fe(t),TO((l,c)=>[Fe(this.layer.call(l,n)),[]],t,[],!1,null,null,!1,!0)[1]))}}m7.className="TimeDistributed";Gt(m7);function jot(r){Sh(git,"BidirectionalMergeMode",r)}const qot="concat";class g7 extends p7{constructor(t){super(t);const n=t.layer.getConfig(),i={};i.className=t.layer.getClassName(),i.config=n,this.forwardLayer=pl(i),n.goBackwards=n.goBackwards!==!0;const o={};if(o.className=t.layer.getClassName(),o.config=n,this.backwardLayer=pl(o),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=t.mergeMode===void 0?qot:t.mergeMode,jot(this.mergeMode),t.weights)throw new je("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const n=t.length,i=Math.floor(n/2);this.forwardLayer.setWeights(t.slice(0,i)),this.backwardLayer.setWeights(t.slice(i))}computeOutputShape(t){let n=this.forwardLayer.computeOutputShape(t);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let i,o,a;return this.returnState&&(a=n.slice(1)),i=n[0],i=i,this.mergeMode==="concat"?(i[i.length-1]*=2,o=[i]):this.mergeMode==null?o=[i,i.slice()]:o=[i],this.returnState?this.mergeMode==null?o.concat(a).concat(a.slice()):[i].concat(a).concat(a.slice()):Xr(o)}apply(t,n){let i=n==null?null:n.initialState,o=n==null?null:n.constants;n==null&&(n={});const a=_O(t,i,o,this.numConstants);if(t=a.inputs,i=a.initialState,o=a.constants,Array.isArray(t)&&(i=t.slice(1),t=t[0]),(i==null||i.length===0)&&o==null)return super.apply(t,n);const l=[],c=[];if(i!=null){const h=i.length;if(h%2>0)throw new dt("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=i,l.push(...i);const d=i.map(f=>new Rs({shape:f.shape}));this.forwardLayer.stateSpec=d.slice(0,h/2),this.backwardLayer.stateSpec=d.slice(h/2),c.push(...d)}if(o!=null)throw new je("Support for constants in Bidirectional layers is not implemented yet.");const u=l[0]instanceof Ca;for(const h of l)if(h instanceof Ca!==u)throw new dt("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(u){const h=[t].concat(l),d=this.inputSpec.concat(c),f=this.inputSpec;this.inputSpec=d;const p=super.apply(h,n);return this.inputSpec=f,p}else return super.apply(t,n)}call(t,n){return _t(()=>{const i=n.initialState;let o,a;if(i==null)o=this.forwardLayer.call(t,n),a=this.backwardLayer.call(t,n);else{const u=i.slice(0,i.length/2),h=i.slice(i.length/2);o=this.forwardLayer.call(t,Object.assign(n,{initialState:u})),a=this.backwardLayer.call(t,Object.assign(n,{initialState:h}))}let l;this.returnState&&(Array.isArray(o)&&(l=o.slice(1).concat(a.slice(1))),o=o[0],a=a[0]),this.returnSequences&&(a=Yu(a,1));let c;return this.mergeMode==="concat"?c=FT([o,a]):this.mergeMode==="sum"?c=Xt(o,a):this.mergeMode==="ave"?c=ct(.5,Xt(o,a)):this.mergeMode==="mul"?c=ct(o,a):this.mergeMode==null&&(c=[o,a]),this.returnState?this.mergeMode==null?c.concat(l):[c].concat(l):c})}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){Du(this.forwardLayer.name,()=>{this.forwardLayer.build(t)}),Du(this.backwardLayer.name,()=>{this.backwardLayer.build(t)}),this.built=!0}computeMask(t,n){Array.isArray(n)&&(n=n[0]);let i;if(this.returnSequences?this.mergeMode==null?i=[n,n]:i=n:this.mergeMode==null?i=[null,null]:i=null,this.returnState){const a=this.forwardLayer.states.map(l=>null);return Array.isArray(i)?i.concat(a).concat(a):[i].concat(a).concat(a)}else return i}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(t,n),t}static fromConfig(t,n){const i=pl(n.layer);if(delete n.layer,n.numConstants!=null)throw new je("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const o=n;return o.layer=i,new t(o)}}g7.className="Bidirectional";Gt(g7);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class v7 extends un{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){const t={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(t,n),t}call(t,n){return _t(()=>(t=Fe(t),t.dtype!=="float32"&&(t=Da(t,"float32")),Xt(ct(t,this.scale),this.offset)))}}v7.className="Rescaling";Gt(v7);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:Kot,cropAndResize:Xot}=wu;class y7 extends un{constructor(t){super(t),this.height=t.height,this.width=t.width}centerCrop(t,n,i,o,a,l,c,u){return _t(()=>{let h,d=!1;const f=n/l,p=i/c,m=(o+n)/l,g=(a+i)/c,y=[f,p,m,g],v=[];t.rank===3?(d=!0,h=_c([t])):h=t;for(let _=0;_<h.shape[0];_++)v.push(y);const x=BR(v,[v.length,4]),b=Zp(0,v.length,1,"int32"),S=Xot(h,x,b,[o,a],"nearest");return Da(d?Fe(Zu(S)):S,u)})}upsize(t,n,i,o){return _t(()=>{const a=Kot(t,[n,i]);return Da(a,o)})}call(t,n){return _t(()=>{const i=Fe(t),o=i.dtype,a=i.shape,l=a[a.length-3],c=a[a.length-2];let u=0;l!==this.height&&(u=Math.floor((l-this.height)/2));let h=0;return c!==this.width&&(h=Math.floor((c-this.width)/2),h===0&&(h=1)),u>=0&&h>=0?this.centerCrop(i,u,h,this.height,this.width,l,c,o):this.upsize(t,this.height,this.width,o)})}getConfig(){const t={height:this.height,width:this.width},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){t=In(t);const n=t.length-3,i=t.length-2;return t[n]=this.height,t[i]=this.width,t}}y7.className="CenterCrop";Gt(y7);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Yot(r,t,n,i){let o=Fe(r);if(o.dtype!=="int32"&&(o=Da(o,"int32")),t==="int")return o;const a=o.shape;if(o.rank===0&&(o=ui(o,-1)),t==="oneHot"&&o.shape[o.shape.length-1]!==1&&(o=ui(o,-1)),o.rank>2)throw new dt(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${a} which would result in output rank ${o.rank}.`);const l=["multiHot","oneHot"].includes(t),c=o;let u;if(typeof i<"u"&&t==="count"?u=fI(c,i,n,l):u=fI(c,[],n,l),t!=="tfIdf")return u;if(i)return ct(u,i);throw new dt("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class x7 extends un{constructor(t){super(t),this.numTokens=t.numTokens,t.outputMode?this.outputMode=t.outputMode:this.outputMode="multiHot"}getConfig(){const t={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){return t=In(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)}call(t,n){return _t(()=>{t=Fe(t),t.dtype!=="int32"&&(t=Da(t,"int32"));let i;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new dt(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);i=Fe(n.countWeights)}const o=Ko(t),a=l2(t),l=Ui(this.numTokens,o).bufferSync().get(0),c=bh(a,0).bufferSync().get(0);if(!(l&&c))throw new dt(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return Yot(t,this.outputMode,this.numTokens,i)})}}x7.className="CategoryEncoding";Gt(x7);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Zot=["bilinear","nearest"],HI=new Set(Zot);class b7 extends un{constructor(t){if(super(t),this.height=t.height,this.width=t.width,t.interpolation)if(HI.has(t.interpolation))this.interpolation=t.interpolation;else throw new dt(`Invalid interpolation parameter: ${t.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=Boolean(t.cropToAspectRatio)}computeOutputShape(t){t=In(t);const n=t[2];return[this.height,this.width,n]}getConfig(){const t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(t,n),t}call(t,n){return _t(()=>{const i=[this.height,this.width];if(this.interpolation==="bilinear")return wu.resizeBilinear(t,i,!this.cropToAspectRatio);if(this.interpolation==="nearest")return wu.resizeNearestNeighbor(t,i,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...HI]} are supported`)})}}b7.className="Resizing";Gt(b7);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jot=kt();Jot.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,r=>{r&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var jI;(function(r){r[r.DT_INVALID=0]="DT_INVALID",r[r.DT_FLOAT=1]="DT_FLOAT",r[r.DT_DOUBLE=2]="DT_DOUBLE",r[r.DT_INT32=3]="DT_INT32",r[r.DT_UINT8=4]="DT_UINT8",r[r.DT_INT16=5]="DT_INT16",r[r.DT_INT8=6]="DT_INT8",r[r.DT_STRING=7]="DT_STRING",r[r.DT_COMPLEX64=8]="DT_COMPLEX64",r[r.DT_INT64=9]="DT_INT64",r[r.DT_BOOL=10]="DT_BOOL",r[r.DT_QINT8=11]="DT_QINT8",r[r.DT_QUINT8=12]="DT_QUINT8",r[r.DT_QINT32=13]="DT_QINT32",r[r.DT_BFLOAT16=14]="DT_BFLOAT16",r[r.DT_QINT16=15]="DT_QINT16",r[r.DT_QUINT16=16]="DT_QUINT16",r[r.DT_UINT16=17]="DT_UINT16",r[r.DT_COMPLEX128=18]="DT_COMPLEX128",r[r.DT_HALF=19]="DT_HALF",r[r.DT_RESOURCE=20]="DT_RESOURCE",r[r.DT_VARIANT=21]="DT_VARIANT",r[r.DT_UINT32=22]="DT_UINT32",r[r.DT_UINT64=23]="DT_UINT64",r[r.DT_FLOAT_REF=101]="DT_FLOAT_REF",r[r.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",r[r.DT_INT32_REF=103]="DT_INT32_REF",r[r.DT_UINT8_REF=104]="DT_UINT8_REF",r[r.DT_INT16_REF=105]="DT_INT16_REF",r[r.DT_INT8_REF=106]="DT_INT8_REF",r[r.DT_STRING_REF=107]="DT_STRING_REF",r[r.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",r[r.DT_INT64_REF=109]="DT_INT64_REF",r[r.DT_BOOL_REF=110]="DT_BOOL_REF",r[r.DT_QINT8_REF=111]="DT_QINT8_REF",r[r.DT_QUINT8_REF=112]="DT_QUINT8_REF",r[r.DT_QINT32_REF=113]="DT_QINT32_REF",r[r.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",r[r.DT_QINT16_REF=115]="DT_QINT16_REF",r[r.DT_QUINT16_REF=116]="DT_QUINT16_REF",r[r.DT_UINT16_REF=117]="DT_UINT16_REF",r[r.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",r[r.DT_HALF_REF=119]="DT_HALF_REF",r[r.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",r[r.DT_VARIANT_REF=121]="DT_VARIANT_REF",r[r.DT_UINT32_REF=122]="DT_UINT32_REF",r[r.DT_UINT64_REF=123]="DT_UINT64_REF"})(jI||(jI={}));var qI;(function(r){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(r.CheckpointFormatVersion||(r.CheckpointFormatVersion={}))})(qI||(qI={}));/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var KI;(function(r){r[r.FAIL=0]="FAIL",r[r.SHORTEST=1]="SHORTEST",r[r.LONGEST=2]="LONGEST"})(KI||(KI={}));/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function be(r,t){Array.isArray(r)||(r=[r]),r.forEach(n=>{n!=null&&W(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qot=R9;class Ey extends I4{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new tR(this,ga())}nextDataId(){return Ey.nextDataId++}write(t,n,i){this.firstUse&&(this.firstUse=!1,kt().get("IS_NODE")&&Di(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const o={id:this.nextDataId()};return this.data.set(o,{values:t,dtype:i,refCount:1}),o}makeTensorInfo(t,n,i){let o;if(n==="string"&&i!=null&&i.length>0&&Cm(i[0])){const a=i.map(l=>hc(l));o=this.write(a,t,n)}else o=this.write(i,t,n);return{dataId:o,shape:t,dtype:n}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){const n=this.data.get(t);n.refCount++}decRef(t){if(this.data.has(t)){const n=this.data.get(t);n.refCount--}}move(t,n,i,o,a){this.data.set(t,{values:n,dtype:o,refCount:a})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:n,complexTensorInfos:i}=this.data.get(t);if(n==="complex64"){const o=this.readSync(i.real.dataId),a=this.readSync(i.imag.dataId);return Sl(o,a)}return this.data.get(t).values}bufferSync(t){const n=this.readSync(t.dataId);if(t.dtype==="string")try{const i=n.map(o=>Sc(o));return rn(t.shape,t.dtype,i)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return rn(t.shape,t.dtype,n)}makeOutput(t,n,i){return ga().makeTensorFromTensorInfo(this.makeTensorInfo(n,i,t),this)}disposeData(t,n=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:i}=this.data.get(t);i!=null&&(this.disposeData(i.real.dataId,!0),this.disposeData(i.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const n=Kr();return t(),{kernelMs:Kr()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){be([t],"where");const n=this.readSync(t.dataId);return Qot(t.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Ey.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w7(r){const t=new Float32Array(r.length);for(let n=0;n<r.length;++n)t[n]=Math.abs(r[n]);return t}const tat=r=>{const{x:t}=r.inputs,n=r.backend;be(t,"abs");let i=new Float32Array(Nt(t.shape));const o=n.data.get(t.dataId).values;return i=w7(o),n.makeOutput(i,t.shape,t.dtype)},eat={kernelName:nv,backendName:"cpu",kernelFunc:tat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Is(r){return(t,n,i,o,a)=>{const l=qe(t,n),c=l.length,u=Ie(l),h=Nt(l),d=hr(a,h),f=t.length,p=n.length,m=Ie(t),g=Ie(n),y=Pd(t,l),v=Pd(n,l);if(y.length+v.length===0)for(let x=0;x<d.length;++x)d[x]=r(i[x%i.length],o[x%o.length]);else for(let x=0;x<d.length;++x){const b=hf(x,c,u),w=b.slice(-f);y.forEach(N=>w[N]=0);const S=Na(w,f,m),_=b.slice(-p);v.forEach(N=>_[N]=0);const $=Na(_,p,g);d[x]=r(i[S],o[$])}return[d,l]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function di(r){const{inputs:t,backend:n}=r,{real:i,imag:o}=t,a=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values,c=n.makeTensorInfo(i.shape,"complex64"),u=n.data.get(c.dataId);return u.complexTensorInfos={real:n.makeTensorInfo(i.shape,"float32",a),imag:n.makeTensorInfo(o.shape,"float32",l)},c}const nat={kernelName:P4,backendName:"cpu",kernelFunc:di};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x2(r,t,n="float32"){if(n==="complex64"){const o=x2(r,t,"float32"),a=x2(r,t,"float32");return di({inputs:{real:o,imag:a},backend:r})}const i=Sr(Nt(t),n);return r.makeTensorInfo(t,n,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ba(r){const{inputs:t,backend:n}=r,{x:i}=t;return n.incRef(i.dataId),{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}const sat={kernelName:qm,backendName:"cpu",kernelFunc:Ba};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function th(r){const{inputs:t,backend:n}=r,{input:i}=t,o=n.data.get(i.dataId).complexTensorInfos.real,a=n.data.get(o.dataId).values;return n.makeTensorInfo(o.shape,o.dtype,a)}const rat={kernelName:a_,backendName:"cpu",kernelFunc:th};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S7(r,t,n,i){if(i==="int32"){const o=Int32Array.from(r);return[t,"int32",o]}if(i==="bool"){const o=xh([0],n),[a,l]=Is((c,u)=>c!==u?1:0)(t,[],r,o,"bool");return[l,"bool",a]}throw new Error(`Error in Cast: failed to cast ${n} to ${i}`)}function Ic(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{dtype:a}=i;if(a==="complex64"){if(o.dtype==="complex64")return Ba({inputs:{x:o},backend:n});const d=x2(n,o.shape,o.dtype),f=Ic({inputs:{x:o},backend:n,attrs:{dtype:"float32"}}),p=di({inputs:{real:f,imag:d},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),p}if(o.dtype==="complex64"){const d=th({inputs:{input:o},backend:n}),f=Ic({inputs:{x:d},backend:n,attrs:{dtype:a}});return n.disposeIntermediateTensorInfo(d),f}if(!sR(o.dtype,a)){const d=Ba({inputs:{x:o},backend:n});return{dataId:d.dataId,shape:d.shape,dtype:a}}const l=n.data.get(o.dataId).values,[c,u,h]=S7(l,o.shape,o.dtype,a);return n.makeTensorInfo(c,u,h)}const iat={kernelName:Rm,backendName:"cpu",kernelFunc:Ic};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Js(r,t,n,i){return n==null?({inputs:o,backend:a})=>{const{a:l,b:c}=o,u=a;be([l,c],r);const h=u.data.get(l.dataId).values,d=u.data.get(c.dataId).values,f=l.dtype==="string"?Ju(h):h,p=l.dtype==="string"?Ju(d):d,m=i||l.dtype,[g,y]=t(l.shape,c.shape,f,p,m);return u.makeTensorInfo(y,m,g)}:({inputs:o,backend:a})=>{const{a:l,b:c}=o,u=a;if(l.dtype==="complex64"||c.dtype==="complex64"){const h=Ic({inputs:{x:l},backend:u,attrs:{dtype:"complex64"}}),d=u.data.get(h.dataId),f=d.complexTensorInfos.real,p=d.complexTensorInfos.imag,m=u.data.get(f.dataId).values,g=u.data.get(p.dataId).values,y=Ic({inputs:{x:c},backend:u,attrs:{dtype:"complex64"}}),v=u.data.get(y.dataId),x=v.complexTensorInfos.real,b=v.complexTensorInfos.imag,w=u.data.get(x.dataId).values,S=u.data.get(b.dataId).values,[_,$,N]=n(l.shape,c.shape,m,g,w,S),k=u.makeTensorInfo(N,"float32",_),I=u.makeTensorInfo(N,"float32",$),O=di({inputs:{real:k,imag:I},backend:u});return u.disposeIntermediateTensorInfo(h),u.disposeIntermediateTensorInfo(y),u.disposeIntermediateTensorInfo(k),u.disposeIntermediateTensorInfo(I),O}else{const h=u.data.get(l.dataId).values,d=u.data.get(c.dataId).values,f=i||l.dtype,[p,m]=t(l.shape,c.shape,h,d,f);return u.makeTensorInfo(m,f,p)}}}function nC(r){return(t,n,i,o,a,l)=>{const c=qe(t,n),u=Nt(c),h=c.length,d=Ie(c),f=hr("float32",u),p=hr("float32",u),m=Pd(t,c),g=Pd(n,c),y=Sl(i,o),v=Sl(a,l),x=t.length,b=Ie(t),w=n.length,S=Ie(n);if(m.length+g.length===0)for(let _=0;_<f.length;_++){const $=_%y.length,N=_%v.length,k=r(y[$*2],y[$*2+1],v[N*2],v[N*2+1]);f[_]=k.real,p[_]=k.imag}else for(let _=0;_<f.length;_++){const $=hf(_,h,d),N=$.slice(-x);m.forEach(F=>N[F]=0);const k=Na(N,x,b),I=$.slice(-w);g.forEach(F=>I[F]=0);const O=Na(I,w,S),B=r(y[k*2],y[k*2+1],v[O*2],v[O*2+1]);f[_]=B.real,p[_]=B.imag}return[f,p,c]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _7=Is((r,t)=>r+t),oat=nC((r,t,n,i)=>({real:r+n,imag:t+i})),Vd=Js(df,_7,oat),aat={kernelName:df,backendName:"cpu",kernelFunc:Vd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sC(r,t,n,i,o){const a=Nt(i),l=Sr(o,n);for(let c=0;c<r.length;c++){const u=r[c];if(u<0)throw new Error("Input x must be non-negative!");u>=o||(a>0?l[u]+=t[c]:l[u]+=1)}return l}function T7(r,t,n,i=!1){const o=r.shape[0],a=r.shape[1],l=rn([o,n],t.dtype);for(let c=0;c<o;c++)for(let u=0;u<a;u++){const h=r.get(c,u);if(h<0)throw new Error("Input x must be non-negative!");h>=n||(i?l.set(1,c,h):t.size>0?l.set(l.get(c,h)+t.get(c,u),c,h):l.set(l.get(c,h)+1,c,h))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hc(r){return(t,n,i)=>{const o=hr(n,t.length);for(let a=0;a<t.length;++a)o[a]=r(t[a],i);return o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function On(r,t,n){return({inputs:i,attrs:o,backend:a})=>{const{x:l}=i;if(be(l,r),l.dtype==="string"||n==="string")throw new Error("unaryKernelFunc does not support string input/output");const c=a,u=c.data.get(l.dataId).values,h=Nt(l.shape),d=n||l.dtype,f=ks(d,h);for(let p=0;p<h;++p)f[p]=t(u[p],o);return c.makeTensorInfo(l.shape,d,f)}}function xf(r,t,n){return({inputs:i,attrs:o,backend:a})=>{const{x:l}=i;if(be(l,r),l.dtype==="string"||n==="string")throw new Error("unaryKernelFunc does not support string input/output");const c=a,u=c.data.get(l.dataId).values,h=n||l.dtype,d=t(u,h,o);return c.makeTensorInfo(l.shape,h,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C7=Hc(r=>Math.ceil(r)),lat=xf(Om,C7),cat={kernelName:Om,backendName:"cpu",kernelFunc:lat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k7(r,t,n,i){const o=ks(n,Nt(t));if(i&&n!=="string"){let a=0;r.forEach(l=>{const c=Nt(l.shape);o.set(l.vals,a),a+=c})}else{let a=0;r.forEach(l=>{const c=n==="string"?Ju(l.vals):l.vals;let u=0;for(let h=0;h<l.shape[0];++h){const d=h*t[1]+a;for(let f=0;f<l.shape[1];++f)o[d+f]=c[u++]}a+=l.shape[1]})}return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $7=Is((r,t)=>r===t?1:0),I7=Js(vv,$7,null,"bool"),uat={kernelName:vv,backendName:"cpu",kernelFunc:I7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E7=Hc(r=>Math.exp(r)),N7=xf(Um,E7,"float32"),hat={kernelName:Um,backendName:"cpu",kernelFunc:N7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A7=Hc(r=>Math.expm1(r)),dat=xf(Wm,A7),fat={kernelName:Wm,backendName:"cpu",kernelFunc:dat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M7=Hc(r=>Math.floor(r)),pat=xf(Gm,M7),mat={kernelName:Gm,backendName:"cpu",kernelFunc:pat};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D7(r,t,n,i,o,a,l,c,u){const h=rn([i,a],n);for(let d=0;d<i;d++){const f=[];let p=0;for(let m=0;m<o;m++){const g=r[d*o+m];p+=g*l[m],f.push(g)}if(p<0||p>=u/a)throw new Error(`Invalid indices: ${f} does not index into ${c}`);for(let m=0;m<a;m++)h.values[d*a+m]=t.get(...t.indexToLoc(p*a+m))}return h}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R7(r,t,n){const i=rn(n,r.dtype);for(let o=0;o<i.size;++o){const l=i.indexToLoc(o).slice(),c=l[0],u=l[2],h=t.locToIndex([c,u]);l[2]=t.values[h];const d=r.locToIndex(l);0<=d&&d<r.values.length&&(i.values[o]=r.values[d])}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O7=Is((r,t)=>r>t?1:0),gat=Js(wv,O7,null,"bool"),vat={kernelName:wv,backendName:"cpu",kernelFunc:gat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L7=Is((r,t)=>r>=t?1:0),yat=Js(jm,L7,null,"bool"),xat={kernelName:jm,backendName:"cpu",kernelFunc:yat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F7=Is((r,t)=>r<t?1:0),bat=Js(_v,F7,null,"bool"),wat={kernelName:_v,backendName:"cpu",kernelFunc:bat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P7=Is((r,t)=>r<=t?1:0),Sat=Js(Tv,P7,null,"bool"),_at={kernelName:Tv,backendName:"cpu",kernelFunc:Sat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B7(r,t,n){const i=(t-r)/(n-1),o=Sr(n,"float32");o[0]=r;for(let a=1;a<o.length;a++)o[a]=o[a-1]+i;return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z7=Hc(r=>Math.log(r)),Tat=xf(Zm,z7),Cat={kernelName:Zm,backendName:"cpu",kernelFunc:Tat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V7(r,t,n,i){const o=hr(i,Nt(n));for(let a=0;a<o.length;++a){const l=a*t;let c=r[l];for(let u=0;u<t;++u){const h=r[l+u];(Number.isNaN(h)||h>c)&&(c=h)}o[a]=c}return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U7=Is((r,t)=>Math.max(r,t)),kat=Js(Qm,U7),$at={kernelName:Qm,backendName:"cpu",kernelFunc:kat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W7=Is((r,t)=>Math.min(r,t)),Iat=Js(tg,W7),Eat={kernelName:tg,backendName:"cpu",kernelFunc:Iat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rC=Is((r,t)=>r*t),Nat=nC((r,t,n,i)=>({real:r*n-t*i,imag:r*i+t*n})),Ny=Js(ng,rC,Nat),Aat={kernelName:ng,backendName:"cpu",kernelFunc:Ny};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G7(r,t,n){const i=Fc(-1,n);return rC([],t,i,r,n)}function Mat(r){const{inputs:t,backend:n}=r,{x:i}=t;be(i,"neg");const o=n.data.get(i.dataId).values,[a,l]=G7(o,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,a)}const Dat={kernelName:Ov,backendName:"cpu",kernelFunc:Mat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H7=Is((r,t)=>r!==t?1:0),Rat=Js(Lv,H7,null,"bool"),Oat={kernelName:Lv,backendName:"cpu",kernelFunc:Rat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iC(r,t,n,i,o){const a=t.length,l=Nt(t),c=Ie(t),u=Ie(o),h=hr(n,Nt(o));for(let d=0;d<l;++d){const f=hf(d,a,c),p=new Array(f.length);for(let g=0;g<p.length;g++)p[g]=f[i[g]];const m=Na(p,a,u);h[m]=r[d]}return h}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ni(r){const{inputs:t,attrs:n,backend:i}=r,{x:o}=t,{perm:a}=n;be(o,"transpose");const l=o.shape.length,c=new Array(l);for(let f=0;f<c.length;f++)c[f]=o.shape[a[f]];const u=i.data.get(o.dataId).values,h=iC(u,o.shape,o.dtype,a,c);return{dataId:i.write(h,c,o.dtype),shape:c,dtype:o.dtype}}const Lat={kernelName:wd,backendName:"cpu",kernelFunc:ni};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j7(r,t,n,i){const[o,a]=Zs(r,i),l=gi(t,"int32"),c=Sr(Nt(o),l),u=Nt(a);for(let h=0;h<c.length;++h){const d=h*u;let f=1;for(let p=0;p<u;++p)f*=n[d+p];c[h]=f}return{outVals:c,outShape:o,outDtype:l}}function Fat(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a,keepDims:l}=i;be(o,"prod");const c=o.shape.length,u=on(a,o.shape),h=ms(u,c);let d=u,f=o;const p=[];h!=null&&(f=ni({inputs:{x:o},backend:n,attrs:{perm:h}}),p.push(f),d=_s(d.length,c));const m=n.data.get(f.dataId).values,{outVals:g,outShape:y,outDtype:v}=j7(f.shape,f.dtype,m,d);let x=y;return l&&(x=Ss(y,u)),p.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.makeTensorInfo(x,v,g)}const Pat={kernelName:Uv,backendName:"cpu",kernelFunc:Fat};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bat(r,t,n){r.forEach((i,o)=>{if(i<0||i>=n){const a=hf(o,t.length,Ie(t)).join(",");throw new Error(`indices[${a}] = ${i} is not in [0, ${n})`)}})}function zat(r,t){for(let n=0;n<r.length;++n){const i=r[n],o=n===r.length-1?t:r[n+1].length;if(i.length===0)throw new Error("Ragged splits may not be empty");if(i[0]<0)throw new Error("Ragged splits must be non-negative");if(i[i.length-1]>o)throw new Error("Ragged splits must not point past values");for(let a=1;a<i.length;++a)if(i[a-1]>i[a])throw new Error("Ragged splits must be sorted in ascending order")}}function Vat(r,t,n,i){const o=[];let a=0;const l=t.length-1+n.length,c=new Array(l).fill(null).map(()=>[0]);zat(n,i);let u=1;for(let h=0;h<t.length-1;++h){u*=t[h];const d=t[h+1];for(let f=1;f<u+1;++f)c[h].push(f*d)}for(let h=0;h<r.length;++h){let d=r[h],f=r[h]+1;for(let p=0;p<n.length;++p){const m=n[p],g=p+t.length-1;if(g>=0){const y=c[g],v=y[y.length-1]-m[d];for(let x=d;x<f;++x)c[g].push(m[x+1]+v)}d=m[d],f=m[f]}f!==d&&(o.push([d,f]),a+=f-d)}return{outSplits:c,valueSlices:o,numValues:a}}function Uat(r){const t=[];for(let n=0;n<r.length;++n){const i=r[n].length,o=ks("int32",i);t.push(o),r[n].forEach((a,l)=>o[l]=a)}return t}function XI(r,t){const n=r.slice(0,t);for(;n.length<t;)n.push(1);for(let i=t;i<r.length;i++)n[t-1]*=r[i];return n}function Wat(r,t,n,i,o,a){const l=XI(t,2)[1],c=XI(a,2)[1];let u=0;for(const h of n)for(let d=h[0];d<h[1];++d){for(let f=0;f<i;++f)o[u*c+f]=r[d*l+f];++u}}function Gat(r,t,n,i,o){const a=t.slice();a[0]=o;const l=ks(n,Nt(a)),c=r.length,u=c===0?0:c/t[0];return Wat(r,t,i,u,l,a),[l,a]}function q7(r,t,n,i,o,a,l,c){if(r.length===0)throw new Error("paramsNestedSplits must be non empty");if(t[0].length===0)throw new Error("Split tensors must not be scalars");const u=t[0][0]-1;if(Bat(a,l,u),i.length===0)throw new Error("params.rank must be nonzero");const h=i[0],{outSplits:d,valueSlices:f,numValues:p}=Vat(a,l,r,h),m=Uat(d),g=Gat(n,i,o,f,p);return[m,g[0],g[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YI=2147483647;function K7(r,t,n,i,o,a,l){if(t.length>1)throw new Error("starts must be a scalar or vector");if(o.length>1)throw new Error("limits must be a scalar or vector");if(l.length>1)throw new Error("deltas must be a scalar or vector");const c=t.length===0,u=o.length===0,h=l.length===0,d=[];c||d.push(t[0]),u||d.push(o[0]),h||d.push(l[0]);for(let v=1;v<d.length;++v)if(d[v]!==d[v-1])throw new Error("starts, limits, and deltas must have the same shape");const f=d.length===0?1:d[0],p=ks("int32",f+1);p[0]=0;for(let v=0;v<f;++v){const x=c?r[0]:r[v],b=u?i[0]:i[v],w=h?a[0]:a[v];if(w===0)throw new Error("Requires delta != 0");let S;if(w>0&&b<x||w<0&&b>x)S=0;else if(S=Math.ceil(Math.abs((b-x)/w)),S>YI)throw new Error(`Requires ((limit - start) / delta) <= ${YI}`);p[v+1]=p[v]+S}const m=p[f],g=ks(n,m);let y=0;for(let v=0;v<f;++v){const x=p[v+1]-p[v];let b=c?r[0]:r[v];const w=h?a[0]:a[v];for(let S=0;S<x;++S)g[y++]=b,b+=w}return[p,g]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Xi=Bo;class b2{constructor(t,n,i,o,a,l,c,u,h,d){this.shape=t,this.shapeShape=n,this.values=i,this.valuesShape=o,this.valuesDType=a,this.defaultValue=l,this.defaultValueShape=c,this.rowPartitionValues=u,this.rowPartitionValuesShapes=h,this.rowPartitionTypes=z9(d),this.raggedRank=V9(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===Xi.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===Xi.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){const n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case Xi.VALUE_ROWIDS:return b2.getMaxWidthValueRowID(n);case Xi.ROW_SPLITS:return b2.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${Xi[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){const n=t.length;if(n===0||n===1)return 0;let i=0;for(let o=0;o<n-1;++o){const a=t[o+1]-t[o];a>i&&(i=a)}return i}static getMaxWidthValueRowID(t){const n=t.length;if(n===0)return 0;let i=0,o=t[0],a=0;for(let l=1;l<n;++l){const c=t[l];c!==o&&(o=c,a=Math.max(l-i,a),i=l)}return Math.max(n-i,a)}tensorShapeFromTensor(t,n,i=!0){if(n.length===0){if(t[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return JI(t,i)}calculateOutputSize(t){const n=this.valuesShape,i=this.defaultValueShape;U9(i,n);const o=this.tensorShapeFromTensor(this.shape,this.shapeShape),l=B9(this.raggedRank,o,n);l[0]<0&&(l[0]=t);for(let c=1;c<=this.raggedRank;++c)l[c]<0&&(l[c]=this.getMaxWidth(c));return l}calculateFirstParentOutputIndex(t,n,i){const o=Math.min(t,i),a=[];let l=0;for(let c=0;c<o;++c,l+=n)a.push(l);for(let c=o;c<t;++c)a.push(-1);return W(a.length===t,()=>"Final length of result must be equal to firstDimension."),a}calculateOutputIndexRowSplit(t,n,i,o){const a=t.length,l=[];for(let c=0;c<a-1;++c){const u=t[c+1]-t[c];let h=Math.min(o,u),d=n[c];d===-1&&(h=0);for(let f=0;f<h;++f)l.push(d),d+=i;for(let f=0;f<u-h;++f)l.push(-1)}if(a>0&&l.length!==t[a-1])throw new Error("Invalid row split size.");return l}calculateOutputIndexValueRowID(t,n,i,o){const a=t.length,l=[];if(a===0)return[];let c=0,u=t[0];if(u>=n.length)throw new Error(`Got currentValueRowId=${u}, which is not less than ${n.length}`);let h=n[u];l.push(h);for(let d=1;d<a;++d){const f=t[d];if(f===u)h>=0&&(++c,c<o?h+=i:h=-1);else{if(c=0,u=f,f>=n.length)throw new Error(`Got nextValueRowId=${f} which is not less than ${n.length}`);h=n[f]}l.push(h)}if(l.length!==t.length)throw new Error("Invalid row ids.");return l}calculateOutputIndex(t,n,i,o){const a=this.getRowPartitionTensor(t),l=this.getRowPartitionTypeByDimension(t);switch(l){case Xi.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,n,i,o);case Xi.ROW_SPLITS:if(a.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${a.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(a,n,i,o);default:throw new Error(`Unsupported partition type: ${Xi[l]}`)}}getFirstDimensionSize(){const t=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case Xi.FIRST_DIM_SIZE:return t[0];case Xi.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Xi.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Xi[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),i=this.calculateOutputSize(n),o=new Array(this.raggedRank+1);o[o.length-1]=1;for(let u=o.length-2;u>=0;--u)o[u]=o[u+1]*i[u+1];const a=JI(i,!1),l=ks(this.valuesDType,Nt(a));if(o[0]*i[0]>0){let u=this.calculateFirstParentOutputIndex(n,o[0],i[0]);for(let h=1;h<=this.raggedRank;++h)u=this.calculateOutputIndex(h-1,u,o[h],i[h]);this.setOutput(this.raggedRank,u,l,a)}return[a,l]}setOutput(t,n,i,o){if(i.length===0)return;const a=this.values,l=i;let c=o.slice();c=c.slice(t+1);const u=Nt(c),h=n.length;let d=this.defaultValue;if(d.length!==u&&d.length!==1){const g=this.defaultValueShape;_t(()=>{const y=gt(d,g);d=Mp(y,c).dataSync()})}let f=0,p=0,m=0;for(let g=0;g<=h;++g){let y=g<h?n[g]:-1;if(y===m){++m;continue}if(p<m){const v=a.subarray(f*u),x=l.subarray(p*u),b=(m-p)*u;ZI(x,v,b)}if(g>=h){const v=i.length;y=Math.floor(v/u)}if(y>m)if(this.defaultValue.length===1)l.subarray(m*u,y*u).fill(this.defaultValue[0]),m=y;else for(;y>m;){const v=l.slice(m*u);ZI(v,d,u),++m}y<0?(f=g+1,p=m):(f=g,p=m,m=p+1)}}}function ZI(r,t,n){for(let i=0;i<n;i++)r[i]=t[i]}function JI(r,t){const n=[];for(let i of r){if(i<0){if(!t)throw new Error(`Dimension ${i} must be >= 0`);if(i<-1)throw new Error(`Dimension ${i} must be >= -1`);i=-1}n.push(i)}return n}function X7(r,t,n,i,o,a,l,c,u,h){return new b2(r,t,n,i,o,a,l,c,u,h).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y7(r,t,n,i){const o=r===t,a=r<t&&n<0,l=t<r&&n>1;if(o||a||l)return Sr(0,i);const c=Math.abs(Math.ceil((t-r)/n)),u=Sr(c,i);t<r&&n===1&&(n=-1),u[0]=r;for(let h=1;h<u.length;h++)u[h]=u[h-1]+n;return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z7=Hc(r=>1/Math.sqrt(r)),Hat=xf(lg,Z7),jat={kernelName:lg,backendName:"cpu",kernelFunc:Hat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gd(r,t,n,i,o,a,l,c,u,h){const d=[i/o,o],f=r.values,p=t.values;if(i===0)return rn(n,t.dtype);const m=rn(d,t.dtype);typeof u=="string"||typeof u=="number"?m.values.fill(u):typeof u=="boolean"&&m.values.fill(+u);for(let g=0;g<a;g++){const y=[];let v=0;for(let x=0;x<l;x++){const b=f[g*l+x];y.push(b),v+=b*c[x]}if(v<0||v>=i/o)throw new Error(`Invalid indices: ${y} does not index into ${n}`);for(let x=0;x<o;x++)h?m.values[v*o+x]+=p[g*o+x]:m.values[v*o+x]=t.rank===0?p[0]:p[g*o+x]}return m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qat=Hc(r=>1/(1+Math.exp(-r))),J7=On(fg,r=>1/(1+Math.exp(-r))),Kat={kernelName:fg,backendName:"cpu",kernelFunc:J7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q7(r,t,n,i,o){const a=A_(i,t,n),l=Nt(n),c=Ie(i);if(a){const f=M_(t,c);return o==="string"?r.slice(f,f+l):r.subarray(f,f+l)}const u=o==="string"?Ju(r):r,h=rn(i,o,u),d=rn(n,o);for(let f=0;f<d.size;++f){const p=d.indexToLoc(f),m=p.map((g,y)=>g+t[y]);d.set(h.get(...m),...p)}return o==="string"?l8(d.values):d.values}function eh(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{begin:a,size:l}=i;be(o,"slice");const[c,u]=oy(o,a,l);E_(o,c,u);const h=n.data.get(o.dataId).values,d=Q7(h,c,u,o.shape,o.dtype);return n.makeTensorInfo(u,o.dtype,d)}const Xat={kernelName:Kv,backendName:"cpu",kernelFunc:eh};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tL(r,t,n,i,o,a,l){const c=t[0],u=a[0],h=new Array(u),d=new Array(c),f=t[1];if(u===0){if(c!==0)throw new Error(X9(c));const v=ks(n,0),x=ks(o,0);return[v,[0,f],x,h,d]}let p=!0,m=0;const g=new Array(u).fill(0);for(let v=0;v<c;++v){const x=r[v*f];if(x<0)throw new Error(Y9(v,x));if(x>=u)throw new Error(Z9(v,x,u));++g[x],p=p&&x>=m,m=x}let y=!0;for(let v=0;v<u;++v){const x=g[v]===0;h[v]=x,y=y&&!x,g[v]=Math.max(g[v],1),v>0&&(g[v]+=g[v-1])}if(y&&p){const v=r,x=i;for(let b=0;b<c;++b)d[b]=b;return[v,[c,f],x,h,d]}else{const v=g[u-1],x=ks(n,v*f),b=ks(o,v),w=new Array(u).fill(0);for(let S=0;S<c;++S){const _=r[S*f],$=w[_],N=(_===0?0:g[_-1])+$;w[_]++;for(let k=0;k<f;++k)x[N*f+k]=r[S*f+k];b[N]=i[S],d[S]=N}for(let S=0;S<u;++S)if(w[S]===0){const $=S===0?0:g[S-1];x[$*f+0]=S;for(let N=1;N<f;++N)x[$*f+N]=0;b[$]=l}return[x,[v,f],b,h,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eL(r,t,n,i,o){const a=Nt(i),l=t[0],c=o.length,u=[];let h=1,d=-1;for(let v=0;v<c;++v){const x=o[v];if(x===-1){if(d!==-1)throw new Error(J9(d,v));d=v,u.push(1)}else{if(x<0)throw new Error(Q9(v,x));h*=x,u.push(x)}}if(d!==-1){if(h<=0)throw new Error(t8());const v=Math.trunc(a/h);if(h*v!==a)throw new Error(e8(i,u));u[d]=v}if(Nt(u)!==a)throw new Error(n8(i,u));const p=i.length,m=[];if(p>0){m[p-1]=1;for(let v=p-2;v>=0;--v)m[v]=m[v+1]*i[v+1]}const g=[];if(c>0){g[c-1]=1;for(let v=c-2;v>=0;--v)g[v]=g[v+1]*u[v+1]}const y=ks(n,l*c);for(let v=0;v<l;++v){let x=0;for(let b=0;b<p;++b)x+=r[v*p+b]*m[b];for(let b=0;b<c;++b)y[v*c+b]=Math.trunc(x/g[b]),x%=g[b]}return[y,[l,c],u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oC(r,t,n,i,o,a=!1,l=0){const c=i.length,u=[t[0],r.length/t[0]],h=u[1],f=c>0?o[c-1]+1:0;if(f<0)throw new Error(lw());const p=t.slice();p[0]=f;const m=p.reduce((w,S)=>w*S,1),g=ks(n,m);if(c===0)return f>0&&g.fill(l),[g,p];if(f<=0)throw new Error(lw());let y=0,v=1,x=0,b=o[y];for(;;){let w=0;if(v<c){if(w=o[v],b===w){++v;continue}if(b>=w)throw new Error(s8())}if(b<0||b>=f)throw new Error(r8(b,f));b>x&&g.fill(l,x*h,b*h);for(let S=y;S<v;++S){const _=i[S];if(_<0||_>=u[0])throw new Error(i8(S,i[S],u[0]));for(let $=0;$<h;$++)g[b*h+$]+=r[_*h+$]}if(a)for(let S=0;S<h;S++)g[b*h+S]/=v-y;if(y=v,++v,x=b+1,b=w,v>c)break}return x<f&&g.fill(l,x*h,f*h),[g,p]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yat=Hc(r=>Math.sqrt(r)),Zat=On(mg,r=>Math.sqrt(r)),Jat={kernelName:mg,backendName:"cpu",kernelFunc:Zat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nL=Is((r,t)=>{const n=r-t;return n*n}),Qat=Js(gg,nL),tlt={kernelName:gg,backendName:"cpu",kernelFunc:Qat};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sL(r,t,n,i){const o=rn(r,t.dtype);for(let a=0;a<o.size;a++){const l=o.indexToLoc(a),c=new Array(l.length);for(let u=0;u<c.length;u++)c[u]=l[u]*n[u]+i[u];o.set(t.get(...c),...l)}return o}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class elt{constructor(t,n,i,o,a,l){this.separator=hc(t),this.nGramWidths=n,this.leftPad=hc(i),this.rightPad=hc(o),this.padWidth=a,this.preserveShort=l}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,n){const i=this.getPadWidth(n);return Math.max(0,t+2*i-n+1)}createNGrams(t,n,i,o,a,l){for(let c=0;c<a;++c){const u=this.getPadWidth(l),h=Math.max(0,u-c),d=Math.max(0,u-(a-(c+1))),f=l-(h+d),p=n+(h>0?0:c-u);let m=0;m+=h*this.leftPad.length;for(let b=0;b<f;++b)m+=t[p+b].length;m+=d*this.rightPad.length;const g=h+d+f-1;m+=g*this.separator.length,i[o+c]=new Uint8Array(m);const y=i[o+c];let v=0;const x=b=>b.forEach(w=>y[v++]=w);for(let b=0;b<h;++b)x(this.leftPad),x(this.separator);for(let b=0;b<f-1;++b)x(t[p+b]),x(this.separator);if(f>0){x(t[p+f-1]);for(let b=0;b<d;++b)x(this.separator),x(this.rightPad)}else{for(let b=0;b<d-1;++b)x(this.rightPad),x(this.separator);x(this.rightPad)}}}compute(t,n){const i=t.length,o=n.length;if(o>0){let u=n[0];if(u!==0)throw new Error(`First split value must be 0, got ${u}`);for(let h=1;h<o;++h){let d=n[h]>=u;if(d=d&&n[h]<=i,!d)throw new Error(`Invalid split value ${n[h]}, must be in [${u}, ${i}]`);u=n[h]}if(u!==i)throw new Error(`Last split value must be data size. Expected ${i}, got ${u}`)}const a=o-1,l=ks("int32",o);if(i===0||o===0){const u=new Array(i);for(let h=0;h<=a;++h)l[h]=0;return[u,l]}l[0]=0;for(let u=1;u<=a;++u){const h=n[u]-n[u-1];let d=0;this.nGramWidths.forEach(f=>{d+=this.getNumNGrams(h,f)}),this.preserveShort&&h>0&&d===0&&(d=1),l[u]=l[u-1]+d}const c=new Array(l[a]);for(let u=0;u<a;++u){const h=n[u];let d=l[u];if(this.nGramWidths.forEach(f=>{const p=n[u+1]-n[u],m=this.getNumNGrams(p,f);this.createNGrams(t,h,c,d,m,f),d+=m}),this.preserveShort&&d===l[u]){const f=n[u+1]-n[u];if(f===0)continue;const p=f+2*this.padWidth,m=1;this.createNGrams(t,h,c,d,m,p)}}return[c,l]}}function rL(r,t,n,i,o,a,l,c){return new elt(n,i,o,a,l,c).compute(r,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nlt(r,t,n,i){if(!r.length)return;if(t.length===0){for(let a=0;a<r.length;++a)i.push(r.subarray(a,a+1));return}if(t.length===1){const a=t[0];let l=r.indexOf(a);for(;l!==-1;){const c=r.subarray(0,l);(!n||c.length!==0)&&i.push(c),r=r.subarray(l+1),l=r.indexOf(a)}(!n||r.length!==0)&&i.push(r);return}let o=0;for(let a=0;a<r.length+1;a++)if(a===r.length||t.indexOf(r[a])!==-1){const l=r.subarray(o,a);(!n||l.length!==0)&&i.push(l),o=a+1}}function iL(r,t,n){const i=r.length,o=[];let a=0,l=0;const c=new Array(i);for(let p=0;p<i;++p){const m=o.length;nlt(r[p],t,n,o);const g=o.length-m;c[p]=g,a+=g,l=Math.max(l,g)}const u=ks("int32",a*2),h=new Array(a),d=[i,l];let f=0;for(let p=0;p<i;++p)for(let m=0;m<c[p];++m)u[f*2]=p,u[f*2+1]=m,h[f]=o[f],++f;return[u,h,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oL(r,t){const n=ks("int32",r.length);for(let i=0;i<r.length;++i)n[i]=yY(r[i]).modulo(t).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aL=Is((r,t)=>r-t),slt=nC((r,t,n,i)=>({real:r-n,imag:t-i})),aC=Js(vg,aL,slt),rlt={kernelName:vg,backendName:"cpu",kernelFunc:aC};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lL(r,t){const n=new Array(r.rank);for(let o=0;o<n.length;o++)n[o]=r.shape[o]*t[o];const i=rn(n,r.dtype);for(let o=0;o<i.values.length;++o){const a=i.indexToLoc(o),l=new Array(r.rank);for(let u=0;u<l.length;u++)l[u]=a[u]%r.shape[u];const c=r.locToIndex(l);i.values[o]=r.values[c]}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wp=(r,t)=>{const n=t.value-r.value;return n===0?r.index-t.index:n};function cL(r,t,n=0,i=r.length-1){for(;i>n;){if(i-n>600){const c=i-n+1,u=t-n+1,h=Math.log(c),d=.5*Math.exp(2*h/3),f=.5*Math.sqrt(h*d*(c-d)/c)*Math.sign(u-c/2),p=Math.max(n,Math.floor(t-u*d/c+f)),m=Math.min(i,Math.floor(t+(c-u)*d/c+f));cL(r,t,p,m)}const o=r[t];let a=n,l=i;for(id(r,n,t),wp(r[i],o)>0&&id(r,n,i);a<l;){for(id(r,a,l),a++,l--;wp(r[a],o)<0;)a=a+1;for(;wp(r[l],o)>0;)l=l-1}wp(r[n],o)===0?id(r,n,l):(l=l+1,id(r,l,i)),l<=t&&(n=l+1),t<=l&&(i=l-1)}}function uL(r,t,n,i,o){const a=t[t.length-1],[l,c]=[r.length/a,a],u=hr(n,l*i),h=hr("int32",l*i);for(let f=0;f<l;f++){const p=f*c,m=r.subarray(p,p+c);let g=new Array(m.length);m.forEach((b,w)=>g[w]={value:b,index:w}),i<g.length&&(cL(g,i),g=g.slice(0,i)),o&&g.sort(wp);const y=f*i,v=u.subarray(y,y+i),x=h.subarray(y,y+i);for(let b=0;b<i;b++)v[b]=g[b].value,x[b]=g[b].index}const d=t.slice();return d[d.length-1]=i,[rn(d,n,u),rn(d,"int32",h)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hL(r,t,n,i){const o=on(t,n)[0],a=[1,n[0],1];for(let g=0;g<o;g++)a[0]*=n[g];a[1]=n[o];for(let g=o+1;g<n.length;g++)a[2]*=n[g];const l={},c=new Int32Array(n[o]),u=new xr(a,i,r),h=[],d=a[0]===1&&a[2]===1;for(let g=0;g<n[o];g++){let y;if(d)y=r[g].toString();else{const v=[];for(let x=0;x<a[0];x++)for(let b=0;b<a[2];b++)v.push(u.get(x,g,b));y=v.join(",")}if(l[y]!==void 0)c[g]=l[y];else{const v=Object.keys(l).length;l[y]=v,c[g]=v,h.push(g)}}const f=a.slice();f[1]=Object.keys(l).length;const p=new xr(f,i);h.forEach((g,y)=>{for(let v=0;v<a[0];v++)for(let x=0;x<a[2];x++)p.set(u.get(v,g,x),v,y,x)});const m=n.slice();return m[o]=f[1],{outputValues:p.values,outputShape:m,indices:c}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ilt=Object.freeze(Object.defineProperty({__proto__:null,simpleAbsImpl:w7,addImpl:_7,bincountImpl:sC,bincountReduceImpl:T7,castImpl:S7,ceilImpl:C7,concatImpl:k7,equalImpl:$7,expImpl:E7,expm1Impl:A7,floorImpl:M7,gatherNdImpl:D7,gatherV2Impl:R7,greaterImpl:O7,greaterEqualImpl:L7,lessImpl:F7,lessEqualImpl:P7,linSpaceImpl:B7,logImpl:z7,maxImpl:V7,maximumImpl:U7,minimumImpl:W7,multiplyImpl:rC,negImpl:G7,notEqualImpl:H7,prodImpl:j7,raggedGatherImpl:q7,raggedRangeImpl:K7,raggedTensorToTensorImpl:X7,rangeImpl:Y7,rsqrtImpl:Z7,scatterImpl:gd,sigmoidImpl:qat,sliceImpl:Q7,sparseFillEmptyRowsImpl:tL,sparseReshapeImpl:eL,sparseSegmentReductionImpl:oC,sqrtImpl:Yat,squaredDifferenceImpl:nL,stridedSliceImpl:sL,stringNGramsImpl:rL,stringSplitImpl:iL,stringToHashBucketFastImpl:oL,subImpl:aL,tileImpl:lL,topKImpl:uL,transposeImpl:iC,uniqueImpl:hL},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */YR("cpu",()=>new Ey,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dL=On(zm,r=>r>=0?r:Math.exp(r)-1),olt={kernelName:zm,backendName:"cpu",kernelFunc:dL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fL(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{alpha:a}=i;be([o],"leakyRelu");const l=Nt(o.shape),c=n.data.get(o.dataId).values,u=hr("float32",l);for(let h=0;h<c.length;h++)u[h]=c[h]<0?a*c[h]:c[h];return n.makeTensorInfo(o.shape,"float32",u)}const alt={kernelName:Sv,backendName:"cpu",kernelFunc:fL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const llt=Is((r,t)=>r<0?t*r:r);function pL(r){const{inputs:t,backend:n}=r,{x:i,alpha:o}=t;be([i,o],"prelu");const a=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values,[c,u]=llt(i.shape,o.shape,a,l,"float32");return n.makeTensorInfo(u,"float32",c)}const clt={kernelName:Vv,backendName:"cpu",kernelFunc:pL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mL=On(ig,r=>Math.max(0,r)),ult={kernelName:ig,backendName:"cpu",kernelFunc:mL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gL=On(og,r=>Math.min(Math.max(0,r),6)),hlt={kernelName:og,backendName:"cpu",kernelFunc:gL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w2(r,t,n,i,o){if(n==="linear")return Ba({inputs:{x:t},backend:r});if(n==="relu")return mL({inputs:{x:t},backend:r});if(n==="elu")return dL({inputs:{x:t},backend:r});if(n==="relu6")return gL({inputs:{x:t},backend:r});if(n==="prelu")return pL({inputs:{x:t,alpha:i},backend:r});if(n==="leakyrelu")return fL({inputs:{x:t},backend:r,attrs:{alpha:o}});if(n==="sigmoid")return J7({inputs:{x:t},backend:r});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qn(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{shape:a}=i,l=Nt(o.shape),c=nR(a,l),u=Nt(c);W(l===u,()=>`The new shape (${c}) has ${u} elements and the old shape (${o.shape}) has ${l} elements. The new shape and old shape must have the same number of elements.`),n.incRef(o.dataId);const h=n.data.get(o.dataId);if(h.complexTensorInfos!=null){const d=h.complexTensorInfos.real,f=h.complexTensorInfos.imag;d.shape=c,f.shape=c}return{dataId:o.dataId,shape:c,dtype:o.dtype}}const dlt={kernelName:Wv,backendName:"cpu",kernelFunc:qn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vL(r){const{inputs:t,backend:n,attrs:i}=r,{a:o,b:a}=t,{transposeA:l,transposeB:c}=i;be([o,a],"matMul");const u=o.shape.length,h=a.shape.length,d=l?o.shape[u-2]:o.shape[u-1],f=c?a.shape[h-1]:a.shape[h-2],p=l?o.shape[u-1]:o.shape[u-2],m=c?a.shape[h-2]:a.shape[h-1],g=o.shape.slice(0,-2),y=a.shape.slice(0,-2),v=Nt(g),x=Nt(y),w=qe(o.shape.slice(0,-2),a.shape.slice(0,-2)).concat([p,m]);W(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${o.shape} and ${a.shape} and transposeA=${l} and transposeB=${c} must match.`);const S=l?[v,d,p]:[v,p,d],_=c?[x,m,f]:[x,f,m],$=qn({inputs:{x:o},backend:n,attrs:{shape:S}}),N=qn({inputs:{x:a},backend:n,attrs:{shape:_}}),k=l?$.shape[1]:$.shape[2],I=l?$.shape[2]:$.shape[1],O=c?N.shape[1]:N.shape[2],B=Math.max(v,x),F=n.data.get($.dataId).values,D=n.data.get(N.dataId).values,L=Ie($.shape),V=Ie(N.shape),[j,Y,H]=l?[L[0],1,L[1]]:[L[0],L[1],1],[et,it,J]=c?[1,V[1],V[0]]:[V[1],1,V[0]],rt=I*O,ut=rn([B,I,O],$.dtype),vt=ut.values,bt=n.blockSize;for(let ht=0;ht<B;ht++)for(let Wt=0;Wt<I;Wt+=bt)for(let Dt=0;Dt<O;Dt+=bt)for(let Vt=0;Vt<k;Vt+=bt){const zt=Math.min(Wt+bt,I),Jt=Math.min(Dt+bt,O),oe=Math.min(Vt+bt,k);for(let ne=Wt;ne<zt;ne++)for(let Oe=Dt;Oe<Jt;Oe++){let Ae=0;for(let Ee=Vt;Ee<oe;Ee++){const We=Math.min(ht,v-1)*j,Ne=Math.min(ht,x-1)*J,Le=F[We+ne*Y+Ee*H],yn=D[Ee*et+Oe*it+Ne];Ae+=Le*yn}vt[ht*rt+(ne*O+Oe)]+=Ae}}return n.disposeIntermediateTensorInfo($),n.disposeIntermediateTensorInfo(N),n.makeTensorInfo(w,ut.dtype,ut.values)}const flt={kernelName:av,backendName:"cpu",kernelFunc:vL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function plt(r){const{inputs:t,backend:n,attrs:i}=r,{a:o,b:a,bias:l,preluActivationWeights:c}=t,{transposeA:u,transposeB:h,activation:d,leakyreluAlpha:f}=i;let p,m,g;const y=[];p=vL({inputs:{a:o,b:a},attrs:{transposeA:u,transposeB:h},backend:n}),l&&(m=Vd({inputs:{a:p,b:l},backend:n}),y.push(p),p=m),d&&(g=w2(n,p,d,c,f),y.push(p),p=g);for(const x of y)n.disposeIntermediateTensorInfo(x);return p}const mlt={kernelName:e2,backendName:"cpu",kernelFunc:plt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const glt=On($m,r=>Math.acos(r)),vlt={kernelName:$m,backendName:"cpu",kernelFunc:glt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ylt=On(Im,r=>Math.acosh(r)),xlt={kernelName:Im,backendName:"cpu",kernelFunc:ylt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function blt(r){const{inputs:t,backend:n}=r,i=t;be(t,"addN");const o=i.map(c=>n.data.get(c.dataId).values),a=rn(i[0].shape,i[0].dtype),l=a.values;for(let c=0;c<i.length;c++){const u=o[c];for(let h=0;h<l.length;h++)l[h]+=u[h]}return n.makeTensorInfo(a.shape,a.dtype,a.values)}const wlt={kernelName:M4,backendName:"cpu",kernelFunc:blt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Slt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a,keepDims:l}=i;be(o,"all");const c=on(a,o.shape);let u=c;const h=ms(u,o.shape.length);let d=o;h!=null&&(d=ni({inputs:{x:o},backend:n,attrs:{perm:h}}),u=_s(u.length,o.shape.length)),fr("all",u,d.shape.length);const[f,p]=Zs(d.shape,u),m=Nt(p),g=Sr(Nt(f),d.dtype),y=n.data.get(d.dataId).values;for(let x=0;x<g.length;++x){const b=x*m;let w=y[b];for(let S=0;S<m;++S){const _=y[b+S];w=w&&_}g[x]=w}h!=null&&n.disposeIntermediateTensorInfo(d);const v=n.makeTensorInfo(f,d.dtype,g);if(l){const x=Ss(f,c),b=qn({inputs:{x:v},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(v),b}return v}const _lt={kernelName:D4,backendName:"cpu",kernelFunc:Slt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tlt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a,keepDims:l}=i;be(o,"any");const c=on(a,o.shape);let u=c;const h=ms(u,o.shape.length);let d=o;h!=null&&(d=ni({inputs:{x:o},backend:n,attrs:{perm:h}}),u=_s(u.length,o.shape.length)),fr("any",u,d.shape.length);const[f,p]=Zs(d.shape,u),m=Nt(p),g=Sr(Nt(f),d.dtype),y=n.data.get(d.dataId).values;for(let x=0;x<g.length;++x){const b=x*m;let w=y[b];for(let S=0;S<m;++S){const _=y[b+S];w=w||_}g[x]=w}h!=null&&n.disposeIntermediateTensorInfo(d);const v=n.makeTensorInfo(f,d.dtype,g);if(l){const x=Ss(f,c),b=qn({inputs:{x:v},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(v),b}return v}const Clt={kernelName:R4,backendName:"cpu",kernelFunc:Tlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function klt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a}=i;be(o,"argMax");let l=on(a,o.shape);const c=ms(l,o.shape.length);let u=o;const h=[];c!=null&&(u=ni({inputs:{x:o},backend:n,attrs:{perm:c}}),h.push(u),l=_s(l.length,u.shape.length)),l=[l[0]],fr("argMax",l,u.shape.length);const[d,f]=Zs(u.shape,l),p=Nt(d),m=Sr(p,"int32"),g=Nt(f),y=n.data.get(u.dataId).values;for(let v=0;v<m.length;++v){const x=v*g;let b=y[x],w=0;for(let S=0;S<g;++S){const _=y[x+S];_>b&&(b=_,w=S)}m[v]=w}return h.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.makeTensorInfo(d,"int32",m)}const $lt={kernelName:sv,backendName:"cpu",kernelFunc:klt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ilt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a}=i;be(o,"argMin");let l=on(a,o.shape);const c=ms(l,o.shape.length);let u=o;const h=[];c!=null&&(u=ni({inputs:{x:o},backend:n,attrs:{perm:c}}),h.push(u),l=_s(l.length,u.shape.length)),l=[l[0]],fr("argMin",l,u.shape.length);const[d,f]=Zs(u.shape,l),p=Nt(d),m=Sr(p,"int32"),g=Nt(f),y=n.data.get(u.dataId).values;for(let v=0;v<m.length;++v){const x=v*g;let b=y[x],w=0;for(let S=0;S<g;++S){const _=y[x+S];_<b&&(b=_,w=S)}m[v]=w}return h.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.makeTensorInfo(d,"int32",m)}const Elt={kernelName:rv,backendName:"cpu",kernelFunc:Ilt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nlt=On(Em,r=>Math.asin(r)),Alt={kernelName:Em,backendName:"cpu",kernelFunc:Nlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mlt=On(Nm,r=>Math.asinh(r)),Dlt={kernelName:Nm,backendName:"cpu",kernelFunc:Mlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rlt=On(Am,r=>Math.atan(r)),Olt={kernelName:Am,backendName:"cpu",kernelFunc:Rlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Llt=Is((r,t)=>Math.atan2(r,t)),Flt=Js(Dm,Llt),Plt={kernelName:Dm,backendName:"cpu",kernelFunc:Flt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Blt=On(Mm,r=>Math.atanh(r)),zlt={kernelName:Mm,backendName:"cpu",kernelFunc:Blt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lC(r,t,n,i,o,a){const l=o.strideHeight,c=o.strideWidth,u=o.dilationHeight,h=o.dilationWidth,d=o.effectiveFilterHeight,f=o.effectiveFilterWidth,p=o.padInfo.top,m=o.padInfo.left,g=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=rn(o.outShape,n),v=y.values,x=o.outShape[1]*o.outShape[2]*o.outShape[3],b=o.outShape[2]*o.outShape[3],w=o.outShape[3];for(let S=0;S<o.batchSize;++S){const _=S*x,$=S*i[0];for(let N=0;N<o.inChannels;++N)for(let k=0;k<o.outHeight;++k){const I=k*l-p,O=Math.max(0,I),B=Math.min(o.inHeight,d+I),F=_+k*b;for(let D=0;D<o.outWidth;++D){const L=D*c-m,V=Math.max(0,L),j=Math.min(o.inWidth,f+L);let Y=g,H=0,et=0;for(let J=O;J<B;J+=u){const rt=$+J*i[1];for(let ut=V;ut<j;ut+=h){const vt=rt+ut*i[2],bt=r[vt+N];a==="max"&&bt>Y?Y=bt:a==="avg"&&(H+=bt,et++)}if(isNaN(Y))break}const it=F+D*w+N;v[it]=a==="avg"?H/et:Y}}}return y}function yL(r,t,n,i,o=!1,a=!1){const l=rn(i.outShape,"int32"),c=i.strideHeight,u=i.strideWidth,h=i.dilationHeight,d=i.dilationWidth,f=i.effectiveFilterHeight,p=i.effectiveFilterWidth,m=i.padInfo.top,g=i.padInfo.left,y=rn(t,n,r);for(let v=0;v<i.batchSize;++v)for(let x=0;x<i.inChannels;++x)for(let b=0;b<i.outHeight;++b){const w=b*c-m;let S=w;for(;S<0;)S+=h;const _=Math.min(i.inHeight,f+w);for(let $=0;$<i.outWidth;++$){const N=$*u-g;let k=N;for(;k<0;)k+=d;const I=Math.min(i.inWidth,p+N);let O=Number.NEGATIVE_INFINITY,B=-1;for(let F=S;F<_;F+=h){const D=F-w;for(let L=k;L<I;L+=d){const V=L-N,j=y.get(v,F,L,x);j>O&&(O=j,o?B=a?((v*i.inHeight+F)*i.inWidth+L)*i.inChannels+x:(F*i.inWidth+L)*i.inChannels+x:B=D*p+V)}}l.set(B,v,b,$,x)}}return l}function xL(r,t,n,i,o,a){const l=o.strideDepth,c=o.strideHeight,u=o.strideWidth,h=o.dilationDepth,d=o.dilationHeight,f=o.dilationWidth,p=o.effectiveFilterDepth,m=o.effectiveFilterHeight,g=o.effectiveFilterWidth,y=o.padInfo.front,v=o.padInfo.top,x=o.padInfo.left,b=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=rn(o.outShape,n),S=w.values,_=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],$=o.outShape[2]*o.outShape[3]*o.outShape[4],N=o.outShape[3]*o.outShape[4],k=o.outShape[4];for(let I=0;I<o.batchSize;++I){const O=I*_,B=I*i[0];for(let F=0;F<o.inChannels;++F)for(let D=0;D<o.outDepth;++D){const L=D*l-y;let V=L;for(;V<0;)V+=h;const j=Math.min(o.inDepth,p+L),Y=O+D*$;for(let H=0;H<o.outHeight;++H){const et=H*c-v;let it=et;for(;it<0;)it+=d;const J=Math.min(o.inHeight,m+et),rt=Y+H*N;for(let ut=0;ut<o.outWidth;++ut){const vt=ut*u-x;let bt=vt;for(;bt<0;)bt+=f;const ht=Math.min(o.inWidth,g+vt),Wt=rt+ut*k;let Dt=b,Vt=0,zt=0;for(let oe=V;oe<j;oe+=h){const ne=B+oe*i[1];for(let Oe=it;Oe<J;Oe+=d){const Ae=ne+Oe*i[2];for(let Ee=bt;Ee<ht;Ee+=f){const We=Ae+Ee*i[3],Ne=r[We+F];if(a==="max"&&Ne>Dt?Dt=Ne:a==="avg"&&(Vt+=Ne,zt++),isNaN(Dt))break}if(isNaN(Dt))break}if(isNaN(Dt))break}const Jt=Wt+F;S[Jt]=a==="avg"?Vt/zt:Dt}}}}return w}function Vlt(r,t){const n=rn(t.outShape,"int32"),i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,l=t.dilationDepth,c=t.dilationHeight,u=t.dilationWidth,h=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,p=t.padInfo.front,m=t.padInfo.top,g=t.padInfo.left;for(let y=0;y<t.batchSize;++y)for(let v=0;v<t.inChannels;++v)for(let x=0;x<t.outDepth;++x){const b=x*i-p;let w=b;for(;w<0;)w+=l;const S=Math.min(t.inDepth,h+b);for(let _=0;_<t.outHeight;++_){const $=_*o-m;let N=$;for(;N<0;)N+=c;const k=Math.min(t.inHeight,d+$);for(let I=0;I<t.outWidth;++I){const O=I*a-g;let B=O;for(;B<0;)B+=u;const F=Math.min(t.inWidth,f+O);let D=Number.NEGATIVE_INFINITY,L=-1;for(let V=w;V<S;V+=l){const j=V-b;for(let Y=N;Y<k;Y+=c){const H=Y-$;for(let et=B;et<F;et+=u){const it=et-O,J=r.get(y,V,Y,et,v);J>=D&&(D=J,L=j*d*f+H*d+it)}}}n.set(L,y,x,_,I,v)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ult(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t;be(o,"avgPool");const{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=i,h=1;W(_r(l,h),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);const d=ko(o.shape,a,l,h,c,u);let f;if(d.filterWidth===1&&d.filterHeight===1&&An(d.inShape,d.outShape))f=Ba({inputs:{x:o},backend:n});else{const p=n.data.get(o.dataId).values,m=Ie(o.shape),g=lC(p,o.shape,o.dtype,m,d,"avg");f=n.makeTensorInfo(d.outShape,o.dtype,g.values)}return f}const Wlt={kernelName:iv,backendName:"cpu",kernelFunc:Ult};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Glt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{filterSize:a,strides:l,pad:c,dimRoundingMode:u,dataFormat:h}=i;be(o,"avgPool3d");const d=Nl(o.shape,a,l,1,c,u,h),f=n.data.get(o.dataId).values,p=xL(f,o.shape,o.dtype,Ie(o.shape),d,"avg");return n.makeTensorInfo(p.shape,"float32",p.values)}const Hlt={kernelName:ov,backendName:"cpu",kernelFunc:Glt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jlt(r){const{inputs:t,backend:n,attrs:i}=r,{dy:o,input:a}=t,{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=i;be([o,a],"avgPool3DGrad");const d=Nl(a.shape,l,c,1,u,h),f=d.strideDepth,p=d.strideHeight,m=d.strideWidth,g=d.filterDepth,y=d.filterHeight,v=d.filterWidth,x=d.dilationDepth,b=d.dilationHeight,w=d.dilationWidth,S=d.effectiveFilterDepth,_=d.effectiveFilterHeight,$=d.effectiveFilterWidth,N=S-1-d.padInfo.front,k=$-1-d.padInfo.left,I=_-1-d.padInfo.top,O=rn(a.shape,"float32"),B=1/(g*y*v),F=n.bufferSync(o);for(let D=0;D<d.batchSize;++D)for(let L=0;L<d.inChannels;++L)for(let V=0;V<d.inDepth;++V)for(let j=0;j<d.inHeight;++j)for(let Y=0;Y<d.inWidth;++Y){const H=V-N,et=j-I,it=Y-k;let J=0;for(let rt=0;rt<S;rt+=x){const ut=(H+rt)/f;if(!(ut<0||ut>=d.outDepth||Math.floor(ut)!==ut))for(let vt=0;vt<_;vt+=b){const bt=(et+vt)/p;if(!(bt<0||bt>=d.outHeight||Math.floor(bt)!==bt))for(let ht=0;ht<$;ht+=w){const Wt=(it+ht)/m;if(Wt<0||Wt>=d.outWidth||Math.floor(Wt)!==Wt)continue;const Dt=F.get(D,ut,bt,Wt,L);J+=Dt}}}O.set(J*B,D,V,j,Y,L)}return n.makeTensorInfo(O.shape,O.dtype,O.values)}const qlt={kernelName:L4,backendName:"cpu",kernelFunc:jlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Klt(r){const{inputs:t,backend:n,attrs:i}=r,{dy:o,input:a}=t,l=a;be([o,a],"avgPoolGrad");const{filterSize:c,strides:u,pad:h}=i,d=ko(l.shape,c,u,1,h),f=d.strideHeight,p=d.strideWidth,m=d.filterHeight,g=d.filterWidth,y=d.dilationHeight,v=d.dilationWidth,x=d.effectiveFilterHeight,b=d.effectiveFilterWidth,w=b-1-d.padInfo.left,S=x-1-d.padInfo.top,_=rn(l.shape,"float32"),$=1/(m*g),N=n.data.get(o.dataId).values,k=rn(o.shape,"float32",N);for(let I=0;I<d.batchSize;++I)for(let O=0;O<d.inChannels;++O)for(let B=0;B<d.inHeight;++B)for(let F=0;F<d.inWidth;++F){const D=B-S,L=F-w;let V=0;for(let j=0;j<x;j+=y){const Y=(D+j)/f;if(!(Y<0||Y>=d.outHeight||Math.floor(Y)!==Y))for(let H=0;H<b;H+=v){const et=(L+H)/p;if(et<0||et>=d.outWidth||Math.floor(et)!==et)continue;const it=k.get(I,Y,et,O);V+=it}}_.set(V*$,I,B,F,O)}return n.makeTensorInfo(_.shape,_.dtype,_.values)}const Xlt={kernelName:O4,backendName:"cpu",kernelFunc:Klt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ylt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,scale:a,offset:l,mean:c,variance:u}=t;W(c.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),W(l==null||c.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),W(a==null||c.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),be([o,c,u,a,l],"batchNorm");let{varianceEpsilon:h}=i;h==null&&(h=.001);const d=n.data.get(o.dataId).values,f=n.data.get(c.dataId).values,p=n.data.get(u.dataId).values,m=a?n.data.get(a.dataId).values:new Float32Array([1]),g=l?n.data.get(l.dataId).values:new Float32Array([0]),y=new Float32Array(d.length),v=g.length,x=m.length,b=p.length,w=f.length;let S=0,_=0,$=0,N=0;for(let k=0;k<d.length;++k)y[k]=g[S++]+(d[k]-f[_++])*m[$++]/Math.sqrt(p[N++]+h),S>=v&&(S=0),_>=w&&(_=0),$>=x&&($=0),N>=b&&(N=0);return n.makeTensorInfo(o.shape,o.dtype,y)}const Zlt={kernelName:xv,backendName:"cpu",kernelFunc:Ylt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jlt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{blockShape:a,crops:l}=i;be([o],"batchToSpaceND");const c=a.reduce((x,b)=>x*b),u=Ig(o.shape,a,c),h=Eg(u.length,a.length),d=Ng(o.shape,a,c),f=yT(l,a.length),p=xT(d,l,a.length),m=qn({inputs:{x:o},backend:n,attrs:{shape:u}}),g=ni({inputs:{x:m},backend:n,attrs:{perm:h}}),y=qn({inputs:{x:g},backend:n,attrs:{shape:d}}),v=eh({inputs:{x:y},backend:n,attrs:{begin:f,size:p}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),v}const Qlt={kernelName:lv,backendName:"cpu",kernelFunc:Jlt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tct(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,weights:a}=t,{size:l}=i,c=n.data.get(o.dataId).values,u=n.data.get(a.dataId).values,h=sC(c,u,a.dtype,a.shape,l);return n.makeTensorInfo([l],a.dtype,h)}const ect={kernelName:F4,backendName:"cpu",kernelFunc:tct};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nct(r){const{inputs:t,backend:n}=r,{s0:i,s1:o}=t,a=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values,c=qe(Array.from(a),Array.from(l));return n.makeTensorInfo([c.length],"int32",Int32Array.from(c))}const sct={kernelName:cR,backendName:"cpu",kernelFunc:nct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rct=On(Lm,(r,t)=>{const n=t;return r>n.clipValueMax?n.clipValueMax:r<n.clipValueMin?n.clipValueMin:r}),ict={kernelName:Lm,backendName:"cpu",kernelFunc:rct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oct=r=>{const{x:t}=r.inputs,n=r.backend,i=new Float32Array(Nt(t.shape)),o=n.data.get(t.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,c=n.data.get(a.dataId).values,u=n.data.get(l.dataId).values;for(let h=0;h<c.length;h++){const d=c[h],f=u[h];i[h]=Math.hypot(d,f)}return n.makeOutput(i,t.shape,"float32")},act={kernelName:cv,backendName:"cpu",kernelFunc:oct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ud(r){const{inputs:t,backend:n}=r,{input:i}=t,o=n.data.get(i.dataId).complexTensorInfos.imag,a=n.data.get(o.dataId).values;return n.makeTensorInfo(o.shape,o.dtype,a)}const lct={kernelName:Q4,backendName:"cpu",kernelFunc:Ud};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wd(r){const{inputs:t,backend:n,attrs:i}=r,{axis:o}=i,a=on(o,t[0].shape)[0],l=t.map(y=>y.shape);mT(l,a);let c=Ma(t.map(y=>y.shape),a);if(Nt(c)===0)return n.makeTensorInfo(c,t[0].dtype,[]);const u=t.filter(y=>Nt(y.shape)>0);if(u.length===1)return Ba({inputs:{x:u[0]},backend:n});if(u[0].dtype==="complex64"){const y=u.map(S=>th({inputs:{input:S},backend:n})),v=u.map(S=>Ud({inputs:{input:S},backend:n})),x=Wd({inputs:y,backend:n,attrs:{axis:a}}),b=Wd({inputs:v,backend:n,attrs:{axis:a}}),w=di({inputs:{real:x,imag:b},backend:n});return y.forEach(S=>n.disposeIntermediateTensorInfo(S)),v.forEach(S=>n.disposeIntermediateTensorInfo(S)),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b),w}const h=u.map(y=>{const x=[-1,Nt(y.shape.slice(a))];return qn({inputs:{x:y},backend:n,attrs:{shape:x}})}),d=h.map(y=>({vals:n.data.get(y.dataId).values,shape:y.shape}));c=Ma(h.map(y=>y.shape),1);const f=h[0].shape[0]===1,p=k7(d,c,t[0].dtype,f),m=Ma(u.map(y=>y.shape),a),g=n.makeTensorInfo(m,t[0].dtype,p);return h.forEach(y=>n.disposeIntermediateTensorInfo(y)),g}const cct={kernelName:uv,backendName:"cpu",kernelFunc:Wd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bL(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,filter:a}=t,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d}=i;be([o,a],"conv2d");const f=Al(u),p=dr(o.shape,a.shape,l,h,c,d,!1,f),m=p.filterHeight,g=p.filterWidth,y=p.dilationHeight,v=p.dilationWidth,x=p.padInfo.left,b=p.padInfo.top,w=p.dataFormat==="channelsLast",S=new xr(p.outShape,o.dtype),_=Ie(o.shape),$=Ie(a.shape),N=_[0],k=w?_[1]:_[2],I=w?_[2]:1,O=w?1:_[1],B=S.strides[0],F=w?S.strides[1]:S.strides[2],D=w?S.strides[2]:1,L=w?1:S.strides[1],V=n.data.get(o.dataId).values,j=n.data.get(a.dataId).values,Y=S.values;for(let H=0;H<p.batchSize;++H){const et=H*N,it=H*B;for(let J=0;J<p.outHeight;++J){const rt=it+J*F,ut=J*p.strideHeight-b;for(let vt=0;vt<m;++vt){const bt=ut+vt*y;if(bt<0||bt>=p.inHeight)continue;const ht=vt*$[0],Wt=et+bt*k;for(let Dt=0;Dt<p.outWidth;++Dt){const Vt=rt+Dt*D,zt=Dt*p.strideWidth-x;for(let Jt=0;Jt<g;++Jt){const oe=zt+Jt*v;if(oe<0||oe>=p.inWidth)continue;const ne=ht+Jt*$[1],Oe=Wt+oe*I;let Ae=ne;for(let Ee=0;Ee<p.inChannels;++Ee){const We=V[Oe+Ee*O];for(let Ne=0;Ne<p.outChannels;++Ne)Y[Vt+Ne*L]+=We*j[Ae+Ne];Ae+=p.outChannels}}}}}}return n.makeTensorInfo(S.shape,S.dtype,Y)}const uct={kernelName:hv,backendName:"cpu",kernelFunc:bL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hct(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,dy:a}=t,{strides:l,pad:c,dataFormat:u,dimRoundingMode:h,filterShape:d}=i;be([o,a],"conv2dBackpropFilter");const f=Al(u),p=dr(o.shape,d,l,1,c,h,!1,f),{strideHeight:m,strideWidth:g,filterHeight:y,filterWidth:v}=p,x=p.dataFormat==="channelsLast",b=new xr(p.filterShape,"float32"),w=p.padInfo.left,S=p.padInfo.top,_=n.data.get(o.dataId).values,$=n.data.get(a.dataId).values,N=new xr(o.shape,o.dtype,_),k=new xr(a.shape,a.dtype,$);for(let I=0;I<y;++I){const O=Math.max(0,Math.ceil((S-I)/m)),B=Math.min(p.outHeight,(p.inHeight+S-I)/m);for(let F=0;F<v;++F){const D=Math.max(0,Math.ceil((w-F)/g)),L=Math.min(p.outWidth,(p.inWidth+w-F)/g);for(let V=0;V<p.inChannels;++V)for(let j=0;j<p.outChannels;++j){let Y=0;for(let H=0;H<p.batchSize;++H)for(let et=O;et<B;++et){const it=I+et*m-S;for(let J=D;J<L;++J){const rt=F+J*g-w;x?Y+=N.get(H,it,rt,V)*k.get(H,et,J,j):Y+=N.get(H,V,it,rt)*k.get(H,j,et,J)}}b.set(Y,I,F,V,j)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const dct={kernelName:B4,backendName:"cpu",kernelFunc:hct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fct(r){const{inputs:t,backend:n,attrs:i}=r,{dy:o,filter:a}=t,{inputShape:l,strides:c,pad:u,dataFormat:h,dimRoundingMode:d}=i;be([o,a],"conv2dBackpropInput");const f=Ie(a.shape),p=Ie(o.shape);let m=Al(h);const g=dr(l,a.shape,c,1,u,d,!1,m),y=new xr(g.inShape,"float32"),v=y.values,x=n.data.get(o.dataId).values,b=n.data.get(a.dataId).values,[w,S,_]=f,{batchSize:$,filterHeight:N,filterWidth:k,inChannels:I,inHeight:O,inWidth:B,outChannels:F,outHeight:D,outWidth:L,strideHeight:V,strideWidth:j}=g;m=g.dataFormat;const Y=N-1-g.padInfo.top,H=k-1-g.padInfo.left,et=m==="channelsLast",it=y.strides[0],J=et?y.strides[1]:y.strides[2],rt=et?y.strides[2]:1,ut=et?1:y.strides[1],vt=p[0],bt=et?p[1]:p[2],ht=et?p[2]:1,Wt=et?1:p[1];for(let Dt=0;Dt<$;++Dt)for(let Vt=0;Vt<I;++Vt)for(let zt=0;zt<O;++zt){const Jt=zt-Y,oe=Math.max(0,Math.ceil(Jt/V)),ne=Math.min(D,(N+Jt)/V);for(let Oe=0;Oe<B;++Oe){const Ae=Oe-H,Ee=Math.max(0,Math.ceil(Ae/j)),We=Math.min(L,(k+Ae)/j);let Ne=0;for(let yn=oe;yn<ne;++yn){const Qe=yn*V-Jt;for(let Z=Ee;Z<We;++Z){const G=Z*j-Ae,Et=vt*Dt+bt*yn+ht*Z,jt=w*(N-1-Qe)+S*(k-1-G)+_*Vt;for(let qt=0;qt<F;++qt){const te=x[Et+Wt*qt],ye=b[jt+qt];Ne+=te*ye}}}const Le=it*Dt+J*zt+rt*Oe+ut*Vt;v[Le]=Ne}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const pct={kernelName:dv,backendName:"cpu",kernelFunc:fct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mct(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,filter:a}=t,{strides:l,pad:c,dilations:u}=i;be([o,a],"conv3d");const h=Pc(o.shape,a.shape,l,u,c),{filterDepth:d,filterHeight:f,filterWidth:p,dilationDepth:m,dilationHeight:g,dilationWidth:y,padInfo:v}=h,x=v.front,b=v.left,w=v.top,S=new xr(h.outShape,o.dtype),_=n.data.get(o.dataId).values,$=n.data.get(a.dataId).values,N=S.values,k=Ie(o.shape),I=Ie(a.shape);for(let O=0;O<h.batchSize;++O){const B=O*k[0],F=O*S.strides[0];for(let D=0;D<h.outDepth;++D){const L=F+D*S.strides[1],V=D*h.strideDepth-x;for(let j=0;j<d;++j){const Y=V+j*m;if(Y<0||Y>=h.inDepth)continue;const H=j*I[0],et=B+Y*k[1];for(let it=0;it<h.outHeight;++it){const J=L+it*S.strides[2],rt=it*h.strideHeight-w;for(let ut=0;ut<f;++ut){const vt=rt+ut*g;if(vt<0||vt>=h.inHeight)continue;const bt=H+ut*I[1],ht=et+vt*k[2];for(let Wt=0;Wt<h.outWidth;++Wt){const Dt=J+Wt*h.outChannels,Vt=Wt*h.strideWidth-b;for(let zt=0;zt<p;++zt){const Jt=Vt+zt*y;if(Jt<0||Jt>=h.inWidth)continue;const oe=bt+zt*I[2],ne=ht+Jt*h.inChannels;let Oe=oe;for(let Ae=0;Ae<h.inChannels;++Ae){const Ee=_[ne+Ae];for(let We=0;We<h.outChannels;++We)N[Dt+We]+=Ee*$[Oe+We];Oe+=h.outChannels}}}}}}}}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const gct={kernelName:fv,backendName:"cpu",kernelFunc:mct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vct(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,dy:a}=t,{strides:l,pad:c,filterShape:u}=i;be([o,a],"conv3dBackpropFilterV2");const h=Ie(o.shape),d=Ie(a.shape),f=Pc(o.shape,u,l,1,c),p=f.strideDepth,m=f.strideHeight,g=f.strideWidth,y=f.filterDepth,v=f.filterHeight,x=f.filterWidth,b=new xr(f.filterShape,"float32"),w=b.values,[S,_,$,N]=b.strides,k=n.data.get(a.dataId).values,[I,O,B,F]=d,D=n.data.get(o.dataId).values,[L,V,j,Y]=h,H=f.padInfo.front,et=f.padInfo.left,it=f.padInfo.top;for(let J=0;J<y;++J){const rt=Math.max(0,Math.ceil((H-J)/p)),ut=Math.min(f.outDepth,(f.inDepth+H-J)/p),vt=J*S;for(let bt=0;bt<v;++bt){const ht=Math.max(0,Math.ceil((it-bt)/m)),Wt=Math.min(f.outHeight,(f.inHeight+it-bt)/m),Dt=bt*_+vt;for(let Vt=0;Vt<x;++Vt){const zt=Math.max(0,Math.ceil((et-Vt)/g)),Jt=Math.min(f.outWidth,(f.inWidth+et-Vt)/g),oe=Vt*$+Dt;for(let ne=0;ne<f.inChannels;++ne){const Oe=ne*N+oe;for(let Ae=0;Ae<f.outChannels;++Ae){let Ee=0;for(let We=0;We<f.batchSize;++We){const Ne=We*L,Le=We*I;for(let yn=rt;yn<ut;++yn){const Z=(J+yn*p-H)*V+Ne,G=yn*O+Le;for(let Et=ht;Et<Wt;++Et){const qt=(bt+Et*m-it)*j+Z,te=Et*B+G;for(let ye=zt;ye<Jt;++ye){const Lt=(Vt+ye*g-et)*Y+qt,ke=ye*F+te;Ee+=D[Lt+ne]*k[ke+Ae]}}}}w[Oe+Ae]=Ee}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const yct={kernelName:z4,backendName:"cpu",kernelFunc:vct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xct(r){const{inputs:t,backend:n,attrs:i}=r,{dy:o,filter:a}=t,{pad:l,strides:c,inputShape:u}=i;be([o],"conv3dBackpropInputV2");const h=Ie(o.shape),d=Ie(a.shape),f=Pc(u,a.shape,c,1,l),p=new xr(f.inShape,"float32"),m=p.values,[g,y,v,x]=p.strides,b=n.data.get(o.dataId).values,[w,S,_,$]=h,N=n.data.get(a.dataId).values,[k,I,O,B]=d,{batchSize:F,filterDepth:D,filterHeight:L,filterWidth:V,inChannels:j,inDepth:Y,inHeight:H,inWidth:et,outChannels:it,outDepth:J,outHeight:rt,outWidth:ut,strideDepth:vt,strideHeight:bt,strideWidth:ht}=f,Wt=D-1-f.padInfo.front,Dt=L-1-f.padInfo.top,Vt=V-1-f.padInfo.left;for(let zt=0;zt<F;++zt)for(let Jt=0;Jt<j;++Jt)for(let oe=0;oe<Y;++oe){const ne=oe-Wt,Oe=Math.max(0,Math.ceil(ne/vt)),Ae=Math.min(J,(D+ne)/vt);for(let Ee=0;Ee<H;++Ee){const We=Ee-Dt,Ne=Math.max(0,Math.ceil(We/bt)),Le=Math.min(rt,(L+We)/bt);for(let yn=0;yn<et;++yn){const Qe=yn-Vt,Z=Math.max(0,Math.ceil(Qe/ht)),G=Math.min(ut,(V+Qe)/ht);let Et=0;for(let jt=Oe;jt<Ae;++jt){const qt=jt*vt-ne;for(let te=Ne;te<Le;++te){const ye=te*bt-We;for(let se=Z;se<G;++se){const Lt=se*ht-Qe,ke=w*zt+S*jt+_*te+$*se,Me=k*(D-1-qt)+I*(L-1-ye)+O*(V-1-Lt)+B*Jt;for(let xe=0;xe<it;++xe){const ge=b[ke+xe],ae=N[Me+xe];Et+=ge*ae}}}}m[g*zt+y*oe+v*Ee+x*yn+Jt]=Et}}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const bct={kernelName:V4,backendName:"cpu",kernelFunc:xct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wct=On(Fm,r=>Math.cos(r)),Sct={kernelName:Fm,backendName:"cpu",kernelFunc:wct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ct=On(Pm,r=>Math.cosh(r)),Tct={kernelName:Pm,backendName:"cpu",kernelFunc:_ct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cct(r){const{inputs:t,backend:n,attrs:i}=r,{image:o,boxes:a,boxInd:l}=t,{cropSize:c,method:u,extrapolationValue:h}=i,[d,f,p,m]=o.shape,g=a.shape[0],[y,v]=c,x=rn([g,y,v,m],"float32"),b=n.data.get(a.dataId).values,w=n.data.get(l.dataId).values,S=n.data.get(o.dataId).values,_=Ie(o.shape),$=Ie(x.shape);for(let N=0;N<g;N++){const k=N*4,I=b[k],O=b[k+1],B=b[k+2],F=b[k+3],D=w[N];if(D>=d)continue;const L=y>1?(B-I)*(f-1)/(y-1):0,V=v>1?(F-O)*(p-1)/(v-1):0;for(let j=0;j<y;j++){const Y=y>1?I*(f-1)+j*L:.5*(I+B)*(f-1);if(Y<0||Y>f-1){for(let H=0;H<v;H++)for(let et=0;et<m;et++){const it=et+H*$[2]+j*$[1]+N*$[0];x.values[it]=h}continue}if(u==="bilinear"){const H=Math.floor(Y),et=Math.ceil(Y),it=Y-H;for(let J=0;J<v;J++){const rt=v>1?O*(p-1)+J*V:.5*(O+F)*(p-1);if(rt<0||rt>p-1){for(let ht=0;ht<m;ht++){const Wt=ht+J*$[2]+j*$[1]+N*$[0];x.values[Wt]=h}continue}const ut=Math.floor(rt),vt=Math.ceil(rt),bt=rt-ut;for(let ht=0;ht<m;ht++){let Wt=ht+ut*_[2]+H*_[1]+D*_[0];const Dt=S[Wt];Wt=ht+vt*_[2]+H*_[1]+D*_[0];const Vt=S[Wt];Wt=ht+ut*_[2]+et*_[1]+D*_[0];const zt=S[Wt];Wt=ht+vt*_[2]+et*_[1]+D*_[0];const Jt=S[Wt],oe=Dt+(Vt-Dt)*bt,ne=zt+(Jt-zt)*bt;Wt=ht+J*$[2]+j*$[1]+N*$[0],x.values[Wt]=oe+(ne-oe)*it}}}else for(let H=0;H<v;++H){const et=v>1?O*(p-1)+H*V:.5*(O+F)*(p-1);if(et<0||et>p-1){for(let rt=0;rt<m;rt++){const ut=rt+H*$[2]+j*$[1]+N*$[0];x.values[ut]=h}continue}const it=Math.round(et),J=Math.round(Y);for(let rt=0;rt<m;rt++){const ut=rt+it*_[2]+J*_[1]+D*_[0],vt=rt+H*$[2]+j*$[1]+N*$[0];x.values[vt]=S[ut]}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const kct={kernelName:W4,backendName:"cpu",kernelFunc:Cct};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ct(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a,exclusive:l,reverse:c}=i;be(o,"cumprod");const u=ms([a],o.shape.length);let h=o;u!=null&&(h=ni({inputs:{x:o},backend:n,attrs:{perm:u}}));const d=_s(1,o.shape.length)[0];if(d!==h.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${h.shape.length-1} but got axis=${d}`);const f=gi(h.dtype,"int32"),p=N4(Nt(h.shape),f),m=n.data.get(h.dataId).values,g=h.shape[h.shape.length-1],y=c?(x,b)=>x+g-b-1:(x,b)=>x+b;for(let x=0;x<m.length;x+=g)for(let b=0;b<g;b++){const w=y(x,b);if(b===0)p[w]=l?1:m[w];else{const S=y(x,b-1);p[w]=l?m[S]*p[S]:m[w]*p[S]}}const v=n.makeTensorInfo(h.shape,f,p);if(u!=null){const x=Bc(u),b=ni({inputs:{x:v},backend:n,attrs:{perm:x}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(h),b}return v}const Ict={kernelName:U4,backendName:"cpu",kernelFunc:$ct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ect(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a,exclusive:l,reverse:c}=i;be(o,"cumsum");const u=ms([a],o.shape.length);let h=o;u!=null&&(h=ni({inputs:{x:o},backend:n,attrs:{perm:u}}));const d=_s(1,o.shape.length)[0];if(d!==h.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${h.shape.length-1} but got axis=${d}`);const f=gi(h.dtype,"int32"),p=Sr(Nt(h.shape),f),m=n.data.get(h.dataId).values,g=h.shape[h.shape.length-1],y=c?(x,b)=>x+g-b-1:(x,b)=>x+b;for(let x=0;x<m.length;x+=g)for(let b=0;b<g;b++){const w=y(x,b);if(b===0)p[w]=l?0:m[w];else{const S=y(x,b-1);p[w]=l?m[S]+p[S]:m[w]+p[S]}}const v=n.makeTensorInfo(h.shape,f,p);if(u!=null){const x=Bc(u),b=ni({inputs:{x:v},backend:n,attrs:{perm:x}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(h),b}return v}const Nct={kernelName:pv,backendName:"cpu",kernelFunc:Ect};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Act(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,weights:a}=t,{size:l,binaryOutput:c}=i;if(o.shape.length===1){const u=n.data.get(o.dataId).values,h=n.data.get(a.dataId).values,d=sC(u,h,a.dtype,a.shape,l);return n.makeTensorInfo([l],a.dtype,d)}else if(o.shape.length===2){const u=n.bufferSync(o),h=n.bufferSync(a),d=T7(u,h,l,c);return n.makeTensorInfo(d.shape,a.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}const Mct={kernelName:G4,backendName:"cpu",kernelFunc:Act};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dct(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{blockSize:a,dataFormat:l}=i;W(l==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${l}`);const c=o.shape[0],u=o.shape[1],h=o.shape[2],d=o.shape[3],f=u*a,p=h*a,m=d/(a*a),g=n.data.get(o.dataId).values,y=new Float32Array(c*f*p*m);let v=0;for(let x=0;x<c;++x)for(let b=0;b<f;++b){const w=Math.floor(b/a),S=b%a;for(let _=0;_<p;++_){const $=Math.floor(_/a),N=_%a,k=(S*a+N)*m;for(let I=0;I<m;++I){const B=I+k+d*($+h*(w+u*x));y[v++]=g[B]}}}return n.makeTensorInfo([c,f,p,m],o.dtype,y)}const Rct={kernelName:H4,backendName:"cpu",kernelFunc:Dct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wL(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,filter:a}=t,{strides:l,pad:c,dilations:u,dimRoundingMode:h}=i;be([o,a],"depthwiseConv2DNative");const d=Ie(o.shape),f=Ie(a.shape);let p=u;p==null&&(p=[1,1]),W(_r(l,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${p}'`);const m=dr(o.shape,a.shape,l,p,c,h,!0),{filterHeight:g,filterWidth:y,dilationHeight:v,dilationWidth:x,padInfo:b}=m,w=b.left,S=b.top,_=m.outChannels/m.inChannels,$=new xr(m.outShape,o.dtype),N=n.data.get(o.dataId).values,k=n.data.get(a.dataId).values,I=$.values;for(let O=0;O<m.batchSize;++O){const B=O*d[0],F=O*$.strides[0];for(let D=0;D<m.outHeight;++D){const L=F+D*$.strides[1],V=D*m.strideHeight-S;for(let j=0;j<g;++j){const Y=V+j*v;if(Y<0||Y>=m.inHeight)continue;const H=j*f[0],et=B+Y*d[1];for(let it=0;it<m.outWidth;++it){const J=L+it*$.strides[2],rt=it*m.strideWidth-w;for(let ut=0;ut<y;++ut){const vt=rt+ut*x;if(vt<0||vt>=m.inWidth)continue;const bt=H+ut*f[1],ht=et+vt*m.inChannels;let Wt=J,Dt=bt;for(let Vt=0;Vt<m.inChannels;++Vt){const zt=N[ht+Vt];for(let Jt=0;Jt<_;++Jt)I[Wt+Jt]+=zt*k[Dt+Jt];Wt+=_,Dt+=_}}}}}}return n.makeTensorInfo($.shape,$.dtype,$.values)}const Oct={kernelName:mv,backendName:"cpu",kernelFunc:wL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lct(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,dy:a}=t,{strides:l,dilations:c,pad:u,dimRoundingMode:h,filterShape:d}=i;be([o,a],"depthwiseConv2dNativeBackpropFilter");const f=dr(o.shape,d,l,c,u,h,!0),{strideHeight:p,strideWidth:m,filterHeight:g,filterWidth:y}=f,v=new xr(f.filterShape,"float32"),x=f.padInfo.left,b=f.padInfo.top,w=f.outChannels/f.inChannels,S=n.data.get(o.dataId).values,_=new xr(o.shape,o.dtype,S),$=n.data.get(a.dataId).values,N=new xr(a.shape,a.dtype,$);for(let k=0;k<g;++k){const I=Math.max(0,Math.ceil((b-k)/p)),O=Math.min(f.outHeight,(f.inHeight+b-k)/p);for(let B=0;B<y;++B){const F=Math.max(0,Math.ceil((x-B)/m)),D=Math.min(f.outWidth,(f.inWidth+x-B)/m);for(let L=0;L<f.outChannels;++L){const V=Math.trunc(L/w),j=L%w;let Y=0;for(let H=0;H<f.batchSize;++H)for(let et=I;et<O;++et){const it=k+et*p-b;for(let J=F;J<D;++J){const rt=B+J*m-x;Y+=_.get(H,it,rt,V)*N.get(H,et,J,L)}}v.set(Y,k,B,V,j)}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const Fct={kernelName:j4,backendName:"cpu",kernelFunc:Lct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pct(r){const{inputs:t,backend:n,attrs:i}=r,{dy:o,filter:a}=t,{strides:l,dilations:c,pad:u,dimRoundingMode:h,inputShape:d}=i;be([o,a],"depthwiseConv2DNativeBackpropInput");const f=Ie(o.shape),p=Ie(a.shape),m=dr(d,a.shape,l,c,u,h,!0),g=new xr(m.inShape,"float32"),y=g.values,[v,x,b]=g.strides,w=n.data.get(o.dataId).values,[S,_,$]=f,N=n.data.get(a.dataId).values,[k,I,O]=p,{batchSize:B,filterHeight:F,filterWidth:D,inChannels:L,inHeight:V,inWidth:j,outChannels:Y,outHeight:H,outWidth:et,strideHeight:it,strideWidth:J}=m,rt=F-1-m.padInfo.top,ut=D-1-m.padInfo.left,vt=Y/L;for(let bt=0;bt<B;++bt)for(let ht=0;ht<L;++ht)for(let Wt=0;Wt<V;++Wt){const Dt=Wt-rt,Vt=Math.max(0,Math.ceil(Dt/it)),zt=Math.min(H,(F+Dt)/it);for(let Jt=0;Jt<j;++Jt){const oe=Jt-ut,ne=Math.max(0,Math.ceil(oe/J)),Oe=Math.min(et,(D+oe)/J);let Ae=0;for(let Ee=Vt;Ee<zt;++Ee){const We=Ee*it-Dt;for(let Ne=ne;Ne<Oe;++Ne){const Le=Ne*J-oe,yn=S*bt+_*Ee+$*Ne,Qe=k*(F-1-We)+I*(D-1-Le)+O*ht;for(let Z=0;Z<vt;++Z){const G=ht*vt+Z,Et=w[yn+G],jt=N[Qe+Z];Ae+=Et*jt}}}y[v*bt+x*Wt+b*Jt+ht]=Ae}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const Bct={kernelName:q4,backendName:"cpu",kernelFunc:Pct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zct(r){const{inputs:t,backend:n}=r,{x:i}=t,o=Nt(i.shape),a=n.data.get(i.dataId).values,l=rn([o,o],i.dtype),c=l.values;for(let h=0;h<a.length;h++)c[h*o+h]=a[h];const u=[...i.shape,...i.shape];return n.makeTensorInfo(u,l.dtype,l.values)}const Vct={kernelName:uR,backendName:"cpu",kernelFunc:zct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uct={kernelName:gv,backendName:"cpu",kernelFunc:({inputs:r,backend:t,attrs:n})=>{const{x:i,filter:o}=r,{strides:a,pad:l,dilations:c}=n,u=t,h=u.data.get(i.dataId).values,d=i.shape.length,f=u.data.get(o.dataId).values,p=o.shape.length,{batchSize:m,inHeight:g,inWidth:y,inChannels:v,outHeight:x,outWidth:b,padInfo:w,strideHeight:S,strideWidth:_,filterHeight:$,filterWidth:N,dilationHeight:k,dilationWidth:I,outShape:O}=_g(i.shape,o.shape,a,l,"NHWC",c),B=Nt(O),F=O.length,D=ks(i.dtype,B);for(let V=0;V<m;++V)for(let j=0;j<x;++j){const Y=j*S-w.top;for(let H=0;H<b;++H){const et=H*_-w.left;for(let it=0;it<v;++it){let J=Number.MIN_SAFE_INTEGER;for(let ut=0;ut<$;++ut){const vt=Y+ut*k;if(vt>=0&&vt<g)for(let bt=0;bt<N;++bt){const ht=et+bt*I;if(ht>=0&&ht<y){const Wt=Na([V,vt,ht,it],d,Ie(i.shape)),Dt=Na([ut,bt,it],p,Ie(o.shape)),Vt=h[Wt]+f[Dt];Vt>J&&(J=Vt)}}}const rt=Na([V,j,H,it],F,Ie(O));D[rt]=J}}}return{dataId:u.write(xh(D,i.dtype),O,i.dtype),shape:O,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wct={kernelName:F3,backendName:"cpu",kernelFunc:({inputs:r,backend:t,attrs:n})=>{const{x:i,filter:o,dy:a}=r,{strides:l,pad:c,dilations:u}=n,h=t,d=qo(i.shape,h.data.get(i.dataId).values),f=qo(o.shape,h.data.get(o.dataId).values),{batchSize:p,inHeight:m,inWidth:g,inChannels:y,outHeight:v,outWidth:x,padInfo:b,strideHeight:w,strideWidth:S,filterHeight:_,filterWidth:$,dilationHeight:N,dilationWidth:k,outShape:I}=_g(i.shape,o.shape,l,c,"NHWC",u);W(a.rank===I.length,()=>`Error in ${F3}, dy must have the same rank as output ${I.length}, but got ${a.rank}`);const O=qo(I,h.data.get(a.dataId).values),B=iR(o.shape,o.dtype);for(let D=0;D<p;++D)for(let L=0;L<v;++L){const V=L*w-b.top;for(let j=0;j<x;++j){const Y=j*S-b.left;for(let H=0;H<y;++H){let et=Number.MIN_SAFE_INTEGER,it=0,J=0;for(let rt=0;rt<_;++rt){const ut=V+rt*N;if(ut>=0&&ut<m)for(let vt=0;vt<$;++vt){const bt=Y+vt*k;if(bt>=0&&bt<g){const ht=d[D][ut][bt][H]+f[rt][vt][H];ht>et&&(et=ht,it=rt,J=vt)}}}B[it][J][H]+=O[D][L][j][H]}}}return{dataId:h.write(xh(B,i.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gct={kernelName:L3,backendName:"cpu",kernelFunc:({inputs:r,backend:t,attrs:n})=>{const{x:i,filter:o,dy:a}=r,{strides:l,pad:c,dilations:u}=n,h=t,d=qo(i.shape,h.data.get(i.dataId).values),f=qo(o.shape,h.data.get(o.dataId).values),{batchSize:p,inHeight:m,inWidth:g,inChannels:y,outHeight:v,outWidth:x,padInfo:b,strideHeight:w,strideWidth:S,filterHeight:_,filterWidth:$,dilationHeight:N,dilationWidth:k,outShape:I}=_g(i.shape,o.shape,l,c,"NHWC",u);W(a.rank===I.length,()=>`Error in ${L3}, dy must have the same rank as output ${I.length}, but got ${a.rank}`);const O=qo(I,h.data.get(a.dataId).values),B=iR(i.shape,i.dtype);for(let D=0;D<p;++D)for(let L=0;L<v;++L){const V=L*w-b.top;for(let j=0;j<x;++j){const Y=j*S-b.left;for(let H=0;H<y;++H){let et=Number.MIN_SAFE_INTEGER,it=V<0?0:V,J=Y<0?0:Y;for(let rt=0;rt<_;++rt){const ut=V+rt*N;if(ut>=0&&ut<m)for(let vt=0;vt<$;++vt){const bt=Y+vt*k;if(bt>=0&&bt<g){const ht=d[D][ut][bt][H]+f[rt][vt][H];ht>et&&(et=ht,it=ut,J=bt)}}}B[D][it][J][H]+=O[D][L][j][H]}}}return{dataId:h.write(xh(B,i.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fg(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a,keepDims:l}=i;be(o,"sum");let c;o.dtype==="bool"?c=Ic({inputs:{x:o},backend:n,attrs:{dtype:"int32"}}):c=Ba({inputs:{x:o},backend:n});const u=c.shape.length,h=on(a,c.shape),d=ms(h,u);let f=h,p=c;d!=null&&(p=ni({inputs:{x:c},backend:n,attrs:{perm:d}}),f=_s(f.length,u)),fr("sum",f,p.shape.length);const[m,g]=Zs(p.shape,f),y=gi(p.dtype,"int32");let v=x2(n,m,y);const x=Nt(g),b=n.data.get(v.dataId).values,w=n.data.get(p.dataId).values;for(let S=0;S<b.length;++S){const _=S*x;let $=0;for(let N=0;N<x;++N)$+=w[_+N];b[S]=$}if(l){const S=Ss(v.shape,h),_=v;v=qn({inputs:{x:v},backend:n,attrs:{shape:S}}),n.disposeIntermediateTensorInfo(_)}return n.disposeIntermediateTensorInfo(c),d!=null&&n.disposeIntermediateTensorInfo(p),v}const Hct={kernelName:Xv,backendName:"cpu",kernelFunc:Fg};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jct(r){const{inputs:t,backend:n,attrs:i}=r,{equation:o}=i,a=t,{allDims:l,summedDims:c,idDims:u}=$T(o,a.length);ET(l.length,u,a);const{path:h,steps:d}=NT(c,u),f=d.length;let p=null,m=l.length;const g=[];for(let y=0;y<f;++y){for(const v of d[y]){const{permutationIndices:x,expandDims:b}=IT(m,u[v]);let w;AT(x)?w=a[v]:(w=ni({inputs:{x:a[v]},backend:n,attrs:{perm:x}}),g.push(w));const S=w.shape.slice();for(let _=0;_<b.length;++_)S.splice(b[_],0,1);An(w.shape,S)||(w=qn({inputs:{x:w},backend:n,attrs:{shape:S}}),g.push(w)),p===null?p=w:(p=Ny({inputs:{a:w,b:p},backend:n}),g.push(p))}y<f-1&&(h[y]>=0&&(p=Fg({inputs:{x:p},backend:n,attrs:{axis:h[y]-(l.length-m),keepDims:!1}}),g.push(p)),m--)}for(const y of g)y!==p&&n.disposeIntermediateTensorInfo(y);return p}const qct={kernelName:hR,backendName:"cpu",kernelFunc:jct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kct(r){const{inputs:t,backend:n}=r,{dy:i,y:o}=t;be([i,o],"eluGrad");const a=new Float32Array(Nt(o.shape)),l=n.data.get(o.dataId).values,c=n.data.get(i.dataId).values;for(let u=0;u<l.length;++u){const h=l[u];h>=1?a[u]=c[u]:a[u]=c[u]*(h+1)}return n.makeTensorInfo(o.shape,"float32",a)}const Xct={kernelName:K4,backendName:"cpu",kernelFunc:Kct};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yct=bT,Zct=wT,Jct=ST,Qct=_T,tut=TT,eut=CT,nut=On(Vm,r=>{const t=Math.sign(r),n=Math.abs(r),i=1/(1+Yct*n);return t*(1-((((eut*i+tut)*i+Qct)*i+Jct)*i+Zct)*i*Math.exp(-n*n))}),sut={kernelName:Vm,backendName:"cpu",kernelFunc:nut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S2(r){const{inputs:t,backend:n,attrs:i}=r,{input:o}=t,{dim:a}=i,l=o.shape.length,c=o.shape.slice();let u=a;return a<0&&(W(-(l+1)<=a,()=>`Axis must be in the interval [${-(l+1)}, ${l}]`),u=l+a+1),c.splice(u,0,1),qn({inputs:{x:o},backend:n,attrs:{shape:c}})}const rut={kernelName:yv,backendName:"cpu",kernelFunc:S2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iut=Is((r,t)=>r/t),cC=Js(Bm,iut),xw={kernelName:Bm,backendName:"cpu",kernelFunc:cC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SL(r,t,n){const i=r.shape,o=i[0],a=i[1],l=n.data.get(r.dataId),c=l.complexTensorInfos.real,u=l.complexTensorInfos.imag,h=[o,a],d=Nt(h),f=hr("float32",d),p=hr("float32",d);for(let v=0;v<o;v++){const x=eh({inputs:{x:c},backend:n,attrs:{begin:[v,0],size:[1,a]}}),b=eh({inputs:{x:u},backend:n,attrs:{begin:[v,0],size:[1,a]}}),w=di({inputs:{real:x,imag:b},backend:n}),{real:S,imag:_}=out(w,t,n),$=Sl(S,_);for(let N=0;N<a;N++){const k=kT($,N);f[v*a+N]=k.real,p[v*a+N]=k.imag}n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(w)}const m=n.makeTensorInfo(h,"float32",f),g=n.makeTensorInfo(h,"float32",p),y=di({inputs:{real:m,imag:g},backend:n});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),y}function out(r,t,n){const i=Nt(r.shape),o=n.data.get(r.dataId),a=n.data.get(o.complexTensorInfos.real.dataId).values,l=n.data.get(o.complexTensorInfos.imag.dataId).values;if(aut(i)){const c=bw(a,l,i,t,n),u=[r.shape[0],r.shape[1]];if(t){const h=n.makeTensorInfo(u,"float32",c.real),d=n.makeTensorInfo(u,"float32",c.imag),f=n.makeTensorInfo([],"float32",Fc(i,"float32")),p=Ba({inputs:{x:f},backend:n}),m=xw.kernelFunc({inputs:{a:h,b:f},backend:n}),g=xw.kernelFunc({inputs:{a:d,b:p},backend:n}),y=n.data.get(m.dataId).values,v=n.data.get(g.dataId).values;return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),{real:y,imag:v}}return c}else{const c=Sl(a,l),u=lut(c,i,t);return W9(u)}}function aut(r){return(r&r-1)===0}function bw(r,t,n,i,o){if(n===1)return{real:r,imag:t};const a=Sl(r,t),l=n/2,c=G9(a),u=c.real,h=c.imag,d=[u.length],f=o.makeTensorInfo(d,"float32",u),p=o.makeTensorInfo(d,"float32",h),m=di({inputs:{real:f,imag:p},backend:o}),g=H9(a),y=g.real,v=g.imag,x=[y.length],b=o.makeTensorInfo(x,"float32",y),w=o.makeTensorInfo(x,"float32",v),S=di({inputs:{real:b,imag:w},backend:o}),_=bw(u,h,l,i,o),$=_.real,N=_.imag,k=[$.length],I=o.makeTensorInfo(k,"float32",$),O=o.makeTensorInfo(k,"float32",N),B=di({inputs:{real:I,imag:O},backend:o}),F=bw(y,v,l,i,o),D=F.real,L=F.imag,V=[D.length],j=o.makeTensorInfo(V,"float32",D),Y=o.makeTensorInfo(V,"float32",L),H=di({inputs:{real:j,imag:Y},backend:o}),et=q9(n,i),it=[et.real.length],J=o.makeTensorInfo(it,"float32",et.real),rt=o.makeTensorInfo(it,"float32",et.imag),ut=di({inputs:{real:J,imag:rt},backend:o}),vt=Ny({inputs:{a:ut,b:H},backend:o}),bt=Vd({inputs:{a:B,b:vt},backend:o}),ht=aC({inputs:{a:B,b:vt},backend:o}),Wt=th({inputs:{input:bt},backend:o}),Dt=th({inputs:{input:ht},backend:o}),Vt=Ud({inputs:{input:bt},backend:o}),zt=Ud({inputs:{input:ht},backend:o}),Jt=Wd({inputs:[Wt,Dt],backend:o,attrs:{axis:0}}),oe=Wd({inputs:[Vt,zt],backend:o,attrs:{axis:0}}),ne=o.data.get(Jt.dataId).values,Oe=o.data.get(oe.dataId).values;return o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(p),o.disposeIntermediateTensorInfo(m),o.disposeIntermediateTensorInfo(b),o.disposeIntermediateTensorInfo(w),o.disposeIntermediateTensorInfo(S),o.disposeIntermediateTensorInfo(I),o.disposeIntermediateTensorInfo(O),o.disposeIntermediateTensorInfo(B),o.disposeIntermediateTensorInfo(j),o.disposeIntermediateTensorInfo(Y),o.disposeIntermediateTensorInfo(H),o.disposeIntermediateTensorInfo(J),o.disposeIntermediateTensorInfo(rt),o.disposeIntermediateTensorInfo(ut),o.disposeIntermediateTensorInfo(vt),o.disposeIntermediateTensorInfo(bt),o.disposeIntermediateTensorInfo(ht),o.disposeIntermediateTensorInfo(Wt),o.disposeIntermediateTensorInfo(Vt),o.disposeIntermediateTensorInfo(Dt),o.disposeIntermediateTensorInfo(zt),o.disposeIntermediateTensorInfo(Jt),o.disposeIntermediateTensorInfo(oe),{real:ne,imag:Oe}}function lut(r,t,n){const i=new Float32Array(t*2);for(let o=0;o<t;o++){let a=0,l=0;for(let c=0;c<t;c++){const u=K9(o*c,t,n),h=kT(r,c);a+=h.real*u.real-h.imag*u.imag,l+=h.real*u.imag+h.imag*u.real}n&&(a/=t,l/=t),j9(i,a,l,o)}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cut(r){const{inputs:t,backend:n}=r,{input:i}=t,o=Nt(i.shape),a=i.shape[i.shape.length-1],l=o/a,c=qn({inputs:{x:i},backend:n,attrs:{shape:[l,a]}}),u=SL(c,!1,n),h=qn({inputs:{x:u},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),h}const uut={kernelName:X4,backendName:"cpu",kernelFunc:cut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uC(r){const{backend:t,attrs:n}=r,{shape:i,value:o,dtype:a}=n,l=a||km(o),c=ks(l,Nt(i));return dut(c,o,l),t.makeTensorInfo(i,l,c)}const hut={kernelName:Y4,backendName:"cpu",kernelFunc:uC};function dut(r,t,n){r.fill(t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fut={kernelName:Z4,backendName:"cpu",kernelFunc:({inputs:r,attrs:t,backend:n})=>{const{image:i}=r,o=n,a=hr(i.dtype,Nt(i.shape)),[l,c,u,h]=i.shape,d=o.data.get(i.dataId).values;for(let p=0;p<l;p++){const m=p*u*c*h;for(let g=0;g<c;g++){const y=g*(u*h);for(let v=0;v<u;v++){const x=v*h;for(let b=0;b<h;b++){const w=Math.round(u-v-1),S=m+y+x+b;let _=d[S];if(w>=0&&w<u){const $=w*h,N=m+y+$+b;_=d[N]}a[S]=_}}}}return{dataId:o.write(a,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const put=Is((r,t)=>Math.floor(r/t)),mut=Js(Hm,put,null,"int32"),gut={kernelName:Hm,backendName:"cpu",kernelFunc:mut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vut(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,filter:a,bias:l,preluActivationWeights:c}=t,{strides:u,pad:h,dataFormat:d,dilations:f,dimRoundingMode:p,activation:m,leakyreluAlpha:g}=i;let y=bL({inputs:{x:o,filter:a},backend:n,attrs:{strides:u,pad:h,dataFormat:d,dilations:f,dimRoundingMode:p}});if(l){const v=y;if(d==="NCHW"&&l.shape.length===1&&l.shape[0]!==1){const x=qn({inputs:{x:l},backend:n,attrs:{shape:[l.shape[0],1,1]}});y=Vd({inputs:{a:y,b:x},backend:n}),n.disposeIntermediateTensorInfo(x)}else y=Vd({inputs:{a:y,b:l},backend:n});n.disposeIntermediateTensorInfo(v)}if(m){const v=y;if(d==="NCHW"&&m==="prelu"&&c.shape.length===1&&c.shape[0]!==1){const x=qn({inputs:{x:c},backend:n,attrs:{shape:[c.shape[0],1,1]}});y=w2(n,y,m,x,g),n.disposeIntermediateTensorInfo(x)}else y=w2(n,y,m,c,g);n.disposeIntermediateTensorInfo(v)}return y}const yut={kernelName:n2,backendName:"cpu",kernelFunc:vut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xut(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,filter:a,bias:l,preluActivationWeights:c}=t,{strides:u,pad:h,dataFormat:d,dilations:f,dimRoundingMode:p,activation:m,leakyreluAlpha:g}=i;let y=wL({inputs:{x:o,filter:a},backend:n,attrs:{strides:u,pad:h,dataFormat:d,dilations:f,dimRoundingMode:p}});if(l){const v=y;y=Vd({inputs:{a:y,b:l},backend:n}),n.disposeIntermediateTensorInfo(v)}if(m){const v=y;y=w2(n,y,m,c,g),n.disposeIntermediateTensorInfo(v)}return y}const but={kernelName:SR,backendName:"cpu",kernelFunc:xut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wut(r){const{inputs:t,backend:n}=r,{params:i,indices:o}=t,a=Nt(i.shape),l=o.shape,c=l[l.length-1],[u,h,d,f]=I_(i,o);if(h===0)return n.makeTensorInfo(u,i.dtype,[]);const p=n.data.get(o.dataId).values,m=n.bufferSync(i),g=D7(p,m,i.dtype,h,c,d,f,i.shape,a);return n.makeTensorInfo(u,i.dtype,g.values)}const Sut={kernelName:dR,backendName:"cpu",kernelFunc:wut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ut(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,indices:a}=t,{axis:l,batchDims:c}=i;be([o,a],"gatherV2");const u=on(l,o.shape)[0],h=n.data.get(a.dataId).values,d=o.shape[u];for(let S=0;S<h.length;++S){const _=h[S];W(_<=d-1&&_>=0,()=>`GatherV2: the index value ${_} is not in [0, ${d-1}]`)}let f=c;c==null&&(f=0);const p=Nt(a.shape),m=DT(o,a,u,f),g=qn({inputs:{x:o},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),y=qn({inputs:{x:a},backend:n,attrs:{shape:[m.batchSize,p/m.batchSize]}}),v=[m.batchSize,m.outerSize,p/m.batchSize,m.sliceSize],x=n.bufferSync(y),b=n.bufferSync(g),w=R7(b,x,v);return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),n.makeTensorInfo(m.outputShape,w.dtype,w.values)}const Tut={kernelName:bv,backendName:"cpu",kernelFunc:_ut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cut(r){const{inputs:t,backend:n}=r,{input:i}=t,o=Nt(i.shape),a=i.shape[i.shape.length-1],l=o/a,c=qn({inputs:{x:i},backend:n,attrs:{shape:[l,a]}}),u=SL(c,!0,n),h=qn({inputs:{x:u},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),h}const kut={kernelName:J4,backendName:"cpu",kernelFunc:Cut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ut=On(Km,r=>Number.isFinite(r)?1:0,"bool"),Iut={kernelName:Km,backendName:"cpu",kernelFunc:$ut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eut=On(Xm,r=>Math.abs(r)===1/0?1:0,"bool"),Nut={kernelName:Xm,backendName:"cpu",kernelFunc:Eut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aut=On(Ym,r=>Number.isNaN(r)?1:0,"bool"),Mut={kernelName:Ym,backendName:"cpu",kernelFunc:Aut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dut(r){const{backend:t,attrs:n}=r,{start:i,stop:o,num:a}=n,l=B7(i,o,a);return t.makeTensorInfo([l.length],"float32",l)}const Rut={kernelName:fR,backendName:"cpu",kernelFunc:Dut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Out=On(Jm,r=>Math.log1p(r)),Lut={kernelName:Jm,backendName:"cpu",kernelFunc:Out};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fut=Is((r,t)=>r&&t),Put=Js(Cv,Fut,null,"bool"),But={kernelName:Cv,backendName:"cpu",kernelFunc:Put};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zut=On(kv,r=>r?0:1,"bool"),Vut={kernelName:kv,backendName:"cpu",kernelFunc:zut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uut=Is((r,t)=>r||t),Wut=Js($v,Uut,null,"bool"),Gut={kernelName:$v,backendName:"cpu",kernelFunc:Wut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hut(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{depthRadius:a,bias:l,alpha:c,beta:u}=i;be(o,"LRN");const h=o.shape[3],d=h-1,f=n.data.get(o.dataId).values,p=Nt(o.shape),m=new Float32Array(p);function g(y){const v=y%h;let x=y-v+Math.max(0,v-a);const b=y-v+Math.min(v+a,d);let w=0;for(;x<=b;x++){const S=f[x];w+=S*S}return w}for(let y=0;y<p;y++){const v=g(y),x=f[y]*Math.pow(l+c*v,-u);m[y]=x}return n.makeTensorInfo(o.shape,o.dtype,m)}const jut={kernelName:Iv,backendName:"cpu",kernelFunc:Hut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qut(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,y:a,dy:l}=t,{depthRadius:c,bias:u,alpha:h,beta:d}=i;be(l,"LRNGrad");const f=Nt(l.shape),p=l.shape[3],m=n.data.get(l.dataId).values,g=n.data.get(o.dataId).values,y=n.data.get(a.dataId).values,v=new Float32Array(f),x=f;for(let b=0;b<x;b++){const w=b%p,S=b-w+Math.max(0,w-c),_=b-w+Math.min(p,w+c+1);let $=0;for(let N=S;N<_;N++)$+=Math.pow(g[N],2);$=h*$+u;for(let N=S;N<_;N++){let k=-2*h*d*g[N]*y[b]/$;b===N&&(k+=Math.pow($,-d)),k*=m[b],v[N]+=k}}return n.makeTensorInfo(l.shape,o.dtype,v)}const Kut={kernelName:t_,backendName:"cpu",kernelFunc:qut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _L(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{reductionIndices:a,keepDims:l}=i,c=n;let u=o.shape;const h=u.length,d=on(a,u);let f=d;const p=ms(f,h);let m=c.data.get(o.dataId).values;if(p!=null){const S=new Array(h);for(let _=0;_<S.length;_++)S[_]=u[p[_]];m=iC(m,u,o.dtype,p,S),f=_s(f.length,h),u=S}be(o,"max"),fr("max",f,h);const[g,y]=Zs(u,f),v=Nt(y),x=V7(m,v,g,o.dtype),b=c.write(x,g,o.dtype);let w=g;return l&&(w=Ss(g,d)),{dataId:b,shape:w,dtype:o.dtype}}const Xut={kernelName:Ev,backendName:"cpu",kernelFunc:_L};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yut(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t;be(o,"maxPool");const{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=i,h=1;W(_r(l,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);const d=ko(o.shape,a,l,h,c,u);let f;if(d.filterWidth===1&&d.filterHeight===1&&An(d.inShape,d.outShape))f=Ba({inputs:{x:o},backend:n});else{const p=n.data.get(o.dataId).values,m=Ie(o.shape),g=lC(p,o.shape,o.dtype,m,d,"max");f=n.makeTensorInfo(d.outShape,o.dtype,g.values)}return f}const Zut={kernelName:Nv,backendName:"cpu",kernelFunc:Yut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jut(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{filterSize:a,strides:l,pad:c,dimRoundingMode:u,dataFormat:h}=i;be(o,"maxPool3d");const d=Nl(o.shape,a,l,1,c,u,h),f=n.data.get(o.dataId).values,p=xL(f,o.shape,o.dtype,Ie(o.shape),d,"max");return n.makeTensorInfo(p.shape,"float32",p.values)}const Qut={kernelName:Av,backendName:"cpu",kernelFunc:Jut};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tht(r){const{inputs:t,backend:n,attrs:i}=r,{dy:o,input:a}=t,{filterSize:l,strides:c,pad:u,dimRoundingMode:h}=i;be([o,a],"maxPool3DGrad");const d=Nl(a.shape,l,c,1,u,h),f=n.bufferSync(a),p=Vlt(f,d),m=d.strideDepth,g=d.strideHeight,y=d.strideWidth,v=d.dilationDepth,x=d.dilationHeight,b=d.dilationWidth,w=d.effectiveFilterDepth,S=d.effectiveFilterHeight,_=d.effectiveFilterWidth,$=w-1-d.padInfo.front,N=_-1-d.padInfo.left,k=S-1-d.padInfo.top,I=rn(a.shape,"float32"),O=n.bufferSync(o);for(let B=0;B<d.batchSize;++B)for(let F=0;F<d.inChannels;++F)for(let D=0;D<d.inDepth;++D)for(let L=0;L<d.inHeight;++L)for(let V=0;V<d.inWidth;++V){const j=D-$,Y=L-k,H=V-N;let et=0;for(let it=0;it<w;it+=v){const J=(j+it)/m;if(!(J<0||J>=d.outDepth||Math.floor(J)!==J))for(let rt=0;rt<S;rt+=x){const ut=(Y+rt)/g;if(!(ut<0||ut>=d.outHeight||Math.floor(ut)!==ut))for(let vt=0;vt<_;vt+=b){const bt=(H+vt)/y;if(bt<0||bt>=d.outWidth||Math.floor(bt)!==bt)continue;const ht=w*S*_-1-p.get(B,J,ut,bt,F),Wt=it*S*_+rt*_+vt,Dt=ht===Wt?1:0;if(Dt===0)continue;const Vt=O.get(B,J,ut,bt,F);et+=Vt*Dt}}}I.set(et,B,D,L,V,F)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}const eht={kernelName:n_,backendName:"cpu",kernelFunc:tht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nht(r){const{inputs:t,backend:n,attrs:i}=r,{dy:o,input:a,output:l}=t,c=a;be([a,l],"maxPoolGrad");const{filterSize:u,strides:h,pad:d,dimRoundingMode:f}=i,p=ko(c.shape,u,h,1,d,f),m=n.data.get(c.dataId).values,g=rn(p.outShape,c.dtype,yL(m,c.shape,c.dtype,p).values),y=p.strideHeight,v=p.strideWidth,x=p.dilationHeight,b=p.dilationWidth,w=p.effectiveFilterHeight,S=p.effectiveFilterWidth,_=S-1-p.padInfo.left,$=w-1-p.padInfo.top,N=rn(c.shape,"float32"),k=n.data.get(o.dataId).values,I=rn(o.shape,"float32",k);for(let O=0;O<p.batchSize;++O)for(let B=0;B<p.inChannels;++B)for(let F=0;F<p.inHeight;++F)for(let D=0;D<p.inWidth;++D){const L=F-$,V=D-_;let j=0;for(let Y=0;Y<w;Y+=x){const H=(L+Y)/y;if(!(H<0||H>=p.outHeight||Math.floor(H)!==H))for(let et=0;et<S;et+=b){const it=(V+et)/v;if(it<0||it>=p.outWidth||Math.floor(it)!==it)continue;const J=w*S-1-g.get(O,H,it,B),rt=Y*S+et,ut=J===rt?1:0;if(ut===0)continue;const vt=I.get(O,H,it,B);j+=vt*ut}}N.set(j,O,F,D,B)}return n.makeTensorInfo(N.shape,N.dtype,N.values)}const sht={kernelName:e_,backendName:"cpu",kernelFunc:nht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rht(r,t,n,i,o){const a=Ie(t),l=lC(r,t,n,a,o,"max"),c=yL(r,t,n,o,!0,i);return[l.values,c.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iht={kernelName:pR,backendName:"cpu",kernelFunc:({inputs:r,attrs:t,backend:n})=>{const{x:i}=r,{filterSize:o,strides:a,pad:l,includeBatchInIndex:c}=t,u=n;be(i,"MaxPoolWithArgmax");const h=u.data.get(i.dataId).values,d=ko(i.shape,o,a,[1,1],l),[f,p]=rht(h,i.shape,i.dtype,c,d),m=u.write(f,d.outShape,i.dtype),g=u.write(p,d.outShape,i.dtype);return[{dataId:m,shape:d.outShape,dtype:i.dtype},{dataId:g,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oht(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a,keepDims:l}=i,c=on(a,o.shape),h=Zs(o.shape,c)[1],d=Nt(h),f=[],p=n.makeTensorInfo([],"float32",new Float32Array([d]));f.push(p);const m=Ic({inputs:{x:o},backend:n,attrs:{dtype:"float32"}});f.push(m);const g=cC({inputs:{a:m,b:p},backend:n});f.push(g);const y=Fg({inputs:{x:g},backend:n,attrs:{axis:a,keepDims:l}});return f.forEach(v=>n.disposeIntermediateTensorInfo(v)),y}const aht={kernelName:Mv,backendName:"cpu",kernelFunc:oht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lht(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a,keepDims:l}=i;be(o,"min");const c=on(a,o.shape);let u=c;const h=ms(u,o.shape.length);let d=o;h!=null&&(d=ni({inputs:{x:o},backend:n,attrs:{perm:h}}),u=_s(u.length,o.shape.length)),fr("min",u,d.shape.length);const[f,p]=Zs(d.shape,u),m=Nt(p),g=Sr(Nt(f),d.dtype),y=n.data.get(d.dataId).values;for(let x=0;x<g.length;++x){const b=x*m;let w=y[b];for(let S=0;S<m;++S){const _=y[b+S];(Number.isNaN(_)||_<w)&&(w=_)}g[x]=w}h!=null&&n.disposeIntermediateTensorInfo(d);const v=n.makeTensorInfo(f,d.dtype,g);if(l){const x=Ss(f,c),b=qn({inputs:{x:v},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(v),b}return v}const cht={kernelName:Dv,backendName:"cpu",kernelFunc:lht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uht(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{paddings:a,mode:l}=i;be(o,"mirrorPad");const c=a.map((w,S)=>w[0]+o.shape[S]+w[1]),u=a.map(w=>w[0]),h=a.map((w,S)=>w[0]+o.shape[S]),d=l==="reflect"?0:1,f=n.data.get(o.dataId).values,p=o.shape.length,m=Ie(o.shape),g=Nt(c),y=c.length,v=Ie(c),x=hr(o.dtype,g);for(let w=0;w<g;w++){let S=hf(w,y,v);for(let $=0;$<y;$++)S[$]<u[$]?S[$]=u[$]*2-S[$]-d:S[$]>=h[$]&&(S[$]=(h[$]-1)*2-S[$]+d);S=S.map(($,N)=>$-u[N]);const _=Na(S,p,m);x[w]=f[_]}return{dataId:n.write(x,c,o.dtype),shape:c,dtype:o.dtype}}const hht={kernelName:Rv,backendName:"cpu",kernelFunc:uht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dht=Is((r,t)=>{const n=r%t;return r<0&&t<0||r>=0&&t>=0?n:(n+t)%t}),fht=Js(eg,dht),pht={kernelName:eg,backendName:"cpu",kernelFunc:fht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TL(r){const{inputs:t,backend:n,attrs:i}=r,{logits:o}=t,{dim:a}=i,l=o.shape.length;let c=a;if(c===-1&&(c=l-1),c!==l-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${l} and dim was ${c}`);const u=on([c],o.shape),h=_L({inputs:{x:o},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),d=Ss(h.shape,u),f=qn({inputs:{x:h},backend:n,attrs:{shape:d}}),p=aC({inputs:{a:o,b:f},backend:n}),m=N7({inputs:{x:p},backend:n}),g=Fg({inputs:{x:m},backend:n,attrs:{axis:u,keepDims:!1}}),y=qn({inputs:{x:g},backend:n,attrs:{shape:d}}),v=cC({inputs:{a:m,b:y},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),v}const mht={kernelName:Jv,backendName:"cpu",kernelFunc:TL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ght(r){const{inputs:t,backend:n,attrs:i}=r,{logits:o}=t,{numSamples:a,seed:l,normalized:c}=i;be(o,"multinomial");const u=c?o:TL({inputs:{logits:o},backend:n,attrs:{dim:-1}}),h=u.shape[0],d=u.shape[1],f=n.data.get(u.dataId).values,p=[h,a],m=Sr(Nt(p),"int32");for(let g=0;g<h;++g){const y=g*d,v=new Float32Array(d-1);v[0]=f[y];for(let w=1;w<v.length;++w)v[w]=v[w-1]+f[y+w];const x=gf.alea(l.toString()),b=g*a;for(let w=0;w<a;++w){const S=x();m[b+w]=v.length;for(let _=0;_<v.length;_++)if(S<v[_]){m[b+w]=_;break}}}return c||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(p,"int32",m)}const vht={kernelName:mR,backendName:"cpu",kernelFunc:ght};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yht=iT;function xht(r){const{inputs:t,backend:n,attrs:i}=r,{boxes:o,scores:a}=t,{maxOutputSize:l,iouThreshold:c,scoreThreshold:u}=i;be(o,"NonMaxSuppression");const h=n.data.get(o.dataId).values,d=n.data.get(a.dataId).values,{selectedIndices:f}=yht(h,d,l,c,u);return n.makeTensorInfo([f.length],"int32",new Int32Array(f))}const bht={kernelName:s_,backendName:"cpu",kernelFunc:xht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wht=oT;function Sht(r){const{inputs:t,backend:n,attrs:i}=r,{boxes:o,scores:a}=t,{maxOutputSize:l,iouThreshold:c,scoreThreshold:u,padToMaxOutputSize:h}=i;be(o,"NonMaxSuppressionPadded");const d=n.data.get(o.dataId).values,f=n.data.get(a.dataId).values,{selectedIndices:p,validOutputs:m}=wht(d,f,l,c,u,h);return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([m]))]}const _ht={kernelName:r_,backendName:"cpu",kernelFunc:Sht};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tht=aT;function Cht(r){const{inputs:t,backend:n,attrs:i}=r,{boxes:o,scores:a}=t,{maxOutputSize:l,iouThreshold:c,scoreThreshold:u,softNmsSigma:h}=i;be(o,"NonMaxSuppressionWithScore");const d=n.data.get(o.dataId).values,f=n.data.get(a.dataId).values,p=l,m=c,g=u,y=h,{selectedIndices:v,selectedScores:x}=Tht(d,f,p,m,g,y);return[n.makeTensorInfo([v.length],"int32",new Int32Array(v)),n.makeTensorInfo([x.length],"float32",new Float32Array(x))]}const kht={kernelName:i_,backendName:"cpu",kernelFunc:Cht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ht(r){const{inputs:t,backend:n,attrs:i}=r,{indices:o}=t,{dtype:a,depth:l,onValue:c,offValue:u}=i;be(o,"oneHot");const h=Nt(o.shape),d=new Float32Array(h*l);d.fill(u);const f=n.data.get(o.dataId).values;for(let p=0;p<h;++p)f[p]>=0&&f[p]<l&&(d[p*l+f[p]]=c);return n.makeTensorInfo([...o.shape,l],a,d)}const Iht={kernelName:Pv,backendName:"cpu",kernelFunc:$ht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _2(r){const{inputs:t,backend:n}=r,{x:i}=t;if(i.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(i.dtype==="complex64"){const o=th({inputs:{input:i},backend:n}),a=_2({inputs:{x:o},backend:n}),l=Ud({inputs:{input:i},backend:n}),c=_2({inputs:{x:l},backend:n}),u=di({inputs:{real:a,imag:c},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),u}else return uC({backend:n,attrs:{shape:i.shape,value:0,dtype:i.dtype}})}const Eht={kernelName:ey,backendName:"cpu",kernelFunc:_2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CL(r){const{inputs:t,backend:n}=r,{x:i}=t;if(i.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(i.dtype==="complex64"){const o=th({inputs:{input:i},backend:n}),a=CL({inputs:{x:o},backend:n}),l=Ud({inputs:{input:i},backend:n}),c=_2({inputs:{x:l},backend:n}),u=di({inputs:{real:a,imag:c},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),u}else return uC({backend:n,attrs:{shape:i.shape,value:1,dtype:i.dtype}})}const Nht={kernelName:Fv,backendName:"cpu",kernelFunc:CL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kL(r){const{inputs:t,backend:n,attrs:i}=r,{axis:o}=i;if(t.length===1)return S2({inputs:{input:t[0]},backend:n,attrs:{dim:o}});const a=t[0].shape,l=t[0].dtype;t.forEach(d=>{Co(a,d.shape,"All tensors passed to stack must have matching shapes"),W(l===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const c=[],u=t.map(d=>{const f=S2({inputs:{input:d},backend:n,attrs:{dim:o}});return c.push(f),f}),h=Wd({inputs:u,backend:n,attrs:{axis:o}});return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),h}const Aht={kernelName:Bv,backendName:"cpu",kernelFunc:kL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mht(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{paddings:a,constantValue:l}=i;be(o,"pad");const c=a.map((b,w)=>b[0]+o.shape[w]+b[1]),u=a.map(b=>b[0]),h=n.data.get(o.dataId).values,d=Nt(o.shape),f=o.shape.length,p=Ie(o.shape),m=Nt(c),g=c.length,y=Ie(c),v=hr(o.dtype,m);l!==0&&v.fill(l);for(let b=0;b<d;b++){const S=hf(b,f,p).map(($,N)=>$+u[N]),_=Na(S,g,y);v[_]=h[b]}return{dataId:n.write(v,c,o.dtype),shape:c,dtype:o.dtype}}const $L={kernelName:zv,backendName:"cpu",kernelFunc:Mht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dht=Is((r,t)=>Math.pow(r,t)),Rht=Js(sg,Dht),Oht={kernelName:sg,backendName:"cpu",kernelFunc:Rht};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lht(r){const{inputs:t,backend:n,attrs:i}=r,{paramsNestedSplits:o,paramsDenseValues:a,indices:l}=t,c=o.map(v=>n.data.get(v.dataId).values),u=o.map(v=>v.shape),h=n.data.get(a.dataId).values,d=n.data.get(l.dataId).values,[f,p,m]=q7(c,u,h,a.shape,a.dtype,d,l.shape),g=f.map(v=>n.makeTensorInfo([v.length],"int32",v)),y=n.makeTensorInfo(m,a.dtype,p);return g.concat([y])}const Fht={kernelName:gR,backendName:"cpu",kernelFunc:Lht};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pht(r){const{inputs:t,backend:n}=r,{starts:i,limits:o,deltas:a}=t,l=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values,u=n.data.get(a.dataId).values,[h,d]=K7(l,i.shape,i.dtype,c,o.shape,u,a.shape),f=n.makeTensorInfo([h.length],"int32",h),p=n.makeTensorInfo([d.length],i.dtype,d);return[f,p]}const Bht={kernelName:vR,backendName:"cpu",kernelFunc:Pht};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zht(r){const{inputs:t,backend:n,attrs:i}=r,{shape:o,values:a,defaultValue:l,rowPartitionTensors:c}=t,{rowPartitionTypes:u}=i,h=n.data.get(o.dataId).values,d=n.data.get(a.dataId).values,f=n.data.get(l.dataId).values,p=c.map(v=>n.data.get(v.dataId).values),m=c.map(v=>v.shape),[g,y]=X7(h,o.shape,d,a.shape,a.dtype,f,l.shape,p,m,u);return n.makeTensorInfo(g,a.dtype,y)}const Vht={kernelName:yR,backendName:"cpu",kernelFunc:zht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uht(r){const{backend:t,attrs:n}=r,{start:i,stop:o,dtype:a,step:l}=n,c=Y7(i,o,l,a);return t.makeTensorInfo([c.length],a,c)}const Wht={kernelName:o_,backendName:"cpu",kernelFunc:Uht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ght=On(rg,r=>1/r),Hht={kernelName:rg,backendName:"cpu",kernelFunc:Ght};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jht(r){const{inputs:t,backend:n,attrs:i}=r,{images:o}=t,{alignCorners:a,halfPixelCenters:l,size:c}=i;be(o,"resizeBilinear");const u=Ie(o.shape),[h,d]=c,[f,p,m,g]=o.shape,y=n.data.get(o.dataId).values,v=new Float32Array(Nt([f,h,d,g])),x=[a&&h>1?p-1:p,a&&d>1?m-1:m],b=[a&&h>1?h-1:h,a&&d>1?d-1:d];let w=0;const S=x[0]/b[0],_=x[1]/b[1];for(let $=0;$<f;$++)for(let N=0;N<h;N++){let k;l?k=S*(N+.5)-.5:k=S*N;const I=Math.max(0,Math.floor(k)),O=k-I,B=Math.min(p-1,Math.ceil(k)),F=$*u[0]+I*u[1],D=$*u[0]+B*u[1];for(let L=0;L<d;L++){let V;l?V=_*(L+.5)-.5:V=_*L;const j=Math.max(0,Math.floor(V)),Y=V-j,H=Math.min(m-1,Math.ceil(V)),et=F+j*u[2],it=D+j*u[2],J=F+H*u[2],rt=D+H*u[2];for(let ut=0;ut<g;ut++){const vt=y[et+ut],bt=y[it+ut],ht=y[J+ut],Wt=y[rt+ut],Dt=vt+(ht-vt)*Y,Vt=bt+(Wt-bt)*Y,zt=Dt+(Vt-Dt)*O;v[w++]=zt}}}return n.makeTensorInfo([f,h,d,g],"float32",v)}const qht={kernelName:Hv,backendName:"cpu",kernelFunc:jht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kht(r){const{inputs:t,backend:n,attrs:i}=r,{images:o,dy:a}=t,{alignCorners:l}=i;be([a,o],"resizeBilinearGrad");const c=Ie(o.shape),[u,h,d,f]=o.shape,[,p,m]=a.shape,g=new Float32Array(u*h*d*f),y=[l&&p>1?h-1:h,l&&m>1?d-1:d],v=[l&&p>1?p-1:p,l&&m>1?m-1:m],x=y[0]/v[0],b=y[1]/v[1],w=n.data.get(a.dataId).values;let S=0;for(let _=0;_<u;_++){const $=_*c[0];for(let N=0;N<p;N++){const k=N*x,I=Math.floor(k),O=Math.min(Math.ceil(k),h-1),B=$+I*c[1],F=$+O*c[1],D=k-I,L=1-D;for(let V=0;V<m;V++){const j=V*b,Y=Math.floor(j),H=Math.min(Math.ceil(j),d-1),et=j-Y,it=1-et,J=B+Y*c[2],rt=B+H*c[2],ut=F+Y*c[2],vt=F+H*c[2],bt=L*it,ht=L*et,Wt=D*it,Dt=D*et;for(let Vt=0;Vt<f;Vt++){const zt=w[S++];g[J+Vt]+=zt*bt,g[rt+Vt]+=zt*ht,g[ut+Vt]+=zt*Wt,g[vt+Vt]+=zt*Dt}}}}return n.makeTensorInfo([u,d,h,f],"float32",g)}const Xht={kernelName:c_,backendName:"cpu",kernelFunc:Kht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yht(r){const{inputs:t,backend:n,attrs:i}=r,{images:o}=t,{alignCorners:a,halfPixelCenters:l,size:c}=i;be(o,"resizeNearestNeighbor");const u=Ie(o.shape),[h,d]=c,[f,p,m,g]=o.shape,y=n.data.get(o.dataId).values,v=new Float32Array(f*h*d*g),x=[a&&h>1?p-1:p,a&&d>1?m-1:m],b=[a&&h>1?h-1:h,a&&d>1?d-1:d],w=x[0]/b[0],S=x[1]/b[1];let _=0;for(let $=0;$<f;$++){const N=$*u[0];for(let k=0;k<h;k++){const I=l?w*(k+.5):w*k;let O=Math.min(p-1,a?Math.round(I):Math.floor(I));l&&(O=Math.max(0,O));const B=N+O*u[1];for(let F=0;F<d;F++){const D=l?S*(F+.5):S*F;let L=Math.min(m-1,a?Math.round(D):Math.floor(D));l&&(L=Math.max(0,L));const V=B+L*u[2];for(let j=0;j<g;j++){const Y=y[V+j];v[_++]=Y}}}}return n.makeTensorInfo([f,h,d,g],o.dtype,v)}const Zht={kernelName:Gv,backendName:"cpu",kernelFunc:Yht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jht(r){const{inputs:t,backend:n,attrs:i}=r,{images:o,dy:a}=t,{alignCorners:l}=i;be([a,o],"resizeNearestNeighborGrad");const c=Ie(o.shape),u=Ie(a.shape),[h,d,f,p]=o.shape,[,m,g]=a.shape,y=new Float32Array(h*d*f*p),v=n.data.get(a.dataId).values,x=[l&&m>1?d-1:d,l&&g>1?f-1:f],b=[l&&m>1?m-1:m,l&&g>1?g-1:g],w=x[0]/b[0],S=x[1]/b[1],_=1/w,$=1/S,N=Math.ceil(_)*2+2,k=Math.ceil($)*2+2;for(let I=0;I<h;I++){const O=I*c[0];for(let B=0;B<d;B++){const F=O+B*c[1],D=Math.floor(B*_),L=Math.floor(D-N/2);for(let V=0;V<f;V++){const j=F+V*c[2],Y=Math.floor(V*$),H=Math.floor(Y-k/2);for(let et=0;et<p;et++){let it=0;for(let J=0;J<N;J++){const rt=J+L;if(rt<0||rt>=m)continue;const ut=O+rt*u[1],vt=rt*w,bt=Math.min(d-1,l?Math.round(vt):Math.floor(vt));if(B===bt)for(let ht=0;ht<k;ht++){const Wt=ht+H;if(Wt<0||Wt>=g)continue;const Dt=ut+Wt*u[2],Vt=Wt*S,zt=Math.min(f-1,l?Math.round(Vt):Math.floor(Vt));V===zt&&(it+=v[Dt+et])}}y[j+et]=it}}}}return n.makeTensorInfo(o.shape,o.dtype,y)}const Qht={kernelName:l_,backendName:"cpu",kernelFunc:Jht};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tdt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{dims:a}=i;be(o,"reverse");const l=o.shape.length,c=on(a,o.shape);if(l===0)return Ba({inputs:{x:o},backend:n});const u=new xr(o.shape,o.dtype),h=n.bufferSync(o);for(let d=0;d<u.size;d++){const f=u.indexToLoc(d),p=f.slice();c.forEach(m=>p[m]=o.shape[m]-1-p[m]),u.set(h.get(...p),...f)}return n.makeTensorInfo(u.shape,u.dtype,u.values)}const edt={kernelName:jv,backendName:"cpu",kernelFunc:tdt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ndt={kernelName:S_,backendName:"cpu",kernelFunc:({inputs:r,attrs:t,backend:n})=>{const{image:i}=r,{radians:o,fillValue:a,center:l}=t,c=n,u=hr(i.dtype,Nt(i.shape)),[h,d,f,p]=i.shape,[m,g]=vT(l,d,f),y=255,v=Math.sin(o),x=Math.cos(o),b=c.data.get(i.dataId).values;for(let S=0;S<h;S++){const _=S*f*d*p;for(let $=0;$<d;$++){const N=$*(f*p);for(let k=0;k<f;k++){const I=k*p;for(let O=0;O<p;O++){const B=[h,$,k,O],F=B[2],D=B[1];let L=(F-m)*x-(D-g)*v,V=(F-m)*v+(D-g)*x;L=Math.round(L+m),V=Math.round(V+g);let j=a;if(typeof a!="number"&&(O===3?j=y:j=a[O]),L>=0&&L<f&&V>=0&&V<d){const H=V*(f*p),et=L*p,it=_+H+et+O;j=b[it]}const Y=_+N+I+O;u[Y]=j}}}}return{dataId:c.write(u,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sdt=On(ag,r=>{const t=Math.floor(r);return r-t<.5?Math.floor(r):r-t>.5?Math.ceil(r):t%2===0?t:t+1}),rdt={kernelName:ag,backendName:"cpu",kernelFunc:sdt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function idt(r){const{inputs:t,backend:n,attrs:i}=r,{indices:o,updates:a}=t,{shape:l}=i,{sliceRank:c,numUpdates:u,sliceSize:h,strides:d,outputSize:f}=Sg(a,o,l),p=!0,m=n.bufferSync(o),g=n.bufferSync(a),y=gd(m,g,l,f,h,u,c,d,0,p);return n.makeTensorInfo(l,y.dtype,y.values)}const odt={kernelName:xR,backendName:"cpu",kernelFunc:idt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function adt(r,t){let n=0,i=r.length,o=0;for(;n<i;)o=Math.floor((n+i)/2),r[o]<t?n=o+1:i=o;return i}function ldt(r,t){let n=0,i=r.length,o=0;for(;n<i;)o=Math.floor((n+i)/2),r[o]<=t?n=o+1:i=o;return i}function cdt(r,t,n,i,o,a){const l=ks("int32",n*o);for(let c=0;c<n;++c){const u=r.slice(c*i,(c+1)*i),h=c*o;for(let d=0;d<o;++d)l[h+d]=a==="left"?adt(u,t[d+h]):ldt(u,t[d+h])}return l}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function udt(r){const{inputs:t,backend:n,attrs:i}=r,{sortedSequence:o,values:a}=t,{side:l}=i,c=n.data.get(o.dataId).values,u=n.data.get(a.dataId).values,h=cdt(c,u,o.shape[0],o.shape[1],a.shape[1],l);return n.makeTensorInfo(a.shape,"int32",h)}const hdt={kernelName:bR,backendName:"cpu",kernelFunc:udt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ddt(r){const{inputs:t,backend:n}=r,{condition:i,t:o,e:a}=t;be([i,o,a],"select");const l=i.shape.length,c=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,h=n.data.get(a.dataId).values,d=gi(o.dtype,a.dtype),f=Sr(Nt(o.shape),d);let p=0;const m=l===0||l>1||o.shape.length===1?1:Nt(o.shape.slice(1));for(let g=0;g<c.length;g++)for(let y=0;y<m;y++)c[g]===1?f[p++]=u[g]:f[p++]=h[g];return n.makeTensorInfo(o.shape,d,f)}const fdt={kernelName:qv,backendName:"cpu",kernelFunc:ddt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pdt=my,mdt=gy,gdt=On(cg,r=>r>=0?mdt*r:pdt*(Math.exp(r)-1)),vdt={kernelName:cg,backendName:"cpu",kernelFunc:gdt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ydt=On(dg,r=>r<0?-1:r>0?1:0),xdt={kernelName:dg,backendName:"cpu",kernelFunc:ydt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bdt=On(ug,r=>Math.sin(r)),wdt={kernelName:ug,backendName:"cpu",kernelFunc:bdt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sdt=On(hg,r=>Math.sinh(r)),_dt={kernelName:hg,backendName:"cpu",kernelFunc:Sdt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tdt=11920928955078125e-23,QI=Math.log(Tdt)+2,Cdt=On(pg,r=>{const t=r>-QI,n=r<QI,i=Math.exp(r);let o;return n?o=i:t?o=r:o=Math.log(1+i),o}),kdt={kernelName:pg,backendName:"cpu",kernelFunc:Cdt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $dt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{blockShape:a,paddings:l}=i;be([o],"spaceToBatchND");const c=Nt(a),u=[[0,0]];u.push(...l);for(let $=1+a.length;$<o.shape.length;++$)u.push([0,0]);const h=$L.kernelFunc({inputs:{x:o},backend:n,attrs:{paddings:u,constantValue:0}}),d=Ig(h.shape,a,c,!1),f=Eg(d.length,a.length,!1),p=Ng(h.shape,a,c,!1),y=qn({inputs:{x:h},backend:n,attrs:{shape:d}}),b=ni({inputs:{x:y},backend:n,attrs:{perm:f}}),_=qn({inputs:{x:b},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),_}const Idt={kernelName:Yv,backendName:"cpu",kernelFunc:$dt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Edt(r){const{inputs:t,backend:n}=r,{indices:i,values:o,denseShape:a,defaultValue:l}=t;if(a.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${a.shape}`);if(i.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${i.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${o.shape}`);if(l.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${l.shape}`);const c=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,h=n.data.get(a.dataId).values,d=n.data.get(l.dataId).values[0],[f,p,m,g,y]=tL(c,i.shape,i.dtype,u,o.dtype,h,d);return[n.makeTensorInfo(p,i.dtype,f),n.makeTensorInfo([p[0]],o.dtype,m),n.makeTensorInfo([g.length],"bool",new Uint8Array(g.map(v=>Number(v)))),n.makeTensorInfo([y.length],i.dtype,new Int32Array(y))]}const Ndt={kernelName:u_,backendName:"cpu",kernelFunc:Edt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Adt(r){const{inputs:t,backend:n}=r,{inputIndices:i,inputShape:o,newShape:a}=t;if(i.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${i.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${o.shape}`);if(a.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${a.shape}`);const l=Array.from(n.data.get(o.dataId).values),c=n.data.get(i.dataId).values,u=Array.from(n.data.get(a.dataId).values),[h,d,f]=eL(c,i.shape,i.dtype,l,u);return[n.makeTensorInfo(d,i.dtype,h),n.makeTensorInfo([f.length],a.dtype,new Int32Array(f))]}const Mdt={kernelName:h_,backendName:"cpu",kernelFunc:Adt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ddt(r){const{inputs:t,backend:n}=r,{data:i,indices:o,segmentIds:a}=t;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${o.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${a.shape}`);if(o.shape[0]!==a.shape[0])throw new Error("segmentIds and indices should have same size.");const l=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values,u=n.data.get(a.dataId).values,[h,d]=oC(l,i.shape,i.dtype,c,u,!0);return n.makeTensorInfo(d,i.dtype,h)}const Rdt={kernelName:d_,backendName:"cpu",kernelFunc:Ddt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Odt(r){const{inputs:t,backend:n}=r,{data:i,indices:o,segmentIds:a}=t;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${o.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${a.shape}`);if(o.shape[0]!==a.shape[0])throw new Error("segmentIds and indices should have same size.");const l=n.data.get(i.dataId).values,c=n.data.get(o.dataId).values,u=n.data.get(a.dataId).values,[h,d]=oC(l,i.shape,i.dtype,c,u);return n.makeTensorInfo(d,i.dtype,h)}const Ldt={kernelName:f_,backendName:"cpu",kernelFunc:Odt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fdt(r){const{inputs:t,backend:n,attrs:i}=r,{sparseIndices:o,sparseValues:a,defaultValue:l}=t,{outputShape:c}=i,{sliceRank:u,numUpdates:h,sliceSize:d,strides:f,outputSize:p}=Sg(a,o,c),m=!1,g=n.bufferSync(o);let y;switch(a.dtype){case"bool":{const v=n.bufferSync(a),x=Boolean(n.data.get(l.dataId).values[0]);y=gd(g,v,c,p,d,h,u,f,x,m);break}case"float32":{const v=n.bufferSync(a),x=n.data.get(l.dataId).values[0];y=gd(g,v,c,p,d,h,u,f,x,m);break}case"int32":{const v=n.bufferSync(a),x=n.data.get(l.dataId).values[0];y=gd(g,v,c,p,d,h,u,f,x,m);break}case"string":{const v=n.bufferSync(a),x=Sc(n.data.get(l.dataId).values[0]);y=gd(g,v,c,p,d,h,u,f,x,m);break}default:throw new Error(`Unsupported type ${a.dtype}`)}return n.makeTensorInfo(c,y.dtype,y.values)}const Pdt={kernelName:wR,backendName:"cpu",kernelFunc:Fdt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bdt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{numOrSizeSplits:a,axis:l}=i,c=on(l,o.shape)[0],u=MT(o,a,c),h=new Array(o.shape.length).fill(0),d=o.shape.slice();return u.map(f=>{const p=[...d];p[c]=f;const m=eh({inputs:{x:o},backend:n,attrs:{begin:h,size:p}});return h[c]+=f,m})}const zdt={kernelName:Zv,backendName:"cpu",kernelFunc:Bdt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vdt={kernelName:p_,backendName:"cpu",kernelFunc:({inputs:r,backend:t})=>{const{x:n}=r,i=t;be(n,"square");const o=i.data.get(n.dataId).values,a=new Float32Array(o.length);for(let c=0;c<o.length;++c){const u=o[c];a[c]=u*u}return{dataId:i.write(a,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Udt=On(wg,(r,t)=>{const n=t;return isNaN(r)?NaN:r>0?1:n.alpha}),Wdt={kernelName:wg,backendName:"cpu",kernelFunc:Udt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gdt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{begin:a,end:l,strides:c,beginMask:u,endMask:h,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:p}=i;be(o,"stridedSlice");const{finalShapeSparse:m,finalShape:g,isIdentity:y,sliceDim0:v,isSimpleSlice:x,begin:b,end:w,strides:S}=D_(o.shape,a,l,c,u,h,d,f,p);let _;if(y)_=qn({inputs:{x:o},backend:n,attrs:{shape:g}});else if(v||x){W(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);const $=N_(b,w,S),N=eh({inputs:{x:o},backend:n,attrs:{begin:b,size:$}});_=qn({inputs:{x:N},backend:n,attrs:{shape:g}}),n.disposeIntermediateTensorInfo(N)}else{const $=n.bufferSync(o),N=sL(m,$,S,b);_=n.makeTensorInfo(g,N.dtype,N.values)}return _}const Hdt={kernelName:m_,backendName:"cpu",kernelFunc:Gdt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jdt(r){const{inputs:t,backend:n,attrs:i}=r,{separator:o,nGramWidths:a,leftPad:l,rightPad:c,padWidth:u,preserveShortSequences:h}=i,{data:d,dataSplits:f}=t,p=n.data.get(d.dataId).values,m=n.data.get(f.dataId).values,[g,y]=rL(p,m,o,a,l,c,u,h);return[n.makeTensorInfo([g.length],"string",g),n.makeTensorInfo(f.shape,"int32",y)]}const qdt={kernelName:g_,backendName:"cpu",kernelFunc:jdt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kdt(r){const{inputs:t,backend:n,attrs:i}=r,{skipEmpty:o}=i,{input:a,delimiter:l}=t;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(a.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${a.shape}`);if(l.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${l.shape}`);const c=n.data.get(a.dataId).values,u=n.data.get(l.dataId).values[0],[h,d,f]=iL(c,u,o),p=d.length;return[n.makeTensorInfo([p,2],"int32",h),n.makeTensorInfo([p],"string",d),n.makeTensorInfo([2],"int32",new Int32Array(f))]}const Xdt={kernelName:v_,backendName:"cpu",kernelFunc:Kdt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ydt(r){const{inputs:t,backend:n,attrs:i}=r,{numBuckets:o}=i,{input:a}=t;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");const l=n.data.get(a.dataId).values,c=oL(l,o);return n.makeTensorInfo(a.shape,"int32",c)}const Zdt={kernelName:y_,backendName:"cpu",kernelFunc:Ydt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jdt=On(yg,r=>Math.tan(r)),Qdt={kernelName:yg,backendName:"cpu",kernelFunc:Jdt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tft=On(xg,r=>Math.tanh(r)),eft={kernelName:xg,backendName:"cpu",kernelFunc:tft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nft(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{reps:a}=i;be(o,"tile");const l=lL(n.bufferSync(o),a);return n.makeTensorInfo(l.shape,l.dtype,l.values)}const sft={kernelName:bg,backendName:"cpu",kernelFunc:nft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rft(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{k:a,sorted:l}=i;be(o,"topk");const c=n.data.get(o.dataId).values,[u,h]=uL(c,o.shape,o.dtype,a,l);return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(h.shape,h.dtype,h.values)]}const ift={kernelName:x_,backendName:"cpu",kernelFunc:rft};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oft(r){const{inputs:t,attrs:n,backend:i}=r,{image:o,transforms:a}=t,{interpolation:l,fillMode:c,fillValue:u,outputShape:h}=n,[d,f,p,m]=o.shape,[g,y]=h??[f,p],v=[d,g,y,m],x=Ie(o.shape),b=x[0],w=x[1],S=x[2],_=Ie(v),$=_[0],N=_[1],k=_[2],I=hr(o.dtype,Nt(v));I.fill(u);const O=i.data.get(o.dataId).values,B=i.data.get(a.dataId).values;for(let D=0;D<d;++D){const L=a.shape[0]===1?B:B.subarray(D*8,D*8+8);for(let V=0;V<g;++V)for(let j=0;j<y;++j)for(let Y=0;Y<m;++Y){let H;const et=L[6]*j+L[7]*V+1;if(et===0)continue;const it=(L[0]*j+L[1]*V+L[2])/et,J=(L[3]*j+L[4]*V+L[5])/et,rt=tE(it,p,c),ut=tE(J,f,c);switch(l){case"nearest":H=dft(O,f,p,b,w,S,D,ut,rt,Y,u);break;case"bilinear":H=fft(O,f,p,b,w,S,D,ut,rt,Y,u);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${l}`)}const vt=D*$+V*N+j*k+Y;I[vt]=H}return i.makeTensorInfo(v,o.dtype,I)}return{dataId:i.write(I,v,o.dtype),shape:o.shape,dtype:o.dtype}}const aft={kernelName:b_,backendName:"cpu",kernelFunc:oft};function tE(r,t,n){switch(n){case"reflect":return lft(r,t);case"wrap":return cft(r,t);case"nearest":return hft(r,t);case"constant":default:return uft(r)}}function lft(r,t){let n=r;if(n<0)if(t<=1)n=0;else{const i=2*t;n<i&&(n=i*Math.trunc(-n/i)+n),n=n<-t?n+i:-n-1}else if(n>t-1)if(t<=1)n=0;else{const i=2*t;n-=i*Math.trunc(n/i),n>=t&&(n=i-n-1)}return Gu(0,n,t-1)}function cft(r,t){let n=r;if(n<0)if(t<=1)n=0;else{const i=t-1;n+=t*(Math.trunc(-n/i)+1)}else if(n>t-1)if(t<=1)n=0;else{const i=t-1;n-=t*Math.trunc(n/i)}return Gu(0,n,t-1)}function uft(r,t){return r}function hft(r,t){return Gu(0,r,t-1)}function Sp(r,t,n,i,o,a,l,c,u,h,d){const f=l*i+c*o+u*a+h;return 0<=c&&c<t&&0<=u&&u<n?r[f]:d}function dft(r,t,n,i,o,a,l,c,u,h,d){const f=Math.round(c),p=Math.round(u);return Sp(r,t,n,i,o,a,l,f,p,h,d)}function fft(r,t,n,i,o,a,l,c,u,h,d){const f=Math.floor(c),p=Math.floor(u),m=f+1,g=p+1,y=(g-u)*Sp(r,t,n,i,o,a,l,f,p,h,d)+(u-p)*Sp(r,t,n,i,o,a,l,f,g,h,d),v=(g-u)*Sp(r,t,n,i,o,a,l,m,p,h,d)+(u-p)*Sp(r,t,n,i,o,a,l,m,g,h,d);return(m-c)*y+(c-f)*v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pft(r){const{inputs:t,attrs:n,backend:i}=r,{axis:o}=n,{x:a}=t;be(a,"unique");const l=i.data.get(a.dataId).values,{outputValues:c,outputShape:u,indices:h}=hL(l,o,a.shape,a.dtype);return[i.makeTensorInfo(u,a.dtype,c),i.makeTensorInfo([h.length],"int32",h)]}const mft={kernelName:w_,backendName:"cpu",kernelFunc:pft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gft(r){const{inputs:t,backend:n,attrs:i}=r,{value:o}=t;let{axis:a}=i;a<0&&(a+=o.shape.length);const l=o.shape.length,c=o.shape[a],u=new Array(l-1);let h=0;for(let m=0;m<l;m++)m!==a&&(u[h++]=o.shape[m]);const d=new Array(l).fill(0),f=o.shape.slice();f[a]=1;const p=new Array(c);for(let m=0;m<p.length;m++){d[a]=m;const g=eh({inputs:{x:o},backend:n,attrs:{begin:d,size:f}});p[m]=qn({inputs:{x:g},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(g)}return p}const vft={kernelName:Qv,backendName:"cpu",kernelFunc:gft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yft(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,segmentIds:a}=t,{numSegments:l}=i;be(o,"unsortedSegmentSum");const c=o.shape.length,u=a.shape.length,h=[],d=[],f=c-u;let p=a;for(let g=0;g<f;++g){const y=S2({inputs:{input:p},backend:n,attrs:{dim:g+1}});p=y,d.push(y)}for(let g=0;g<l;++g){const y=Fc(g,"int32"),v=n.makeTensorInfo([],"int32",y),x=I7({inputs:{a:v,b:p},backend:n}),b=Ic({inputs:{x},backend:n,attrs:{dtype:"float32"}}),w=Ny({inputs:{a:b,b:o},backend:n}),S=Fg({inputs:{x:w},backend:n,attrs:{axis:0,keepDims:!1}});h.push(S),d.push(v),d.push(x),d.push(b),d.push(w),d.push(S)}const m=kL({inputs:h,backend:n,attrs:{axis:0}});return d.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}const xft={kernelName:ty,backendName:"cpu",kernelFunc:yft};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bft=[mlt,eat,vlt,xlt,aat,wlt,_lt,Clt,$lt,Elt,Alt,Dlt,Olt,Plt,zlt,Wlt,Hlt,qlt,Xlt,flt,Zlt,Qlt,ect,sct,iat,cat,ict,nat,act,cct,uct,dct,pct,gct,yct,bct,Sct,Tct,kct,Ict,Nct,Mct,Rct,Oct,Fct,Bct,Vct,Uct,Wct,Gct,qct,olt,Xct,uat,sut,hat,rut,fat,uut,hut,fut,mat,gut,yut,but,Sut,Tut,vat,xat,sat,kut,lct,Iut,Nut,Mut,alt,wat,_at,Rut,Cat,Lut,But,Vut,Gut,jut,Kut,Xut,$at,Zut,Qut,eht,sht,iht,aht,cht,Eat,hht,pht,vht,Aat,Dat,bht,_ht,kht,Oat,Iht,Nht,Aht,$L,Oht,clt,Pat,Fht,Bht,Vht,Wht,rat,xw,Hht,ult,hlt,dlt,qht,Xht,Zht,Qht,edt,ndt,rdt,jat,odt,hdt,fdt,vdt,Kat,xdt,wdt,_dt,Xat,mht,kdt,Idt,Ndt,Mdt,Rdt,Ldt,Pdt,zdt,Jat,Vdt,tlt,Wdt,Hdt,qdt,Xdt,Zdt,rlt,Hct,Qdt,eft,sft,ift,aft,Lat,mft,vft,xft,Eht];for(const r of bft)_R(r);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gu={},P0={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function wft(r,t){gu[r]=t}function ea(r,t){if(!(r in gu)||t!=null){const i=_ft(r,t);if(i!==null)gu[r]=i;else return console.log("Could not get context for WebGL version",r),null}const n=gu[r];return n==null||n.isContextLost()?(delete gu[r],ea(r)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),gu[r])}function Sft(r){if(typeof OffscreenCanvas<"u"&&r===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function _ft(r,t){if(r!==1&&r!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=t??Sft(r);return n.addEventListener("webglcontextlost",i=>{i.preventDefault(),delete gu[r]},!1),kt().getBool("SOFTWARE_WEBGL_ENABLED")&&(P0.failIfMajorPerformanceCaveat=!1),r===1?n.getContext("webgl",P0)||n.getContext("experimental-webgl",P0):n.getContext("webgl2",P0)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var nm;(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(nm||(nm={}));var Ri;(function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"})(Ri||(Ri={}));var or;(function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(or||(or={}));function Pg(r,t){return[t,r]}function Tft(r,t){return r*t}function B0(r){const t=Nt(r),n=Math.ceil(t/4);return A3(n)}function bf(r,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(r/2))]}function Cft(r,t){const[n,i]=bf(r,t);return n*i*4}function hC(r,t){const n=r;let i,o,a,l,c,u,h,d,f,p;return kt().getNumber("WEBGL_VERSION")===2?(i=n.R32F,o=n.R16F,a=n.RGBA16F,l=n.RGBA32F,c=n.RED,h=4,d=1,f=n.HALF_FLOAT,p=n.FLOAT,u=n.RGBA8):(i=r.RGBA,o=r.RGBA,a=r.RGBA,l=n.RGBA,c=r.RGBA,h=4,d=4,f=t!=null?t.HALF_FLOAT_OES:null,p=r.FLOAT,u=r.RGBA),{internalFormatFloat:i,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:l,textureFormatFloat:c,downloadTextureFormat:u,downloadUnpackNumChannels:h,defaultNumChannels:d,textureTypeHalfFloat:f,textureTypeFloat:p}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fe(r,t){const n=t();return kt().getBool("DEBUG")&&kft(r),n}function kft(r){const t=r.getError();if(t!==r.NO_ERROR)throw new Error("WebGL Error: "+Nft(r,t))}const $ft=596e-10,Ift=65504;function Eft(r){return!!(kt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||$ft<Math.abs(r)&&Math.abs(r)<Ift)}function Nft(r,t){switch(t){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function z0(r,t){return Dl(r,()=>r.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function Aft(r,t){const n=Dl(r,()=>r.createShader(r.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(fe(r,()=>r.shaderSource(n,t)),fe(r,()=>r.compileShader(n)),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function Mft(r,t){const n=Dl(r,()=>r.createShader(r.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(fe(r,()=>r.shaderSource(n,t)),fe(r,()=>r.compileShader(n)),kt().get("ENGINE_COMPILE_ONLY"))return n;if(r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw IL(t,r.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const Dft=/ERROR: [0-9]+:([0-9]+):/g;function IL(r,t){const n=Dft.exec(t);if(n==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(r);return}const i=+n[1],o=r.split(`
`),a=o.length.toString().length+2,l=o.map((f,p)=>bd((p+1).toString(),a)+f);let c=0;for(let f=0;f<l.length;f++)c=Math.max(l[f].length,c);const u=l.slice(0,i-1),h=l.slice(i-1,i),d=l.slice(i);console.log(u.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${bd(h[0],c)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function Rft(r){return Dl(r,()=>r.createProgram(),"Unable to create WebGLProgram.")}function Oft(r,t){if(fe(r,()=>r.linkProgram(t)),!kt().get("ENGINE_COMPILE_ONLY")&&r.getProgramParameter(t,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Hx(r,t){if(fe(r,()=>r.validateProgram(t)),r.getProgramParameter(t,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function Lft(r,t){const n=Dl(r,()=>r.createBuffer(),"Unable to create WebGLBuffer");return fe(r,()=>r.bindBuffer(r.ARRAY_BUFFER,n)),fe(r,()=>r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW)),n}function Fft(r,t){const n=Dl(r,()=>r.createBuffer(),"Unable to create WebGLBuffer");return fe(r,()=>r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n)),fe(r,()=>r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW)),n}function Pft(r){return Dl(r,()=>r.createTexture(),"Unable to create WebGLTexture.")}function Bft(r,t){const n=kt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||t<=0){const i=`[${r}x${t}]`;throw new Error("Requested texture size "+i+" is invalid.")}if(r>n||t>n){const i=`[${r}x${t}]`,o=`[${n}x${n}]`;throw new Error("Requested texture size "+i+" greater than WebGL maximum on this browser / GPU "+o+".")}}function zft(r){return Dl(r,()=>r.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function eE(r,t,n,i,o,a,l){const c=r.getAttribLocation(t,n);return c===-1?!1:(fe(r,()=>r.bindBuffer(r.ARRAY_BUFFER,i)),fe(r,()=>r.vertexAttribPointer(c,o,r.FLOAT,!1,a,l)),fe(r,()=>r.enableVertexAttribArray(c)),!0)}function Vft(r,t,n){jft(r,n),fe(r,()=>r.activeTexture(r.TEXTURE0+n)),fe(r,()=>r.bindTexture(r.TEXTURE_2D,t))}function Uft(r,t,n){return Dl(r,()=>r.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}function Wft(r,t,n){return r.getUniformLocation(t,n)}function Gft(r,t,n,i){fe(r,()=>Vft(r,t,i)),fe(r,()=>r.uniform1i(n,i))}function jx(r,t,n){fe(r,()=>r.bindFramebuffer(r.FRAMEBUFFER,n)),fe(r,()=>r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0))}function nE(r,t){fe(r,()=>r.bindFramebuffer(r.FRAMEBUFFER,t)),fe(r,()=>r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0))}function V0(r){const t=r.checkFramebufferStatus(r.FRAMEBUFFER);if(t!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Hft(r,t))}function Hft(r,t){switch(t){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function Dl(r,t,n){const i=fe(r,()=>t());if(i==null)throw new Error(n);return i}function jft(r,t){const n=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,i=t+r.TEXTURE0;if(i<r.TEXTURE0||i>n){const o=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${o}.`)}}function Gd(r,t=2){return Nt(r.slice(0,r.length-t))}function Hd(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function U0(r){let t=[1,1,1];return r.length===0||r.length===1&&r[0]===1||(t=[Gd(r),...Hd(r)]),t}function qft(r,t=!1){let n=kt().getNumber("WEBGL_MAX_TEXTURE_SIZE"),i=kt().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");i===1/0&&kt().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(i=n/2),t&&(n=n*2,i=i*2,r=r.map((c,u)=>u>=r.length-2?E4(r[u]):r[u]),r.length===1&&(r=[2,r[0]])),r.length!==2&&(r=Lc(r).newShape);let o=Nt(r),a=null;r.length<=1&&o<=n?a=[1,o]:r.length===2&&r[0]<=n&&r[1]<=n?a=r:r.length===3&&r[0]*r[1]<=n&&r[2]<=n?a=[r[0]*r[1],r[2]]:r.length===3&&r[0]<=n&&r[1]*r[2]<=n?a=[r[0],r[1]*r[2]]:r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n?a=[r[0]*r[1]*r[2],r[3]]:r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n&&(a=[r[0],r[1]*r[2]*r[3]]);const l=a!=null&&Math.max(...a)>i&&Math.min(...a)<=(t?2:1)&&Math.min(...a)>0;if(a==null||l)if(t){const c=Gd(r);let u=2,h=2;r.length&&([u,h]=Hd(r)),o=c*(u/2)*(h/2),a=A3(o).map(d=>d*2)}else a=A3(o);return a}function W0(r){return r%2===0}function T2(r,t){if(r=r.slice(-2),t=t.slice(-2),An(r,t)||!r.length||!t.length||r[0]===0||r[1]===0||t[0]===0||t[1]===0)return!0;if(r.length!==t.length){const n=r.slice(-1)[0],i=t.slice(-1)[0];if(n===i||W0(n)&&W0(i)&&(r[0]===1||t[0]===1))return!0}return r[1]===t[1]&&W0(r[0])&&W0(t[0])}let qx,Kx;function Kft(r){if(qx==null){const t=ea(r);qx=t.getParameter(t.MAX_TEXTURE_SIZE)}return qx}function Xft(r){if(Kx==null){const t=ea(r);Kx=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Kx)}function Yft(r){if(r===0)return 0;let t;const n=ea(r);return po(n,"EXT_disjoint_timer_query_webgl2")&&r===2?t=2:po(n,"EXT_disjoint_timer_query")?t=1:t=0,t}function po(r,t){return r.getExtension(t)!=null}function sE(r){try{if(ea(r)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function Zft(r){if(r===0)return!1;const t=ea(r);if(r===1){if(!po(t,"OES_texture_float"))return!1}else if(!po(t,"EXT_color_buffer_float"))return!1;return ww(t)}function Jft(r){if(r===0)return!1;const t=ea(r);if(r===1){if(!po(t,"OES_texture_float")||!po(t,"WEBGL_color_buffer_float"))return!1}else{if(po(t,"EXT_color_buffer_float"))return ww(t);const i="EXT_color_buffer_half_float";if(po(t,i)){const o=t.getExtension(i);return Qft(t,o)}return!1}return ww(t)}function ww(r){const t=hC(r),n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n);const i=1,o=1;r.texImage2D(r.TEXTURE_2D,0,t.internalFormatFloat,i,o,0,t.textureFormatFloat,t.textureTypeFloat,null);const a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n,0);const l=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(n),r.deleteFramebuffer(a),l}function Qft(r,t){const n=hC(r,t),i=r.createTexture();r.bindTexture(r.TEXTURE_2D,i);const o=1,a=1;r.texImage2D(r.TEXTURE_2D,0,n.internalFormatHalfFloat,o,a,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const l=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,l),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,i,0);const c=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(i),r.deleteFramebuffer(l),c}function tpt(r){return r!==2?!1:ea(r).fenceSync!=null}function Bg(r,t){Array.isArray(r)||(r=[r]),r.forEach(n=>{n!=null&&W(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Te=kt();Te.registerFlag("HAS_WEBGL",()=>Te.getNumber("WEBGL_VERSION")>0);Te.registerFlag("WEBGL_VERSION",()=>sE(2)?2:sE(1)?1:0);Te.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Te.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Te.get("WEBGL_VERSION")===2);Te.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Te.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Te.registerFlag("WEBGL_PACK",()=>Te.getBool("HAS_WEBGL"));Te.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Te.getBool("WEBGL_PACK"));Te.registerFlag("WEBGL_PACK_CLIP",()=>Te.getBool("WEBGL_PACK"));Te.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Te.getBool("WEBGL_PACK"));Te.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Te.getBool("WEBGL_PACK"));Te.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Te.getBool("WEBGL_PACK"));Te.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Te.getBool("WEBGL_PACK"));Te.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Te.getBool("WEBGL_PACK"));Te.registerFlag("WEBGL_PACK_REDUCE",()=>Te.getBool("WEBGL_PACK"));Te.registerFlag("WEBGL_LAZILY_UNPACK",()=>Te.getBool("WEBGL_PACK"));Te.registerFlag("WEBGL_CONV_IM2COL",()=>Te.getBool("WEBGL_PACK"));Te.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>Kft(Te.getNumber("WEBGL_VERSION")));Te.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>Xft(Te.getNumber("WEBGL_VERSION")));Te.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const r=Te.getNumber("WEBGL_VERSION");return r===0?0:Yft(r)});Te.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Te.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!OR());Te.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>Zft(Te.getNumber("WEBGL_VERSION")));Te.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Te.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Te.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Te.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Jft(Te.getNumber("WEBGL_VERSION")));Te.registerFlag("WEBGL_FENCE_API_ENABLED",()=>tpt(Te.getNumber("WEBGL_VERSION")));Te.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Te.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Te.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,r=>{if(r<0&&r!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${r}.`)});Te.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>OR()?1:-1,r=>{if(r<0&&r!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${r}.`)});Te.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Te.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Te.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Te.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Te.registerFlag("WEBGL_EXP_CONV",()=>!1);Te.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Te.getBool("IS_TEST"));Te.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Te.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Te.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Te.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vr(){let r,t,n,i,o,a,l,c,u,h;return kt().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",t="in",n="out",i="in",o="texture",a="outputColor",l="out vec4 outputColor;",c=kt().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",h=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",t="attribute",n="varying",i="varying",o="texture2D",a="gl_FragColor",l="",c=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,h=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:t,varyingVs:n,varyingFs:i,texture2D:o,output:a,defineOutput:l,defineSpecialNaN:c,defineSpecialInf:u,defineRound:h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Th(r,t,n="index"){const i=Ie(t);return i.map((o,a)=>{const l=`int ${r[a]} = ${n} / ${o}`,c=a===i.length-1?`int ${r[a+1]} = ${n} - ${r[a]} * ${o}`:`index -= ${r[a]} * ${o}`;return`${l}; ${c};`}).join("")}function Ay(r,t,n="index"){const i=Ie(t);return i.map((o,a)=>{const l=`int ${r[a]} = ${n} / outShapeStrides[${a}]`,c=a===i.length-1?`int ${r[a+1]} = ${n} - ${r[a]} * outShapeStrides[${a}]`:`index -= ${r[a]} * outShapeStrides[${a}]`;return`${l}; ${c};`}).join("")}function ept(r,t){const n=r.length,i=r.map(a=>`${t}[${a}]`),o=new Array(n-1);o[n-2]=i[n-1];for(let a=n-3;a>=0;--a)o[a]=`(${o[a+1]} * ${i[a+1]})`;return o}function npt(r,t,n="index"){const i=r.map((a,l)=>l),o=ept(i,t);return o.map((a,l)=>{const c=`int ${r[l]} = ${n} / ${o[l]}`,u=l===o.length-1?`int ${r[l+1]} = ${n} - ${r[l]} * ${o[l]}`:`index -= ${r[l]} * ${o[l]}`;return`${c}; ${u};`}).join("")}function dC(r){const t=Ie(r).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function fC(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const EL=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:NL}=sst;function spt(r,t,n){const i=[];if(r.forEach(m=>{const g=Nt(m.shapeInfo.logicalShape);if(m.shapeInfo.isUniform?i.push(`uniform float ${m.name}${g>1?`[${g}]`:""};`):(i.push(`uniform sampler2D ${m.name};`),i.push(`uniform int offset${m.name};`)),n.enableShapeUniforms){const{uniformShape:y}=pC(n.packedInputs,m.shapeInfo.logicalShape,m.shapeInfo.texShape);switch(y.length){case 1:i.push(`uniform int ${m.name}Shape;`);break;case 2:i.push(`uniform ivec2 ${m.name}Shape;`);break;case 3:i.push(`uniform ivec3 ${m.name}Shape;`);break;case 4:i.push(`uniform ivec4 ${m.name}Shape;`);break}i.push(`uniform ivec2 ${m.name}TexShape;`)}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:i.push("uniform int outShape;");break;case 2:i.push("uniform ivec2 outShape;"),i.push("uniform int outShapeStrides;");break;case 3:i.push("uniform ivec3 outShape;"),i.push("uniform ivec2 outShapeStrides;");break;case 4:i.push("uniform ivec4 outShape;"),i.push("uniform ivec3 outShapeStrides;");break}i.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(m=>{i.push(`uniform ${m.type} ${m.name}${m.arrayIndex?`[${m.arrayIndex}]`:""};`)});const o=i.join(`
`),a=r.map(m=>rpt(m,t,n.packedInputs,n.enableShapeUniforms)).join(`
`),l=t.texShape,c=Vr(),u=apt(c);let h,d,f=upt(c);return t.isPacked?(h=ipt(t.logicalShape,l,n.enableShapeUniforms),d=cpt(c)):(h=opt(t.logicalShape,l,n.enableShapeUniforms),d=lpt(c)),n.packedInputs&&(f+=ppt),[f,u,d,o,h,a,n.userCode].join(`
`)}function wf(r,t=!1){const n=r.shapeInfo.logicalShape;switch(n.length){case 0:return kpt(r,t);case 1:return Ipt(r,t);case 2:return Npt(r,t);case 3:return Mpt(r,t);case 4:return Rpt(r,t);case 5:return Opt(r);case 6:return Lpt(r);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function AL(r,t){switch(r.shapeInfo.logicalShape.length){case 0:return Cpt(r);case 1:return $pt(r,t);case 2:return Ept(r,t);case 3:return Apt(r,t);default:return Dpt(r,t)}}function rpt(r,t,n=!1,i){let o="";n?o+=AL(r,i):o+=wf(r,i);const a=r.shapeInfo.logicalShape,l=t.logicalShape;return a.length<=l.length&&(n?o+=Fpt(r,t):o+=Ppt(r,t)),o}function ipt(r,t,n){switch(r.length){case 0:return ML();case 1:return mpt(r,t,n);case 2:return _pt(r,t,n);case 3:return vpt(r,t,n);default:return xpt(r,t,n)}}function opt(r,t,n){switch(r.length){case 0:return ML();case 1:return gpt(r,t,n);case 2:return Tpt(r,t,n);case 3:return ypt(r,t,n);case 4:return bpt(r,t,n);case 5:return wpt(r,t);case 6:return Spt(r,t);default:throw new Error(`${r.length}-D output sampling is not yet supported`)}}function apt(r){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${r.texture2D}(textureSampler, uv).r;
    }
  `}function lpt(r){return`
    void setOutput(float val) {
      ${r.output} = vec4(val, 0, 0, 0);
    }
  `}function cpt(r){return`
    void setOutput(vec4 val) {
      ${r.output} = val;
    }
  `}function upt(r){return`${r.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${r.varyingFs} vec2 resultUV;
    ${r.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${r.defineSpecialNaN}
    ${r.defineSpecialInf}
    ${r.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${hpt}
    ${dpt}
    ${fpt}
  `}const hpt=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,dpt=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,fpt=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,ppt=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function ML(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function mpt(r,t,n){const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return i[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${i[1]}.0);
      }
    `:i[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${i[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));
      return 2 * (resTexRC.x * ${i[1]} + resTexRC.y);
    }
  `}function gpt(r,t,n){return t[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function vpt(r,t,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],o=Math.ceil(r[2]/2),a=o*Math.ceil(r[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));
      int index = resTexRC.x * ${i[1]} + resTexRC.y;

      int b = index / ${a};
      index -= b * ${a};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec3(b, r, c);
    }
  `}function ypt(r,t,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Ay(["r","c","d"],r)}
    return ivec3(r, c, d);
  }
`;const i=Th(["r","c","d"],r);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${i}
      return ivec3(r, c, d);
    }
  `}function xpt(r,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],o=Math.ceil(r[r.length-1]/2),a=o*Math.ceil(r[r.length-2]/2);let l=a,c="",u="b, r, c";for(let h=2;h<r.length-1;h++)l*=r[r.length-h-1],c=`
      int b${h} = index / ${l};
      index -= b${h} * ${l};
    `+c,u=`b${h}, `+u;return`
    ivec${r.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));
      int index = resTexRC.x * ${i[1]} + resTexRC.y;

      ${c}

      int b = index / ${a};
      index -= b * ${a};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec${r.length}(${u});
    }
  `}function bpt(r,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Ay(["r","c","d","d2"],r)}
      return ivec4(r, c, d, d2);
    }
  `;const i=Th(["r","c","d","d2"],r);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${i}
      return ivec4(r, c, d, d2);
    }
  `}function wpt(r,t){const n=Th(["r","c","d","d2","d3"],r);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Spt(r,t){const n=Th(["r","c","d","d2","d3","d4"],r);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function _pt(r,t,n){const i=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(An(r,t))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${i[0]}, ${i[1]}));
      }
    `;const o=Math.ceil(r[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${i[0]}, ${i[1]}));

      int index = resTexRC.x * ${i[1]} + resTexRC.y;
      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec2(r, c);
    }
  `}function Tpt(r,t,n){return An(r,t)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:r[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:r[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${r[1]};
      int c = index - r * ${r[1]};
      return ivec2(r, c);
    }
  `}function Ch(r){return`offset${r}`}function Cpt(r){const t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),i=Vr();return`
    vec4 ${n}() {
      return ${i.texture2D}(${t}, halfCR);
    }
  `}function kpt(r,t){const n=r.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(r.shapeInfo.isUniform)return`float ${i}() {return ${n};}`;const[o,a]=r.shapeInfo.texShape;if(o===1&&a===1)return`
      float ${i}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const l=Ch(n);if(t)return`
    float ${i}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${l});
      return sampleTexture(${n}, uv);
    }
  `;const[c,u]=r.shapeInfo.texShape;return`
    float ${i}() {
      vec2 uv = uvFromFlat(${c}, ${u}, ${l});
      return sampleTexture(${n}, uv);
    }
  `}function $pt(r,t){const n=r.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),o=r.shapeInfo.texShape,a=Vr();if(t)return`
    vec4 ${i}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${a.texture2D}(${n}, uv);
    }
  `;const l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return`
    vec4 ${i}(int index) {
      vec2 uv = packedUVfrom1D(
        ${l[0]}, ${l[1]}, index);
      return ${a.texture2D}(${n}, uv);
    }
  `}function Ipt(r,t){const n=r.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(r.shapeInfo.isUniform)return`
      float ${i}(int index) {
        ${Sf(r)}
      }
    `;const o=r.shapeInfo.texShape,a=o[0],l=o[1];if(l===1&&a===1)return`
      float ${i}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const c=Ch(n);return l===1?t?`
      float ${i}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${c}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${i}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${c}) + 0.5) / ${a}.0);
        return sampleTexture(${n}, uv);
      }
    `:a===1?t?`
      float ${i}(int index) {
        vec2 uv = vec2((float(index + ${c}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${i}(int index) {
        vec2 uv = vec2((float(index + ${c}) + 0.5) / ${l}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:t?`
    float ${i}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${c});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${i}(int index) {
      vec2 uv = uvFromFlat(${a}, ${l}, index + ${c});
      return sampleTexture(${n}, uv);
    }
  `}function Ept(r,t){const n=r.shapeInfo.logicalShape,i=r.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r.shapeInfo.texShape,l=a[0],c=a[1],u=Vr();if(a!=null&&An(n,a))return t?`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);

        return ${u.texture2D}(${i}, uv);
      }
    `:`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${c}.0, ${l}.0);

        return ${u.texture2D}(${i}, uv);
      }
    `;if(t)return`
    vec4 ${o}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${i}TexShape[0]) / 2.0), ceil(float(${i}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${i}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${u.texture2D}(${i}, uv);
    }
  `;const h=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],d=Math.ceil(n[1]/2);return`
    vec4 ${o}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${h[0]}, ${h[1]}, row, col);
      return ${u.texture2D}(${i}, uv);
    }
  `}function Npt(r,t){const n=r.shapeInfo.logicalShape,i=r.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r.shapeInfo.texShape;if(a!=null&&An(n,a)){if(t)return`
      float ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `;const p=a[0],m=a[1];return`
    float ${o}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${m}.0, ${p}.0);
      return sampleTexture(${i}, uv);
    }
  `}const{newShape:l,keptDims:c}=Lc(n),u=l;if(u.length<n.length){const p=_f(r,u),m=["row","col"];return`
      ${wf(p,t)}
      float ${o}(int row, int col) {
        return ${o}(${Tf(m,c)});
      }
    `}if(r.shapeInfo.isUniform)return`
      float ${o}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Sf(r)}
      }
    `;const h=a[0],d=a[1],f=Ch(i);return d===1?t?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${i}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${i}TexShape[0]));
        return sampleTexture(${i}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${h}.0);
      return sampleTexture(${i}, uv);
    }
  `:h===1?t?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${i}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${i}TexShape[1]), 0.5);
        return sampleTexture(${i}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${i}, uv);
    }
  `:t?`
      float ${o}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i}Shape[1] + col + ${f};
        vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index);
        return sampleTexture(${i}, uv);
      }
    `:`
  float ${o}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${f};
    vec2 uv = uvFromFlat(${h}, ${d}, index);
    return sampleTexture(${i}, uv);
  }
`}function Apt(r,t){const n=r.shapeInfo.logicalShape,i=r.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(n[0]===1){const p=n.slice(1),m=[1,2],g=_f(r,p),y=["b","row","col"];return`
        ${AL(g,t)}
        vec4 ${o}(int b, int row, int col) {
          return ${o}(${Tf(y,m)});
        }
      `}const c=Vr();if(t)return`
    vec4 ${o}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${i}TexShape[0]) / 2.0), ceil(float(${i}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${i}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${i}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${c.texture2D}(${i}, uv);
    }
  `;const u=l[0],h=l[1],d=Math.ceil(n[2]/2),f=d*Math.ceil(n[1]/2);return`
    vec4 ${o}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${u}, ${h}, ${f}, ${d}, b, row, col);
      return ${c.texture2D}(${i}, uv);
    }
  `}function Mpt(r,t){const n=r.shapeInfo.logicalShape,i=r.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[1]*n[2],l=n[2],{newShape:c,keptDims:u}=Lc(n),h=c;if(h.length<n.length){const y=_f(r,h),v=["row","col","depth"];return`
        ${wf(y,t)}
        float ${o}(int row, int col, int depth) {
          return ${o}(${Tf(v,u)});
        }
      `}if(r.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${a}, ${l}, 1)));
        ${Sf(r)}
      }
    `;const d=r.shapeInfo.texShape,f=d[0],p=d[1],m=r.shapeInfo.flatOffset;if(p===a&&m==null)return t?`
      float ${o}(int row, int col, int depth) {
        int stride1 = ${i}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
        float ${o}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${l}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${f}.0);
          return sampleTexture(${i}, uv);
        }
      `;if(p===l&&m==null)return t?`
      float ${o}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${i}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
    float ${o}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${f}.0);
      return sampleTexture(${i}, uv);
    }
  `;const g=Ch(i);return t?`
    float ${o}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${i}Shape[1] * ${i}Shape[2];
      int stride1 = ${i}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${g};
      vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index);
      return sampleTexture(${i}, uv);
    }
    `:`
      float ${o}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${a} + col * ${l} + depth + ${g};
        vec2 uv = uvFromFlat(${f}, ${p}, index);
        return sampleTexture(${i}, uv);
      }
  `}function Dpt(r,t){const n=r.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),o=Vr();if(t)return`
    vec4 ${i}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${o.texture2D}(${n}, uv);
    }
  `;const a=r.shapeInfo.logicalShape,l=a.length,c=r.shapeInfo.texShape,u=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],h=u[0],d=u[1],f=Math.ceil(a[l-1]/2);let p=f*Math.ceil(a[l-2]/2),m="int b, int row, int col",g=`b * ${p} + (row / 2) * ${f} + (col / 2)`;for(let y=2;y<l-1;y++)m=`int b${y}, `+m,p*=a[l-y-1],g=`b${y} * ${p} + `+g;return`
    vec4 ${i}(${m}) {
      int index = ${g};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${h});
      return ${o.texture2D}(${n}, uv);
    }
  `}function Rpt(r,t){const n=r.shapeInfo.logicalShape,i=r.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[3],l=n[2]*a,c=n[1]*l,{newShape:u,keptDims:h}=Lc(n);if(u.length<n.length){const b=_f(r,u),w=["row","col","depth","depth2"];return`
      ${wf(b,t)}
      float ${o}(int row, int col, int depth, int depth2) {
        return ${o}(${Tf(w,h)});
      }
    `}if(r.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${c}, ${l}, ${a}, 1)));
        ${Sf(r)}
      }
    `;const d=r.shapeInfo.flatOffset,f=r.shapeInfo.texShape,p=f[0],m=f[1],g=`int stride2 = ${i}Shape[3];`,y=`int stride1 = ${i}Shape[2] * stride2;`,v=`int stride0 = ${i}Shape[1] * stride1;`;if(m===c&&d==null)return t?`
      float ${o}(int row, int col, int depth, int depth2) {
        ${g}
        ${y}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${l}, ${a}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${p}.0);
        return sampleTexture(${i}, uv);
      }
    `;if(m===a&&d==null)return t?`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${i}Shape[1] * ${i}Shape[2], ${i}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${i}TexShape[1], ${i}TexShape[0]);
        return sampleTexture(${i}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${p}.0);
        return sampleTexture(${i}, uv);
      }
    `;const x=Ch(i);return t?`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${g}
      ${y}
      ${v}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${i}TexShape[0], ${i}TexShape[1], index + ${x});
      return sampleTexture(${i}, uv);
    }
  `:`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${l} +
          depth * ${a} + depth2;
      vec2 uv = uvFromFlat(${p}, ${m}, index + ${x});
      return sampleTexture(${i}, uv);
    }
  `}function Opt(r){const t=r.shapeInfo.logicalShape,n=r.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[4],a=t[3]*o,l=t[2]*a,c=t[1]*l,{newShape:u,keptDims:h}=Lc(t);if(u.length<t.length){const y=_f(r,u),v=["row","col","depth","depth2","depth3"];return`
      ${wf(y)}
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        return ${i}(${Tf(v,h)});
      }
    `}if(r.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${l}, ${a}, ${o})) +
          depth3;
        ${Sf(r)}
      }
    `;const d=r.shapeInfo.flatOffset,f=r.shapeInfo.texShape,p=f[0],m=f[1];if(m===c&&d==null)return`
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${l}, ${a}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(m===o&&d==null)return`
      float ${i}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;const g=Ch(n);return`
    float ${i}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${l} + depth * ${a} +
          depth2 * ${o} + depth3 + ${g};
      vec2 uv = uvFromFlat(${p}, ${m}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Lpt(r){const t=r.shapeInfo.logicalShape,n=r.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:o,keptDims:a}=Lc(t);if(o.length<t.length){const v=_f(r,o),x=["row","col","depth","depth2","depth3","depth4"];return`
      ${wf(v)}
      float ${i}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${i}(${Tf(x,a)});
      }
    `}const l=t[5],c=t[4]*l,u=t[3]*c,h=t[2]*u,d=t[1]*h;if(r.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${h}, ${u}, ${c})) +
          dot(
            vec2(depth3, depth4),
            vec2(${l}, 1)));
        ${Sf(r)}
      }
    `;const f=r.shapeInfo.flatOffset,p=r.shapeInfo.texShape,m=p[0],g=p[1];if(g===d&&f==null)return`
      float ${i}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${h}, ${u}, ${c}, ${l})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${m}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(g===l&&f==null)return`
      float ${i}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${m}.0);
        return sampleTexture(${n}, uv);
      }
    `;const y=Ch(n);return`
    float ${i}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${h} + depth * ${u} +
          depth2 * ${c} + depth3 * ${l} + depth4 + ${y};
      vec2 uv = uvFromFlat(${m}, ${g}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Sf(r){const t=r.name,n=Nt(r.shapeInfo.logicalShape);return n<2?`return ${t};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function Fpt(r,t){const n=r.name,i=n.charAt(0).toUpperCase()+n.slice(1),o="get"+i+"AtOutCoords",a=r.shapeInfo.logicalShape.length,l=t.logicalShape.length,c=NL(r.shapeInfo.logicalShape,t.logicalShape),u=Kn(l),h=l-a;let d;const f=["x","y","z","w","u","v"];a===0?d="":l<2&&c.length>=1?d="coords = 0;":d=c.map(b=>`coords.${f[b+h]} = 0;`).join(`
`);let p="";l<2&&a>0?p="coords":p=r.shapeInfo.logicalShape.map((b,w)=>`coords.${f[w+h]}`).join(", ");let m="return outputValue;";const y=Nt(r.shapeInfo.logicalShape)===1,x=Nt(t.logicalShape)===1;if(a===1&&!y&&!x)m=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(y&&!x)l===1?m=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:m=`
        return vec4(outputValue.x);
      `;else if(c.length){const b=a-2,w=a-1;c.indexOf(b)>-1&&c.indexOf(w)>-1?m="return vec4(outputValue.x);":c.indexOf(b)>-1?m="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(w)>-1&&(m="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${u} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${i}(${p});
      ${m}
    }
  `}function Ppt(r,t){const n=r.name,i=n.charAt(0).toUpperCase()+n.slice(1),o="get"+i+"AtOutCoords",a=t.texShape,l=r.shapeInfo.texShape,c=r.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!r.shapeInfo.isUniform&&c===u&&r.shapeInfo.flatOffset==null&&An(l,a))return`
      float ${o}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const h=Kn(u),d=NL(r.shapeInfo.logicalShape,t.logicalShape),f=u-c;let p;const m=["x","y","z","w","u","v"];c===0?p="":u<2&&d.length>=1?p="coords = 0;":p=d.map(y=>`coords.${m[y+f]} = 0;`).join(`
`);let g="";return u<2&&c>0?g="coords":g=r.shapeInfo.logicalShape.map((y,v)=>`coords.${m[v+f]}`).join(", "),`
    float ${o}() {
      ${h} coords = getOutputCoords();
      ${p}
      return get${i}(${g});
    }
  `}function Kn(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error(`GPU for rank ${r} is not yet supported`)}function pC(r,t,n){const{newShape:i,keptDims:o}=Lc(t),a=t.length,l=r&&a===3&&t[0]===1,c=l?t.slice(1):i,u=!r&&a>1&&!An(t,n)&&i.length<a||l;return{useSqueezeShape:u,uniformShape:u?c:t,keptDims:o}}function _f(r,t){const n=JSON.parse(JSON.stringify(r));return n.shapeInfo.logicalShape=t,n}function Tf(r,t){return t.map(n=>r[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bpt(r,t,n,i){const o=n.map((d,f)=>{const p={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(p.flatOffset=d.texData.slice.flatOffset),{name:t.variableNames[f],shapeInfo:p}}),a=o.map(d=>d.shapeInfo),l={logicalShape:i.shape,texShape:i.texData.texShape,isUniform:!1,isPacked:i.texData.isPacked,flatOffset:null},c=spt(o,l,t),u=Mft(r.gl,c),h=r.createProgram(u);return kt().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:c,webGLProgram:h,inShapeInfos:a,outShapeInfo:l,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:u,source:c,webGLProgram:h,inShapeInfos:a,outShapeInfo:l},DL(r,t,h))}function DL(r,t,n){const i={},o={},a={},l=[];let c,u,h,d=null,f=null;f=r.getUniformLocation(n,"NAN",!1),kt().getNumber("WEBGL_VERSION")===1&&(d=r.getUniformLocation(n,"INFINITY",!1));const p=!1;for(let m=0;m<t.variableNames.length;m++){const g=t.variableNames[m];i[g]=r.getUniformLocation(n,g,p),i[`offset${g}`]=r.getUniformLocation(n,`offset${g}`,p),t.enableShapeUniforms&&(o[`${g}Shape`]=r.getUniformLocation(n,`${g}Shape`,p),a[`${g}TexShape`]=r.getUniformLocation(n,`${g}TexShape`,p))}return t.enableShapeUniforms&&(c=r.getUniformLocation(n,"outShape",p),h=r.getUniformLocation(n,"outShapeStrides",p),u=r.getUniformLocation(n,"outTexShape",p)),t.customUniforms&&t.customUniforms.forEach((m,g)=>{l[g]=r.getUniformLocation(n,m.name,p)}),{uniformLocations:i,customUniformLocations:l,infLoc:d,nanLoc:f,inShapesLocations:o,inTexShapesLocations:a,outShapeLocation:c,outShapeStridesLocation:h,outTexShapeLocation:u}}function rE(r,t){if(r.length!==t.length)throw Error(`Binary was compiled with ${r.length} inputs, but was executed with ${t.length} inputs`);r.forEach((n,i)=>{const o=n.logicalShape,a=t[i],l=a.shape;if(!An(o,l))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${l} must match`);if(n.isUniform&&a.isUniform)return;const c=n.texShape,u=a.isUniform?null:a.texData.texShape;if(!An(c,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${c} and ${u} must match`)})}function zpt(r,t,n,i,o){t.program.enableShapeUniforms||(rE(t.inShapeInfos,n),rE([t.outShapeInfo],[i]));const a=i.texData.texture,l=i.texData.texShape;i.texData.isPacked?r.setOutputPackedMatrixTexture(a.texture,l[0],l[1]):r.setOutputMatrixTexture(a.texture,l[0],l[1]),r.setProgram(t.webGLProgram),kt().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&r.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&r.gl.uniform1f(t.nanLoc,NaN),n.forEach((u,h)=>{const d=t.program.variableNames[h],f=t.uniformLocations[d],p=t.uniformLocations[`offset${d}`],m=t.inShapesLocations[`${d}Shape`],g=t.inTexShapesLocations[`${d}TexShape`];if(m){const{uniformShape:y}=pC(t.program.packedInputs,u.shape,u.texData.texShape);switch(y.length){case 1:r.gl.uniform1iv(m,new Int32Array(y));break;case 2:r.gl.uniform2iv(m,new Int32Array(y));break;case 3:r.gl.uniform3iv(m,new Int32Array(y));break;case 4:r.gl.uniform4iv(m,new Int32Array(y));break}}if(g&&r.gl.uniform2i(g,u.texData.texShape[0],u.texData.texShape[1]),f!=null){if(u.isUniform){if(Nt(u.shape)<2)r.gl.uniform1f(f,u.uniformValues[0]);else{let y=u.uniformValues;y instanceof Float32Array||(y=new Float32Array(y)),r.gl.uniform1fv(f,y)}return}u.texData.slice!=null&&p!=null&&r.gl.uniform1i(p,u.texData.slice.flatOffset),r.setInputMatrixTexture(u.texData.texture.texture,f,h)}});const c=t.outShapeLocation;if(c)switch(i.shape.length){case 1:r.gl.uniform1iv(c,new Int32Array(i.shape));break;case 2:r.gl.uniform2iv(c,new Int32Array(i.shape));break;case 3:r.gl.uniform3iv(c,new Int32Array(i.shape));break;case 4:r.gl.uniform4iv(c,new Int32Array(i.shape));break}if(t.outShapeStridesLocation){const u=Ie(i.shape);switch(i.shape.length){case 2:r.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:r.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:r.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u));break}}t.outTexShapeLocation&&r.gl.uniform2i(t.outTexShapeLocation,i.texData.texShape[0],i.texData.texShape[1]),t.program.customUniforms&&o&&t.program.customUniforms.forEach((u,h)=>{const d=t.customUniformLocations[h],f=o[h];if(u.type==="float")r.gl.uniform1fv(d,f);else if(u.type==="vec2")r.gl.uniform2fv(d,f);else if(u.type==="vec3")r.gl.uniform3fv(d,f);else if(u.type==="vec4")r.gl.uniform4fv(d,f);else if(u.type==="int")r.gl.uniform1iv(d,f);else if(u.type==="ivec2")r.gl.uniform2iv(d,f);else if(u.type==="ivec3")r.gl.uniform3iv(d,f);else if(u.type==="ivec4")r.gl.uniform4iv(d,f);else throw Error(`uniform type ${u.type} is not supported yet.`)}),r.executeProgram()}function Vpt(r,t,n){let i="";t.concat(n).forEach(l=>{const c=l.texData!=null&&l.texData.slice!=null&&l.texData.slice.flatOffset>0;if(r.enableShapeUniforms&&!l.isUniform){const u=l.texData.texShape,{useSqueezeShape:h,uniformShape:d,keptDims:f}=pC(r.packedInputs,l.shape,u);let p="",m="",g="";if(d.length===1&&r.packedInputs){const _=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];p=`${_[0]>1}_${_[1]>1}`}else if(d.length===2&&!r.packedInputs)m=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!r.packedInputs){const _=Ie(d);g=`${_[0]===u[1]}_${_[_.length-1]===u[1]}`}const y=l.shape.length,v=d.length===2&&An(l.shape,u),x=Nt(l.shape)===1,b=Pd(l.shape,n.shape),w=!r.packedInputs&&y===n.shape.length&&An(u,n.texData.texShape),S=r.packedInputs||d.length>2?"":`${u[0]>1}_${u[1]>1}`;i+=`${y}_${w}_${h?f:""}_${d.length}_${x}_${b}_${v}_${p}_${m}_${g}_${S}_${c}`}else{const u=l.isUniform?"uniform":l.texData.texShape;i+=`${l.shape}_${u}_${c}`}});const o=r.userCode;let a=r.constructor.name;return a+="_"+i+"_"+o+`${kt().getNumber("WEBGL_VERSION")}`,a}function Ur(r){return kt().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&r<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Upt{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=nm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Vr();this.outputShape=t,this.enableShapeUniforms=Ur(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Ay(["r","c","d"],t):Th(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wpt{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=nm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Vr();this.outputShape=t,this.enableShapeUniforms=Ur(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Ay(["r","c","d"],t):Th(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gpt{constructor(t){this.variableNames=["A"],this.outTexUsage=Ri.DOWNLOAD;const n=Vr();this.outputShape=t,this.userCode=`
      ${EL}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hpt{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ri.DOWNLOAD;const n=Vr();this.outputShape=t,this.userCode=`
      ${EL}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jpt={R:0,G:1,B:2,A:3};class iE{constructor(t,n=!1,i="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const o=Vr();this.outputShape=t,this.enableShapeUniforms=Ur(this.outputShape.length);let a="result";n&&(a="floor(result * 255. + 0.5)");let l="";for(let c=0;c<i.length;c++){const u=i[c];l+=`
          if(offset == ${c}) {
            result = values[${jpt[u]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?fC():dC(t)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${i.length});

        flatIndex = idiv(flatIndex, ${i.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${o.texture2D}(A, uv);
          ${l}
        }
        ${o.output} = vec4(${a}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qpt{constructor(t,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const i=Vr();this.outputShape=t,this.enableShapeUniforms=Ur(this.outputShape.length);let o="",a="result";n&&(a="floor(result * 255. + 0.5)");for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){const u=l*2+c;o+=`
          localCoords = coords;
          if(localCoords[2] + ${c} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {
          localCoords[2] += ${c};
          if (localCoords[1] + ${l} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {
            localCoords[1] += ${l};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${i.texture2D}(A, uv);

            if (offset == 0) {
              result[${u}] = values[0];
            } else if (offset == 1) {
              result[${u}] = values[1];
            } else if (offset == 2) {
              result[${u}] = values[2];
            } else {
              result[${u}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?fC():dC(t)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${o}

          ${i.output} = ${a};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kpt(r){const t=Vr(),n=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return Aft(r,n)}function Xpt(r){const t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return Lft(r,t)}function Ypt(r){const t=new Uint16Array([0,1,2,2,1,3]);return Fft(r,t)}function zg(r,t,n,i,o,a){Bft(t,n);const l=Pft(r),c=r.TEXTURE_2D;return fe(r,()=>r.bindTexture(c,l)),fe(r,()=>r.texParameteri(c,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)),fe(r,()=>r.texParameteri(c,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)),fe(r,()=>r.texParameteri(c,r.TEXTURE_MIN_FILTER,r.NEAREST)),fe(r,()=>r.texParameteri(c,r.TEXTURE_MAG_FILTER,r.NEAREST)),kt().getNumber("WEBGL_VERSION")===1?fe(r,()=>r.texImage2D(c,0,i,t,n,0,o,a,null)):fe(r,()=>r.texStorage2D(c,1,i,t,n)),fe(r,()=>r.bindTexture(r.TEXTURE_2D,null)),{texture:l,texShape:[n,t]}}function RL(r){return r.internalFormatFloat}function Zpt(r,t,n,i){const[o,a]=Pg(t,n);return zg(r,o,a,RL(i),i.textureFormatFloat,r.FLOAT)}function OL(r){return r.internalFormatHalfFloat}function Jpt(r,t,n,i){const[o,a]=Pg(t,n);return zg(r,o,a,OL(i),i.textureFormatFloat,i.textureTypeHalfFloat)}function LL(r){return r.downloadTextureFormat}function Qpt(r,t,n,i){const[o,a]=Pg(t,n);return zg(r,o,a,LL(i),r.RGBA,r.UNSIGNED_BYTE)}function FL(r){return r.internalFormatPackedFloat}function tmt(r,t,n,i){const[o,a]=bf(t,n);return zg(r,o,a,FL(i),r.RGBA,r.FLOAT)}function PL(r){return r.internalFormatPackedHalfFloat}function emt(r,t,n,i){const[o,a]=bf(t,n);return zg(r,o,a,PL(i),r.RGBA,i.textureTypeHalfFloat)}function nmt(r,t,n){return fe(r,()=>r.bindBuffer(r.ARRAY_BUFFER,n)),eE(r,t,"clipSpacePos",n,3,20,0)&&eE(r,t,"uv",n,2,20,12)}function smt(r,t,n,i,o,a){fe(r,()=>r.bindTexture(r.TEXTURE_2D,t));let l,c,u;o instanceof Uint8Array?(l=new Uint8Array(n*i*4),c=r.UNSIGNED_BYTE,u=r.RGBA):(l=new Float32Array(n*i*4),c=r.FLOAT,u=a.internalFormatPackedFloat),l.set(o),kt().getNumber("WEBGL_VERSION")===2?fe(r,()=>r.texSubImage2D(r.TEXTURE_2D,0,0,0,n,i,r.RGBA,c,l)):fe(r,()=>r.texImage2D(r.TEXTURE_2D,0,u,n,i,0,r.RGBA,c,l)),fe(r,()=>r.bindTexture(r.TEXTURE_2D,null))}function rmt(r,t,n){fe(r,()=>r.bindTexture(r.TEXTURE_2D,t)),n.data instanceof Uint8Array?kt().getNumber("WEBGL_VERSION")===2?fe(r,()=>r.texSubImage2D(r.TEXTURE_2D,0,0,0,n.width,n.height,r.RGBA,r.UNSIGNED_BYTE,n.data)):fe(r,()=>r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n.width,n.height,0,r.RGBA,r.UNSIGNED_BYTE,n.data)):kt().getNumber("WEBGL_VERSION")===2?fe(r,()=>r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,n)):fe(r,()=>r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)),fe(r,()=>r.bindTexture(r.TEXTURE_2D,null))}function imt(r,t,n,i){const o=r.createBuffer();fe(r,()=>r.bindBuffer(r.PIXEL_PACK_BUFFER,o));const c=4*4*t*n;return fe(r,()=>r.bufferData(r.PIXEL_PACK_BUFFER,c,r.STREAM_READ)),fe(r,()=>r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,0)),fe(r,()=>r.bindBuffer(r.PIXEL_PACK_BUFFER,null)),o}function omt(r,t,n){const i=r,o=new Float32Array(n);return i.bindBuffer(i.PIXEL_PACK_BUFFER,t),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,o),i.bindBuffer(i.PIXEL_PACK_BUFFER,null),o}function amt(r,t,n,i){const[o,a]=Pg(t,n),l=4,c=new Uint8Array(Tft(t*n,l));return fe(r,()=>r.readPixels(0,0,o,a,i.downloadTextureFormat,r.UNSIGNED_BYTE,c)),new Float32Array(c.buffer)}function lmt(r,t,n,i,o,a,l,c){const u=r,h=new Float32Array(Cft(a,l));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,h),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),h}function cmt(r,t,n){const i=new Float32Array(t*n*4);return fe(r,()=>r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,i)),i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xx{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=kt().getNumber("WEBGL_VERSION");if(t!=null?(this.gl=t,wft(n,t)):this.gl=ea(n),t=this.gl,kt().getNumber("WEBGL_VERSION")===2){const a=t;this.createVertexArray=()=>fe(a,()=>a.createVertexArray()),this.bindVertexArray=l=>fe(a,()=>a.bindVertexArray(l)),this.deleteVertexArray=l=>fe(a,()=>a.deleteVertexArray(l)),this.getVertexArray=()=>fe(a,()=>a.getParameter(a.VERTEX_ARRAY_BINDING))}else if(t!=null){const a=t.getExtension("OES_vertex_array_object");if(a==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>fe(t,()=>a.createVertexArrayOES()),this.bindVertexArray=l=>fe(t,()=>a.bindVertexArrayOES(l)),this.deleteVertexArray=l=>fe(t,()=>a.deleteVertexArrayOES(l)),this.getVertexArray=()=>fe(t,()=>t.getParameter(a.VERTEX_ARRAY_BINDING_OES))}let i="WEBGL_color_buffer_float";const o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),kt().getNumber("WEBGL_VERSION")===1){const a="OES_texture_float",l="OES_texture_half_float";if(this.textureFloatExtension=z0(this.gl,a),po(this.gl,l))this.textureHalfFloatExtension=z0(this.gl,l);else if(kt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),po(this.gl,o))this.colorBufferHalfFloatExtension=z0(this.gl,o);else if(kt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",po(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else if(po(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Xpt(this.gl),this.indexBuffer=Ypt(this.gl),this.framebuffer=zft(this.gl),this.textureConfig=hC(this.gl,this.textureHalfFloatExtension)}get debug(){return kt().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;fe(t,()=>t.finish()),fe(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),fe(t,()=>t.deleteFramebuffer(this.framebuffer)),fe(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),fe(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),fe(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,n){return this.throwIfDisposed(),Zpt(this.gl,t,n,this.textureConfig)}createFloat16MatrixTexture(t,n){return this.throwIfDisposed(),Jpt(this.gl,t,n,this.textureConfig)}createUnsignedBytesMatrixTexture(t,n){return this.throwIfDisposed(),Qpt(this.gl,t,n,this.textureConfig)}uploadPixelDataToTexture(t,n){this.throwIfDisposed(),rmt(this.gl,t,n)}uploadDenseMatrixToTexture(t,n,i,o){this.throwIfDisposed(),smt(this.gl,t,n,i,o,this.textureConfig)}createFloat16PackedMatrixTexture(t,n){return this.throwIfDisposed(),emt(this.gl,t,n,this.textureConfig)}createPackedMatrixTexture(t,n){return this.throwIfDisposed(),tmt(this.gl,t,n,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(nE(this.gl,this.framebuffer),this.outputTexture=null),fe(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,n,i){return this.downloadMatrixDriver(t,()=>amt(this.gl,n,i,this.textureConfig))}downloadPackedMatrixFromBuffer(t,n,i,o,a,l){return lmt(this.gl,t,n,i,o,a,l,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,n){return omt(this.gl,t,n)}createBufferFromTexture(t,n,i){this.bindTextureToFrameBuffer(t);const o=imt(this.gl,n,i,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let n,i;if(kt().getBool("WEBGL_FENCE_API_ENABLED")){const o=t,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),i=()=>{const l=o.clientWaitSync(a,0,0);return l===o.ALREADY_SIGNALED||l===o.CONDITION_SATISFIED},n=a}else kt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),i=()=>this.isQueryAvailable(n,kt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):i=()=>!0;return{query:n,isFencePassed:i}}downloadMatrixFromPackedTexture(t,n,i){return this.downloadMatrixDriver(t,()=>cmt(this.gl,n,i))}createProgram(t){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=Kpt(n));const i=Rft(n);fe(n,()=>n.attachShader(i,this.vertexShader)),fe(n,()=>n.attachShader(i,t)),Oft(n,i);let o;return o=Object.assign(i,{vao:this.createVertexArray()}),this.bindVertexArray(o.vao),fe(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),console.assert(nmt(n,o,this.vertexBuffer),"gpgpu_util.bindVertexProgramAttributeStreams not fully successful."),this.debug&&Hx(n,o),this.setProgram(o),o}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&(fe(this.gl,()=>this.gl.deleteProgram(t)),this.deleteVertexArray(t.vao))}setProgram(t){this.throwIfDisposed(),this.program=t,this.program!=null&&(this.bindVertexArray(this.program.vao),this.debug&&Hx(this.gl,this.program)),fe(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,n,i=!0){return this.throwIfDisposed(),i?Uft(this.gl,t,n):Wft(this.gl,t,n)}getAttributeLocation(t,n){return this.throwIfDisposed(),fe(this.gl,()=>this.gl.getAttribLocation(t,n))}getUniformLocationNoThrow(t,n){return this.throwIfDisposed(),this.gl.getUniformLocation(t,n)}setInputMatrixTexture(t,n,i){this.throwIfDisposed(),this.throwIfNoProgram(),Gft(this.gl,t,n,i)}setOutputMatrixTexture(t,n,i){this.setOutputMatrixTextureDriver(t,i,n)}setOutputPackedMatrixTexture(t,n,i){this.throwIfDisposed();const[o,a]=bf(n,i);this.setOutputMatrixTextureDriver(t,o,a)}setOutputMatrixWriteRegion(t,n,i,o){this.setOutputMatrixWriteRegionDriver(i,t,o,n)}setOutputPackedMatrixWriteRegion(t,n,i,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Hx(this.gl,this.program),V0(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}fe(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),fe(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=z0(this.gl,kt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(kt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const i=this.gl,o=this.getQueryTimerExtensionWebGL2(),a=i.createQuery();return i.beginQuery(o.TIME_ELAPSED_EXT,a),a}const t=this.getQueryTimerExtensionWebGL1(),n=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,n),n}endQuery(){if(kt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,i=this.getQueryTimerExtensionWebGL2();n.endQuery(i.TIME_ELAPSED_EXT);return}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await G$(()=>this.disposed||this.isQueryAvailable(t,kt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,kt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,n){if(n===0)return null;if(n===2){const i=this.gl;return i.getQueryParameter(t,i.QUERY_RESULT)/1e6}else{const i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(t,i.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,n){if(n===0)return!0;if(n===2){const i=this.gl,o=this.getQueryTimerExtensionWebGL2(),a=i.getQueryParameter(t,i.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),a&&!this.disjoint}else{const i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(t,i.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(t){return new Promise(n=>{this.addItemToPoll(()=>t.isFencePassed(),()=>n())})}pollItems(){const t=umt(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=t;++n){const{resolveFn:i}=this.itemsToPoll[n];i()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,n){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:n}),this.itemsToPoll.length>1)return;let i;"setTimeoutCustom"in kt().platform&&(i=kt().platform.setTimeoutCustom.bind(kt().platform)),G$(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,i)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),jx(this.gl,t,this.framebuffer),this.debug&&V0(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(jx(this.gl,this.outputTexture,this.framebuffer),this.debug&&V0(this.gl)):nE(this.gl,this.framebuffer)}downloadMatrixDriver(t,n){this.bindTextureToFrameBuffer(t);const i=n();return this.unbindTextureToFrameBuffer(),i}setOutputMatrixTextureDriver(t,n,i){this.throwIfDisposed();const o=this.gl;jx(o,t,this.framebuffer),this.debug&&V0(o),this.outputTexture=t,fe(o,()=>o.viewport(0,0,n,i)),fe(o,()=>o.scissor(0,0,n,i))}setOutputMatrixWriteRegionDriver(t,n,i,o){this.throwIfDisposed(),fe(this.gl,()=>this.gl.scissor(t,n,i,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function umt(r){let t=0;for(;t<r.length&&r[t]();++t);return t-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:hmt,bincountImpl:BL,bincountReduceImpl:dmt,castImpl:fmt,ceilImpl:pmt,concatImpl:mmt,equalImpl:gmt,expImpl:vmt,expm1Impl:ymt,floorImpl:xmt,gatherNdImpl:bmt,gatherV2Impl:wmt,greaterImpl:Smt,greaterEqualImpl:_mt,lessImpl:Tmt,lessEqualImpl:Cmt,linSpaceImpl:kmt,logImpl:$mt,maxImpl:Imt,maximumImpl:Emt,minimumImpl:Nmt,multiplyImpl:Amt,negImpl:Mmt,notEqualImpl:Dmt,prodImpl:Rmt,raggedGatherImpl:Omt,raggedRangeImpl:Lmt,raggedTensorToTensorImpl:Fmt,rangeImpl:Pmt,rsqrtImpl:Bmt,scatterImpl:zmt,sigmoidImpl:Vmt,simpleAbsImpl:zL,sliceImpl:Umt,sparseFillEmptyRowsImpl:Wmt,sparseReshapeImpl:Gmt,sparseSegmentReductionImpl:VL,sqrtImpl:Hmt,stridedSliceImpl:jmt,stringNGramsImpl:qmt,stringSplitImpl:Kmt,stringToHashBucketFastImpl:Xmt,subImpl:Ymt,tileImpl:Zmt,topKImpl:Jmt,transposeImpl:mC,uniqueImpl:Qmt}=ilt;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UL(r,t){return["x","y","z","w","u","v"].slice(0,t).map(n=>`${r}.${n}`)}function Rr(r,t){return t===1?[r]:UL(r,t)}function tgt(r,t){if(r===1)return"rc";let n="";for(let i=0;i<r;i++)n+=t[i],i<r-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class egt{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=Ur(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=Rr("rc",this.rank),i=Kn(this.rank),o=this.getOutOfBoundsCondition(n),a=this.getSetup(n),l=this.getOutput(n);this.userCode=`
        void main() {
          ${i} rc = getOutputCoords();

          if(${o}) {
            setOutput(vec4(0));
          } else {
            ${a}

            setOutput(vec4(${l}));
          }
        }
      `}}getSourceCoordsArr(t){const n=[];for(let i=0;i<=1;i++)for(let o=0;o<=1;o++){let a=`${i===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let l=2;l<this.rank;l++)a=`${t[t.length-1-l]},`+a;n.push(a)}return n}getOutOfBoundsCondition(t){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let i=this.rank-2;i<this.rank;i++)n+=`${t[i]} >= ${this.enableShapeUniforms?`outShape[${i}]`:this.outputShape[i]}`,i<this.rank-1&&(n+="||");return n}getSetup(t){if(this.rank===1)return"";const n=t.slice(-2),i=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],o=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${i};
      bool rEdge = rp1 >= ${o};
    `}getOutput(t){const n=this.getSourceCoordsArr(t);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WL{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=Ur(this.outputShape.length);let i="";for(let o=0;o<4;o++){let a="thisRC = rc;";o%2===1&&(a+="thisRC.z += 1;"),o>1&&(a+="thisRC.y += 1;"),i+=`
        ${a}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${ngt(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?fC():dC(t)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};

        ${i}

        setOutput(result);
      }
    `}}function ngt(r,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?npt(["r","c","d"],"inputShape"):Th(["r","c","d"],r)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sgt{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(t,n,i){const o=aE(n,i),a=lE(t,o,i);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);const l=oE(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,i);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=l,this.log();const u=this.freeTextures[a].shift();return this.usedTextures[a].push(u),u}let c;return o===or.PACKED_2X2_FLOAT32?c=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===or.PACKED_2X2_FLOAT16?c=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===or.UNPACKED_FLOAT32?c=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===or.UNPACKED_FLOAT16?c=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===or.PACKED_4X1_UNSIGNED_BYTE&&(c=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[a].push(c),this.numUsedTextures++,this._numBytesAllocated+=l,this.log(),c}releaseTexture(t,n,i,o){if(this.freeTextures==null)return;const a=aE(i,o),l=lE(n,a,o);l in this.freeTextures||(this.freeTextures[l]=[]);const c=oE(n,a,this.gpgpu.gl,this.gpgpu.textureConfig,o),u=kt().get("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=c):(this.freeTextures[l].push(t),this.numFreeTextures++,this._numBytesFree+=c),this.numUsedTextures--;const h=this.usedTextures[l],d=h.indexOf(t);if(d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");h.splice(d,1),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const t in this.freeTextures)this.freeTextures[t].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const t in this.usedTextures)this.usedTextures[t].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function rgt(r,t){const n=r;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===r.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function oE(r,t,n,i,o){const a=igt(t,i);let l;if(o){const[u,h]=bf(r[0],r[1]);l=u*h}else{const[u,h]=Pg(r[0],r[1]);l=u*h}const c=rgt(n,a);return l*c}function igt(r,t){switch(r){case or.PACKED_2X2_FLOAT32:return FL(t);case or.PACKED_2X2_FLOAT16:return PL(t);case or.UNPACKED_FLOAT32:return RL(t);case or.UNPACKED_FLOAT16:return OL(t);case or.PACKED_4X1_UNSIGNED_BYTE:return LL(t);default:throw new Error(`Unknown physical texture type ${r}`)}}function ogt(r){return kt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?r?or.PACKED_2X2_FLOAT32:or.UNPACKED_FLOAT32:r?or.PACKED_2X2_FLOAT16:or.UNPACKED_FLOAT16}function aE(r,t){if(r===Ri.UPLOAD)return or.PACKED_2X2_FLOAT32;if(r===Ri.RENDER||r==null)return ogt(t);if(r===Ri.DOWNLOAD||r===Ri.PIXELS)return or.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${r}`)}function lE(r,t,n){return`${r[0]}_${r[1]}_${t}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ka{constructor(t,n){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=Ur(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Io="if (isnan(x)) return x;",agt="return x;",cE="return abs(x);",lgt="return (x >= 0.0) ? x : (exp(x) - 1.0);",cgt=Io+`
  return (x < 0.0) ? 0.0 : x;
`,ugt=Io+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Zl="return x;",hgt="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dgt="return x;",fgt=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,pgt=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,mgt=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ggt="return 1.0 / (1.0 + exp(-1.0 * x));";class rc{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=Ur(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vgt{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=Ur(this.outputShape.length);const n=t.length,i=Rr("rc",n),o=Kn(n),a=tgt(n,i),l=i.slice(-2),c=n<=1?"rc":`vec2(${l.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${a});

        setOutput(getChannel(packedInput, ${c}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ygt=R9,xgt=1e-7,bgt=1e-4,G0={};function wgt(r){return r in G0||(G0[r]={}),G0[r]}const Sgt=kt().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),_gt=600;function Tgt(){return kt().global.screen==null?1024:kt().global.screen.height*kt().global.screen.width*window.devicePixelRatio*_gt/1024/1024}class My extends I4{constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!kt().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(t!=null){if(t instanceof Xx)n=t;else{const i=ea(kt().getNumber("WEBGL_VERSION"),t);n=new Xx(i)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const i=ea(kt().getNumber("WEBGL_VERSION"));n=new Xx(i),this.binaryCache=wgt(kt().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new sgt(this.gpgpu),this.numMBBeforeWarning=Tgt(),this.texData=new tR(this,ga())}nextDataId(){return My.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,n,i,o,a,l){const c=this.makeTensorInfo(n,i),u=this.texData.get(c.dataId);u.isPacked=!1,u.texture={texture:t,texShape:[o,a]},u.texShape=[o,a];const h=U0(n),d=new iE(h,!1,l),f=this.runWebGLProgram(d,[c],i,[[o,a]]);return f.shape=n,u.texture=null,this.disposeIntermediateTensorInfo(c),f.dataId}write(t,n,i){if((kt().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||kt().getBool("DEBUG"))&&this.checkNumericalProblems(t),i==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const o={id:this.nextDataId()};return this.texData.set(o,{shape:n,dtype:i,values:t,usage:Ri.UPLOAD,refCount:1}),o}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){const n=this.texData.get(t);n.refCount++}decRef(t){if(this.texData.has(t)){const n=this.texData.get(t);n.refCount--}}move(t,n,i,o,a){if(kt().getBool("DEBUG")&&this.checkNumericalProblems(n),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:o,values:n,usage:Ri.UPLOAD,refCount:a})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const n=this.texData.get(t),{values:i,dtype:o,complexTensorInfos:a,slice:l,shape:c,isPacked:u}=n;if(l!=null){let p;u?p=new rc(c,Zl):p=new ka(c,Zl);const m=this.runWebGLProgram(p,[{dataId:t,shape:c,dtype:o}],o),g=this.readSync(m.dataId);return this.disposeIntermediateTensorInfo(m),g}if(i!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return i;const h=this.activeTimers!=null;let d;h&&(d=Kr());let f;if(o==="complex64"){const p=this.readSync(a.real.dataId),m=this.readSync(a.imag.dataId);f=Sl(p,m)}else f=this.getValuesFromTexture(t);return h&&(this.downloadWaitMs+=Kr()-d),this.convertAndCacheOnCPU(t,f)}async read(t){if(this.pendingRead.has(t)){const g=this.pendingRead.get(t);return new Promise(y=>g.push(y))}const n=this.texData.get(t),{values:i,shape:o,slice:a,dtype:l,complexTensorInfos:c,isPacked:u}=n;if(a!=null){let g;u?g=new rc(o,Zl):g=new ka(o,Zl);const y=this.runWebGLProgram(g,[{dataId:t,shape:o,dtype:l}],l),v=this.read(y.dataId);return this.disposeIntermediateTensorInfo(y),v}if(i!=null)return this.convertAndCacheOnCPU(t);if(kt().getBool("DEBUG")&&!kt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&kt().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let h=null,d;if(l!=="complex64"&&kt().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(t);const g=this.texData.get(d.dataId);h=this.gpgpu.createBufferFromTexture(g.texture.texture,...B0(o))}this.pendingRead.set(t,[]),l!=="complex64"&&await this.gpgpu.createAndWaitForFence();let f;if(l==="complex64"){const g=await Promise.all([this.read(c.real.dataId),this.read(c.imag.dataId)]),y=g[0],v=g[1];f=Sl(y,v)}else if(h==null)f=this.getValuesFromTexture(t);else{const g=Nt(o);f=this.gpgpu.downloadFloat32MatrixFromBuffer(h,g)}if(d!=null&&this.disposeIntermediateTensorInfo(d),h!=null){const g=this.gpgpu.gl;fe(g,()=>g.deleteBuffer(h))}const p=this.convertAndCacheOnCPU(t,f),m=this.pendingRead.get(t);return this.pendingRead.delete(t),m.forEach(g=>g(p)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&ga().removeDataId(t,this),this.pendingDeletes--),p}readToGPU(t,n={}){const i=this.texData.get(t),{values:o,shape:a,slice:l,dtype:c,isPacked:u,texture:h}=i;if(c==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(l!=null){let m;u?m=new rc(a,Zl):m=new ka(a,Zl);const g=this.runWebGLProgram(m,[{dataId:t,shape:a,dtype:c}],c),y=this.readToGPU(g,n);return this.disposeIntermediateTensorInfo(g),y}if(h==null)throw o!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(t,n.customTexShape),f=ga().makeTensorFromTensorInfo(d),p=this.texData.get(d.dataId);return Object.assign({tensorRef:f},p.texture)}bufferSync(t){const n=this.readSync(t.dataId);if(t.dtype==="string")try{const i=n.map(o=>Sc(o));return rn(t.shape,t.dtype,i)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return rn(t.shape,t.dtype,n)}checkNumericalProblems(t){if(t!=null)for(let n=0;n<t.length;n++){const i=t[n];if(!Eft(i))throw kt().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${i} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${i} cannot be represented on this device.`)}}getValuesFromTexture(t){const{shape:n,dtype:i,isPacked:o}=this.texData.get(t),a=Nt(n);if(kt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const p=this.decode(t),m=this.texData.get(p.dataId),g=this.gpgpu.downloadMatrixFromPackedTexture(m.texture.texture,...B0(n)).subarray(0,a);return this.disposeIntermediateTensorInfo(p),g}const l=kt().getBool("WEBGL_PACK")&&o===!0,c=l?U0(n):n,u=l?new Hpt(c):new Gpt(c),h=this.runWebGLProgram(u,[{shape:c,dtype:i,dataId:t}],"float32"),d=this.texData.get(h.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(h),f}timerAvailable(){return kt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const n=this.activeTimers,i=[];let o=!1;this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t();const a=Dd(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),l=Dd(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=n,o&&(this.programTimersStack=null);const c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(kt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const u=await Promise.all(a);c.kernelMs=YX(u),c.getExtraProfileInfo=()=>u.map((h,d)=>({name:l[d],ms:h})).map(h=>`${h.name}: ${h.ms}`).join(", ")}else c.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,c})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return kt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Kr(),endMs:null}}endTimer(t){return kt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Kr(),t)}async getQueryTime(t){if(kt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const n=t;return n.endMs-n.startMs}disposeData(t,n=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:i}=this.texData.get(t);return i!=null&&(this.disposeData(i.real.dataId,n),this.disposeData(i.imag.dataId,n)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:n,dtype:i,texShape:o,usage:a,isPacked:l,slice:c}=this.texData.get(t),u=c&&c.origDataId||t,h=this.dataRefCount.get(u);h>1?this.dataRefCount.set(u,h-1):(this.dataRefCount.delete(u),n!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(n,o,a,l)));const d=this.texData.get(t);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,n=Sgt){return kt().getBool("WEBGL_CPU_FORWARD")&&t.every(i=>this.texData.get(i.dataId).texture==null&&Nt(i.shape)<n)}getGPGPUContext(){return this.gpgpu}where(t){Di("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=t.dataSync();return ygt(t.shape,n)}packedUnaryOp(t,n,i){const o=new rc(t.shape,n),a=this.compileAndRun(o,[t],i);return ga().makeTensorFromTensorInfo(a)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){const o=zL(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,o)}if(kt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,cE,t.dtype);const n=new ka(t.shape,cE),i=this.compileAndRun(n,[t]);return ga().makeTensorFromTensorInfo(i)}makeTensorInfo(t,n,i){let o;if(n==="string"&&i!=null&&i.length>0&&Cm(i[0])){const a=i.map(l=>hc(l));o=this.write(a,t,n)}else o=this.write(i,t,n);return this.texData.get(o).usage=null,{dataId:o,shape:t,dtype:n}}makeOutput(t,n,i){return ga().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,i),this)}unpackTensor(t){const n=new vgt(t.shape);return this.runWebGLProgram(n,[t],t.dtype)}packTensor(t){const n=new egt(t.shape),i=!0;return this.runWebGLProgram(n,[t],t.dtype,null,i)}packedReshape(t,n){const i=[Gd(t.shape),...Hd(t.shape)],o={dtype:t.dtype,shape:i,dataId:t.dataId},a=[Gd(n),...Hd(n)],l=new WL(a,i),c=!0,u=[i],h=this.runWebGLProgram(l,[o],t.dtype,u,c);return{dataId:h.dataId,shape:n,dtype:h.dtype}}decode(t,n){const i=this.texData.get(t),{isPacked:o,shape:a,dtype:l}=i;if(n!=null){const p=Nt(a),m=n[0]*n[1]*4;W(p<=m,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const c=U0(a);let u;o?u=new Wpt(c):u=new Upt(c);const h=!0,d=[n??B0(c)],f=this.runWebGLProgram(u,[{shape:c,dtype:l,dataId:t}],l,d,h,n);return{dtype:l,shape:a,dataId:f.dataId}}runWebGLProgram(t,n,i,o,a=!1,l){const c=this.makeTensorInfo(t.outputShape,i),u=this.texData.get(c.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===nm.DENSE){const x=l??B0(t.outputShape);u.texShape=x.map(b=>b*2)}if(t.outTexUsage!=null&&(u.usage=t.outTexUsage),Nt(c.shape)===0)return u.values=hr(c.dtype,0),c;const h=[],d=n.map(x=>{if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(x.dataId);if(b.texture==null){if(!t.packedInputs&&Nt(x.shape)<=kt().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=x.shape)}if(this.uploadToGPU(x.dataId),!!b.isPacked!=!!t.packedInputs)x=b.isPacked?this.unpackTensor(x):this.packTensor(x),h.push(x),b=this.texData.get(x.dataId);else if(b.isPacked&&!T2(b.shape,x.shape)){const w=x,S=x.shape;x.shape=b.shape,x=this.packedReshape(x,S),h.push(x),b=this.texData.get(x.dataId),w.shape=S}return{shape:x.shape,texData:b,isUniform:!1}});this.uploadToGPU(c.dataId);const f={shape:c.shape,texData:u,isUniform:!1},p=Vpt(t,d,f),m=this.getAndSaveBinary(p,()=>Bpt(this.gpgpu,t,d,f)),g=this.activeTimers!=null;let y;g&&(y=this.startTimer()),kt().get("ENGINE_COMPILE_ONLY")||zpt(this.gpgpu,m,d,f,o),h.forEach(x=>this.disposeIntermediateTensorInfo(x)),g&&(y=this.endTimer(y),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(y)}));const v=kt().get("WEBGL_FLUSH_THRESHOLD");if(v>0){const x=Kr();x-this.lastGlFlushTime>v&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=x)}if(!kt().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&a===!1){const x=this.unpackTensor(c);return this.disposeIntermediateTensorInfo(c),x}return c}compileAndRun(t,n,i,o,a=!1){return i=i||n[0].dtype,this.runWebGLProgram(t,n,i,o,a)}getAndSaveBinary(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(kt().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=_t(()=>{if(!kt().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=kt().getBool("DEBUG");kt().set("DEBUG",!1);const n=this.abs(Pe(1e-8)).dataSync()[0];if(kt().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?xgt:bgt}uploadToGPU(t){const n=this.texData.get(t),{shape:i,dtype:o,values:a,texture:l,usage:c,isPacked:u}=n;if(l!=null)return;const h=this.activeTimers!=null;let d;h&&(d=Kr());let f=n.texShape;if(f==null&&(f=qft(i,u),n.texShape=f),a!=null){const p=U0(i);let m,g=f[1],y=f[0];const v=a instanceof Uint8Array||a instanceof Uint8ClampedArray;(u||!v)&&([g,y]=bf(f[0],f[1])),u?m=new qpt(p,v):m=new iE(p,v);const x=v?[y,g]:f,b=this.makeTensorInfo(x,o),w=this.texData.get(b.dataId);v?w.usage=Ri.PIXELS:w.usage=Ri.UPLOAD,w.texShape=x,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),g,y,a);const S=[[y,g]],_=!0,$=this.runWebGLProgram(m,[b],o,S,_),N=this.texData.get($.dataId);n.texShape=N.texShape,n.isPacked=N.isPacked,n.usage=N.usage,kt().get("ENGINE_COMPILE_ONLY")?this.disposeData($.dataId):(n.texture=N.texture,n.values=null,this.texData.delete($.dataId)),this.disposeIntermediateTensorInfo(b),h&&(this.uploadWaitMs+=Kr()-d)}else{const p=this.acquireTexture(f,c,o,u);n.texture=p}}convertAndCacheOnCPU(t,n){const i=this.texData.get(t),{dtype:o}=i;return n!=null&&(i.values=Cgt(n,o)),i.values}acquireTexture(t,n,i,o){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${a} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,n,o)}computeBytes(t,n){return t[0]*t[1]*M3(n)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(n));return Promise.all(t)}else{for(const[,n]of Object.entries(this.binaryCache)){const i=new Promise(o=>{try{this.checkCompletion_(n),o(!0)}catch(a){throw a}});t.push(i)}return Promise.all(t)}}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await P9(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(IL(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const[,t]of Object.entries(this.binaryCache)){const{uniformLocations:n,customUniformLocations:i,infLoc:o,nanLoc:a,inShapesLocations:l,inTexShapesLocations:c,outShapeLocation:u,outShapeStridesLocation:h,outTexShapeLocation:d}=DL(this.gpgpu,t.program,t.webGLProgram);t.uniformLocations=n,t.customUniformLocations=i,t.infLoc=o,t.nanLoc=a,t.inShapesLocations=l,t.inTexShapesLocations=c,t.outShapeLocation=u,t.outShapeStridesLocation=h,t.outTexShapeLocation=d}}createTensorFromTexture(t,n,i){const{texture:o,height:a,width:l,channels:c}=t,u=ga().backend;if(!u.gpgpu.gl.isTexture(o))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const h=u.writeTexture(o,n,i,a,l,c);return ga().makeTensorFromDataId(h,n,i,u)}}My.nextDataId=0;function Cgt(r,t){if(t==="float32"||t==="complex64")return r;if(t==="int32"||t==="bool"){const n=t==="int32"?new Int32Array(r.length):new Uint8Array(r.length);for(let i=0;i<n.length;++i)n[i]=Math.round(r[i]);return n}else throw new Error(`Unknown dtype ${t}`)}/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */LR()&&YR("webgl",()=>new My,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gC=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class jd{constructor(t,n,i){this.variableNames=["A","B"],this.outputShape=qe(n,i),this.enableShapeUniforms=Ur(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${t}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vg=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Ug{constructor(t,n,i,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=qe(n,i);const a=this.outputShape.length;this.enableShapeUniforms=Ur(a);let l="";if(o)if(a===0||Nt(this.outputShape)===1)l=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(l=`
          ${Kn(a)} coords = getOutputCoords();
        `,a===1)this.enableShapeUniforms?l+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:l+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const u=Rr("coords",a);this.enableShapeUniforms?l+=`
            bool nextRowOutOfBounds =
              (${u[a-2]} + 1) >= outShape[${a} - 2];
            bool nextColOutOfBounds =
              (${u[a-1]} + 1) >= outShape[${a} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:l+=`
            bool nextRowOutOfBounds =
              (${u[a-2]} + 1) >= ${this.outputShape[a-2]};
            bool nextColOutOfBounds =
              (${u[a-1]} + 1) >= ${this.outputShape[a-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${t}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${l}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xi(r){const{inputs:t,backend:n}=r,{x:i}=t;return n.incRef(i.dataId),{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}const kgt={kernelName:qm,backendName:"webgl",kernelFunc:xi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jc(r){const{inputs:t,backend:n}=r,{real:i,imag:o}=t,a=n.makeTensorInfo(i.shape,"complex64"),l=n.texData.get(a.dataId),c=xi({inputs:{x:i},backend:n}),u=xi({inputs:{x:o},backend:n});return l.complexTensorInfos={real:c,imag:u},a}const $gt={kernelName:P4,backendName:"webgl",kernelFunc:jc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GL="return (a < 0.) ? b * a : a;",HL=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Igt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{alpha:a}=i,l=n.makeTensorInfo([],"float32",Fc(a,"float32")),c=kt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ug(HL,o.shape,l.shape):new jd(GL,o.shape,l.shape),u=n.runWebGLProgram(c,[o,l],"float32");return n.disposeIntermediateTensorInfo(l),u}const Egt={kernelName:Sv,backendName:"webgl",kernelFunc:Igt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jL="return (a < 0.) ? b * a : a;",qL=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Ngt(r){const{inputs:t,backend:n}=r,{x:i,alpha:o}=t,a=kt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ug(qL,i.shape,o.shape):new jd(jL,i.shape,o.shape);return n.runWebGLProgram(a,[i,o],"float32")}const Agt={kernelName:Vv,backendName:"webgl",kernelFunc:Ngt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cf="if (isnan(x)) return x;";function _n({opSnippet:r,packedOpSnippet:t,cpuKernelImpl:n,dtype:i}){return({inputs:o,backend:a})=>{const{x:l}=o,c=a,u=i||l.dtype;if(c.shouldExecuteOnCPU([l])&&n!=null){const f=c.texData.get(l.dataId),p=n(f.values,u);return c.makeTensorInfo(l.shape,u,p)}const h=kt().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null;let d;return h?d=new rc(l.shape,t):d=new ka(l.shape,r),c.runWebGLProgram(d,[l],u)}}function pr({opSnippet:r,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:i=!1,cpuKernelImpl:o,dtype:a}){return({inputs:l,backend:c})=>{const{a:u,b:h}=l,d=c;if(i&&u.dtype==="complex64"){const g=d.texData.get(u.dataId),y=d.texData.get(h.dataId),[v,x]=[[g.complexTensorInfos.real,y.complexTensorInfos.real],[g.complexTensorInfos.imag,y.complexTensorInfos.imag]].map(w=>{const[S,_]=w,$={dataId:S.dataId,dtype:S.dtype,shape:u.shape},N={dataId:_.dataId,dtype:_.dtype,shape:h.shape},k=new jd(r,u.shape,h.shape);return d.runWebGLProgram(k,[$,N],gi(S.dtype,_.dtype))}),b=jc({inputs:{real:v,imag:x},backend:d});return d.disposeIntermediateTensorInfo(v),d.disposeIntermediateTensorInfo(x),b}const f=a||gi(u.dtype,h.dtype);if((u.dtype==="string"||h.dtype==="string"||d.shouldExecuteOnCPU([u,h]))&&o!=null){const g=d.texData.get(u.dataId).values,y=d.texData.get(h.dataId).values,v=u.dtype==="string"?Ju(g):g,x=u.dtype==="string"?Ju(y):y,[b,w]=o(u.shape,h.shape,v,x,f),S=d.makeTensorInfo(w,f),_=d.texData.get(S.dataId);return _.values=b,S}const p=kt().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null;let m;return p?m=new Ug(t,u.shape,h.shape,n):m=new jd(r,u.shape,h.shape),d.runWebGLProgram(m,[u,h],f)}}function sm(r,t=!1){if(r==="linear")return t?dgt:agt;if(r==="relu")return t?pgt:cgt;if(r==="elu")return t?fgt:lgt;if(r==="relu6")return t?mgt:ugt;if(r==="prelu")return t?qL:jL;if(r==="leakyrelu")return t?HL:GL;if(r==="sigmoid")return t?ggt:hgt;throw new Error(`Activation ${r} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KL{constructor(t,n,i,o=!1,a=!1,l=!1,c=null,u=!1,h=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i,this.enableShapeUniforms=Ur(this.outputShape.length);const d=o?t[1]:t[2],f=Math.ceil(d/2),p=o?"i * 2, rc.y":"rc.y, i * 2",m=a?"rc.z, i * 2":"i * 2, rc.z",g=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],y=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let v="",x="";c&&(u?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${c}
        }`:h?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${c}
        }`:v=`vec4 activation(vec4 x) {
          ${c}
        }`,x="result = activation(result);");const b=l?"result += getBiasAtOutCoords();":"";l&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),h&&this.variableNames.push("leakyreluAlpha");let w="rc.x",S="rc.x";t[0]<n[0]?w=`int(min(float(rc.x), ${t[0]-1}.))`:n[0]<t[0]&&(S=`int(min(float(rc.x), ${n[0]-1}.))`),this.userCode=`
      ${v}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${f}; i++) {
          int batchA = ${w};
          int batchB = ${S};
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${m});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${g[0]} * ${y[0]});
          result += (${g[1]} * ${y[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${x}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uE={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class hE{constructor(t,n,i){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=qe(n,i),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${t}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dE="return a * b;";function vC(r){const{inputs:t,backend:n}=r,{a:i,b:o}=t,a=gi(i.dtype,o.dtype);if(i.dtype==="complex64"){const c=n.texData.get(i.dataId),u=n.texData.get(o.dataId),h=new hE(uE.REAL,i.shape,o.shape),d=new hE(uE.IMAG,i.shape,o.shape),f=[{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:i.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:i.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:o.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:o.shape}],p=n.runWebGLProgram(h,f,"float32"),m=n.runWebGLProgram(d,f,"float32"),g=jc({inputs:{real:p,imag:m},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}if(n.shouldExecuteOnCPU([i,o])){const c=n.texData.get(i.dataId),u=n.texData.get(o.dataId),[h,d]=Amt(i.shape,o.shape,c.values,u.values,a),f=n.makeTensorInfo(d,a),p=n.texData.get(f.dataId);return p.values=h,f}let l;return kt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?l=new Ug(dE,i.shape,o.shape):l=new jd(dE,i.shape,o.shape),n.runWebGLProgram(l,[i,o],a)}const Mgt={kernelName:ng,backendName:"webgl",kernelFunc:vC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dgt(r,t,n){const i=[Gd(r.shape),...Hd(r.shape)],o={dtype:r.dtype,shape:i,dataId:r.dataId},a=[Gd(t),...Hd(t)],l=new WL(a,i),c=!0,u=[i],h=n.runWebGLProgram(l,[o],r.dtype,u,c);return{dataId:h.dataId,shape:t,dtype:h.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ue(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{shape:a}=i,l=n,c=Nt(o.shape),u=nR(a,c),h=Nt(u);W(c===h,()=>`The new shape (${u}) has ${h} elements and the old shape (${o.shape}) has ${c} elements. The new shape and old shape must have the same number of elements.`);const d=l.texData.get(o.dataId);return d.isPacked&&!T2(o.shape,u)&&!(d.texture!==null&&T2(d.shape,u))?Dgt(o,u,l):(l.incRef(o.dataId),{dataId:o.dataId,shape:u,dtype:o.dtype})}const Rgt={kernelName:Wv,backendName:"webgl",kernelFunc:ue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fE{constructor(t,n){this.variableNames=["x"];const{windowSize:i,batchSize:o,inSize:a,outSize:l}=t;this.outputShape=[o,l];const c=Math.floor(i/4)*4,u=i%4;let h="sumValue += dot(values, ones);";if(n!=null){const f=1/n;h=`sumValue += dot(values * ${Rd(f)?f.toPrecision(2):f}, ones);`}let d="";a%i>0&&(d=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${c};
        if (${u===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${h}
        } else if (${u===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${h}
        } else if (${u===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${h}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ogt{constructor(t,n){this.variableNames=["x"];const{windowSize:i,batchSize:o,inSize:a,outSize:l}=t;this.outputShape=[o,l];let c="0.0",u="";n==="prod"?c="1.0":n==="min"?(c="1.0 / 1e-20",u="min"):n==="max"&&(c="-1.0 / 1e-20",u="max");let h=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?h="sumValue":n==="prod"?h="prodValue":n==="all"?h="allValue":n==="any"&&(h="anyValue");const d=Math.floor(i/4)*4,f=i%4;let p=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${u}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${u}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,m="vec4";n==="all"?(c="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,m="bvec4"):n==="any"&&(c="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,m="bvec4");let g="";a%i>0&&(g=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${c};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        vec4 minMaxValue = vec4(${c});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===2}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===3}) {
          ${m} values = ${m}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${h});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lgt(r){const t=[];for(;t.length===0||t[t.length-1].outSize!==1;){const n=t.length?t[t.length-1].outSize:r[1],i=py(n);t.push({inSize:n,windowSize:i,outSize:Math.ceil(n/i)})}return t}function kh(r,t,n,i){const o=Lgt(r.shape);let a=r;for(let l=0;l<o.length;l++){const{inSize:c,windowSize:u,outSize:h}=o[l];let d,f;n==="mean"?d=l===0?new fE({windowSize:u,inSize:c,batchSize:r.shape[0],outSize:h},c):new fE({windowSize:u,inSize:c,batchSize:r.shape[0],outSize:h}):d=new Ogt({windowSize:u,inSize:c,batchSize:r.shape[0],outSize:h},n),f=a,a=i.runWebGLProgram(d,[a],t),f.dataId!==r.dataId&&i.disposeIntermediateTensorInfo(f)}return a}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fgt{constructor(t,n){this.variableNames=["A"];const i=new Array(t.length);for(let l=0;l<i.length;l++)i[l]=t[n[l]];this.outputShape=i,this.rank=i.length;const o=Kn(this.rank),a=Pgt(n);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${a}));
    }
    `}}function Pgt(r){const t=r.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],i=new Array(t);for(let o=0;o<r.length;o++)i[r[o]]=n[o];return i.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bgt{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const i=new Array(t.length);for(let d=0;d<i.length;d++)i[d]=t[n[d]];if(this.outputShape=i,this.rank=i.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const o=Kn(this.rank),a=UL("rc",this.rank),l=new Array(this.rank);for(let d=0;d<n.length;d++)l[n[d]]=a[d];const c=`vec2(${l.slice(-2).join()})`,u=`++${a[this.rank-1]} < ${i[this.rank-1]}`,h=`getChannel(getA(${l.join()}), ${c})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${h};
      if(${u}) {
        result[1] = ${h};
      }
      --${a[this.rank-1]};
      if(++${a[this.rank-2]} < ${i[this.rank-2]}) {
        result[2] = ${h};
        if(${u}) {
          result[3] = ${h};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dy(r,t,n){const i=kt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Bgt(r.shape,t):new Fgt(r.shape,t);return n.runWebGLProgram(i,[r],r.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zgt(r,t,n,i){const o=t,a=r.shape.length,l=on(o,r.shape);let c=l;const u=ms(c,a),h=u!=null;let d=r;h&&(d=Dy(r,u,i),c=_s(c.length,a)),fr("sum",c,a);const[f,p]=Zs(d.shape,c);let m=f;n&&(m=Ss(f,l));const g=Nt(p),v=Nt(r.shape)/g,x=ue({inputs:{x:d},attrs:{shape:[v,g]},backend:i}),b=T_(r.dtype),w=kh(x,b,"sum",i),S=ue({inputs:{x:w},attrs:{shape:m},backend:i});return i.disposeIntermediateTensorInfo(x),i.disposeIntermediateTensorInfo(w),h&&i.disposeIntermediateTensorInfo(d),S}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ry(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a,keepDims:l}=i;return zgt(o,a,l,n)}const Vgt={kernelName:Xv,backendName:"webgl",kernelFunc:Ry};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zr(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{perm:a}=i,l=n,c=o.shape.length,u=new Array(c);for(let d=0;d<u.length;d++)u[d]=o.shape[a[d]];let h;if(l.shouldExecuteOnCPU([o])){const f=l.texData.get(o.dataId).values,p=mC(f,o.shape,o.dtype,a,u);h=l.makeTensorInfo(u,o.dtype);const m=l.texData.get(h.dataId);m.values=p}else h=Dy(o,a,l);return h}const Ugt={kernelName:wd,backendName:"webgl",kernelFunc:zr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XL=1e3;function C2({a:r,b:t,transposeA:n,transposeB:i,backend:o,bias:a=null,preluActivationWeights:l=null,leakyreluAlpha:c=0,activation:u=null}){const h=r.shape.length,d=t.shape.length,f=n?r.shape[h-2]:r.shape[h-1],p=i?t.shape[d-1]:t.shape[d-2],m=n?r.shape[h-1]:r.shape[h-2],g=i?t.shape[d-2]:t.shape[d-1],y=r.shape.slice(0,-2),v=t.shape.slice(0,-2),x=Nt(y),b=Nt(v),S=qe(r.shape.slice(0,-2),t.shape.slice(0,-2)).concat([m,g]);W(f===p,()=>`Error in matMul: inner shapes (${f}) and (${p}) of Tensors with shapes ${r.shape} and ${t.shape} and transposeA=${n} and transposeB=${i} must match.`);const _=n?[x,f,m]:[x,m,f],$=i?[b,g,p]:[b,p,g],N=ue({inputs:{x:r},backend:o,attrs:{shape:_}}),k=ue({inputs:{x:t},backend:o,attrs:{shape:$}}),I=[N,k],O=Math.max(x,b),B=n?N.shape[1]:N.shape[2],F=a!=null,D=l!=null,L=u==="leakyrelu",V=u!=null?sm(u,!0):null,j=F||D||L||V!=null;let Y;if((m===1||g===1)&&B>XL&&j===!1){let et=N,it=k;n&&(et=zr({inputs:{x:N},backend:o,attrs:{perm:[0,2,1]}}),I.push(et)),i&&(it=zr({inputs:{x:k},backend:o,attrs:{perm:[0,2,1]}}),I.push(it));const J=g!==1,rt=g===1;let ut=et;J&&(ut=ue({inputs:{x:et},backend:o,attrs:{shape:[O,B,1]}}),I.push(ut));const vt=g===1?2:1;let bt=it;rt&&(bt=ue({inputs:{x:it},backend:o,attrs:{shape:[O,1,B]}}),I.push(bt));const ht=vC({inputs:{a:ut,b:bt},backend:o});Y=Ry({inputs:{x:ht},backend:o,attrs:{axis:vt,keepDims:!0}}),I.push(ht)}else{const et=gi(r.dtype,t.dtype),it=new KL(_,$,[O,m,g],n,i,F,V,D,L),J=[N,k];if(a!=null&&J.push(a),D&&J.push(l),L){const rt=o.makeTensorInfo([],"float32",Fc(c,"float32"));J.push(rt),I.push(rt)}Y=o.runWebGLProgram(it,J,et)}const H=ue({inputs:{x:Y},backend:o,attrs:{shape:S}});I.push(Y);for(const et of I)o.disposeIntermediateTensorInfo(et);return H}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wgt(r){const{inputs:t,backend:n,attrs:i}=r,{a:o,b:a,bias:l,preluActivationWeights:c}=t,{transposeA:u,transposeB:h,activation:d,leakyreluAlpha:f}=i;return C2({a:o,b:a,transposeA:u,transposeB:h,backend:n,bias:l,preluActivationWeights:c,leakyreluAlpha:f,activation:d})}const Ggt={kernelName:e2,backendName:"webgl",kernelFunc:Wgt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pE="return abs(x);";function Hgt(r){const{inputs:t,backend:n}=r,{x:i}=t;if(n.shouldExecuteOnCPU([i])&&i.dtype!=="complex64"){const a=n.texData.get(i.dataId),l=zL(a.values);return n.makeTensorInfo(i.shape,i.dtype,l)}let o;return kt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new rc(i.shape,pE):o=new ka(i.shape,pE),n.runWebGLProgram(o,[i],i.dtype)}const jgt={kernelName:nv,backendName:"webgl",kernelFunc:Hgt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qgt=Io+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Kgt=_n({opSnippet:qgt}),Xgt={kernelName:$m,backendName:"webgl",kernelFunc:Kgt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ygt=Io+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,Zgt=_n({opSnippet:Ygt}),Jgt={kernelName:Im,backendName:"webgl",kernelFunc:Zgt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mE="return a + b;",Qgt=pr({opSnippet:mE,packedOpSnippet:mE,supportsComplex:!0,cpuKernelImpl:hmt}),t0t={kernelName:df,backendName:"webgl",kernelFunc:Qgt};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e0t{constructor(t,n){this.outputShape=[],this.outputShape=t,this.variableNames=n.map((a,l)=>`T${l}`);const i=[];this.variableNames.forEach(a=>{i.push(`float v${a} = get${a}AtOutCoords();`)});const o=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${i.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n0t{constructor(t,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((a,l)=>`T${l}`);const i=[];this.variableNames.forEach(a=>{i.push(`vec4 v${a} = get${a}AtOutCoords();`)});const o=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${i.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C1(r){const{inputs:t,backend:n}=r,i=t;if(i.length===1)return xi({inputs:{x:i[0]},backend:n});if(i.length>kt().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const u=Math.floor(i.length/2),h=C1({inputs:i.slice(0,u),backend:n}),d=C1({inputs:i.slice(u),backend:n});return C1({inputs:[h,d],backend:n})}const o=i.map(u=>u.dtype).reduce((u,h)=>gi(u,h)),a=i.map(u=>u.shape),c=kt().getBool("WEBGL_PACK")?new n0t(i[0].shape,a):new e0t(i[0].shape,a);return n.runWebGLProgram(c,i,o)}const s0t={kernelName:M4,backendName:"webgl",kernelFunc:C1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r0t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a,keepDims:l}=i,c=o.shape.length,u=on(a,o.shape);let h=u;const d=ms(h,c);let f=o;d!=null&&(f=zr({inputs:{x:o},backend:n,attrs:{perm:d}}),h=_s(h.length,c)),fr("all",h,c);const[p,m]=Zs(f.shape,h),g=Nt(m),y=ue({inputs:{x:f},backend:n,attrs:{shape:[-1,g]}}),v=kh(y,y.dtype,"all",n);let x;if(l){const b=Ss(p,u);x=ue({inputs:{x:v},backend:n,attrs:{shape:b}})}else x=ue({inputs:{x:v},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),d!=null&&n.disposeIntermediateTensorInfo(f),x}const i0t={kernelName:D4,backendName:"webgl",kernelFunc:r0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o0t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a,keepDims:l}=i,c=o.shape.length,u=on(a,o.shape);let h=u;const d=ms(h,c);let f=o;d!=null&&(f=zr({inputs:{x:o},backend:n,attrs:{perm:d}}),h=_s(h.length,c)),fr("any",h,c);const[p,m]=Zs(f.shape,h),g=Nt(m),y=ue({inputs:{x:f},backend:n,attrs:{shape:[-1,g]}}),v=kh(y,y.dtype,"any",n);let x;if(l){const b=Ss(p,u);x=ue({inputs:{x:v},backend:n,attrs:{shape:b}})}else x=ue({inputs:{x:v},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),d!=null&&n.disposeIntermediateTensorInfo(f),x}const a0t={kernelName:R4,backendName:"webgl",kernelFunc:o0t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l0t{constructor(t,n,i){this.variableNames=["A"];const{windowSize:o,batchSize:a,outSize:l}=t;i||this.variableNames.push("bestIndicesA"),this.outputShape=[a,l];const c=n==="max"?">":"<",u=i?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${u};
          float candidate = getA(batch, inIdx);
          if (candidate ${c} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c0t{constructor(t,n,i,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,W(t.length>2,()=>`Packed arg${i.charAt(0).toUpperCase()+i.slice(1)} supports only inputs with rank above 2.`);const a=t[t.length-1],l=Math.ceil(a/n);this.outputShape=t.slice(0,-1),l>1&&this.outputShape.push(l),o||this.variableNames.push("bestIndicesA");const c=this.outputShape,u=c.length,h=Kn(u),d=Rr("coords",u);let f,p;if(l===1){p=u+1;const k=Kn(p);f=`
        ${k} sourceLocR = ${k}(${d.join()}, 0);
        ++${d[u-1]};
        ${k} sourceLocG = ${k}(${d.join()}, 0);
        ++${d[u-2]};
        ${k} sourceLocA = ${k}(${d.join()}, 0);
        --${d[u-1]};
        ${k} sourceLocB = ${k}(${d.join()}, 0);
        --${d[u-2]};`}else p=u,f=`
        ${h} sourceLocR = coords;
        ++${d[u-1]};
        ${h} sourceLocG = coords;
        ++${d[u-2]};
        ${h} sourceLocA = coords;
        --${d[u-1]};
        ${h} sourceLocB = coords;
        --${d[u-2]};`;const m=["x","y","z","w","u","v"].slice(0,p),g="."+m[p-1],y=m.map(k=>"int "+k),v=Rr("sourceLocR",p-1).concat("inIdx.r"),x=Rr("sourceLocG",p-1).concat("inIdx.g"),b=Rr("sourceLocB",p-1).concat("inIdx.b"),w=Rr("sourceLocA",p-1).concat("inIdx.a"),S=i==="max"?"greaterThan":"lessThan",_=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${w.join()})));`,$=`vec4(
            getAChannel(${v.join()}),
            hasNextCol ? getAChannel(${x.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${w.join()}) : 0.)`,N=o?"":`
      float getBestIndicesAChannel(${y.join()}) {
        return getChannel(getBestIndicesA(${m.join()}),
                                          vec2(${m.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${y.join()}) {
        return getChannel(getA(${m.join()}),
                               vec2(${m.slice(-2).join()}));
      }
      ${N}
      void main() {
        ${h} coords = getOutputCoords();
        bool hasNextCol = ${d[u-1]} < ${c[u-1]-1};
        bool hasNextRow = ${d[u-2]} < ${c[u-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${g}, sourceLocG${g},
          sourceLocB${g}, sourceLocA${g}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${$};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${_}
          vec4 candidate = ${$};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${S}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YL(r,t,n,i=null){let o=t.shape[0],a=t.shape[1];i!=null&&(o=i.shape[0],a=i.shape[1]);const l=py(a),c={windowSize:l,inSize:a,batchSize:o,outSize:Math.ceil(a/l)},u=new l0t(c,n,i==null),h=[t];i!=null&&h.push(i);const d=r.runWebGLProgram(u,h,"int32");if(d.shape[1]===1)return d;const f=YL(r,t,n,d);return r.disposeIntermediateTensorInfo(d),f}function ZL(r,t,n,i=null){const o=i!=null?i.shape:t.shape,a=o[o.length-1],l=py(a),c=new c0t(o,l,n,i==null),u=i==null?[t]:[t,i],h=r.runWebGLProgram(c,u,"int32");if(h.shape.length===t.shape.length){const d=ZL(r,t,n,h);return r.disposeIntermediateTensorInfo(h),d}return h}function JL(r,t,n,i){const o=[n];if(fr("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,t.shape.length),!kt().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const a=[],l=r.texData.get(t.dataId),c=l!==null&&l.isPacked;let u=t;c&&(u=r.unpackTensor(t),a.push(u));const[h,d]=Zs(u.shape,o),f=Nt(d),p=ue({inputs:{x:u},backend:r,attrs:{shape:[-1,f]}});a.push(p);const m=YL(r,p,i);a.push(m);const g=ue({inputs:{x:m},backend:r,attrs:{shape:h}});return a.forEach(y=>r.disposeIntermediateTensorInfo(y)),g}return ZL(r,t,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u0t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a}=i;let l=on(a,o.shape);const c=ms(l,o.shape.length);let u=o;const h=[];c!=null&&(u=zr({inputs:{x:o},backend:n,attrs:{perm:c}}),h.push(u),l=_s(l.length,u.shape.length)),fr("argMax",[l[0]],u.shape.length);const d=JL(n,u,l[0],"max");return h.forEach(f=>n.disposeIntermediateTensorInfo(f)),d}const h0t={kernelName:sv,backendName:"webgl",kernelFunc:u0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d0t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a}=i;let l=on(a,o.shape);const c=ms(l,o.shape.length);let u=o;const h=[];c!=null&&(u=zr({inputs:{x:o},backend:n,attrs:{perm:c}}),h.push(u),l=_s(l.length,u.shape.length)),fr("argMin",[l[0]],u.shape.length);const d=JL(n,u,l[0],"min");return h.forEach(f=>n.disposeIntermediateTensorInfo(f)),d}const f0t={kernelName:rv,backendName:"webgl",kernelFunc:d0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p0t=Io+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,m0t=_n({opSnippet:p0t}),g0t={kernelName:Em,backendName:"webgl",kernelFunc:m0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v0t=Io+"return log(x + sqrt(x * x + 1.0));",y0t=_n({opSnippet:v0t}),x0t={kernelName:Nm,backendName:"webgl",kernelFunc:y0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b0t=Io+`
  return atan(x);
`,w0t=_n({opSnippet:b0t}),S0t={kernelName:Am,backendName:"webgl",kernelFunc:w0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _0t=gC+`
  return atan(a, b);
`,T0t=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Vg+`
  return result;
`,C0t=pr({opSnippet:_0t,packedOpSnippet:T0t}),k0t={kernelName:Dm,backendName:"webgl",kernelFunc:C0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $0t=Io+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,I0t=_n({opSnippet:$0t}),E0t={kernelName:Mm,backendName:"webgl",kernelFunc:I0t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rm{constructor(t,n,i,o=!1,a=!1){if(this.variableNames=["x"],n==="avg"&&i)throw new Error("Cannot compute positions for average pool.");const l=t.filterWidth,c=t.strideHeight,u=t.strideWidth,h=t.dilationHeight,d=t.dilationWidth,f=t.effectiveFilterHeight,p=t.effectiveFilterWidth,m=t.padInfo.top,g=t.padInfo.left;this.outputShape=t.outShape;const y=n==="avg",v=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,x=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let b="0.0";if(y||(b="-1.0 / 1e-20"),i){const k=">=";this.userCode=`
        const ivec2 strides = ivec2(${c}, ${u});
        const ivec2 pads = ivec2(${m}, ${g});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${k} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?a?v:x:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const w="max";let S=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(S="avgValue / count");const _=Math.floor(l/4)*4,$=l%4,N=`
      if (${y}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${c}, ${u});
      const ivec2 pads = ivec2(${m}, ${g});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${h}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${_}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${N}
          }

          int xC = xCCorner + ${_};
          if (${$===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${N}
          } else if (${$===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${N}
          } else if (${$===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${N}
          }
        }
        setOutput(${S});
      }
    `}}class yC{constructor(t,n,i,o=!1,a=!1){if(this.variableNames=["x"],n==="avg"&&i)throw new Error("Cannot compute positions for average pool.");const l=t.filterWidth,c=t.strideDepth,u=t.strideHeight,h=t.strideWidth,d=t.dilationDepth,f=t.dilationHeight,p=t.dilationWidth,m=t.effectiveFilterDepth,g=t.effectiveFilterHeight,y=t.effectiveFilterWidth,v=t.padInfo.front,x=t.padInfo.top,b=t.padInfo.left;this.outputShape=t.outShape;const w=n==="avg";let S="0.0";if(w||(S="-1.0 / 1e-20"),i){const O=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${c}, ${u}, ${h});
        const ivec3 pads = ivec3(${v}, ${x}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${m};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${t.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${g};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${y};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${O} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?a?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${g} * ${y} +
                      wR * ${y} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const _="max";let $=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&($="avgValue / count");const N=Math.floor(l/4)*4,k=l%4,I=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${_}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${c}, ${u}, ${h});
      const ivec3 pads = ivec3(${v}, ${x}, ${b});
      const float initializationValue = ${S};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${S});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${m};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${g};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${N}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${I}
            }

            int xC = xCCorner + ${N};
            if (${k===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${I}
            } else if (${k===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${I}
            } else if (${k===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${I}
            }
          }
          setOutput(${$});
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N0t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t;Bg(o,"avgPool");const{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=i,h=1;W(_r(l,h),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);const d=ko(o.shape,a,l,h,c,u);if(d.filterWidth===1&&d.filterHeight===1&&An(d.inShape,d.outShape))return xi({inputs:{x:o},backend:n});const f=new rm(d,"avg",!1);return n.runWebGLProgram(f,[o],"float32")}const A0t={kernelName:iv,backendName:"webgl",kernelFunc:N0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M0t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{filterSize:a,strides:l,pad:c,dimRoundingMode:u,dataFormat:h}=i,d=[1,1,1],f=Nl(o.shape,a,l,d,c,u,h),p=new yC(f,"avg",!1);return n.runWebGLProgram(p,[o],"float32")}const D0t={kernelName:ov,backendName:"webgl",kernelFunc:M0t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R0t{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const n=t.filterHeight,i=t.filterWidth,o=t.strideHeight,a=t.strideWidth,l=t.dilationHeight,c=t.dilationWidth,u=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=u-1-t.padInfo.top,f=h-1-t.padInfo.left,p=1/(n*i);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${f});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${u};
            wR += ${l}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${h};
            wC+= ${c}) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class O0t{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const n=t.filterDepth,i=t.filterHeight,o=t.filterWidth,a=t.strideDepth,l=t.strideHeight,c=t.strideWidth,u=t.dilationDepth,h=t.dilationHeight,d=t.dilationWidth,f=t.effectiveFilterDepth,p=t.effectiveFilterHeight,m=t.effectiveFilterWidth,g=f-1-t.padInfo.front,y=p-1-t.padInfo.top,v=m-1-t.padInfo.left,x=1/(n*i*o);this.userCode=`
      const ivec3 pads = ivec3(${g}, ${y}, ${v});
      const float avgMultiplier = float(${x});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          float dyD = float(dyDCorner + wD) / ${a}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${h}) {
            float dyR = float(dyRCorner + wR) / ${l}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${m};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${c}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L0t(r){const{inputs:t,backend:n,attrs:i}=r,{dy:o,input:a}=t,l=a,{filterSize:c,strides:u,pad:h,dimRoundingMode:d}=i,f=[1,1,1],p=Nl(l.shape,c,u,f,h,d),m=new O0t(p);return n.runWebGLProgram(m,[o],l.dtype)}const F0t={kernelName:L4,backendName:"webgl",kernelFunc:L0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P0t(r){const{inputs:t,backend:n,attrs:i}=r,{dy:o,input:a}=t,l=a;Bg([o,a],"avgPoolGrad");const{filterSize:c,strides:u,pad:h}=i,d=ko(l.shape,c,u,1,h),f=new R0t(d);return n.runWebGLProgram(f,[o],l.dtype)}const B0t={kernelName:O4,backendName:"webgl",kernelFunc:P0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z0t(r){const{inputs:t,backend:n,attrs:i}=r,{a:o,b:a}=t,{transposeA:l,transposeB:c}=i;return C2({a:o,b:a,transposeA:l,transposeB:c,backend:n})}const V0t={kernelName:av,backendName:"webgl",kernelFunc:z0t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U0t{constructor(t,n,i,o,a,l){this.outputShape=[],this.variableNames=["x","mean","variance"],qe(t,n),qe(t,i);let c="0.0";o!=null&&(qe(t,o),this.variableNames.push("offset"),c="getOffsetAtOutCoords()");let u="1.0";a!=null&&(qe(t,a),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${c};
        float scale = ${u};
        float inv = scale * inversesqrt(variance + float(${l}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W0t{constructor(t,n,i,o,a,l){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],qe(t,n),qe(t,i);let c="vec4(0.0)";o!=null&&(qe(t,o),this.variableNames.push("offset"),c="getOffsetAtOutCoords()");let u="vec4(1.0)";a!=null&&(qe(t,a),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = ${c};
        vec4 scale = ${u};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${l}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G0t=({inputs:r,backend:t,attrs:n})=>{const{x:i,mean:o,variance:a,offset:l,scale:c}=r;W(o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),W(l==null||o.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),W(c==null||o.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:u}=n;u==null&&(u=.001);const h=[i,o,a];let d=null;l!=null&&(d=l.shape,h.push(l));let f=null;c!=null&&(f=c.shape,h.push(c));const p=kt().getBool("WEBGL_PACK_NORMALIZATION")?new W0t(i.shape,o.shape,a.shape,d,f,u):new U0t(i.shape,o.shape,a.shape,d,f,u);return t.runWebGLProgram(p,h,h[0].dtype)},H0t={kernelName:xv,backendName:"webgl",kernelFunc:G0t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j0t{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const n=Kn(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const i=q0t(this.rank);let o;const a=t.map((l,c)=>`sourceLoc.${Sw[c]} = start[${c}] + coords.${Sw[c]};`);o=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${a.join(`
`)}
      `,this.userCode=`
      void main() {
        ${o}
        setOutput(getSource(${i}));
      }
    `}}const Sw=["x","y","z","w","u","v"];function q0t(r){if(r===1)return"sourceLoc";if(r<=6)return Sw.slice(0,r).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${r} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K0t{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=Kn(this.rank),i=Rr("coords",this.rank),o=Rr("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,l=`getChannel(getSource(${o.join()}), ${a})`,c=`
      result.x = ${l};
      if (++${i[this.rank-1]} < ${t[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${l};
        --${o[this.rank-1]};
      }
    `,u=this.rank===1?"":`
      --${i[this.rank-1]};
      if (++${i[this.rank-2]} < ${t[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${l};
        if (++${i[this.rank-1]} < ${t[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${l};
        }
      }
    `,h=this.rank<=4?`sourceLoc = coords +
            ${n}(${t.map((d,f)=>`start[${f}]`).join()});`:t.map((d,f)=>`${o[f]} = ${i[f]} + start[${f}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${h}
        vec4 result = vec4(0.);
        ${c}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X0t(r,t,n,i){const o=i.texData.get(r.dataId),a=i.makeTensorInfo(n,r.dtype),l=i.texData.get(a.dataId);Object.assign(l,o),l.refCount=1,l.shape=n,l.dtype=r.dtype;let c=M_(t,Ie(r.shape));o.slice&&(c+=o.slice.flatOffset),l.slice={flatOffset:c,origDataId:o.slice&&o.slice.origDataId||r.dataId};const u=i.dataRefCount.get(l.slice.origDataId)||1;return i.dataRefCount.set(l.slice.origDataId,u+1),a}function kf(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{begin:a,size:l}=i,[c,u]=oy(o,a,l);if(E_(o,c,u),Nt(u)===0)return n.makeTensorInfo(u,o.dtype,[]);if(n.shouldExecuteOnCPU([o])||o.dtype==="string"){const f=n.texData.get(o.dataId),p=Umt(f.values,c,u,o.shape,o.dtype);return n.makeTensorInfo(u,o.dtype,p)}const{isPacked:h}=n.texData.get(o.dataId),d=A_(o.shape,c,u);if(h||!d){const f=kt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new K0t(u):new j0t(u),p=[c];return n.runWebGLProgram(f,[o],o.dtype,p)}return n.uploadToGPU(o.dataId),X0t(o,c,u,n)}const Y0t={kernelName:Kv,backendName:"webgl",kernelFunc:kf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z0t=r=>{const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{blockShape:a,crops:l}=i;W(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const c=a.reduce((b,w)=>b*w),u=Ig(o.shape,a,c),h=Eg(u.length,a.length),d=Ng(o.shape,a,c),f=yT(l,a.length),p=xT(d,l,a.length),m=[],g=ue({inputs:{x:o},backend:n,attrs:{shape:u}}),y=zr({inputs:{x:g},backend:n,attrs:{perm:h}}),v=ue({inputs:{x:y},backend:n,attrs:{shape:d}}),x=kf({inputs:{x:v},backend:n,attrs:{begin:f,size:p}});return m.push(g),m.push(y),m.push(v),m.forEach(b=>n.disposeIntermediateTensorInfo(b)),x},J0t={kernelName:lv,backendName:"webgl",kernelFunc:Z0t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q0t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,weights:a}=t,{size:l}=i,c=n.readSync(o.dataId),u=n.readSync(a.dataId),h=BL(c,u,a.dtype,a.shape,l);return n.makeTensorInfo([l],a.dtype,h)}const t1t={kernelName:F4,backendName:"webgl",kernelFunc:Q0t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e1t(r){const{inputs:t,backend:n}=r,{s0:i,s1:o}=t,a=n.readSync(i.dataId),l=n.readSync(o.dataId),c=qe(Array.from(a),Array.from(l));return n.makeTensorInfo([c.length],"int32",Int32Array.from(c))}const n1t={kernelName:cR,backendName:"webgl",kernelFunc:e1t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s1t="return float(a != b);",QL=pr({opSnippet:s1t,cpuKernelImpl:Dmt,dtype:"bool"}),r1t={kernelName:Lv,backendName:"webgl",kernelFunc:QL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wg(r){const{inputs:t,backend:n}=r,{input:i}=t,o=n.texData.get(i.dataId);return xi({inputs:{x:o.complexTensorInfos.real},backend:n})}const i1t={kernelName:a_,backendName:"webgl",kernelFunc:Wg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o1t="return float(int(x));";function a1t(r,t){const n=new ka(r.shape,o1t),i=t.runWebGLProgram(n,[r],"int32");return{dataId:i.dataId,shape:i.shape,dtype:i.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _w(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{dtype:a}=i;if(a==="complex64"){if(o.dtype==="complex64")return xi({inputs:{x:o},backend:n});const l=Hs(o.shape),c=_w({inputs:{x:o},backend:n,attrs:{dtype:"float32"}}),u=jc({inputs:{real:c,imag:l},backend:n});return l.dispose(),n.disposeIntermediateTensorInfo(c),u}if(o.dtype==="complex64"){const l=Wg({inputs:{input:o},backend:n}),c=_w({inputs:{x:l},backend:n,attrs:{dtype:a}});return n.disposeIntermediateTensorInfo(l),c}if(!sR(o.dtype,a)){const l=xi({inputs:{x:o},backend:n});return{dataId:l.dataId,shape:l.shape,dtype:a}}if(n.shouldExecuteOnCPU([o])){const l=n.texData.get(o.dataId).values,[c,u,h]=fmt(l,o.shape,o.dtype,a);return n.makeTensorInfo(c,u,h)}if(a==="int32")return a1t(o,n);if(a==="bool"){const l=n.makeTensorInfo([],"bool",hr("bool",1)),u=QL({inputs:{a:o,b:l},backend:n});return n.disposeIntermediateTensorInfo(l),u}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${a}`)}const l1t={kernelName:Rm,backendName:"webgl",kernelFunc:_w};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gE="return ceil(x);",c1t=_n({opSnippet:gE,packedOpSnippet:gE,cpuKernelImpl:pmt}),u1t={kernelName:Om,backendName:"webgl",kernelFunc:c1t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h1t{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d1t{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f1t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{clipValueMin:a,clipValueMax:l}=i;let c;kt().getBool("WEBGL_PACK_CLIP")?c=new d1t(o.shape):c=new h1t(o.shape);const u=[[a],[l]];return n.runWebGLProgram(c,[o],o.dtype,u)}const p1t={kernelName:Lm,backendName:"webgl",kernelFunc:f1t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m1t{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vE(r,t){return{dataId:t.dataId,dtype:t.dtype,shape:r.shape}}function g1t(r){const{inputs:t,backend:n}=r,{x:i}=t,o=n.texData.get(i.dataId),a=new m1t(i.shape),l=[vE(i,o.complexTensorInfos.real),vE(i,o.complexTensorInfos.imag)];return n.runWebGLProgram(a,l,l[0].dtype)}const v1t={kernelName:cv,backendName:"webgl",kernelFunc:g1t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y1t{constructor(t){this.outputShape=[],this.outputShape=Ma(t,1),this.variableNames=t.map((l,c)=>`T${c}`);const n=new Array(t.length-1);n[0]=t[0][1];for(let l=1;l<n.length;l++)n[l]=n[l-1]+t[l][1];const i=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let l=1;l<n.length;l++){const c=n[l-1];i.push(`else if (yC < ${n[l]}) setOutput(getT${l}(yR, yC-${c}));`)}const o=n.length,a=n[n.length-1];i.push(`else setOutput(getT${o}(yR, yC-${a}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${i.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x1t{constructor(t,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ma(t,n);const i=this.outputShape,o=i.length,a=Kn(o),l=Rr("coords",o),c=["x","y","z","w","u","v"].slice(0,o);this.variableNames=t.map((y,v)=>`T${v}`);const u=new Array(t.length-1);u[0]=t[0][n];for(let y=1;y<u.length;y++)u[y]=u[y-1]+t[y][n];const h=c[n],d=c.slice(-2),f=c.join();let p=`if (${h} < ${u[0]}) {
        return getChannel(
            getT0(${f}), vec2(${d.join()}));
        }`;for(let y=1;y<u.length;y++){const v=u[y-1];p+=`
        if (${h} < ${u[y]}  && ${h} >= ${u[y-1]}) {
          return getChannel(
            getT${y}(${H0(c,h,v)}),
            vec2(${H0(d,h,v)}));
        }`}const m=u.length,g=u[u.length-1];p+=`
        return getChannel(
          getT${m}(${H0(c,h,g)}),
          vec2(${H0(d,h,g)}));`,this.userCode=`
      float getValue(${c.map(y=>"int "+y)}) {
        ${p}
      }

      void main() {
        ${a} coords = getOutputCoords();
        vec4 result = vec4(getValue(${l}), 0., 0., 0.);

        ${l[o-1]} = ${l[o-1]} + 1;
        if (${l[o-1]} < ${i[o-1]}) {
          result.g = getValue(${l});
        }

        ${l[o-2]} = ${l[o-2]} + 1;
        if (${l[o-2]} < ${i[o-2]}) {
          result.a = getValue(${l});
        }

        ${l[o-1]} = ${l[o-1]} - 1;
        if (${l[o-2]} < ${i[o-2]} &&
            ${l[o-1]} < ${i[o-1]}) {
          result.b = getValue(${l});
        }
        setOutput(result);
      }
    `}}function H0(r,t,n){const i=r.indexOf(t);return r.map((a,l)=>l===i?`${a} - ${n}`:a).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oy(r){const{inputs:t,backend:n}=r,{input:i}=t,o=n.texData.get(i.dataId);return xi({inputs:{x:o.complexTensorInfos.imag},backend:n})}const b1t={kernelName:Q4,backendName:"webgl",kernelFunc:Oy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _p(r,t,n){const i=r[0].dtype;if(i==="complex64"){const m=r.map(b=>Wg({inputs:{input:b},backend:n})),g=r.map(b=>Oy({inputs:{input:b},backend:n})),y=_p(m,t,n),v=_p(g,t,n),x=jc({inputs:{real:y,imag:v},backend:n});return m.forEach(b=>n.disposeIntermediateTensorInfo(b)),g.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),x}let o=n.shouldExecuteOnCPU(r);if(i==="string"&&(o=!0),o){const m=r.map(S=>{const $=[-1,Nt(S.shape.slice(t))];return ue({inputs:{x:S},backend:n,attrs:{shape:$}})}),g=m.map(S=>({vals:n.readSync(S.dataId),shape:S.shape})),y=Ma(m.map(S=>S.shape),1),v=m[0].shape[0]===1,x=mmt(g,y,i,v),b=Ma(r.map(S=>S.shape),t),w=n.makeTensorInfo(b,i,x);return m.forEach(S=>n.disposeIntermediateTensorInfo(S)),w}const a=r.filter(m=>Nt(m.shape)>0),l=kt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&a[0].shape.length>1;if(a.length===1){const m=l?new ka(r[0].shape,Zl):new rc(r[0].shape,Zl);return n.runWebGLProgram(m,r,i)}const c=kt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(a.length>c){const m=[];for(let y=0;y<a.length;y+=c){const v=a.slice(y,y+c);m.push(_p(v,t,n))}const g=_p(m,t,n);for(const y of m)n.disposeIntermediateTensorInfo(y);return g}if(l){const m=new x1t(a.map(g=>g.shape),t);return n.runWebGLProgram(m,a,i)}const{tensors2D:u,outShape:h}=w1t(a,t,n),d=new y1t(u.map(m=>m.shape)),f=n.runWebGLProgram(d,u,i);u.forEach(m=>n.disposeIntermediateTensorInfo(m));const p=ue({inputs:{x:f},attrs:{shape:h},backend:n});return n.disposeIntermediateTensorInfo(f),p}function w1t(r,t,n){const i=Ma(r.map(a=>a.shape),t);return{tensors2D:r.map(a=>ue({inputs:{x:a},attrs:{shape:[-1,Nt(a.shape.slice(t))]},backend:n})),outShape:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tF(r){const{inputs:t,backend:n,attrs:i}=r,{axis:o}=i,a=on(o,t[0].shape)[0],l=t.map(h=>h.shape);mT(l,a);const c=Ma(t.map(h=>h.shape),a);if(Nt(c)===0)return n.makeTensorInfo(c,t[0].dtype,[]);const u=t.filter(h=>Nt(h.shape)>0);return u.length===1?xi({inputs:{x:u[0]},backend:n}):_p(u,a,n)}const S1t={kernelName:uv,backendName:"webgl",kernelFunc:tF};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eF{constructor(t,n=!1,i=null,o=!1,a=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const l=t.padInfo.top,c=t.padInfo.left,u=t.strideHeight,h=t.strideWidth,d=t.dilationHeight,f=t.dilationWidth,p=t.filterHeight,m=t.filterWidth,g=Math.floor(t.inChannels/4)*4,y=t.inChannels%4,v=t.dataFormat==="channelsLast",x=v?1:2,b=v?2:3,w=v?3:1;let S="",_="";i&&(o?S=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:a?S=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:S=`
          float activation(float x) {
            ${i}
          }
        `,_="result = activation(result);");const $=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${S}

      const ivec2 strides = ivec2(${u}, ${h});
      const ivec2 pads = ivec2(${l}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${w}];

        ivec2 xRCCorner =
            ivec2(coords[${x}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${m}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${t.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${g}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${v}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${y===1}) {

              if (${v}) {
                dotProd +=
                    getX(batch, xR, xC, ${g}) *
                    getW(wR, wC, ${g}, d2);
              } else {
                dotProd +=
                    getX(batch, ${g}, xR, xC) *
                    getW(wR, wC, ${g}, d2);
              }

            } else if (${y===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${g}, d2),
                getW(wR, wC, ${g} + 1, d2)
              );

              if (${v}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${g}),
                  getX(batch, xR, xC, ${g} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${g}, xR, xC),
                  getX(batch, ${g} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${y===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${g}, d2),
                getW(wR, wC, ${g} + 1, d2),
                getW(wR, wC, ${g} + 2, d2)
              );

              if (${v}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${g}),
                  getX(batch, xR, xC, ${g} + 1),
                  getX(batch, xR, xC, ${g} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${g}, xR, xC),
                  getX(batch, ${g} + 1, xR, xC),
                  getX(batch, ${g} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${$}
        ${_}
        setOutput(result);
      }
    `}}class _1t{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const n=t.padInfo.front,i=t.padInfo.top,o=t.padInfo.left,a=t.strideDepth,l=t.strideHeight,c=t.strideWidth,u=t.dilationDepth,h=t.dilationHeight,d=t.dilationWidth,f=t.filterDepth,p=t.filterHeight,m=t.filterWidth,g=Math.floor(t.inChannels/4)*4,y=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${n}, ${i}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${u};

          if (xF < 0 || xF >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${h};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${m}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${g}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${y===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${g}) *
                  getW(wF, wR, wC, ${g}, d2);
              } else if (${y===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${g}),
                  getX(batch, xF, xR, xC, ${g} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${g}, d2),
                  getW(wF, wR, wC, ${g} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${y===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${g}),
                  getX(batch, xF, xR, xC, ${g} + 1),
                  getX(batch, xF, xR, xC, ${g} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${g}, d2),
                  getW(wF, wR, wC, ${g} + 1, d2),
                  getW(wF, wR, wC, ${g} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nF{constructor(t,n=!1,i=null,o=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Ur(this.outputShape.length);const l=t.padInfo.left,c=t.strideWidth,u=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,f=d;let p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let v=0;v<d;v++)p+=`
           vec4 xTexelC${v*2};
           int xTexelC${v*2}Ready;
           vec4 xTexelC${v*2+1};
           int xTexelC${v*2+1}Ready;
           vec4 xC${v};`;p+=`
     for (int r = 0; r < ${h}; r++) {
      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {
       `;for(let v=0;v<d;v++)p+=`
           xTexelC${v*2} = vec4(0.0);
           xTexelC${v*2}Ready = 0;
           xTexelC${v*2+1} = vec4(0.0);
           xTexelC${v*2+1}Ready = 0;
           xC${v} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let v=0;v<(f+1)/2;v++){const x=v*2;if(p+=`
           xC = xCCorner + ${x*u};
           `,c===1){if(x<d&&(l%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }
               `,u===1&&x>0?p+=`
                 xC${x} = vec4(xTexelC${x-2}.zw, xTexelC${x}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${x} = vec4(previous.zw, xTexelC${x}.xy);
                   } else {
                     xC${x} = vec4(0.0, 0.0, xTexelC${x}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xC${x} = xTexelC${x};
                 `,x+1<d)){const b=l%2===0?E4(u):u;u%2===0&&l%2===1||u%2!==0&&l%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${b};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                     xTexelC${x+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${x+1}.zw = vec2(0.0);
                     }
                     xTexelC${x+1}Ready = 1;
                   }
                   `,u>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${x+1} = vec4(previous.zw, xTexelC${x+1}.xy);
                     } else {
                      xC${x+1} = vec4(0.0, 0.0, xTexelC${x+1}.xy);
                     }
                     `:p+=`
                     xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.xy);
                     `):b===1?p+=`
                     xC${x+1} = xTexelC${x};
                     `:p+=`
                     xCOffset = xC + ${b};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                       xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${x+1}.zw = vec2(0.0);
                       }
                       xTexelC${x+1}Ready = 1;
                     }

                     xC${x+1} = xTexelC${x+1};
                     `}}else x<d&&(l%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.0);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
               `,x+1<d&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${x+1} = vec4(xTexelC${x+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(
                   xTexelC${x}.xy, xTexelC${x+1}.xy);
               `,x+1<d&&(p+=`
                   xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
                 `)));x<d&&(p+=`
             wTexel = getW(r, ${x}, d1, d2);
             dotProd += xC${x}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${t.inChannels}) {
               dotProd += xC${x}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,x+1<d&&(p+=`
               wTexel = getW(r, ${x+1}, d1, d2);
               dotProd += xC${x+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${t.inChannels}) {
                 dotProd += xC${x+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let m="",g="";i&&(o?m=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${i}
         }`:a?m=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${i}
         }`:m=`vec4 activation(vec4 x) {
           ${i}
         }`,g="result = activation(result);");const y=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${m}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${y}
         ${g}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T1t{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=Ur(this.outputShape.length);const{dataFormat:i}=n,o=Vr(),a=i==="channelsLast",l=a?1:2,c=a?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`;let h="";for(let d=0;d<=1;d++)for(let f=0;f<=1;f++)h+=`
          blockIndex = rc.z + ${f};
          pos = rc.y + ${d};

          ${u}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${l}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${c}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${a}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${h}

        ${o.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k2(r,t){const n=r.length;return n>=3?t?[...r.slice(0,-3),r[n-3]*r[n-2],r[n-1]]:[...r.slice(0,-3),r[n-3],r[n-2]*r[n-1]]:!t&&n===1&&r[0]>1?[r[0],1]:null}function sF({x:r,filter:t,convInfo:n,backend:i,bias:o=null,preluActivationWeights:a=null,leakyreluAlpha:l=0,activation:c=null}){const u=r.shape,h=i.texData.get(r.dataId),d=n.inChannels,f=u[0]*u[1]*u[2],p=n.outChannels,m=n.dataFormat==="channelsLast",g=!1,y=!1;let v;const x=[];if(a!=null){const S=k2(a.shape,m);S!=null&&(a=ue({inputs:{x:a},backend:i,attrs:{shape:S}}),x.push(a))}if(o!=null){const S=k2(o.shape,m);S!=null&&(o=ue({inputs:{x:o},backend:i,attrs:{shape:S}}),x.push(o))}if(!((f===1||p===1)&&d>XL)&&h.isPacked&&m&&h.texture!=null&&u[2]%2!==0&&An(h.shape.slice(-3),u.slice(-3))){const S=u[0]*u[1]*(u[2]+1),_={dataId:r.dataId,shape:[1,S,n.inChannels],dtype:r.dtype},$=h.shape;h.shape=h.shape.slice(),h.shape[h.shape.length-2]++,W(T2(h.shape,_.shape),()=>`packed reshape ${h.shape} to ${_.shape} isn't free`);const N=ue({inputs:{x:t},backend:i,attrs:{shape:[1,n.inChannels,n.outChannels]}});x.push(N);const k=C2({a:_,b:N,backend:i,transposeA:g,transposeB:y,bias:o,activation:c,preluActivationWeights:a,leakyreluAlpha:l}),I=i.texData.get(k.dataId);W(I.isPacked,()=>"batchMatMul result is expected to be packed"),h.shape=$,I.shape=n.outShape,v=xi({inputs:{x:k},backend:i}),v.shape=n.outShape,x.push(k)}else{const S=n.outHeight*n.outWidth,_=ue({inputs:{x:r},backend:i,attrs:{shape:m?[n.batchSize,S,n.inChannels]:[n.batchSize,n.inChannels,S]}}),$=ue({inputs:{x:t},backend:i,attrs:{shape:[1,n.inChannels,n.outChannels]}}),N=C2({a:m?_:$,b:m?$:_,transposeA:!m,transposeB:y,backend:i,bias:o,activation:c,preluActivationWeights:a,leakyreluAlpha:l});v=ue({inputs:{x:N},backend:i,attrs:{shape:n.outShape}}),x.push(_),x.push($),x.push(N)}for(const S of x)i.disposeIntermediateTensorInfo(S);return v}function rF({x:r,filter:t,convInfo:n,backend:i,bias:o=null,preluActivationWeights:a=null,leakyreluAlpha:l=0,activation:c=null}){const{filterWidth:u,filterHeight:h,inChannels:d,outWidth:f,outHeight:p,dataFormat:m}=n,g=m==="channelsLast",y=u*h*d,v=p*f,x=[n.batchSize,y,v],b=!0,w=!1,S=[];if(a!=null){const H=k2(a.shape,g);H!=null&&(a=ue({inputs:{x:a},backend:i,attrs:{shape:H}}),S.push(a))}if(o!=null){const H=k2(o.shape,g);H!=null&&(o=ue({inputs:{x:o},backend:i,attrs:{shape:H}}),S.push(o))}const _=ue({inputs:{x:t},backend:i,attrs:{shape:[1,y,Nt(t.shape)/y]}});S.push(_);const $=new T1t(x,n),N=[r.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],k=i.runWebGLProgram($,[r],"float32",N),I=ue({inputs:{x:k},backend:i,attrs:{shape:x}});S.push(k),S.push(I);const O=o!=null,B=a!=null,F=c==="leakyrelu",D=c?sm(c,!0):null,L=new KL(g?I.shape:_.shape,g?_.shape:I.shape,g?[n.batchSize,v,n.outChannels]:[n.batchSize,n.outChannels,v],b,w,O,D,B,F),V=g?[I,_]:[_,I];if(o&&V.push(o),B&&V.push(a),F){const H=i.makeTensorInfo([],"float32",Fc(l,"float32"));V.push(H),S.push(H)}const j=i.runWebGLProgram(L,V,"float32"),Y=ue({inputs:{x:j},backend:i,attrs:{shape:n.outShape}});S.push(j);for(const H of S)i.disposeIntermediateTensorInfo(H);return Y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C1t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,filter:a}=t,{strides:l,pad:c,dataFormat:u,dilations:h,dimRoundingMode:d}=i,f=Al(u),p=dr(o.shape,a.shape,l,h,c,d,!1,f);let m;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))m=sF({x:o,filter:a,convInfo:p,backend:n});else if(p.strideWidth<=2&&f==="channelsLast"&&kt().getBool("WEBGL_EXP_CONV")){const y=new nF(p),v=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];m=n.runWebGLProgram(y,[o,a],"float32",v)}else if(kt().getBool("WEBGL_CONV_IM2COL"))m=rF({x:o,filter:a,convInfo:p,backend:n});else{const y=new eF(p);m=n.runWebGLProgram(y,[o,a],"float32")}const g=ue({inputs:{x:m},backend:n,attrs:{shape:p.outShape}});return n.disposeIntermediateTensorInfo(m),g}const k1t={kernelName:hv,backendName:"webgl",kernelFunc:C1t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $1t{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideHeight,i=t.strideWidth,o=t.padInfo.top,a=t.padInfo.left,l=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${o};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${i} - ${a};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              if (${l}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class I1t{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterHeight,i=t.filterWidth,o=t.strideHeight,a=t.strideWidth,l=t.dataFormat==="channelsLast",c=n-1-t.padInfo.top,u=i-1-t.padInfo.left,h=l?1:2,d=l?2:3,f=l?3:1;this.userCode=`
      const ivec2 pads = ivec2(${c}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${h}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${i} - 1 - wC;

            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {

              if (${l}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class E1t{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideDepth,i=t.strideHeight,o=t.strideWidth,a=t.padInfo.front,l=t.padInfo.top,c=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yF = 0; yF < ${t.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${a};

            if (xF < 0 || xF >= ${t.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${t.outHeight}; yR++) {
              int xR = wR + yR * ${i} - ${l};

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${t.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${c};

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class N1t{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterDepth,i=t.filterHeight,o=t.filterWidth,a=t.strideDepth,l=t.strideHeight,c=t.strideWidth,u=n-1-t.padInfo.front,h=i-1-t.padInfo.top,d=o-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${u}, ${h}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${a}.0;

          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${i}; wR++) {
            float dyR = float(dyRCorner + wR) / ${l}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${i} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${c}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A1t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,dy:a}=t,{strides:l,pad:c,dataFormat:u,dimRoundingMode:h,filterShape:d}=i,f=Al(u),p=dr(o.shape,d,l,1,c,h,!1,f),m=new $1t(p);return n.runWebGLProgram(m,[o,a],"float32")}const M1t={kernelName:B4,backendName:"webgl",kernelFunc:A1t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D1t(r){const{inputs:t,backend:n,attrs:i}=r,{dy:o,filter:a}=t,{inputShape:l,strides:c,pad:u,dataFormat:h,dimRoundingMode:d}=i,f=Al(h),p=dr(l,a.shape,c,1,u,d,!1,f),m=new I1t(p);return n.runWebGLProgram(m,[o,a],"float32")}const R1t={kernelName:dv,backendName:"webgl",kernelFunc:D1t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O1t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,filter:a}=t,{strides:l,pad:c,dilations:u}=i,h=Pc(o.shape,a.shape,l,u,c),d=new _1t(h);return n.runWebGLProgram(d,[o,a],"float32")}const L1t={kernelName:fv,backendName:"webgl",kernelFunc:O1t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F1t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,dy:a}=t,{strides:l,pad:c,filterShape:u}=i,h=Pc(o.shape,u,l,1,c),d=new E1t(h);return n.runWebGLProgram(d,[o,a],"float32")}const P1t={kernelName:z4,backendName:"webgl",kernelFunc:F1t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B1t(r){const{inputs:t,backend:n,attrs:i}=r,{dy:o,filter:a}=t,{pad:l,strides:c,inputShape:u}=i,h=Pc(u,a.shape,c,1,l),d=new N1t(h);return n.runWebGLProgram(d,[o,a],"float32")}const z1t={kernelName:V4,backendName:"webgl",kernelFunc:B1t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V1t=Cf+`
  return cos(x);
`,U1t=_n({opSnippet:V1t}),W1t={kernelName:Fm,backendName:"webgl",kernelFunc:U1t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G1t=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,H1t=_n({opSnippet:G1t}),j1t={kernelName:Pm,backendName:"webgl",kernelFunc:H1t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q1t{constructor(t,n,i,o,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[l,c,u,h]=t,[d]=n,[f,p]=i;this.outputShape=[d,f,p,h];const m=o==="bilinear"?1:0,[g,y]=[`${c-1}.0`,`${u-1}.0`],[v,x,b]=f>1?[`${(c-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${g} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${g}`],[w,S,_]=p>1?[`${(u-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${y} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${y}`];this.userCode=`
      const float height_ratio = float(${v});
      const float width_ratio = float(${w});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${l}) {
          return;
        }

        float height_scale = ${x};
        float width_scale = ${S};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${g} ) {
          setOutput(float(${a}));
          return;
        }
        float in_x = ${_};
        if( in_x < 0.0 || in_x > ${y} ) {
          setOutput(float(${a}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${m} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K1t=r=>{const{inputs:t,backend:n,attrs:i}=r,{image:o,boxes:a,boxInd:l}=t,{cropSize:c,method:u,extrapolationValue:h}=i,d=new q1t(o.shape,a.shape,c,u,h);return n.runWebGLProgram(d,[o,a,l],"float32")},X1t={kernelName:W4,backendName:"webgl",kernelFunc:K1t};var im;(function(r){r.Prod="*",r.Sum="+"})(im||(im={}));class yE{constructor(t,n,i,o){this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const a=this.outputShape.length,l=this.op===im.Prod?"1.0":"0.0",c=i?l:`getX(${xE(a,"coords",this.op)})`,u=this.outputShape[this.outputShape.length-1];let h="",d="";i?(h=o?`end != ${u-1}`:"end != 0",d=o?"end + 1":"end - 1"):(h=o?`end + pow2 < ${u}`:"end >= pow2",d=o?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Kn(a)} coords = getOutputCoords();
        int end = ${bE(a,"coords",this.op)};
        float val = ${c};
        int pow2 = int(pow(2.0, index));
        if (${h}) {
          int idx = ${d};
          ${bE(a,"coords",this.op)} = idx;
          val ${this.op}= getX(${xE(a,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function xE(r,t,n){if(r===1)return`${t}`;if(r===2)return`${t}.x, ${t}.y`;if(r===3)return`${t}.x, ${t}.y, ${t}.z`;if(r===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${n} for rank ${r} is not yet supported`)}function bE(r,t,n){if(r===1)return`${t}`;if(r===2)return`${t}.y`;if(r===3)return`${t}.z`;if(r===4)return`${t}.w`;throw new Error(`Cumulative ${n} for rank ${r} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iF(r,t,n,i,o,a){const l=t.shape.length,c=ms([i],l);let u=t;c!=null&&(u=zr({inputs:{x:t},backend:n,attrs:{perm:c}}));const h=_s(1,l)[0];if(h!==l-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${i}`);const d=u.shape[h];let f=xi({inputs:{x:u},backend:n});for(let p=0;p<=Math.ceil(Math.log2(d))-1;p++){const m=new yE(r,u.shape,!1,a),g=[[p]],y=f;f=n.runWebGLProgram(m,[f],f.dtype,g),n.disposeIntermediateTensorInfo(y)}if(o){const p=new yE(r,u.shape,o,a),m=f;f=n.runWebGLProgram(p,[f],f.dtype),n.disposeIntermediateTensorInfo(m)}if(c!=null){const p=Bc(c),m=zr({inputs:{x:f},backend:n,attrs:{perm:p}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(u),m}return f}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y1t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a,exclusive:l,reverse:c}=i;return iF(im.Prod,o,n,a,l,c)}const Z1t={kernelName:U4,backendName:"webgl",kernelFunc:Y1t};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J1t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a,exclusive:l,reverse:c}=i;return iF(im.Sum,o,n,a,l,c)}const Q1t={kernelName:pv,backendName:"webgl",kernelFunc:J1t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t2t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,weights:a}=t,{size:l,binaryOutput:c}=i;if(o.shape.length===1){const u=n.readSync(o.dataId),h=n.readSync(a.dataId),d=BL(u,h,a.dtype,a.shape,l);return n.makeTensorInfo([l],a.dtype,d)}else if(o.shape.length===2){const u=n.bufferSync(o),h=n.bufferSync(a),d=dmt(u,h,l,c);return n.makeTensorInfo(d.shape,a.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}const e2t={kernelName:G4,backendName:"webgl",kernelFunc:t2t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n2t{constructor(t,n,i){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=i,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s2t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{blockSize:a,dataFormat:l}=i,c=o.shape[0],u=l==="NHWC"?o.shape[1]:o.shape[2],h=l==="NHWC"?o.shape[2]:o.shape[3],d=l==="NHWC"?o.shape[3]:o.shape[1],f=u*a,p=h*a,m=d/(a*a),g=l==="NHWC"?[c,f,p,m]:[c,m,f,p],y=new n2t(g,a,l);return n.runWebGLProgram(y,[o],o.dtype)}const r2t={kernelName:H4,backendName:"webgl",kernelFunc:s2t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oF{constructor(t,n=!1,i=null,o=!1,a=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Ur(this.outputShape.length);const l=t.filterHeight,c=t.filterWidth,u=t.outChannels/t.inChannels;let h="",d="";i&&(o?h=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:a?h=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:h=`
          float activation(float x) {
            ${i}
          }
        `,d="result = activation(result);");const f=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${h}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${u};
        int q = d2 - d1 * ${u};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${l}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${c}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${f}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aF{constructor(t,n=!1,i=null,o=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Ur(this.outputShape.length);const l=t.outChannels/t.inChannels,c=t.padInfo.left,u=t.strideWidth,h=t.dilationWidth,d=t.filterHeight,f=t.filterWidth,p=f;let m=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<f;x++)m+=`
          vec4 xTexelC${x*2};
          int xTexelC${x*2}Ready;
          vec4 xTexelC${x*2+1};
          int xTexelC${x*2+1}Ready;
          vec4 xC${x};`;m+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let x=0;x<f;x++)m+=`
          xTexelC${x*2} = vec4(0.0);
          xTexelC${x*2}Ready = 0;
          xTexelC${x*2+1} = vec4(0.0);
          xTexelC${x*2+1}Ready = 0;
          xC${x} = vec4(0.0);`;m+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let x=0;x<(p+1)/2;x++){const b=x*2;if(m+=`
          xC = xCCorner + ${b*h};
          `,u===1){if(b<f&&(c%2===1?(m+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }
              `,h===1&&b>0?m+=`
                xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                `:m+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                  } else {
                    xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                  }
                  `):m+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xC${b} = xTexelC${b};
                `,b+1<f)){const w=c%2===0?E4(h):h;h%2===0&&c%2===1||h%2!==0&&c%2!==1?(m+=`
                  xCOffset = xC + imod(pads[1], 2) + ${w};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                    xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${b+1}.zw = vec2(0.0);
                    }
                    xTexelC${b+1}Ready = 1;
                  }
                  `,h>1?m+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                    } else {
                     xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                    }
                    `:m+=`
                    xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                    `):w===1?m+=`
                    xC${b+1} = xTexelC${b};
                    `:m+=`
                    xCOffset = xC + ${w};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                      xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${b+1}.zw = vec2(0.0);
                      }
                      xTexelC${b+1}Ready = 1;
                    }

                    xC${b+1} = xTexelC${b+1};
                    `}}else b<f&&(c%2===1?(m+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.0);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
              `,b+1<f&&(m+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                `)):(m+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(
                  xTexelC${b}.xy, xTexelC${b+1}.xy);
              `,b+1<f&&(m+=`
                  xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                `)));b<f&&(m+=`
            wTexel = getW(r, ${b}, d1, q);
            dotProd += xC${b} * vec4(wTexel.xz, wTexel.xz);
          `,b+1<f&&(m+=`
              wTexel = getW(r, ${b+1}, d1, q);
              dotProd += xC${b+1} * vec4(wTexel.xz, wTexel.xz);
            `))}m+=`
    }
  `,m+=`
      }
    `;let g="",y="";i&&(o?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:a?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:g=`vec4 activation(vec4 x) {
          ${i}
        }`,y="result = activation(result);");const v=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${g}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${m}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${v}
        ${y}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i2t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,filter:a}=t,{strides:l,pad:c,dilations:u,dimRoundingMode:h}=i;let d=u;d==null&&(d=[1,1]),W(_r(l,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${d}'`);const f=dr(o.shape,a.shape,l,d,c,h,!0);let p;kt().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?p=new aF(f):p=new oF(f);const m=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return n.runWebGLProgram(p,[o,a],"float32",m)}const o2t={kernelName:mv,backendName:"webgl",kernelFunc:i2t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a2t{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideHeight,i=t.strideWidth,o=t.padInfo.top,a=t.padInfo.left,l=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${l} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${o};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${i} - ${a};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class l2t{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterHeight,i=t.filterWidth,o=t.strideHeight,a=t.strideWidth,l=n-1-t.padInfo.top,c=i-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${l}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${i} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${u}; dm++) {
              int d2 = d1 * ${u} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c2t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,dy:a}=t,{strides:l,dilations:c,pad:u,dimRoundingMode:h,filterShape:d}=i,f=dr(o.shape,d,l,c,u,h,!0),p=new a2t(f);return n.runWebGLProgram(p,[o,a],"float32")}const u2t={kernelName:j4,backendName:"webgl",kernelFunc:c2t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h2t(r){const{inputs:t,backend:n,attrs:i}=r,{dy:o,filter:a}=t,{strides:l,dilations:c,pad:u,dimRoundingMode:h,inputShape:d}=i,f=dr(d,a.shape,l,c,u,h,!0),p=new l2t(f);return n.runWebGLProgram(p,[o,a],"float32")}const d2t={kernelName:q4,backendName:"webgl",kernelFunc:h2t};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f2t{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p2t(r){const{inputs:t,backend:n}=r,{x:i}=t,o=[...i.shape,...i.shape],a=Nt(i.shape),l=ue({inputs:{x:i},backend:n,attrs:{shape:[a]}}),c=new f2t(a),u=n.runWebGLProgram(c,[l],l.dtype),h=ue({inputs:{x:u},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),h}const m2t={kernelName:uR,backendName:"webgl",kernelFunc:p2t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g2t{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:n,inWidth:i,padInfo:o,strideHeight:a,strideWidth:l,filterHeight:c,filterWidth:u,dilationHeight:h,dilationWidth:d}=t,{top:f,left:p}=o;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${f}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${c}; h++) {
          int hIn = hBeg + h * ${h};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${u}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${i}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v2t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,filter:a}=t,{strides:l,pad:c,dilations:u}=i,h=_g(o.shape,a.shape,l,c,"NHWC",u);let d;const f=new g2t(h);d=n.runWebGLProgram(f,[o,a],"float32");const p=ue({inputs:{x:d},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(d),p}const y2t={kernelName:gv,backendName:"webgl",kernelFunc:v2t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x2t(r){const{inputs:t,backend:n,attrs:i}=r,{equation:o}=i,a=t,{allDims:l,summedDims:c,idDims:u}=$T(o,a.length);ET(l.length,u,a);const{path:h,steps:d}=NT(c,u),f=d.length;let p=null,m=l.length;const g=[];for(let y=0;y<f;++y){for(const v of d[y]){const{permutationIndices:x,expandDims:b}=IT(m,u[v]);let w;AT(x)?w=a[v]:(w=zr({inputs:{x:a[v]},backend:n,attrs:{perm:x}}),g.push(w));const S=w.shape.slice();for(let _=0;_<b.length;++_)S.splice(b[_],0,1);An(w.shape,S)||(w=ue({inputs:{x:w},backend:n,attrs:{shape:S}}),g.push(w)),p===null?p=w:(p=vC({inputs:{a:w,b:p},backend:n}),g.push(p))}y<f-1&&(h[y]>=0&&(p=Ry({inputs:{x:p},backend:n,attrs:{axis:h[y]-(l.length-m),keepDims:!1}}),g.push(p)),m--)}for(const y of g)y!==p&&n.disposeIntermediateTensorInfo(y);return p}const b2t={kernelName:hR,backendName:"webgl",kernelFunc:x2t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w2t="return (x >= 0.0) ? x : (exp(x) - 1.0);",S2t=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,_2t=_n({opSnippet:w2t,packedOpSnippet:S2t}),T2t={kernelName:zm,backendName:"webgl",kernelFunc:_2t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C2t="return (b >= 1.0) ? a : a * (b + 1.0);",k2t=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,$2t=r=>{const{inputs:t,backend:n}=r,{dy:i,y:o}=t,a=kt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ug(k2t,i.shape,o.shape):new jd(C2t,i.shape,o.shape);return n.runWebGLProgram(a,[i,o],i.dtype)},I2t={kernelName:K4,backendName:"webgl",kernelFunc:$2t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E2t=`
  return vec4(equal(a, b));
`,N2t="return float(a == b);",A2t=pr({opSnippet:N2t,packedOpSnippet:E2t,dtype:"bool",cpuKernelImpl:gmt}),M2t={kernelName:vv,backendName:"webgl",kernelFunc:A2t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D2t=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${bT};
  float a1 = ${wT};
  float a2 = ${ST};
  float a3 = ${_T};
  float a4 = ${TT};
  float a5 = ${CT};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,R2t=_n({opSnippet:D2t}),O2t={kernelName:Vm,backendName:"webgl",kernelFunc:R2t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L2t=Cf+`
  return exp(x);
`,F2t=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,lF=_n({opSnippet:L2t,packedOpSnippet:F2t,cpuKernelImpl:vmt,dtype:"float32"}),P2t={kernelName:Um,backendName:"webgl",kernelFunc:lF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tw(r){const{inputs:t,attrs:n,backend:i}=r,{dim:o}=n,{input:a}=t,l=a.shape.length,c=a.shape.slice();let u=o;return o<0&&(W(-(l+1)<=o,()=>`Axis must be in the interval [${-(l+1)}, ${l}]`),u=l+o+1),c.splice(u,0,1),ue({inputs:{x:a},backend:i,attrs:{shape:c}})}const B2t={kernelName:yv,backendName:"webgl",kernelFunc:Tw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wE="return exp(x) - 1.0;",z2t=_n({opSnippet:wE,packedOpSnippet:wE,cpuKernelImpl:ymt}),V2t={kernelName:Wm,backendName:"webgl",kernelFunc:z2t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SE{constructor(t,n,i){this.variableNames=["real","imag"];const o=n[1];this.outputShape=n;const a=i?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,l=i?`${o}.0`:"1.0";let c;if(t==="real")c="return real * expR - imag * expI;";else if(t==="imag")c="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);this.userCode=`
      const float exponentMultiplier = ${a};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${c}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${l};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cF(r,t,n){const i=n.texData.get(r.dataId),o=Nt(r.shape),a=r.shape[r.shape.length-1],l=o/a,c=ue({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),u=c.shape,h=new SE("real",u,t),d=new SE("imag",u,t),f=[{dataId:i.complexTensorInfos.real.dataId,dtype:i.complexTensorInfos.real.dtype,shape:u},{dataId:i.complexTensorInfos.imag.dataId,dtype:i.complexTensorInfos.imag.dtype,shape:u}],p=n.runWebGLProgram(h,f,"float32"),m=n.runWebGLProgram(d,f,"float32"),g=jc({inputs:{real:p,imag:m},backend:n});n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m);const y=ue({inputs:{x:g},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(g),y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U2t(r){const{inputs:t,backend:n}=r,{input:i}=t;return cF(i,!1,n)}const W2t={kernelName:X4,backendName:"webgl",kernelFunc:U2t};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G2t{constructor(t,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gg(r){const{backend:t,attrs:n}=r,{shape:i,value:o}=n;let{dtype:a}=n;if(a=a||km(o),a==="string"){const l=ks(a,Nt(i));return l.fill(o),t.makeTensorInfo(i,a,l)}else{const l=new G2t(i,o),c=[[o]];return t.runWebGLProgram(l,[],a,c)}}const H2t={kernelName:Y4,backendName:"webgl",kernelFunc:Gg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j2t{constructor(t){this.variableNames=["Image"],this.outputShape=[];const n=t[2];this.outputShape=t,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q2t={kernelName:Z4,backendName:"webgl",kernelFunc:({inputs:r,backend:t})=>{const{image:n}=r,i=t,o=new j2t(n.shape);return i.runWebGLProgram(o,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _E="return floor(x);",K2t=_n({opSnippet:_E,packedOpSnippet:_E,cpuKernelImpl:xmt}),X2t={kernelName:Gm,backendName:"webgl",kernelFunc:K2t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y2t=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,Z2t=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,J2t=pr({opSnippet:Y2t,packedOpSnippet:Z2t,dtype:"int32"}),Q2t={kernelName:Hm,backendName:"webgl",kernelFunc:J2t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tvt{constructor(t){this.variableNames=["A"];const n=Vr(),[i,o]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${i}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class evt{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=Vr(),[i,o]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${i}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nvt={kernelName:cY,backendName:"webgl",kernelFunc:svt};let Uh,Yx=kt().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function svt(r){const{inputs:t,backend:n,attrs:i}=r;let{pixels:o}=t;const{numChannels:a}=i,l=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,c=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[u,h]=l?[o.videoWidth,o.videoHeight]:[o.width,o.height],d=[h,u],f=[h,u,a];if(c||l){const y=kt().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Uh==null||y!==Yx)&&(Yx=y,Uh=document.createElement("canvas").getContext("2d",{willReadFrequently:Yx})),Uh.canvas.width=u,Uh.canvas.height=h,Uh.drawImage(o,0,0,u,h),o=Uh.canvas}const p=n.makeTensorInfo(d,"int32");n.texData.get(p.dataId).usage=Ri.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),o);const m=kt().getBool("WEBGL_PACK")?new evt(f):new tvt(f),g=n.runWebGLProgram(m,[p],"int32");return n.disposeData(p.dataId),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rvt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,filter:a,bias:l,preluActivationWeights:c}=t,{strides:u,pad:h,dataFormat:d,dilations:f,dimRoundingMode:p,activation:m,leakyreluAlpha:g}=i,y=Al(d),v=dr(o.shape,a.shape,u,f,h,p,!1,y);let x;const b=[],w=l!=null,S=c!=null,_=m==="leakyrelu",$=()=>{const k=[o,a],I=(O,B)=>{if(B==="NCHW"&&O.shape.length===1&&O.shape[0]!==1){const F=ue({inputs:{x:O},backend:n,attrs:{shape:[O.shape[0],1,1]}});return b.push(F),F}return O};if(w&&k.push(I(l,d)),S&&k.push(I(c,d)),_){const O=n.makeTensorInfo([],"float32",Fc(g,"float32"));k.push(O),b.push(O)}return k};if(v.filterHeight===1&&v.filterWidth===1&&v.dilationHeight===1&&v.dilationWidth===1&&v.strideHeight===1&&v.strideWidth===1&&(v.padInfo.type==="SAME"||v.padInfo.type==="VALID"))x=sF({x:o,filter:a,convInfo:v,backend:n,bias:l,activation:m,preluActivationWeights:c,leakyreluAlpha:g});else if(v.strideWidth<=2&&y==="channelsLast"&&kt().getBool("WEBGL_EXP_CONV")){const k=m?sm(m,!0):null,I=new nF(v,w,k,S,_),O=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],B=$();x=n.runWebGLProgram(I,B,"float32",O)}else if(kt().getBool("WEBGL_CONV_IM2COL"))x=rF({x:o,filter:a,convInfo:v,backend:n,bias:l,activation:m,preluActivationWeights:c,leakyreluAlpha:g});else{const k=m?sm(m,!1):null,I=new eF(v,w,k,S,_),O=$();x=n.runWebGLProgram(I,O,"float32")}const N=ue({inputs:{x},backend:n,attrs:{shape:v.outShape}});return b.push(x),b.forEach(k=>n.disposeIntermediateTensorInfo(k)),N}const ivt={kernelName:n2,backendName:"webgl",kernelFunc:rvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ovt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,filter:a,bias:l,preluActivationWeights:c}=t,{strides:u,pad:h,dilations:d,dimRoundingMode:f,activation:p,leakyreluAlpha:m}=i,g=[];let y=d;y==null&&(y=[1,1]),W(_r(u,y),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${y}'`);const v=dr(o.shape,a.shape,u,y,h,f,!0),x=kt().getBool("WEBGL_PACK_DEPTHWISECONV")&&v.strideWidth<=2&&v.outChannels/v.inChannels===1,b=p?sm(p,x):null,w=[o,a],S=l!=null,_=c!=null,$=p==="leakyrelu";if(S&&w.push(l),_&&w.push(c),$){const O=n.makeTensorInfo([],"float32",Fc(m,"float32"));w.push(O),g.push(O)}let N;x?N=new aF(v,S,b,_,$):N=new oF(v,S,b,_,$);const k=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],I=n.runWebGLProgram(N,w,"float32",k);return g.forEach(O=>n.disposeIntermediateTensorInfo(O)),I}const avt={kernelName:SR,backendName:"webgl",kernelFunc:ovt};class lvt{constructor(t,n,i,o){this.sliceDim=t,this.strides=n,this.paramsShape=o,this.variableNames=["x","indices"],this.outputShape=i;const a=Kn(i.length);let l=`
    int index;`;for(let c=0;c<this.sliceDim;c++)l+=`
          index = round(getIndices(coords[0], ${c}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[c]};
          flattenIndex += index * ${this.strides[c]};`;this.userCode=`
         void main() {
          ${a} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${l}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cvt(r){const{inputs:t,backend:n}=r,{params:i,indices:o}=t,a=o.shape,l=a[a.length-1],c=Nt(i.shape),[u,h,d,f]=I_(i,o),p=ue({inputs:{x:o},backend:n,attrs:{shape:[h,l]}}),m=ue({inputs:{x:i},backend:n,attrs:{shape:[Nt(i.shape)/d,d]}});if(n.shouldExecuteOnCPU([i,o])||i.dtype==="string"){const x=n.readSync(o.dataId),b=n.bufferSync(i),w=bmt(x,b,i.dtype,h,l,d,f,i.shape,c);return n.makeTensorInfo(u,i.dtype,w.values)}const g=new lvt(l,f,[h,d],i.shape),y=n.runWebGLProgram(g,[m,p],m.dtype),v=ue({inputs:{x:y},backend:n,attrs:{shape:u}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),v}const uvt={kernelName:dR,backendName:"webgl",kernelFunc:cvt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hvt{constructor(t,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const i=Kn(this.rank),o=dvt(t);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${o}));
      }
    `}}function dvt(r,t){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[];for(let o=0;o<r.length;o++)o===2?i.push("index"):i.push(`${n[o]}`);return i.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uF(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,indices:a}=t,{axis:l,batchDims:c}=i,u=on(l,o.shape)[0];if(kt().get("DEBUG")){const b=n.readSync(a.dataId),w=o.shape[u];for(let S=0;S<b.length;++S){const _=b[S];W(_<=w-1&&_>=0,()=>`GatherV2: the index value ${_} is not in [0, ${w-1}]`)}}const h=DT(o,a,u,c),d=Nt(a.shape),f=[],p=ue({inputs:{x:o},backend:n,attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]}}),m=ue({inputs:{x:a},backend:n,attrs:{shape:[h.batchSize,d/h.batchSize]}});f.push(p),f.push(m);const g=[h.batchSize,h.outerSize,d/h.batchSize,h.sliceSize];if(n.shouldExecuteOnCPU([o,a])||o.dtype==="string"){const b=n.bufferSync(m),w=n.bufferSync(p),S=wmt(w,b,g);return f.forEach(_=>n.disposeIntermediateTensorInfo(_)),n.makeTensorInfo(h.outputShape,S.dtype,S.values)}const y=new hvt(p.shape,g),v=n.runWebGLProgram(y,[p,m],p.dtype);f.push(v);const x=ue({inputs:{x:v},backend:n,attrs:{shape:h.outputShape}});return f.forEach(b=>n.disposeIntermediateTensorInfo(b)),x}const fvt={kernelName:bv,backendName:"webgl",kernelFunc:uF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pvt="return float(a > b);",mvt=`
  return vec4(greaterThan(a, b));
`,gvt=pr({opSnippet:pvt,packedOpSnippet:mvt,cpuKernelImpl:Smt,dtype:"bool"}),vvt={kernelName:wv,backendName:"webgl",kernelFunc:gvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yvt="return float(a >= b);",xvt=`
  return vec4(greaterThanEqual(a, b));
`,bvt=pr({opSnippet:yvt,packedOpSnippet:xvt,dtype:"bool",cpuKernelImpl:_mt}),wvt={kernelName:jm,backendName:"webgl",kernelFunc:bvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Svt(r){const{inputs:t,backend:n}=r,{input:i}=t;return cF(i,!0,n)}const _vt={kernelName:J4,backendName:"webgl",kernelFunc:Svt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tvt="return float(!isnan(x) && !isinf(x));",Cvt=_n({opSnippet:Tvt,dtype:"bool"}),kvt={kernelName:Km,backendName:"webgl",kernelFunc:Cvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $vt="return float(isinf(x));",Ivt=_n({opSnippet:$vt,dtype:"bool"}),Evt={kernelName:Xm,backendName:"webgl",kernelFunc:Ivt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nvt="return float(isnan(x));",Avt=_n({opSnippet:Nvt,dtype:"bool"}),Mvt={kernelName:Ym,backendName:"webgl",kernelFunc:Avt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dvt="return float(a < b);",Rvt=`
  return vec4(lessThan(a, b));
`,Ovt=pr({opSnippet:Dvt,packedOpSnippet:Rvt,cpuKernelImpl:Tmt,dtype:"bool"}),Lvt={kernelName:_v,backendName:"webgl",kernelFunc:Ovt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fvt="return float(a <= b);",Pvt=`
  return vec4(lessThanEqual(a, b));
`,Bvt=pr({opSnippet:Fvt,packedOpSnippet:Pvt,cpuKernelImpl:Cmt,dtype:"bool"}),zvt={kernelName:Tv,backendName:"webgl",kernelFunc:Bvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vvt(r){const{backend:t,attrs:n}=r,{start:i,stop:o,num:a}=n,l=kmt(i,o,a);return t.makeTensorInfo([l.length],"float32",l)}const Uvt={kernelName:fR,backendName:"webgl",kernelFunc:Vvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wvt=Cf+`
  return x < 0.0 ? 0./0. : log(x);
`,Gvt=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,Hvt=_n({opSnippet:Wvt,packedOpSnippet:Gvt,cpuKernelImpl:$mt}),jvt={kernelName:Zm,backendName:"webgl",kernelFunc:Hvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qvt=Cf+`
  return log(1.0 + x);
`,Kvt=_n({opSnippet:qvt}),Xvt={kernelName:Jm,backendName:"webgl",kernelFunc:Kvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yvt="return float(a >= 1.0 && b >= 1.0);",Zvt=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Jvt=pr({opSnippet:Yvt,packedOpSnippet:Zvt,dtype:"bool"}),Qvt={kernelName:Cv,backendName:"webgl",kernelFunc:Jvt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tyt="return float(!(x >= 1.0));",eyt=_n({opSnippet:tyt}),nyt={kernelName:kv,backendName:"webgl",kernelFunc:eyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const syt="return float(a >= 1.0 || b >= 1.0);",ryt=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,iyt=pr({opSnippet:syt,packedOpSnippet:ryt,dtype:"bool"}),oyt={kernelName:$v,backendName:"webgl",kernelFunc:iyt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ayt{constructor(t,n,i,o,a){this.variableNames=["x"],this.outputShape=[];const l=n,c=t[3]-1;this.outputShape=t;let u;const h=`float(${i}) + float(${o}) * sum`;a===.5?u=`inversesqrt(${h})`:a===1?u=`1.0/(${h})`:u=`exp(log(${h}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${l}; j <= ${l}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${c}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${u};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lyt{constructor(t,n,i,o,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const l=n,c=t[3]-1;this.outputShape=t;let u;const h=`float(${i}) + float(${o}) * sum`;a===.5?u=`inversesqrt(${h})`:a===1?u=`1.0/(${h})`:u=`exp(log(${h}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${l};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${l}; j <= ${l}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${c}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${u};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cyt=r=>{const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{depthRadius:a,bias:l,alpha:c,beta:u}=i,h=kt().getBool("WEBGL_PACK_NORMALIZATION")?new lyt(o.shape,a,l,c,u):new ayt(o.shape,a,l,c,u);return n.runWebGLProgram(h,[o],o.dtype)},uyt={kernelName:Iv,backendName:"webgl",kernelFunc:cyt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hyt{constructor(t,n,i,o,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=i,this.alpha=o,this.beta=a,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${i});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${a})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${a});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dyt=r=>{const{inputs:t,backend:n,attrs:i}=r,{x:o,y:a,dy:l}=t,{depthRadius:c,bias:u,alpha:h,beta:d}=i,f=new hyt(o.shape,c,u,h,d);return n.runWebGLProgram(f,[o,a,l],o.dtype)},fyt={kernelName:t_,backendName:"webgl",kernelFunc:dyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pyt(r,t,n,i){const o=Nt(t),l=Nt(r.shape)/o,c=ue({inputs:{x:r},attrs:{shape:[l,o]},backend:i}),u=kh(c,r.dtype,"max",i),h=ue({inputs:{x:u},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(c),i.disposeIntermediateTensorInfo(u),h}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hF(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{reductionIndices:a,keepDims:l}=i,c=o.shape.length,u=on(a,o.shape);let h=u;const d=ms(h,c),f=d!=null,p=n.shouldExecuteOnCPU([o]);let m=o;if(f){if(p){const w=n.texData.get(m.dataId).values,S=new Array(c);for(let N=0;N<S.length;N++)S[N]=o.shape[d[N]];const _=mC(w,o.shape,o.dtype,d,S);m=n.makeTensorInfo(S,o.dtype);const $=n.texData.get(m.dataId);$.values=_}else m=Dy(o,d,n);h=_s(h.length,c)}fr("max",h,c);const[g,y]=Zs(m.shape,h);let v=g;l&&(v=Ss(g,u));let x;if(p){const w=n.texData.get(m.dataId).values,S=Imt(w,Nt(y),v,o.dtype);x=n.makeTensorInfo(v,o.dtype);const _=n.texData.get(x.dataId);_.values=S}else x=pyt(m,y,v,n);return f&&n.disposeIntermediateTensorInfo(m),x}const myt={kernelName:Ev,backendName:"webgl",kernelFunc:hF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gyt=gC+`
  return max(a, b);
`,vyt=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Vg+`
  return result;
`,yyt=pr({opSnippet:gyt,packedOpSnippet:vyt,cpuKernelImpl:Emt}),xyt={kernelName:Qm,backendName:"webgl",kernelFunc:yyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function byt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t;Bg(o,"maxPool");const{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=i,h=1;W(_r(l,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);const d=ko(o.shape,a,l,h,c,u);if(d.filterWidth===1&&d.filterHeight===1&&An(d.inShape,d.outShape))return xi({inputs:{x:o},backend:n});const f=new rm(d,"max",!1);return n.runWebGLProgram(f,[o],o.dtype)}const wyt={kernelName:Nv,backendName:"webgl",kernelFunc:byt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Syt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{filterSize:a,strides:l,pad:c,dataFormat:u,dimRoundingMode:h}=i,d=[1,1,1],f=Nl(o.shape,a,l,d,c,h,u),p=new yC(f,"max",!1);return n.runWebGLProgram(p,[o],o.dtype)}const _yt={kernelName:Av,backendName:"webgl",kernelFunc:Syt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tyt{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const n=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,a=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=a-1-t.padInfo.top,u=l-1-t.padInfo.left,h=a*l-1;this.userCode=`
      const ivec2 pads = ivec2(${c}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${a};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${h} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${l} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Cyt{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const n=t.strideDepth,i=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,u=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=u-1-t.padInfo.front,p=h-1-t.padInfo.top,m=d-1-t.padInfo.left,g=u*h*d-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${p}, ${m});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${u};
           wD += ${a}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${g} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${h} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kyt(r){const{inputs:t,backend:n,attrs:i}=r,{dy:o,input:a}=t,l=a,{filterSize:c,strides:u,pad:h,dimRoundingMode:d}=i,f=[1,1,1],p=Nl(l.shape,c,u,f,h,d),m=new yC(p,"max",!0),g=n.runWebGLProgram(m,[l],l.dtype),y=new Cyt(p),v=n.runWebGLProgram(y,[o,g],l.dtype);return n.disposeIntermediateTensorInfo(g),v}const $yt={kernelName:n_,backendName:"webgl",kernelFunc:kyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iyt(r){const{inputs:t,backend:n,attrs:i}=r,{dy:o,input:a,output:l}=t,c=a;Bg([a,l],"maxPoolGrad");const{filterSize:u,strides:h,pad:d,dimRoundingMode:f}=i,p=ko(c.shape,u,h,1,d,f),m=!0,g=new rm(p,"max",m),y=n.runWebGLProgram(g,[c],c.dtype),v=new Tyt(p),x=n.runWebGLProgram(v,[o,y],c.dtype);return n.disposeIntermediateTensorInfo(y),x}const Eyt={kernelName:e_,backendName:"webgl",kernelFunc:Iyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nyt(r,t,n,i){let o=new rm(n,"max",!1);const a=i.runWebGLProgram(o,[r],"float32");o=new rm(n,"max",!0,!0,t);const l=i.runWebGLProgram(o,[r],"float32");return[a,l]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ayt={kernelName:pR,backendName:"webgl",kernelFunc:({inputs:r,attrs:t,backend:n})=>{const{x:i}=r,{filterSize:o,strides:a,pad:l,includeBatchInIndex:c}=t,u=n;W(i.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${i.shape.length}.`);const h=[1,1];W(_r(a,h),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${h}'`);const d=ko(i.shape,o,a,h,l),[f,p]=Nyt(i,c,d,u);return[f,p]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Myt(r,t,n,i){const o=Nt(t),l=Nt(r.shape)/o,c=ue({inputs:{x:r},attrs:{shape:[l,o]},backend:i}),u=kh(c,"float32","mean",i),h=ue({inputs:{x:u},attrs:{shape:n},backend:i});return i.disposeIntermediateTensorInfo(c),i.disposeIntermediateTensorInfo(u),h}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dyt={kernelName:Mv,backendName:"webgl",kernelFunc:({inputs:r,attrs:t,backend:n})=>{const{x:i}=r,{keepDims:o,axis:a}=t,l=n,c=i.shape.length,u=on(a,i.shape);let h=u;const d=ms(h,c),f=d!=null,p=l.shouldExecuteOnCPU([i]),m=[];let g=i;if(f){if(p){const S=l.texData.get(g.dataId).values,_=new Array(c);for(let k=0;k<_.length;k++)_[k]=i.shape[d[k]];const $=mC(S,i.shape,i.dtype,d,_);g=l.makeTensorInfo(_,i.dtype);const N=l.texData.get(g.dataId);N.values=$}else g=Dy(i,d,l);m.push(g),h=_s(h.length,c)}fr("sum",h,c);const[y,v]=Zs(g.shape,h);let x=y;o&&(x=Ss(y,u));const b=Myt(g,v,x,l);for(const w of m)l.disposeIntermediateTensorInfo(w);return b}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ryt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a,keepDims:l}=i,c=o.shape.length,u=on(a,o.shape);let h=u;const d=ms(h,c);let f=o;d!=null&&(f=zr({inputs:{x:o},backend:n,attrs:{perm:d}}),h=_s(h.length,o.shape.length)),fr("min",h,c);const[p,m]=Zs(f.shape,h),g=Nt(m),y=ue({inputs:{x:f},backend:n,attrs:{shape:[-1,g]}}),v=kh(y,y.dtype,"min",n);let x;if(l){const b=Ss(p,u);x=ue({inputs:{x:v},backend:n,attrs:{shape:b}})}else x=ue({inputs:{x:v},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),d!=null&&n.disposeIntermediateTensorInfo(f),x}const Oyt={kernelName:Dv,backendName:"webgl",kernelFunc:Ryt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lyt=gC+`
  return min(a, b);
`,Fyt=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Vg+`
  return result;
`,Pyt=pr({opSnippet:Lyt,packedOpSnippet:Fyt,cpuKernelImpl:Nmt}),Byt={kernelName:tg,backendName:"webgl",kernelFunc:Pyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zyt{constructor(t,n,i){this.variableNames=["x"],this.outputShape=n.map((d,f)=>d[0]+t[f]+d[1]);const o=t.length,a=Kn(o),l=n.map(d=>d[0]).join(","),c=n.map((d,f)=>d[0]+t[f]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),h=i==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${l};
        int end = ${c};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${h};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${h};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${l});
      ${a} end = ${a}(${c});

      void main() {
        ${a} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${h};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${h};
          }
        }
        ${a} coords = outC - start;
        setOutput(getX(${u}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vyt{constructor(t,n,i){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((g,y)=>g[0]+t[y]+g[1]);const o=t.length,a=Kn(o),l=n.map(g=>g[0]).join(","),c=n.map((g,y)=>g[0]+t[y]).join(","),u=Rr("rc",o),h=Rr("source",o),d=`${u[o-1]} < ${this.outputShape[o-1]}`,f=o===1?"source":`vec2(${h.slice(-2).join()})`,p=i==="reflect"?0:1;let m="";if(o===1){const g=`
        ${a} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;m=`
        ${a} rc = outputLoc;
        ${g}
        result[0] = getChannel(getX(${h.join()}), ${f});
        ${u[o-1]} += 1;
        if(${d}) {
          ${g}
          result[1] = getChannel(getX(${h.join()}), ${f});
        }
      `}else{const g=`
        ${a} source = rc;
        ${a} lt = ${a}(lessThan(source, start));
        ${a} gte = ${a}(greaterThanEqual(source, end));
        ${a} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;m=`
        ${a} rc = outputLoc;
        ${g}
        result[0] = getChannel(getX(${h.join()}), ${f});
        ${u[o-1]} += 1;
        if(${d}) {
          ${g}
          result[1] = getChannel(getX(${h.join()}), ${f});
        }
        rc = outputLoc;
        ${u[o-2]} += 1;
        if(${u[o-2]} < ${this.outputShape[o-2]}) {
          ${g}
          result[2] = getChannel(getX(${h.join()}), ${f});
          ${u[o-1]} += 1;
          if(${d}) {
            ${g}
            result[3] = getChannel(getX(${h.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${a} start = ${a}(${l});
      const ${a} end = ${a}(${c});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uyt=({inputs:r,backend:t,attrs:n})=>{const{x:i}=r,{paddings:o,mode:a}=n,l=kt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Vyt(i.shape,o,a):new zyt(i.shape,o,a);return t.runWebGLProgram(l,[i],i.dtype)},Wyt={kernelName:Rv,backendName:"webgl",kernelFunc:Uyt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gyt=`if (b == 0.0) return NAN;
  return mod(a, b);`,Hyt=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Vg+`
  return result;
`,jyt=pr({opSnippet:Gyt,packedOpSnippet:Hyt}),qyt={kernelName:eg,backendName:"webgl",kernelFunc:jyt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kyt{constructor(t,n,i){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,i],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xyt=`
if (a == b) {
  return 1.0;
};
return a / b;`,Yyt=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,dF=pr({opSnippet:Xyt,packedOpSnippet:Yyt,checkOutOfBounds:!0}),Zyt={kernelName:Bm,backendName:"webgl",kernelFunc:dF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TE="return a - b;",fF=pr({opSnippet:TE,packedOpSnippet:TE,supportsComplex:!0,cpuKernelImpl:Ymt}),Jyt={kernelName:vg,backendName:"webgl",kernelFunc:fF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pF(r){const{inputs:t,backend:n,attrs:i}=r,{logits:o}=t,{dim:a}=i,l=on([a],o.shape),c=hF({inputs:{x:o},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),u=Ss(c.shape,l),h=ue({inputs:{x:c},backend:n,attrs:{shape:u}}),d=fF({inputs:{a:o,b:h},backend:n}),f=lF({inputs:{x:d},backend:n}),p=Ry({inputs:{x:f},backend:n,attrs:{axis:l,keepDims:!1}}),m=ue({inputs:{x:p},backend:n,attrs:{shape:u}}),g=dF({inputs:{a:f,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const Qyt={kernelName:Jv,backendName:"webgl",kernelFunc:pF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function txt(r){const{inputs:t,backend:n,attrs:i}=r,{logits:o}=t,{numSamples:a,seed:l,normalized:c}=i,u=c?o:pF({inputs:{logits:o},backend:n,attrs:{dim:o.shape.length-1}}),h=u.shape[0],d=u.shape[1],f=new Kyt(h,d,a),p=[[l]],m=n.runWebGLProgram(f,[u],"int32",p);return c||n.disposeIntermediateTensorInfo(u),m}const ext={kernelName:mR,backendName:"webgl",kernelFunc:txt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nxt=Io+`
  return -x;
`,sxt=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function rxt(r){const{inputs:t,backend:n}=r,{x:i}=t;if(n.shouldExecuteOnCPU([i])){const a=n.texData.get(i.dataId),[l,c]=Mmt(a.values,i.shape,i.dtype);return n.makeTensorInfo(c,i.dtype,l)}let o;return kt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new rc(i.shape,sxt):o=new ka(i.shape,nxt),n.runWebGLProgram(o,[i],i.dtype)}const ixt={kernelName:Ov,backendName:"webgl",kernelFunc:rxt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oxt=iT;function axt(r){Di("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:i}=r,{boxes:o,scores:a}=t,{maxOutputSize:l,iouThreshold:c,scoreThreshold:u}=i,h=n.readSync(o.dataId),d=n.readSync(a.dataId),{selectedIndices:f}=oxt(h,d,l,c,u);return n.makeTensorInfo([f.length],"int32",new Int32Array(f))}const lxt={kernelName:s_,backendName:"webgl",kernelFunc:axt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cxt=oT;function uxt(r){Di("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:i}=r,{boxes:o,scores:a}=t,{maxOutputSize:l,iouThreshold:c,scoreThreshold:u,padToMaxOutputSize:h}=i,d=n.readSync(o.dataId),f=n.readSync(a.dataId),{selectedIndices:p,validOutputs:m}=cxt(d,f,l,c,u,h);return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([m]))]}const hxt={kernelName:r_,backendName:"webgl",kernelFunc:uxt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dxt=aT;function fxt(r){Di("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:i}=r,{boxes:o,scores:a}=t,{maxOutputSize:l,iouThreshold:c,scoreThreshold:u,softNmsSigma:h}=i,d=n.readSync(o.dataId),f=n.readSync(a.dataId),p=l,m=c,g=u,y=h,{selectedIndices:v,selectedScores:x}=dxt(d,f,p,m,g,y);return[n.makeTensorInfo([v.length],"int32",new Int32Array(v)),n.makeTensorInfo([x.length],"float32",new Float32Array(x))]}const pxt={kernelName:i_,backendName:"webgl",kernelFunc:fxt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mxt{constructor(t,n,i,o){this.variableNames=["indices"],this.outputShape=[t,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${i}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gxt=r=>{const{inputs:t,backend:n,attrs:i}=r,{indices:o}=t,{dtype:a,depth:l,onValue:c,offValue:u}=i,h=Nt(o.shape),d=new mxt(h,l,c,u),f=ue({inputs:{x:o},backend:n,attrs:{shape:[h]}}),p=n.runWebGLProgram(d,[f],a);n.disposeIntermediateTensorInfo(f);const m=[...o.shape,l],g=ue({inputs:{x:p},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(p),g},vxt={kernelName:Pv,backendName:"webgl",kernelFunc:gxt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $2(r){const{inputs:t,backend:n}=r,{x:i}=t;if(i.dtype==="complex64"){const o=Wg({inputs:{input:i},backend:n}),a=$2({inputs:{x:o},backend:n}),l=Oy({inputs:{input:i},backend:n}),c=$2({inputs:{x:l},backend:n}),u=jc({inputs:{real:a,imag:c},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),u}else return Gg({attrs:{shape:i.shape,dtype:i.dtype,value:i.dtype==="string"?"":0},backend:n})}const yxt={kernelName:ey,backendName:"webgl",kernelFunc:$2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mF(r){const{inputs:t,backend:n}=r,{x:i}=t;if(i.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(i.dtype==="complex64"){const o=Wg({inputs:{input:i},backend:n}),a=mF({inputs:{x:o},backend:n}),l=Oy({inputs:{input:i},backend:n}),c=$2({inputs:{x:l},backend:n}),u=jc({inputs:{real:a,imag:c},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),u}else return Gg({attrs:{shape:i.shape,dtype:i.dtype,value:1},backend:n})}const xxt={kernelName:Fv,backendName:"webgl",kernelFunc:mF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bxt(r){const{inputs:t,backend:n,attrs:i}=r,{axis:o}=i;if(t.length===1)return Tw({inputs:{input:t[0]},backend:n,attrs:{dim:o}});const a=t[0].shape,l=t[0].dtype;t.forEach(d=>{Co(a,d.shape,"All tensors passed to stack must have matching shapes"),W(l===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const c=[],u=t.map(d=>{const f=Tw({inputs:{input:d},backend:n,attrs:{dim:o}});return c.push(f),f}),h=tF({inputs:u,backend:n,attrs:{axis:o}});return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),h}const wxt={kernelName:Bv,backendName:"webgl",kernelFunc:bxt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sxt{constructor(t,n,i){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((h,d)=>h[0]+t[d]+h[1]);const o=t.length,a=Kn(o),l=n.map(h=>h[0]).join(","),c=n.map((h,d)=>h[0]+t[d]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${l};
        int end = ${c};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${l});
      ${a} end = ${a}(${c});

      void main() {
        ${a} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${a} coords = outC - start;
          setOutput(getX(${u}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _xt{constructor(t,n,i){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((y,v)=>y[0]+t[v]+y[1]);const o=t.length,a=Kn(o),l=n.map(y=>y[0]).join(","),c=n.map((y,v)=>y[0]+t[v]).join(","),u=Rr("rc",o),h=Rr("source",o),d=`${u[o-1]} < ${this.outputShape[o-1]}`,f=o===1?"source":`vec2(${h.slice(-2).join()})`,p=[`${a} rc = outputLoc;`,`${u[o-1]} += 1;
       if(${d}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${u[o-2]} += 1;
       if(${u[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${u[o-1]} += 1;
         if(${d}) {`],m=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let g="";for(let y=0,v=o===1?2:4;y<v;y++)g+=`
        ${p[y]}
        if (${m}) {
          result[${y}] = float(value);
        } else {
          ${a} source = rc - start;
          result[${y}] = getChannel(getX(${h.join()}), ${f});
        }
      `;g+=o===1?"} ":"}}",this.userCode=`
      const ${a} start = ${a}(${l});
      const ${a} end = ${a}(${c});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gF=r=>{const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{paddings:a,constantValue:l}=i;if(Nt(o.shape)===0){const h=a.map((d,f)=>d[0]+o.shape[f]+d[1]);return Gg({backend:n,attrs:{shape:h,value:l,dtype:o.dtype}})}const c=kt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _xt(o.shape,a,l):new Sxt(o.shape,a,l),u=[[l]];return n.runWebGLProgram(c,[o],o.dtype,u)},Txt={kernelName:zv,backendName:"webgl",kernelFunc:gF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cxt=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,kxt=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Vg+`
  return result;
`,$xt=pr({opSnippet:Cxt,packedOpSnippet:kxt}),Ixt={kernelName:sg,backendName:"webgl",kernelFunc:$xt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ext(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{axis:a,keepDims:l}=i,c=o.shape.length,u=[],h=on(a,o.shape);let d=h;const f=ms(d,c);let p=o;f!=null&&(p=zr({inputs:{x:o},backend:n,attrs:{perm:f}}),d=_s(d.length,c),u.push(p)),fr("prod",d,c);let m;if(n.shouldExecuteOnCPU([p])){const g=n.texData.get(p.dataId).values,{outVals:y,outShape:v,outDtype:x}=Rmt(p.shape,p.dtype,g,d);m=n.makeTensorInfo(v,x,y)}else{const[g,y]=Zs(p.shape,d),v=Nt(y),x=ue({inputs:{x:p},backend:n,attrs:{shape:[-1,v]}}),b=T_(o.dtype),w=kh(x,b,"prod",n);m=ue({inputs:{x:w},backend:n,attrs:{shape:g}}),u.push(x),u.push(w)}if(l){u.push(m);const g=Ss(m.shape,h);m=ue({inputs:{x:m},backend:n,attrs:{shape:g}})}return u.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}const Nxt={kernelName:Uv,backendName:"webgl",kernelFunc:Ext};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Axt(r){const{inputs:t,backend:n,attrs:i}=r,{paramsNestedSplits:o,paramsDenseValues:a,indices:l}=t,{outputRaggedRank:c}=i,u=o.map(x=>n.readSync(x.dataId)),h=o.map(x=>x.shape),d=n.readSync(a.dataId),f=n.readSync(l.dataId),[p,m,g]=Omt(u,h,d,a.shape,a.dtype,f,l.shape,c),y=p.map(x=>n.makeTensorInfo([x.length],"int32",x)),v=n.makeTensorInfo(g,a.dtype,m);return y.concat([v])}const Mxt={kernelName:gR,backendName:"webgl",kernelFunc:Axt};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dxt(r){const{inputs:t,backend:n}=r,{starts:i,limits:o,deltas:a}=t,l=n.readSync(i.dataId),c=n.readSync(o.dataId),u=n.readSync(a.dataId),[h,d]=Lmt(l,i.shape,i.dtype,c,o.shape,u,a.shape),f=n.makeTensorInfo([h.length],"int32",h),p=n.makeTensorInfo([d.length],i.dtype,d);return[f,p]}const Rxt={kernelName:vR,backendName:"webgl",kernelFunc:Dxt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oxt(r){const{inputs:t,backend:n,attrs:i}=r,{shape:o,values:a,defaultValue:l,rowPartitionTensors:c}=t,{rowPartitionTypes:u}=i,h=n.readSync(o.dataId),d=n.readSync(a.dataId),f=n.readSync(l.dataId),p=c.map(v=>n.readSync(v.dataId)),m=c.map(v=>v.shape),[g,y]=Fmt(h,o.shape,d,a.shape,a.dtype,f,l.shape,p,m,u);return n.makeTensorInfo(g,a.dtype,y)}const Lxt={kernelName:yR,backendName:"webgl",kernelFunc:Oxt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vF=r=>{const{backend:t,attrs:n}=r,{start:i,stop:o,step:a,dtype:l}=n,c=Pmt(i,o,a,l);return t.makeTensorInfo([c.length],l,c)},Fxt={kernelName:o_,backendName:"webgl",kernelFunc:vF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pxt="return 1.0 / x;",Bxt=_n({opSnippet:Pxt}),zxt={kernelName:rg,backendName:"webgl",kernelFunc:Bxt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vxt=Io+`
  return (x < 0.0) ? 0.0 : x;
`,Uxt=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Wxt=_n({opSnippet:Vxt,packedOpSnippet:Uxt}),Gxt={kernelName:ig,backendName:"webgl",kernelFunc:Wxt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hxt=Io+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,jxt=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,qxt=_n({opSnippet:Hxt,packedOpSnippet:jxt}),Kxt={kernelName:og,backendName:"webgl",kernelFunc:qxt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xxt{constructor(t,n,i,o,a){this.variableNames=["A"],this.outputShape=[];const[l,c,u,h]=t;this.outputShape=[l,n,i,h];const d=[o&&n>1?c-1:c,o&&i>1?u-1:u],f=[o&&n>1?n-1:n,o&&i>1?i-1:i];let p;a?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${c}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yxt{constructor(t,n,i,o,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[l,c,u,h]=t;this.outputShape=[l,n,i,h];const d=[o&&n>1?c-1:c,o&&i>1?u-1:u],f=[o&&n>1?n-1:n,o&&i>1?i-1:i];let p;a?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${c}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${h-1};
        bool hasNextRow = coords.z < ${i-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zxt(r){const{inputs:t,backend:n,attrs:i}=r,{images:o}=t,{alignCorners:a,halfPixelCenters:l,size:c}=i,[u,h]=c,d=kt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Yxt(o.shape,u,h,a,l):new Xxt(o.shape,u,h,a,l);return n.runWebGLProgram(d,[o],"float32")}const Jxt={kernelName:Hv,backendName:"webgl",kernelFunc:Zxt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qxt{constructor(t,n,i){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,o,a]=n,[,l,c]=t,u=[i&&l>1?o-1:o,i&&c>1?a-1:a],h=[i&&l>1?l-1:l,i&&c>1?c-1:c],d=u[0]/h[0],f=u[1]/h[1],p=1/d,m=1/f,g=Math.ceil(p)*2+2,y=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${m});

        const int winHeight = int(${g});
        const int winWidth = int(${y});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${l}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${c}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${a-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tbt(r){const{inputs:t,backend:n,attrs:i}=r,{images:o,dy:a}=t,{alignCorners:l}=i,c=new Qxt(a.shape,o.shape,l);return n.runWebGLProgram(c,[a],a.dtype)}const ebt={kernelName:c_,backendName:"webgl",kernelFunc:tbt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nbt{constructor(t,n,i,o,a){this.variableNames=["A"],this.outputShape=[];const[l,c,u,h]=t;this.outputShape=[l,n,i,h];const d=[o&&n>1?c-1:c,o&&i>1?u-1:u],f=[o&&n>1?n-1:n,o&&i>1?i-1:i],p=o?"0.5":"0.0";let m;a?m="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":m="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${c}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${m};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sbt{constructor(t,n,i,o,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[l,c,u,h]=t;this.outputShape=[l,n,i,h];const d=[o&&n>1?c-1:c,o&&i>1?u-1:u],f=[o&&n>1?n-1:n,o&&i>1?i-1:i],p=o?"0.5":"0.0";let m;a?m="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":m="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${c}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${m};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${h-1};
        bool hasNextRow = coords.z < ${i-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rbt(r){const{inputs:t,backend:n,attrs:i}=r,{images:o}=t,{alignCorners:a,halfPixelCenters:l,size:c}=i,[u,h]=c,d=kt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new sbt(o.shape,u,h,a,l):new nbt(o.shape,u,h,a,l);return n.runWebGLProgram(d,[o],o.dtype)}const ibt={kernelName:Gv,backendName:"webgl",kernelFunc:rbt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class obt{constructor(t,n,i){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,o,a]=n,[,l,c]=t,u=[i&&l>1?o-1:o,i&&c>1?a-1:a],h=[i&&l>1?l-1:l,i&&c>1?c-1:c],d=u[0]/h[0],f=u[1]/h[1],p=1/d,m=1/f,g=Math.ceil(p)*2+2,y=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${m});

        const int winHeight = int(${g});
        const int winWidth = int(${y});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${l}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${c}) {
              continue;
            }

            float sourceFracRow =
              float(${u[0]}) *
                (float(dyR) / float(${h[0]}));

            float sourceFracCol =
                float(${u[1]}) *
                  (float(dyC) / float(${h[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${i} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${a}) - 1),
                ${i} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function abt(r){const{inputs:t,backend:n,attrs:i}=r,{images:o,dy:a}=t,{alignCorners:l}=i,c=new obt(a.shape,o.shape,l);return n.runWebGLProgram(c,[a],a.dtype)}const lbt={kernelName:l_,backendName:"webgl",kernelFunc:abt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cbt{constructor(t,n){this.variableNames=["x"];const i=t.length;if(i>4)throw new Error(`WebGL backend: Reverse of rank-${i} tensor is not yet supported`);if(this.outputShape=t,i===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${t[0]} - coord - 1));
        }
      `;return}const o=c=>n.indexOf(c)!==-1&&t[c]!==1?`${t[c]} - coords[${c}] - 1`:`coords[${c}]`,a=t.map((c,u)=>o(u)).join(","),l=Kn(i);this.userCode=`
      void main() {
        ${l} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ubt{constructor(t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const i=t.length;if(i>4)throw new Error(`WebGL backend: Reverse of rank-${i} tensor is not yet supported`);this.outputShape=t;const o=Rr("rc",i),a=`${o[i-1]} + 1 < ${this.outputShape[i-1]}`,l=`${o[i-2]} + 1 < ${this.outputShape[i-2]}`,c=Kn(i);i===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${t[0]} - rc - 1),
            ${t[0]} - rc - 1);
          if(${a}){
              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),
                ${t[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${c} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${u(o.slice())};
          if(${a}){
            result.g = ${h(o.slice())};
          }
          if(${l}) {
            result.b = ${d(o.slice())};
            if(${a}) {
              result.a = ${f(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function u(g){return p(g)}function h(g){return g[i-1]="("+g[i-1]+" + 1)",p(g)}function d(g){return g[i-2]="("+g[i-2]+" + 1)",p(g)}function f(g){return g[i-1]="("+g[i-1]+" + 1)",g[i-2]="("+g[i-2]+" + 1)",p(g)}function p(g){const y=t.map((b,w)=>m(w,g)),v=y.join(","),x=y.slice(-2).join(",");return`getChannel(getX(${v}), vec2(${x}))`}function m(g,y){return n.indexOf(g)!==-1&&t[g]!==1?`${t[g]} - ${y[g]} - 1`:`${y[g]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hbt(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{dims:a}=i,l=o.shape.length,c=on(a,o.shape);if(l===0)return xi({inputs:{x:o},backend:n});const u=kt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ubt(o.shape,c):new cbt(o.shape,c);return n.runWebGLProgram(u,[o],o.dtype)}const dbt={kernelName:jv,backendName:"webgl",kernelFunc:hbt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fbt{constructor(t,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const i=t[1],o=t[2];this.outputShape=t;let a="";typeof n=="number"?a=`float outputValue = ${n.toFixed(2)};`:a=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${a}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${i}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pbt={kernelName:S_,backendName:"webgl",kernelFunc:({inputs:r,attrs:t,backend:n})=>{const{image:i}=r,{radians:o,fillValue:a,center:l}=t,c=n,u=new fbt(i.shape,a),[h,d]=vT(l,i.shape[1],i.shape[2]),f=[[h,d,Math.sin(o),Math.cos(o)]];return c.runWebGLProgram(u,[i],i.dtype,f)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mbt=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,gbt=_n({opSnippet:mbt}),vbt={kernelName:ag,backendName:"webgl",kernelFunc:gbt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ybt="return inversesqrt(x);",xbt=_n({opSnippet:ybt,cpuKernelImpl:Bmt}),bbt={kernelName:lg,backendName:"webgl",kernelFunc:xbt};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yF{constructor(t,n,i,o,a,l,c=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=l;const u=Kn(a.length),h=Kn(l.length);let d="";i===1?d="i":i===2&&(d="i, j");const f=`getIndices(${d})`;let p="";o===1?p="i":o===2&&(p="i, coords[1]");const m=`getUpdates(${p})`,g=n>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${a});

        void main() {
          ${h} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${t}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${g};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${m};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wbt(r){const{inputs:t,backend:n,attrs:i}=r,{indices:o,updates:a}=t,{shape:l}=i,{sliceRank:c,numUpdates:u,sliceSize:h,strides:d,outputSize:f}=Sg(a,o,l),p=[f/h,h];if(f===0)return n.makeTensorInfo(l,o.dtype);const m=ue({inputs:{x:o},backend:n,attrs:{shape:[u,c]}}),g=ue({inputs:{x:a},backend:n,attrs:{shape:[u,h]}}),y=n.makeTensorInfo([],"float32",new Float32Array([0])),v=new yF(u,c,m.shape.length,g.shape.length,d,p),x=n.runWebGLProgram(v,[g,m,y],g.dtype),b=ue({inputs:{x},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(y),b}const Sbt={kernelName:xR,backendName:"webgl",kernelFunc:wbt};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _bt{constructor(t,n,i,o){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,i];const a="while (left < right) {",l=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,c=kt().getNumber("WEBGL_VERSION")===2?a:l,u=o==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${c}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${u} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tbt(r){const{inputs:t,backend:n,attrs:i}=r,{sortedSequence:o,values:a}=t,{side:l}=i,c=new _bt(o.shape[0],o.shape[1],a.shape[1],l),u=[[o.shape[1]]];return n.runWebGLProgram(c,[o,a],"int32",u)}const Cbt={kernelName:bR,backendName:"webgl",kernelFunc:Tbt};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kbt{constructor(t,n,i){this.variableNames=["c","a","b"],this.outputShape=n;let o,a;if(i>4)throw Error(`Where for rank ${i} is not yet supported`);if(i===1)a="resRC",o="resRC";else{const c=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],h=[];for(let d=0;d<n.length;d++)h.push(`${c[d]}`),d<t&&u.push(`${c[d]}`);o=u.join(),a=h.join()}const l=Kn(i);this.userCode=`
      void main() {
        ${l} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${a}));
        } else {
          setOutput(getB(${a}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $bt(r){const{inputs:t,backend:n}=r,{condition:i,t:o,e:a}=t,l=new kbt(i.shape.length,o.shape,o.shape.length);return n.runWebGLProgram(l,[i,o,a],gi(o.dtype,a.dtype))}const Ibt={kernelName:qv,backendName:"webgl",kernelFunc:$bt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ebt=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${my};
  float scale = ${gy};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Nbt=_n({opSnippet:Ebt}),Abt={kernelName:cg,backendName:"webgl",kernelFunc:Nbt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mbt=Cf+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Dbt=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Rbt=_n({opSnippet:Mbt,packedOpSnippet:Dbt,cpuKernelImpl:Vmt}),Obt={kernelName:fg,backendName:"webgl",kernelFunc:Rbt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lbt=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Fbt=_n({opSnippet:Lbt}),Pbt={kernelName:dg,backendName:"webgl",kernelFunc:Fbt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bbt=Cf+`
  return sin(x);
`,zbt=_n({opSnippet:Bbt}),Vbt={kernelName:ug,backendName:"webgl",kernelFunc:zbt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ubt=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,Wbt=_n({opSnippet:Ubt}),Gbt={kernelName:hg,backendName:"webgl",kernelFunc:Wbt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hbt=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,jbt=_n({opSnippet:Hbt}),qbt={kernelName:pg,backendName:"webgl",kernelFunc:jbt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kbt=r=>{const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{blockShape:a,paddings:l}=i;W(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const c=a.reduce((x,b)=>x*b),u=[[0,0]];u.push(...l);for(let x=1+a.length;x<o.shape.length;++x)u.push([0,0]);const h=[],d=gF({inputs:{x:o},backend:n,attrs:{paddings:u,constantValue:0}}),f=Ig(d.shape,a,c,!1),p=Eg(f.length,a.length,!1),m=Ng(d.shape,a,c,!1),g=ue({inputs:{x:d},backend:n,attrs:{shape:f}}),y=zr({inputs:{x:g},backend:n,attrs:{perm:p}}),v=ue({inputs:{x:y},backend:n,attrs:{shape:m}});return h.push(d),h.push(g),h.push(y),h.forEach(x=>n.disposeIntermediateTensorInfo(x)),v},Xbt={kernelName:Yv,backendName:"webgl",kernelFunc:Kbt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ybt(r){const{inputs:t,backend:n}=r,{indices:i,values:o,denseShape:a,defaultValue:l}=t;if(a.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${a.shape}`);if(i.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${i.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(l.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${l.shape}`);const c=n.readSync(i.dataId),u=n.readSync(o.dataId),h=n.readSync(a.dataId),d=n.readSync(l.dataId)[0],[f,p,m,g,y]=Wmt(c,i.shape,i.dtype,u,o.dtype,h,d);return[n.makeTensorInfo(p,i.dtype,f),n.makeTensorInfo([p[0]],o.dtype,m),n.makeTensorInfo([g.length],"bool",new Uint8Array(g.map(v=>Number(v)))),n.makeTensorInfo([y.length],i.dtype,new Int32Array(y))]}const Zbt={kernelName:u_,backendName:"webgl",kernelFunc:Ybt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jbt(r){const{inputs:t,backend:n}=r,{inputIndices:i,inputShape:o,newShape:a}=t;if(i.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${i.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(a.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${a.shape}`);const l=Array.from(n.readSync(o.dataId)),c=n.readSync(i.dataId),u=Array.from(n.readSync(a.dataId)),[h,d,f]=Gmt(c,i.shape,i.dtype,l,u);return[n.makeTensorInfo(d,i.dtype,h),n.makeTensorInfo([f.length],a.dtype,new Int32Array(f))]}const Qbt={kernelName:h_,backendName:"webgl",kernelFunc:Jbt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t3t(r){const{inputs:t,backend:n}=r,{data:i,indices:o,segmentIds:a}=t;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${o.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${a.shape}`);const l=n.readSync(i.dataId),c=n.readSync(o.dataId),u=n.readSync(a.dataId),[h,d]=VL(l,i.shape,i.dtype,c,u,!0);return n.makeTensorInfo(d,i.dtype,h)}const e3t={kernelName:d_,backendName:"webgl",kernelFunc:t3t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n3t(r){const{inputs:t,backend:n}=r,{data:i,indices:o,segmentIds:a}=t;if(i.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${o.shape}`);if(a.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${a.shape}`);const l=n.readSync(i.dataId),c=n.readSync(o.dataId),u=n.readSync(a.dataId),[h,d]=VL(l,i.shape,i.dtype,c,u);return n.makeTensorInfo(d,i.dtype,h)}const s3t={kernelName:f_,backendName:"webgl",kernelFunc:n3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r3t(r){const{inputs:t,backend:n,attrs:i}=r,{sparseIndices:o,sparseValues:a,defaultValue:l}=t,{outputShape:c}=i,{sliceRank:u,numUpdates:h,sliceSize:d,strides:f,outputSize:p}=Sg(a,o,c),m=!1;if(a.dtype==="string"){const x=n.bufferSync(o),b=n.bufferSync(a),w=Sc(n.readSync(l.dataId)[0]),S=zmt(x,b,c,p,d,h,u,f,w,m);return n.makeTensorInfo(c,S.dtype,S.values)}const g=new yF(h,u,o.shape.length,a.shape.length,f,[p,1],m),y=n.runWebGLProgram(g,[a,o,l],a.dtype),v=ue({inputs:{x:y},backend:n,attrs:{shape:c}});return n.disposeIntermediateTensorInfo(y),v}const i3t={kernelName:wR,backendName:"webgl",kernelFunc:r3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o3t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{numOrSizeSplits:a,axis:l}=i,c=on(l,o.shape)[0],u=MT(o,a,c),h=o.shape.length,d=new Array(h).fill(0),f=o.shape.slice();return u.map(p=>{const m=[...f];m[c]=p;const g=kf({inputs:{x:o},backend:n,attrs:{begin:d,size:m}});return d[c]+=p,g})}const a3t={kernelName:Zv,backendName:"webgl",kernelFunc:o3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CE="return sqrt(x);",l3t=_n({opSnippet:CE,packedOpSnippet:CE,cpuKernelImpl:Hmt}),c3t={kernelName:mg,backendName:"webgl",kernelFunc:l3t};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u3t="return x * x;",h3t=_n({opSnippet:u3t}),d3t={kernelName:p_,backendName:"webgl",kernelFunc:h3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kE="return (a - b) * (a - b);",f3t=pr({opSnippet:kE,packedOpSnippet:kE}),p3t={kernelName:gg,backendName:"webgl",kernelFunc:f3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m3t({inputs:r,attrs:t,backend:n}){const{x:i}=r,o=Io+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,a=new ka(i.shape,o);return n.runWebGLProgram(a,[i],i.dtype)}const g3t={kernelName:wg,backendName:"webgl",kernelFunc:m3t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v3t{constructor(t,n,i){this.variableNames=["x"],this.outputShape=i;const o=i.length,a=Kn(i.length),l=Kn(i.length);let c="";if(o===1)c="coords * strides + begin";else{let u=0;c=i.map((h,d)=>(u++,i.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${u-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${a} begin = ${a}(${t});
      ${a} strides = ${a}(${n});

      void main() {
        ${l} coords = getOutputCoords();
        setOutput(getX(${c}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y3t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{begin:a,end:l,strides:c,beginMask:u,endMask:h,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:p}=i,{finalShapeSparse:m,finalShape:g,isIdentity:y,sliceDim0:v,isSimpleSlice:x,begin:b,end:w,strides:S}=D_(o.shape,a,l,c,u,h,d,f,p);let _;if(y)_=ue({inputs:{x:o},backend:n,attrs:{shape:g}});else if(v||x){W(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);const N=N_(b,w,S),k=kf({inputs:{x:o},backend:n,attrs:{begin:b,size:N}});_=ue({inputs:{x:k},backend:n,attrs:{shape:g}}),n.disposeIntermediateTensorInfo(k)}else if(n.shouldExecuteOnCPU([o])){const k=n.readSync(o.dataId),I=rn(o.shape,o.dtype,k),O=jmt(m,I,S,b);_=n.makeTensorInfo(g,o.dtype,O.values)}else{const k=new v3t(b,S,m);_=n.runWebGLProgram(k,[o],o.dtype)}const $=ue({inputs:{x:_},backend:n,attrs:{shape:g}});return n.disposeIntermediateTensorInfo(_),$}const x3t={kernelName:m_,backendName:"webgl",kernelFunc:y3t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b3t(r){const{inputs:t,backend:n,attrs:i}=r,{separator:o,nGramWidths:a,leftPad:l,rightPad:c,padWidth:u,preserveShortSequences:h}=i,{data:d,dataSplits:f}=t,p=n.readSync(d.dataId),m=n.readSync(f.dataId),[g,y]=qmt(p,m,o,a,l,c,u,h);return[n.makeTensorInfo([g.length],"string",g),n.makeTensorInfo(f.shape,"int32",y)]}const w3t={kernelName:g_,backendName:"webgl",kernelFunc:b3t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S3t(r){const{inputs:t,backend:n,attrs:i}=r,{skipEmpty:o}=i,{input:a,delimiter:l}=t;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(a.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${a.shape}`);if(l.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${l.shape}`);const c=n.readSync(a.dataId),u=n.readSync(l.dataId)[0],[h,d,f]=Kmt(c,u,o),p=d.length;return[n.makeTensorInfo([p,2],"int32",h),n.makeTensorInfo([p],"string",d),n.makeTensorInfo([2],"int32",new Int32Array(f))]}const _3t={kernelName:v_,backendName:"webgl",kernelFunc:S3t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T3t(r){const{inputs:t,backend:n,attrs:i}=r,{numBuckets:o}=i,{input:a}=t;if(a.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");const l=n.readSync(a.dataId),c=Xmt(l,o);return n.makeTensorInfo(a.shape,"int32",c)}const C3t={kernelName:y_,backendName:"webgl",kernelFunc:T3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k3t="return tan(x);",$3t=_n({opSnippet:k3t}),I3t={kernelName:yg,backendName:"webgl",kernelFunc:$3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E3t=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,N3t=_n({opSnippet:E3t}),A3t={kernelName:xg,backendName:"webgl",kernelFunc:N3t};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M3t{constructor(t,n){this.variableNames=["A"];const i=new Array(t.length);for(let l=0;l<i.length;l++)i[l]=t[l]*n[l];this.outputShape=i,this.rank=i.length;const o=Kn(this.rank),a=D3t(t);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${a}));
      }
    `}}function D3t(r){const t=r.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${r[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],i=[];for(let o=0;o<r.length;o++)i.push(`imod(${n[o]}, ${r[o]})`);return i.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xF(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{reps:a}=i;if(o.dtype==="string"||o.shape.length>5){const u=n.readSync(o.dataId),h=o.dtype==="string"?u.map(p=>Sc(p)):u,d=rn(o.shape,o.dtype,h),f=Zmt(d,a);return n.makeTensorInfo(f.shape,f.dtype,f.values)}const l=new M3t(o.shape,a);return n.runWebGLProgram(l,[o],o.dtype)}const R3t={kernelName:bg,backendName:"webgl",kernelFunc:xF};class O3t{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class L3t{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iu(r,t){t!==null&&r.disposeIntermediateTensorInfo(t)}function $E(r){let t=1;for(;t<r;)t*=2;return t}function F3t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o}=t,{k:a,sorted:l}=i,c=kt().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=kt().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),h=o.shape,d=h[h.length-1];if(n.shouldExecuteOnCPU([o])||d<c||a>u){const O=n.readSync(o.dataId),[B,F]=Jmt(O,h,o.dtype,a,l);return[n.makeTensorInfo(B.shape,B.dtype,B.values),n.makeTensorInfo(F.shape,F.dtype,F.values)]}if(a===0)return h[h.length-1]=0,[n.makeTensorInfo(h,o.dtype,[]),n.makeTensorInfo(h,"int32",[])];if(d===1)return[o,Gg({attrs:{shape:h,dtype:"int32",value:0},backend:n})];const f=n.texData.get(o.dataId),p=f!==null&&f.isPacked,m=p?n.unpackTensor(o):o,y=Nt(h)/d,v=ue({inputs:{x:m},attrs:{shape:[y,d]},backend:n});p&&iu(n,m);const x=$E(a),b=$E(d);let w=null;const S=()=>w===null?[v,v]:[v,w],_=(O,B,F)=>{const D=S(),L=new O3t(F),j=[[d],[w===null?1:0],[Number.NEGATIVE_INFINITY],[O],[B]],Y=w;w=n.runWebGLProgram(L,D,"int32",j),iu(n,Y)};for(let O=1;O<x;O*=2){const B=O*2;for(let F=O;F>=1;F/=2)_(B,F,[y,b])}for(let O=b;O>x;O/=2){const B=S(),F=new L3t([y,O/2]),L=[[d],[w===null?1:0],[x]],V=w;w=n.runWebGLProgram(F,B,"int32",L),iu(n,V);const j=x/2,Y=j*2;for(let H=j;H>=1;H/=2)_(Y,H,w.shape)}let $=w;w=kf({inputs:{x:w},backend:n,attrs:{begin:0,size:[y,a]}}),iu(n,$);let N=uF({inputs:{x:v,indices:w},backend:n,attrs:{axis:1,batchDims:1}});iu(n,v);const k=h.slice(0,-1);k.push(a),$=w,w=ue({inputs:{x:w},attrs:{shape:k},backend:n}),iu(n,$);const I=N;return N=ue({inputs:{x:N},attrs:{shape:k},backend:n}),iu(n,I),[N,w]}const P3t={kernelName:x_,backendName:"webgl",kernelFunc:F3t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B3t{constructor(t,n,i,o,a,l){this.variableNames=["Image","Transforms"],this.outputShape=l;const c=i==="nearest"?1:2;let u;switch(o){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${u} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${a});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${a});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${t}));

                if (${c} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z3t(r){const{inputs:t,backend:n,attrs:i}=r,{image:o,transforms:a}=t,{interpolation:l,fillMode:c,fillValue:u,outputShape:h}=i,[d,f,p,m]=o.shape,[g,y]=h??[f,p],v=[d,g,y,m],x=new B3t(f,p,l,c,u,v);return n.runWebGLProgram(x,[o,a],"float32")}const V3t={kernelName:b_,backendName:"webgl",kernelFunc:z3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U3t(r){const{inputs:t,attrs:n,backend:i}=r,{axis:o}=n,{x:a}=t;Bg(a,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const l=i.readSync(a.dataId),{outputValues:c,outputShape:u,indices:h}=Qmt(l,o,a.shape,a.dtype);return[i.makeTensorInfo(u,a.dtype,c),i.makeTensorInfo([h.length],"int32",h)]}const W3t={kernelName:w_,backendName:"webgl",kernelFunc:U3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G3t(r){const{inputs:t,backend:n,attrs:i}=r,{value:o}=t;let{axis:a}=i;a<0&&(a+=o.shape.length);const l=o,c=l.shape.length,u=o.shape[a],h=new Array(c-1);let d=0;for(let y=0;y<c;y++)y!==a&&(h[d++]=l.shape[y]);const f=[],p=new Array(c).fill(0),m=l.shape.slice();m[a]=1;const g=new Array(u);for(let y=0;y<g.length;y++){p[a]=y;const v=kf({inputs:{x:l},backend:n,attrs:{begin:p,size:m}}),x=ue({inputs:{x:v},backend:n,attrs:{shape:h}});g[y]=x,f.push(v)}return f.forEach(y=>n.disposeIntermediateTensorInfo(y)),g}const H3t={kernelName:Qv,backendName:"webgl",kernelFunc:G3t};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j3t{constructor(t,n){this.variableNames=["x","segmentIds"];const i=t.windowSize,o=t.batchSize,a=t.inSize,l=t.numSegments,c=l*Math.ceil(a/i);this.outputShape=[o,c];const u="0.0",h="sumValue",d=Math.floor(i/4)*4,f=i%4,p=`
        sumValue += dot(values, segFilter);
    `;let m="";a%i>0&&(m=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `);let g="";a%i>0&&(g=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${u};

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${g}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${l})) * float(${i}));
        int currentSeg = int(mod(float(outIdx), float(${l})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${h});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q3t(r){const{inputs:t,backend:n,attrs:i}=r,{x:o,segmentIds:a}=t,{numSegments:l}=i,c=o.shape.length,u=[];let h=0;const d=ms([h],c);let f=o;d!=null&&(f=zr({inputs:{x:o},backend:n,attrs:{perm:d}}),u.push(f),h=_s(1,c)[0]);const p=a8(f.shape,h,l),m=Nt([f.shape[h]]),g=ue({inputs:{x:f},backend:n,attrs:{shape:[-1,m]}});u.push(g);const y=T_(o.dtype),v=(S,_,$,N,k)=>{const I=S.shape[0],O=S.shape[1],B=o8(O,k),F={windowSize:B,inSize:O,batchSize:I,numSegments:k},D=new j3t(F,_),L=n.compileAndRun(D,[S,$],N);if(u.push(L),L.shape[1]===k)return L;const V=vF({backend:n,attrs:{start:0,stop:k,step:1,dtype:"float32"}}),j=xF({inputs:{x:V},backend:n,attrs:{reps:[O/B]}});return u.push(V),u.push(j),v(L,_,j,N,k)},x=v(g,"unsortedSegmentSum",a,y,l),b=ue({inputs:{x},backend:n,attrs:{shape:p}});let w=b;if(d!=null){u.push(b);const S=Bc(d);w=zr({inputs:{x:w},backend:n,attrs:{perm:S}})}return u.forEach(S=>n.disposeIntermediateTensorInfo(S)),w}const K3t={kernelName:ty,backendName:"webgl",kernelFunc:q3t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X3t=[Ggt,jgt,Xgt,Jgt,t0t,s0t,i0t,a0t,h0t,f0t,g0t,x0t,S0t,k0t,E0t,A0t,D0t,F0t,B0t,V0t,H0t,J0t,t1t,n1t,l1t,u1t,p1t,$gt,v1t,S1t,k1t,M1t,R1t,L1t,P1t,z1t,W1t,j1t,X1t,Z1t,Q1t,e2t,r2t,o2t,u2t,d2t,m2t,y2t,b2t,T2t,I2t,M2t,O2t,P2t,B2t,V2t,W2t,H2t,q2t,X2t,Q2t,nvt,ivt,avt,uvt,fvt,vvt,wvt,kgt,_vt,b1t,kvt,Evt,Mvt,Egt,Lvt,zvt,Uvt,jvt,Xvt,Qvt,nyt,oyt,uyt,fyt,myt,xyt,wyt,_yt,$yt,Eyt,Ayt,Dyt,Oyt,Byt,Wyt,qyt,ext,Mgt,ixt,lxt,hxt,pxt,r1t,vxt,xxt,wxt,Txt,Ixt,Agt,Nxt,Mxt,Rxt,Lxt,Fxt,i1t,Zyt,zxt,Gxt,Kxt,Rgt,Jxt,ebt,ibt,lbt,dbt,pbt,vbt,bbt,Sbt,Cbt,Ibt,Abt,Obt,Pbt,Vbt,Gbt,Y0t,Qyt,qbt,Xbt,Zbt,Qbt,e3t,s3t,i3t,a3t,c3t,d3t,p3t,g3t,x3t,w3t,_3t,C3t,Jyt,Vgt,I3t,A3t,R3t,P3t,V3t,Ugt,W3t,H3t,K3t,yxt];for(const r of X3t)_R(r);/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const xC="148",Y3t=0,IE=1,Z3t=2,bF=1,J3t=2,Tp=3,Ec=0,go=1,Ly=2,j0=3,pc=0,Cd=1,EE=2,NE=3,AE=4,Q3t=5,ld=100,twt=101,ewt=102,ME=103,DE=104,nwt=200,swt=201,rwt=202,iwt=203,wF=204,SF=205,owt=206,awt=207,lwt=208,cwt=209,uwt=210,hwt=0,dwt=1,fwt=2,Cw=3,pwt=4,mwt=5,gwt=6,vwt=7,_F=0,ywt=1,xwt=2,ml=0,bwt=1,wwt=2,Swt=3,_wt=4,Twt=5,TF=300,qd=301,Kd=302,kw=303,$w=304,Fy=306,Xd=1e3,io=1001,I2=1002,rr=1003,Iw=1004,k1=1005,Mr=1006,CF=1007,nh=1008,sh=1009,Cwt=1010,kwt=1011,kF=1012,$wt=1013,Su=1014,ic=1015,om=1016,Iwt=1017,Ewt=1018,kd=1020,Nwt=1021,Awt=1022,oo=1023,Mwt=1024,Dwt=1025,Ou=1026,Yd=1027,Rwt=1028,Owt=1029,Lwt=1030,Fwt=1031,Pwt=1033,Zx=33776,Jx=33777,Qx=33778,tb=33779,RE=35840,OE=35841,LE=35842,FE=35843,Bwt=36196,PE=37492,BE=37496,zE=37808,VE=37809,UE=37810,WE=37811,GE=37812,HE=37813,jE=37814,qE=37815,KE=37816,XE=37817,YE=37818,ZE=37819,JE=37820,QE=37821,tN=36492,am=2300,Zd=2301,eb=2302,eN=2400,nN=2401,sN=2402,zwt=2500,Vwt=1,$F=2,rh=3e3,Dn=3001,Uwt=3200,Wwt=3201,IF=0,Gwt=1,va="srgb",lm="srgb-linear",nb=7680,Hwt=519,Ew=35044,rN="300 es",Nw=1035;class $f{addEventListener(t,n){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(n)===-1&&i[t].push(n)}hasEventListener(t,n){if(this._listeners===void 0)return!1;const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(n)!==-1}removeEventListener(t,n){if(this._listeners===void 0)return;const o=this._listeners[t];if(o!==void 0){const a=o.indexOf(n);a!==-1&&o.splice(a,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const i=this._listeners[t.type];if(i!==void 0){t.target=this;const o=i.slice(0);for(let a=0,l=o.length;a<l;a++)o[a].call(this,t);t.target=null}}}const Er=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let iN=1234567;const Rp=Math.PI/180,cm=180/Math.PI;function Yo(){const r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Er[r&255]+Er[r>>8&255]+Er[r>>16&255]+Er[r>>24&255]+"-"+Er[t&255]+Er[t>>8&255]+"-"+Er[t>>16&15|64]+Er[t>>24&255]+"-"+Er[n&63|128]+Er[n>>8&255]+"-"+Er[n>>16&255]+Er[n>>24&255]+Er[i&255]+Er[i>>8&255]+Er[i>>16&255]+Er[i>>24&255]).toLowerCase()}function Yr(r,t,n){return Math.max(t,Math.min(n,r))}function bC(r,t){return(r%t+t)%t}function jwt(r,t,n,i,o){return i+(r-t)*(o-i)/(n-t)}function qwt(r,t,n){return r!==t?(n-r)/(t-r):0}function Op(r,t,n){return(1-n)*r+n*t}function Kwt(r,t,n,i){return Op(r,t,1-Math.exp(-n*i))}function Xwt(r,t=1){return t-Math.abs(bC(r,t*2)-t)}function Ywt(r,t,n){return r<=t?0:r>=n?1:(r=(r-t)/(n-t),r*r*(3-2*r))}function Zwt(r,t,n){return r<=t?0:r>=n?1:(r=(r-t)/(n-t),r*r*r*(r*(r*6-15)+10))}function Jwt(r,t){return r+Math.floor(Math.random()*(t-r+1))}function Qwt(r,t){return r+Math.random()*(t-r)}function tSt(r){return r*(.5-Math.random())}function eSt(r){r!==void 0&&(iN=r);let t=iN+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function nSt(r){return r*Rp}function sSt(r){return r*cm}function Aw(r){return(r&r-1)===0&&r!==0}function EF(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function E2(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function rSt(r,t,n,i,o){const a=Math.cos,l=Math.sin,c=a(n/2),u=l(n/2),h=a((t+i)/2),d=l((t+i)/2),f=a((t-i)/2),p=l((t-i)/2),m=a((i-t)/2),g=l((i-t)/2);switch(o){case"XYX":r.set(c*d,u*f,u*p,c*h);break;case"YZY":r.set(u*p,c*d,u*f,c*h);break;case"ZXZ":r.set(u*f,u*p,c*d,c*h);break;case"XZX":r.set(c*d,u*g,u*m,c*h);break;case"YXY":r.set(u*m,c*d,u*g,c*h);break;case"ZYZ":r.set(u*g,u*m,c*d,c*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}}function ul(r,t){switch(t.constructor){case Float32Array:return r;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function Un(r,t){switch(t.constructor){case Float32Array:return r;case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}var iSt=Object.freeze({__proto__:null,DEG2RAD:Rp,RAD2DEG:cm,generateUUID:Yo,clamp:Yr,euclideanModulo:bC,mapLinear:jwt,inverseLerp:qwt,lerp:Op,damp:Kwt,pingpong:Xwt,smoothstep:Ywt,smootherstep:Zwt,randInt:Jwt,randFloat:Qwt,randFloatSpread:tSt,seededRandom:eSt,degToRad:nSt,radToDeg:sSt,isPowerOfTwo:Aw,ceilPowerOfTwo:EF,floorPowerOfTwo:E2,setQuaternionFromProperEuler:rSt,normalize:Un,denormalize:ul});class $n{constructor(t=0,n=0){$n.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,i=this.y,o=t.elements;return this.x=o[0]*n+o[3]*i+o[6],this.y=o[1]*n+o[4]*i+o[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}clampLength(t,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,i=this.y-t.y;return n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,i){return this.x=t.x+(n.x-t.x)*i,this.y=t.y+(n.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const i=Math.cos(n),o=Math.sin(n),a=this.x-t.x,l=this.y-t.y;return this.x=a*i-l*o+t.x,this.y=a*o+l*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Oi{constructor(){Oi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,n,i,o,a,l,c,u,h){const d=this.elements;return d[0]=t,d[1]=o,d[2]=c,d[3]=n,d[4]=a,d[5]=u,d[6]=i,d[7]=l,d[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,i=t.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],this}extractBasis(t,n,i){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const i=t.elements,o=n.elements,a=this.elements,l=i[0],c=i[3],u=i[6],h=i[1],d=i[4],f=i[7],p=i[2],m=i[5],g=i[8],y=o[0],v=o[3],x=o[6],b=o[1],w=o[4],S=o[7],_=o[2],$=o[5],N=o[8];return a[0]=l*y+c*b+u*_,a[3]=l*v+c*w+u*$,a[6]=l*x+c*S+u*N,a[1]=h*y+d*b+f*_,a[4]=h*v+d*w+f*$,a[7]=h*x+d*S+f*N,a[2]=p*y+m*b+g*_,a[5]=p*v+m*w+g*$,a[8]=p*x+m*S+g*N,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],i=t[1],o=t[2],a=t[3],l=t[4],c=t[5],u=t[6],h=t[7],d=t[8];return n*l*d-n*c*h-i*a*d+i*c*u+o*a*h-o*l*u}invert(){const t=this.elements,n=t[0],i=t[1],o=t[2],a=t[3],l=t[4],c=t[5],u=t[6],h=t[7],d=t[8],f=d*l-c*h,p=c*u-d*a,m=h*a-l*u,g=n*f+i*p+o*m;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/g;return t[0]=f*y,t[1]=(o*h-d*i)*y,t[2]=(c*i-o*l)*y,t[3]=p*y,t[4]=(d*n-o*u)*y,t[5]=(o*a-c*n)*y,t[6]=m*y,t[7]=(i*u-h*n)*y,t[8]=(l*n-i*a)*y,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,i,o,a,l,c){const u=Math.cos(a),h=Math.sin(a);return this.set(i*u,i*h,-i*(u*l+h*c)+l+t,-o*h,o*u,-o*(-h*l+u*c)+c+n,0,0,1),this}scale(t,n){return this.premultiply(sb.makeScale(t,n)),this}rotate(t){return this.premultiply(sb.makeRotation(-t)),this}translate(t,n){return this.premultiply(sb.makeTranslation(t,n)),this}makeTranslation(t,n){return this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),i=Math.sin(t);return this.set(n,-i,0,i,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,i=t.elements;for(let o=0;o<9;o++)if(n[o]!==i[o])return!1;return!0}fromArray(t,n=0){for(let i=0;i<9;i++)this.elements[i]=t[i+n];return this}toArray(t=[],n=0){const i=this.elements;return t[n]=i[0],t[n+1]=i[1],t[n+2]=i[2],t[n+3]=i[3],t[n+4]=i[4],t[n+5]=i[5],t[n+6]=i[6],t[n+7]=i[7],t[n+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const sb=new Oi;function NF(r){for(let t=r.length-1;t>=0;--t)if(r[t]>=65535)return!0;return!1}function um(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function Lu(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function $1(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}const rb={[va]:{[lm]:Lu},[lm]:{[va]:$1}},Hr={legacyMode:!0,get workingColorSpace(){return lm},set workingColorSpace(r){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(r,t,n){if(this.legacyMode||t===n||!t||!n)return r;if(rb[t]&&rb[t][n]!==void 0){const i=rb[t][n];return r.r=i(r.r),r.g=i(r.g),r.b=i(r.b),r}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(r,t){return this.convert(r,this.workingColorSpace,t)},toWorkingColorSpace:function(r,t){return this.convert(r,t,this.workingColorSpace)}},AF={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},zs={r:0,g:0,b:0},Do={h:0,s:0,l:0},q0={h:0,s:0,l:0};function ib(r,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?r+(t-r)*6*n:n<1/2?t:n<2/3?r+(t-r)*6*(2/3-n):r}function K0(r,t){return t.r=r.r,t.g=r.g,t.b=r.b,t}class sn{constructor(t,n,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,n===void 0&&i===void 0?this.set(t):this.setRGB(t,n,i)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=va){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Hr.toWorkingColorSpace(this,n),this}setRGB(t,n,i,o=Hr.workingColorSpace){return this.r=t,this.g=n,this.b=i,Hr.toWorkingColorSpace(this,o),this}setHSL(t,n,i,o=Hr.workingColorSpace){if(t=bC(t,1),n=Yr(n,0,1),i=Yr(i,0,1),n===0)this.r=this.g=this.b=i;else{const a=i<=.5?i*(1+n):i+n-i*n,l=2*i-a;this.r=ib(l,a,t+1/3),this.g=ib(l,a,t),this.b=ib(l,a,t-1/3)}return Hr.toWorkingColorSpace(this,o),this}setStyle(t,n=va){function i(a){a!==void 0&&parseFloat(a)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let o;if(o=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let a;const l=o[1],c=o[2];switch(l){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,Hr.toWorkingColorSpace(this,n),i(a[4]),this;if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return this.r=Math.min(100,parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,Hr.toWorkingColorSpace(this,n),i(a[4]),this;break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c)){const u=parseFloat(a[1])/360,h=parseFloat(a[2])/100,d=parseFloat(a[3])/100;return i(a[4]),this.setHSL(u,h,d,n)}break}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(t)){const a=o[1],l=a.length;if(l===3)return this.r=parseInt(a.charAt(0)+a.charAt(0),16)/255,this.g=parseInt(a.charAt(1)+a.charAt(1),16)/255,this.b=parseInt(a.charAt(2)+a.charAt(2),16)/255,Hr.toWorkingColorSpace(this,n),this;if(l===6)return this.r=parseInt(a.charAt(0)+a.charAt(1),16)/255,this.g=parseInt(a.charAt(2)+a.charAt(3),16)/255,this.b=parseInt(a.charAt(4)+a.charAt(5),16)/255,Hr.toWorkingColorSpace(this,n),this}return t&&t.length>0?this.setColorName(t,n):this}setColorName(t,n=va){const i=AF[t.toLowerCase()];return i!==void 0?this.setHex(i,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Lu(t.r),this.g=Lu(t.g),this.b=Lu(t.b),this}copyLinearToSRGB(t){return this.r=$1(t.r),this.g=$1(t.g),this.b=$1(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=va){return Hr.fromWorkingColorSpace(K0(this,zs),t),Yr(zs.r*255,0,255)<<16^Yr(zs.g*255,0,255)<<8^Yr(zs.b*255,0,255)<<0}getHexString(t=va){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=Hr.workingColorSpace){Hr.fromWorkingColorSpace(K0(this,zs),n);const i=zs.r,o=zs.g,a=zs.b,l=Math.max(i,o,a),c=Math.min(i,o,a);let u,h;const d=(c+l)/2;if(c===l)u=0,h=0;else{const f=l-c;switch(h=d<=.5?f/(l+c):f/(2-l-c),l){case i:u=(o-a)/f+(o<a?6:0);break;case o:u=(a-i)/f+2;break;case a:u=(i-o)/f+4;break}u/=6}return t.h=u,t.s=h,t.l=d,t}getRGB(t,n=Hr.workingColorSpace){return Hr.fromWorkingColorSpace(K0(this,zs),n),t.r=zs.r,t.g=zs.g,t.b=zs.b,t}getStyle(t=va){return Hr.fromWorkingColorSpace(K0(this,zs),t),t!==va?`color(${t} ${zs.r} ${zs.g} ${zs.b})`:`rgb(${zs.r*255|0},${zs.g*255|0},${zs.b*255|0})`}offsetHSL(t,n,i){return this.getHSL(Do),Do.h+=t,Do.s+=n,Do.l+=i,this.setHSL(Do.h,Do.s,Do.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,i){return this.r=t.r+(n.r-t.r)*i,this.g=t.g+(n.g-t.g)*i,this.b=t.b+(n.b-t.b)*i,this}lerpHSL(t,n){this.getHSL(Do),t.getHSL(q0);const i=Op(Do.h,q0.h,n),o=Op(Do.s,q0.s,n),a=Op(Do.l,q0.l,n);return this.setHSL(i,o,a),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}sn.NAMES=AF;let Wh;class MF{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let n;if(t instanceof HTMLCanvasElement)n=t;else{Wh===void 0&&(Wh=um("canvas")),Wh.width=t.width,Wh.height=t.height;const i=Wh.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),n=Wh}return n.width>2048||n.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const n=um("canvas");n.width=t.width,n.height=t.height;const i=n.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const o=i.getImageData(0,0,t.width,t.height),a=o.data;for(let l=0;l<a.length;l++)a[l]=Lu(a[l]/255)*255;return i.putImageData(o,0,0),n}else if(t.data){const n=t.data.slice(0);for(let i=0;i<n.length;i++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[i]=Math.floor(Lu(n[i]/255)*255):n[i]=Lu(n[i]);return{data:n,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class DF{constructor(t=null){this.isSource=!0,this.uuid=Yo(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const n=t===void 0||typeof t=="string";if(!n&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},o=this.data;if(o!==null){let a;if(Array.isArray(o)){a=[];for(let l=0,c=o.length;l<c;l++)o[l].isDataTexture?a.push(ob(o[l].image)):a.push(ob(o[l]))}else a=ob(o);i.url=a}return n||(t.images[this.uuid]=i),i}}function ob(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?MF.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let oSt=0;class lr extends $f{constructor(t=lr.DEFAULT_IMAGE,n=lr.DEFAULT_MAPPING,i=io,o=io,a=Mr,l=nh,c=oo,u=sh,h=lr.DEFAULT_ANISOTROPY,d=rh){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:oSt++}),this.uuid=Yo(),this.name="",this.source=new DF(t),this.mipmaps=[],this.mapping=n,this.wrapS=i,this.wrapT=o,this.magFilter=a,this.minFilter=l,this.anisotropy=h,this.format=c,this.internalFormat=null,this.type=u,this.offset=new $n(0,0),this.repeat=new $n(1,1),this.center=new $n(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Oi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=d,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const n=t===void 0||typeof t=="string";if(!n&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),n||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==TF)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Xd:t.x=t.x-Math.floor(t.x);break;case io:t.x=t.x<0?0:1;break;case I2:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Xd:t.y=t.y-Math.floor(t.y);break;case io:t.y=t.y<0?0:1;break;case I2:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}}lr.DEFAULT_IMAGE=null;lr.DEFAULT_MAPPING=TF;lr.DEFAULT_ANISOTROPY=1;class Gn{constructor(t=0,n=0,i=0,o=1){Gn.prototype.isVector4=!0,this.x=t,this.y=n,this.z=i,this.w=o}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,n,i,o){return this.x=t,this.y=n,this.z=i,this.w=o,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this.w=t.w+n.w,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this.z+=t.z*n,this.w+=t.w*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this.z=t.z-n.z,this.w=t.w-n.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const n=this.x,i=this.y,o=this.z,a=this.w,l=t.elements;return this.x=l[0]*n+l[4]*i+l[8]*o+l[12]*a,this.y=l[1]*n+l[5]*i+l[9]*o+l[13]*a,this.z=l[2]*n+l[6]*i+l[10]*o+l[14]*a,this.w=l[3]*n+l[7]*i+l[11]*o+l[15]*a,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const n=Math.sqrt(1-t.w*t.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/n,this.y=t.y/n,this.z=t.z/n),this}setAxisAngleFromRotationMatrix(t){let n,i,o,a;const u=t.elements,h=u[0],d=u[4],f=u[8],p=u[1],m=u[5],g=u[9],y=u[2],v=u[6],x=u[10];if(Math.abs(d-p)<.01&&Math.abs(f-y)<.01&&Math.abs(g-v)<.01){if(Math.abs(d+p)<.1&&Math.abs(f+y)<.1&&Math.abs(g+v)<.1&&Math.abs(h+m+x-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const w=(h+1)/2,S=(m+1)/2,_=(x+1)/2,$=(d+p)/4,N=(f+y)/4,k=(g+v)/4;return w>S&&w>_?w<.01?(i=0,o=.707106781,a=.707106781):(i=Math.sqrt(w),o=$/i,a=N/i):S>_?S<.01?(i=.707106781,o=0,a=.707106781):(o=Math.sqrt(S),i=$/o,a=k/o):_<.01?(i=.707106781,o=.707106781,a=0):(a=Math.sqrt(_),i=N/a,o=k/a),this.set(i,o,a,n),this}let b=Math.sqrt((v-g)*(v-g)+(f-y)*(f-y)+(p-d)*(p-d));return Math.abs(b)<.001&&(b=1),this.x=(v-g)/b,this.y=(f-y)/b,this.z=(p-d)/b,this.w=Math.acos((h+m+x-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this.z=Math.max(t.z,Math.min(n.z,this.z)),this.w=Math.max(t.w,Math.min(n.w,this.w)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this.z=Math.max(t,Math.min(n,this.z)),this.w=Math.max(t,Math.min(n,this.w)),this}clampLength(t,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this.z+=(t.z-this.z)*n,this.w+=(t.w-this.w)*n,this}lerpVectors(t,n,i){return this.x=t.x+(n.x-t.x)*i,this.y=t.y+(n.y-t.y)*i,this.z=t.z+(n.z-t.z)*i,this.w=t.w+(n.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this.z=t[n+2],this.w=t[n+3],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t[n+2]=this.z,t[n+3]=this.w,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this.z=t.getZ(n),this.w=t.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ih extends $f{constructor(t=1,n=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=n,this.depth=1,this.scissor=new Gn(0,0,t,n),this.scissorTest=!1,this.viewport=new Gn(0,0,t,n);const o={width:t,height:n,depth:1};this.texture=new lr(o,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Mr,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(t,n,i=1){(this.width!==t||this.height!==n||this.depth!==i)&&(this.width=t,this.height=n,this.depth=i,this.texture.image.width=t,this.texture.image.height=n,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,n),this.scissor.set(0,0,t,n)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const n=Object.assign({},t.texture.image);return this.texture.source=new DF(n),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class RF extends lr{constructor(t=null,n=1,i=1,o=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:n,height:i,depth:o},this.magFilter=rr,this.minFilter=rr,this.wrapR=io,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class aSt extends lr{constructor(t=null,n=1,i=1,o=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:n,height:i,depth:o},this.magFilter=rr,this.minFilter=rr,this.wrapR=io,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class qc{constructor(t=0,n=0,i=0,o=1){this.isQuaternion=!0,this._x=t,this._y=n,this._z=i,this._w=o}static slerpFlat(t,n,i,o,a,l,c){let u=i[o+0],h=i[o+1],d=i[o+2],f=i[o+3];const p=a[l+0],m=a[l+1],g=a[l+2],y=a[l+3];if(c===0){t[n+0]=u,t[n+1]=h,t[n+2]=d,t[n+3]=f;return}if(c===1){t[n+0]=p,t[n+1]=m,t[n+2]=g,t[n+3]=y;return}if(f!==y||u!==p||h!==m||d!==g){let v=1-c;const x=u*p+h*m+d*g+f*y,b=x>=0?1:-1,w=1-x*x;if(w>Number.EPSILON){const _=Math.sqrt(w),$=Math.atan2(_,x*b);v=Math.sin(v*$)/_,c=Math.sin(c*$)/_}const S=c*b;if(u=u*v+p*S,h=h*v+m*S,d=d*v+g*S,f=f*v+y*S,v===1-c){const _=1/Math.sqrt(u*u+h*h+d*d+f*f);u*=_,h*=_,d*=_,f*=_}}t[n]=u,t[n+1]=h,t[n+2]=d,t[n+3]=f}static multiplyQuaternionsFlat(t,n,i,o,a,l){const c=i[o],u=i[o+1],h=i[o+2],d=i[o+3],f=a[l],p=a[l+1],m=a[l+2],g=a[l+3];return t[n]=c*g+d*f+u*m-h*p,t[n+1]=u*g+d*p+h*f-c*m,t[n+2]=h*g+d*m+c*p-u*f,t[n+3]=d*g-c*f-u*p-h*m,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,n,i,o){return this._x=t,this._y=n,this._z=i,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,n){const i=t._x,o=t._y,a=t._z,l=t._order,c=Math.cos,u=Math.sin,h=c(i/2),d=c(o/2),f=c(a/2),p=u(i/2),m=u(o/2),g=u(a/2);switch(l){case"XYZ":this._x=p*d*f+h*m*g,this._y=h*m*f-p*d*g,this._z=h*d*g+p*m*f,this._w=h*d*f-p*m*g;break;case"YXZ":this._x=p*d*f+h*m*g,this._y=h*m*f-p*d*g,this._z=h*d*g-p*m*f,this._w=h*d*f+p*m*g;break;case"ZXY":this._x=p*d*f-h*m*g,this._y=h*m*f+p*d*g,this._z=h*d*g+p*m*f,this._w=h*d*f-p*m*g;break;case"ZYX":this._x=p*d*f-h*m*g,this._y=h*m*f+p*d*g,this._z=h*d*g-p*m*f,this._w=h*d*f+p*m*g;break;case"YZX":this._x=p*d*f+h*m*g,this._y=h*m*f+p*d*g,this._z=h*d*g-p*m*f,this._w=h*d*f-p*m*g;break;case"XZY":this._x=p*d*f-h*m*g,this._y=h*m*f-p*d*g,this._z=h*d*g+p*m*f,this._w=h*d*f+p*m*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+l)}return n!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,n){const i=n/2,o=Math.sin(i);return this._x=t.x*o,this._y=t.y*o,this._z=t.z*o,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const n=t.elements,i=n[0],o=n[4],a=n[8],l=n[1],c=n[5],u=n[9],h=n[2],d=n[6],f=n[10],p=i+c+f;if(p>0){const m=.5/Math.sqrt(p+1);this._w=.25/m,this._x=(d-u)*m,this._y=(a-h)*m,this._z=(l-o)*m}else if(i>c&&i>f){const m=2*Math.sqrt(1+i-c-f);this._w=(d-u)/m,this._x=.25*m,this._y=(o+l)/m,this._z=(a+h)/m}else if(c>f){const m=2*Math.sqrt(1+c-i-f);this._w=(a-h)/m,this._x=(o+l)/m,this._y=.25*m,this._z=(u+d)/m}else{const m=2*Math.sqrt(1+f-i-c);this._w=(l-o)/m,this._x=(a+h)/m,this._y=(u+d)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(t,n){let i=t.dot(n)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*n.z-t.z*n.y,this._y=t.z*n.x-t.x*n.z,this._z=t.x*n.y-t.y*n.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Yr(this.dot(t),-1,1)))}rotateTowards(t,n){const i=this.angleTo(t);if(i===0)return this;const o=Math.min(1,n/i);return this.slerp(t,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,n){const i=t._x,o=t._y,a=t._z,l=t._w,c=n._x,u=n._y,h=n._z,d=n._w;return this._x=i*d+l*c+o*h-a*u,this._y=o*d+l*u+a*c-i*h,this._z=a*d+l*h+i*u-o*c,this._w=l*d-i*c-o*u-a*h,this._onChangeCallback(),this}slerp(t,n){if(n===0)return this;if(n===1)return this.copy(t);const i=this._x,o=this._y,a=this._z,l=this._w;let c=l*t._w+i*t._x+o*t._y+a*t._z;if(c<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,c=-c):this.copy(t),c>=1)return this._w=l,this._x=i,this._y=o,this._z=a,this;const u=1-c*c;if(u<=Number.EPSILON){const m=1-n;return this._w=m*l+n*this._w,this._x=m*i+n*this._x,this._y=m*o+n*this._y,this._z=m*a+n*this._z,this.normalize(),this._onChangeCallback(),this}const h=Math.sqrt(u),d=Math.atan2(h,c),f=Math.sin((1-n)*d)/h,p=Math.sin(n*d)/h;return this._w=l*f+this._w*p,this._x=i*f+this._x*p,this._y=o*f+this._y*p,this._z=a*f+this._z*p,this._onChangeCallback(),this}slerpQuaternions(t,n,i){return this.copy(t).slerp(n,i)}random(){const t=Math.random(),n=Math.sqrt(1-t),i=Math.sqrt(t),o=2*Math.PI*Math.random(),a=2*Math.PI*Math.random();return this.set(n*Math.cos(o),i*Math.sin(a),i*Math.cos(a),n*Math.sin(o))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,n=0){return this._x=t[n],this._y=t[n+1],this._z=t[n+2],this._w=t[n+3],this._onChangeCallback(),this}toArray(t=[],n=0){return t[n]=this._x,t[n+1]=this._y,t[n+2]=this._z,t[n+3]=this._w,t}fromBufferAttribute(t,n){return this._x=t.getX(n),this._y=t.getY(n),this._z=t.getZ(n),this._w=t.getW(n),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class yt{constructor(t=0,n=0,i=0){yt.prototype.isVector3=!0,this.x=t,this.y=n,this.z=i}set(t,n,i){return i===void 0&&(i=this.z),this.x=t,this.y=n,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this.z+=t.z*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this.z=t.z-n.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,n){return this.x=t.x*n.x,this.y=t.y*n.y,this.z=t.z*n.z,this}applyEuler(t){return this.applyQuaternion(oN.setFromEuler(t))}applyAxisAngle(t,n){return this.applyQuaternion(oN.setFromAxisAngle(t,n))}applyMatrix3(t){const n=this.x,i=this.y,o=this.z,a=t.elements;return this.x=a[0]*n+a[3]*i+a[6]*o,this.y=a[1]*n+a[4]*i+a[7]*o,this.z=a[2]*n+a[5]*i+a[8]*o,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const n=this.x,i=this.y,o=this.z,a=t.elements,l=1/(a[3]*n+a[7]*i+a[11]*o+a[15]);return this.x=(a[0]*n+a[4]*i+a[8]*o+a[12])*l,this.y=(a[1]*n+a[5]*i+a[9]*o+a[13])*l,this.z=(a[2]*n+a[6]*i+a[10]*o+a[14])*l,this}applyQuaternion(t){const n=this.x,i=this.y,o=this.z,a=t.x,l=t.y,c=t.z,u=t.w,h=u*n+l*o-c*i,d=u*i+c*n-a*o,f=u*o+a*i-l*n,p=-a*n-l*i-c*o;return this.x=h*u+p*-a+d*-c-f*-l,this.y=d*u+p*-l+f*-a-h*-c,this.z=f*u+p*-c+h*-l-d*-a,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const n=this.x,i=this.y,o=this.z,a=t.elements;return this.x=a[0]*n+a[4]*i+a[8]*o,this.y=a[1]*n+a[5]*i+a[9]*o,this.z=a[2]*n+a[6]*i+a[10]*o,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this.z=Math.max(t.z,Math.min(n.z,this.z)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this.z=Math.max(t,Math.min(n,this.z)),this}clampLength(t,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(n,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this.z+=(t.z-this.z)*n,this}lerpVectors(t,n,i){return this.x=t.x+(n.x-t.x)*i,this.y=t.y+(n.y-t.y)*i,this.z=t.z+(n.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,n){const i=t.x,o=t.y,a=t.z,l=n.x,c=n.y,u=n.z;return this.x=o*u-a*c,this.y=a*l-i*u,this.z=i*c-o*l,this}projectOnVector(t){const n=t.lengthSq();if(n===0)return this.set(0,0,0);const i=t.dot(this)/n;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return ab.copy(this).projectOnVector(t),this.sub(ab)}reflect(t){return this.sub(ab.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const i=this.dot(t)/n;return Math.acos(Yr(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,i=this.y-t.y,o=this.z-t.z;return n*n+i*i+o*o}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,n,i){const o=Math.sin(n)*t;return this.x=o*Math.sin(i),this.y=Math.cos(n)*t,this.z=o*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,n,i){return this.x=t*Math.sin(n),this.y=i,this.z=t*Math.cos(n),this}setFromMatrixPosition(t){const n=t.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(t){const n=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),o=this.setFromMatrixColumn(t,2).length();return this.x=n,this.y=i,this.z=o,this}setFromMatrixColumn(t,n){return this.fromArray(t.elements,n*4)}setFromMatrix3Column(t,n){return this.fromArray(t.elements,n*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this.z=t[n+2],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t[n+2]=this.z,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this.z=t.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,n=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(n),this.y=i*Math.sin(n),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const ab=new yt,oN=new qc;class $h{constructor(t=new yt(1/0,1/0,1/0),n=new yt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=n}set(t,n){return this.min.copy(t),this.max.copy(n),this}setFromArray(t){let n=1/0,i=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0;for(let u=0,h=t.length;u<h;u+=3){const d=t[u],f=t[u+1],p=t[u+2];d<n&&(n=d),f<i&&(i=f),p<o&&(o=p),d>a&&(a=d),f>l&&(l=f),p>c&&(c=p)}return this.min.set(n,i,o),this.max.set(a,l,c),this}setFromBufferAttribute(t){let n=1/0,i=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0;for(let u=0,h=t.count;u<h;u++){const d=t.getX(u),f=t.getY(u),p=t.getZ(u);d<n&&(n=d),f<i&&(i=f),p<o&&(o=p),d>a&&(a=d),f>l&&(l=f),p>c&&(c=p)}return this.min.set(n,i,o),this.max.set(a,l,c),this}setFromPoints(t){this.makeEmpty();for(let n=0,i=t.length;n<i;n++)this.expandByPoint(t[n]);return this}setFromCenterAndSize(t,n){const i=ou.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,n=!1){return this.makeEmpty(),this.expandByObject(t,n)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,n=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(i!==void 0)if(n&&i.attributes!=null&&i.attributes.position!==void 0){const a=i.attributes.position;for(let l=0,c=a.count;l<c;l++)ou.fromBufferAttribute(a,l).applyMatrix4(t.matrixWorld),this.expandByPoint(ou)}else i.boundingBox===null&&i.computeBoundingBox(),lb.copy(i.boundingBox),lb.applyMatrix4(t.matrixWorld),this.union(lb);const o=t.children;for(let a=0,l=o.length;a<l;a++)this.expandByObject(o[a],n);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,n){return n.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,ou),ou.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let n,i;return t.normal.x>0?(n=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(n=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(n+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(n+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(n+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(n+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),n<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(sp),X0.subVectors(this.max,sp),Gh.subVectors(t.a,sp),Hh.subVectors(t.b,sp),jh.subVectors(t.c,sp),Wl.subVectors(Hh,Gh),Gl.subVectors(jh,Hh),au.subVectors(Gh,jh);let n=[0,-Wl.z,Wl.y,0,-Gl.z,Gl.y,0,-au.z,au.y,Wl.z,0,-Wl.x,Gl.z,0,-Gl.x,au.z,0,-au.x,-Wl.y,Wl.x,0,-Gl.y,Gl.x,0,-au.y,au.x,0];return!cb(n,Gh,Hh,jh,X0)||(n=[1,0,0,0,1,0,0,0,1],!cb(n,Gh,Hh,jh,X0))?!1:(Y0.crossVectors(Wl,Gl),n=[Y0.x,Y0.y,Y0.z],cb(n,Gh,Hh,jh,X0))}clampPoint(t,n){return n.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return ou.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(ou).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Xa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Xa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Xa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Xa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Xa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Xa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Xa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Xa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Xa),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Xa=[new yt,new yt,new yt,new yt,new yt,new yt,new yt,new yt],ou=new yt,lb=new $h,Gh=new yt,Hh=new yt,jh=new yt,Wl=new yt,Gl=new yt,au=new yt,sp=new yt,X0=new yt,Y0=new yt,lu=new yt;function cb(r,t,n,i,o){for(let a=0,l=r.length-3;a<=l;a+=3){lu.fromArray(r,a);const c=o.x*Math.abs(lu.x)+o.y*Math.abs(lu.y)+o.z*Math.abs(lu.z),u=t.dot(lu),h=n.dot(lu),d=i.dot(lu);if(Math.max(-Math.max(u,h,d),Math.min(u,h,d))>c)return!1}return!0}const lSt=new $h,rp=new yt,ub=new yt;class If{constructor(t=new yt,n=-1){this.center=t,this.radius=n}set(t,n){return this.center.copy(t),this.radius=n,this}setFromPoints(t,n){const i=this.center;n!==void 0?i.copy(n):lSt.setFromPoints(t).getCenter(i);let o=0;for(let a=0,l=t.length;a<l;a++)o=Math.max(o,i.distanceToSquared(t[a]));return this.radius=Math.sqrt(o),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const n=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=n*n}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,n){const i=this.center.distanceToSquared(t);return n.copy(t),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;rp.subVectors(t,this.center);const n=rp.lengthSq();if(n>this.radius*this.radius){const i=Math.sqrt(n),o=(i-this.radius)*.5;this.center.addScaledVector(rp,o/i),this.radius+=o}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(ub.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(rp.copy(t.center).add(ub)),this.expandByPoint(rp.copy(t.center).sub(ub))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Ya=new yt,hb=new yt,Z0=new yt,Hl=new yt,db=new yt,J0=new yt,fb=new yt;class wC{constructor(t=new yt,n=new yt(0,0,-1)){this.origin=t,this.direction=n}set(t,n){return this.origin.copy(t),this.direction.copy(n),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,n){return n.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Ya)),this}closestPointToPoint(t,n){n.subVectors(t,this.origin);const i=n.dot(this.direction);return i<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const n=Ya.subVectors(t,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(t):(Ya.copy(this.direction).multiplyScalar(n).add(this.origin),Ya.distanceToSquared(t))}distanceSqToSegment(t,n,i,o){hb.copy(t).add(n).multiplyScalar(.5),Z0.copy(n).sub(t).normalize(),Hl.copy(this.origin).sub(hb);const a=t.distanceTo(n)*.5,l=-this.direction.dot(Z0),c=Hl.dot(this.direction),u=-Hl.dot(Z0),h=Hl.lengthSq(),d=Math.abs(1-l*l);let f,p,m,g;if(d>0)if(f=l*u-c,p=l*c-u,g=a*d,f>=0)if(p>=-g)if(p<=g){const y=1/d;f*=y,p*=y,m=f*(f+l*p+2*c)+p*(l*f+p+2*u)+h}else p=a,f=Math.max(0,-(l*p+c)),m=-f*f+p*(p+2*u)+h;else p=-a,f=Math.max(0,-(l*p+c)),m=-f*f+p*(p+2*u)+h;else p<=-g?(f=Math.max(0,-(-l*a+c)),p=f>0?-a:Math.min(Math.max(-a,-u),a),m=-f*f+p*(p+2*u)+h):p<=g?(f=0,p=Math.min(Math.max(-a,-u),a),m=p*(p+2*u)+h):(f=Math.max(0,-(l*a+c)),p=f>0?a:Math.min(Math.max(-a,-u),a),m=-f*f+p*(p+2*u)+h);else p=l>0?-a:a,f=Math.max(0,-(l*p+c)),m=-f*f+p*(p+2*u)+h;return i&&i.copy(this.direction).multiplyScalar(f).add(this.origin),o&&o.copy(Z0).multiplyScalar(p).add(hb),m}intersectSphere(t,n){Ya.subVectors(t.center,this.origin);const i=Ya.dot(this.direction),o=Ya.dot(Ya)-i*i,a=t.radius*t.radius;if(o>a)return null;const l=Math.sqrt(a-o),c=i-l,u=i+l;return c<0&&u<0?null:c<0?this.at(u,n):this.at(c,n)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const n=t.normal.dot(this.direction);if(n===0)return t.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/n;return i>=0?i:null}intersectPlane(t,n){const i=this.distanceToPlane(t);return i===null?null:this.at(i,n)}intersectsPlane(t){const n=t.distanceToPoint(this.origin);return n===0||t.normal.dot(this.direction)*n<0}intersectBox(t,n){let i,o,a,l,c,u;const h=1/this.direction.x,d=1/this.direction.y,f=1/this.direction.z,p=this.origin;return h>=0?(i=(t.min.x-p.x)*h,o=(t.max.x-p.x)*h):(i=(t.max.x-p.x)*h,o=(t.min.x-p.x)*h),d>=0?(a=(t.min.y-p.y)*d,l=(t.max.y-p.y)*d):(a=(t.max.y-p.y)*d,l=(t.min.y-p.y)*d),i>l||a>o||((a>i||isNaN(i))&&(i=a),(l<o||isNaN(o))&&(o=l),f>=0?(c=(t.min.z-p.z)*f,u=(t.max.z-p.z)*f):(c=(t.max.z-p.z)*f,u=(t.min.z-p.z)*f),i>u||c>o)||((c>i||i!==i)&&(i=c),(u<o||o!==o)&&(o=u),o<0)?null:this.at(i>=0?i:o,n)}intersectsBox(t){return this.intersectBox(t,Ya)!==null}intersectTriangle(t,n,i,o,a){db.subVectors(n,t),J0.subVectors(i,t),fb.crossVectors(db,J0);let l=this.direction.dot(fb),c;if(l>0){if(o)return null;c=1}else if(l<0)c=-1,l=-l;else return null;Hl.subVectors(this.origin,t);const u=c*this.direction.dot(J0.crossVectors(Hl,J0));if(u<0)return null;const h=c*this.direction.dot(db.cross(Hl));if(h<0||u+h>l)return null;const d=-c*Hl.dot(fb);return d<0?null:this.at(d/l,a)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class pn{constructor(){pn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,n,i,o,a,l,c,u,h,d,f,p,m,g,y,v){const x=this.elements;return x[0]=t,x[4]=n,x[8]=i,x[12]=o,x[1]=a,x[5]=l,x[9]=c,x[13]=u,x[2]=h,x[6]=d,x[10]=f,x[14]=p,x[3]=m,x[7]=g,x[11]=y,x[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new pn().fromArray(this.elements)}copy(t){const n=this.elements,i=t.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],this}copyPosition(t){const n=this.elements,i=t.elements;return n[12]=i[12],n[13]=i[13],n[14]=i[14],this}setFromMatrix3(t){const n=t.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(t,n,i){return t.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,n,i){return this.set(t.x,n.x,i.x,0,t.y,n.y,i.y,0,t.z,n.z,i.z,0,0,0,0,1),this}extractRotation(t){const n=this.elements,i=t.elements,o=1/qh.setFromMatrixColumn(t,0).length(),a=1/qh.setFromMatrixColumn(t,1).length(),l=1/qh.setFromMatrixColumn(t,2).length();return n[0]=i[0]*o,n[1]=i[1]*o,n[2]=i[2]*o,n[3]=0,n[4]=i[4]*a,n[5]=i[5]*a,n[6]=i[6]*a,n[7]=0,n[8]=i[8]*l,n[9]=i[9]*l,n[10]=i[10]*l,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(t){const n=this.elements,i=t.x,o=t.y,a=t.z,l=Math.cos(i),c=Math.sin(i),u=Math.cos(o),h=Math.sin(o),d=Math.cos(a),f=Math.sin(a);if(t.order==="XYZ"){const p=l*d,m=l*f,g=c*d,y=c*f;n[0]=u*d,n[4]=-u*f,n[8]=h,n[1]=m+g*h,n[5]=p-y*h,n[9]=-c*u,n[2]=y-p*h,n[6]=g+m*h,n[10]=l*u}else if(t.order==="YXZ"){const p=u*d,m=u*f,g=h*d,y=h*f;n[0]=p+y*c,n[4]=g*c-m,n[8]=l*h,n[1]=l*f,n[5]=l*d,n[9]=-c,n[2]=m*c-g,n[6]=y+p*c,n[10]=l*u}else if(t.order==="ZXY"){const p=u*d,m=u*f,g=h*d,y=h*f;n[0]=p-y*c,n[4]=-l*f,n[8]=g+m*c,n[1]=m+g*c,n[5]=l*d,n[9]=y-p*c,n[2]=-l*h,n[6]=c,n[10]=l*u}else if(t.order==="ZYX"){const p=l*d,m=l*f,g=c*d,y=c*f;n[0]=u*d,n[4]=g*h-m,n[8]=p*h+y,n[1]=u*f,n[5]=y*h+p,n[9]=m*h-g,n[2]=-h,n[6]=c*u,n[10]=l*u}else if(t.order==="YZX"){const p=l*u,m=l*h,g=c*u,y=c*h;n[0]=u*d,n[4]=y-p*f,n[8]=g*f+m,n[1]=f,n[5]=l*d,n[9]=-c*d,n[2]=-h*d,n[6]=m*f+g,n[10]=p-y*f}else if(t.order==="XZY"){const p=l*u,m=l*h,g=c*u,y=c*h;n[0]=u*d,n[4]=-f,n[8]=h*d,n[1]=p*f+y,n[5]=l*d,n[9]=m*f-g,n[2]=g*f-m,n[6]=c*d,n[10]=y*f+p}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(t){return this.compose(cSt,t,uSt)}lookAt(t,n,i){const o=this.elements;return $i.subVectors(t,n),$i.lengthSq()===0&&($i.z=1),$i.normalize(),jl.crossVectors(i,$i),jl.lengthSq()===0&&(Math.abs(i.z)===1?$i.x+=1e-4:$i.z+=1e-4,$i.normalize(),jl.crossVectors(i,$i)),jl.normalize(),Q0.crossVectors($i,jl),o[0]=jl.x,o[4]=Q0.x,o[8]=$i.x,o[1]=jl.y,o[5]=Q0.y,o[9]=$i.y,o[2]=jl.z,o[6]=Q0.z,o[10]=$i.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const i=t.elements,o=n.elements,a=this.elements,l=i[0],c=i[4],u=i[8],h=i[12],d=i[1],f=i[5],p=i[9],m=i[13],g=i[2],y=i[6],v=i[10],x=i[14],b=i[3],w=i[7],S=i[11],_=i[15],$=o[0],N=o[4],k=o[8],I=o[12],O=o[1],B=o[5],F=o[9],D=o[13],L=o[2],V=o[6],j=o[10],Y=o[14],H=o[3],et=o[7],it=o[11],J=o[15];return a[0]=l*$+c*O+u*L+h*H,a[4]=l*N+c*B+u*V+h*et,a[8]=l*k+c*F+u*j+h*it,a[12]=l*I+c*D+u*Y+h*J,a[1]=d*$+f*O+p*L+m*H,a[5]=d*N+f*B+p*V+m*et,a[9]=d*k+f*F+p*j+m*it,a[13]=d*I+f*D+p*Y+m*J,a[2]=g*$+y*O+v*L+x*H,a[6]=g*N+y*B+v*V+x*et,a[10]=g*k+y*F+v*j+x*it,a[14]=g*I+y*D+v*Y+x*J,a[3]=b*$+w*O+S*L+_*H,a[7]=b*N+w*B+S*V+_*et,a[11]=b*k+w*F+S*j+_*it,a[15]=b*I+w*D+S*Y+_*J,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[4]*=t,n[8]*=t,n[12]*=t,n[1]*=t,n[5]*=t,n[9]*=t,n[13]*=t,n[2]*=t,n[6]*=t,n[10]*=t,n[14]*=t,n[3]*=t,n[7]*=t,n[11]*=t,n[15]*=t,this}determinant(){const t=this.elements,n=t[0],i=t[4],o=t[8],a=t[12],l=t[1],c=t[5],u=t[9],h=t[13],d=t[2],f=t[6],p=t[10],m=t[14],g=t[3],y=t[7],v=t[11],x=t[15];return g*(+a*u*f-o*h*f-a*c*p+i*h*p+o*c*m-i*u*m)+y*(+n*u*m-n*h*p+a*l*p-o*l*m+o*h*d-a*u*d)+v*(+n*h*f-n*c*m-a*l*f+i*l*m+a*c*d-i*h*d)+x*(-o*c*d-n*u*f+n*c*p+o*l*f-i*l*p+i*u*d)}transpose(){const t=this.elements;let n;return n=t[1],t[1]=t[4],t[4]=n,n=t[2],t[2]=t[8],t[8]=n,n=t[6],t[6]=t[9],t[9]=n,n=t[3],t[3]=t[12],t[12]=n,n=t[7],t[7]=t[13],t[13]=n,n=t[11],t[11]=t[14],t[14]=n,this}setPosition(t,n,i){const o=this.elements;return t.isVector3?(o[12]=t.x,o[13]=t.y,o[14]=t.z):(o[12]=t,o[13]=n,o[14]=i),this}invert(){const t=this.elements,n=t[0],i=t[1],o=t[2],a=t[3],l=t[4],c=t[5],u=t[6],h=t[7],d=t[8],f=t[9],p=t[10],m=t[11],g=t[12],y=t[13],v=t[14],x=t[15],b=f*v*h-y*p*h+y*u*m-c*v*m-f*u*x+c*p*x,w=g*p*h-d*v*h-g*u*m+l*v*m+d*u*x-l*p*x,S=d*y*h-g*f*h+g*c*m-l*y*m-d*c*x+l*f*x,_=g*f*u-d*y*u-g*c*p+l*y*p+d*c*v-l*f*v,$=n*b+i*w+o*S+a*_;if($===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const N=1/$;return t[0]=b*N,t[1]=(y*p*a-f*v*a-y*o*m+i*v*m+f*o*x-i*p*x)*N,t[2]=(c*v*a-y*u*a+y*o*h-i*v*h-c*o*x+i*u*x)*N,t[3]=(f*u*a-c*p*a-f*o*h+i*p*h+c*o*m-i*u*m)*N,t[4]=w*N,t[5]=(d*v*a-g*p*a+g*o*m-n*v*m-d*o*x+n*p*x)*N,t[6]=(g*u*a-l*v*a-g*o*h+n*v*h+l*o*x-n*u*x)*N,t[7]=(l*p*a-d*u*a+d*o*h-n*p*h-l*o*m+n*u*m)*N,t[8]=S*N,t[9]=(g*f*a-d*y*a-g*i*m+n*y*m+d*i*x-n*f*x)*N,t[10]=(l*y*a-g*c*a+g*i*h-n*y*h-l*i*x+n*c*x)*N,t[11]=(d*c*a-l*f*a-d*i*h+n*f*h+l*i*m-n*c*m)*N,t[12]=_*N,t[13]=(d*y*o-g*f*o+g*i*p-n*y*p-d*i*v+n*f*v)*N,t[14]=(g*c*o-l*y*o-g*i*u+n*y*u+l*i*v-n*c*v)*N,t[15]=(l*f*o-d*c*o+d*i*u-n*f*u-l*i*p+n*c*p)*N,this}scale(t){const n=this.elements,i=t.x,o=t.y,a=t.z;return n[0]*=i,n[4]*=o,n[8]*=a,n[1]*=i,n[5]*=o,n[9]*=a,n[2]*=i,n[6]*=o,n[10]*=a,n[3]*=i,n[7]*=o,n[11]*=a,this}getMaxScaleOnAxis(){const t=this.elements,n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],o=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(n,i,o))}makeTranslation(t,n,i){return this.set(1,0,0,t,0,1,0,n,0,0,1,i,0,0,0,1),this}makeRotationX(t){const n=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,n,-i,0,0,i,n,0,0,0,0,1),this}makeRotationY(t){const n=Math.cos(t),i=Math.sin(t);return this.set(n,0,i,0,0,1,0,0,-i,0,n,0,0,0,0,1),this}makeRotationZ(t){const n=Math.cos(t),i=Math.sin(t);return this.set(n,-i,0,0,i,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,n){const i=Math.cos(n),o=Math.sin(n),a=1-i,l=t.x,c=t.y,u=t.z,h=a*l,d=a*c;return this.set(h*l+i,h*c-o*u,h*u+o*c,0,h*c+o*u,d*c+i,d*u-o*l,0,h*u-o*c,d*u+o*l,a*u*u+i,0,0,0,0,1),this}makeScale(t,n,i){return this.set(t,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,n,i,o,a,l){return this.set(1,i,a,0,t,1,l,0,n,o,1,0,0,0,0,1),this}compose(t,n,i){const o=this.elements,a=n._x,l=n._y,c=n._z,u=n._w,h=a+a,d=l+l,f=c+c,p=a*h,m=a*d,g=a*f,y=l*d,v=l*f,x=c*f,b=u*h,w=u*d,S=u*f,_=i.x,$=i.y,N=i.z;return o[0]=(1-(y+x))*_,o[1]=(m+S)*_,o[2]=(g-w)*_,o[3]=0,o[4]=(m-S)*$,o[5]=(1-(p+x))*$,o[6]=(v+b)*$,o[7]=0,o[8]=(g+w)*N,o[9]=(v-b)*N,o[10]=(1-(p+y))*N,o[11]=0,o[12]=t.x,o[13]=t.y,o[14]=t.z,o[15]=1,this}decompose(t,n,i){const o=this.elements;let a=qh.set(o[0],o[1],o[2]).length();const l=qh.set(o[4],o[5],o[6]).length(),c=qh.set(o[8],o[9],o[10]).length();this.determinant()<0&&(a=-a),t.x=o[12],t.y=o[13],t.z=o[14],Ro.copy(this);const h=1/a,d=1/l,f=1/c;return Ro.elements[0]*=h,Ro.elements[1]*=h,Ro.elements[2]*=h,Ro.elements[4]*=d,Ro.elements[5]*=d,Ro.elements[6]*=d,Ro.elements[8]*=f,Ro.elements[9]*=f,Ro.elements[10]*=f,n.setFromRotationMatrix(Ro),i.x=a,i.y=l,i.z=c,this}makePerspective(t,n,i,o,a,l){const c=this.elements,u=2*a/(n-t),h=2*a/(i-o),d=(n+t)/(n-t),f=(i+o)/(i-o),p=-(l+a)/(l-a),m=-2*l*a/(l-a);return c[0]=u,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=h,c[9]=f,c[13]=0,c[2]=0,c[6]=0,c[10]=p,c[14]=m,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(t,n,i,o,a,l){const c=this.elements,u=1/(n-t),h=1/(i-o),d=1/(l-a),f=(n+t)*u,p=(i+o)*h,m=(l+a)*d;return c[0]=2*u,c[4]=0,c[8]=0,c[12]=-f,c[1]=0,c[5]=2*h,c[9]=0,c[13]=-p,c[2]=0,c[6]=0,c[10]=-2*d,c[14]=-m,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(t){const n=this.elements,i=t.elements;for(let o=0;o<16;o++)if(n[o]!==i[o])return!1;return!0}fromArray(t,n=0){for(let i=0;i<16;i++)this.elements[i]=t[i+n];return this}toArray(t=[],n=0){const i=this.elements;return t[n]=i[0],t[n+1]=i[1],t[n+2]=i[2],t[n+3]=i[3],t[n+4]=i[4],t[n+5]=i[5],t[n+6]=i[6],t[n+7]=i[7],t[n+8]=i[8],t[n+9]=i[9],t[n+10]=i[10],t[n+11]=i[11],t[n+12]=i[12],t[n+13]=i[13],t[n+14]=i[14],t[n+15]=i[15],t}}const qh=new yt,Ro=new pn,cSt=new yt(0,0,0),uSt=new yt(1,1,1),jl=new yt,Q0=new yt,$i=new yt,aN=new pn,lN=new qc;class Hg{constructor(t=0,n=0,i=0,o=Hg.DefaultOrder){this.isEuler=!0,this._x=t,this._y=n,this._z=i,this._order=o}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,n,i,o=this._order){return this._x=t,this._y=n,this._z=i,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,n=this._order,i=!0){const o=t.elements,a=o[0],l=o[4],c=o[8],u=o[1],h=o[5],d=o[9],f=o[2],p=o[6],m=o[10];switch(n){case"XYZ":this._y=Math.asin(Yr(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-d,m),this._z=Math.atan2(-l,a)):(this._x=Math.atan2(p,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Yr(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(c,m),this._z=Math.atan2(u,h)):(this._y=Math.atan2(-f,a),this._z=0);break;case"ZXY":this._x=Math.asin(Yr(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-l,h)):(this._y=0,this._z=Math.atan2(u,a));break;case"ZYX":this._y=Math.asin(-Yr(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(p,m),this._z=Math.atan2(u,a)):(this._x=0,this._z=Math.atan2(-l,h));break;case"YZX":this._z=Math.asin(Yr(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-d,h),this._y=Math.atan2(-f,a)):(this._x=0,this._y=Math.atan2(c,m));break;case"XZY":this._z=Math.asin(-Yr(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(p,h),this._y=Math.atan2(c,a)):(this._x=Math.atan2(-d,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,n,i){return aN.makeRotationFromQuaternion(t),this.setFromRotationMatrix(aN,n,i)}setFromVector3(t,n=this._order){return this.set(t.x,t.y,t.z,n)}reorder(t){return lN.setFromEuler(this),this.setFromQuaternion(lN,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],n=0){return t[n]=this._x,t[n+1]=this._y,t[n+2]=this._z,t[n+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Hg.DefaultOrder="XYZ";Hg.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class OF{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let hSt=0;const cN=new yt,Kh=new qc,Za=new pn,t1=new yt,ip=new yt,dSt=new yt,fSt=new qc,uN=new yt(1,0,0),hN=new yt(0,1,0),dN=new yt(0,0,1),pSt={type:"added"},fN={type:"removed"};class as extends $f{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:hSt++}),this.uuid=Yo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=as.DefaultUp.clone();const t=new yt,n=new Hg,i=new qc,o=new yt(1,1,1);function a(){i.setFromEuler(n,!1)}function l(){n.setFromQuaternion(i,void 0,!1)}n._onChange(a),i._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new pn},normalMatrix:{value:new Oi}}),this.matrix=new pn,this.matrixWorld=new pn,this.matrixAutoUpdate=as.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=as.DefaultMatrixWorldAutoUpdate,this.layers=new OF,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,n){this.quaternion.setFromAxisAngle(t,n)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,n){return Kh.setFromAxisAngle(t,n),this.quaternion.multiply(Kh),this}rotateOnWorldAxis(t,n){return Kh.setFromAxisAngle(t,n),this.quaternion.premultiply(Kh),this}rotateX(t){return this.rotateOnAxis(uN,t)}rotateY(t){return this.rotateOnAxis(hN,t)}rotateZ(t){return this.rotateOnAxis(dN,t)}translateOnAxis(t,n){return cN.copy(t).applyQuaternion(this.quaternion),this.position.add(cN.multiplyScalar(n)),this}translateX(t){return this.translateOnAxis(uN,t)}translateY(t){return this.translateOnAxis(hN,t)}translateZ(t){return this.translateOnAxis(dN,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Za.copy(this.matrixWorld).invert())}lookAt(t,n,i){t.isVector3?t1.copy(t):t1.set(t,n,i);const o=this.parent;this.updateWorldMatrix(!0,!1),ip.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Za.lookAt(ip,t1,this.up):Za.lookAt(t1,ip,this.up),this.quaternion.setFromRotationMatrix(Za),o&&(Za.extractRotation(o.matrixWorld),Kh.setFromRotationMatrix(Za),this.quaternion.premultiply(Kh.invert()))}add(t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(pSt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const n=this.children.indexOf(t);return n!==-1&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(fN)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const n=this.children[t];n.parent=null,n.dispatchEvent(fN)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Za.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Za.multiply(t.parent.matrixWorld)),t.applyMatrix4(Za),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,n){if(this[t]===n)return this;for(let i=0,o=this.children.length;i<o;i++){const l=this.children[i].getObjectByProperty(t,n);if(l!==void 0)return l}}getObjectsByProperty(t,n){let i=[];this[t]===n&&i.push(this);for(let o=0,a=this.children.length;o<a;o++){const l=this.children[o].getObjectsByProperty(t,n);l.length>0&&(i=i.concat(l))}return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ip,t,dSt),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ip,fSt,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return t.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(t){t(this);const n=this.children;for(let i=0,o=n.length;i<o;i++)n[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const n=this.children;for(let i=0,o=n.length;i<o;i++)n[i].traverseVisible(t)}traverseAncestors(t){const n=this.parent;n!==null&&(t(n),n.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const n=this.children;for(let i=0,o=n.length;i<o;i++){const a=n[i];(a.matrixWorldAutoUpdate===!0||t===!0)&&a.updateMatrixWorld(t)}}updateWorldMatrix(t,n){const i=this.parent;if(t===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),n===!0){const o=this.children;for(let a=0,l=o.length;a<l;a++){const c=o[a];c.matrixWorldAutoUpdate===!0&&c.updateWorldMatrix(!1,!0)}}}toJSON(t){const n=t===void 0||typeof t=="string",i={};n&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const o={};o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.castShadow===!0&&(o.castShadow=!0),this.receiveShadow===!0&&(o.receiveShadow=!0),this.visible===!1&&(o.visible=!1),this.frustumCulled===!1&&(o.frustumCulled=!1),this.renderOrder!==0&&(o.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(o.instanceColor=this.instanceColor.toJSON()));function a(c,u){return c[u.uuid]===void 0&&(c[u.uuid]=u.toJSON(t)),u.uuid}if(this.isScene)this.background&&(this.background.isColor?o.background=this.background.toJSON():this.background.isTexture&&(o.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(o.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){o.geometry=a(t.geometries,this.geometry);const c=this.geometry.parameters;if(c!==void 0&&c.shapes!==void 0){const u=c.shapes;if(Array.isArray(u))for(let h=0,d=u.length;h<d;h++){const f=u[h];a(t.shapes,f)}else a(t.shapes,u)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(t.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const c=[];for(let u=0,h=this.material.length;u<h;u++)c.push(a(t.materials,this.material[u]));o.material=c}else o.material=a(t.materials,this.material);if(this.children.length>0){o.children=[];for(let c=0;c<this.children.length;c++)o.children.push(this.children[c].toJSON(t).object)}if(this.animations.length>0){o.animations=[];for(let c=0;c<this.animations.length;c++){const u=this.animations[c];o.animations.push(a(t.animations,u))}}if(n){const c=l(t.geometries),u=l(t.materials),h=l(t.textures),d=l(t.images),f=l(t.shapes),p=l(t.skeletons),m=l(t.animations),g=l(t.nodes);c.length>0&&(i.geometries=c),u.length>0&&(i.materials=u),h.length>0&&(i.textures=h),d.length>0&&(i.images=d),f.length>0&&(i.shapes=f),p.length>0&&(i.skeletons=p),m.length>0&&(i.animations=m),g.length>0&&(i.nodes=g)}return i.object=o,i;function l(c){const u=[];for(const h in c){const d=c[h];delete d.metadata,u.push(d)}return u}}clone(t){return new this.constructor().copy(this,t)}copy(t,n=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),n===!0)for(let i=0;i<t.children.length;i++){const o=t.children[i];this.add(o.clone())}return this}}as.DefaultUp=new yt(0,1,0);as.DefaultMatrixAutoUpdate=!0;as.DefaultMatrixWorldAutoUpdate=!0;const Oo=new yt,Ja=new yt,pb=new yt,Qa=new yt,Xh=new yt,Yh=new yt,pN=new yt,mb=new yt,gb=new yt,vb=new yt;class ol{constructor(t=new yt,n=new yt,i=new yt){this.a=t,this.b=n,this.c=i}static getNormal(t,n,i,o){o.subVectors(i,n),Oo.subVectors(t,n),o.cross(Oo);const a=o.lengthSq();return a>0?o.multiplyScalar(1/Math.sqrt(a)):o.set(0,0,0)}static getBarycoord(t,n,i,o,a){Oo.subVectors(o,n),Ja.subVectors(i,n),pb.subVectors(t,n);const l=Oo.dot(Oo),c=Oo.dot(Ja),u=Oo.dot(pb),h=Ja.dot(Ja),d=Ja.dot(pb),f=l*h-c*c;if(f===0)return a.set(-2,-1,-1);const p=1/f,m=(h*u-c*d)*p,g=(l*d-c*u)*p;return a.set(1-m-g,g,m)}static containsPoint(t,n,i,o){return this.getBarycoord(t,n,i,o,Qa),Qa.x>=0&&Qa.y>=0&&Qa.x+Qa.y<=1}static getUV(t,n,i,o,a,l,c,u){return this.getBarycoord(t,n,i,o,Qa),u.set(0,0),u.addScaledVector(a,Qa.x),u.addScaledVector(l,Qa.y),u.addScaledVector(c,Qa.z),u}static isFrontFacing(t,n,i,o){return Oo.subVectors(i,n),Ja.subVectors(t,n),Oo.cross(Ja).dot(o)<0}set(t,n,i){return this.a.copy(t),this.b.copy(n),this.c.copy(i),this}setFromPointsAndIndices(t,n,i,o){return this.a.copy(t[n]),this.b.copy(t[i]),this.c.copy(t[o]),this}setFromAttributeAndIndices(t,n,i,o){return this.a.fromBufferAttribute(t,n),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,o),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Oo.subVectors(this.c,this.b),Ja.subVectors(this.a,this.b),Oo.cross(Ja).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ol.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,n){return ol.getBarycoord(t,this.a,this.b,this.c,n)}getUV(t,n,i,o,a){return ol.getUV(t,this.a,this.b,this.c,n,i,o,a)}containsPoint(t){return ol.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ol.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,n){const i=this.a,o=this.b,a=this.c;let l,c;Xh.subVectors(o,i),Yh.subVectors(a,i),mb.subVectors(t,i);const u=Xh.dot(mb),h=Yh.dot(mb);if(u<=0&&h<=0)return n.copy(i);gb.subVectors(t,o);const d=Xh.dot(gb),f=Yh.dot(gb);if(d>=0&&f<=d)return n.copy(o);const p=u*f-d*h;if(p<=0&&u>=0&&d<=0)return l=u/(u-d),n.copy(i).addScaledVector(Xh,l);vb.subVectors(t,a);const m=Xh.dot(vb),g=Yh.dot(vb);if(g>=0&&m<=g)return n.copy(a);const y=m*h-u*g;if(y<=0&&h>=0&&g<=0)return c=h/(h-g),n.copy(i).addScaledVector(Yh,c);const v=d*g-m*f;if(v<=0&&f-d>=0&&m-g>=0)return pN.subVectors(a,o),c=(f-d)/(f-d+(m-g)),n.copy(o).addScaledVector(pN,c);const x=1/(v+y+p);return l=y*x,c=p*x,n.copy(i).addScaledVector(Xh,l).addScaledVector(Yh,c)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let mSt=0;class Oa extends $f{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:mSt++}),this.uuid=Yo(),this.name="",this.type="Material",this.blending=Cd,this.side=Ec,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=wF,this.blendDst=SF,this.blendEquation=ld,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Cw,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Hwt,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=nb,this.stencilZFail=nb,this.stencilZPass=nb,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const n in t){const i=t[n];if(i===void 0){console.warn("THREE.Material: '"+n+"' parameter is undefined.");continue}const o=this[n];if(o===void 0){console.warn("THREE."+this.type+": '"+n+"' is not a property of this material.");continue}o&&o.isColor?o.set(i):o&&o.isVector3&&i&&i.isVector3?o.copy(i):this[n]=i}}toJSON(t){const n=t===void 0||typeof t=="string";n&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Cd&&(i.blending=this.blending),this.side!==Ec&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}if(n){const a=o(t.textures),l=o(t.images);a.length>0&&(i.textures=a),l.length>0&&(i.images=l)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const n=t.clippingPlanes;let i=null;if(n!==null){const o=n.length;i=new Array(o);for(let a=0;a!==o;++a)i[a]=n[a].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class hl extends Oa{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new sn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=_F,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const As=new yt,e1=new $n;class ti{constructor(t,n,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=n,this.count=t!==void 0?t.length/n:0,this.normalized=i,this.usage=Ew,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,n,i){t*=this.itemSize,i*=n.itemSize;for(let o=0,a=this.itemSize;o<a;o++)this.array[t+o]=n.array[i+o];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let n=0,i=this.count;n<i;n++)e1.fromBufferAttribute(this,n),e1.applyMatrix3(t),this.setXY(n,e1.x,e1.y);else if(this.itemSize===3)for(let n=0,i=this.count;n<i;n++)As.fromBufferAttribute(this,n),As.applyMatrix3(t),this.setXYZ(n,As.x,As.y,As.z);return this}applyMatrix4(t){for(let n=0,i=this.count;n<i;n++)As.fromBufferAttribute(this,n),As.applyMatrix4(t),this.setXYZ(n,As.x,As.y,As.z);return this}applyNormalMatrix(t){for(let n=0,i=this.count;n<i;n++)As.fromBufferAttribute(this,n),As.applyNormalMatrix(t),this.setXYZ(n,As.x,As.y,As.z);return this}transformDirection(t){for(let n=0,i=this.count;n<i;n++)As.fromBufferAttribute(this,n),As.transformDirection(t),this.setXYZ(n,As.x,As.y,As.z);return this}set(t,n=0){return this.array.set(t,n),this}getX(t){let n=this.array[t*this.itemSize];return this.normalized&&(n=ul(n,this.array)),n}setX(t,n){return this.normalized&&(n=Un(n,this.array)),this.array[t*this.itemSize]=n,this}getY(t){let n=this.array[t*this.itemSize+1];return this.normalized&&(n=ul(n,this.array)),n}setY(t,n){return this.normalized&&(n=Un(n,this.array)),this.array[t*this.itemSize+1]=n,this}getZ(t){let n=this.array[t*this.itemSize+2];return this.normalized&&(n=ul(n,this.array)),n}setZ(t,n){return this.normalized&&(n=Un(n,this.array)),this.array[t*this.itemSize+2]=n,this}getW(t){let n=this.array[t*this.itemSize+3];return this.normalized&&(n=ul(n,this.array)),n}setW(t,n){return this.normalized&&(n=Un(n,this.array)),this.array[t*this.itemSize+3]=n,this}setXY(t,n,i){return t*=this.itemSize,this.normalized&&(n=Un(n,this.array),i=Un(i,this.array)),this.array[t+0]=n,this.array[t+1]=i,this}setXYZ(t,n,i,o){return t*=this.itemSize,this.normalized&&(n=Un(n,this.array),i=Un(i,this.array),o=Un(o,this.array)),this.array[t+0]=n,this.array[t+1]=i,this.array[t+2]=o,this}setXYZW(t,n,i,o,a){return t*=this.itemSize,this.normalized&&(n=Un(n,this.array),i=Un(i,this.array),o=Un(o,this.array),a=Un(a,this.array)),this.array[t+0]=n,this.array[t+1]=i,this.array[t+2]=o,this.array[t+3]=a,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Ew&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class LF extends ti{constructor(t,n,i){super(new Uint16Array(t),n,i)}}class FF extends ti{constructor(t,n,i){super(new Uint32Array(t),n,i)}}class Zo extends ti{constructor(t,n,i){super(new Float32Array(t),n,i)}}let gSt=0;const Yi=new pn,yb=new as,Zh=new yt,Ii=new $h,op=new $h,nr=new yt;class ua extends $f{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:gSt++}),this.uuid=Yo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(NF(t)?FF:LF)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,n){return this.attributes[t]=n,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,n,i=0){this.groups.push({start:t,count:n,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,n){this.drawRange.start=t,this.drawRange.count=n}applyMatrix4(t){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(t),n.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const a=new Oi().getNormalMatrix(t);i.applyNormalMatrix(a),i.needsUpdate=!0}const o=this.attributes.tangent;return o!==void 0&&(o.transformDirection(t),o.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return Yi.makeRotationFromQuaternion(t),this.applyMatrix4(Yi),this}rotateX(t){return Yi.makeRotationX(t),this.applyMatrix4(Yi),this}rotateY(t){return Yi.makeRotationY(t),this.applyMatrix4(Yi),this}rotateZ(t){return Yi.makeRotationZ(t),this.applyMatrix4(Yi),this}translate(t,n,i){return Yi.makeTranslation(t,n,i),this.applyMatrix4(Yi),this}scale(t,n,i){return Yi.makeScale(t,n,i),this.applyMatrix4(Yi),this}lookAt(t){return yb.lookAt(t),yb.updateMatrix(),this.applyMatrix4(yb.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Zh).negate(),this.translate(Zh.x,Zh.y,Zh.z),this}setFromPoints(t){const n=[];for(let i=0,o=t.length;i<o;i++){const a=t[i];n.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new Zo(n,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new $h);const t=this.attributes.position,n=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new yt(-1/0,-1/0,-1/0),new yt(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),n)for(let i=0,o=n.length;i<o;i++){const a=n[i];Ii.setFromBufferAttribute(a),this.morphTargetsRelative?(nr.addVectors(this.boundingBox.min,Ii.min),this.boundingBox.expandByPoint(nr),nr.addVectors(this.boundingBox.max,Ii.max),this.boundingBox.expandByPoint(nr)):(this.boundingBox.expandByPoint(Ii.min),this.boundingBox.expandByPoint(Ii.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new If);const t=this.attributes.position,n=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new yt,1/0);return}if(t){const i=this.boundingSphere.center;if(Ii.setFromBufferAttribute(t),n)for(let a=0,l=n.length;a<l;a++){const c=n[a];op.setFromBufferAttribute(c),this.morphTargetsRelative?(nr.addVectors(Ii.min,op.min),Ii.expandByPoint(nr),nr.addVectors(Ii.max,op.max),Ii.expandByPoint(nr)):(Ii.expandByPoint(op.min),Ii.expandByPoint(op.max))}Ii.getCenter(i);let o=0;for(let a=0,l=t.count;a<l;a++)nr.fromBufferAttribute(t,a),o=Math.max(o,i.distanceToSquared(nr));if(n)for(let a=0,l=n.length;a<l;a++){const c=n[a],u=this.morphTargetsRelative;for(let h=0,d=c.count;h<d;h++)nr.fromBufferAttribute(c,h),u&&(Zh.fromBufferAttribute(t,h),nr.add(Zh)),o=Math.max(o,i.distanceToSquared(nr))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,n=this.attributes;if(t===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.array,o=n.position.array,a=n.normal.array,l=n.uv.array,c=o.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ti(new Float32Array(4*c),4));const u=this.getAttribute("tangent").array,h=[],d=[];for(let O=0;O<c;O++)h[O]=new yt,d[O]=new yt;const f=new yt,p=new yt,m=new yt,g=new $n,y=new $n,v=new $n,x=new yt,b=new yt;function w(O,B,F){f.fromArray(o,O*3),p.fromArray(o,B*3),m.fromArray(o,F*3),g.fromArray(l,O*2),y.fromArray(l,B*2),v.fromArray(l,F*2),p.sub(f),m.sub(f),y.sub(g),v.sub(g);const D=1/(y.x*v.y-v.x*y.y);isFinite(D)&&(x.copy(p).multiplyScalar(v.y).addScaledVector(m,-y.y).multiplyScalar(D),b.copy(m).multiplyScalar(y.x).addScaledVector(p,-v.x).multiplyScalar(D),h[O].add(x),h[B].add(x),h[F].add(x),d[O].add(b),d[B].add(b),d[F].add(b))}let S=this.groups;S.length===0&&(S=[{start:0,count:i.length}]);for(let O=0,B=S.length;O<B;++O){const F=S[O],D=F.start,L=F.count;for(let V=D,j=D+L;V<j;V+=3)w(i[V+0],i[V+1],i[V+2])}const _=new yt,$=new yt,N=new yt,k=new yt;function I(O){N.fromArray(a,O*3),k.copy(N);const B=h[O];_.copy(B),_.sub(N.multiplyScalar(N.dot(B))).normalize(),$.crossVectors(k,B);const D=$.dot(d[O])<0?-1:1;u[O*4]=_.x,u[O*4+1]=_.y,u[O*4+2]=_.z,u[O*4+3]=D}for(let O=0,B=S.length;O<B;++O){const F=S[O],D=F.start,L=F.count;for(let V=D,j=D+L;V<j;V+=3)I(i[V+0]),I(i[V+1]),I(i[V+2])}}computeVertexNormals(){const t=this.index,n=this.getAttribute("position");if(n!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new ti(new Float32Array(n.count*3),3),this.setAttribute("normal",i);else for(let p=0,m=i.count;p<m;p++)i.setXYZ(p,0,0,0);const o=new yt,a=new yt,l=new yt,c=new yt,u=new yt,h=new yt,d=new yt,f=new yt;if(t)for(let p=0,m=t.count;p<m;p+=3){const g=t.getX(p+0),y=t.getX(p+1),v=t.getX(p+2);o.fromBufferAttribute(n,g),a.fromBufferAttribute(n,y),l.fromBufferAttribute(n,v),d.subVectors(l,a),f.subVectors(o,a),d.cross(f),c.fromBufferAttribute(i,g),u.fromBufferAttribute(i,y),h.fromBufferAttribute(i,v),c.add(d),u.add(d),h.add(d),i.setXYZ(g,c.x,c.y,c.z),i.setXYZ(y,u.x,u.y,u.z),i.setXYZ(v,h.x,h.y,h.z)}else for(let p=0,m=n.count;p<m;p+=3)o.fromBufferAttribute(n,p+0),a.fromBufferAttribute(n,p+1),l.fromBufferAttribute(n,p+2),d.subVectors(l,a),f.subVectors(o,a),d.cross(f),i.setXYZ(p+0,d.x,d.y,d.z),i.setXYZ(p+1,d.x,d.y,d.z),i.setXYZ(p+2,d.x,d.y,d.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const t=this.attributes.normal;for(let n=0,i=t.count;n<i;n++)nr.fromBufferAttribute(t,n),nr.normalize(),t.setXYZ(n,nr.x,nr.y,nr.z)}toNonIndexed(){function t(c,u){const h=c.array,d=c.itemSize,f=c.normalized,p=new h.constructor(u.length*d);let m=0,g=0;for(let y=0,v=u.length;y<v;y++){c.isInterleavedBufferAttribute?m=u[y]*c.data.stride+c.offset:m=u[y]*d;for(let x=0;x<d;x++)p[g++]=h[m++]}return new ti(p,d,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new ua,i=this.index.array,o=this.attributes;for(const c in o){const u=o[c],h=t(u,i);n.setAttribute(c,h)}const a=this.morphAttributes;for(const c in a){const u=[],h=a[c];for(let d=0,f=h.length;d<f;d++){const p=h[d],m=t(p,i);u.push(m)}n.morphAttributes[c]=u}n.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let c=0,u=l.length;c<u;c++){const h=l[c];n.addGroup(h.start,h.count,h.materialIndex)}return n}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const u=this.parameters;for(const h in u)u[h]!==void 0&&(t[h]=u[h]);return t}t.data={attributes:{}};const n=this.index;n!==null&&(t.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const i=this.attributes;for(const u in i){const h=i[u];t.data.attributes[u]=h.toJSON(t.data)}const o={};let a=!1;for(const u in this.morphAttributes){const h=this.morphAttributes[u],d=[];for(let f=0,p=h.length;f<p;f++){const m=h[f];d.push(m.toJSON(t.data))}d.length>0&&(o[u]=d,a=!0)}a&&(t.data.morphAttributes=o,t.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(t.data.groups=JSON.parse(JSON.stringify(l)));const c=this.boundingSphere;return c!==null&&(t.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=t.name;const i=t.index;i!==null&&this.setIndex(i.clone(n));const o=t.attributes;for(const h in o){const d=o[h];this.setAttribute(h,d.clone(n))}const a=t.morphAttributes;for(const h in a){const d=[],f=a[h];for(let p=0,m=f.length;p<m;p++)d.push(f[p].clone(n));this.morphAttributes[h]=d}this.morphTargetsRelative=t.morphTargetsRelative;const l=t.groups;for(let h=0,d=l.length;h<d;h++){const f=l[h];this.addGroup(f.start,f.count,f.materialIndex)}const c=t.boundingBox;c!==null&&(this.boundingBox=c.clone());const u=t.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,t.parameters!==void 0&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const mN=new pn,Jh=new wC,xb=new If,ap=new yt,lp=new yt,cp=new yt,bb=new yt,n1=new yt,s1=new $n,r1=new $n,i1=new $n,wb=new yt,o1=new yt;class mi extends as{constructor(t=new ua,n=new hl){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=n,this.updateMorphTargets()}copy(t,n){return super.copy(t,n),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const o=n[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,l=o.length;a<l;a++){const c=o[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=a}}}}getVertexPosition(t,n){const i=this.geometry,o=i.attributes.position,a=i.morphAttributes.position,l=i.morphTargetsRelative;n.fromBufferAttribute(o,t);const c=this.morphTargetInfluences;if(a&&c){n1.set(0,0,0);for(let u=0,h=a.length;u<h;u++){const d=c[u],f=a[u];d!==0&&(bb.fromBufferAttribute(f,t),l?n1.addScaledVector(bb,d):n1.addScaledVector(bb.sub(n),d))}n.add(n1)}return this.isSkinnedMesh&&this.boneTransform(t,n),n}raycast(t,n){const i=this.geometry,o=this.material,a=this.matrixWorld;if(o===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),xb.copy(i.boundingSphere),xb.applyMatrix4(a),t.ray.intersectsSphere(xb)===!1)||(mN.copy(a).invert(),Jh.copy(t.ray).applyMatrix4(mN),i.boundingBox!==null&&Jh.intersectsBox(i.boundingBox)===!1))return;let l;const c=i.index,u=i.attributes.position,h=i.attributes.uv,d=i.attributes.uv2,f=i.groups,p=i.drawRange;if(c!==null)if(Array.isArray(o))for(let m=0,g=f.length;m<g;m++){const y=f[m],v=o[y.materialIndex],x=Math.max(y.start,p.start),b=Math.min(c.count,Math.min(y.start+y.count,p.start+p.count));for(let w=x,S=b;w<S;w+=3){const _=c.getX(w),$=c.getX(w+1),N=c.getX(w+2);l=a1(this,v,t,Jh,h,d,_,$,N),l&&(l.faceIndex=Math.floor(w/3),l.face.materialIndex=y.materialIndex,n.push(l))}}else{const m=Math.max(0,p.start),g=Math.min(c.count,p.start+p.count);for(let y=m,v=g;y<v;y+=3){const x=c.getX(y),b=c.getX(y+1),w=c.getX(y+2);l=a1(this,o,t,Jh,h,d,x,b,w),l&&(l.faceIndex=Math.floor(y/3),n.push(l))}}else if(u!==void 0)if(Array.isArray(o))for(let m=0,g=f.length;m<g;m++){const y=f[m],v=o[y.materialIndex],x=Math.max(y.start,p.start),b=Math.min(u.count,Math.min(y.start+y.count,p.start+p.count));for(let w=x,S=b;w<S;w+=3){const _=w,$=w+1,N=w+2;l=a1(this,v,t,Jh,h,d,_,$,N),l&&(l.faceIndex=Math.floor(w/3),l.face.materialIndex=y.materialIndex,n.push(l))}}else{const m=Math.max(0,p.start),g=Math.min(u.count,p.start+p.count);for(let y=m,v=g;y<v;y+=3){const x=y,b=y+1,w=y+2;l=a1(this,o,t,Jh,h,d,x,b,w),l&&(l.faceIndex=Math.floor(y/3),n.push(l))}}}}function vSt(r,t,n,i,o,a,l,c){let u;if(t.side===go?u=i.intersectTriangle(l,a,o,!0,c):u=i.intersectTriangle(o,a,l,t.side===Ec,c),u===null)return null;o1.copy(c),o1.applyMatrix4(r.matrixWorld);const h=n.ray.origin.distanceTo(o1);return h<n.near||h>n.far?null:{distance:h,point:o1.clone(),object:r}}function a1(r,t,n,i,o,a,l,c,u){r.getVertexPosition(l,ap),r.getVertexPosition(c,lp),r.getVertexPosition(u,cp);const h=vSt(r,t,n,i,ap,lp,cp,wb);if(h){o&&(s1.fromBufferAttribute(o,l),r1.fromBufferAttribute(o,c),i1.fromBufferAttribute(o,u),h.uv=ol.getUV(wb,ap,lp,cp,s1,r1,i1,new $n)),a&&(s1.fromBufferAttribute(a,l),r1.fromBufferAttribute(a,c),i1.fromBufferAttribute(a,u),h.uv2=ol.getUV(wb,ap,lp,cp,s1,r1,i1,new $n));const d={a:l,b:c,c:u,normal:new yt,materialIndex:0};ol.getNormal(ap,lp,cp,d.normal),h.face=d}return h}class jg extends ua{constructor(t=1,n=1,i=1,o=1,a=1,l=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:n,depth:i,widthSegments:o,heightSegments:a,depthSegments:l};const c=this;o=Math.floor(o),a=Math.floor(a),l=Math.floor(l);const u=[],h=[],d=[],f=[];let p=0,m=0;g("z","y","x",-1,-1,i,n,t,l,a,0),g("z","y","x",1,-1,i,n,-t,l,a,1),g("x","z","y",1,1,t,i,n,o,l,2),g("x","z","y",1,-1,t,i,-n,o,l,3),g("x","y","z",1,-1,t,n,i,o,a,4),g("x","y","z",-1,-1,t,n,-i,o,a,5),this.setIndex(u),this.setAttribute("position",new Zo(h,3)),this.setAttribute("normal",new Zo(d,3)),this.setAttribute("uv",new Zo(f,2));function g(y,v,x,b,w,S,_,$,N,k,I){const O=S/N,B=_/k,F=S/2,D=_/2,L=$/2,V=N+1,j=k+1;let Y=0,H=0;const et=new yt;for(let it=0;it<j;it++){const J=it*B-D;for(let rt=0;rt<V;rt++){const ut=rt*O-F;et[y]=ut*b,et[v]=J*w,et[x]=L,h.push(et.x,et.y,et.z),et[y]=0,et[v]=0,et[x]=$>0?1:-1,d.push(et.x,et.y,et.z),f.push(rt/N),f.push(1-it/k),Y+=1}}for(let it=0;it<k;it++)for(let J=0;J<N;J++){const rt=p+J+V*it,ut=p+J+V*(it+1),vt=p+(J+1)+V*(it+1),bt=p+(J+1)+V*it;u.push(rt,ut,bt),u.push(ut,vt,bt),H+=6}c.addGroup(m,H,I),m+=H,p+=Y}}static fromJSON(t){return new jg(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Jd(r){const t={};for(const n in r){t[n]={};for(const i in r[n]){const o=r[n][i];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?t[n][i]=o.clone():Array.isArray(o)?t[n][i]=o.slice():t[n][i]=o}}return t}function qr(r){const t={};for(let n=0;n<r.length;n++){const i=Jd(r[n]);for(const o in i)t[o]=i[o]}return t}function ySt(r){const t=[];for(let n=0;n<r.length;n++)t.push(r[n].clone());return t}function PF(r){return r.getRenderTarget()===null&&r.outputEncoding===Dn?va:lm}const xSt={clone:Jd,merge:qr};var bSt=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,wSt=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class oh extends Oa{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=bSt,this.fragmentShader=wSt,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Jd(t.uniforms),this.uniformsGroups=ySt(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const n=super.toJSON(t);n.glslVersion=this.glslVersion,n.uniforms={};for(const o in this.uniforms){const l=this.uniforms[o].value;l&&l.isTexture?n.uniforms[o]={type:"t",value:l.toJSON(t).uuid}:l&&l.isColor?n.uniforms[o]={type:"c",value:l.getHex()}:l&&l.isVector2?n.uniforms[o]={type:"v2",value:l.toArray()}:l&&l.isVector3?n.uniforms[o]={type:"v3",value:l.toArray()}:l&&l.isVector4?n.uniforms[o]={type:"v4",value:l.toArray()}:l&&l.isMatrix3?n.uniforms[o]={type:"m3",value:l.toArray()}:l&&l.isMatrix4?n.uniforms[o]={type:"m4",value:l.toArray()}:n.uniforms[o]={value:l}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader;const i={};for(const o in this.extensions)this.extensions[o]===!0&&(i[o]=!0);return Object.keys(i).length>0&&(n.extensions=i),n}}let BF=class extends as{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new pn,this.projectionMatrix=new pn,this.projectionMatrixInverse=new pn}copy(t,n){return super.copy(t,n),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return t.set(-n[8],-n[9],-n[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,n){super.updateWorldMatrix(t,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};class hi extends BF{constructor(t=50,n=1,i=.1,o=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=o,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,n){return super.copy(t,n),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const n=.5*this.getFilmHeight()/t;this.fov=cm*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(Rp*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return cm*2*Math.atan(Math.tan(Rp*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,n,i,o,a,l){this.aspect=t/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=o,this.view.width=a,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let n=t*Math.tan(Rp*.5*this.fov)/this.zoom,i=2*n,o=this.aspect*i,a=-.5*o;const l=this.view;if(this.view!==null&&this.view.enabled){const u=l.fullWidth,h=l.fullHeight;a+=l.offsetX*o/u,n-=l.offsetY*i/h,o*=l.width/u,i*=l.height/h}const c=this.filmOffset;c!==0&&(a+=t*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+o,n,n-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const n=super.toJSON(t);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const Qh=-90,td=1;class SSt extends as{constructor(t,n,i){super(),this.type="CubeCamera",this.renderTarget=i;const o=new hi(Qh,td,t,n);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(1,0,0),this.add(o);const a=new hi(Qh,td,t,n);a.layers=this.layers,a.up.set(0,1,0),a.lookAt(-1,0,0),this.add(a);const l=new hi(Qh,td,t,n);l.layers=this.layers,l.up.set(0,0,-1),l.lookAt(0,1,0),this.add(l);const c=new hi(Qh,td,t,n);c.layers=this.layers,c.up.set(0,0,1),c.lookAt(0,-1,0),this.add(c);const u=new hi(Qh,td,t,n);u.layers=this.layers,u.up.set(0,1,0),u.lookAt(0,0,1),this.add(u);const h=new hi(Qh,td,t,n);h.layers=this.layers,h.up.set(0,1,0),h.lookAt(0,0,-1),this.add(h)}update(t,n){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[o,a,l,c,u,h]=this.children,d=t.getRenderTarget(),f=t.toneMapping,p=t.xr.enabled;t.toneMapping=ml,t.xr.enabled=!1;const m=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(n,o),t.setRenderTarget(i,1),t.render(n,a),t.setRenderTarget(i,2),t.render(n,l),t.setRenderTarget(i,3),t.render(n,c),t.setRenderTarget(i,4),t.render(n,u),i.texture.generateMipmaps=m,t.setRenderTarget(i,5),t.render(n,h),t.setRenderTarget(d),t.toneMapping=f,t.xr.enabled=p,i.texture.needsPMREMUpdate=!0}}class zF extends lr{constructor(t,n,i,o,a,l,c,u,h,d){t=t!==void 0?t:[],n=n!==void 0?n:qd,super(t,n,i,o,a,l,c,u,h,d),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class _St extends ih{constructor(t=1,n={}){super(t,t,n),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1},o=[i,i,i,i,i,i];this.texture=new zF(o,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Mr}fromEquirectangularTexture(t,n){this.texture.type=n.type,this.texture.encoding=n.encoding,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},o=new jg(5,5,5),a=new oh({name:"CubemapFromEquirect",uniforms:Jd(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:go,blending:pc});a.uniforms.tEquirect.value=n;const l=new mi(o,a),c=n.minFilter;return n.minFilter===nh&&(n.minFilter=Mr),new SSt(1,10,this).update(t,l),n.minFilter=c,l.geometry.dispose(),l.material.dispose(),this}clear(t,n,i,o){const a=t.getRenderTarget();for(let l=0;l<6;l++)t.setRenderTarget(this,l),t.clear(n,i,o);t.setRenderTarget(a)}}const Sb=new yt,TSt=new yt,CSt=new Oi;class du{constructor(t=new yt(1,0,0),n=0){this.isPlane=!0,this.normal=t,this.constant=n}set(t,n){return this.normal.copy(t),this.constant=n,this}setComponents(t,n,i,o){return this.normal.set(t,n,i),this.constant=o,this}setFromNormalAndCoplanarPoint(t,n){return this.normal.copy(t),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(t,n,i){const o=Sb.subVectors(i,n).cross(TSt.subVectors(t,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,n){return n.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,n){const i=t.delta(Sb),o=this.normal.dot(i);if(o===0)return this.distanceToPoint(t.start)===0?n.copy(t.start):null;const a=-(t.start.dot(this.normal)+this.constant)/o;return a<0||a>1?null:n.copy(i).multiplyScalar(a).add(t.start)}intersectsLine(t){const n=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return n<0&&i>0||i<0&&n>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,n){const i=n||CSt.getNormalMatrix(t),o=this.coplanarPoint(Sb).applyMatrix4(t),a=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(a),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const ed=new If,l1=new yt;class SC{constructor(t=new du,n=new du,i=new du,o=new du,a=new du,l=new du){this.planes=[t,n,i,o,a,l]}set(t,n,i,o,a,l){const c=this.planes;return c[0].copy(t),c[1].copy(n),c[2].copy(i),c[3].copy(o),c[4].copy(a),c[5].copy(l),this}copy(t){const n=this.planes;for(let i=0;i<6;i++)n[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const n=this.planes,i=t.elements,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],h=i[5],d=i[6],f=i[7],p=i[8],m=i[9],g=i[10],y=i[11],v=i[12],x=i[13],b=i[14],w=i[15];return n[0].setComponents(c-o,f-u,y-p,w-v).normalize(),n[1].setComponents(c+o,f+u,y+p,w+v).normalize(),n[2].setComponents(c+a,f+h,y+m,w+x).normalize(),n[3].setComponents(c-a,f-h,y-m,w-x).normalize(),n[4].setComponents(c-l,f-d,y-g,w-b).normalize(),n[5].setComponents(c+l,f+d,y+g,w+b).normalize(),this}intersectsObject(t){const n=t.geometry;return n.boundingSphere===null&&n.computeBoundingSphere(),ed.copy(n.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(ed)}intersectsSprite(t){return ed.center.set(0,0,0),ed.radius=.7071067811865476,ed.applyMatrix4(t.matrixWorld),this.intersectsSphere(ed)}intersectsSphere(t){const n=this.planes,i=t.center,o=-t.radius;for(let a=0;a<6;a++)if(n[a].distanceToPoint(i)<o)return!1;return!0}intersectsBox(t){const n=this.planes;for(let i=0;i<6;i++){const o=n[i];if(l1.x=o.normal.x>0?t.max.x:t.min.x,l1.y=o.normal.y>0?t.max.y:t.min.y,l1.z=o.normal.z>0?t.max.z:t.min.z,o.distanceToPoint(l1)<0)return!1}return!0}containsPoint(t){const n=this.planes;for(let i=0;i<6;i++)if(n[i].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function VF(){let r=null,t=!1,n=null,i=null;function o(a,l){n(a,l),i=r.requestAnimationFrame(o)}return{start:function(){t!==!0&&n!==null&&(i=r.requestAnimationFrame(o),t=!0)},stop:function(){r.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(a){n=a},setContext:function(a){r=a}}}function kSt(r,t){const n=t.isWebGL2,i=new WeakMap;function o(h,d){const f=h.array,p=h.usage,m=r.createBuffer();r.bindBuffer(d,m),r.bufferData(d,f,p),h.onUploadCallback();let g;if(f instanceof Float32Array)g=5126;else if(f instanceof Uint16Array)if(h.isFloat16BufferAttribute)if(n)g=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else g=5123;else if(f instanceof Int16Array)g=5122;else if(f instanceof Uint32Array)g=5125;else if(f instanceof Int32Array)g=5124;else if(f instanceof Int8Array)g=5120;else if(f instanceof Uint8Array)g=5121;else if(f instanceof Uint8ClampedArray)g=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+f);return{buffer:m,type:g,bytesPerElement:f.BYTES_PER_ELEMENT,version:h.version}}function a(h,d,f){const p=d.array,m=d.updateRange;r.bindBuffer(f,h),m.count===-1?r.bufferSubData(f,0,p):(n?r.bufferSubData(f,m.offset*p.BYTES_PER_ELEMENT,p,m.offset,m.count):r.bufferSubData(f,m.offset*p.BYTES_PER_ELEMENT,p.subarray(m.offset,m.offset+m.count)),m.count=-1),d.onUploadCallback()}function l(h){return h.isInterleavedBufferAttribute&&(h=h.data),i.get(h)}function c(h){h.isInterleavedBufferAttribute&&(h=h.data);const d=i.get(h);d&&(r.deleteBuffer(d.buffer),i.delete(h))}function u(h,d){if(h.isGLBufferAttribute){const p=i.get(h);(!p||p.version<h.version)&&i.set(h,{buffer:h.buffer,type:h.type,bytesPerElement:h.elementSize,version:h.version});return}h.isInterleavedBufferAttribute&&(h=h.data);const f=i.get(h);f===void 0?i.set(h,o(h,d)):f.version<h.version&&(a(f.buffer,h,d),f.version=h.version)}return{get:l,remove:c,update:u}}class Py extends ua{constructor(t=1,n=1,i=1,o=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:n,widthSegments:i,heightSegments:o};const a=t/2,l=n/2,c=Math.floor(i),u=Math.floor(o),h=c+1,d=u+1,f=t/c,p=n/u,m=[],g=[],y=[],v=[];for(let x=0;x<d;x++){const b=x*p-l;for(let w=0;w<h;w++){const S=w*f-a;g.push(S,-b,0),y.push(0,0,1),v.push(w/c),v.push(1-x/u)}}for(let x=0;x<u;x++)for(let b=0;b<c;b++){const w=b+h*x,S=b+h*(x+1),_=b+1+h*(x+1),$=b+1+h*x;m.push(w,S,$),m.push(S,_,$)}this.setIndex(m),this.setAttribute("position",new Zo(g,3)),this.setAttribute("normal",new Zo(y,3)),this.setAttribute("uv",new Zo(v,2))}static fromJSON(t){return new Py(t.width,t.height,t.widthSegments,t.heightSegments)}}var $St=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,ISt=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,ESt=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,NSt=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,ASt=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,MSt=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,DSt="vec3 transformed = vec3( position );",RSt=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,OSt=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,LSt=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,FSt=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,PSt=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,BSt=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,zSt=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,VSt=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,USt=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,WSt=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,GSt=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,HSt=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,jSt=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,qSt=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,KSt=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,XSt=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,YSt=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,ZSt=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,JSt=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,QSt="gl_FragColor = linearToOutputTexel( gl_FragColor );",t4t=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,e4t=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,n4t=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,s4t=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,r4t=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,i4t=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,o4t=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,a4t=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,l4t=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,c4t=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,u4t=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,h4t=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,d4t=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,f4t=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,p4t=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,m4t=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,g4t=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,v4t=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,y4t=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,x4t=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,b4t=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,w4t=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,S4t=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,_4t=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,T4t=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,C4t=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,k4t=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,$4t=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,I4t=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,E4t=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,N4t=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,A4t=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,M4t=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,D4t=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,R4t=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,O4t=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,L4t=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,F4t=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,P4t=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,B4t=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,z4t=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,V4t=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,U4t=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,W4t=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,G4t=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,H4t=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,j4t=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,q4t=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,K4t=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,X4t=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Y4t=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Z4t=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,J4t=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Q4t=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,t_t=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,e_t=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,n_t=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,s_t=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,r_t=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,i_t=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,o_t=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,a_t=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,l_t=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,c_t=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,u_t=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,h_t=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,d_t=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,f_t=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,p_t=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,m_t=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,g_t=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,v_t=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,y_t=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,x_t=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,b_t=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,w_t=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,S_t=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,__t=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,T_t=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const C_t=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,k_t=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,$_t=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,I_t=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,E_t=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,N_t=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,A_t=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,M_t=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,D_t=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,R_t=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,O_t=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,L_t=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,F_t=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,P_t=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,B_t=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,z_t=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,V_t=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,U_t=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,W_t=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,G_t=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,H_t=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,j_t=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,q_t=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,K_t=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,X_t=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Y_t=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Z_t=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,J_t=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Q_t=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,tTt=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,eTt=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,nTt=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sTt=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,rTt=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,an={alphamap_fragment:$St,alphamap_pars_fragment:ISt,alphatest_fragment:ESt,alphatest_pars_fragment:NSt,aomap_fragment:ASt,aomap_pars_fragment:MSt,begin_vertex:DSt,beginnormal_vertex:RSt,bsdfs:OSt,iridescence_fragment:LSt,bumpmap_pars_fragment:FSt,clipping_planes_fragment:PSt,clipping_planes_pars_fragment:BSt,clipping_planes_pars_vertex:zSt,clipping_planes_vertex:VSt,color_fragment:USt,color_pars_fragment:WSt,color_pars_vertex:GSt,color_vertex:HSt,common:jSt,cube_uv_reflection_fragment:qSt,defaultnormal_vertex:KSt,displacementmap_pars_vertex:XSt,displacementmap_vertex:YSt,emissivemap_fragment:ZSt,emissivemap_pars_fragment:JSt,encodings_fragment:QSt,encodings_pars_fragment:t4t,envmap_fragment:e4t,envmap_common_pars_fragment:n4t,envmap_pars_fragment:s4t,envmap_pars_vertex:r4t,envmap_physical_pars_fragment:g4t,envmap_vertex:i4t,fog_vertex:o4t,fog_pars_vertex:a4t,fog_fragment:l4t,fog_pars_fragment:c4t,gradientmap_pars_fragment:u4t,lightmap_fragment:h4t,lightmap_pars_fragment:d4t,lights_lambert_fragment:f4t,lights_lambert_pars_fragment:p4t,lights_pars_begin:m4t,lights_toon_fragment:v4t,lights_toon_pars_fragment:y4t,lights_phong_fragment:x4t,lights_phong_pars_fragment:b4t,lights_physical_fragment:w4t,lights_physical_pars_fragment:S4t,lights_fragment_begin:_4t,lights_fragment_maps:T4t,lights_fragment_end:C4t,logdepthbuf_fragment:k4t,logdepthbuf_pars_fragment:$4t,logdepthbuf_pars_vertex:I4t,logdepthbuf_vertex:E4t,map_fragment:N4t,map_pars_fragment:A4t,map_particle_fragment:M4t,map_particle_pars_fragment:D4t,metalnessmap_fragment:R4t,metalnessmap_pars_fragment:O4t,morphcolor_vertex:L4t,morphnormal_vertex:F4t,morphtarget_pars_vertex:P4t,morphtarget_vertex:B4t,normal_fragment_begin:z4t,normal_fragment_maps:V4t,normal_pars_fragment:U4t,normal_pars_vertex:W4t,normal_vertex:G4t,normalmap_pars_fragment:H4t,clearcoat_normal_fragment_begin:j4t,clearcoat_normal_fragment_maps:q4t,clearcoat_pars_fragment:K4t,iridescence_pars_fragment:X4t,output_fragment:Y4t,packing:Z4t,premultiplied_alpha_fragment:J4t,project_vertex:Q4t,dithering_fragment:t_t,dithering_pars_fragment:e_t,roughnessmap_fragment:n_t,roughnessmap_pars_fragment:s_t,shadowmap_pars_fragment:r_t,shadowmap_pars_vertex:i_t,shadowmap_vertex:o_t,shadowmask_pars_fragment:a_t,skinbase_vertex:l_t,skinning_pars_vertex:c_t,skinning_vertex:u_t,skinnormal_vertex:h_t,specularmap_fragment:d_t,specularmap_pars_fragment:f_t,tonemapping_fragment:p_t,tonemapping_pars_fragment:m_t,transmission_fragment:g_t,transmission_pars_fragment:v_t,uv_pars_fragment:y_t,uv_pars_vertex:x_t,uv_vertex:b_t,uv2_pars_fragment:w_t,uv2_pars_vertex:S_t,uv2_vertex:__t,worldpos_vertex:T_t,background_vert:C_t,background_frag:k_t,backgroundCube_vert:$_t,backgroundCube_frag:I_t,cube_vert:E_t,cube_frag:N_t,depth_vert:A_t,depth_frag:M_t,distanceRGBA_vert:D_t,distanceRGBA_frag:R_t,equirect_vert:O_t,equirect_frag:L_t,linedashed_vert:F_t,linedashed_frag:P_t,meshbasic_vert:B_t,meshbasic_frag:z_t,meshlambert_vert:V_t,meshlambert_frag:U_t,meshmatcap_vert:W_t,meshmatcap_frag:G_t,meshnormal_vert:H_t,meshnormal_frag:j_t,meshphong_vert:q_t,meshphong_frag:K_t,meshphysical_vert:X_t,meshphysical_frag:Y_t,meshtoon_vert:Z_t,meshtoon_frag:J_t,points_vert:Q_t,points_frag:tTt,shadow_vert:eTt,shadow_frag:nTt,sprite_vert:sTt,sprite_frag:rTt},ce={common:{diffuse:{value:new sn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Oi},uv2Transform:{value:new Oi},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new $n(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new sn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new sn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Oi}},sprite:{diffuse:{value:new sn(16777215)},opacity:{value:1},center:{value:new $n(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Oi}}},Sa={basic:{uniforms:qr([ce.common,ce.specularmap,ce.envmap,ce.aomap,ce.lightmap,ce.fog]),vertexShader:an.meshbasic_vert,fragmentShader:an.meshbasic_frag},lambert:{uniforms:qr([ce.common,ce.specularmap,ce.envmap,ce.aomap,ce.lightmap,ce.emissivemap,ce.bumpmap,ce.normalmap,ce.displacementmap,ce.fog,ce.lights,{emissive:{value:new sn(0)}}]),vertexShader:an.meshlambert_vert,fragmentShader:an.meshlambert_frag},phong:{uniforms:qr([ce.common,ce.specularmap,ce.envmap,ce.aomap,ce.lightmap,ce.emissivemap,ce.bumpmap,ce.normalmap,ce.displacementmap,ce.fog,ce.lights,{emissive:{value:new sn(0)},specular:{value:new sn(1118481)},shininess:{value:30}}]),vertexShader:an.meshphong_vert,fragmentShader:an.meshphong_frag},standard:{uniforms:qr([ce.common,ce.envmap,ce.aomap,ce.lightmap,ce.emissivemap,ce.bumpmap,ce.normalmap,ce.displacementmap,ce.roughnessmap,ce.metalnessmap,ce.fog,ce.lights,{emissive:{value:new sn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:an.meshphysical_vert,fragmentShader:an.meshphysical_frag},toon:{uniforms:qr([ce.common,ce.aomap,ce.lightmap,ce.emissivemap,ce.bumpmap,ce.normalmap,ce.displacementmap,ce.gradientmap,ce.fog,ce.lights,{emissive:{value:new sn(0)}}]),vertexShader:an.meshtoon_vert,fragmentShader:an.meshtoon_frag},matcap:{uniforms:qr([ce.common,ce.bumpmap,ce.normalmap,ce.displacementmap,ce.fog,{matcap:{value:null}}]),vertexShader:an.meshmatcap_vert,fragmentShader:an.meshmatcap_frag},points:{uniforms:qr([ce.points,ce.fog]),vertexShader:an.points_vert,fragmentShader:an.points_frag},dashed:{uniforms:qr([ce.common,ce.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:an.linedashed_vert,fragmentShader:an.linedashed_frag},depth:{uniforms:qr([ce.common,ce.displacementmap]),vertexShader:an.depth_vert,fragmentShader:an.depth_frag},normal:{uniforms:qr([ce.common,ce.bumpmap,ce.normalmap,ce.displacementmap,{opacity:{value:1}}]),vertexShader:an.meshnormal_vert,fragmentShader:an.meshnormal_frag},sprite:{uniforms:qr([ce.sprite,ce.fog]),vertexShader:an.sprite_vert,fragmentShader:an.sprite_frag},background:{uniforms:{uvTransform:{value:new Oi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:an.background_vert,fragmentShader:an.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:an.backgroundCube_vert,fragmentShader:an.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:an.cube_vert,fragmentShader:an.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:an.equirect_vert,fragmentShader:an.equirect_frag},distanceRGBA:{uniforms:qr([ce.common,ce.displacementmap,{referencePosition:{value:new yt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:an.distanceRGBA_vert,fragmentShader:an.distanceRGBA_frag},shadow:{uniforms:qr([ce.lights,ce.fog,{color:{value:new sn(0)},opacity:{value:1}}]),vertexShader:an.shadow_vert,fragmentShader:an.shadow_frag}};Sa.physical={uniforms:qr([Sa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new $n(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new sn(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new $n},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new sn(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new sn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:an.meshphysical_vert,fragmentShader:an.meshphysical_frag};const c1={r:0,b:0,g:0};function iTt(r,t,n,i,o,a,l){const c=new sn(0);let u=a===!0?0:1,h,d,f=null,p=0,m=null;function g(v,x){let b=!1,w=x.isScene===!0?x.background:null;w&&w.isTexture&&(w=(x.backgroundBlurriness>0?n:t).get(w));const S=r.xr,_=S.getSession&&S.getSession();_&&_.environmentBlendMode==="additive"&&(w=null),w===null?y(c,u):w&&w.isColor&&(y(w,1),b=!0),(r.autoClear||b)&&r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil),w&&(w.isCubeTexture||w.mapping===Fy)?(d===void 0&&(d=new mi(new jg(1,1,1),new oh({name:"BackgroundCubeMaterial",uniforms:Jd(Sa.backgroundCube.uniforms),vertexShader:Sa.backgroundCube.vertexShader,fragmentShader:Sa.backgroundCube.fragmentShader,side:go,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function($,N,k){this.matrixWorld.copyPosition(k.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(d)),d.material.uniforms.envMap.value=w,d.material.uniforms.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,d.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,d.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,d.material.toneMapped=w.encoding!==Dn,(f!==w||p!==w.version||m!==r.toneMapping)&&(d.material.needsUpdate=!0,f=w,p=w.version,m=r.toneMapping),d.layers.enableAll(),v.unshift(d,d.geometry,d.material,0,0,null)):w&&w.isTexture&&(h===void 0&&(h=new mi(new Py(2,2),new oh({name:"BackgroundMaterial",uniforms:Jd(Sa.background.uniforms),vertexShader:Sa.background.vertexShader,fragmentShader:Sa.background.fragmentShader,side:Ec,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(h)),h.material.uniforms.t2D.value=w,h.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,h.material.toneMapped=w.encoding!==Dn,w.matrixAutoUpdate===!0&&w.updateMatrix(),h.material.uniforms.uvTransform.value.copy(w.matrix),(f!==w||p!==w.version||m!==r.toneMapping)&&(h.material.needsUpdate=!0,f=w,p=w.version,m=r.toneMapping),h.layers.enableAll(),v.unshift(h,h.geometry,h.material,0,0,null))}function y(v,x){v.getRGB(c1,PF(r)),i.buffers.color.setClear(c1.r,c1.g,c1.b,x,l)}return{getClearColor:function(){return c},setClearColor:function(v,x=1){c.set(v),u=x,y(c,u)},getClearAlpha:function(){return u},setClearAlpha:function(v){u=v,y(c,u)},render:g}}function oTt(r,t,n,i){const o=r.getParameter(34921),a=i.isWebGL2?null:t.get("OES_vertex_array_object"),l=i.isWebGL2||a!==null,c={},u=v(null);let h=u,d=!1;function f(L,V,j,Y,H){let et=!1;if(l){const it=y(Y,j,V);h!==it&&(h=it,m(h.object)),et=x(L,Y,j,H),et&&b(L,Y,j,H)}else{const it=V.wireframe===!0;(h.geometry!==Y.id||h.program!==j.id||h.wireframe!==it)&&(h.geometry=Y.id,h.program=j.id,h.wireframe=it,et=!0)}H!==null&&n.update(H,34963),(et||d)&&(d=!1,k(L,V,j,Y),H!==null&&r.bindBuffer(34963,n.get(H).buffer))}function p(){return i.isWebGL2?r.createVertexArray():a.createVertexArrayOES()}function m(L){return i.isWebGL2?r.bindVertexArray(L):a.bindVertexArrayOES(L)}function g(L){return i.isWebGL2?r.deleteVertexArray(L):a.deleteVertexArrayOES(L)}function y(L,V,j){const Y=j.wireframe===!0;let H=c[L.id];H===void 0&&(H={},c[L.id]=H);let et=H[V.id];et===void 0&&(et={},H[V.id]=et);let it=et[Y];return it===void 0&&(it=v(p()),et[Y]=it),it}function v(L){const V=[],j=[],Y=[];for(let H=0;H<o;H++)V[H]=0,j[H]=0,Y[H]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:V,enabledAttributes:j,attributeDivisors:Y,object:L,attributes:{},index:null}}function x(L,V,j,Y){const H=h.attributes,et=V.attributes;let it=0;const J=j.getAttributes();for(const rt in J)if(J[rt].location>=0){const vt=H[rt];let bt=et[rt];if(bt===void 0&&(rt==="instanceMatrix"&&L.instanceMatrix&&(bt=L.instanceMatrix),rt==="instanceColor"&&L.instanceColor&&(bt=L.instanceColor)),vt===void 0||vt.attribute!==bt||bt&&vt.data!==bt.data)return!0;it++}return h.attributesNum!==it||h.index!==Y}function b(L,V,j,Y){const H={},et=V.attributes;let it=0;const J=j.getAttributes();for(const rt in J)if(J[rt].location>=0){let vt=et[rt];vt===void 0&&(rt==="instanceMatrix"&&L.instanceMatrix&&(vt=L.instanceMatrix),rt==="instanceColor"&&L.instanceColor&&(vt=L.instanceColor));const bt={};bt.attribute=vt,vt&&vt.data&&(bt.data=vt.data),H[rt]=bt,it++}h.attributes=H,h.attributesNum=it,h.index=Y}function w(){const L=h.newAttributes;for(let V=0,j=L.length;V<j;V++)L[V]=0}function S(L){_(L,0)}function _(L,V){const j=h.newAttributes,Y=h.enabledAttributes,H=h.attributeDivisors;j[L]=1,Y[L]===0&&(r.enableVertexAttribArray(L),Y[L]=1),H[L]!==V&&((i.isWebGL2?r:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](L,V),H[L]=V)}function $(){const L=h.newAttributes,V=h.enabledAttributes;for(let j=0,Y=V.length;j<Y;j++)V[j]!==L[j]&&(r.disableVertexAttribArray(j),V[j]=0)}function N(L,V,j,Y,H,et){i.isWebGL2===!0&&(j===5124||j===5125)?r.vertexAttribIPointer(L,V,j,H,et):r.vertexAttribPointer(L,V,j,Y,H,et)}function k(L,V,j,Y){if(i.isWebGL2===!1&&(L.isInstancedMesh||Y.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;w();const H=Y.attributes,et=j.getAttributes(),it=V.defaultAttributeValues;for(const J in et){const rt=et[J];if(rt.location>=0){let ut=H[J];if(ut===void 0&&(J==="instanceMatrix"&&L.instanceMatrix&&(ut=L.instanceMatrix),J==="instanceColor"&&L.instanceColor&&(ut=L.instanceColor)),ut!==void 0){const vt=ut.normalized,bt=ut.itemSize,ht=n.get(ut);if(ht===void 0)continue;const Wt=ht.buffer,Dt=ht.type,Vt=ht.bytesPerElement;if(ut.isInterleavedBufferAttribute){const zt=ut.data,Jt=zt.stride,oe=ut.offset;if(zt.isInstancedInterleavedBuffer){for(let ne=0;ne<rt.locationSize;ne++)_(rt.location+ne,zt.meshPerAttribute);L.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=zt.meshPerAttribute*zt.count)}else for(let ne=0;ne<rt.locationSize;ne++)S(rt.location+ne);r.bindBuffer(34962,Wt);for(let ne=0;ne<rt.locationSize;ne++)N(rt.location+ne,bt/rt.locationSize,Dt,vt,Jt*Vt,(oe+bt/rt.locationSize*ne)*Vt)}else{if(ut.isInstancedBufferAttribute){for(let zt=0;zt<rt.locationSize;zt++)_(rt.location+zt,ut.meshPerAttribute);L.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=ut.meshPerAttribute*ut.count)}else for(let zt=0;zt<rt.locationSize;zt++)S(rt.location+zt);r.bindBuffer(34962,Wt);for(let zt=0;zt<rt.locationSize;zt++)N(rt.location+zt,bt/rt.locationSize,Dt,vt,bt*Vt,bt/rt.locationSize*zt*Vt)}}else if(it!==void 0){const vt=it[J];if(vt!==void 0)switch(vt.length){case 2:r.vertexAttrib2fv(rt.location,vt);break;case 3:r.vertexAttrib3fv(rt.location,vt);break;case 4:r.vertexAttrib4fv(rt.location,vt);break;default:r.vertexAttrib1fv(rt.location,vt)}}}}$()}function I(){F();for(const L in c){const V=c[L];for(const j in V){const Y=V[j];for(const H in Y)g(Y[H].object),delete Y[H];delete V[j]}delete c[L]}}function O(L){if(c[L.id]===void 0)return;const V=c[L.id];for(const j in V){const Y=V[j];for(const H in Y)g(Y[H].object),delete Y[H];delete V[j]}delete c[L.id]}function B(L){for(const V in c){const j=c[V];if(j[L.id]===void 0)continue;const Y=j[L.id];for(const H in Y)g(Y[H].object),delete Y[H];delete j[L.id]}}function F(){D(),d=!0,h!==u&&(h=u,m(h.object))}function D(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:f,reset:F,resetDefaultState:D,dispose:I,releaseStatesOfGeometry:O,releaseStatesOfProgram:B,initAttributes:w,enableAttribute:S,disableUnusedAttributes:$}}function aTt(r,t,n,i){const o=i.isWebGL2;let a;function l(h){a=h}function c(h,d){r.drawArrays(a,h,d),n.update(d,a,1)}function u(h,d,f){if(f===0)return;let p,m;if(o)p=r,m="drawArraysInstanced";else if(p=t.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",p===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}p[m](a,h,d,f),n.update(d,a,f)}this.setMode=l,this.render=c,this.renderInstances=u}function lTt(r,t,n){let i;function o(){if(i!==void 0)return i;if(t.has("EXT_texture_filter_anisotropic")===!0){const N=t.get("EXT_texture_filter_anisotropic");i=r.getParameter(N.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function a(N){if(N==="highp"){if(r.getShaderPrecisionFormat(35633,36338).precision>0&&r.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";N="mediump"}return N==="mediump"&&r.getShaderPrecisionFormat(35633,36337).precision>0&&r.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const l=typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&r instanceof WebGL2ComputeRenderingContext;let c=n.precision!==void 0?n.precision:"highp";const u=a(c);u!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const h=l||t.has("WEBGL_draw_buffers"),d=n.logarithmicDepthBuffer===!0,f=r.getParameter(34930),p=r.getParameter(35660),m=r.getParameter(3379),g=r.getParameter(34076),y=r.getParameter(34921),v=r.getParameter(36347),x=r.getParameter(36348),b=r.getParameter(36349),w=p>0,S=l||t.has("OES_texture_float"),_=w&&S,$=l?r.getParameter(36183):0;return{isWebGL2:l,drawBuffers:h,getMaxAnisotropy:o,getMaxPrecision:a,precision:c,logarithmicDepthBuffer:d,maxTextures:f,maxVertexTextures:p,maxTextureSize:m,maxCubemapSize:g,maxAttributes:y,maxVertexUniforms:v,maxVaryings:x,maxFragmentUniforms:b,vertexTextures:w,floatFragmentTextures:S,floatVertexTextures:_,maxSamples:$}}function cTt(r){const t=this;let n=null,i=0,o=!1,a=!1;const l=new du,c=new Oi,u={value:null,needsUpdate:!1};this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(f,p,m){const g=f.length!==0||p||i!==0||o;return o=p,n=d(f,m,0),i=f.length,g},this.beginShadows=function(){a=!0,d(null)},this.endShadows=function(){a=!1,h()},this.setState=function(f,p,m){const g=f.clippingPlanes,y=f.clipIntersection,v=f.clipShadows,x=r.get(f);if(!o||g===null||g.length===0||a&&!v)a?d(null):h();else{const b=a?0:i,w=b*4;let S=x.clippingState||null;u.value=S,S=d(g,p,w,m);for(let _=0;_!==w;++_)S[_]=n[_];x.clippingState=S,this.numIntersection=y?this.numPlanes:0,this.numPlanes+=b}};function h(){u.value!==n&&(u.value=n,u.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function d(f,p,m,g){const y=f!==null?f.length:0;let v=null;if(y!==0){if(v=u.value,g!==!0||v===null){const x=m+y*4,b=p.matrixWorldInverse;c.getNormalMatrix(b),(v===null||v.length<x)&&(v=new Float32Array(x));for(let w=0,S=m;w!==y;++w,S+=4)l.copy(f[w]).applyMatrix4(b,c),l.normal.toArray(v,S),v[S+3]=l.constant}u.value=v,u.needsUpdate=!0}return t.numPlanes=y,t.numIntersection=0,v}}function uTt(r){let t=new WeakMap;function n(l,c){return c===kw?l.mapping=qd:c===$w&&(l.mapping=Kd),l}function i(l){if(l&&l.isTexture&&l.isRenderTargetTexture===!1){const c=l.mapping;if(c===kw||c===$w)if(t.has(l)){const u=t.get(l).texture;return n(u,l.mapping)}else{const u=l.image;if(u&&u.height>0){const h=new _St(u.height/2);return h.fromEquirectangularTexture(r,l),t.set(l,h),l.addEventListener("dispose",o),n(h.texture,l.mapping)}else return null}}return l}function o(l){const c=l.target;c.removeEventListener("dispose",o);const u=t.get(c);u!==void 0&&(t.delete(c),u.dispose())}function a(){t=new WeakMap}return{get:i,dispose:a}}class By extends BF{constructor(t=-1,n=1,i=1,o=-1,a=.1,l=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=n,this.top=i,this.bottom=o,this.near=a,this.far=l,this.updateProjectionMatrix()}copy(t,n){return super.copy(t,n),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,n,i,o,a,l){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=o,this.view.width=a,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,o=(this.top+this.bottom)/2;let a=i-t,l=i+t,c=o+n,u=o-n;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=h*this.view.offsetX,l=a+h*this.view.width,c-=d*this.view.offsetY,u=c-d*this.view.height}this.projectionMatrix.makeOrthographic(a,l,c,u,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const n=super.toJSON(t);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}const vd=4,gN=[.125,.215,.35,.446,.526,.582],vu=20,_b=new By,vN=new sn;let Tb=null;const fu=(1+Math.sqrt(5))/2,nd=1/fu,yN=[new yt(1,1,1),new yt(-1,1,1),new yt(1,1,-1),new yt(-1,1,-1),new yt(0,fu,nd),new yt(0,fu,-nd),new yt(nd,0,fu),new yt(-nd,0,fu),new yt(fu,nd,0),new yt(-fu,nd,0)];class xN{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,n=0,i=.1,o=100){Tb=this._renderer.getRenderTarget(),this._setSize(256);const a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(t,i,o,a),n>0&&this._blur(a,0,0,n),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(t,n=null){return this._fromTexture(t,n)}fromCubemap(t,n=null){return this._fromTexture(t,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=SN(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=wN(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Tb),t.scissorTest=!1,u1(t,0,0,t.width,t.height)}_fromTexture(t,n){t.mapping===qd||t.mapping===Kd?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Tb=this._renderer.getRenderTarget();const i=n||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,i={magFilter:Mr,minFilter:Mr,generateMipmaps:!1,type:om,format:oo,encoding:rh,depthBuffer:!1},o=bN(t,n,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=bN(t,n,i);const{_lodMax:a}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=hTt(a)),this._blurMaterial=dTt(a,t,n)}return o}_compileMaterial(t){const n=new mi(this._lodPlanes[0],t);this._renderer.compile(n,_b)}_sceneToCubeUV(t,n,i,o){const c=new hi(90,1,n,i),u=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],d=this._renderer,f=d.autoClear,p=d.toneMapping;d.getClearColor(vN),d.toneMapping=ml,d.autoClear=!1;const m=new hl({name:"PMREM.Background",side:go,depthWrite:!1,depthTest:!1}),g=new mi(new jg,m);let y=!1;const v=t.background;v?v.isColor&&(m.color.copy(v),t.background=null,y=!0):(m.color.copy(vN),y=!0);for(let x=0;x<6;x++){const b=x%3;b===0?(c.up.set(0,u[x],0),c.lookAt(h[x],0,0)):b===1?(c.up.set(0,0,u[x]),c.lookAt(0,h[x],0)):(c.up.set(0,u[x],0),c.lookAt(0,0,h[x]));const w=this._cubeSize;u1(o,b*w,x>2?w:0,w,w),d.setRenderTarget(o),y&&d.render(g,c),d.render(t,c)}g.geometry.dispose(),g.material.dispose(),d.toneMapping=p,d.autoClear=f,t.background=v}_textureToCubeUV(t,n){const i=this._renderer,o=t.mapping===qd||t.mapping===Kd;o?(this._cubemapMaterial===null&&(this._cubemapMaterial=SN()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=wN());const a=o?this._cubemapMaterial:this._equirectMaterial,l=new mi(this._lodPlanes[0],a),c=a.uniforms;c.envMap.value=t;const u=this._cubeSize;u1(n,0,0,3*u,2*u),i.setRenderTarget(n),i.render(l,_b)}_applyPMREM(t){const n=this._renderer,i=n.autoClear;n.autoClear=!1;for(let o=1;o<this._lodPlanes.length;o++){const a=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),l=yN[(o-1)%yN.length];this._blur(t,o-1,o,a,l)}n.autoClear=i}_blur(t,n,i,o,a){const l=this._pingPongRenderTarget;this._halfBlur(t,l,n,i,o,"latitudinal",a),this._halfBlur(l,t,i,i,o,"longitudinal",a)}_halfBlur(t,n,i,o,a,l,c){const u=this._renderer,h=this._blurMaterial;l!=="latitudinal"&&l!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const d=3,f=new mi(this._lodPlanes[o],h),p=h.uniforms,m=this._sizeLods[i]-1,g=isFinite(a)?Math.PI/(2*m):2*Math.PI/(2*vu-1),y=a/g,v=isFinite(a)?1+Math.floor(d*y):vu;v>vu&&console.warn(`sigmaRadians, ${a}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${vu}`);const x=[];let b=0;for(let N=0;N<vu;++N){const k=N/y,I=Math.exp(-k*k/2);x.push(I),N===0?b+=I:N<v&&(b+=2*I)}for(let N=0;N<x.length;N++)x[N]=x[N]/b;p.envMap.value=t.texture,p.samples.value=v,p.weights.value=x,p.latitudinal.value=l==="latitudinal",c&&(p.poleAxis.value=c);const{_lodMax:w}=this;p.dTheta.value=g,p.mipInt.value=w-i;const S=this._sizeLods[o],_=3*S*(o>w-vd?o-w+vd:0),$=4*(this._cubeSize-S);u1(n,_,$,3*S,2*S),u.setRenderTarget(n),u.render(f,_b)}}function hTt(r){const t=[],n=[],i=[];let o=r;const a=r-vd+1+gN.length;for(let l=0;l<a;l++){const c=Math.pow(2,o);n.push(c);let u=1/c;l>r-vd?u=gN[l-r+vd-1]:l===0&&(u=0),i.push(u);const h=1/(c-2),d=-h,f=1+h,p=[d,d,f,d,f,f,d,d,f,f,d,f],m=6,g=6,y=3,v=2,x=1,b=new Float32Array(y*g*m),w=new Float32Array(v*g*m),S=new Float32Array(x*g*m);for(let $=0;$<m;$++){const N=$%3*2/3-1,k=$>2?0:-1,I=[N,k,0,N+2/3,k,0,N+2/3,k+1,0,N,k,0,N+2/3,k+1,0,N,k+1,0];b.set(I,y*g*$),w.set(p,v*g*$);const O=[$,$,$,$,$,$];S.set(O,x*g*$)}const _=new ua;_.setAttribute("position",new ti(b,y)),_.setAttribute("uv",new ti(w,v)),_.setAttribute("faceIndex",new ti(S,x)),t.push(_),o>vd&&o--}return{lodPlanes:t,sizeLods:n,sigmas:i}}function bN(r,t,n){const i=new ih(r,t,n);return i.texture.mapping=Fy,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function u1(r,t,n,i,o){r.viewport.set(t,n,i,o),r.scissor.set(t,n,i,o)}function dTt(r,t,n){const i=new Float32Array(vu),o=new yt(0,1,0);return new oh({name:"SphericalGaussianBlur",defines:{n:vu,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:o}},vertexShader:_C(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:pc,depthTest:!1,depthWrite:!1})}function wN(){return new oh({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_C(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:pc,depthTest:!1,depthWrite:!1})}function SN(){return new oh({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_C(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:pc,depthTest:!1,depthWrite:!1})}function _C(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function fTt(r){let t=new WeakMap,n=null;function i(c){if(c&&c.isTexture){const u=c.mapping,h=u===kw||u===$w,d=u===qd||u===Kd;if(h||d)if(c.isRenderTargetTexture&&c.needsPMREMUpdate===!0){c.needsPMREMUpdate=!1;let f=t.get(c);return n===null&&(n=new xN(r)),f=h?n.fromEquirectangular(c,f):n.fromCubemap(c,f),t.set(c,f),f.texture}else{if(t.has(c))return t.get(c).texture;{const f=c.image;if(h&&f&&f.height>0||d&&f&&o(f)){n===null&&(n=new xN(r));const p=h?n.fromEquirectangular(c):n.fromCubemap(c);return t.set(c,p),c.addEventListener("dispose",a),p.texture}else return null}}}return c}function o(c){let u=0;const h=6;for(let d=0;d<h;d++)c[d]!==void 0&&u++;return u===h}function a(c){const u=c.target;u.removeEventListener("dispose",a);const h=t.get(u);h!==void 0&&(t.delete(u),h.dispose())}function l(){t=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:i,dispose:l}}function pTt(r){const t={};function n(i){if(t[i]!==void 0)return t[i];let o;switch(i){case"WEBGL_depth_texture":o=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":o=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":o=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":o=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:o=r.getExtension(i)}return t[i]=o,o}return{has:function(i){return n(i)!==null},init:function(i){i.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(i){const o=n(i);return o===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),o}}}function mTt(r,t,n,i){const o={},a=new WeakMap;function l(f){const p=f.target;p.index!==null&&t.remove(p.index);for(const g in p.attributes)t.remove(p.attributes[g]);p.removeEventListener("dispose",l),delete o[p.id];const m=a.get(p);m&&(t.remove(m),a.delete(p)),i.releaseStatesOfGeometry(p),p.isInstancedBufferGeometry===!0&&delete p._maxInstanceCount,n.memory.geometries--}function c(f,p){return o[p.id]===!0||(p.addEventListener("dispose",l),o[p.id]=!0,n.memory.geometries++),p}function u(f){const p=f.attributes;for(const g in p)t.update(p[g],34962);const m=f.morphAttributes;for(const g in m){const y=m[g];for(let v=0,x=y.length;v<x;v++)t.update(y[v],34962)}}function h(f){const p=[],m=f.index,g=f.attributes.position;let y=0;if(m!==null){const b=m.array;y=m.version;for(let w=0,S=b.length;w<S;w+=3){const _=b[w+0],$=b[w+1],N=b[w+2];p.push(_,$,$,N,N,_)}}else{const b=g.array;y=g.version;for(let w=0,S=b.length/3-1;w<S;w+=3){const _=w+0,$=w+1,N=w+2;p.push(_,$,$,N,N,_)}}const v=new(NF(p)?FF:LF)(p,1);v.version=y;const x=a.get(f);x&&t.remove(x),a.set(f,v)}function d(f){const p=a.get(f);if(p){const m=f.index;m!==null&&p.version<m.version&&h(f)}else h(f);return a.get(f)}return{get:c,update:u,getWireframeAttribute:d}}function gTt(r,t,n,i){const o=i.isWebGL2;let a;function l(p){a=p}let c,u;function h(p){c=p.type,u=p.bytesPerElement}function d(p,m){r.drawElements(a,m,c,p*u),n.update(m,a,1)}function f(p,m,g){if(g===0)return;let y,v;if(o)y=r,v="drawElementsInstanced";else if(y=t.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",y===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}y[v](a,m,c,p*u,g),n.update(m,a,g)}this.setMode=l,this.setIndex=h,this.render=d,this.renderInstances=f}function vTt(r){const t={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function i(a,l,c){switch(n.calls++,l){case 4:n.triangles+=c*(a/3);break;case 1:n.lines+=c*(a/2);break;case 3:n.lines+=c*(a-1);break;case 2:n.lines+=c*a;break;case 0:n.points+=c*a;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",l);break}}function o(){n.frame++,n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:t,render:n,programs:null,autoReset:!0,reset:o,update:i}}function yTt(r,t){return r[0]-t[0]}function xTt(r,t){return Math.abs(t[1])-Math.abs(r[1])}function bTt(r,t,n){const i={},o=new Float32Array(8),a=new WeakMap,l=new Gn,c=[];for(let h=0;h<8;h++)c[h]=[h,0];function u(h,d,f,p){const m=h.morphTargetInfluences;if(t.isWebGL2===!0){const y=d.morphAttributes.position||d.morphAttributes.normal||d.morphAttributes.color,v=y!==void 0?y.length:0;let x=a.get(d);if(x===void 0||x.count!==v){let j=function(){L.dispose(),a.delete(d),d.removeEventListener("dispose",j)};var g=j;x!==void 0&&x.texture.dispose();const S=d.morphAttributes.position!==void 0,_=d.morphAttributes.normal!==void 0,$=d.morphAttributes.color!==void 0,N=d.morphAttributes.position||[],k=d.morphAttributes.normal||[],I=d.morphAttributes.color||[];let O=0;S===!0&&(O=1),_===!0&&(O=2),$===!0&&(O=3);let B=d.attributes.position.count*O,F=1;B>t.maxTextureSize&&(F=Math.ceil(B/t.maxTextureSize),B=t.maxTextureSize);const D=new Float32Array(B*F*4*v),L=new RF(D,B,F,v);L.type=ic,L.needsUpdate=!0;const V=O*4;for(let Y=0;Y<v;Y++){const H=N[Y],et=k[Y],it=I[Y],J=B*F*4*Y;for(let rt=0;rt<H.count;rt++){const ut=rt*V;S===!0&&(l.fromBufferAttribute(H,rt),D[J+ut+0]=l.x,D[J+ut+1]=l.y,D[J+ut+2]=l.z,D[J+ut+3]=0),_===!0&&(l.fromBufferAttribute(et,rt),D[J+ut+4]=l.x,D[J+ut+5]=l.y,D[J+ut+6]=l.z,D[J+ut+7]=0),$===!0&&(l.fromBufferAttribute(it,rt),D[J+ut+8]=l.x,D[J+ut+9]=l.y,D[J+ut+10]=l.z,D[J+ut+11]=it.itemSize===4?l.w:1)}}x={count:v,texture:L,size:new $n(B,F)},a.set(d,x),d.addEventListener("dispose",j)}let b=0;for(let S=0;S<m.length;S++)b+=m[S];const w=d.morphTargetsRelative?1:1-b;p.getUniforms().setValue(r,"morphTargetBaseInfluence",w),p.getUniforms().setValue(r,"morphTargetInfluences",m),p.getUniforms().setValue(r,"morphTargetsTexture",x.texture,n),p.getUniforms().setValue(r,"morphTargetsTextureSize",x.size)}else{const y=m===void 0?0:m.length;let v=i[d.id];if(v===void 0||v.length!==y){v=[];for(let _=0;_<y;_++)v[_]=[_,0];i[d.id]=v}for(let _=0;_<y;_++){const $=v[_];$[0]=_,$[1]=m[_]}v.sort(xTt);for(let _=0;_<8;_++)_<y&&v[_][1]?(c[_][0]=v[_][0],c[_][1]=v[_][1]):(c[_][0]=Number.MAX_SAFE_INTEGER,c[_][1]=0);c.sort(yTt);const x=d.morphAttributes.position,b=d.morphAttributes.normal;let w=0;for(let _=0;_<8;_++){const $=c[_],N=$[0],k=$[1];N!==Number.MAX_SAFE_INTEGER&&k?(x&&d.getAttribute("morphTarget"+_)!==x[N]&&d.setAttribute("morphTarget"+_,x[N]),b&&d.getAttribute("morphNormal"+_)!==b[N]&&d.setAttribute("morphNormal"+_,b[N]),o[_]=k,w+=k):(x&&d.hasAttribute("morphTarget"+_)===!0&&d.deleteAttribute("morphTarget"+_),b&&d.hasAttribute("morphNormal"+_)===!0&&d.deleteAttribute("morphNormal"+_),o[_]=0)}const S=d.morphTargetsRelative?1:1-w;p.getUniforms().setValue(r,"morphTargetBaseInfluence",S),p.getUniforms().setValue(r,"morphTargetInfluences",o)}}return{update:u}}function wTt(r,t,n,i){let o=new WeakMap;function a(u){const h=i.render.frame,d=u.geometry,f=t.get(u,d);return o.get(f)!==h&&(t.update(f),o.set(f,h)),u.isInstancedMesh&&(u.hasEventListener("dispose",c)===!1&&u.addEventListener("dispose",c),n.update(u.instanceMatrix,34962),u.instanceColor!==null&&n.update(u.instanceColor,34962)),f}function l(){o=new WeakMap}function c(u){const h=u.target;h.removeEventListener("dispose",c),n.remove(h.instanceMatrix),h.instanceColor!==null&&n.remove(h.instanceColor)}return{update:a,dispose:l}}const UF=new lr,WF=new RF,GF=new aSt,HF=new zF,_N=[],TN=[],CN=new Float32Array(16),kN=new Float32Array(9),$N=new Float32Array(4);function Ef(r,t,n){const i=r[0];if(i<=0||i>0)return r;const o=t*n;let a=_N[o];if(a===void 0&&(a=new Float32Array(o),_N[o]=a),t!==0){i.toArray(a,0);for(let l=1,c=0;l!==t;++l)c+=n,r[l].toArray(a,c)}return a}function Ks(r,t){if(r.length!==t.length)return!1;for(let n=0,i=r.length;n<i;n++)if(r[n]!==t[n])return!1;return!0}function Xs(r,t){for(let n=0,i=t.length;n<i;n++)r[n]=t[n]}function zy(r,t){let n=TN[t];n===void 0&&(n=new Int32Array(t),TN[t]=n);for(let i=0;i!==t;++i)n[i]=r.allocateTextureUnit();return n}function STt(r,t){const n=this.cache;n[0]!==t&&(r.uniform1f(this.addr,t),n[0]=t)}function _Tt(r,t){const n=this.cache;if(t.x!==void 0)(n[0]!==t.x||n[1]!==t.y)&&(r.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Ks(n,t))return;r.uniform2fv(this.addr,t),Xs(n,t)}}function TTt(r,t){const n=this.cache;if(t.x!==void 0)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(r.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(t.r!==void 0)(n[0]!==t.r||n[1]!==t.g||n[2]!==t.b)&&(r.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Ks(n,t))return;r.uniform3fv(this.addr,t),Xs(n,t)}}function CTt(r,t){const n=this.cache;if(t.x!==void 0)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(r.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Ks(n,t))return;r.uniform4fv(this.addr,t),Xs(n,t)}}function kTt(r,t){const n=this.cache,i=t.elements;if(i===void 0){if(Ks(n,t))return;r.uniformMatrix2fv(this.addr,!1,t),Xs(n,t)}else{if(Ks(n,i))return;$N.set(i),r.uniformMatrix2fv(this.addr,!1,$N),Xs(n,i)}}function $Tt(r,t){const n=this.cache,i=t.elements;if(i===void 0){if(Ks(n,t))return;r.uniformMatrix3fv(this.addr,!1,t),Xs(n,t)}else{if(Ks(n,i))return;kN.set(i),r.uniformMatrix3fv(this.addr,!1,kN),Xs(n,i)}}function ITt(r,t){const n=this.cache,i=t.elements;if(i===void 0){if(Ks(n,t))return;r.uniformMatrix4fv(this.addr,!1,t),Xs(n,t)}else{if(Ks(n,i))return;CN.set(i),r.uniformMatrix4fv(this.addr,!1,CN),Xs(n,i)}}function ETt(r,t){const n=this.cache;n[0]!==t&&(r.uniform1i(this.addr,t),n[0]=t)}function NTt(r,t){const n=this.cache;if(t.x!==void 0)(n[0]!==t.x||n[1]!==t.y)&&(r.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Ks(n,t))return;r.uniform2iv(this.addr,t),Xs(n,t)}}function ATt(r,t){const n=this.cache;if(t.x!==void 0)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(r.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Ks(n,t))return;r.uniform3iv(this.addr,t),Xs(n,t)}}function MTt(r,t){const n=this.cache;if(t.x!==void 0)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(r.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Ks(n,t))return;r.uniform4iv(this.addr,t),Xs(n,t)}}function DTt(r,t){const n=this.cache;n[0]!==t&&(r.uniform1ui(this.addr,t),n[0]=t)}function RTt(r,t){const n=this.cache;if(t.x!==void 0)(n[0]!==t.x||n[1]!==t.y)&&(r.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Ks(n,t))return;r.uniform2uiv(this.addr,t),Xs(n,t)}}function OTt(r,t){const n=this.cache;if(t.x!==void 0)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(r.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Ks(n,t))return;r.uniform3uiv(this.addr,t),Xs(n,t)}}function LTt(r,t){const n=this.cache;if(t.x!==void 0)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(r.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Ks(n,t))return;r.uniform4uiv(this.addr,t),Xs(n,t)}}function FTt(r,t,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(r.uniform1i(this.addr,o),i[0]=o),n.setTexture2D(t||UF,o)}function PTt(r,t,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(r.uniform1i(this.addr,o),i[0]=o),n.setTexture3D(t||GF,o)}function BTt(r,t,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(r.uniform1i(this.addr,o),i[0]=o),n.setTextureCube(t||HF,o)}function zTt(r,t,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(r.uniform1i(this.addr,o),i[0]=o),n.setTexture2DArray(t||WF,o)}function VTt(r){switch(r){case 5126:return STt;case 35664:return _Tt;case 35665:return TTt;case 35666:return CTt;case 35674:return kTt;case 35675:return $Tt;case 35676:return ITt;case 5124:case 35670:return ETt;case 35667:case 35671:return NTt;case 35668:case 35672:return ATt;case 35669:case 35673:return MTt;case 5125:return DTt;case 36294:return RTt;case 36295:return OTt;case 36296:return LTt;case 35678:case 36198:case 36298:case 36306:case 35682:return FTt;case 35679:case 36299:case 36307:return PTt;case 35680:case 36300:case 36308:case 36293:return BTt;case 36289:case 36303:case 36311:case 36292:return zTt}}function UTt(r,t){r.uniform1fv(this.addr,t)}function WTt(r,t){const n=Ef(t,this.size,2);r.uniform2fv(this.addr,n)}function GTt(r,t){const n=Ef(t,this.size,3);r.uniform3fv(this.addr,n)}function HTt(r,t){const n=Ef(t,this.size,4);r.uniform4fv(this.addr,n)}function jTt(r,t){const n=Ef(t,this.size,4);r.uniformMatrix2fv(this.addr,!1,n)}function qTt(r,t){const n=Ef(t,this.size,9);r.uniformMatrix3fv(this.addr,!1,n)}function KTt(r,t){const n=Ef(t,this.size,16);r.uniformMatrix4fv(this.addr,!1,n)}function XTt(r,t){r.uniform1iv(this.addr,t)}function YTt(r,t){r.uniform2iv(this.addr,t)}function ZTt(r,t){r.uniform3iv(this.addr,t)}function JTt(r,t){r.uniform4iv(this.addr,t)}function QTt(r,t){r.uniform1uiv(this.addr,t)}function tCt(r,t){r.uniform2uiv(this.addr,t)}function eCt(r,t){r.uniform3uiv(this.addr,t)}function nCt(r,t){r.uniform4uiv(this.addr,t)}function sCt(r,t,n){const i=this.cache,o=t.length,a=zy(n,o);Ks(i,a)||(r.uniform1iv(this.addr,a),Xs(i,a));for(let l=0;l!==o;++l)n.setTexture2D(t[l]||UF,a[l])}function rCt(r,t,n){const i=this.cache,o=t.length,a=zy(n,o);Ks(i,a)||(r.uniform1iv(this.addr,a),Xs(i,a));for(let l=0;l!==o;++l)n.setTexture3D(t[l]||GF,a[l])}function iCt(r,t,n){const i=this.cache,o=t.length,a=zy(n,o);Ks(i,a)||(r.uniform1iv(this.addr,a),Xs(i,a));for(let l=0;l!==o;++l)n.setTextureCube(t[l]||HF,a[l])}function oCt(r,t,n){const i=this.cache,o=t.length,a=zy(n,o);Ks(i,a)||(r.uniform1iv(this.addr,a),Xs(i,a));for(let l=0;l!==o;++l)n.setTexture2DArray(t[l]||WF,a[l])}function aCt(r){switch(r){case 5126:return UTt;case 35664:return WTt;case 35665:return GTt;case 35666:return HTt;case 35674:return jTt;case 35675:return qTt;case 35676:return KTt;case 5124:case 35670:return XTt;case 35667:case 35671:return YTt;case 35668:case 35672:return ZTt;case 35669:case 35673:return JTt;case 5125:return QTt;case 36294:return tCt;case 36295:return eCt;case 36296:return nCt;case 35678:case 36198:case 36298:case 36306:case 35682:return sCt;case 35679:case 36299:case 36307:return rCt;case 35680:case 36300:case 36308:case 36293:return iCt;case 36289:case 36303:case 36311:case 36292:return oCt}}class lCt{constructor(t,n,i){this.id=t,this.addr=i,this.cache=[],this.setValue=VTt(n.type)}}class cCt{constructor(t,n,i){this.id=t,this.addr=i,this.cache=[],this.size=n.size,this.setValue=aCt(n.type)}}class uCt{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,n,i){const o=this.seq;for(let a=0,l=o.length;a!==l;++a){const c=o[a];c.setValue(t,n[c.id],i)}}}const Cb=/(\w+)(\])?(\[|\.)?/g;function IN(r,t){r.seq.push(t),r.map[t.id]=t}function hCt(r,t,n){const i=r.name,o=i.length;for(Cb.lastIndex=0;;){const a=Cb.exec(i),l=Cb.lastIndex;let c=a[1];const u=a[2]==="]",h=a[3];if(u&&(c=c|0),h===void 0||h==="["&&l+2===o){IN(n,h===void 0?new lCt(c,r,t):new cCt(c,r,t));break}else{let f=n.map[c];f===void 0&&(f=new uCt(c),IN(n,f)),n=f}}}class I1{constructor(t,n){this.seq=[],this.map={};const i=t.getProgramParameter(n,35718);for(let o=0;o<i;++o){const a=t.getActiveUniform(n,o),l=t.getUniformLocation(n,a.name);hCt(a,l,this)}}setValue(t,n,i,o){const a=this.map[n];a!==void 0&&a.setValue(t,i,o)}setOptional(t,n,i){const o=n[i];o!==void 0&&this.setValue(t,i,o)}static upload(t,n,i,o){for(let a=0,l=n.length;a!==l;++a){const c=n[a],u=i[c.id];u.needsUpdate!==!1&&c.setValue(t,u.value,o)}}static seqWithValue(t,n){const i=[];for(let o=0,a=t.length;o!==a;++o){const l=t[o];l.id in n&&i.push(l)}return i}}function EN(r,t,n){const i=r.createShader(t);return r.shaderSource(i,n),r.compileShader(i),i}let dCt=0;function fCt(r,t){const n=r.split(`
`),i=[],o=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let l=o;l<a;l++){const c=l+1;i.push(`${c===t?">":" "} ${c}: ${n[l]}`)}return i.join(`
`)}function pCt(r){switch(r){case rh:return["Linear","( value )"];case Dn:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",r),["Linear","( value )"]}}function NN(r,t,n){const i=r.getShaderParameter(t,35713),o=r.getShaderInfoLog(t).trim();if(i&&o==="")return"";const a=/ERROR: 0:(\d+)/.exec(o);if(a){const l=parseInt(a[1]);return n.toUpperCase()+`

`+o+`

`+fCt(r.getShaderSource(t),l)}else return o}function mCt(r,t){const n=pCt(t);return"vec4 "+r+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function gCt(r,t){let n;switch(t){case bwt:n="Linear";break;case wwt:n="Reinhard";break;case Swt:n="OptimizedCineon";break;case _wt:n="ACESFilmic";break;case Twt:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+r+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function vCt(r){return[r.extensionDerivatives||r.envMapCubeUVHeight||r.bumpMap||r.tangentSpaceNormalMap||r.clearcoatNormalMap||r.flatShading||r.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(r.extensionFragDepth||r.logarithmicDepthBuffer)&&r.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",r.extensionDrawBuffers&&r.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(r.extensionShaderTextureLOD||r.envMap||r.transmission)&&r.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Cp).join(`
`)}function yCt(r){const t=[];for(const n in r){const i=r[n];i!==!1&&t.push("#define "+n+" "+i)}return t.join(`
`)}function xCt(r,t){const n={},i=r.getProgramParameter(t,35721);for(let o=0;o<i;o++){const a=r.getActiveAttrib(t,o),l=a.name;let c=1;a.type===35674&&(c=2),a.type===35675&&(c=3),a.type===35676&&(c=4),n[l]={type:a.type,location:r.getAttribLocation(t,l),locationSize:c}}return n}function Cp(r){return r!==""}function AN(r,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function MN(r,t){return r.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const bCt=/^[ \t]*#include +<([\w\d./]+)>/gm;function Mw(r){return r.replace(bCt,wCt)}function wCt(r,t){const n=an[t];if(n===void 0)throw new Error("Can not resolve #include <"+t+">");return Mw(n)}const SCt=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function DN(r){return r.replace(SCt,_Ct)}function _Ct(r,t,n,i){let o="";for(let a=parseInt(t);a<parseInt(n);a++)o+=i.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return o}function RN(r){let t="precision "+r.precision+` float;
precision `+r.precision+" int;";return r.precision==="highp"?t+=`
#define HIGH_PRECISION`:r.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function TCt(r){let t="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===bF?t="SHADOWMAP_TYPE_PCF":r.shadowMapType===J3t?t="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===Tp&&(t="SHADOWMAP_TYPE_VSM"),t}function CCt(r){let t="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case qd:case Kd:t="ENVMAP_TYPE_CUBE";break;case Fy:t="ENVMAP_TYPE_CUBE_UV";break}return t}function kCt(r){let t="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case Kd:t="ENVMAP_MODE_REFRACTION";break}return t}function $Ct(r){let t="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case _F:t="ENVMAP_BLENDING_MULTIPLY";break;case ywt:t="ENVMAP_BLENDING_MIX";break;case xwt:t="ENVMAP_BLENDING_ADD";break}return t}function ICt(r){const t=r.envMapCubeUVHeight;if(t===null)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),7*16)),texelHeight:i,maxMip:n}}function ECt(r,t,n,i){const o=r.getContext(),a=n.defines;let l=n.vertexShader,c=n.fragmentShader;const u=TCt(n),h=CCt(n),d=kCt(n),f=$Ct(n),p=ICt(n),m=n.isWebGL2?"":vCt(n),g=yCt(a),y=o.createProgram();let v,x,b=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(v=[g].filter(Cp).join(`
`),v.length>0&&(v+=`
`),x=[m,g].filter(Cp).join(`
`),x.length>0&&(x+=`
`)):(v=[RN(n),"#define SHADER_NAME "+n.shaderName,g,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Cp).join(`
`),x=[m,RN(n),"#define SHADER_NAME "+n.shaderName,g,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+d:"",n.envMap?"#define "+f:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==ml?"#define TONE_MAPPING":"",n.toneMapping!==ml?an.tonemapping_pars_fragment:"",n.toneMapping!==ml?gCt("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",an.encodings_pars_fragment,mCt("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(Cp).join(`
`)),l=Mw(l),l=AN(l,n),l=MN(l,n),c=Mw(c),c=AN(c,n),c=MN(c,n),l=DN(l),c=DN(c),n.isWebGL2&&n.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,x=["#define varying in",n.glslVersion===rN?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===rN?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+x);const w=b+v+l,S=b+x+c,_=EN(o,35633,w),$=EN(o,35632,S);if(o.attachShader(y,_),o.attachShader(y,$),n.index0AttributeName!==void 0?o.bindAttribLocation(y,0,n.index0AttributeName):n.morphTargets===!0&&o.bindAttribLocation(y,0,"position"),o.linkProgram(y),r.debug.checkShaderErrors){const I=o.getProgramInfoLog(y).trim(),O=o.getShaderInfoLog(_).trim(),B=o.getShaderInfoLog($).trim();let F=!0,D=!0;if(o.getProgramParameter(y,35714)===!1){F=!1;const L=NN(o,_,"vertex"),V=NN(o,$,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(y,35715)+`

Program Info Log: `+I+`
`+L+`
`+V)}else I!==""?console.warn("THREE.WebGLProgram: Program Info Log:",I):(O===""||B==="")&&(D=!1);D&&(this.diagnostics={runnable:F,programLog:I,vertexShader:{log:O,prefix:v},fragmentShader:{log:B,prefix:x}})}o.deleteShader(_),o.deleteShader($);let N;this.getUniforms=function(){return N===void 0&&(N=new I1(o,y)),N};let k;return this.getAttributes=function(){return k===void 0&&(k=xCt(o,y)),k},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(y),this.program=void 0},this.name=n.shaderName,this.id=dCt++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=_,this.fragmentShader=$,this}let NCt=0;class ACt{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const n=t.vertexShader,i=t.fragmentShader,o=this._getShaderStage(n),a=this._getShaderStage(i),l=this._getShaderCacheForMaterial(t);return l.has(o)===!1&&(l.add(o),o.usedTimes++),l.has(a)===!1&&(l.add(a),a.usedTimes++),this}remove(t){const n=this.materialCache.get(t);for(const i of n)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const n=this.materialCache;let i=n.get(t);return i===void 0&&(i=new Set,n.set(t,i)),i}_getShaderStage(t){const n=this.shaderCache;let i=n.get(t);return i===void 0&&(i=new MCt(t),n.set(t,i)),i}}class MCt{constructor(t){this.id=NCt++,this.code=t,this.usedTimes=0}}function DCt(r,t,n,i,o,a,l){const c=new OF,u=new ACt,h=[],d=o.isWebGL2,f=o.logarithmicDepthBuffer,p=o.vertexTextures;let m=o.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function y(k,I,O,B,F){const D=B.fog,L=F.geometry,V=k.isMeshStandardMaterial?B.environment:null,j=(k.isMeshStandardMaterial?n:t).get(k.envMap||V),Y=j&&j.mapping===Fy?j.image.height:null,H=g[k.type];k.precision!==null&&(m=o.getMaxPrecision(k.precision),m!==k.precision&&console.warn("THREE.WebGLProgram.getParameters:",k.precision,"not supported, using",m,"instead."));const et=L.morphAttributes.position||L.morphAttributes.normal||L.morphAttributes.color,it=et!==void 0?et.length:0;let J=0;L.morphAttributes.position!==void 0&&(J=1),L.morphAttributes.normal!==void 0&&(J=2),L.morphAttributes.color!==void 0&&(J=3);let rt,ut,vt,bt;if(H){const Jt=Sa[H];rt=Jt.vertexShader,ut=Jt.fragmentShader}else rt=k.vertexShader,ut=k.fragmentShader,u.update(k),vt=u.getVertexShaderID(k),bt=u.getFragmentShaderID(k);const ht=r.getRenderTarget(),Wt=k.alphaTest>0,Dt=k.clearcoat>0,Vt=k.iridescence>0;return{isWebGL2:d,shaderID:H,shaderName:k.type,vertexShader:rt,fragmentShader:ut,defines:k.defines,customVertexShaderID:vt,customFragmentShaderID:bt,isRawShaderMaterial:k.isRawShaderMaterial===!0,glslVersion:k.glslVersion,precision:m,instancing:F.isInstancedMesh===!0,instancingColor:F.isInstancedMesh===!0&&F.instanceColor!==null,supportsVertexTextures:p,outputEncoding:ht===null?r.outputEncoding:ht.isXRRenderTarget===!0?ht.texture.encoding:rh,map:!!k.map,matcap:!!k.matcap,envMap:!!j,envMapMode:j&&j.mapping,envMapCubeUVHeight:Y,lightMap:!!k.lightMap,aoMap:!!k.aoMap,emissiveMap:!!k.emissiveMap,bumpMap:!!k.bumpMap,normalMap:!!k.normalMap,objectSpaceNormalMap:k.normalMapType===Gwt,tangentSpaceNormalMap:k.normalMapType===IF,decodeVideoTexture:!!k.map&&k.map.isVideoTexture===!0&&k.map.encoding===Dn,clearcoat:Dt,clearcoatMap:Dt&&!!k.clearcoatMap,clearcoatRoughnessMap:Dt&&!!k.clearcoatRoughnessMap,clearcoatNormalMap:Dt&&!!k.clearcoatNormalMap,iridescence:Vt,iridescenceMap:Vt&&!!k.iridescenceMap,iridescenceThicknessMap:Vt&&!!k.iridescenceThicknessMap,displacementMap:!!k.displacementMap,roughnessMap:!!k.roughnessMap,metalnessMap:!!k.metalnessMap,specularMap:!!k.specularMap,specularIntensityMap:!!k.specularIntensityMap,specularColorMap:!!k.specularColorMap,opaque:k.transparent===!1&&k.blending===Cd,alphaMap:!!k.alphaMap,alphaTest:Wt,gradientMap:!!k.gradientMap,sheen:k.sheen>0,sheenColorMap:!!k.sheenColorMap,sheenRoughnessMap:!!k.sheenRoughnessMap,transmission:k.transmission>0,transmissionMap:!!k.transmissionMap,thicknessMap:!!k.thicknessMap,combine:k.combine,vertexTangents:!!k.normalMap&&!!L.attributes.tangent,vertexColors:k.vertexColors,vertexAlphas:k.vertexColors===!0&&!!L.attributes.color&&L.attributes.color.itemSize===4,vertexUvs:!!k.map||!!k.bumpMap||!!k.normalMap||!!k.specularMap||!!k.alphaMap||!!k.emissiveMap||!!k.roughnessMap||!!k.metalnessMap||!!k.clearcoatMap||!!k.clearcoatRoughnessMap||!!k.clearcoatNormalMap||!!k.iridescenceMap||!!k.iridescenceThicknessMap||!!k.displacementMap||!!k.transmissionMap||!!k.thicknessMap||!!k.specularIntensityMap||!!k.specularColorMap||!!k.sheenColorMap||!!k.sheenRoughnessMap,uvsVertexOnly:!(k.map||k.bumpMap||k.normalMap||k.specularMap||k.alphaMap||k.emissiveMap||k.roughnessMap||k.metalnessMap||k.clearcoatNormalMap||k.iridescenceMap||k.iridescenceThicknessMap||k.transmission>0||k.transmissionMap||k.thicknessMap||k.specularIntensityMap||k.specularColorMap||k.sheen>0||k.sheenColorMap||k.sheenRoughnessMap)&&!!k.displacementMap,fog:!!D,useFog:k.fog===!0,fogExp2:D&&D.isFogExp2,flatShading:!!k.flatShading,sizeAttenuation:k.sizeAttenuation,logarithmicDepthBuffer:f,skinning:F.isSkinnedMesh===!0,morphTargets:L.morphAttributes.position!==void 0,morphNormals:L.morphAttributes.normal!==void 0,morphColors:L.morphAttributes.color!==void 0,morphTargetsCount:it,morphTextureStride:J,numDirLights:I.directional.length,numPointLights:I.point.length,numSpotLights:I.spot.length,numSpotLightMaps:I.spotLightMap.length,numRectAreaLights:I.rectArea.length,numHemiLights:I.hemi.length,numDirLightShadows:I.directionalShadowMap.length,numPointLightShadows:I.pointShadowMap.length,numSpotLightShadows:I.spotShadowMap.length,numSpotLightShadowsWithMaps:I.numSpotLightShadowsWithMaps,numClippingPlanes:l.numPlanes,numClipIntersection:l.numIntersection,dithering:k.dithering,shadowMapEnabled:r.shadowMap.enabled&&O.length>0,shadowMapType:r.shadowMap.type,toneMapping:k.toneMapped?r.toneMapping:ml,physicallyCorrectLights:r.physicallyCorrectLights,premultipliedAlpha:k.premultipliedAlpha,doubleSided:k.side===Ly,flipSided:k.side===go,useDepthPacking:!!k.depthPacking,depthPacking:k.depthPacking||0,index0AttributeName:k.index0AttributeName,extensionDerivatives:k.extensions&&k.extensions.derivatives,extensionFragDepth:k.extensions&&k.extensions.fragDepth,extensionDrawBuffers:k.extensions&&k.extensions.drawBuffers,extensionShaderTextureLOD:k.extensions&&k.extensions.shaderTextureLOD,rendererExtensionFragDepth:d||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:d||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:d||i.has("EXT_shader_texture_lod"),customProgramCacheKey:k.customProgramCacheKey()}}function v(k){const I=[];if(k.shaderID?I.push(k.shaderID):(I.push(k.customVertexShaderID),I.push(k.customFragmentShaderID)),k.defines!==void 0)for(const O in k.defines)I.push(O),I.push(k.defines[O]);return k.isRawShaderMaterial===!1&&(x(I,k),b(I,k),I.push(r.outputEncoding)),I.push(k.customProgramCacheKey),I.join()}function x(k,I){k.push(I.precision),k.push(I.outputEncoding),k.push(I.envMapMode),k.push(I.envMapCubeUVHeight),k.push(I.combine),k.push(I.vertexUvs),k.push(I.fogExp2),k.push(I.sizeAttenuation),k.push(I.morphTargetsCount),k.push(I.morphAttributeCount),k.push(I.numDirLights),k.push(I.numPointLights),k.push(I.numSpotLights),k.push(I.numSpotLightMaps),k.push(I.numHemiLights),k.push(I.numRectAreaLights),k.push(I.numDirLightShadows),k.push(I.numPointLightShadows),k.push(I.numSpotLightShadows),k.push(I.numSpotLightShadowsWithMaps),k.push(I.shadowMapType),k.push(I.toneMapping),k.push(I.numClippingPlanes),k.push(I.numClipIntersection),k.push(I.depthPacking)}function b(k,I){c.disableAll(),I.isWebGL2&&c.enable(0),I.supportsVertexTextures&&c.enable(1),I.instancing&&c.enable(2),I.instancingColor&&c.enable(3),I.map&&c.enable(4),I.matcap&&c.enable(5),I.envMap&&c.enable(6),I.lightMap&&c.enable(7),I.aoMap&&c.enable(8),I.emissiveMap&&c.enable(9),I.bumpMap&&c.enable(10),I.normalMap&&c.enable(11),I.objectSpaceNormalMap&&c.enable(12),I.tangentSpaceNormalMap&&c.enable(13),I.clearcoat&&c.enable(14),I.clearcoatMap&&c.enable(15),I.clearcoatRoughnessMap&&c.enable(16),I.clearcoatNormalMap&&c.enable(17),I.iridescence&&c.enable(18),I.iridescenceMap&&c.enable(19),I.iridescenceThicknessMap&&c.enable(20),I.displacementMap&&c.enable(21),I.specularMap&&c.enable(22),I.roughnessMap&&c.enable(23),I.metalnessMap&&c.enable(24),I.gradientMap&&c.enable(25),I.alphaMap&&c.enable(26),I.alphaTest&&c.enable(27),I.vertexColors&&c.enable(28),I.vertexAlphas&&c.enable(29),I.vertexUvs&&c.enable(30),I.vertexTangents&&c.enable(31),I.uvsVertexOnly&&c.enable(32),k.push(c.mask),c.disableAll(),I.fog&&c.enable(0),I.useFog&&c.enable(1),I.flatShading&&c.enable(2),I.logarithmicDepthBuffer&&c.enable(3),I.skinning&&c.enable(4),I.morphTargets&&c.enable(5),I.morphNormals&&c.enable(6),I.morphColors&&c.enable(7),I.premultipliedAlpha&&c.enable(8),I.shadowMapEnabled&&c.enable(9),I.physicallyCorrectLights&&c.enable(10),I.doubleSided&&c.enable(11),I.flipSided&&c.enable(12),I.useDepthPacking&&c.enable(13),I.dithering&&c.enable(14),I.specularIntensityMap&&c.enable(15),I.specularColorMap&&c.enable(16),I.transmission&&c.enable(17),I.transmissionMap&&c.enable(18),I.thicknessMap&&c.enable(19),I.sheen&&c.enable(20),I.sheenColorMap&&c.enable(21),I.sheenRoughnessMap&&c.enable(22),I.decodeVideoTexture&&c.enable(23),I.opaque&&c.enable(24),k.push(c.mask)}function w(k){const I=g[k.type];let O;if(I){const B=Sa[I];O=xSt.clone(B.uniforms)}else O=k.uniforms;return O}function S(k,I){let O;for(let B=0,F=h.length;B<F;B++){const D=h[B];if(D.cacheKey===I){O=D,++O.usedTimes;break}}return O===void 0&&(O=new ECt(r,I,k,a),h.push(O)),O}function _(k){if(--k.usedTimes===0){const I=h.indexOf(k);h[I]=h[h.length-1],h.pop(),k.destroy()}}function $(k){u.remove(k)}function N(){u.dispose()}return{getParameters:y,getProgramCacheKey:v,getUniforms:w,acquireProgram:S,releaseProgram:_,releaseShaderCache:$,programs:h,dispose:N}}function RCt(){let r=new WeakMap;function t(a){let l=r.get(a);return l===void 0&&(l={},r.set(a,l)),l}function n(a){r.delete(a)}function i(a,l,c){r.get(a)[l]=c}function o(){r=new WeakMap}return{get:t,remove:n,update:i,dispose:o}}function OCt(r,t){return r.groupOrder!==t.groupOrder?r.groupOrder-t.groupOrder:r.renderOrder!==t.renderOrder?r.renderOrder-t.renderOrder:r.material.id!==t.material.id?r.material.id-t.material.id:r.z!==t.z?r.z-t.z:r.id-t.id}function ON(r,t){return r.groupOrder!==t.groupOrder?r.groupOrder-t.groupOrder:r.renderOrder!==t.renderOrder?r.renderOrder-t.renderOrder:r.z!==t.z?t.z-r.z:r.id-t.id}function LN(){const r=[];let t=0;const n=[],i=[],o=[];function a(){t=0,n.length=0,i.length=0,o.length=0}function l(f,p,m,g,y,v){let x=r[t];return x===void 0?(x={id:f.id,object:f,geometry:p,material:m,groupOrder:g,renderOrder:f.renderOrder,z:y,group:v},r[t]=x):(x.id=f.id,x.object=f,x.geometry=p,x.material=m,x.groupOrder=g,x.renderOrder=f.renderOrder,x.z=y,x.group=v),t++,x}function c(f,p,m,g,y,v){const x=l(f,p,m,g,y,v);m.transmission>0?i.push(x):m.transparent===!0?o.push(x):n.push(x)}function u(f,p,m,g,y,v){const x=l(f,p,m,g,y,v);m.transmission>0?i.unshift(x):m.transparent===!0?o.unshift(x):n.unshift(x)}function h(f,p){n.length>1&&n.sort(f||OCt),i.length>1&&i.sort(p||ON),o.length>1&&o.sort(p||ON)}function d(){for(let f=t,p=r.length;f<p;f++){const m=r[f];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:n,transmissive:i,transparent:o,init:a,push:c,unshift:u,finish:d,sort:h}}function LCt(){let r=new WeakMap;function t(i,o){const a=r.get(i);let l;return a===void 0?(l=new LN,r.set(i,[l])):o>=a.length?(l=new LN,a.push(l)):l=a[o],l}function n(){r=new WeakMap}return{get:t,dispose:n}}function FCt(){const r={};return{get:function(t){if(r[t.id]!==void 0)return r[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new yt,color:new sn};break;case"SpotLight":n={position:new yt,direction:new yt,color:new sn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new yt,color:new sn,distance:0,decay:0};break;case"HemisphereLight":n={direction:new yt,skyColor:new sn,groundColor:new sn};break;case"RectAreaLight":n={color:new sn,position:new yt,halfWidth:new yt,halfHeight:new yt};break}return r[t.id]=n,n}}}function PCt(){const r={};return{get:function(t){if(r[t.id]!==void 0)return r[t.id];let n;switch(t.type){case"DirectionalLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $n};break;case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $n};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $n,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[t.id]=n,n}}}let BCt=0;function zCt(r,t){return(t.castShadow?2:0)-(r.castShadow?2:0)+(t.map?1:0)-(r.map?1:0)}function VCt(r,t){const n=new FCt,i=PCt(),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let d=0;d<9;d++)o.probe.push(new yt);const a=new yt,l=new pn,c=new pn;function u(d,f){let p=0,m=0,g=0;for(let B=0;B<9;B++)o.probe[B].set(0,0,0);let y=0,v=0,x=0,b=0,w=0,S=0,_=0,$=0,N=0,k=0;d.sort(zCt);const I=f!==!0?Math.PI:1;for(let B=0,F=d.length;B<F;B++){const D=d[B],L=D.color,V=D.intensity,j=D.distance,Y=D.shadow&&D.shadow.map?D.shadow.map.texture:null;if(D.isAmbientLight)p+=L.r*V*I,m+=L.g*V*I,g+=L.b*V*I;else if(D.isLightProbe)for(let H=0;H<9;H++)o.probe[H].addScaledVector(D.sh.coefficients[H],V);else if(D.isDirectionalLight){const H=n.get(D);if(H.color.copy(D.color).multiplyScalar(D.intensity*I),D.castShadow){const et=D.shadow,it=i.get(D);it.shadowBias=et.bias,it.shadowNormalBias=et.normalBias,it.shadowRadius=et.radius,it.shadowMapSize=et.mapSize,o.directionalShadow[y]=it,o.directionalShadowMap[y]=Y,o.directionalShadowMatrix[y]=D.shadow.matrix,S++}o.directional[y]=H,y++}else if(D.isSpotLight){const H=n.get(D);H.position.setFromMatrixPosition(D.matrixWorld),H.color.copy(L).multiplyScalar(V*I),H.distance=j,H.coneCos=Math.cos(D.angle),H.penumbraCos=Math.cos(D.angle*(1-D.penumbra)),H.decay=D.decay,o.spot[x]=H;const et=D.shadow;if(D.map&&(o.spotLightMap[N]=D.map,N++,et.updateMatrices(D),D.castShadow&&k++),o.spotLightMatrix[x]=et.matrix,D.castShadow){const it=i.get(D);it.shadowBias=et.bias,it.shadowNormalBias=et.normalBias,it.shadowRadius=et.radius,it.shadowMapSize=et.mapSize,o.spotShadow[x]=it,o.spotShadowMap[x]=Y,$++}x++}else if(D.isRectAreaLight){const H=n.get(D);H.color.copy(L).multiplyScalar(V),H.halfWidth.set(D.width*.5,0,0),H.halfHeight.set(0,D.height*.5,0),o.rectArea[b]=H,b++}else if(D.isPointLight){const H=n.get(D);if(H.color.copy(D.color).multiplyScalar(D.intensity*I),H.distance=D.distance,H.decay=D.decay,D.castShadow){const et=D.shadow,it=i.get(D);it.shadowBias=et.bias,it.shadowNormalBias=et.normalBias,it.shadowRadius=et.radius,it.shadowMapSize=et.mapSize,it.shadowCameraNear=et.camera.near,it.shadowCameraFar=et.camera.far,o.pointShadow[v]=it,o.pointShadowMap[v]=Y,o.pointShadowMatrix[v]=D.shadow.matrix,_++}o.point[v]=H,v++}else if(D.isHemisphereLight){const H=n.get(D);H.skyColor.copy(D.color).multiplyScalar(V*I),H.groundColor.copy(D.groundColor).multiplyScalar(V*I),o.hemi[w]=H,w++}}b>0&&(t.isWebGL2||r.has("OES_texture_float_linear")===!0?(o.rectAreaLTC1=ce.LTC_FLOAT_1,o.rectAreaLTC2=ce.LTC_FLOAT_2):r.has("OES_texture_half_float_linear")===!0?(o.rectAreaLTC1=ce.LTC_HALF_1,o.rectAreaLTC2=ce.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),o.ambient[0]=p,o.ambient[1]=m,o.ambient[2]=g;const O=o.hash;(O.directionalLength!==y||O.pointLength!==v||O.spotLength!==x||O.rectAreaLength!==b||O.hemiLength!==w||O.numDirectionalShadows!==S||O.numPointShadows!==_||O.numSpotShadows!==$||O.numSpotMaps!==N)&&(o.directional.length=y,o.spot.length=x,o.rectArea.length=b,o.point.length=v,o.hemi.length=w,o.directionalShadow.length=S,o.directionalShadowMap.length=S,o.pointShadow.length=_,o.pointShadowMap.length=_,o.spotShadow.length=$,o.spotShadowMap.length=$,o.directionalShadowMatrix.length=S,o.pointShadowMatrix.length=_,o.spotLightMatrix.length=$+N-k,o.spotLightMap.length=N,o.numSpotLightShadowsWithMaps=k,O.directionalLength=y,O.pointLength=v,O.spotLength=x,O.rectAreaLength=b,O.hemiLength=w,O.numDirectionalShadows=S,O.numPointShadows=_,O.numSpotShadows=$,O.numSpotMaps=N,o.version=BCt++)}function h(d,f){let p=0,m=0,g=0,y=0,v=0;const x=f.matrixWorldInverse;for(let b=0,w=d.length;b<w;b++){const S=d[b];if(S.isDirectionalLight){const _=o.directional[p];_.direction.setFromMatrixPosition(S.matrixWorld),a.setFromMatrixPosition(S.target.matrixWorld),_.direction.sub(a),_.direction.transformDirection(x),p++}else if(S.isSpotLight){const _=o.spot[g];_.position.setFromMatrixPosition(S.matrixWorld),_.position.applyMatrix4(x),_.direction.setFromMatrixPosition(S.matrixWorld),a.setFromMatrixPosition(S.target.matrixWorld),_.direction.sub(a),_.direction.transformDirection(x),g++}else if(S.isRectAreaLight){const _=o.rectArea[y];_.position.setFromMatrixPosition(S.matrixWorld),_.position.applyMatrix4(x),c.identity(),l.copy(S.matrixWorld),l.premultiply(x),c.extractRotation(l),_.halfWidth.set(S.width*.5,0,0),_.halfHeight.set(0,S.height*.5,0),_.halfWidth.applyMatrix4(c),_.halfHeight.applyMatrix4(c),y++}else if(S.isPointLight){const _=o.point[m];_.position.setFromMatrixPosition(S.matrixWorld),_.position.applyMatrix4(x),m++}else if(S.isHemisphereLight){const _=o.hemi[v];_.direction.setFromMatrixPosition(S.matrixWorld),_.direction.transformDirection(x),v++}}}return{setup:u,setupView:h,state:o}}function FN(r,t){const n=new VCt(r,t),i=[],o=[];function a(){i.length=0,o.length=0}function l(f){i.push(f)}function c(f){o.push(f)}function u(f){n.setup(i,f)}function h(f){n.setupView(i,f)}return{init:a,state:{lightsArray:i,shadowsArray:o,lights:n},setupLights:u,setupLightsView:h,pushLight:l,pushShadow:c}}function UCt(r,t){let n=new WeakMap;function i(a,l=0){const c=n.get(a);let u;return c===void 0?(u=new FN(r,t),n.set(a,[u])):l>=c.length?(u=new FN(r,t),c.push(u)):u=c[l],u}function o(){n=new WeakMap}return{get:i,dispose:o}}class WCt extends Oa{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Uwt,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class GCt extends Oa{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new yt,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const HCt=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,jCt=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function qCt(r,t,n){let i=new SC;const o=new $n,a=new $n,l=new Gn,c=new WCt({depthPacking:Wwt}),u=new GCt,h={},d=n.maxTextureSize,f={0:go,1:Ec,2:Ly},p=new oh({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new $n},radius:{value:4}},vertexShader:HCt,fragmentShader:jCt}),m=p.clone();m.defines.HORIZONTAL_PASS=1;const g=new ua;g.setAttribute("position",new ti(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new mi(g,p),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=bF,this.render=function(S,_,$){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||S.length===0)return;const N=r.getRenderTarget(),k=r.getActiveCubeFace(),I=r.getActiveMipmapLevel(),O=r.state;O.setBlending(pc),O.buffers.color.setClear(1,1,1,1),O.buffers.depth.setTest(!0),O.setScissorTest(!1);for(let B=0,F=S.length;B<F;B++){const D=S[B],L=D.shadow;if(L===void 0){console.warn("THREE.WebGLShadowMap:",D,"has no shadow.");continue}if(L.autoUpdate===!1&&L.needsUpdate===!1)continue;o.copy(L.mapSize);const V=L.getFrameExtents();if(o.multiply(V),a.copy(L.mapSize),(o.x>d||o.y>d)&&(o.x>d&&(a.x=Math.floor(d/V.x),o.x=a.x*V.x,L.mapSize.x=a.x),o.y>d&&(a.y=Math.floor(d/V.y),o.y=a.y*V.y,L.mapSize.y=a.y)),L.map===null){const Y=this.type!==Tp?{minFilter:rr,magFilter:rr}:{};L.map=new ih(o.x,o.y,Y),L.map.texture.name=D.name+".shadowMap",L.camera.updateProjectionMatrix()}r.setRenderTarget(L.map),r.clear();const j=L.getViewportCount();for(let Y=0;Y<j;Y++){const H=L.getViewport(Y);l.set(a.x*H.x,a.y*H.y,a.x*H.z,a.y*H.w),O.viewport(l),L.updateMatrices(D,Y),i=L.getFrustum(),w(_,$,L.camera,D,this.type)}L.isPointLightShadow!==!0&&this.type===Tp&&x(L,$),L.needsUpdate=!1}v.needsUpdate=!1,r.setRenderTarget(N,k,I)};function x(S,_){const $=t.update(y);p.defines.VSM_SAMPLES!==S.blurSamples&&(p.defines.VSM_SAMPLES=S.blurSamples,m.defines.VSM_SAMPLES=S.blurSamples,p.needsUpdate=!0,m.needsUpdate=!0),S.mapPass===null&&(S.mapPass=new ih(o.x,o.y)),p.uniforms.shadow_pass.value=S.map.texture,p.uniforms.resolution.value=S.mapSize,p.uniforms.radius.value=S.radius,r.setRenderTarget(S.mapPass),r.clear(),r.renderBufferDirect(_,null,$,p,y,null),m.uniforms.shadow_pass.value=S.mapPass.texture,m.uniforms.resolution.value=S.mapSize,m.uniforms.radius.value=S.radius,r.setRenderTarget(S.map),r.clear(),r.renderBufferDirect(_,null,$,m,y,null)}function b(S,_,$,N,k,I){let O=null;const B=$.isPointLight===!0?S.customDistanceMaterial:S.customDepthMaterial;if(B!==void 0)O=B;else if(O=$.isPointLight===!0?u:c,r.localClippingEnabled&&_.clipShadows===!0&&Array.isArray(_.clippingPlanes)&&_.clippingPlanes.length!==0||_.displacementMap&&_.displacementScale!==0||_.alphaMap&&_.alphaTest>0||_.map&&_.alphaTest>0){const F=O.uuid,D=_.uuid;let L=h[F];L===void 0&&(L={},h[F]=L);let V=L[D];V===void 0&&(V=O.clone(),L[D]=V),O=V}return O.visible=_.visible,O.wireframe=_.wireframe,I===Tp?O.side=_.shadowSide!==null?_.shadowSide:_.side:O.side=_.shadowSide!==null?_.shadowSide:f[_.side],O.alphaMap=_.alphaMap,O.alphaTest=_.alphaTest,O.map=_.map,O.clipShadows=_.clipShadows,O.clippingPlanes=_.clippingPlanes,O.clipIntersection=_.clipIntersection,O.displacementMap=_.displacementMap,O.displacementScale=_.displacementScale,O.displacementBias=_.displacementBias,O.wireframeLinewidth=_.wireframeLinewidth,O.linewidth=_.linewidth,$.isPointLight===!0&&O.isMeshDistanceMaterial===!0&&(O.referencePosition.setFromMatrixPosition($.matrixWorld),O.nearDistance=N,O.farDistance=k),O}function w(S,_,$,N,k){if(S.visible===!1)return;if(S.layers.test(_.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&k===Tp)&&(!S.frustumCulled||i.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices($.matrixWorldInverse,S.matrixWorld);const B=t.update(S),F=S.material;if(Array.isArray(F)){const D=B.groups;for(let L=0,V=D.length;L<V;L++){const j=D[L],Y=F[j.materialIndex];if(Y&&Y.visible){const H=b(S,Y,N,$.near,$.far,k);r.renderBufferDirect($,null,B,H,S,j)}}}else if(F.visible){const D=b(S,F,N,$.near,$.far,k);r.renderBufferDirect($,null,B,D,S,null)}}const O=S.children;for(let B=0,F=O.length;B<F;B++)w(O[B],_,$,N,k)}}function KCt(r,t,n){const i=n.isWebGL2;function o(){let lt=!1;const At=new Gn;let Yt=null;const le=new Gn(0,0,0,0);return{setMask:function(ve){Yt!==ve&&!lt&&(r.colorMask(ve,ve,ve,ve),Yt=ve)},setLocked:function(ve){lt=ve},setClear:function(ve,me,gs,vs,Wr){Wr===!0&&(ve*=vs,me*=vs,gs*=vs),At.set(ve,me,gs,vs),le.equals(At)===!1&&(r.clearColor(ve,me,gs,vs),le.copy(At))},reset:function(){lt=!1,Yt=null,le.set(-1,0,0,0)}}}function a(){let lt=!1,At=null,Yt=null,le=null;return{setTest:function(ve){ve?Wt(2929):Dt(2929)},setMask:function(ve){At!==ve&&!lt&&(r.depthMask(ve),At=ve)},setFunc:function(ve){if(Yt!==ve){switch(ve){case hwt:r.depthFunc(512);break;case dwt:r.depthFunc(519);break;case fwt:r.depthFunc(513);break;case Cw:r.depthFunc(515);break;case pwt:r.depthFunc(514);break;case mwt:r.depthFunc(518);break;case gwt:r.depthFunc(516);break;case vwt:r.depthFunc(517);break;default:r.depthFunc(515)}Yt=ve}},setLocked:function(ve){lt=ve},setClear:function(ve){le!==ve&&(r.clearDepth(ve),le=ve)},reset:function(){lt=!1,At=null,Yt=null,le=null}}}function l(){let lt=!1,At=null,Yt=null,le=null,ve=null,me=null,gs=null,vs=null,Wr=null;return{setTest:function(En){lt||(En?Wt(2960):Dt(2960))},setMask:function(En){At!==En&&!lt&&(r.stencilMask(En),At=En)},setFunc:function(En,Es,Ps){(Yt!==En||le!==Es||ve!==Ps)&&(r.stencilFunc(En,Es,Ps),Yt=En,le=Es,ve=Ps)},setOp:function(En,Es,Ps){(me!==En||gs!==Es||vs!==Ps)&&(r.stencilOp(En,Es,Ps),me=En,gs=Es,vs=Ps)},setLocked:function(En){lt=En},setClear:function(En){Wr!==En&&(r.clearStencil(En),Wr=En)},reset:function(){lt=!1,At=null,Yt=null,le=null,ve=null,me=null,gs=null,vs=null,Wr=null}}}const c=new o,u=new a,h=new l,d=new WeakMap,f=new WeakMap;let p={},m={},g=new WeakMap,y=[],v=null,x=!1,b=null,w=null,S=null,_=null,$=null,N=null,k=null,I=!1,O=null,B=null,F=null,D=null,L=null;const V=r.getParameter(35661);let j=!1,Y=0;const H=r.getParameter(7938);H.indexOf("WebGL")!==-1?(Y=parseFloat(/^WebGL (\d)/.exec(H)[1]),j=Y>=1):H.indexOf("OpenGL ES")!==-1&&(Y=parseFloat(/^OpenGL ES (\d)/.exec(H)[1]),j=Y>=2);let et=null,it={};const J=r.getParameter(3088),rt=r.getParameter(2978),ut=new Gn().fromArray(J),vt=new Gn().fromArray(rt);function bt(lt,At,Yt){const le=new Uint8Array(4),ve=r.createTexture();r.bindTexture(lt,ve),r.texParameteri(lt,10241,9728),r.texParameteri(lt,10240,9728);for(let me=0;me<Yt;me++)r.texImage2D(At+me,0,6408,1,1,0,6408,5121,le);return ve}const ht={};ht[3553]=bt(3553,3553,1),ht[34067]=bt(34067,34069,6),c.setClear(0,0,0,1),u.setClear(1),h.setClear(0),Wt(2929),u.setFunc(Cw),Ee(!1),We(IE),Wt(2884),Oe(pc);function Wt(lt){p[lt]!==!0&&(r.enable(lt),p[lt]=!0)}function Dt(lt){p[lt]!==!1&&(r.disable(lt),p[lt]=!1)}function Vt(lt,At){return m[lt]!==At?(r.bindFramebuffer(lt,At),m[lt]=At,i&&(lt===36009&&(m[36160]=At),lt===36160&&(m[36009]=At)),!0):!1}function zt(lt,At){let Yt=y,le=!1;if(lt)if(Yt=g.get(At),Yt===void 0&&(Yt=[],g.set(At,Yt)),lt.isWebGLMultipleRenderTargets){const ve=lt.texture;if(Yt.length!==ve.length||Yt[0]!==36064){for(let me=0,gs=ve.length;me<gs;me++)Yt[me]=36064+me;Yt.length=ve.length,le=!0}}else Yt[0]!==36064&&(Yt[0]=36064,le=!0);else Yt[0]!==1029&&(Yt[0]=1029,le=!0);le&&(n.isWebGL2?r.drawBuffers(Yt):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(Yt))}function Jt(lt){return v!==lt?(r.useProgram(lt),v=lt,!0):!1}const oe={[ld]:32774,[twt]:32778,[ewt]:32779};if(i)oe[ME]=32775,oe[DE]=32776;else{const lt=t.get("EXT_blend_minmax");lt!==null&&(oe[ME]=lt.MIN_EXT,oe[DE]=lt.MAX_EXT)}const ne={[nwt]:0,[swt]:1,[rwt]:768,[wF]:770,[uwt]:776,[lwt]:774,[owt]:772,[iwt]:769,[SF]:771,[cwt]:775,[awt]:773};function Oe(lt,At,Yt,le,ve,me,gs,vs){if(lt===pc){x===!0&&(Dt(3042),x=!1);return}if(x===!1&&(Wt(3042),x=!0),lt!==Q3t){if(lt!==b||vs!==I){if((w!==ld||$!==ld)&&(r.blendEquation(32774),w=ld,$=ld),vs)switch(lt){case Cd:r.blendFuncSeparate(1,771,1,771);break;case EE:r.blendFunc(1,1);break;case NE:r.blendFuncSeparate(0,769,0,1);break;case AE:r.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",lt);break}else switch(lt){case Cd:r.blendFuncSeparate(770,771,1,771);break;case EE:r.blendFunc(770,1);break;case NE:r.blendFuncSeparate(0,769,0,1);break;case AE:r.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",lt);break}S=null,_=null,N=null,k=null,b=lt,I=vs}return}ve=ve||At,me=me||Yt,gs=gs||le,(At!==w||ve!==$)&&(r.blendEquationSeparate(oe[At],oe[ve]),w=At,$=ve),(Yt!==S||le!==_||me!==N||gs!==k)&&(r.blendFuncSeparate(ne[Yt],ne[le],ne[me],ne[gs]),S=Yt,_=le,N=me,k=gs),b=lt,I=!1}function Ae(lt,At){lt.side===Ly?Dt(2884):Wt(2884);let Yt=lt.side===go;At&&(Yt=!Yt),Ee(Yt),lt.blending===Cd&&lt.transparent===!1?Oe(pc):Oe(lt.blending,lt.blendEquation,lt.blendSrc,lt.blendDst,lt.blendEquationAlpha,lt.blendSrcAlpha,lt.blendDstAlpha,lt.premultipliedAlpha),u.setFunc(lt.depthFunc),u.setTest(lt.depthTest),u.setMask(lt.depthWrite),c.setMask(lt.colorWrite);const le=lt.stencilWrite;h.setTest(le),le&&(h.setMask(lt.stencilWriteMask),h.setFunc(lt.stencilFunc,lt.stencilRef,lt.stencilFuncMask),h.setOp(lt.stencilFail,lt.stencilZFail,lt.stencilZPass)),Le(lt.polygonOffset,lt.polygonOffsetFactor,lt.polygonOffsetUnits),lt.alphaToCoverage===!0?Wt(32926):Dt(32926)}function Ee(lt){O!==lt&&(lt?r.frontFace(2304):r.frontFace(2305),O=lt)}function We(lt){lt!==Y3t?(Wt(2884),lt!==B&&(lt===IE?r.cullFace(1029):lt===Z3t?r.cullFace(1028):r.cullFace(1032))):Dt(2884),B=lt}function Ne(lt){lt!==F&&(j&&r.lineWidth(lt),F=lt)}function Le(lt,At,Yt){lt?(Wt(32823),(D!==At||L!==Yt)&&(r.polygonOffset(At,Yt),D=At,L=Yt)):Dt(32823)}function yn(lt){lt?Wt(3089):Dt(3089)}function Qe(lt){lt===void 0&&(lt=33984+V-1),et!==lt&&(r.activeTexture(lt),et=lt)}function Z(lt,At,Yt){Yt===void 0&&(et===null?Yt=33984+V-1:Yt=et);let le=it[Yt];le===void 0&&(le={type:void 0,texture:void 0},it[Yt]=le),(le.type!==lt||le.texture!==At)&&(et!==Yt&&(r.activeTexture(Yt),et=Yt),r.bindTexture(lt,At||ht[lt]),le.type=lt,le.texture=At)}function G(){const lt=it[et];lt!==void 0&&lt.type!==void 0&&(r.bindTexture(lt.type,null),lt.type=void 0,lt.texture=void 0)}function Et(){try{r.compressedTexImage2D.apply(r,arguments)}catch(lt){console.error("THREE.WebGLState:",lt)}}function jt(){try{r.compressedTexImage3D.apply(r,arguments)}catch(lt){console.error("THREE.WebGLState:",lt)}}function qt(){try{r.texSubImage2D.apply(r,arguments)}catch(lt){console.error("THREE.WebGLState:",lt)}}function te(){try{r.texSubImage3D.apply(r,arguments)}catch(lt){console.error("THREE.WebGLState:",lt)}}function ye(){try{r.compressedTexSubImage2D.apply(r,arguments)}catch(lt){console.error("THREE.WebGLState:",lt)}}function se(){try{r.compressedTexSubImage3D.apply(r,arguments)}catch(lt){console.error("THREE.WebGLState:",lt)}}function Lt(){try{r.texStorage2D.apply(r,arguments)}catch(lt){console.error("THREE.WebGLState:",lt)}}function ke(){try{r.texStorage3D.apply(r,arguments)}catch(lt){console.error("THREE.WebGLState:",lt)}}function Me(){try{r.texImage2D.apply(r,arguments)}catch(lt){console.error("THREE.WebGLState:",lt)}}function xe(){try{r.texImage3D.apply(r,arguments)}catch(lt){console.error("THREE.WebGLState:",lt)}}function ge(lt){ut.equals(lt)===!1&&(r.scissor(lt.x,lt.y,lt.z,lt.w),ut.copy(lt))}function ae(lt){vt.equals(lt)===!1&&(r.viewport(lt.x,lt.y,lt.z,lt.w),vt.copy(lt))}function De(lt,At){let Yt=f.get(At);Yt===void 0&&(Yt=new WeakMap,f.set(At,Yt));let le=Yt.get(lt);le===void 0&&(le=r.getUniformBlockIndex(At,lt.name),Yt.set(lt,le))}function tn(lt,At){const le=f.get(At).get(lt);d.get(At)!==le&&(r.uniformBlockBinding(At,le,lt.__bindingPointIndex),d.set(At,le))}function Yn(){r.disable(3042),r.disable(2884),r.disable(2929),r.disable(32823),r.disable(3089),r.disable(2960),r.disable(32926),r.blendEquation(32774),r.blendFunc(1,0),r.blendFuncSeparate(1,0,1,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(513),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(519,0,4294967295),r.stencilOp(7680,7680,7680),r.clearStencil(0),r.cullFace(1029),r.frontFace(2305),r.polygonOffset(0,0),r.activeTexture(33984),r.bindFramebuffer(36160,null),i===!0&&(r.bindFramebuffer(36009,null),r.bindFramebuffer(36008,null)),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),p={},et=null,it={},m={},g=new WeakMap,y=[],v=null,x=!1,b=null,w=null,S=null,_=null,$=null,N=null,k=null,I=!1,O=null,B=null,F=null,D=null,L=null,ut.set(0,0,r.canvas.width,r.canvas.height),vt.set(0,0,r.canvas.width,r.canvas.height),c.reset(),u.reset(),h.reset()}return{buffers:{color:c,depth:u,stencil:h},enable:Wt,disable:Dt,bindFramebuffer:Vt,drawBuffers:zt,useProgram:Jt,setBlending:Oe,setMaterial:Ae,setFlipSided:Ee,setCullFace:We,setLineWidth:Ne,setPolygonOffset:Le,setScissorTest:yn,activeTexture:Qe,bindTexture:Z,unbindTexture:G,compressedTexImage2D:Et,compressedTexImage3D:jt,texImage2D:Me,texImage3D:xe,updateUBOMapping:De,uniformBlockBinding:tn,texStorage2D:Lt,texStorage3D:ke,texSubImage2D:qt,texSubImage3D:te,compressedTexSubImage2D:ye,compressedTexSubImage3D:se,scissor:ge,viewport:ae,reset:Yn}}function XCt(r,t,n,i,o,a,l){const c=o.isWebGL2,u=o.maxTextures,h=o.maxCubemapSize,d=o.maxTextureSize,f=o.maxSamples,p=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,m=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),g=new WeakMap;let y;const v=new WeakMap;let x=!1;try{x=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function b(Z,G){return x?new OffscreenCanvas(Z,G):um("canvas")}function w(Z,G,Et,jt){let qt=1;if((Z.width>jt||Z.height>jt)&&(qt=jt/Math.max(Z.width,Z.height)),qt<1||G===!0)if(typeof HTMLImageElement<"u"&&Z instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Z instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Z instanceof ImageBitmap){const te=G?E2:Math.floor,ye=te(qt*Z.width),se=te(qt*Z.height);y===void 0&&(y=b(ye,se));const Lt=Et?b(ye,se):y;return Lt.width=ye,Lt.height=se,Lt.getContext("2d").drawImage(Z,0,0,ye,se),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Z.width+"x"+Z.height+") to ("+ye+"x"+se+")."),Lt}else return"data"in Z&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Z.width+"x"+Z.height+")."),Z;return Z}function S(Z){return Aw(Z.width)&&Aw(Z.height)}function _(Z){return c?!1:Z.wrapS!==io||Z.wrapT!==io||Z.minFilter!==rr&&Z.minFilter!==Mr}function $(Z,G){return Z.generateMipmaps&&G&&Z.minFilter!==rr&&Z.minFilter!==Mr}function N(Z){r.generateMipmap(Z)}function k(Z,G,Et,jt,qt=!1){if(c===!1)return G;if(Z!==null){if(r[Z]!==void 0)return r[Z];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Z+"'")}let te=G;return G===6403&&(Et===5126&&(te=33326),Et===5131&&(te=33325),Et===5121&&(te=33321)),G===33319&&(Et===5126&&(te=33328),Et===5131&&(te=33327),Et===5121&&(te=33323)),G===6408&&(Et===5126&&(te=34836),Et===5131&&(te=34842),Et===5121&&(te=jt===Dn&&qt===!1?35907:32856),Et===32819&&(te=32854),Et===32820&&(te=32855)),(te===33325||te===33326||te===33327||te===33328||te===34842||te===34836)&&t.get("EXT_color_buffer_float"),te}function I(Z,G,Et){return $(Z,Et)===!0||Z.isFramebufferTexture&&Z.minFilter!==rr&&Z.minFilter!==Mr?Math.log2(Math.max(G.width,G.height))+1:Z.mipmaps!==void 0&&Z.mipmaps.length>0?Z.mipmaps.length:Z.isCompressedTexture&&Array.isArray(Z.image)?G.mipmaps.length:1}function O(Z){return Z===rr||Z===Iw||Z===k1?9728:9729}function B(Z){const G=Z.target;G.removeEventListener("dispose",B),D(G),G.isVideoTexture&&g.delete(G)}function F(Z){const G=Z.target;G.removeEventListener("dispose",F),V(G)}function D(Z){const G=i.get(Z);if(G.__webglInit===void 0)return;const Et=Z.source,jt=v.get(Et);if(jt){const qt=jt[G.__cacheKey];qt.usedTimes--,qt.usedTimes===0&&L(Z),Object.keys(jt).length===0&&v.delete(Et)}i.remove(Z)}function L(Z){const G=i.get(Z);r.deleteTexture(G.__webglTexture);const Et=Z.source,jt=v.get(Et);delete jt[G.__cacheKey],l.memory.textures--}function V(Z){const G=Z.texture,Et=i.get(Z),jt=i.get(G);if(jt.__webglTexture!==void 0&&(r.deleteTexture(jt.__webglTexture),l.memory.textures--),Z.depthTexture&&Z.depthTexture.dispose(),Z.isWebGLCubeRenderTarget)for(let qt=0;qt<6;qt++)r.deleteFramebuffer(Et.__webglFramebuffer[qt]),Et.__webglDepthbuffer&&r.deleteRenderbuffer(Et.__webglDepthbuffer[qt]);else{if(r.deleteFramebuffer(Et.__webglFramebuffer),Et.__webglDepthbuffer&&r.deleteRenderbuffer(Et.__webglDepthbuffer),Et.__webglMultisampledFramebuffer&&r.deleteFramebuffer(Et.__webglMultisampledFramebuffer),Et.__webglColorRenderbuffer)for(let qt=0;qt<Et.__webglColorRenderbuffer.length;qt++)Et.__webglColorRenderbuffer[qt]&&r.deleteRenderbuffer(Et.__webglColorRenderbuffer[qt]);Et.__webglDepthRenderbuffer&&r.deleteRenderbuffer(Et.__webglDepthRenderbuffer)}if(Z.isWebGLMultipleRenderTargets)for(let qt=0,te=G.length;qt<te;qt++){const ye=i.get(G[qt]);ye.__webglTexture&&(r.deleteTexture(ye.__webglTexture),l.memory.textures--),i.remove(G[qt])}i.remove(G),i.remove(Z)}let j=0;function Y(){j=0}function H(){const Z=j;return Z>=u&&console.warn("THREE.WebGLTextures: Trying to use "+Z+" texture units while this GPU supports only "+u),j+=1,Z}function et(Z){const G=[];return G.push(Z.wrapS),G.push(Z.wrapT),G.push(Z.wrapR||0),G.push(Z.magFilter),G.push(Z.minFilter),G.push(Z.anisotropy),G.push(Z.internalFormat),G.push(Z.format),G.push(Z.type),G.push(Z.generateMipmaps),G.push(Z.premultiplyAlpha),G.push(Z.flipY),G.push(Z.unpackAlignment),G.push(Z.encoding),G.join()}function it(Z,G){const Et=i.get(Z);if(Z.isVideoTexture&&yn(Z),Z.isRenderTargetTexture===!1&&Z.version>0&&Et.__version!==Z.version){const jt=Z.image;if(jt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(jt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Dt(Et,Z,G);return}}n.bindTexture(3553,Et.__webglTexture,33984+G)}function J(Z,G){const Et=i.get(Z);if(Z.version>0&&Et.__version!==Z.version){Dt(Et,Z,G);return}n.bindTexture(35866,Et.__webglTexture,33984+G)}function rt(Z,G){const Et=i.get(Z);if(Z.version>0&&Et.__version!==Z.version){Dt(Et,Z,G);return}n.bindTexture(32879,Et.__webglTexture,33984+G)}function ut(Z,G){const Et=i.get(Z);if(Z.version>0&&Et.__version!==Z.version){Vt(Et,Z,G);return}n.bindTexture(34067,Et.__webglTexture,33984+G)}const vt={[Xd]:10497,[io]:33071,[I2]:33648},bt={[rr]:9728,[Iw]:9984,[k1]:9986,[Mr]:9729,[CF]:9985,[nh]:9987};function ht(Z,G,Et){if(Et?(r.texParameteri(Z,10242,vt[G.wrapS]),r.texParameteri(Z,10243,vt[G.wrapT]),(Z===32879||Z===35866)&&r.texParameteri(Z,32882,vt[G.wrapR]),r.texParameteri(Z,10240,bt[G.magFilter]),r.texParameteri(Z,10241,bt[G.minFilter])):(r.texParameteri(Z,10242,33071),r.texParameteri(Z,10243,33071),(Z===32879||Z===35866)&&r.texParameteri(Z,32882,33071),(G.wrapS!==io||G.wrapT!==io)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),r.texParameteri(Z,10240,O(G.magFilter)),r.texParameteri(Z,10241,O(G.minFilter)),G.minFilter!==rr&&G.minFilter!==Mr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){const jt=t.get("EXT_texture_filter_anisotropic");if(G.magFilter===rr||G.minFilter!==k1&&G.minFilter!==nh||G.type===ic&&t.has("OES_texture_float_linear")===!1||c===!1&&G.type===om&&t.has("OES_texture_half_float_linear")===!1)return;(G.anisotropy>1||i.get(G).__currentAnisotropy)&&(r.texParameterf(Z,jt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(G.anisotropy,o.getMaxAnisotropy())),i.get(G).__currentAnisotropy=G.anisotropy)}}function Wt(Z,G){let Et=!1;Z.__webglInit===void 0&&(Z.__webglInit=!0,G.addEventListener("dispose",B));const jt=G.source;let qt=v.get(jt);qt===void 0&&(qt={},v.set(jt,qt));const te=et(G);if(te!==Z.__cacheKey){qt[te]===void 0&&(qt[te]={texture:r.createTexture(),usedTimes:0},l.memory.textures++,Et=!0),qt[te].usedTimes++;const ye=qt[Z.__cacheKey];ye!==void 0&&(qt[Z.__cacheKey].usedTimes--,ye.usedTimes===0&&L(G)),Z.__cacheKey=te,Z.__webglTexture=qt[te].texture}return Et}function Dt(Z,G,Et){let jt=3553;(G.isDataArrayTexture||G.isCompressedArrayTexture)&&(jt=35866),G.isData3DTexture&&(jt=32879);const qt=Wt(Z,G),te=G.source;n.bindTexture(jt,Z.__webglTexture,33984+Et);const ye=i.get(te);if(te.version!==ye.__version||qt===!0){n.activeTexture(33984+Et),r.pixelStorei(37440,G.flipY),r.pixelStorei(37441,G.premultiplyAlpha),r.pixelStorei(3317,G.unpackAlignment),r.pixelStorei(37443,0);const se=_(G)&&S(G.image)===!1;let Lt=w(G.image,se,!1,d);Lt=Qe(G,Lt);const ke=S(Lt)||c,Me=a.convert(G.format,G.encoding);let xe=a.convert(G.type),ge=k(G.internalFormat,Me,xe,G.encoding,G.isVideoTexture);ht(jt,G,ke);let ae;const De=G.mipmaps,tn=c&&G.isVideoTexture!==!0,Yn=ye.__version===void 0||qt===!0,lt=I(G,Lt,ke);if(G.isDepthTexture)ge=6402,c?G.type===ic?ge=36012:G.type===Su?ge=33190:G.type===kd?ge=35056:ge=33189:G.type===ic&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),G.format===Ou&&ge===6402&&G.type!==kF&&G.type!==Su&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),G.type=Su,xe=a.convert(G.type)),G.format===Yd&&ge===6402&&(ge=34041,G.type!==kd&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),G.type=kd,xe=a.convert(G.type))),Yn&&(tn?n.texStorage2D(3553,1,ge,Lt.width,Lt.height):n.texImage2D(3553,0,ge,Lt.width,Lt.height,0,Me,xe,null));else if(G.isDataTexture)if(De.length>0&&ke){tn&&Yn&&n.texStorage2D(3553,lt,ge,De[0].width,De[0].height);for(let At=0,Yt=De.length;At<Yt;At++)ae=De[At],tn?n.texSubImage2D(3553,At,0,0,ae.width,ae.height,Me,xe,ae.data):n.texImage2D(3553,At,ge,ae.width,ae.height,0,Me,xe,ae.data);G.generateMipmaps=!1}else tn?(Yn&&n.texStorage2D(3553,lt,ge,Lt.width,Lt.height),n.texSubImage2D(3553,0,0,0,Lt.width,Lt.height,Me,xe,Lt.data)):n.texImage2D(3553,0,ge,Lt.width,Lt.height,0,Me,xe,Lt.data);else if(G.isCompressedTexture)if(G.isCompressedArrayTexture){tn&&Yn&&n.texStorage3D(35866,lt,ge,De[0].width,De[0].height,Lt.depth);for(let At=0,Yt=De.length;At<Yt;At++)ae=De[At],G.format!==oo?Me!==null?tn?n.compressedTexSubImage3D(35866,At,0,0,0,ae.width,ae.height,Lt.depth,Me,ae.data,0,0):n.compressedTexImage3D(35866,At,ge,ae.width,ae.height,Lt.depth,0,ae.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):tn?n.texSubImage3D(35866,At,0,0,0,ae.width,ae.height,Lt.depth,Me,xe,ae.data):n.texImage3D(35866,At,ge,ae.width,ae.height,Lt.depth,0,Me,xe,ae.data)}else{tn&&Yn&&n.texStorage2D(3553,lt,ge,De[0].width,De[0].height);for(let At=0,Yt=De.length;At<Yt;At++)ae=De[At],G.format!==oo?Me!==null?tn?n.compressedTexSubImage2D(3553,At,0,0,ae.width,ae.height,Me,ae.data):n.compressedTexImage2D(3553,At,ge,ae.width,ae.height,0,ae.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):tn?n.texSubImage2D(3553,At,0,0,ae.width,ae.height,Me,xe,ae.data):n.texImage2D(3553,At,ge,ae.width,ae.height,0,Me,xe,ae.data)}else if(G.isDataArrayTexture)tn?(Yn&&n.texStorage3D(35866,lt,ge,Lt.width,Lt.height,Lt.depth),n.texSubImage3D(35866,0,0,0,0,Lt.width,Lt.height,Lt.depth,Me,xe,Lt.data)):n.texImage3D(35866,0,ge,Lt.width,Lt.height,Lt.depth,0,Me,xe,Lt.data);else if(G.isData3DTexture)tn?(Yn&&n.texStorage3D(32879,lt,ge,Lt.width,Lt.height,Lt.depth),n.texSubImage3D(32879,0,0,0,0,Lt.width,Lt.height,Lt.depth,Me,xe,Lt.data)):n.texImage3D(32879,0,ge,Lt.width,Lt.height,Lt.depth,0,Me,xe,Lt.data);else if(G.isFramebufferTexture){if(Yn)if(tn)n.texStorage2D(3553,lt,ge,Lt.width,Lt.height);else{let At=Lt.width,Yt=Lt.height;for(let le=0;le<lt;le++)n.texImage2D(3553,le,ge,At,Yt,0,Me,xe,null),At>>=1,Yt>>=1}}else if(De.length>0&&ke){tn&&Yn&&n.texStorage2D(3553,lt,ge,De[0].width,De[0].height);for(let At=0,Yt=De.length;At<Yt;At++)ae=De[At],tn?n.texSubImage2D(3553,At,0,0,Me,xe,ae):n.texImage2D(3553,At,ge,Me,xe,ae);G.generateMipmaps=!1}else tn?(Yn&&n.texStorage2D(3553,lt,ge,Lt.width,Lt.height),n.texSubImage2D(3553,0,0,0,Me,xe,Lt)):n.texImage2D(3553,0,ge,Me,xe,Lt);$(G,ke)&&N(jt),ye.__version=te.version,G.onUpdate&&G.onUpdate(G)}Z.__version=G.version}function Vt(Z,G,Et){if(G.image.length!==6)return;const jt=Wt(Z,G),qt=G.source;n.bindTexture(34067,Z.__webglTexture,33984+Et);const te=i.get(qt);if(qt.version!==te.__version||jt===!0){n.activeTexture(33984+Et),r.pixelStorei(37440,G.flipY),r.pixelStorei(37441,G.premultiplyAlpha),r.pixelStorei(3317,G.unpackAlignment),r.pixelStorei(37443,0);const ye=G.isCompressedTexture||G.image[0].isCompressedTexture,se=G.image[0]&&G.image[0].isDataTexture,Lt=[];for(let At=0;At<6;At++)!ye&&!se?Lt[At]=w(G.image[At],!1,!0,h):Lt[At]=se?G.image[At].image:G.image[At],Lt[At]=Qe(G,Lt[At]);const ke=Lt[0],Me=S(ke)||c,xe=a.convert(G.format,G.encoding),ge=a.convert(G.type),ae=k(G.internalFormat,xe,ge,G.encoding),De=c&&G.isVideoTexture!==!0,tn=te.__version===void 0||jt===!0;let Yn=I(G,ke,Me);ht(34067,G,Me);let lt;if(ye){De&&tn&&n.texStorage2D(34067,Yn,ae,ke.width,ke.height);for(let At=0;At<6;At++){lt=Lt[At].mipmaps;for(let Yt=0;Yt<lt.length;Yt++){const le=lt[Yt];G.format!==oo?xe!==null?De?n.compressedTexSubImage2D(34069+At,Yt,0,0,le.width,le.height,xe,le.data):n.compressedTexImage2D(34069+At,Yt,ae,le.width,le.height,0,le.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):De?n.texSubImage2D(34069+At,Yt,0,0,le.width,le.height,xe,ge,le.data):n.texImage2D(34069+At,Yt,ae,le.width,le.height,0,xe,ge,le.data)}}}else{lt=G.mipmaps,De&&tn&&(lt.length>0&&Yn++,n.texStorage2D(34067,Yn,ae,Lt[0].width,Lt[0].height));for(let At=0;At<6;At++)if(se){De?n.texSubImage2D(34069+At,0,0,0,Lt[At].width,Lt[At].height,xe,ge,Lt[At].data):n.texImage2D(34069+At,0,ae,Lt[At].width,Lt[At].height,0,xe,ge,Lt[At].data);for(let Yt=0;Yt<lt.length;Yt++){const ve=lt[Yt].image[At].image;De?n.texSubImage2D(34069+At,Yt+1,0,0,ve.width,ve.height,xe,ge,ve.data):n.texImage2D(34069+At,Yt+1,ae,ve.width,ve.height,0,xe,ge,ve.data)}}else{De?n.texSubImage2D(34069+At,0,0,0,xe,ge,Lt[At]):n.texImage2D(34069+At,0,ae,xe,ge,Lt[At]);for(let Yt=0;Yt<lt.length;Yt++){const le=lt[Yt];De?n.texSubImage2D(34069+At,Yt+1,0,0,xe,ge,le.image[At]):n.texImage2D(34069+At,Yt+1,ae,xe,ge,le.image[At])}}}$(G,Me)&&N(34067),te.__version=qt.version,G.onUpdate&&G.onUpdate(G)}Z.__version=G.version}function zt(Z,G,Et,jt,qt){const te=a.convert(Et.format,Et.encoding),ye=a.convert(Et.type),se=k(Et.internalFormat,te,ye,Et.encoding);i.get(G).__hasExternalTextures||(qt===32879||qt===35866?n.texImage3D(qt,0,se,G.width,G.height,G.depth,0,te,ye,null):n.texImage2D(qt,0,se,G.width,G.height,0,te,ye,null)),n.bindFramebuffer(36160,Z),Le(G)?p.framebufferTexture2DMultisampleEXT(36160,jt,qt,i.get(Et).__webglTexture,0,Ne(G)):(qt===3553||qt>=34069&&qt<=34074)&&r.framebufferTexture2D(36160,jt,qt,i.get(Et).__webglTexture,0),n.bindFramebuffer(36160,null)}function Jt(Z,G,Et){if(r.bindRenderbuffer(36161,Z),G.depthBuffer&&!G.stencilBuffer){let jt=33189;if(Et||Le(G)){const qt=G.depthTexture;qt&&qt.isDepthTexture&&(qt.type===ic?jt=36012:qt.type===Su&&(jt=33190));const te=Ne(G);Le(G)?p.renderbufferStorageMultisampleEXT(36161,te,jt,G.width,G.height):r.renderbufferStorageMultisample(36161,te,jt,G.width,G.height)}else r.renderbufferStorage(36161,jt,G.width,G.height);r.framebufferRenderbuffer(36160,36096,36161,Z)}else if(G.depthBuffer&&G.stencilBuffer){const jt=Ne(G);Et&&Le(G)===!1?r.renderbufferStorageMultisample(36161,jt,35056,G.width,G.height):Le(G)?p.renderbufferStorageMultisampleEXT(36161,jt,35056,G.width,G.height):r.renderbufferStorage(36161,34041,G.width,G.height),r.framebufferRenderbuffer(36160,33306,36161,Z)}else{const jt=G.isWebGLMultipleRenderTargets===!0?G.texture:[G.texture];for(let qt=0;qt<jt.length;qt++){const te=jt[qt],ye=a.convert(te.format,te.encoding),se=a.convert(te.type),Lt=k(te.internalFormat,ye,se,te.encoding),ke=Ne(G);Et&&Le(G)===!1?r.renderbufferStorageMultisample(36161,ke,Lt,G.width,G.height):Le(G)?p.renderbufferStorageMultisampleEXT(36161,ke,Lt,G.width,G.height):r.renderbufferStorage(36161,Lt,G.width,G.height)}}r.bindRenderbuffer(36161,null)}function oe(Z,G){if(G&&G.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,Z),!(G.depthTexture&&G.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(G.depthTexture).__webglTexture||G.depthTexture.image.width!==G.width||G.depthTexture.image.height!==G.height)&&(G.depthTexture.image.width=G.width,G.depthTexture.image.height=G.height,G.depthTexture.needsUpdate=!0),it(G.depthTexture,0);const jt=i.get(G.depthTexture).__webglTexture,qt=Ne(G);if(G.depthTexture.format===Ou)Le(G)?p.framebufferTexture2DMultisampleEXT(36160,36096,3553,jt,0,qt):r.framebufferTexture2D(36160,36096,3553,jt,0);else if(G.depthTexture.format===Yd)Le(G)?p.framebufferTexture2DMultisampleEXT(36160,33306,3553,jt,0,qt):r.framebufferTexture2D(36160,33306,3553,jt,0);else throw new Error("Unknown depthTexture format")}function ne(Z){const G=i.get(Z),Et=Z.isWebGLCubeRenderTarget===!0;if(Z.depthTexture&&!G.__autoAllocateDepthBuffer){if(Et)throw new Error("target.depthTexture not supported in Cube render targets");oe(G.__webglFramebuffer,Z)}else if(Et){G.__webglDepthbuffer=[];for(let jt=0;jt<6;jt++)n.bindFramebuffer(36160,G.__webglFramebuffer[jt]),G.__webglDepthbuffer[jt]=r.createRenderbuffer(),Jt(G.__webglDepthbuffer[jt],Z,!1)}else n.bindFramebuffer(36160,G.__webglFramebuffer),G.__webglDepthbuffer=r.createRenderbuffer(),Jt(G.__webglDepthbuffer,Z,!1);n.bindFramebuffer(36160,null)}function Oe(Z,G,Et){const jt=i.get(Z);G!==void 0&&zt(jt.__webglFramebuffer,Z,Z.texture,36064,3553),Et!==void 0&&ne(Z)}function Ae(Z){const G=Z.texture,Et=i.get(Z),jt=i.get(G);Z.addEventListener("dispose",F),Z.isWebGLMultipleRenderTargets!==!0&&(jt.__webglTexture===void 0&&(jt.__webglTexture=r.createTexture()),jt.__version=G.version,l.memory.textures++);const qt=Z.isWebGLCubeRenderTarget===!0,te=Z.isWebGLMultipleRenderTargets===!0,ye=S(Z)||c;if(qt){Et.__webglFramebuffer=[];for(let se=0;se<6;se++)Et.__webglFramebuffer[se]=r.createFramebuffer()}else{if(Et.__webglFramebuffer=r.createFramebuffer(),te)if(o.drawBuffers){const se=Z.texture;for(let Lt=0,ke=se.length;Lt<ke;Lt++){const Me=i.get(se[Lt]);Me.__webglTexture===void 0&&(Me.__webglTexture=r.createTexture(),l.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(c&&Z.samples>0&&Le(Z)===!1){const se=te?G:[G];Et.__webglMultisampledFramebuffer=r.createFramebuffer(),Et.__webglColorRenderbuffer=[],n.bindFramebuffer(36160,Et.__webglMultisampledFramebuffer);for(let Lt=0;Lt<se.length;Lt++){const ke=se[Lt];Et.__webglColorRenderbuffer[Lt]=r.createRenderbuffer(),r.bindRenderbuffer(36161,Et.__webglColorRenderbuffer[Lt]);const Me=a.convert(ke.format,ke.encoding),xe=a.convert(ke.type),ge=k(ke.internalFormat,Me,xe,ke.encoding,Z.isXRRenderTarget===!0),ae=Ne(Z);r.renderbufferStorageMultisample(36161,ae,ge,Z.width,Z.height),r.framebufferRenderbuffer(36160,36064+Lt,36161,Et.__webglColorRenderbuffer[Lt])}r.bindRenderbuffer(36161,null),Z.depthBuffer&&(Et.__webglDepthRenderbuffer=r.createRenderbuffer(),Jt(Et.__webglDepthRenderbuffer,Z,!0)),n.bindFramebuffer(36160,null)}}if(qt){n.bindTexture(34067,jt.__webglTexture),ht(34067,G,ye);for(let se=0;se<6;se++)zt(Et.__webglFramebuffer[se],Z,G,36064,34069+se);$(G,ye)&&N(34067),n.unbindTexture()}else if(te){const se=Z.texture;for(let Lt=0,ke=se.length;Lt<ke;Lt++){const Me=se[Lt],xe=i.get(Me);n.bindTexture(3553,xe.__webglTexture),ht(3553,Me,ye),zt(Et.__webglFramebuffer,Z,Me,36064+Lt,3553),$(Me,ye)&&N(3553)}n.unbindTexture()}else{let se=3553;(Z.isWebGL3DRenderTarget||Z.isWebGLArrayRenderTarget)&&(c?se=Z.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(se,jt.__webglTexture),ht(se,G,ye),zt(Et.__webglFramebuffer,Z,G,36064,se),$(G,ye)&&N(se),n.unbindTexture()}Z.depthBuffer&&ne(Z)}function Ee(Z){const G=S(Z)||c,Et=Z.isWebGLMultipleRenderTargets===!0?Z.texture:[Z.texture];for(let jt=0,qt=Et.length;jt<qt;jt++){const te=Et[jt];if($(te,G)){const ye=Z.isWebGLCubeRenderTarget?34067:3553,se=i.get(te).__webglTexture;n.bindTexture(ye,se),N(ye),n.unbindTexture()}}}function We(Z){if(c&&Z.samples>0&&Le(Z)===!1){const G=Z.isWebGLMultipleRenderTargets?Z.texture:[Z.texture],Et=Z.width,jt=Z.height;let qt=16384;const te=[],ye=Z.stencilBuffer?33306:36096,se=i.get(Z),Lt=Z.isWebGLMultipleRenderTargets===!0;if(Lt)for(let ke=0;ke<G.length;ke++)n.bindFramebuffer(36160,se.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(36160,36064+ke,36161,null),n.bindFramebuffer(36160,se.__webglFramebuffer),r.framebufferTexture2D(36009,36064+ke,3553,null,0);n.bindFramebuffer(36008,se.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,se.__webglFramebuffer);for(let ke=0;ke<G.length;ke++){te.push(36064+ke),Z.depthBuffer&&te.push(ye);const Me=se.__ignoreDepthValues!==void 0?se.__ignoreDepthValues:!1;if(Me===!1&&(Z.depthBuffer&&(qt|=256),Z.stencilBuffer&&(qt|=1024)),Lt&&r.framebufferRenderbuffer(36008,36064,36161,se.__webglColorRenderbuffer[ke]),Me===!0&&(r.invalidateFramebuffer(36008,[ye]),r.invalidateFramebuffer(36009,[ye])),Lt){const xe=i.get(G[ke]).__webglTexture;r.framebufferTexture2D(36009,36064,3553,xe,0)}r.blitFramebuffer(0,0,Et,jt,0,0,Et,jt,qt,9728),m&&r.invalidateFramebuffer(36008,te)}if(n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),Lt)for(let ke=0;ke<G.length;ke++){n.bindFramebuffer(36160,se.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(36160,36064+ke,36161,se.__webglColorRenderbuffer[ke]);const Me=i.get(G[ke]).__webglTexture;n.bindFramebuffer(36160,se.__webglFramebuffer),r.framebufferTexture2D(36009,36064+ke,3553,Me,0)}n.bindFramebuffer(36009,se.__webglMultisampledFramebuffer)}}function Ne(Z){return Math.min(f,Z.samples)}function Le(Z){const G=i.get(Z);return c&&Z.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&G.__useRenderToTexture!==!1}function yn(Z){const G=l.render.frame;g.get(Z)!==G&&(g.set(Z,G),Z.update())}function Qe(Z,G){const Et=Z.encoding,jt=Z.format,qt=Z.type;return Z.isCompressedTexture===!0||Z.isVideoTexture===!0||Z.format===Nw||Et!==rh&&(Et===Dn?c===!1?t.has("EXT_sRGB")===!0&&jt===oo?(Z.format=Nw,Z.minFilter=Mr,Z.generateMipmaps=!1):G=MF.sRGBToLinear(G):(jt!==oo||qt!==sh)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",Et)),G}this.allocateTextureUnit=H,this.resetTextureUnits=Y,this.setTexture2D=it,this.setTexture2DArray=J,this.setTexture3D=rt,this.setTextureCube=ut,this.rebindTextures=Oe,this.setupRenderTarget=Ae,this.updateRenderTargetMipmap=Ee,this.updateMultisampleRenderTarget=We,this.setupDepthRenderbuffer=ne,this.setupFrameBufferTexture=zt,this.useMultisampledRTT=Le}function YCt(r,t,n){const i=n.isWebGL2;function o(a,l=null){let c;if(a===sh)return 5121;if(a===Iwt)return 32819;if(a===Ewt)return 32820;if(a===Cwt)return 5120;if(a===kwt)return 5122;if(a===kF)return 5123;if(a===$wt)return 5124;if(a===Su)return 5125;if(a===ic)return 5126;if(a===om)return i?5131:(c=t.get("OES_texture_half_float"),c!==null?c.HALF_FLOAT_OES:null);if(a===Nwt)return 6406;if(a===oo)return 6408;if(a===Mwt)return 6409;if(a===Dwt)return 6410;if(a===Ou)return 6402;if(a===Yd)return 34041;if(a===Awt)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(a===Nw)return c=t.get("EXT_sRGB"),c!==null?c.SRGB_ALPHA_EXT:null;if(a===Rwt)return 6403;if(a===Owt)return 36244;if(a===Lwt)return 33319;if(a===Fwt)return 33320;if(a===Pwt)return 36249;if(a===Zx||a===Jx||a===Qx||a===tb)if(l===Dn)if(c=t.get("WEBGL_compressed_texture_s3tc_srgb"),c!==null){if(a===Zx)return c.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(a===Jx)return c.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(a===Qx)return c.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(a===tb)return c.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(c=t.get("WEBGL_compressed_texture_s3tc"),c!==null){if(a===Zx)return c.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===Jx)return c.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===Qx)return c.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===tb)return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(a===RE||a===OE||a===LE||a===FE)if(c=t.get("WEBGL_compressed_texture_pvrtc"),c!==null){if(a===RE)return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===OE)return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===LE)return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===FE)return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(a===Bwt)return c=t.get("WEBGL_compressed_texture_etc1"),c!==null?c.COMPRESSED_RGB_ETC1_WEBGL:null;if(a===PE||a===BE)if(c=t.get("WEBGL_compressed_texture_etc"),c!==null){if(a===PE)return l===Dn?c.COMPRESSED_SRGB8_ETC2:c.COMPRESSED_RGB8_ETC2;if(a===BE)return l===Dn?c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(a===zE||a===VE||a===UE||a===WE||a===GE||a===HE||a===jE||a===qE||a===KE||a===XE||a===YE||a===ZE||a===JE||a===QE)if(c=t.get("WEBGL_compressed_texture_astc"),c!==null){if(a===zE)return l===Dn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:c.COMPRESSED_RGBA_ASTC_4x4_KHR;if(a===VE)return l===Dn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:c.COMPRESSED_RGBA_ASTC_5x4_KHR;if(a===UE)return l===Dn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:c.COMPRESSED_RGBA_ASTC_5x5_KHR;if(a===WE)return l===Dn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:c.COMPRESSED_RGBA_ASTC_6x5_KHR;if(a===GE)return l===Dn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:c.COMPRESSED_RGBA_ASTC_6x6_KHR;if(a===HE)return l===Dn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:c.COMPRESSED_RGBA_ASTC_8x5_KHR;if(a===jE)return l===Dn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:c.COMPRESSED_RGBA_ASTC_8x6_KHR;if(a===qE)return l===Dn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:c.COMPRESSED_RGBA_ASTC_8x8_KHR;if(a===KE)return l===Dn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:c.COMPRESSED_RGBA_ASTC_10x5_KHR;if(a===XE)return l===Dn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:c.COMPRESSED_RGBA_ASTC_10x6_KHR;if(a===YE)return l===Dn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:c.COMPRESSED_RGBA_ASTC_10x8_KHR;if(a===ZE)return l===Dn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:c.COMPRESSED_RGBA_ASTC_10x10_KHR;if(a===JE)return l===Dn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:c.COMPRESSED_RGBA_ASTC_12x10_KHR;if(a===QE)return l===Dn?c.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:c.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(a===tN)if(c=t.get("EXT_texture_compression_bptc"),c!==null){if(a===tN)return l===Dn?c.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:c.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return a===kd?i?34042:(c=t.get("WEBGL_depth_texture"),c!==null?c.UNSIGNED_INT_24_8_WEBGL:null):r[a]!==void 0?r[a]:null}return{convert:o}}class ZCt extends hi{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class _u extends as{constructor(){super(),this.isGroup=!0,this.type="Group"}}const JCt={type:"move"};class kb{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new _u,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new _u,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new yt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new yt),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new _u,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new yt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new yt),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const n=this._hand;if(n)for(const i of t.hand.values())this._getHandJoint(n,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,n,i){let o=null,a=null,l=null;const c=this._targetRay,u=this._grip,h=this._hand;if(t&&n.session.visibilityState!=="visible-blurred"){if(h&&t.hand){l=!0;for(const y of t.hand.values()){const v=n.getJointPose(y,i),x=this._getHandJoint(h,y);v!==null&&(x.matrix.fromArray(v.transform.matrix),x.matrix.decompose(x.position,x.rotation,x.scale),x.jointRadius=v.radius),x.visible=v!==null}const d=h.joints["index-finger-tip"],f=h.joints["thumb-tip"],p=d.position.distanceTo(f.position),m=.02,g=.005;h.inputState.pinching&&p>m+g?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!h.inputState.pinching&&p<=m-g&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else u!==null&&t.gripSpace&&(a=n.getPose(t.gripSpace,i),a!==null&&(u.matrix.fromArray(a.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),a.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(a.linearVelocity)):u.hasLinearVelocity=!1,a.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(a.angularVelocity)):u.hasAngularVelocity=!1));c!==null&&(o=n.getPose(t.targetRaySpace,i),o===null&&a!==null&&(o=a),o!==null&&(c.matrix.fromArray(o.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),o.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(o.linearVelocity)):c.hasLinearVelocity=!1,o.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(o.angularVelocity)):c.hasAngularVelocity=!1,this.dispatchEvent(JCt)))}return c!==null&&(c.visible=o!==null),u!==null&&(u.visible=a!==null),h!==null&&(h.visible=l!==null),this}_getHandJoint(t,n){if(t.joints[n.jointName]===void 0){const i=new _u;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[n.jointName]=i,t.add(i)}return t.joints[n.jointName]}}class QCt extends lr{constructor(t,n,i,o,a,l,c,u,h,d){if(d=d!==void 0?d:Ou,d!==Ou&&d!==Yd)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&d===Ou&&(i=Su),i===void 0&&d===Yd&&(i=kd),super(null,o,a,l,c,u,d,i,h),this.isDepthTexture=!0,this.image={width:t,height:n},this.magFilter=c!==void 0?c:rr,this.minFilter=u!==void 0?u:rr,this.flipY=!1,this.generateMipmaps=!1}}class tkt extends $f{constructor(t,n){super();const i=this;let o=null,a=1,l=null,c="local-floor",u=null,h=null,d=null,f=null,p=null,m=null;const g=n.getContextAttributes();let y=null,v=null;const x=[],b=[],w=new Set,S=new Map,_=new hi;_.layers.enable(1),_.viewport=new Gn;const $=new hi;$.layers.enable(2),$.viewport=new Gn;const N=[_,$],k=new ZCt;k.layers.enable(1),k.layers.enable(2);let I=null,O=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(J){let rt=x[J];return rt===void 0&&(rt=new kb,x[J]=rt),rt.getTargetRaySpace()},this.getControllerGrip=function(J){let rt=x[J];return rt===void 0&&(rt=new kb,x[J]=rt),rt.getGripSpace()},this.getHand=function(J){let rt=x[J];return rt===void 0&&(rt=new kb,x[J]=rt),rt.getHandSpace()};function B(J){const rt=b.indexOf(J.inputSource);if(rt===-1)return;const ut=x[rt];ut!==void 0&&ut.dispatchEvent({type:J.type,data:J.inputSource})}function F(){o.removeEventListener("select",B),o.removeEventListener("selectstart",B),o.removeEventListener("selectend",B),o.removeEventListener("squeeze",B),o.removeEventListener("squeezestart",B),o.removeEventListener("squeezeend",B),o.removeEventListener("end",F),o.removeEventListener("inputsourceschange",D);for(let J=0;J<x.length;J++){const rt=b[J];rt!==null&&(b[J]=null,x[J].disconnect(rt))}I=null,O=null,t.setRenderTarget(y),p=null,f=null,d=null,o=null,v=null,it.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(J){a=J,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(J){c=J,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||l},this.setReferenceSpace=function(J){u=J},this.getBaseLayer=function(){return f!==null?f:p},this.getBinding=function(){return d},this.getFrame=function(){return m},this.getSession=function(){return o},this.setSession=async function(J){if(o=J,o!==null){if(y=t.getRenderTarget(),o.addEventListener("select",B),o.addEventListener("selectstart",B),o.addEventListener("selectend",B),o.addEventListener("squeeze",B),o.addEventListener("squeezestart",B),o.addEventListener("squeezeend",B),o.addEventListener("end",F),o.addEventListener("inputsourceschange",D),g.xrCompatible!==!0&&await n.makeXRCompatible(),o.renderState.layers===void 0||t.capabilities.isWebGL2===!1){const rt={antialias:o.renderState.layers===void 0?g.antialias:!0,alpha:g.alpha,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:a};p=new XRWebGLLayer(o,n,rt),o.updateRenderState({baseLayer:p}),v=new ih(p.framebufferWidth,p.framebufferHeight,{format:oo,type:sh,encoding:t.outputEncoding,stencilBuffer:g.stencil})}else{let rt=null,ut=null,vt=null;g.depth&&(vt=g.stencil?35056:33190,rt=g.stencil?Yd:Ou,ut=g.stencil?kd:Su);const bt={colorFormat:32856,depthFormat:vt,scaleFactor:a};d=new XRWebGLBinding(o,n),f=d.createProjectionLayer(bt),o.updateRenderState({layers:[f]}),v=new ih(f.textureWidth,f.textureHeight,{format:oo,type:sh,depthTexture:new QCt(f.textureWidth,f.textureHeight,ut,void 0,void 0,void 0,void 0,void 0,void 0,rt),stencilBuffer:g.stencil,encoding:t.outputEncoding,samples:g.antialias?4:0});const ht=t.properties.get(v);ht.__ignoreDepthValues=f.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(1),u=null,l=await o.requestReferenceSpace(c),it.setContext(o),it.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function D(J){for(let rt=0;rt<J.removed.length;rt++){const ut=J.removed[rt],vt=b.indexOf(ut);vt>=0&&(b[vt]=null,x[vt].disconnect(ut))}for(let rt=0;rt<J.added.length;rt++){const ut=J.added[rt];let vt=b.indexOf(ut);if(vt===-1){for(let ht=0;ht<x.length;ht++)if(ht>=b.length){b.push(ut),vt=ht;break}else if(b[ht]===null){b[ht]=ut,vt=ht;break}if(vt===-1)break}const bt=x[vt];bt&&bt.connect(ut)}}const L=new yt,V=new yt;function j(J,rt,ut){L.setFromMatrixPosition(rt.matrixWorld),V.setFromMatrixPosition(ut.matrixWorld);const vt=L.distanceTo(V),bt=rt.projectionMatrix.elements,ht=ut.projectionMatrix.elements,Wt=bt[14]/(bt[10]-1),Dt=bt[14]/(bt[10]+1),Vt=(bt[9]+1)/bt[5],zt=(bt[9]-1)/bt[5],Jt=(bt[8]-1)/bt[0],oe=(ht[8]+1)/ht[0],ne=Wt*Jt,Oe=Wt*oe,Ae=vt/(-Jt+oe),Ee=Ae*-Jt;rt.matrixWorld.decompose(J.position,J.quaternion,J.scale),J.translateX(Ee),J.translateZ(Ae),J.matrixWorld.compose(J.position,J.quaternion,J.scale),J.matrixWorldInverse.copy(J.matrixWorld).invert();const We=Wt+Ae,Ne=Dt+Ae,Le=ne-Ee,yn=Oe+(vt-Ee),Qe=Vt*Dt/Ne*We,Z=zt*Dt/Ne*We;J.projectionMatrix.makePerspective(Le,yn,Qe,Z,We,Ne)}function Y(J,rt){rt===null?J.matrixWorld.copy(J.matrix):J.matrixWorld.multiplyMatrices(rt.matrixWorld,J.matrix),J.matrixWorldInverse.copy(J.matrixWorld).invert()}this.updateCamera=function(J){if(o===null)return;k.near=$.near=_.near=J.near,k.far=$.far=_.far=J.far,(I!==k.near||O!==k.far)&&(o.updateRenderState({depthNear:k.near,depthFar:k.far}),I=k.near,O=k.far);const rt=J.parent,ut=k.cameras;Y(k,rt);for(let bt=0;bt<ut.length;bt++)Y(ut[bt],rt);k.matrixWorld.decompose(k.position,k.quaternion,k.scale),J.matrix.copy(k.matrix),J.matrix.decompose(J.position,J.quaternion,J.scale);const vt=J.children;for(let bt=0,ht=vt.length;bt<ht;bt++)vt[bt].updateMatrixWorld(!0);ut.length===2?j(k,_,$):k.projectionMatrix.copy(_.projectionMatrix)},this.getCamera=function(){return k},this.getFoveation=function(){if(f!==null)return f.fixedFoveation;if(p!==null)return p.fixedFoveation},this.setFoveation=function(J){f!==null&&(f.fixedFoveation=J),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=J)},this.getPlanes=function(){return w};let H=null;function et(J,rt){if(h=rt.getViewerPose(u||l),m=rt,h!==null){const ut=h.views;p!==null&&(t.setRenderTargetFramebuffer(v,p.framebuffer),t.setRenderTarget(v));let vt=!1;ut.length!==k.cameras.length&&(k.cameras.length=0,vt=!0);for(let bt=0;bt<ut.length;bt++){const ht=ut[bt];let Wt=null;if(p!==null)Wt=p.getViewport(ht);else{const Vt=d.getViewSubImage(f,ht);Wt=Vt.viewport,bt===0&&(t.setRenderTargetTextures(v,Vt.colorTexture,f.ignoreDepthValues?void 0:Vt.depthStencilTexture),t.setRenderTarget(v))}let Dt=N[bt];Dt===void 0&&(Dt=new hi,Dt.layers.enable(bt),Dt.viewport=new Gn,N[bt]=Dt),Dt.matrix.fromArray(ht.transform.matrix),Dt.projectionMatrix.fromArray(ht.projectionMatrix),Dt.viewport.set(Wt.x,Wt.y,Wt.width,Wt.height),bt===0&&k.matrix.copy(Dt.matrix),vt===!0&&k.cameras.push(Dt)}}for(let ut=0;ut<x.length;ut++){const vt=b[ut],bt=x[ut];vt!==null&&bt!==void 0&&bt.update(vt,rt,u||l)}if(H&&H(J,rt),rt.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:rt.detectedPlanes});let ut=null;for(const vt of w)rt.detectedPlanes.has(vt)||(ut===null&&(ut=[]),ut.push(vt));if(ut!==null)for(const vt of ut)w.delete(vt),S.delete(vt),i.dispatchEvent({type:"planeremoved",data:vt});for(const vt of rt.detectedPlanes)if(!w.has(vt))w.add(vt),S.set(vt,rt.lastChangedTime),i.dispatchEvent({type:"planeadded",data:vt});else{const bt=S.get(vt);vt.lastChangedTime>bt&&(S.set(vt,vt.lastChangedTime),i.dispatchEvent({type:"planechanged",data:vt}))}}m=null}const it=new VF;it.setAnimationLoop(et),this.setAnimationLoop=function(J){H=J},this.dispose=function(){}}}function ekt(r,t){function n(y,v){v.color.getRGB(y.fogColor.value,PF(r)),v.isFog?(y.fogNear.value=v.near,y.fogFar.value=v.far):v.isFogExp2&&(y.fogDensity.value=v.density)}function i(y,v,x,b,w){v.isMeshBasicMaterial||v.isMeshLambertMaterial?o(y,v):v.isMeshToonMaterial?(o(y,v),d(y,v)):v.isMeshPhongMaterial?(o(y,v),h(y,v)):v.isMeshStandardMaterial?(o(y,v),f(y,v),v.isMeshPhysicalMaterial&&p(y,v,w)):v.isMeshMatcapMaterial?(o(y,v),m(y,v)):v.isMeshDepthMaterial?o(y,v):v.isMeshDistanceMaterial?(o(y,v),g(y,v)):v.isMeshNormalMaterial?o(y,v):v.isLineBasicMaterial?(a(y,v),v.isLineDashedMaterial&&l(y,v)):v.isPointsMaterial?c(y,v,x,b):v.isSpriteMaterial?u(y,v):v.isShadowMaterial?(y.color.value.copy(v.color),y.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function o(y,v){y.opacity.value=v.opacity,v.color&&y.diffuse.value.copy(v.color),v.emissive&&y.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(y.map.value=v.map),v.alphaMap&&(y.alphaMap.value=v.alphaMap),v.bumpMap&&(y.bumpMap.value=v.bumpMap,y.bumpScale.value=v.bumpScale,v.side===go&&(y.bumpScale.value*=-1)),v.displacementMap&&(y.displacementMap.value=v.displacementMap,y.displacementScale.value=v.displacementScale,y.displacementBias.value=v.displacementBias),v.emissiveMap&&(y.emissiveMap.value=v.emissiveMap),v.normalMap&&(y.normalMap.value=v.normalMap,y.normalScale.value.copy(v.normalScale),v.side===go&&y.normalScale.value.negate()),v.specularMap&&(y.specularMap.value=v.specularMap),v.alphaTest>0&&(y.alphaTest.value=v.alphaTest);const x=t.get(v).envMap;if(x&&(y.envMap.value=x,y.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,y.reflectivity.value=v.reflectivity,y.ior.value=v.ior,y.refractionRatio.value=v.refractionRatio),v.lightMap){y.lightMap.value=v.lightMap;const S=r.physicallyCorrectLights!==!0?Math.PI:1;y.lightMapIntensity.value=v.lightMapIntensity*S}v.aoMap&&(y.aoMap.value=v.aoMap,y.aoMapIntensity.value=v.aoMapIntensity);let b;v.map?b=v.map:v.specularMap?b=v.specularMap:v.displacementMap?b=v.displacementMap:v.normalMap?b=v.normalMap:v.bumpMap?b=v.bumpMap:v.roughnessMap?b=v.roughnessMap:v.metalnessMap?b=v.metalnessMap:v.alphaMap?b=v.alphaMap:v.emissiveMap?b=v.emissiveMap:v.clearcoatMap?b=v.clearcoatMap:v.clearcoatNormalMap?b=v.clearcoatNormalMap:v.clearcoatRoughnessMap?b=v.clearcoatRoughnessMap:v.iridescenceMap?b=v.iridescenceMap:v.iridescenceThicknessMap?b=v.iridescenceThicknessMap:v.specularIntensityMap?b=v.specularIntensityMap:v.specularColorMap?b=v.specularColorMap:v.transmissionMap?b=v.transmissionMap:v.thicknessMap?b=v.thicknessMap:v.sheenColorMap?b=v.sheenColorMap:v.sheenRoughnessMap&&(b=v.sheenRoughnessMap),b!==void 0&&(b.isWebGLRenderTarget&&(b=b.texture),b.matrixAutoUpdate===!0&&b.updateMatrix(),y.uvTransform.value.copy(b.matrix));let w;v.aoMap?w=v.aoMap:v.lightMap&&(w=v.lightMap),w!==void 0&&(w.isWebGLRenderTarget&&(w=w.texture),w.matrixAutoUpdate===!0&&w.updateMatrix(),y.uv2Transform.value.copy(w.matrix))}function a(y,v){y.diffuse.value.copy(v.color),y.opacity.value=v.opacity}function l(y,v){y.dashSize.value=v.dashSize,y.totalSize.value=v.dashSize+v.gapSize,y.scale.value=v.scale}function c(y,v,x,b){y.diffuse.value.copy(v.color),y.opacity.value=v.opacity,y.size.value=v.size*x,y.scale.value=b*.5,v.map&&(y.map.value=v.map),v.alphaMap&&(y.alphaMap.value=v.alphaMap),v.alphaTest>0&&(y.alphaTest.value=v.alphaTest);let w;v.map?w=v.map:v.alphaMap&&(w=v.alphaMap),w!==void 0&&(w.matrixAutoUpdate===!0&&w.updateMatrix(),y.uvTransform.value.copy(w.matrix))}function u(y,v){y.diffuse.value.copy(v.color),y.opacity.value=v.opacity,y.rotation.value=v.rotation,v.map&&(y.map.value=v.map),v.alphaMap&&(y.alphaMap.value=v.alphaMap),v.alphaTest>0&&(y.alphaTest.value=v.alphaTest);let x;v.map?x=v.map:v.alphaMap&&(x=v.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),y.uvTransform.value.copy(x.matrix))}function h(y,v){y.specular.value.copy(v.specular),y.shininess.value=Math.max(v.shininess,1e-4)}function d(y,v){v.gradientMap&&(y.gradientMap.value=v.gradientMap)}function f(y,v){y.roughness.value=v.roughness,y.metalness.value=v.metalness,v.roughnessMap&&(y.roughnessMap.value=v.roughnessMap),v.metalnessMap&&(y.metalnessMap.value=v.metalnessMap),t.get(v).envMap&&(y.envMapIntensity.value=v.envMapIntensity)}function p(y,v,x){y.ior.value=v.ior,v.sheen>0&&(y.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),y.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(y.sheenColorMap.value=v.sheenColorMap),v.sheenRoughnessMap&&(y.sheenRoughnessMap.value=v.sheenRoughnessMap)),v.clearcoat>0&&(y.clearcoat.value=v.clearcoat,y.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(y.clearcoatMap.value=v.clearcoatMap),v.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap),v.clearcoatNormalMap&&(y.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),y.clearcoatNormalMap.value=v.clearcoatNormalMap,v.side===go&&y.clearcoatNormalScale.value.negate())),v.iridescence>0&&(y.iridescence.value=v.iridescence,y.iridescenceIOR.value=v.iridescenceIOR,y.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],y.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(y.iridescenceMap.value=v.iridescenceMap),v.iridescenceThicknessMap&&(y.iridescenceThicknessMap.value=v.iridescenceThicknessMap)),v.transmission>0&&(y.transmission.value=v.transmission,y.transmissionSamplerMap.value=x.texture,y.transmissionSamplerSize.value.set(x.width,x.height),v.transmissionMap&&(y.transmissionMap.value=v.transmissionMap),y.thickness.value=v.thickness,v.thicknessMap&&(y.thicknessMap.value=v.thicknessMap),y.attenuationDistance.value=v.attenuationDistance,y.attenuationColor.value.copy(v.attenuationColor)),y.specularIntensity.value=v.specularIntensity,y.specularColor.value.copy(v.specularColor),v.specularIntensityMap&&(y.specularIntensityMap.value=v.specularIntensityMap),v.specularColorMap&&(y.specularColorMap.value=v.specularColorMap)}function m(y,v){v.matcap&&(y.matcap.value=v.matcap)}function g(y,v){y.referencePosition.value.copy(v.referencePosition),y.nearDistance.value=v.nearDistance,y.farDistance.value=v.farDistance}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function nkt(r,t,n,i){let o={},a={},l=[];const c=n.isWebGL2?r.getParameter(35375):0;function u(b,w){const S=w.program;i.uniformBlockBinding(b,S)}function h(b,w){let S=o[b.id];S===void 0&&(g(b),S=d(b),o[b.id]=S,b.addEventListener("dispose",v));const _=w.program;i.updateUBOMapping(b,_);const $=t.render.frame;a[b.id]!==$&&(p(b),a[b.id]=$)}function d(b){const w=f();b.__bindingPointIndex=w;const S=r.createBuffer(),_=b.__size,$=b.usage;return r.bindBuffer(35345,S),r.bufferData(35345,_,$),r.bindBuffer(35345,null),r.bindBufferBase(35345,w,S),S}function f(){for(let b=0;b<c;b++)if(l.indexOf(b)===-1)return l.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function p(b){const w=o[b.id],S=b.uniforms,_=b.__cache;r.bindBuffer(35345,w);for(let $=0,N=S.length;$<N;$++){const k=S[$];if(m(k,$,_)===!0){const I=k.__offset,O=Array.isArray(k.value)?k.value:[k.value];let B=0;for(let F=0;F<O.length;F++){const D=O[F],L=y(D);typeof D=="number"?(k.__data[0]=D,r.bufferSubData(35345,I+B,k.__data)):D.isMatrix3?(k.__data[0]=D.elements[0],k.__data[1]=D.elements[1],k.__data[2]=D.elements[2],k.__data[3]=D.elements[0],k.__data[4]=D.elements[3],k.__data[5]=D.elements[4],k.__data[6]=D.elements[5],k.__data[7]=D.elements[0],k.__data[8]=D.elements[6],k.__data[9]=D.elements[7],k.__data[10]=D.elements[8],k.__data[11]=D.elements[0]):(D.toArray(k.__data,B),B+=L.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(35345,I,k.__data)}}r.bindBuffer(35345,null)}function m(b,w,S){const _=b.value;if(S[w]===void 0){if(typeof _=="number")S[w]=_;else{const $=Array.isArray(_)?_:[_],N=[];for(let k=0;k<$.length;k++)N.push($[k].clone());S[w]=N}return!0}else if(typeof _=="number"){if(S[w]!==_)return S[w]=_,!0}else{const $=Array.isArray(S[w])?S[w]:[S[w]],N=Array.isArray(_)?_:[_];for(let k=0;k<$.length;k++){const I=$[k];if(I.equals(N[k])===!1)return I.copy(N[k]),!0}}return!1}function g(b){const w=b.uniforms;let S=0;const _=16;let $=0;for(let N=0,k=w.length;N<k;N++){const I=w[N],O={boundary:0,storage:0},B=Array.isArray(I.value)?I.value:[I.value];for(let F=0,D=B.length;F<D;F++){const L=B[F],V=y(L);O.boundary+=V.boundary,O.storage+=V.storage}if(I.__data=new Float32Array(O.storage/Float32Array.BYTES_PER_ELEMENT),I.__offset=S,N>0){$=S%_;const F=_-$;$!==0&&F-O.boundary<0&&(S+=_-$,I.__offset=S)}S+=O.storage}return $=S%_,$>0&&(S+=_-$),b.__size=S,b.__cache={},this}function y(b){const w={boundary:0,storage:0};return typeof b=="number"?(w.boundary=4,w.storage=4):b.isVector2?(w.boundary=8,w.storage=8):b.isVector3||b.isColor?(w.boundary=16,w.storage=12):b.isVector4?(w.boundary=16,w.storage=16):b.isMatrix3?(w.boundary=48,w.storage=48):b.isMatrix4?(w.boundary=64,w.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),w}function v(b){const w=b.target;w.removeEventListener("dispose",v);const S=l.indexOf(w.__bindingPointIndex);l.splice(S,1),r.deleteBuffer(o[w.id]),delete o[w.id],delete a[w.id]}function x(){for(const b in o)r.deleteBuffer(o[b]);l=[],o={},a={}}return{bind:u,update:h,dispose:x}}function skt(){const r=um("canvas");return r.style.display="block",r}function jF(r={}){this.isWebGLRenderer=!0;const t=r.canvas!==void 0?r.canvas:skt(),n=r.context!==void 0?r.context:null,i=r.depth!==void 0?r.depth:!0,o=r.stencil!==void 0?r.stencil:!0,a=r.antialias!==void 0?r.antialias:!1,l=r.premultipliedAlpha!==void 0?r.premultipliedAlpha:!0,c=r.preserveDrawingBuffer!==void 0?r.preserveDrawingBuffer:!1,u=r.powerPreference!==void 0?r.powerPreference:"default",h=r.failIfMajorPerformanceCaveat!==void 0?r.failIfMajorPerformanceCaveat:!1;let d;n!==null?d=n.getContextAttributes().alpha:d=r.alpha!==void 0?r.alpha:!1;let f=null,p=null;const m=[],g=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=rh,this.physicallyCorrectLights=!1,this.toneMapping=ml,this.toneMappingExposure=1;const y=this;let v=!1,x=0,b=0,w=null,S=-1,_=null;const $=new Gn,N=new Gn;let k=null,I=t.width,O=t.height,B=1,F=null,D=null;const L=new Gn(0,0,I,O),V=new Gn(0,0,I,O);let j=!1;const Y=new SC;let H=!1,et=!1,it=null;const J=new pn,rt=new $n,ut=new yt,vt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function bt(){return w===null?B:1}let ht=n;function Wt(q,St){for(let Mt=0;Mt<q.length;Mt++){const wt=q[Mt],Ft=t.getContext(wt,St);if(Ft!==null)return Ft}return null}try{const q={alpha:!0,depth:i,stencil:o,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${xC}`),t.addEventListener("webglcontextlost",ge,!1),t.addEventListener("webglcontextrestored",ae,!1),t.addEventListener("webglcontextcreationerror",De,!1),ht===null){const St=["webgl2","webgl","experimental-webgl"];if(y.isWebGL1Renderer===!0&&St.shift(),ht=Wt(St,q),ht===null)throw Wt(St)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}ht.getShaderPrecisionFormat===void 0&&(ht.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(q){throw console.error("THREE.WebGLRenderer: "+q.message),q}let Dt,Vt,zt,Jt,oe,ne,Oe,Ae,Ee,We,Ne,Le,yn,Qe,Z,G,Et,jt,qt,te,ye,se,Lt,ke;function Me(){Dt=new pTt(ht),Vt=new lTt(ht,Dt,r),Dt.init(Vt),se=new YCt(ht,Dt,Vt),zt=new KCt(ht,Dt,Vt),Jt=new vTt,oe=new RCt,ne=new XCt(ht,Dt,zt,oe,Vt,se,Jt),Oe=new uTt(y),Ae=new fTt(y),Ee=new kSt(ht,Vt),Lt=new oTt(ht,Dt,Ee,Vt),We=new mTt(ht,Ee,Jt,Lt),Ne=new wTt(ht,We,Ee,Jt),qt=new bTt(ht,Vt,ne),G=new cTt(oe),Le=new DCt(y,Oe,Ae,Dt,Vt,Lt,G),yn=new ekt(y,oe),Qe=new LCt,Z=new UCt(Dt,Vt),jt=new iTt(y,Oe,Ae,zt,Ne,d,l),Et=new qCt(y,Ne,Vt),ke=new nkt(ht,Jt,Vt,zt),te=new aTt(ht,Dt,Jt,Vt),ye=new gTt(ht,Dt,Jt,Vt),Jt.programs=Le.programs,y.capabilities=Vt,y.extensions=Dt,y.properties=oe,y.renderLists=Qe,y.shadowMap=Et,y.state=zt,y.info=Jt}Me();const xe=new tkt(y,ht);this.xr=xe,this.getContext=function(){return ht},this.getContextAttributes=function(){return ht.getContextAttributes()},this.forceContextLoss=function(){const q=Dt.get("WEBGL_lose_context");q&&q.loseContext()},this.forceContextRestore=function(){const q=Dt.get("WEBGL_lose_context");q&&q.restoreContext()},this.getPixelRatio=function(){return B},this.setPixelRatio=function(q){q!==void 0&&(B=q,this.setSize(I,O,!1))},this.getSize=function(q){return q.set(I,O)},this.setSize=function(q,St,Mt){if(xe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}I=q,O=St,t.width=Math.floor(q*B),t.height=Math.floor(St*B),Mt!==!1&&(t.style.width=q+"px",t.style.height=St+"px"),this.setViewport(0,0,q,St)},this.getDrawingBufferSize=function(q){return q.set(I*B,O*B).floor()},this.setDrawingBufferSize=function(q,St,Mt){I=q,O=St,B=Mt,t.width=Math.floor(q*Mt),t.height=Math.floor(St*Mt),this.setViewport(0,0,q,St)},this.getCurrentViewport=function(q){return q.copy($)},this.getViewport=function(q){return q.copy(L)},this.setViewport=function(q,St,Mt,wt){q.isVector4?L.set(q.x,q.y,q.z,q.w):L.set(q,St,Mt,wt),zt.viewport($.copy(L).multiplyScalar(B).floor())},this.getScissor=function(q){return q.copy(V)},this.setScissor=function(q,St,Mt,wt){q.isVector4?V.set(q.x,q.y,q.z,q.w):V.set(q,St,Mt,wt),zt.scissor(N.copy(V).multiplyScalar(B).floor())},this.getScissorTest=function(){return j},this.setScissorTest=function(q){zt.setScissorTest(j=q)},this.setOpaqueSort=function(q){F=q},this.setTransparentSort=function(q){D=q},this.getClearColor=function(q){return q.copy(jt.getClearColor())},this.setClearColor=function(){jt.setClearColor.apply(jt,arguments)},this.getClearAlpha=function(){return jt.getClearAlpha()},this.setClearAlpha=function(){jt.setClearAlpha.apply(jt,arguments)},this.clear=function(q=!0,St=!0,Mt=!0){let wt=0;q&&(wt|=16384),St&&(wt|=256),Mt&&(wt|=1024),ht.clear(wt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ge,!1),t.removeEventListener("webglcontextrestored",ae,!1),t.removeEventListener("webglcontextcreationerror",De,!1),Qe.dispose(),Z.dispose(),oe.dispose(),Oe.dispose(),Ae.dispose(),Ne.dispose(),Lt.dispose(),ke.dispose(),Le.dispose(),xe.dispose(),xe.removeEventListener("sessionstart",le),xe.removeEventListener("sessionend",ve),it&&(it.dispose(),it=null),me.stop()};function ge(q){q.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function ae(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;const q=Jt.autoReset,St=Et.enabled,Mt=Et.autoUpdate,wt=Et.needsUpdate,Ft=Et.type;Me(),Jt.autoReset=q,Et.enabled=St,Et.autoUpdate=Mt,Et.needsUpdate=wt,Et.type=Ft}function De(q){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",q.statusMessage)}function tn(q){const St=q.target;St.removeEventListener("dispose",tn),Yn(St)}function Yn(q){lt(q),oe.remove(q)}function lt(q){const St=oe.get(q).programs;St!==void 0&&(St.forEach(function(Mt){Le.releaseProgram(Mt)}),q.isShaderMaterial&&Le.releaseShaderCache(q))}this.renderBufferDirect=function(q,St,Mt,wt,Ft,Ce){St===null&&(St=vt);const Be=Ft.isMesh&&Ft.matrixWorld.determinant()<0,Ke=Gi(q,St,Mt,wt,Ft);zt.setMaterial(wt,Be);let Xe=Mt.index,fn=1;wt.wireframe===!0&&(Xe=We.getWireframeAttribute(Mt),fn=2);const Ye=Mt.drawRange,He=Mt.attributes.position;let ls=Ye.start*fn,mr=(Ye.start+Ye.count)*fn;Ce!==null&&(ls=Math.max(ls,Ce.start*fn),mr=Math.min(mr,(Ce.start+Ce.count)*fn)),Xe!==null?(ls=Math.max(ls,0),mr=Math.min(mr,Xe.count)):He!=null&&(ls=Math.max(ls,0),mr=Math.min(mr,He.count));const kr=mr-ls;if(kr<0||kr===1/0)return;Lt.setup(Ft,wt,Ke,Mt,Xe);let Hi,Zn=te;if(Xe!==null&&(Hi=Ee.get(Xe),Zn=ye,Zn.setIndex(Hi)),Ft.isMesh)wt.wireframe===!0?(zt.setLineWidth(wt.wireframeLinewidth*bt()),Zn.setMode(1)):Zn.setMode(4);else if(Ft.isLine){let en=wt.linewidth;en===void 0&&(en=1),zt.setLineWidth(en*bt()),Ft.isLineSegments?Zn.setMode(1):Ft.isLineLoop?Zn.setMode(2):Zn.setMode(3)}else Ft.isPoints?Zn.setMode(0):Ft.isSprite&&Zn.setMode(4);if(Ft.isInstancedMesh)Zn.renderInstances(ls,kr,Ft.count);else if(Mt.isInstancedBufferGeometry){const en=Mt._maxInstanceCount!==void 0?Mt._maxInstanceCount:1/0,Wa=Math.min(Mt.instanceCount,en);Zn.renderInstances(ls,kr,Wa)}else Zn.render(ls,kr)},this.compile=function(q,St){function Mt(wt,Ft,Ce){wt.transparent===!0&&wt.side===j0?(wt.side=go,wt.needsUpdate=!0,Ps(wt,Ft,Ce),wt.side=Ec,wt.needsUpdate=!0,Ps(wt,Ft,Ce),wt.side=j0):Ps(wt,Ft,Ce)}p=Z.get(q),p.init(),g.push(p),q.traverseVisible(function(wt){wt.isLight&&wt.layers.test(St.layers)&&(p.pushLight(wt),wt.castShadow&&p.pushShadow(wt))}),p.setupLights(y.physicallyCorrectLights),q.traverse(function(wt){const Ft=wt.material;if(Ft)if(Array.isArray(Ft))for(let Ce=0;Ce<Ft.length;Ce++){const Be=Ft[Ce];Mt(Be,q,wt)}else Mt(Ft,q,wt)}),g.pop(),p=null};let At=null;function Yt(q){At&&At(q)}function le(){me.stop()}function ve(){me.start()}const me=new VF;me.setAnimationLoop(Yt),typeof self<"u"&&me.setContext(self),this.setAnimationLoop=function(q){At=q,xe.setAnimationLoop(q),q===null?me.stop():me.start()},xe.addEventListener("sessionstart",le),xe.addEventListener("sessionend",ve),this.render=function(q,St){if(St!==void 0&&St.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;q.matrixWorldAutoUpdate===!0&&q.updateMatrixWorld(),St.parent===null&&St.matrixWorldAutoUpdate===!0&&St.updateMatrixWorld(),xe.enabled===!0&&xe.isPresenting===!0&&(xe.cameraAutoUpdate===!0&&xe.updateCamera(St),St=xe.getCamera()),q.isScene===!0&&q.onBeforeRender(y,q,St,w),p=Z.get(q,g.length),p.init(),g.push(p),J.multiplyMatrices(St.projectionMatrix,St.matrixWorldInverse),Y.setFromProjectionMatrix(J),et=this.localClippingEnabled,H=G.init(this.clippingPlanes,et,St),f=Qe.get(q,m.length),f.init(),m.push(f),gs(q,St,0,y.sortObjects),f.finish(),y.sortObjects===!0&&f.sort(F,D),H===!0&&G.beginShadows();const Mt=p.state.shadowsArray;if(Et.render(Mt,q,St),H===!0&&G.endShadows(),this.info.autoReset===!0&&this.info.reset(),jt.render(f,q),p.setupLights(y.physicallyCorrectLights),St.isArrayCamera){const wt=St.cameras;for(let Ft=0,Ce=wt.length;Ft<Ce;Ft++){const Be=wt[Ft];vs(f,q,Be,Be.viewport)}}else vs(f,q,St);w!==null&&(ne.updateMultisampleRenderTarget(w),ne.updateRenderTargetMipmap(w)),q.isScene===!0&&q.onAfterRender(y,q,St),Lt.resetDefaultState(),S=-1,_=null,g.pop(),g.length>0?p=g[g.length-1]:p=null,m.pop(),m.length>0?f=m[m.length-1]:f=null};function gs(q,St,Mt,wt){if(q.visible===!1)return;if(q.layers.test(St.layers)){if(q.isGroup)Mt=q.renderOrder;else if(q.isLOD)q.autoUpdate===!0&&q.update(St);else if(q.isLight)p.pushLight(q),q.castShadow&&p.pushShadow(q);else if(q.isSprite){if(!q.frustumCulled||Y.intersectsSprite(q)){wt&&ut.setFromMatrixPosition(q.matrixWorld).applyMatrix4(J);const Be=Ne.update(q),Ke=q.material;Ke.visible&&f.push(q,Be,Ke,Mt,ut.z,null)}}else if((q.isMesh||q.isLine||q.isPoints)&&(q.isSkinnedMesh&&q.skeleton.frame!==Jt.render.frame&&(q.skeleton.update(),q.skeleton.frame=Jt.render.frame),!q.frustumCulled||Y.intersectsObject(q))){wt&&ut.setFromMatrixPosition(q.matrixWorld).applyMatrix4(J);const Be=Ne.update(q),Ke=q.material;if(Array.isArray(Ke)){const Xe=Be.groups;for(let fn=0,Ye=Xe.length;fn<Ye;fn++){const He=Xe[fn],ls=Ke[He.materialIndex];ls&&ls.visible&&f.push(q,Be,ls,Mt,ut.z,He)}}else Ke.visible&&f.push(q,Be,Ke,Mt,ut.z,null)}}const Ce=q.children;for(let Be=0,Ke=Ce.length;Be<Ke;Be++)gs(Ce[Be],St,Mt,wt)}function vs(q,St,Mt,wt){const Ft=q.opaque,Ce=q.transmissive,Be=q.transparent;p.setupLightsView(Mt),Ce.length>0&&Wr(Ft,St,Mt),wt&&zt.viewport($.copy(wt)),Ft.length>0&&En(Ft,St,Mt),Ce.length>0&&En(Ce,St,Mt),Be.length>0&&En(Be,St,Mt),zt.buffers.depth.setTest(!0),zt.buffers.depth.setMask(!0),zt.buffers.color.setMask(!0),zt.setPolygonOffset(!1)}function Wr(q,St,Mt){const wt=Vt.isWebGL2;it===null&&(it=new ih(1,1,{generateMipmaps:!0,type:Dt.has("EXT_color_buffer_half_float")?om:sh,minFilter:nh,samples:wt&&a===!0?4:0})),y.getDrawingBufferSize(rt),wt?it.setSize(rt.x,rt.y):it.setSize(E2(rt.x),E2(rt.y));const Ft=y.getRenderTarget();y.setRenderTarget(it),y.clear();const Ce=y.toneMapping;y.toneMapping=ml,En(q,St,Mt),y.toneMapping=Ce,ne.updateMultisampleRenderTarget(it),ne.updateRenderTargetMipmap(it),y.setRenderTarget(Ft)}function En(q,St,Mt){const wt=St.isScene===!0?St.overrideMaterial:null;for(let Ft=0,Ce=q.length;Ft<Ce;Ft++){const Be=q[Ft],Ke=Be.object,Xe=Be.geometry,fn=wt===null?Be.material:wt,Ye=Be.group;Ke.layers.test(Mt.layers)&&Es(Ke,St,Mt,Xe,fn,Ye)}}function Es(q,St,Mt,wt,Ft,Ce){q.onBeforeRender(y,St,Mt,wt,Ft,Ce),q.modelViewMatrix.multiplyMatrices(Mt.matrixWorldInverse,q.matrixWorld),q.normalMatrix.getNormalMatrix(q.modelViewMatrix),Ft.onBeforeRender(y,St,Mt,wt,q,Ce),Ft.transparent===!0&&Ft.side===j0?(Ft.side=go,Ft.needsUpdate=!0,y.renderBufferDirect(Mt,St,wt,Ft,q,Ce),Ft.side=Ec,Ft.needsUpdate=!0,y.renderBufferDirect(Mt,St,wt,Ft,q,Ce),Ft.side=j0):y.renderBufferDirect(Mt,St,wt,Ft,q,Ce),q.onAfterRender(y,St,Mt,wt,Ft,Ce)}function Ps(q,St,Mt){St.isScene!==!0&&(St=vt);const wt=oe.get(q),Ft=p.state.lights,Ce=p.state.shadowsArray,Be=Ft.state.version,Ke=Le.getParameters(q,Ft.state,Ce,St,Mt),Xe=Le.getProgramCacheKey(Ke);let fn=wt.programs;wt.environment=q.isMeshStandardMaterial?St.environment:null,wt.fog=St.fog,wt.envMap=(q.isMeshStandardMaterial?Ae:Oe).get(q.envMap||wt.environment),fn===void 0&&(q.addEventListener("dispose",tn),fn=new Map,wt.programs=fn);let Ye=fn.get(Xe);if(Ye!==void 0){if(wt.currentProgram===Ye&&wt.lightsStateVersion===Be)return Cr(q,Ke),Ye}else Ke.uniforms=Le.getUniforms(q),q.onBuild(Mt,Ke,y),q.onBeforeCompile(Ke,y),Ye=Le.acquireProgram(Ke,Xe),fn.set(Xe,Ye),wt.uniforms=Ke.uniforms;const He=wt.uniforms;(!q.isShaderMaterial&&!q.isRawShaderMaterial||q.clipping===!0)&&(He.clippingPlanes=G.uniform),Cr(q,Ke),wt.needsLights=Of(q),wt.lightsStateVersion=Be,wt.needsLights&&(He.ambientLightColor.value=Ft.state.ambient,He.lightProbe.value=Ft.state.probe,He.directionalLights.value=Ft.state.directional,He.directionalLightShadows.value=Ft.state.directionalShadow,He.spotLights.value=Ft.state.spot,He.spotLightShadows.value=Ft.state.spotShadow,He.rectAreaLights.value=Ft.state.rectArea,He.ltc_1.value=Ft.state.rectAreaLTC1,He.ltc_2.value=Ft.state.rectAreaLTC2,He.pointLights.value=Ft.state.point,He.pointLightShadows.value=Ft.state.pointShadow,He.hemisphereLights.value=Ft.state.hemi,He.directionalShadowMap.value=Ft.state.directionalShadowMap,He.directionalShadowMatrix.value=Ft.state.directionalShadowMatrix,He.spotShadowMap.value=Ft.state.spotShadowMap,He.spotLightMatrix.value=Ft.state.spotLightMatrix,He.spotLightMap.value=Ft.state.spotLightMap,He.pointShadowMap.value=Ft.state.pointShadowMap,He.pointShadowMatrix.value=Ft.state.pointShadowMatrix);const ls=Ye.getUniforms(),mr=I1.seqWithValue(ls.seq,He);return wt.currentProgram=Ye,wt.uniformsList=mr,Ye}function Cr(q,St){const Mt=oe.get(q);Mt.outputEncoding=St.outputEncoding,Mt.instancing=St.instancing,Mt.skinning=St.skinning,Mt.morphTargets=St.morphTargets,Mt.morphNormals=St.morphNormals,Mt.morphColors=St.morphColors,Mt.morphTargetsCount=St.morphTargetsCount,Mt.numClippingPlanes=St.numClippingPlanes,Mt.numIntersection=St.numClipIntersection,Mt.vertexAlphas=St.vertexAlphas,Mt.vertexTangents=St.vertexTangents,Mt.toneMapping=St.toneMapping}function Gi(q,St,Mt,wt,Ft){St.isScene!==!0&&(St=vt),ne.resetTextureUnits();const Ce=St.fog,Be=wt.isMeshStandardMaterial?St.environment:null,Ke=w===null?y.outputEncoding:w.isXRRenderTarget===!0?w.texture.encoding:rh,Xe=(wt.isMeshStandardMaterial?Ae:Oe).get(wt.envMap||Be),fn=wt.vertexColors===!0&&!!Mt.attributes.color&&Mt.attributes.color.itemSize===4,Ye=!!wt.normalMap&&!!Mt.attributes.tangent,He=!!Mt.morphAttributes.position,ls=!!Mt.morphAttributes.normal,mr=!!Mt.morphAttributes.color,kr=wt.toneMapped?y.toneMapping:ml,Hi=Mt.morphAttributes.position||Mt.morphAttributes.normal||Mt.morphAttributes.color,Zn=Hi!==void 0?Hi.length:0,en=oe.get(wt),Wa=p.state.lights;if(H===!0&&(et===!0||q!==_)){const tr=q===_&&wt.id===S;G.setState(wt,q,tr)}let Jn=!1;wt.version===en.__version?(en.needsLights&&en.lightsStateVersion!==Wa.state.version||en.outputEncoding!==Ke||Ft.isInstancedMesh&&en.instancing===!1||!Ft.isInstancedMesh&&en.instancing===!0||Ft.isSkinnedMesh&&en.skinning===!1||!Ft.isSkinnedMesh&&en.skinning===!0||en.envMap!==Xe||wt.fog===!0&&en.fog!==Ce||en.numClippingPlanes!==void 0&&(en.numClippingPlanes!==G.numPlanes||en.numIntersection!==G.numIntersection)||en.vertexAlphas!==fn||en.vertexTangents!==Ye||en.morphTargets!==He||en.morphNormals!==ls||en.morphColors!==mr||en.toneMapping!==kr||Vt.isWebGL2===!0&&en.morphTargetsCount!==Zn)&&(Jn=!0):(Jn=!0,en.__version=wt.version);let $r=en.currentProgram;Jn===!0&&($r=Ps(wt,St,Ft));let Ir=!1,Ga=!1,Zc=!1;const Ns=$r.getUniforms(),Ti=en.uniforms;if(zt.useProgram($r.program)&&(Ir=!0,Ga=!0,Zc=!0),wt.id!==S&&(S=wt.id,Ga=!0),Ir||_!==q){if(Ns.setValue(ht,"projectionMatrix",q.projectionMatrix),Vt.logarithmicDepthBuffer&&Ns.setValue(ht,"logDepthBufFC",2/(Math.log(q.far+1)/Math.LN2)),_!==q&&(_=q,Ga=!0,Zc=!0),wt.isShaderMaterial||wt.isMeshPhongMaterial||wt.isMeshToonMaterial||wt.isMeshStandardMaterial||wt.envMap){const tr=Ns.map.cameraPosition;tr!==void 0&&tr.setValue(ht,ut.setFromMatrixPosition(q.matrixWorld))}(wt.isMeshPhongMaterial||wt.isMeshToonMaterial||wt.isMeshLambertMaterial||wt.isMeshBasicMaterial||wt.isMeshStandardMaterial||wt.isShaderMaterial)&&Ns.setValue(ht,"isOrthographic",q.isOrthographicCamera===!0),(wt.isMeshPhongMaterial||wt.isMeshToonMaterial||wt.isMeshLambertMaterial||wt.isMeshBasicMaterial||wt.isMeshStandardMaterial||wt.isShaderMaterial||wt.isShadowMaterial||Ft.isSkinnedMesh)&&Ns.setValue(ht,"viewMatrix",q.matrixWorldInverse)}if(Ft.isSkinnedMesh){Ns.setOptional(ht,Ft,"bindMatrix"),Ns.setOptional(ht,Ft,"bindMatrixInverse");const tr=Ft.skeleton;tr&&(Vt.floatVertexTextures?(tr.boneTexture===null&&tr.computeBoneTexture(),Ns.setValue(ht,"boneTexture",tr.boneTexture,ne),Ns.setValue(ht,"boneTextureSize",tr.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Qs=Mt.morphAttributes;if((Qs.position!==void 0||Qs.normal!==void 0||Qs.color!==void 0&&Vt.isWebGL2===!0)&&qt.update(Ft,Mt,wt,$r),(Ga||en.receiveShadow!==Ft.receiveShadow)&&(en.receiveShadow=Ft.receiveShadow,Ns.setValue(ht,"receiveShadow",Ft.receiveShadow)),wt.isMeshGouraudMaterial&&wt.envMap!==null&&(Ti.envMap.value=Xe,Ti.flipEnvMap.value=Xe.isCubeTexture&&Xe.isRenderTargetTexture===!1?-1:1),Ga&&(Ns.setValue(ht,"toneMappingExposure",y.toneMappingExposure),en.needsLights&&Nh(Ti,Zc),Ce&&wt.fog===!0&&yn.refreshFogUniforms(Ti,Ce),yn.refreshMaterialUniforms(Ti,wt,B,O,it),I1.upload(ht,en.uniformsList,Ti,ne)),wt.isShaderMaterial&&wt.uniformsNeedUpdate===!0&&(I1.upload(ht,en.uniformsList,Ti,ne),wt.uniformsNeedUpdate=!1),wt.isSpriteMaterial&&Ns.setValue(ht,"center",Ft.center),Ns.setValue(ht,"modelViewMatrix",Ft.modelViewMatrix),Ns.setValue(ht,"normalMatrix",Ft.normalMatrix),Ns.setValue(ht,"modelMatrix",Ft.matrixWorld),wt.isShaderMaterial||wt.isRawShaderMaterial){const tr=wt.uniformsGroups;for(let Ci=0,Ah=tr.length;Ci<Ah;Ci++)if(Vt.isWebGL2){const Ol=tr[Ci];ke.update(Ol,$r),ke.bind(Ol,$r)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return $r}function Nh(q,St){q.ambientLightColor.needsUpdate=St,q.lightProbe.needsUpdate=St,q.directionalLights.needsUpdate=St,q.directionalLightShadows.needsUpdate=St,q.pointLights.needsUpdate=St,q.pointLightShadows.needsUpdate=St,q.spotLights.needsUpdate=St,q.spotLightShadows.needsUpdate=St,q.rectAreaLights.needsUpdate=St,q.hemisphereLights.needsUpdate=St}function Of(q){return q.isMeshLambertMaterial||q.isMeshToonMaterial||q.isMeshPhongMaterial||q.isMeshStandardMaterial||q.isShadowMaterial||q.isShaderMaterial&&q.lights===!0}this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(q,St,Mt){oe.get(q.texture).__webglTexture=St,oe.get(q.depthTexture).__webglTexture=Mt;const wt=oe.get(q);wt.__hasExternalTextures=!0,wt.__hasExternalTextures&&(wt.__autoAllocateDepthBuffer=Mt===void 0,wt.__autoAllocateDepthBuffer||Dt.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),wt.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(q,St){const Mt=oe.get(q);Mt.__webglFramebuffer=St,Mt.__useDefaultFramebuffer=St===void 0},this.setRenderTarget=function(q,St=0,Mt=0){w=q,x=St,b=Mt;let wt=!0,Ft=null,Ce=!1,Be=!1;if(q){const Xe=oe.get(q);Xe.__useDefaultFramebuffer!==void 0?(zt.bindFramebuffer(36160,null),wt=!1):Xe.__webglFramebuffer===void 0?ne.setupRenderTarget(q):Xe.__hasExternalTextures&&ne.rebindTextures(q,oe.get(q.texture).__webglTexture,oe.get(q.depthTexture).__webglTexture);const fn=q.texture;(fn.isData3DTexture||fn.isDataArrayTexture||fn.isCompressedArrayTexture)&&(Be=!0);const Ye=oe.get(q).__webglFramebuffer;q.isWebGLCubeRenderTarget?(Ft=Ye[St],Ce=!0):Vt.isWebGL2&&q.samples>0&&ne.useMultisampledRTT(q)===!1?Ft=oe.get(q).__webglMultisampledFramebuffer:Ft=Ye,$.copy(q.viewport),N.copy(q.scissor),k=q.scissorTest}else $.copy(L).multiplyScalar(B).floor(),N.copy(V).multiplyScalar(B).floor(),k=j;if(zt.bindFramebuffer(36160,Ft)&&Vt.drawBuffers&&wt&&zt.drawBuffers(q,Ft),zt.viewport($),zt.scissor(N),zt.setScissorTest(k),Ce){const Xe=oe.get(q.texture);ht.framebufferTexture2D(36160,36064,34069+St,Xe.__webglTexture,Mt)}else if(Be){const Xe=oe.get(q.texture),fn=St||0;ht.framebufferTextureLayer(36160,36064,Xe.__webglTexture,Mt||0,fn)}S=-1},this.readRenderTargetPixels=function(q,St,Mt,wt,Ft,Ce,Be){if(!(q&&q.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ke=oe.get(q).__webglFramebuffer;if(q.isWebGLCubeRenderTarget&&Be!==void 0&&(Ke=Ke[Be]),Ke){zt.bindFramebuffer(36160,Ke);try{const Xe=q.texture,fn=Xe.format,Ye=Xe.type;if(fn!==oo&&se.convert(fn)!==ht.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const He=Ye===om&&(Dt.has("EXT_color_buffer_half_float")||Vt.isWebGL2&&Dt.has("EXT_color_buffer_float"));if(Ye!==sh&&se.convert(Ye)!==ht.getParameter(35738)&&!(Ye===ic&&(Vt.isWebGL2||Dt.has("OES_texture_float")||Dt.has("WEBGL_color_buffer_float")))&&!He){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}St>=0&&St<=q.width-wt&&Mt>=0&&Mt<=q.height-Ft&&ht.readPixels(St,Mt,wt,Ft,se.convert(fn),se.convert(Ye),Ce)}finally{const Xe=w!==null?oe.get(w).__webglFramebuffer:null;zt.bindFramebuffer(36160,Xe)}}},this.copyFramebufferToTexture=function(q,St,Mt=0){const wt=Math.pow(2,-Mt),Ft=Math.floor(St.image.width*wt),Ce=Math.floor(St.image.height*wt);ne.setTexture2D(St,0),ht.copyTexSubImage2D(3553,Mt,0,0,q.x,q.y,Ft,Ce),zt.unbindTexture()},this.copyTextureToTexture=function(q,St,Mt,wt=0){const Ft=St.image.width,Ce=St.image.height,Be=se.convert(Mt.format),Ke=se.convert(Mt.type);ne.setTexture2D(Mt,0),ht.pixelStorei(37440,Mt.flipY),ht.pixelStorei(37441,Mt.premultiplyAlpha),ht.pixelStorei(3317,Mt.unpackAlignment),St.isDataTexture?ht.texSubImage2D(3553,wt,q.x,q.y,Ft,Ce,Be,Ke,St.image.data):St.isCompressedTexture?ht.compressedTexSubImage2D(3553,wt,q.x,q.y,St.mipmaps[0].width,St.mipmaps[0].height,Be,St.mipmaps[0].data):ht.texSubImage2D(3553,wt,q.x,q.y,Be,Ke,St.image),wt===0&&Mt.generateMipmaps&&ht.generateMipmap(3553),zt.unbindTexture()},this.copyTextureToTexture3D=function(q,St,Mt,wt,Ft=0){if(y.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Ce=q.max.x-q.min.x+1,Be=q.max.y-q.min.y+1,Ke=q.max.z-q.min.z+1,Xe=se.convert(wt.format),fn=se.convert(wt.type);let Ye;if(wt.isData3DTexture)ne.setTexture3D(wt,0),Ye=32879;else if(wt.isDataArrayTexture)ne.setTexture2DArray(wt,0),Ye=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ht.pixelStorei(37440,wt.flipY),ht.pixelStorei(37441,wt.premultiplyAlpha),ht.pixelStorei(3317,wt.unpackAlignment);const He=ht.getParameter(3314),ls=ht.getParameter(32878),mr=ht.getParameter(3316),kr=ht.getParameter(3315),Hi=ht.getParameter(32877),Zn=Mt.isCompressedTexture?Mt.mipmaps[0]:Mt.image;ht.pixelStorei(3314,Zn.width),ht.pixelStorei(32878,Zn.height),ht.pixelStorei(3316,q.min.x),ht.pixelStorei(3315,q.min.y),ht.pixelStorei(32877,q.min.z),Mt.isDataTexture||Mt.isData3DTexture?ht.texSubImage3D(Ye,Ft,St.x,St.y,St.z,Ce,Be,Ke,Xe,fn,Zn.data):Mt.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ht.compressedTexSubImage3D(Ye,Ft,St.x,St.y,St.z,Ce,Be,Ke,Xe,Zn.data)):ht.texSubImage3D(Ye,Ft,St.x,St.y,St.z,Ce,Be,Ke,Xe,fn,Zn),ht.pixelStorei(3314,He),ht.pixelStorei(32878,ls),ht.pixelStorei(3316,mr),ht.pixelStorei(3315,kr),ht.pixelStorei(32877,Hi),Ft===0&&wt.generateMipmaps&&ht.generateMipmap(Ye),zt.unbindTexture()},this.initTexture=function(q){q.isCubeTexture?ne.setTextureCube(q,0):q.isData3DTexture?ne.setTexture3D(q,0):q.isDataArrayTexture||q.isCompressedArrayTexture?ne.setTexture2DArray(q,0):ne.setTexture2D(q,0),zt.unbindTexture()},this.resetState=function(){x=0,b=0,w=null,zt.reset(),Lt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class rkt extends jF{}rkt.prototype.isWebGL1Renderer=!0;class ikt extends as{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,n){return super.copy(t,n),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const n=super.toJSON(t);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.backgroundIntensity=this.backgroundIntensity),n}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}}class okt{constructor(t,n){this.isInterleavedBuffer=!0,this.array=t,this.stride=n,this.count=t!==void 0?t.length/n:0,this.usage=Ew,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Yo()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,n,i){t*=this.stride,i*=n.stride;for(let o=0,a=this.stride;o<a;o++)this.array[t+o]=n.array[i+o];return this}set(t,n=0){return this.array.set(t,n),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Yo()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const n=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(n,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Yo()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const jr=new yt;class TC{constructor(t,n,i,o=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=n,this.offset=i,this.normalized=o}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let n=0,i=this.data.count;n<i;n++)jr.fromBufferAttribute(this,n),jr.applyMatrix4(t),this.setXYZ(n,jr.x,jr.y,jr.z);return this}applyNormalMatrix(t){for(let n=0,i=this.count;n<i;n++)jr.fromBufferAttribute(this,n),jr.applyNormalMatrix(t),this.setXYZ(n,jr.x,jr.y,jr.z);return this}transformDirection(t){for(let n=0,i=this.count;n<i;n++)jr.fromBufferAttribute(this,n),jr.transformDirection(t),this.setXYZ(n,jr.x,jr.y,jr.z);return this}setX(t,n){return this.normalized&&(n=Un(n,this.array)),this.data.array[t*this.data.stride+this.offset]=n,this}setY(t,n){return this.normalized&&(n=Un(n,this.array)),this.data.array[t*this.data.stride+this.offset+1]=n,this}setZ(t,n){return this.normalized&&(n=Un(n,this.array)),this.data.array[t*this.data.stride+this.offset+2]=n,this}setW(t,n){return this.normalized&&(n=Un(n,this.array)),this.data.array[t*this.data.stride+this.offset+3]=n,this}getX(t){let n=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(n=ul(n,this.array)),n}getY(t){let n=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(n=ul(n,this.array)),n}getZ(t){let n=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(n=ul(n,this.array)),n}getW(t){let n=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(n=ul(n,this.array)),n}setXY(t,n,i){return t=t*this.data.stride+this.offset,this.normalized&&(n=Un(n,this.array),i=Un(i,this.array)),this.data.array[t+0]=n,this.data.array[t+1]=i,this}setXYZ(t,n,i,o){return t=t*this.data.stride+this.offset,this.normalized&&(n=Un(n,this.array),i=Un(i,this.array),o=Un(o,this.array)),this.data.array[t+0]=n,this.data.array[t+1]=i,this.data.array[t+2]=o,this}setXYZW(t,n,i,o,a){return t=t*this.data.stride+this.offset,this.normalized&&(n=Un(n,this.array),i=Un(i,this.array),o=Un(o,this.array),a=Un(a,this.array)),this.data.array[t+0]=n,this.data.array[t+1]=i,this.data.array[t+2]=o,this.data.array[t+3]=a,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let i=0;i<this.count;i++){const o=i*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)n.push(this.data.array[o+a])}return new ti(new this.array.constructor(n),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new TC(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let i=0;i<this.count;i++){const o=i*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)n.push(this.data.array[o+a])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const PN=new yt,BN=new Gn,zN=new Gn,akt=new yt,VN=new pn;class lkt extends mi{constructor(t,n){super(t,n),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new pn,this.bindMatrixInverse=new pn}copy(t,n){return super.copy(t,n),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,n){this.skeleton=t,n===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),n=this.matrixWorld),this.bindMatrix.copy(n),this.bindMatrixInverse.copy(n).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Gn,n=this.geometry.attributes.skinWeight;for(let i=0,o=n.count;i<o;i++){t.fromBufferAttribute(n,i);const a=1/t.manhattanLength();a!==1/0?t.multiplyScalar(a):t.set(1,0,0,0),n.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,n){const i=this.skeleton,o=this.geometry;BN.fromBufferAttribute(o.attributes.skinIndex,t),zN.fromBufferAttribute(o.attributes.skinWeight,t),PN.copy(n).applyMatrix4(this.bindMatrix),n.set(0,0,0);for(let a=0;a<4;a++){const l=zN.getComponent(a);if(l!==0){const c=BN.getComponent(a);VN.multiplyMatrices(i.bones[c].matrixWorld,i.boneInverses[c]),n.addScaledVector(akt.copy(PN).applyMatrix4(VN),l)}}return n.applyMatrix4(this.bindMatrixInverse)}}class qF extends as{constructor(){super(),this.isBone=!0,this.type="Bone"}}class ckt extends lr{constructor(t=null,n=1,i=1,o,a,l,c,u,h=rr,d=rr,f,p){super(null,l,c,u,h,d,o,a,f,p),this.isDataTexture=!0,this.image={data:t,width:n,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const UN=new pn,ukt=new pn;class CC{constructor(t=[],n=[]){this.uuid=Yo(),this.bones=t.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,n=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),n.length===0)this.calculateInverses();else if(t.length!==n.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,o=this.bones.length;i<o;i++)this.boneInverses.push(new pn)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,n=this.bones.length;t<n;t++){const i=new pn;this.bones[t]&&i.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let t=0,n=this.bones.length;t<n;t++){const i=this.bones[t];i&&i.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,n=this.bones.length;t<n;t++){const i=this.bones[t];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const t=this.bones,n=this.boneInverses,i=this.boneMatrices,o=this.boneTexture;for(let a=0,l=t.length;a<l;a++){const c=t[a]?t[a].matrixWorld:ukt;UN.multiplyMatrices(c,n[a]),UN.toArray(i,a*16)}o!==null&&(o.needsUpdate=!0)}clone(){return new CC(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=EF(t),t=Math.max(t,4);const n=new Float32Array(t*t*4);n.set(this.boneMatrices);const i=new ckt(n,t,t,oo,ic);return i.needsUpdate=!0,this.boneMatrices=n,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let n=0,i=this.bones.length;n<i;n++){const o=this.bones[n];if(o.name===t)return o}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,n){this.uuid=t.uuid;for(let i=0,o=t.bones.length;i<o;i++){const a=t.bones[i];let l=n[a];l===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",a),l=new qF),this.bones.push(l),this.boneInverses.push(new pn().fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const n=this.bones,i=this.boneInverses;for(let o=0,a=n.length;o<a;o++){const l=n[o];t.bones.push(l.uuid);const c=i[o];t.boneInverses.push(c.toArray())}return t}}class WN extends ti{constructor(t,n,i,o=1){super(t,n,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=o}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const GN=new pn,HN=new pn,h1=[],hkt=new pn,up=new mi;class dkt extends mi{constructor(t,n,i){super(t,n),this.isInstancedMesh=!0,this.instanceMatrix=new WN(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let o=0;o<i;o++)this.setMatrixAt(o,hkt)}copy(t,n){return super.copy(t,n),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,n){n.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,n){n.fromArray(this.instanceMatrix.array,t*16)}raycast(t,n){const i=this.matrixWorld,o=this.count;if(up.geometry=this.geometry,up.material=this.material,up.material!==void 0)for(let a=0;a<o;a++){this.getMatrixAt(a,GN),HN.multiplyMatrices(i,GN),up.matrixWorld=HN,up.raycast(t,h1);for(let l=0,c=h1.length;l<c;l++){const u=h1[l];u.instanceId=a,u.object=this,n.push(u)}h1.length=0}}setColorAt(t,n){this.instanceColor===null&&(this.instanceColor=new WN(new Float32Array(this.instanceMatrix.count*3),3)),n.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,n){n.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class KF extends Oa{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new sn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const jN=new yt,qN=new yt,KN=new pn,$b=new wC,d1=new If;class kC extends as{constructor(t=new ua,n=new KF){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=n,this.updateMorphTargets()}copy(t,n){return super.copy(t,n),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const n=t.attributes.position,i=[0];for(let o=1,a=n.count;o<a;o++)jN.fromBufferAttribute(n,o-1),qN.fromBufferAttribute(n,o),i[o]=i[o-1],i[o]+=jN.distanceTo(qN);t.setAttribute("lineDistance",new Zo(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,n){const i=this.geometry,o=this.matrixWorld,a=t.params.Line.threshold,l=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),d1.copy(i.boundingSphere),d1.applyMatrix4(o),d1.radius+=a,t.ray.intersectsSphere(d1)===!1)return;KN.copy(o).invert(),$b.copy(t.ray).applyMatrix4(KN);const c=a/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,h=new yt,d=new yt,f=new yt,p=new yt,m=this.isLineSegments?2:1,g=i.index,v=i.attributes.position;if(g!==null){const x=Math.max(0,l.start),b=Math.min(g.count,l.start+l.count);for(let w=x,S=b-1;w<S;w+=m){const _=g.getX(w),$=g.getX(w+1);if(h.fromBufferAttribute(v,_),d.fromBufferAttribute(v,$),$b.distanceSqToSegment(h,d,p,f)>u)continue;p.applyMatrix4(this.matrixWorld);const k=t.ray.origin.distanceTo(p);k<t.near||k>t.far||n.push({distance:k,point:f.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}else{const x=Math.max(0,l.start),b=Math.min(v.count,l.start+l.count);for(let w=x,S=b-1;w<S;w+=m){if(h.fromBufferAttribute(v,w),d.fromBufferAttribute(v,w+1),$b.distanceSqToSegment(h,d,p,f)>u)continue;p.applyMatrix4(this.matrixWorld);const $=t.ray.origin.distanceTo(p);$<t.near||$>t.far||n.push({distance:$,point:f.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const o=n[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,l=o.length;a<l;a++){const c=o[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=a}}}}}const XN=new yt,YN=new yt;class fkt extends kC{constructor(t,n){super(t,n),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const n=t.attributes.position,i=[];for(let o=0,a=n.count;o<a;o+=2)XN.fromBufferAttribute(n,o),YN.fromBufferAttribute(n,o+1),i[o]=o===0?0:i[o-1],i[o+1]=i[o]+XN.distanceTo(YN);t.setAttribute("lineDistance",new Zo(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class pkt extends kC{constructor(t,n){super(t,n),this.isLineLoop=!0,this.type="LineLoop"}}class XF extends Oa{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new sn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const ZN=new pn,Dw=new wC,f1=new If,p1=new yt;class mkt extends as{constructor(t=new ua,n=new XF){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=n,this.updateMorphTargets()}copy(t,n){return super.copy(t,n),this.material=t.material,this.geometry=t.geometry,this}raycast(t,n){const i=this.geometry,o=this.matrixWorld,a=t.params.Points.threshold,l=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),f1.copy(i.boundingSphere),f1.applyMatrix4(o),f1.radius+=a,t.ray.intersectsSphere(f1)===!1)return;ZN.copy(o).invert(),Dw.copy(t.ray).applyMatrix4(ZN);const c=a/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,h=i.index,f=i.attributes.position;if(h!==null){const p=Math.max(0,l.start),m=Math.min(h.count,l.start+l.count);for(let g=p,y=m;g<y;g++){const v=h.getX(g);p1.fromBufferAttribute(f,v),JN(p1,v,u,o,t,n,this)}}else{const p=Math.max(0,l.start),m=Math.min(f.count,l.start+l.count);for(let g=p,y=m;g<y;g++)p1.fromBufferAttribute(f,g),JN(p1,g,u,o,t,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const o=n[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,l=o.length;a<l;a++){const c=o[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=a}}}}}function JN(r,t,n,i,o,a,l){const c=Dw.distanceSqToPoint(r);if(c<n){const u=new yt;Dw.closestPointToPoint(r,u),u.applyMatrix4(i);const h=o.ray.origin.distanceTo(u);if(h<o.near||h>o.far)return;a.push({distance:h,distanceToRay:Math.sqrt(c),point:u,index:t,face:null,object:l})}}class gkt extends lr{constructor(t,n,i,o,a,l,c,u,h){super(t,n,i,o,a,l,c,u,h),this.isVideoTexture=!0,this.minFilter=l!==void 0?l:Mr,this.magFilter=a!==void 0?a:Mr,this.generateMipmaps=!1;const d=this;function f(){d.needsUpdate=!0,t.requestVideoFrameCallback(f)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(f)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class $C extends Oa{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new sn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new sn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=IF,this.normalScale=new $n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Ih extends $C{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new $n(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Yr(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new sn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new sn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new sn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}function ql(r,t,n){return YF(r)?new r.constructor(r.subarray(t,n!==void 0?n:r.length)):r.slice(t,n)}function m1(r,t,n){return!r||!n&&r.constructor===t?r:typeof t.BYTES_PER_ELEMENT=="number"?new t(r):Array.prototype.slice.call(r)}function YF(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function vkt(r){function t(o,a){return r[o]-r[a]}const n=r.length,i=new Array(n);for(let o=0;o!==n;++o)i[o]=o;return i.sort(t),i}function QN(r,t,n){const i=r.length,o=new r.constructor(i);for(let a=0,l=0;l!==i;++a){const c=n[a]*t;for(let u=0;u!==t;++u)o[l++]=r[c+u]}return o}function ZF(r,t,n,i){let o=1,a=r[0];for(;a!==void 0&&a[i]===void 0;)a=r[o++];if(a===void 0)return;let l=a[i];if(l!==void 0)if(Array.isArray(l))do l=a[i],l!==void 0&&(t.push(a.time),n.push.apply(n,l)),a=r[o++];while(a!==void 0);else if(l.toArray!==void 0)do l=a[i],l!==void 0&&(t.push(a.time),l.toArray(n,n.length)),a=r[o++];while(a!==void 0);else do l=a[i],l!==void 0&&(t.push(a.time),n.push(l)),a=r[o++];while(a!==void 0)}class qg{constructor(t,n,i,o){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=o!==void 0?o:new n.constructor(i),this.sampleValues=n,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const n=this.parameterPositions;let i=this._cachedIndex,o=n[i],a=n[i-1];t:{e:{let l;n:{s:if(!(t<o)){for(let c=i+2;;){if(o===void 0){if(t<a)break s;return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===c)break;if(a=o,o=n[++i],t<o)break e}l=n.length;break n}if(!(t>=a)){const c=n[1];t<c&&(i=2,a=c);for(let u=i-2;;){if(a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===u)break;if(o=a,a=n[--i-1],t>=a)break e}l=i,i=0;break n}break t}for(;i<l;){const c=i+l>>>1;t<n[c]?l=c:i=c+1}if(o=n[i],a=n[i-1],a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(o===void 0)return i=n.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,a,o)}return this.interpolate_(i,a,t,o)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const n=this.resultBuffer,i=this.sampleValues,o=this.valueSize,a=t*o;for(let l=0;l!==o;++l)n[l]=i[a+l];return n}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class ykt extends qg{constructor(t,n,i,o){super(t,n,i,o),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:eN,endingEnd:eN}}intervalChanged_(t,n,i){const o=this.parameterPositions;let a=t-2,l=t+1,c=o[a],u=o[l];if(c===void 0)switch(this.getSettings_().endingStart){case nN:a=t,c=2*n-i;break;case sN:a=o.length-2,c=n+o[a]-o[a+1];break;default:a=t,c=i}if(u===void 0)switch(this.getSettings_().endingEnd){case nN:l=t,u=2*i-n;break;case sN:l=1,u=i+o[1]-o[0];break;default:l=t-1,u=n}const h=(i-n)*.5,d=this.valueSize;this._weightPrev=h/(n-c),this._weightNext=h/(u-i),this._offsetPrev=a*d,this._offsetNext=l*d}interpolate_(t,n,i,o){const a=this.resultBuffer,l=this.sampleValues,c=this.valueSize,u=t*c,h=u-c,d=this._offsetPrev,f=this._offsetNext,p=this._weightPrev,m=this._weightNext,g=(i-n)/(o-n),y=g*g,v=y*g,x=-p*v+2*p*y-p*g,b=(1+p)*v+(-1.5-2*p)*y+(-.5+p)*g+1,w=(-1-m)*v+(1.5+m)*y+.5*g,S=m*v-m*y;for(let _=0;_!==c;++_)a[_]=x*l[d+_]+b*l[h+_]+w*l[u+_]+S*l[f+_];return a}}class xkt extends qg{constructor(t,n,i,o){super(t,n,i,o)}interpolate_(t,n,i,o){const a=this.resultBuffer,l=this.sampleValues,c=this.valueSize,u=t*c,h=u-c,d=(i-n)/(o-n),f=1-d;for(let p=0;p!==c;++p)a[p]=l[h+p]*f+l[u+p]*d;return a}}class bkt extends qg{constructor(t,n,i,o){super(t,n,i,o)}interpolate_(t){return this.copySampleValue_(t-1)}}class Ua{constructor(t,n,i,o){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(n===void 0||n.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=m1(n,this.TimeBufferType),this.values=m1(i,this.ValueBufferType),this.setInterpolation(o||this.DefaultInterpolation)}static toJSON(t){const n=t.constructor;let i;if(n.toJSON!==this.toJSON)i=n.toJSON(t);else{i={name:t.name,times:m1(t.times,Array),values:m1(t.values,Array)};const o=t.getInterpolation();o!==t.DefaultInterpolation&&(i.interpolation=o)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new bkt(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new xkt(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new ykt(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let n;switch(t){case am:n=this.InterpolantFactoryMethodDiscrete;break;case Zd:n=this.InterpolantFactoryMethodLinear;break;case eb:n=this.InterpolantFactoryMethodSmooth;break}if(n===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=n,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return am;case this.InterpolantFactoryMethodLinear:return Zd;case this.InterpolantFactoryMethodSmooth:return eb}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const n=this.times;for(let i=0,o=n.length;i!==o;++i)n[i]+=t}return this}scale(t){if(t!==1){const n=this.times;for(let i=0,o=n.length;i!==o;++i)n[i]*=t}return this}trim(t,n){const i=this.times,o=i.length;let a=0,l=o-1;for(;a!==o&&i[a]<t;)++a;for(;l!==-1&&i[l]>n;)--l;if(++l,a!==0||l!==o){a>=l&&(l=Math.max(l,1),a=l-1);const c=this.getValueSize();this.times=ql(i,a,l),this.values=ql(this.values,a*c,l*c)}return this}validate(){let t=!0;const n=this.getValueSize();n-Math.floor(n)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,o=this.values,a=i.length;a===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let l=null;for(let c=0;c!==a;c++){const u=i[c];if(typeof u=="number"&&isNaN(u)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,c,u),t=!1;break}if(l!==null&&l>u){console.error("THREE.KeyframeTrack: Out of order keys.",this,c,u,l),t=!1;break}l=u}if(o!==void 0&&YF(o))for(let c=0,u=o.length;c!==u;++c){const h=o[c];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,c,h),t=!1;break}}return t}optimize(){const t=ql(this.times),n=ql(this.values),i=this.getValueSize(),o=this.getInterpolation()===eb,a=t.length-1;let l=1;for(let c=1;c<a;++c){let u=!1;const h=t[c],d=t[c+1];if(h!==d&&(c!==1||h!==t[0]))if(o)u=!0;else{const f=c*i,p=f-i,m=f+i;for(let g=0;g!==i;++g){const y=n[f+g];if(y!==n[p+g]||y!==n[m+g]){u=!0;break}}}if(u){if(c!==l){t[l]=t[c];const f=c*i,p=l*i;for(let m=0;m!==i;++m)n[p+m]=n[f+m]}++l}}if(a>0){t[l]=t[a];for(let c=a*i,u=l*i,h=0;h!==i;++h)n[u+h]=n[c+h];++l}return l!==t.length?(this.times=ql(t,0,l),this.values=ql(n,0,l*i)):(this.times=t,this.values=n),this}clone(){const t=ql(this.times,0),n=ql(this.values,0),i=this.constructor,o=new i(this.name,t,n);return o.createInterpolant=this.createInterpolant,o}}Ua.prototype.TimeBufferType=Float32Array;Ua.prototype.ValueBufferType=Float32Array;Ua.prototype.DefaultInterpolation=Zd;class Nf extends Ua{}Nf.prototype.ValueTypeName="bool";Nf.prototype.ValueBufferType=Array;Nf.prototype.DefaultInterpolation=am;Nf.prototype.InterpolantFactoryMethodLinear=void 0;Nf.prototype.InterpolantFactoryMethodSmooth=void 0;class JF extends Ua{}JF.prototype.ValueTypeName="color";class hm extends Ua{}hm.prototype.ValueTypeName="number";class wkt extends qg{constructor(t,n,i,o){super(t,n,i,o)}interpolate_(t,n,i,o){const a=this.resultBuffer,l=this.sampleValues,c=this.valueSize,u=(i-n)/(o-n);let h=t*c;for(let d=h+c;h!==d;h+=4)qc.slerpFlat(a,0,l,h-c,l,h,u);return a}}class ah extends Ua{InterpolantFactoryMethodLinear(t){return new wkt(this.times,this.values,this.getValueSize(),t)}}ah.prototype.ValueTypeName="quaternion";ah.prototype.DefaultInterpolation=Zd;ah.prototype.InterpolantFactoryMethodSmooth=void 0;class Af extends Ua{}Af.prototype.ValueTypeName="string";Af.prototype.ValueBufferType=Array;Af.prototype.DefaultInterpolation=am;Af.prototype.InterpolantFactoryMethodLinear=void 0;Af.prototype.InterpolantFactoryMethodSmooth=void 0;class dm extends Ua{}dm.prototype.ValueTypeName="vector";class Skt{constructor(t,n=-1,i,o=zwt){this.name=t,this.tracks=i,this.duration=n,this.blendMode=o,this.uuid=Yo(),this.duration<0&&this.resetDuration()}static parse(t){const n=[],i=t.tracks,o=1/(t.fps||1);for(let l=0,c=i.length;l!==c;++l)n.push(Tkt(i[l]).scale(o));const a=new this(t.name,t.duration,n,t.blendMode);return a.uuid=t.uuid,a}static toJSON(t){const n=[],i=t.tracks,o={name:t.name,duration:t.duration,tracks:n,uuid:t.uuid,blendMode:t.blendMode};for(let a=0,l=i.length;a!==l;++a)n.push(Ua.toJSON(i[a]));return o}static CreateFromMorphTargetSequence(t,n,i,o){const a=n.length,l=[];for(let c=0;c<a;c++){let u=[],h=[];u.push((c+a-1)%a,c,(c+1)%a),h.push(0,1,0);const d=vkt(u);u=QN(u,1,d),h=QN(h,1,d),!o&&u[0]===0&&(u.push(a),h.push(h[0])),l.push(new hm(".morphTargetInfluences["+n[c].name+"]",u,h).scale(1/i))}return new this(t,-1,l)}static findByName(t,n){let i=t;if(!Array.isArray(t)){const o=t;i=o.geometry&&o.geometry.animations||o.animations}for(let o=0;o<i.length;o++)if(i[o].name===n)return i[o];return null}static CreateClipsFromMorphTargetSequences(t,n,i){const o={},a=/^([\w-]*?)([\d]+)$/;for(let c=0,u=t.length;c<u;c++){const h=t[c],d=h.name.match(a);if(d&&d.length>1){const f=d[1];let p=o[f];p||(o[f]=p=[]),p.push(h)}}const l=[];for(const c in o)l.push(this.CreateFromMorphTargetSequence(c,o[c],n,i));return l}static parseAnimation(t,n){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(f,p,m,g,y){if(m.length!==0){const v=[],x=[];ZF(m,v,x,g),v.length!==0&&y.push(new f(p,v,x))}},o=[],a=t.name||"default",l=t.fps||30,c=t.blendMode;let u=t.length||-1;const h=t.hierarchy||[];for(let f=0;f<h.length;f++){const p=h[f].keys;if(!(!p||p.length===0))if(p[0].morphTargets){const m={};let g;for(g=0;g<p.length;g++)if(p[g].morphTargets)for(let y=0;y<p[g].morphTargets.length;y++)m[p[g].morphTargets[y]]=-1;for(const y in m){const v=[],x=[];for(let b=0;b!==p[g].morphTargets.length;++b){const w=p[g];v.push(w.time),x.push(w.morphTarget===y?1:0)}o.push(new hm(".morphTargetInfluence["+y+"]",v,x))}u=m.length*l}else{const m=".bones["+n[f].name+"]";i(dm,m+".position",p,"pos",o),i(ah,m+".quaternion",p,"rot",o),i(dm,m+".scale",p,"scl",o)}}return o.length===0?null:new this(a,u,o,c)}resetDuration(){const t=this.tracks;let n=0;for(let i=0,o=t.length;i!==o;++i){const a=this.tracks[i];n=Math.max(n,a.times[a.times.length-1])}return this.duration=n,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let n=0;n<this.tracks.length;n++)t=t&&this.tracks[n].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let n=0;n<this.tracks.length;n++)t.push(this.tracks[n].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function _kt(r){switch(r.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return hm;case"vector":case"vector2":case"vector3":case"vector4":return dm;case"color":return JF;case"quaternion":return ah;case"bool":case"boolean":return Nf;case"string":return Af}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+r)}function Tkt(r){if(r.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=_kt(r.type);if(r.times===void 0){const n=[],i=[];ZF(r.keys,n,i,"value"),r.times=n,r.values=i}return t.parse!==void 0?t.parse(r):new t(r.name,r.times,r.values,r.interpolation)}const Qd={enabled:!1,files:{},add:function(r,t){this.enabled!==!1&&(this.files[r]=t)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class Ckt{constructor(t,n,i){const o=this;let a=!1,l=0,c=0,u;const h=[];this.onStart=void 0,this.onLoad=t,this.onProgress=n,this.onError=i,this.itemStart=function(d){c++,a===!1&&o.onStart!==void 0&&o.onStart(d,l,c),a=!0},this.itemEnd=function(d){l++,o.onProgress!==void 0&&o.onProgress(d,l,c),l===c&&(a=!1,o.onLoad!==void 0&&o.onLoad())},this.itemError=function(d){o.onError!==void 0&&o.onError(d)},this.resolveURL=function(d){return u?u(d):d},this.setURLModifier=function(d){return u=d,this},this.addHandler=function(d,f){return h.push(d,f),this},this.removeHandler=function(d){const f=h.indexOf(d);return f!==-1&&h.splice(f,2),this},this.getHandler=function(d){for(let f=0,p=h.length;f<p;f+=2){const m=h[f],g=h[f+1];if(m.global&&(m.lastIndex=0),m.test(d))return g}return null}}}const kkt=new Ckt;class Kg{constructor(t){this.manager=t!==void 0?t:kkt,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,n){const i=this;return new Promise(function(o,a){i.load(t,o,n,a)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const tl={};class $kt extends Error{constructor(t,n){super(t),this.response=n}}class QF extends Kg{constructor(t){super(t)}load(t,n,i,o){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const a=Qd.get(t);if(a!==void 0)return this.manager.itemStart(t),setTimeout(()=>{n&&n(a),this.manager.itemEnd(t)},0),a;if(tl[t]!==void 0){tl[t].push({onLoad:n,onProgress:i,onError:o});return}tl[t]=[],tl[t].push({onLoad:n,onProgress:i,onError:o});const l=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),c=this.mimeType,u=this.responseType;fetch(l).then(h=>{if(h.status===200||h.status===0){if(h.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||h.body===void 0||h.body.getReader===void 0)return h;const d=tl[t],f=h.body.getReader(),p=h.headers.get("Content-Length")||h.headers.get("X-File-Size"),m=p?parseInt(p):0,g=m!==0;let y=0;const v=new ReadableStream({start(x){b();function b(){f.read().then(({done:w,value:S})=>{if(w)x.close();else{y+=S.byteLength;const _=new ProgressEvent("progress",{lengthComputable:g,loaded:y,total:m});for(let $=0,N=d.length;$<N;$++){const k=d[$];k.onProgress&&k.onProgress(_)}x.enqueue(S),b()}})}}});return new Response(v)}else throw new $kt(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`,h)}).then(h=>{switch(u){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(d=>new DOMParser().parseFromString(d,c));case"json":return h.json();default:if(c===void 0)return h.text();{const f=/charset="?([^;"\s]*)"?/i.exec(c),p=f&&f[1]?f[1].toLowerCase():void 0,m=new TextDecoder(p);return h.arrayBuffer().then(g=>m.decode(g))}}}).then(h=>{Qd.add(t,h);const d=tl[t];delete tl[t];for(let f=0,p=d.length;f<p;f++){const m=d[f];m.onLoad&&m.onLoad(h)}}).catch(h=>{const d=tl[t];if(d===void 0)throw this.manager.itemError(t),h;delete tl[t];for(let f=0,p=d.length;f<p;f++){const m=d[f];m.onError&&m.onError(h)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Ikt extends Kg{constructor(t){super(t)}load(t,n,i,o){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const a=this,l=Qd.get(t);if(l!==void 0)return a.manager.itemStart(t),setTimeout(function(){n&&n(l),a.manager.itemEnd(t)},0),l;const c=um("img");function u(){d(),Qd.add(t,this),n&&n(this),a.manager.itemEnd(t)}function h(f){d(),o&&o(f),a.manager.itemError(t),a.manager.itemEnd(t)}function d(){c.removeEventListener("load",u,!1),c.removeEventListener("error",h,!1)}return c.addEventListener("load",u,!1),c.addEventListener("error",h,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(c.crossOrigin=this.crossOrigin),a.manager.itemStart(t),c.src=t,c}}class tP extends Kg{constructor(t){super(t)}load(t,n,i,o){const a=new lr,l=new Ikt(this.manager);return l.setCrossOrigin(this.crossOrigin),l.setPath(this.path),l.load(t,function(c){a.image=c,a.needsUpdate=!0,n!==void 0&&n(a)},i,o),a}}class Xg extends as{constructor(t,n=1){super(),this.isLight=!0,this.type="Light",this.color=new sn(t),this.intensity=n}dispose(){}copy(t,n){return super.copy(t,n),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const n=super.toJSON(t);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,this.groundColor!==void 0&&(n.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(n.object.distance=this.distance),this.angle!==void 0&&(n.object.angle=this.angle),this.decay!==void 0&&(n.object.decay=this.decay),this.penumbra!==void 0&&(n.object.penumbra=this.penumbra),this.shadow!==void 0&&(n.object.shadow=this.shadow.toJSON()),n}}class Ekt extends Xg{constructor(t,n,i){super(t,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(as.DefaultUp),this.updateMatrix(),this.groundColor=new sn(n)}copy(t,n){return super.copy(t,n),this.groundColor.copy(t.groundColor),this}}const Ib=new pn,tA=new yt,eA=new yt;class IC{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new $n(512,512),this.map=null,this.mapPass=null,this.matrix=new pn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new SC,this._frameExtents=new $n(1,1),this._viewportCount=1,this._viewports=[new Gn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const n=this.camera,i=this.matrix;tA.setFromMatrixPosition(t.matrixWorld),n.position.copy(tA),eA.setFromMatrixPosition(t.target.matrixWorld),n.lookAt(eA),n.updateMatrixWorld(),Ib.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ib),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Ib)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Nkt extends IC{constructor(){super(new hi(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const n=this.camera,i=cm*2*t.angle*this.focus,o=this.mapSize.width/this.mapSize.height,a=t.distance||n.far;(i!==n.fov||o!==n.aspect||a!==n.far)&&(n.fov=i,n.aspect=o,n.far=a,n.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class Akt extends Xg{constructor(t,n,i=0,o=Math.PI/3,a=0,l=2){super(t,n),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(as.DefaultUp),this.updateMatrix(),this.target=new as,this.distance=i,this.angle=o,this.penumbra=a,this.decay=l,this.map=null,this.shadow=new Nkt}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,n){return super.copy(t,n),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const nA=new pn,hp=new yt,Eb=new yt;class Mkt extends IC{constructor(){super(new hi(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new $n(4,2),this._viewportCount=6,this._viewports=[new Gn(2,1,1,1),new Gn(0,1,1,1),new Gn(3,1,1,1),new Gn(1,1,1,1),new Gn(3,0,1,1),new Gn(1,0,1,1)],this._cubeDirections=[new yt(1,0,0),new yt(-1,0,0),new yt(0,0,1),new yt(0,0,-1),new yt(0,1,0),new yt(0,-1,0)],this._cubeUps=[new yt(0,1,0),new yt(0,1,0),new yt(0,1,0),new yt(0,1,0),new yt(0,0,1),new yt(0,0,-1)]}updateMatrices(t,n=0){const i=this.camera,o=this.matrix,a=t.distance||i.far;a!==i.far&&(i.far=a,i.updateProjectionMatrix()),hp.setFromMatrixPosition(t.matrixWorld),i.position.copy(hp),Eb.copy(i.position),Eb.add(this._cubeDirections[n]),i.up.copy(this._cubeUps[n]),i.lookAt(Eb),i.updateMatrixWorld(),o.makeTranslation(-hp.x,-hp.y,-hp.z),nA.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(nA)}}class Dkt extends Xg{constructor(t,n,i=0,o=2){super(t,n),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=o,this.shadow=new Mkt}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,n){return super.copy(t,n),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class Rkt extends IC{constructor(){super(new By(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class eP extends Xg{constructor(t,n){super(t,n),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(as.DefaultUp),this.updateMatrix(),this.target=new as,this.shadow=new Rkt}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class Okt extends Xg{constructor(t,n){super(t,n),this.isAmbientLight=!0,this.type="AmbientLight"}}class Fu{static decodeText(t){if(typeof TextDecoder<"u")return new TextDecoder().decode(t);let n="";for(let i=0,o=t.length;i<o;i++)n+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(n))}catch{return n}}static extractUrlBase(t){const n=t.lastIndexOf("/");return n===-1?"./":t.slice(0,n+1)}static resolveURL(t,n){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(n)&&/^\//.test(t)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:n+t)}}class Lkt extends Kg{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,n,i,o){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const a=this,l=Qd.get(t);if(l!==void 0)return a.manager.itemStart(t),setTimeout(function(){n&&n(l),a.manager.itemEnd(t)},0),l;const c={};c.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",c.headers=this.requestHeader,fetch(t,c).then(function(u){return u.blob()}).then(function(u){return createImageBitmap(u,Object.assign(a.options,{colorSpaceConversion:"none"}))}).then(function(u){Qd.add(t,u),n&&n(u),a.manager.itemEnd(t)}).catch(function(u){o&&o(u),a.manager.itemError(t),a.manager.itemEnd(t)}),a.manager.itemStart(t)}}const EC="\\[\\]\\.:\\/",Fkt=new RegExp("["+EC+"]","g"),NC="[^"+EC+"]",Pkt="[^"+EC.replace("\\.","")+"]",Bkt=/((?:WC+[\/:])*)/.source.replace("WC",NC),zkt=/(WCOD+)?/.source.replace("WCOD",Pkt),Vkt=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",NC),Ukt=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",NC),Wkt=new RegExp("^"+Bkt+zkt+Vkt+Ukt+"$"),Gkt=["material","materials","bones","map"];class Hkt{constructor(t,n,i){const o=i||Ln.parseTrackName(n);this._targetGroup=t,this._bindings=t.subscribe_(n,o)}getValue(t,n){this.bind();const i=this._targetGroup.nCachedObjects_,o=this._bindings[i];o!==void 0&&o.getValue(t,n)}setValue(t,n){const i=this._bindings;for(let o=this._targetGroup.nCachedObjects_,a=i.length;o!==a;++o)i[o].setValue(t,n)}bind(){const t=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=t.length;n!==i;++n)t[n].bind()}unbind(){const t=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=t.length;n!==i;++n)t[n].unbind()}}class Ln{constructor(t,n,i){this.path=n,this.parsedPath=i||Ln.parseTrackName(n),this.node=Ln.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,n,i){return t&&t.isAnimationObjectGroup?new Ln.Composite(t,n,i):new Ln(t,n,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Fkt,"")}static parseTrackName(t){const n=Wkt.exec(t);if(n===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},o=i.nodeName&&i.nodeName.lastIndexOf(".");if(o!==void 0&&o!==-1){const a=i.nodeName.substring(o+1);Gkt.indexOf(a)!==-1&&(i.nodeName=i.nodeName.substring(0,o),i.objectName=a)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,n){if(n===void 0||n===""||n==="."||n===-1||n===t.name||n===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(n);if(i!==void 0)return i}if(t.children){const i=function(a){for(let l=0;l<a.length;l++){const c=a[l];if(c.name===n||c.uuid===n)return c;const u=i(c.children);if(u)return u}return null},o=i(t.children);if(o)return o}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,n){t[n]=this.targetObject[this.propertyName]}_getValue_array(t,n){const i=this.resolvedProperty;for(let o=0,a=i.length;o!==a;++o)t[n++]=i[o]}_getValue_arrayElement(t,n){t[n]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,n){this.resolvedProperty.toArray(t,n)}_setValue_direct(t,n){this.targetObject[this.propertyName]=t[n]}_setValue_direct_setNeedsUpdate(t,n){this.targetObject[this.propertyName]=t[n],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,n){this.targetObject[this.propertyName]=t[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,n){const i=this.resolvedProperty;for(let o=0,a=i.length;o!==a;++o)i[o]=t[n++]}_setValue_array_setNeedsUpdate(t,n){const i=this.resolvedProperty;for(let o=0,a=i.length;o!==a;++o)i[o]=t[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,n){const i=this.resolvedProperty;for(let o=0,a=i.length;o!==a;++o)i[o]=t[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,n){this.resolvedProperty[this.propertyIndex]=t[n]}_setValue_arrayElement_setNeedsUpdate(t,n){this.resolvedProperty[this.propertyIndex]=t[n],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,n){this.resolvedProperty[this.propertyIndex]=t[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,n){this.resolvedProperty.fromArray(t,n)}_setValue_fromArray_setNeedsUpdate(t,n){this.resolvedProperty.fromArray(t,n),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,n){this.resolvedProperty.fromArray(t,n),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,n){this.bind(),this.getValue(t,n)}_setValue_unbound(t,n){this.bind(),this.setValue(t,n)}bind(){let t=this.node;const n=this.parsedPath,i=n.objectName,o=n.propertyName;let a=n.propertyIndex;if(t||(t=Ln.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let h=n.objectIndex;switch(i){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let d=0;d<t.length;d++)if(t[d].name===h){h=d;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[i]}if(h!==void 0){if(t[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[h]}}const l=t[o];if(l===void 0){const h=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+o+" but it wasn't found.",t);return}let c=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?c=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(c=this.Versioning.MatrixWorldNeedsUpdate);let u=this.BindingType.Direct;if(a!==void 0){if(o==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[a]!==void 0&&(a=t.morphTargetDictionary[a])}u=this.BindingType.ArrayElement,this.resolvedProperty=l,this.propertyIndex=a}else l.fromArray!==void 0&&l.toArray!==void 0?(u=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(u=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=o;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][c]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ln.Composite=Hkt;Ln.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ln.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ln.prototype.GetterByBindingType=[Ln.prototype._getValue_direct,Ln.prototype._getValue_array,Ln.prototype._getValue_arrayElement,Ln.prototype._getValue_toArray];Ln.prototype.SetterByBindingTypeAndVersioning=[[Ln.prototype._setValue_direct,Ln.prototype._setValue_direct_setNeedsUpdate,Ln.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ln.prototype._setValue_array,Ln.prototype._setValue_array_setNeedsUpdate,Ln.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ln.prototype._setValue_arrayElement,Ln.prototype._setValue_arrayElement_setNeedsUpdate,Ln.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ln.prototype._setValue_fromArray,Ln.prototype._setValue_fromArray_setNeedsUpdate,Ln.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:xC}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=xC);var jkt={};(function(){var r;function t(C){var E=0;return function(){return E<C.length?{done:!1,value:C[E++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(C,E,R){return C==Array.prototype||C==Object.prototype||(C[E]=R.value),C};function i(C){C=[typeof globalThis=="object"&&globalThis,C,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ea=="object"&&Ea];for(var E=0;E<C.length;++E){var R=C[E];if(R&&R.Math==Math)return R}throw Error("Cannot find global object")}var o=i(this);function a(C,E){if(E)t:{var R=o;C=C.split(".");for(var tt=0;tt<C.length-1;tt++){var xt=C[tt];if(!(xt in R))break t;R=R[xt]}C=C[C.length-1],tt=R[C],E=E(tt),E!=tt&&E!=null&&n(R,C,{configurable:!0,writable:!0,value:E})}}a("Symbol",function(C){function E(Rt){if(this instanceof E)throw new TypeError("Symbol is not a constructor");return new R(tt+(Rt||"")+"_"+xt++,Rt)}function R(Rt,Tt){this.g=Rt,n(this,"description",{configurable:!0,writable:!0,value:Tt})}if(C)return C;R.prototype.toString=function(){return this.g};var tt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",xt=0;return E}),a("Symbol.iterator",function(C){if(C)return C;C=Symbol("Symbol.iterator");for(var E="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),R=0;R<E.length;R++){var tt=o[E[R]];typeof tt=="function"&&typeof tt.prototype[C]!="function"&&n(tt.prototype,C,{configurable:!0,writable:!0,value:function(){return l(t(this))}})}return C});function l(C){return C={next:C},C[Symbol.iterator]=function(){return this},C}function c(C){var E=typeof Symbol<"u"&&Symbol.iterator&&C[Symbol.iterator];return E?E.call(C):{next:t(C)}}function u(C){if(!(C instanceof Array)){C=c(C);for(var E,R=[];!(E=C.next()).done;)R.push(E.value);C=R}return C}var h=typeof Object.create=="function"?Object.create:function(C){function E(){}return E.prototype=C,new E},d;if(typeof Object.setPrototypeOf=="function")d=Object.setPrototypeOf;else{var f;t:{var p={a:!0},m={};try{m.__proto__=p,f=m.a;break t}catch{}f=!1}d=f?function(C,E){if(C.__proto__=E,C.__proto__!==E)throw new TypeError(C+" is not extensible");return C}:null}var g=d;function y(C,E){if(C.prototype=h(E.prototype),C.prototype.constructor=C,g)g(C,E);else for(var R in E)if(R!="prototype")if(Object.defineProperties){var tt=Object.getOwnPropertyDescriptor(E,R);tt&&Object.defineProperty(C,R,tt)}else C[R]=E[R];C.ea=E.prototype}function v(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.s=this.m=0,this.j=null}function x(C){if(C.l)throw new TypeError("Generator is already running");C.l=!0}v.prototype.o=function(C){this.h=C};function b(C,E){C.j={U:E,V:!0},C.g=C.m||C.s}v.prototype.return=function(C){this.j={return:C},this.g=this.s};function w(C,E,R){return C.g=R,{value:E}}function S(C){this.g=new v,this.h=C}function _(C,E){x(C.g);var R=C.g.i;return R?$(C,"return"in R?R.return:function(tt){return{value:tt,done:!0}},E,C.g.return):(C.g.return(E),N(C))}function $(C,E,R,tt){try{var xt=E.call(C.g.i,R);if(!(xt instanceof Object))throw new TypeError("Iterator result "+xt+" is not an object");if(!xt.done)return C.g.l=!1,xt;var Rt=xt.value}catch(Tt){return C.g.i=null,b(C.g,Tt),N(C)}return C.g.i=null,tt.call(C.g,Rt),N(C)}function N(C){for(;C.g.g;)try{var E=C.h(C.g);if(E)return C.g.l=!1,{value:E.value,done:!1}}catch(R){C.g.h=void 0,b(C.g,R)}if(C.g.l=!1,C.g.j){if(E=C.g.j,C.g.j=null,E.V)throw E.U;return{value:E.return,done:!0}}return{value:void 0,done:!0}}function k(C){this.next=function(E){return x(C.g),C.g.i?E=$(C,C.g.i.next,E,C.g.o):(C.g.o(E),E=N(C)),E},this.throw=function(E){return x(C.g),C.g.i?E=$(C,C.g.i.throw,E,C.g.o):(b(C.g,E),E=N(C)),E},this.return=function(E){return _(C,E)},this[Symbol.iterator]=function(){return this}}function I(C,E){return E=new k(new S(E)),g&&C.prototype&&g(E,C.prototype),E}function O(C,E){C instanceof String&&(C+="");var R=0,tt=!1,xt={next:function(){if(!tt&&R<C.length){var Rt=R++;return{value:E(Rt,C[Rt]),done:!1}}return tt=!0,{done:!0,value:void 0}}};return xt[Symbol.iterator]=function(){return xt},xt}var B=typeof Object.assign=="function"?Object.assign:function(C,E){for(var R=1;R<arguments.length;R++){var tt=arguments[R];if(tt)for(var xt in tt)Object.prototype.hasOwnProperty.call(tt,xt)&&(C[xt]=tt[xt])}return C};a("Object.assign",function(C){return C||B}),a("Promise",function(C){function E(Tt){this.h=0,this.i=void 0,this.g=[],this.o=!1;var Pt=this.j();try{Tt(Pt.resolve,Pt.reject)}catch(Zt){Pt.reject(Zt)}}function R(){this.g=null}function tt(Tt){return Tt instanceof E?Tt:new E(function(Pt){Pt(Tt)})}if(C)return C;R.prototype.h=function(Tt){if(this.g==null){this.g=[];var Pt=this;this.i(function(){Pt.l()})}this.g.push(Tt)};var xt=o.setTimeout;R.prototype.i=function(Tt){xt(Tt,0)},R.prototype.l=function(){for(;this.g&&this.g.length;){var Tt=this.g;this.g=[];for(var Pt=0;Pt<Tt.length;++Pt){var Zt=Tt[Pt];Tt[Pt]=null;try{Zt()}catch(pe){this.j(pe)}}}this.g=null},R.prototype.j=function(Tt){this.i(function(){throw Tt})},E.prototype.j=function(){function Tt(pe){return function(ze){Zt||(Zt=!0,pe.call(Pt,ze))}}var Pt=this,Zt=!1;return{resolve:Tt(this.C),reject:Tt(this.l)}},E.prototype.C=function(Tt){if(Tt===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(Tt instanceof E)this.F(Tt);else{t:switch(typeof Tt){case"object":var Pt=Tt!=null;break t;case"function":Pt=!0;break t;default:Pt=!1}Pt?this.u(Tt):this.m(Tt)}},E.prototype.u=function(Tt){var Pt=void 0;try{Pt=Tt.then}catch(Zt){this.l(Zt);return}typeof Pt=="function"?this.G(Pt,Tt):this.m(Tt)},E.prototype.l=function(Tt){this.s(2,Tt)},E.prototype.m=function(Tt){this.s(1,Tt)},E.prototype.s=function(Tt,Pt){if(this.h!=0)throw Error("Cannot settle("+Tt+", "+Pt+"): Promise already settled in state"+this.h);this.h=Tt,this.i=Pt,this.h===2&&this.D(),this.A()},E.prototype.D=function(){var Tt=this;xt(function(){if(Tt.B()){var Pt=o.console;typeof Pt<"u"&&Pt.error(Tt.i)}},1)},E.prototype.B=function(){if(this.o)return!1;var Tt=o.CustomEvent,Pt=o.Event,Zt=o.dispatchEvent;return typeof Zt>"u"?!0:(typeof Tt=="function"?Tt=new Tt("unhandledrejection",{cancelable:!0}):typeof Pt=="function"?Tt=new Pt("unhandledrejection",{cancelable:!0}):(Tt=o.document.createEvent("CustomEvent"),Tt.initCustomEvent("unhandledrejection",!1,!0,Tt)),Tt.promise=this,Tt.reason=this.i,Zt(Tt))},E.prototype.A=function(){if(this.g!=null){for(var Tt=0;Tt<this.g.length;++Tt)Rt.h(this.g[Tt]);this.g=null}};var Rt=new R;return E.prototype.F=function(Tt){var Pt=this.j();Tt.J(Pt.resolve,Pt.reject)},E.prototype.G=function(Tt,Pt){var Zt=this.j();try{Tt.call(Pt,Zt.resolve,Zt.reject)}catch(pe){Zt.reject(pe)}},E.prototype.then=function(Tt,Pt){function Zt(nn,Ge){return typeof nn=="function"?function(_e){try{pe(nn(_e))}catch(T){ze(T)}}:Ge}var pe,ze,xn=new E(function(nn,Ge){pe=nn,ze=Ge});return this.J(Zt(Tt,pe),Zt(Pt,ze)),xn},E.prototype.catch=function(Tt){return this.then(void 0,Tt)},E.prototype.J=function(Tt,Pt){function Zt(){switch(pe.h){case 1:Tt(pe.i);break;case 2:Pt(pe.i);break;default:throw Error("Unexpected state: "+pe.h)}}var pe=this;this.g==null?Rt.h(Zt):this.g.push(Zt),this.o=!0},E.resolve=tt,E.reject=function(Tt){return new E(function(Pt,Zt){Zt(Tt)})},E.race=function(Tt){return new E(function(Pt,Zt){for(var pe=c(Tt),ze=pe.next();!ze.done;ze=pe.next())tt(ze.value).J(Pt,Zt)})},E.all=function(Tt){var Pt=c(Tt),Zt=Pt.next();return Zt.done?tt([]):new E(function(pe,ze){function xn(_e){return function(T){nn[_e]=T,Ge--,Ge==0&&pe(nn)}}var nn=[],Ge=0;do nn.push(void 0),Ge++,tt(Zt.value).J(xn(nn.length-1),ze),Zt=Pt.next();while(!Zt.done)})},E}),a("Object.is",function(C){return C||function(E,R){return E===R?E!==0||1/E===1/R:E!==E&&R!==R}}),a("Array.prototype.includes",function(C){return C||function(E,R){var tt=this;tt instanceof String&&(tt=String(tt));var xt=tt.length;for(R=R||0,0>R&&(R=Math.max(R+xt,0));R<xt;R++){var Rt=tt[R];if(Rt===E||Object.is(Rt,E))return!0}return!1}}),a("String.prototype.includes",function(C){return C||function(E,R){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(E instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(E,R||0)!==-1}}),a("Array.prototype.keys",function(C){return C||function(){return O(this,function(E){return E})}});var F=this||self;function D(C,E){C=C.split(".");var R=F;C[0]in R||typeof R.execScript>"u"||R.execScript("var "+C[0]);for(var tt;C.length&&(tt=C.shift());)C.length||E===void 0?R[tt]&&R[tt]!==Object.prototype[tt]?R=R[tt]:R=R[tt]={}:R[tt]=E}function L(C,E){return E=String.fromCharCode.apply(null,E),C==null?E:C+E}var V,j=typeof TextDecoder<"u",Y,H=typeof TextEncoder<"u";function et(C){if(H)C=(Y||(Y=new TextEncoder)).encode(C);else{var E=void 0;E=E===void 0?!1:E;for(var R=0,tt=new Uint8Array(3*C.length),xt=0;xt<C.length;xt++){var Rt=C.charCodeAt(xt);if(128>Rt)tt[R++]=Rt;else{if(2048>Rt)tt[R++]=Rt>>6|192;else{if(55296<=Rt&&57343>=Rt){if(56319>=Rt&&xt<C.length){var Tt=C.charCodeAt(++xt);if(56320<=Tt&&57343>=Tt){Rt=1024*(Rt-55296)+Tt-56320+65536,tt[R++]=Rt>>18|240,tt[R++]=Rt>>12&63|128,tt[R++]=Rt>>6&63|128,tt[R++]=Rt&63|128;continue}else xt--}if(E)throw Error("Found an unpaired surrogate");Rt=65533}tt[R++]=Rt>>12|224,tt[R++]=Rt>>6&63|128}tt[R++]=Rt&63|128}}C=tt.subarray(0,R)}return C}var it={},J=null;function rt(C,E){E===void 0&&(E=0),bt(),E=it[E];for(var R=Array(Math.floor(C.length/3)),tt=E[64]||"",xt=0,Rt=0;xt<C.length-2;xt+=3){var Tt=C[xt],Pt=C[xt+1],Zt=C[xt+2],pe=E[Tt>>2];Tt=E[(Tt&3)<<4|Pt>>4],Pt=E[(Pt&15)<<2|Zt>>6],Zt=E[Zt&63],R[Rt++]=pe+Tt+Pt+Zt}switch(pe=0,Zt=tt,C.length-xt){case 2:pe=C[xt+1],Zt=E[(pe&15)<<2]||tt;case 1:C=C[xt],R[Rt]=E[C>>2]+E[(C&3)<<4|pe>>4]+Zt+tt}return R.join("")}function ut(C){var E=C.length,R=3*E/4;R%3?R=Math.floor(R):"=.".indexOf(C[E-1])!=-1&&(R="=.".indexOf(C[E-2])!=-1?R-2:R-1);var tt=new Uint8Array(R),xt=0;return vt(C,function(Rt){tt[xt++]=Rt}),tt.subarray(0,xt)}function vt(C,E){function R(Zt){for(;tt<C.length;){var pe=C.charAt(tt++),ze=J[pe];if(ze!=null)return ze;if(!/^[\s\xa0]*$/.test(pe))throw Error("Unknown base64 encoding at char: "+pe)}return Zt}bt();for(var tt=0;;){var xt=R(-1),Rt=R(0),Tt=R(64),Pt=R(64);if(Pt===64&&xt===-1)break;E(xt<<2|Rt>>4),Tt!=64&&(E(Rt<<4&240|Tt>>2),Pt!=64&&E(Tt<<6&192|Pt))}}function bt(){if(!J){J={};for(var C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),E=["+/=","+/","-_=","-_.","-_"],R=0;5>R;R++){var tt=C.concat(E[R].split(""));it[R]=tt;for(var xt=0;xt<tt.length;xt++){var Rt=tt[xt];J[Rt]===void 0&&(J[Rt]=xt)}}}}var ht=typeof Uint8Array.prototype.slice=="function",Wt;function Dt(C,E,R){return E===R?Wt||(Wt=new Uint8Array(0)):ht?C.slice(E,R):new Uint8Array(C.subarray(E,R))}var Vt=0,zt=0;function Jt(C,E){E=E===void 0?{}:E,E=E.v===void 0?!1:E.v,this.h=null,this.g=this.j=this.l=0,this.m=!1,this.v=E,C&&oe(this,C)}function oe(C,E){E=E.constructor===Uint8Array?E:E.constructor===ArrayBuffer?new Uint8Array(E):E.constructor===Array?new Uint8Array(E):E.constructor===String?ut(E):E instanceof Uint8Array?new Uint8Array(E.buffer,E.byteOffset,E.byteLength):new Uint8Array(0),C.h=E,C.l=0,C.j=C.h.length,C.g=C.l}Jt.prototype.reset=function(){this.g=this.l};function ne(C){for(var E=128,R=0,tt=0,xt=0;4>xt&&128<=E;xt++)E=C.h[C.g++],R|=(E&127)<<7*xt;if(128<=E&&(E=C.h[C.g++],R|=(E&127)<<28,tt|=(E&127)>>4),128<=E)for(xt=0;5>xt&&128<=E;xt++)E=C.h[C.g++],tt|=(E&127)<<7*xt+3;if(128>E)return C=R>>>0,E=tt>>>0,(tt=E&2147483648)&&(C=~C+1>>>0,E=~E>>>0,C==0&&(E=E+1>>>0)),C=4294967296*E+(C>>>0),tt?-C:C;C.m=!0}Jt.prototype.i=function(){var C=this.h,E=C[this.g],R=E&127;return 128>E?(this.g+=1,R):(E=C[this.g+1],R|=(E&127)<<7,128>E?(this.g+=2,R):(E=C[this.g+2],R|=(E&127)<<14,128>E?(this.g+=3,R):(E=C[this.g+3],R|=(E&127)<<21,128>E?(this.g+=4,R):(E=C[this.g+4],R|=(E&15)<<28,128>E?(this.g+=5,R>>>0):(this.g+=5,128<=C[this.g++]&&128<=C[this.g++]&&128<=C[this.g++]&&128<=C[this.g++]&&this.g++,R)))))},Jt.prototype.o=function(){var C=this.h[this.g],E=this.h[this.g+1],R=this.h[this.g+2],tt=this.h[this.g+3];return this.g+=4,R=(C<<0|E<<8|R<<16|tt<<24)>>>0,C=2*(R>>31)+1,E=R>>>23&255,R&=8388607,E==255?R?NaN:1/0*C:E==0?C*Math.pow(2,-149)*R:C*Math.pow(2,E-150)*(R+Math.pow(2,23))};var Oe=[];function Ae(){this.g=new Uint8Array(64),this.h=0}Ae.prototype.push=function(C){if(!(this.h+1<this.g.length)){var E=this.g;this.g=new Uint8Array(Math.ceil(1+2*this.g.length)),this.g.set(E)}this.g[this.h++]=C},Ae.prototype.length=function(){return this.h},Ae.prototype.end=function(){var C=this.g,E=this.h;return this.h=0,Dt(C,0,E)};function Ee(C,E){for(;127<E;)C.push(E&127|128),E>>>=7;C.push(E)}function We(C){var E={},R=E.N===void 0?!1:E.N;this.o={v:E.v===void 0?!1:E.v},this.N=R,E=this.o,Oe.length?(R=Oe.pop(),E&&(R.v=E.v),C&&oe(R,C),C=R):C=new Jt(C,E),this.g=C,this.m=this.g.g,this.h=this.i=this.l=-1,this.j=!1}We.prototype.reset=function(){this.g.reset(),this.h=this.l=-1};function Ne(C){var E=C.g;if((E=E.g==E.j)||(E=C.j)||(E=C.g,E=E.m||0>E.g||E.g>E.j),E)return!1;C.m=C.g.g,E=C.g.i();var R=E&7;return R!=0&&R!=5&&R!=1&&R!=2&&R!=3&&R!=4?(C.j=!0,!1):(C.i=E,C.l=E>>>3,C.h=R,!0)}function Le(C){switch(C.h){case 0:if(C.h!=0)Le(C);else{for(C=C.g;C.h[C.g]&128;)C.g++;C.g++}break;case 1:C.h!=1?Le(C):(C=C.g,C.g+=8);break;case 2:if(C.h!=2)Le(C);else{var E=C.g.i();C=C.g,C.g+=E}break;case 5:C.h!=5?Le(C):(C=C.g,C.g+=4);break;case 3:E=C.l;do{if(!Ne(C)){C.j=!0;break}if(C.h==4){C.l!=E&&(C.j=!0);break}Le(C)}while(1);break;default:C.j=!0}}function yn(C,E,R){var tt=C.g.j,xt=C.g.i(),Rt=C.g.g+xt;if(C.g.j=Rt,R(E,C),R=Rt-C.g.g,R!==0)throw Error("Message parsing ended unexpectedly. Expected to read "+xt+" bytes, instead read "+(xt-R)+" bytes, either the data ended unexpectedly or the message misreported its own length");return C.g.g=Rt,C.g.j=tt,E}function Qe(C){return C.g.o()}function Z(C){var E=C.g.i();C=C.g;var R=C.g;C.g+=E,C=C.h;var tt;if(j)(tt=V)||(tt=V=new TextDecoder("utf-8",{fatal:!1})),tt=tt.decode(C.subarray(R,R+E));else{E=R+E;for(var xt=[],Rt=null,Tt,Pt,Zt;R<E;)Tt=C[R++],128>Tt?xt.push(Tt):224>Tt?R>=E?xt.push(65533):(Pt=C[R++],194>Tt||(Pt&192)!==128?(R--,xt.push(65533)):xt.push((Tt&31)<<6|Pt&63)):240>Tt?R>=E-1?xt.push(65533):(Pt=C[R++],(Pt&192)!==128||Tt===224&&160>Pt||Tt===237&&160<=Pt||((tt=C[R++])&192)!==128?(R--,xt.push(65533)):xt.push((Tt&15)<<12|(Pt&63)<<6|tt&63)):244>=Tt?R>=E-2?xt.push(65533):(Pt=C[R++],(Pt&192)!==128||(Tt<<28)+(Pt-144)>>30||((tt=C[R++])&192)!==128||((Zt=C[R++])&192)!==128?(R--,xt.push(65533)):(Tt=(Tt&7)<<18|(Pt&63)<<12|(tt&63)<<6|Zt&63,Tt-=65536,xt.push((Tt>>10&1023)+55296,(Tt&1023)+56320))):xt.push(65533),8192<=xt.length&&(Rt=L(Rt,xt),xt.length=0);tt=L(Rt,xt)}return tt}function G(C,E,R){var tt=C.g.i();for(tt=C.g.g+tt;C.g.g<tt;)R.push(E.call(C.g))}function Et(C,E){C.h==2?G(C,Jt.prototype.o,E):E.push(Qe(C))}function jt(){this.h=[],this.i=0,this.g=new Ae}function qt(C,E){E.length!==0&&(C.h.push(E),C.i+=E.length)}function te(C){var E=C.i+C.g.length();if(E===0)return new Uint8Array(0);E=new Uint8Array(E);for(var R=C.h,tt=R.length,xt=0,Rt=0;Rt<tt;Rt++){var Tt=R[Rt];Tt.length!==0&&(E.set(Tt,xt),xt+=Tt.length)}return R=C.g,tt=R.h,tt!==0&&(E.set(R.g.subarray(0,tt),xt),R.h=0),C.h=[E],E}function ye(C,E,R){if(R!=null){Ee(C.g,8*E+5),C=C.g;var tt=R;tt=(R=0>tt?1:0)?-tt:tt,tt===0?0<1/tt?Vt=zt=0:(zt=0,Vt=2147483648):isNaN(tt)?(zt=0,Vt=2147483647):34028234663852886e22<tt?(zt=0,Vt=(R<<31|2139095040)>>>0):11754943508222875e-54>tt?(tt=Math.round(tt/Math.pow(2,-149)),zt=0,Vt=(R<<31|tt)>>>0):(E=Math.floor(Math.log(tt)/Math.LN2),tt*=Math.pow(2,-E),tt=Math.round(8388608*tt),16777216<=tt&&++E,zt=0,Vt=(R<<31|E+127<<23|tt&8388607)>>>0),R=Vt,C.push(R>>>0&255),C.push(R>>>8&255),C.push(R>>>16&255),C.push(R>>>24&255)}}var se=typeof Uint8Array=="function";function Lt(C,E,R){if(C!=null)return typeof C=="object"?se&&C instanceof Uint8Array?R(C):ke(C,E,R):E(C)}function ke(C,E,R){if(Array.isArray(C)){for(var tt=Array(C.length),xt=0;xt<C.length;xt++)tt[xt]=Lt(C[xt],E,R);return Array.isArray(C)&&C.W&&ge(tt),tt}tt={};for(xt in C)tt[xt]=Lt(C[xt],E,R);return tt}function Me(C){return typeof C=="number"?isFinite(C)?C:String(C):C}var xe={W:{value:!0,configurable:!0}};function ge(C){return Array.isArray(C)&&!Object.isFrozen(C)&&Object.defineProperties(C,xe),C}var ae;function De(C,E,R){var tt=ae;ae=null,C||(C=tt),tt=this.constructor.ca,C||(C=tt?[tt]:[]),this.j=tt?0:-1,this.m=this.g=null,this.h=C;t:{if(tt=this.h.length,C=tt-1,tt&&(tt=this.h[C],!(tt===null||typeof tt!="object"||Array.isArray(tt)||se&&tt instanceof Uint8Array))){this.l=C-this.j,this.i=tt;break t}E!==void 0&&-1<E?(this.l=Math.max(E,C+1-this.j),this.i=null):this.l=Number.MAX_VALUE}if(R)for(E=0;E<R.length;E++)C=R[E],C<this.l?(C+=this.j,(tt=this.h[C])?ge(tt):this.h[C]=tn):(Yn(this),(tt=this.i[C])?ge(tt):this.i[C]=tn)}var tn=Object.freeze(ge([]));function Yn(C){var E=C.l+C.j;C.h[E]||(C.i=C.h[E]={})}function lt(C,E,R){return E===-1?null:R!==void 0&&R||E>=C.l?C.i?C.i[E]:void 0:C.h[E+C.j]}function At(C,E){var R=R===void 0?!1:R,tt=lt(C,E,R);return tt==null&&(tt=tn),tt===tn&&(tt=ge([]),me(C,E,tt,R)),tt}function Yt(C){var E=At(C,3);if(C.m||(C.m={}),!C.m[3]){for(var R=0;R<E.length;R++)E[R]=+E[R];C.m[3]=!0}return E}function le(C,E,R){return C=lt(C,E),C??R}function ve(C,E,R){return C=lt(C,E),C=C==null?C:+C,C??(R===void 0?0:R)}function me(C,E,R,tt){tt!==void 0&&tt||E>=C.l?(Yn(C),C.i[E]=R):C.h[E+C.j]=R}function gs(C,E,R){if(R===-1)return null;if(C.g||(C.g={}),!C.g[R]){var tt=lt(C,R,!1);tt&&(C.g[R]=new E(tt))}return C.g[R]}function vs(C,E){C.g||(C.g={});var R=C.g[1];if(!R){var tt=At(C,1);R=[];for(var xt=0;xt<tt.length;xt++)R[xt]=new E(tt[xt]);C.g[1]=R}return R}function Wr(C,E,R){var tt=tt===void 0?!1:tt;C.g||(C.g={});var xt=R&&Es(R);C.g[E]=R,me(C,E,xt,tt)}function En(C,E,R,tt){var xt=vs(C,R);E=E||new R,C=At(C,1),tt!=null?(xt.splice(tt,0,E),C.splice(tt,0,Es(E))):(xt.push(E),C.push(Es(E)))}De.prototype.toJSON=function(){var C=Es(this);return ke(C,Me,rt)};function Es(C,E){if(C.g)for(var R in C.g){var tt=C.g[R];if(Array.isArray(tt))for(var xt=0;xt<tt.length;xt++)tt[xt]&&Es(tt[xt]);else tt&&Es(tt)}return C.h}De.prototype.toString=function(){return Es(this).toString()};function Ps(C,E){if(C=C.o){qt(E,E.g.end());for(var R=0;R<C.length;R++)qt(E,C[R])}}function Cr(C,E){if(E.h==4)return!1;var R=E.m;return Le(E),E.N||(E=Dt(E.g.h,R,E.g.g),(R=C.o)?R.push(E):C.o=[E]),!0}function Gi(C){De.call(this,C,-1,Of)}y(Gi,De),Gi.prototype.getRows=function(){return lt(this,1)},Gi.prototype.getCols=function(){return lt(this,2)},Gi.prototype.getPackedDataList=function(){return Yt(this)},Gi.prototype.getLayout=function(){return le(this,4,0)};function Nh(C,E){for(;Ne(E);)switch(E.i){case 8:var R=E.g.i();me(C,1,R);break;case 16:R=E.g.i(),me(C,2,R);break;case 29:case 26:Et(E,C.getPackedDataList());break;case 32:R=ne(E.g),me(C,4,R);break;default:if(!Cr(C,E))return C}return C}var Of=[3];function q(C,E){var R=void 0;return new(R||(R=Promise))(function(tt,xt){function Rt(Zt){try{Pt(E.next(Zt))}catch(pe){xt(pe)}}function Tt(Zt){try{Pt(E.throw(Zt))}catch(pe){xt(pe)}}function Pt(Zt){Zt.done?tt(Zt.value):new R(function(pe){pe(Zt.value)}).then(Rt,Tt)}Pt((E=E.apply(C,void 0)).next())})}function St(C){De.call(this,C)}y(St,De);function Mt(C,E){for(;Ne(E);)switch(E.i){case 8:var R=E.g.i();me(C,1,R);break;case 21:R=Qe(E),me(C,2,R);break;case 26:R=Z(E),me(C,3,R);break;case 34:R=Z(E),me(C,4,R);break;default:if(!Cr(C,E))return C}return C}function wt(C){De.call(this,C,-1,Ft)}y(wt,De),wt.prototype.addClassification=function(C,E){return En(this,C,St,E),this};var Ft=[1];function Ce(C){De.call(this,C)}y(Ce,De);function Be(C,E){for(;Ne(E);)switch(E.i){case 13:var R=Qe(E);me(C,1,R);break;case 21:R=Qe(E),me(C,2,R);break;case 29:R=Qe(E),me(C,3,R);break;case 37:R=Qe(E),me(C,4,R);break;case 45:R=Qe(E),me(C,5,R);break;default:if(!Cr(C,E))return C}return C}function Ke(C){De.call(this,C,-1,fn)}y(Ke,De);function Xe(C){t:{var E=new Ke;for(C=new We(C);Ne(C);)switch(C.i){case 10:var R=yn(C,new Ce,Be);En(E,R,Ce,void 0);break;default:if(!Cr(E,C))break t}}return E}var fn=[1];function Ye(C){De.call(this,C)}y(Ye,De);function He(C){De.call(this,C,-1,mr)}y(He,De),He.prototype.getVertexType=function(){return le(this,1,0)},He.prototype.getPrimitiveType=function(){return le(this,2,0)},He.prototype.getVertexBufferList=function(){return Yt(this)},He.prototype.getIndexBufferList=function(){return At(this,4)};function ls(C,E){for(;Ne(E);)switch(E.i){case 8:var R=ne(E.g);me(C,1,R);break;case 16:R=ne(E.g),me(C,2,R);break;case 29:case 26:Et(E,C.getVertexBufferList());break;case 32:case 34:R=E;var tt=C.getIndexBufferList();R.h==2?G(R,Jt.prototype.i,tt):tt.push(R.g.i());break;default:if(!Cr(C,E))return C}return C}var mr=[3,4];function kr(C){De.call(this,C)}y(kr,De),kr.prototype.getMesh=function(){return gs(this,He,1)},kr.prototype.getPoseTransformMatrix=function(){return gs(this,Gi,2)};function Hi(C){t:{var E=new kr;for(C=new We(C);Ne(C);)switch(C.i){case 10:var R=yn(C,new He,ls);Wr(E,1,R);break;case 18:R=yn(C,new Gi,Nh),Wr(E,2,R);break;default:if(!Cr(E,C))break t}}return E}function Zn(C,E,R){if(R=C.createShader(R===0?C.VERTEX_SHADER:C.FRAGMENT_SHADER),C.shaderSource(R,E),C.compileShader(R),!C.getShaderParameter(R,C.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+C.getShaderInfoLog(R));return R}function en(C){return vs(C,St).map(function(E){return{index:le(E,1,0),Y:ve(E,2),label:lt(E,3)!=null?le(E,3,""):void 0,displayName:lt(E,4)!=null?le(E,4,""):void 0}})}function Wa(C){return{x:ve(C,1),y:ve(C,2),z:ve(C,3),visibility:lt(C,4)!=null?ve(C,4):void 0}}function Jn(C,E){this.h=C,this.g=E,this.l=0}function $r(C,E,R){return Ir(C,E),typeof C.g.canvas.transferToImageBitmap=="function"?Promise.resolve(C.g.canvas.transferToImageBitmap()):R?Promise.resolve(C.g.canvas):typeof createImageBitmap=="function"?createImageBitmap(C.g.canvas):(C.i===void 0&&(C.i=document.createElement("canvas")),new Promise(function(tt){C.i.height=C.g.canvas.height,C.i.width=C.g.canvas.width,C.i.getContext("2d",{}).drawImage(C.g.canvas,0,0,C.g.canvas.width,C.g.canvas.height),tt(C.i)}))}function Ir(C,E){var R=C.g;if(C.m===void 0){var tt=Zn(R,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),xt=Zn(R,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),Rt=R.createProgram();if(R.attachShader(Rt,tt),R.attachShader(Rt,xt),R.linkProgram(Rt),!R.getProgramParameter(Rt,R.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+R.getProgramInfoLog(Rt));tt=C.m=Rt,R.useProgram(tt),xt=R.getUniformLocation(tt,"sampler0"),C.j={I:R.getAttribLocation(tt,"aVertex"),H:R.getAttribLocation(tt,"aTex"),da:xt},C.s=R.createBuffer(),R.bindBuffer(R.ARRAY_BUFFER,C.s),R.enableVertexAttribArray(C.j.I),R.vertexAttribPointer(C.j.I,2,R.FLOAT,!1,0,0),R.bufferData(R.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),R.STATIC_DRAW),R.bindBuffer(R.ARRAY_BUFFER,null),C.o=R.createBuffer(),R.bindBuffer(R.ARRAY_BUFFER,C.o),R.enableVertexAttribArray(C.j.H),R.vertexAttribPointer(C.j.H,2,R.FLOAT,!1,0,0),R.bufferData(R.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),R.STATIC_DRAW),R.bindBuffer(R.ARRAY_BUFFER,null),R.uniform1i(xt,0)}tt=C.j,R.useProgram(C.m),R.canvas.width=E.width,R.canvas.height=E.height,R.viewport(0,0,E.width,E.height),R.activeTexture(R.TEXTURE0),C.h.bindTexture2d(E.glName),R.enableVertexAttribArray(tt.I),R.bindBuffer(R.ARRAY_BUFFER,C.s),R.vertexAttribPointer(tt.I,2,R.FLOAT,!1,0,0),R.enableVertexAttribArray(tt.H),R.bindBuffer(R.ARRAY_BUFFER,C.o),R.vertexAttribPointer(tt.H,2,R.FLOAT,!1,0,0),R.bindFramebuffer(R.DRAW_FRAMEBUFFER?R.DRAW_FRAMEBUFFER:R.FRAMEBUFFER,null),R.clearColor(0,0,0,0),R.clear(R.COLOR_BUFFER_BIT),R.colorMask(!0,!0,!0,!0),R.drawArrays(R.TRIANGLE_FAN,0,4),R.disableVertexAttribArray(tt.I),R.disableVertexAttribArray(tt.H),R.bindBuffer(R.ARRAY_BUFFER,null),C.h.bindTexture2d(0)}function Ga(C){this.g=C}var Zc=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Ns(C,E){return E+C}function Ti(C,E){window[C]=E}function Qs(C){var E=document.createElement("script");return E.setAttribute("src",C),E.setAttribute("crossorigin","anonymous"),new Promise(function(R){E.addEventListener("load",function(){R()},!1),E.addEventListener("error",function(){R()},!1),document.body.appendChild(E)})}function tr(){return q(this,function C(){return I(C,function(E){switch(E.g){case 1:return E.m=2,w(E,WebAssembly.instantiate(Zc),4);case 4:E.g=3,E.m=0;break;case 2:return E.m=0,E.j=null,E.return(!1);case 3:return E.return(!0)}})})}function Ci(C){if(this.g=C,this.listeners={},this.j={},this.F={},this.m={},this.s={},this.G=this.o=this.R=!0,this.C=Promise.resolve(),this.P="",this.B={},this.locateFile=C&&C.locateFile||Ns,typeof window=="object")var E=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")E=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.S=E,C.options){E=c(Object.keys(C.options));for(var R=E.next();!R.done;R=E.next()){R=R.value;var tt=C.options[R].default;tt!==void 0&&(this.j[R]=typeof tt=="function"?tt():tt)}}}r=Ci.prototype,r.close=function(){return this.i&&this.i.delete(),Promise.resolve()};function Ah(C,E){return C.g.files===void 0?[]:typeof C.g.files=="function"?C.g.files(E):C.g.files}function Ol(C){return q(C,function E(){var R=this,tt,xt,Rt,Tt,Pt,Zt,pe,ze,xn,nn,Ge;return I(E,function(_e){switch(_e.g){case 1:return tt=R,R.R?(xt=Ah(R,R.j),w(_e,tr(),2)):_e.return();case 2:if(Rt=_e.h,typeof window=="object")return Ti("createMediapipeSolutionsWasm",{locateFile:R.locateFile}),Ti("createMediapipeSolutionsPackedAssets",{locateFile:R.locateFile}),Zt=xt.filter(function(T){return T.data!==void 0}),pe=xt.filter(function(T){return T.data===void 0}),ze=Promise.all(Zt.map(function(T){var M=Ll(tt,T.url);if(T.path!==void 0){var P=T.path;M=M.then(function(z){return tt.overrideFile(P,z),Promise.resolve(z)})}return M})),xn=Promise.all(pe.map(function(T){return T.simd===void 0||T.simd&&Rt||!T.simd&&!Rt?Qs(tt.locateFile(T.url,tt.S)):Promise.resolve()})).then(function(){return q(tt,function T(){var M,P,z=this;return I(T,function(Q){if(Q.g==1)return M=window.createMediapipeSolutionsWasm,P=window.createMediapipeSolutionsPackedAssets,w(Q,M(P),2);z.h=Q.h,Q.g=0})})}),nn=function(){return q(tt,function T(){var M=this;return I(T,function(P){return M.g.graph&&M.g.graph.url?P=w(P,Ll(M,M.g.graph.url),0):(P.g=0,P=void 0),P})})}(),w(_e,Promise.all([xn,ze,nn]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return Tt=xt.filter(function(T){return T.simd===void 0||T.simd&&Rt||!T.simd&&!Rt}).map(function(T){return tt.locateFile(T.url,tt.S)}),importScripts.apply(null,u(Tt)),w(_e,createMediapipeSolutionsWasm(Module),6);case 6:R.h=_e.h,R.l=new OffscreenCanvas(1,1),R.h.canvas=R.l,Pt=R.h.GL.createContext(R.l,{antialias:!1,alpha:!1,ba:typeof WebGL2RenderingContext<"u"?2:1}),R.h.GL.makeContextCurrent(Pt),_e.g=4;break;case 7:if(R.l=document.createElement("canvas"),Ge=R.l.getContext("webgl2",{}),!Ge&&(Ge=R.l.getContext("webgl",{}),!Ge))return alert("Failed to create WebGL canvas context when passing video frame."),_e.return();R.D=Ge,R.h.canvas=R.l,R.h.createContext(R.l,!0,!0,{});case 4:R.i=new R.h.SolutionWasm,R.R=!1,_e.g=0}})})}function Jy(C){return q(C,function E(){var R=this,tt,xt,Rt,Tt,Pt,Zt,pe,ze;return I(E,function(xn){if(xn.g==1){if(R.g.graph&&R.g.graph.url&&R.P===R.g.graph.url)return xn.return();if(R.o=!0,!R.g.graph||!R.g.graph.url){xn.g=2;return}return R.P=R.g.graph.url,w(xn,Ll(R,R.g.graph.url),3)}for(xn.g!=2&&(tt=xn.h,R.i.loadGraph(tt)),xt=c(Object.keys(R.B)),Rt=xt.next();!Rt.done;Rt=xt.next())Tt=Rt.value,R.i.overrideFile(Tt,R.B[Tt]);if(R.B={},R.g.listeners)for(Pt=c(R.g.listeners),Zt=Pt.next();!Zt.done;Zt=Pt.next())pe=Zt.value,tx(R,pe);ze=R.j,R.j={},R.setOptions(ze),xn.g=0})})}r.reset=function(){return q(this,function C(){var E=this;return I(C,function(R){E.i&&(E.i.reset(),E.m={},E.s={}),R.g=0})})},r.setOptions=function(C,E){var R=this;if(E=E||this.g.options){for(var tt=[],xt=[],Rt={},Tt=c(Object.keys(C)),Pt=Tt.next();!Pt.done;Rt={K:Rt.K,L:Rt.L},Pt=Tt.next()){var Zt=Pt.value;Zt in this.j&&this.j[Zt]===C[Zt]||(this.j[Zt]=C[Zt],Pt=E[Zt],Pt!==void 0&&(Pt.onChange&&(Rt.K=Pt.onChange,Rt.L=C[Zt],tt.push(function(pe){return function(){return q(R,function ze(){var xn,nn=this;return I(ze,function(Ge){if(Ge.g==1)return w(Ge,pe.K(pe.L),2);xn=Ge.h,xn===!0&&(nn.o=!0),Ge.g=0})})}}(Rt))),Pt.graphOptionXref&&(Zt={valueNumber:Pt.type===1?C[Zt]:0,valueBoolean:Pt.type===0?C[Zt]:!1,valueString:Pt.type===2?C[Zt]:""},Pt=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),Pt.graphOptionXref),Zt),xt.push(Pt))))}(tt.length!==0||xt.length!==0)&&(this.o=!0,this.A=(this.A===void 0?[]:this.A).concat(xt),this.u=(this.u===void 0?[]:this.u).concat(tt))}};function Qy(C){return q(C,function E(){var R=this,tt,xt,Rt,Tt,Pt,Zt,pe;return I(E,function(ze){switch(ze.g){case 1:if(!R.o)return ze.return();if(!R.u){ze.g=2;break}tt=c(R.u),xt=tt.next();case 3:if(xt.done){ze.g=5;break}return Rt=xt.value,w(ze,Rt(),4);case 4:xt=tt.next(),ze.g=3;break;case 5:R.u=void 0;case 2:if(R.A){for(Tt=new R.h.GraphOptionChangeRequestList,Pt=c(R.A),Zt=Pt.next();!Zt.done;Zt=Pt.next())pe=Zt.value,Tt.push_back(pe);R.i.changeOptions(Tt),Tt.delete(),R.A=void 0}R.o=!1,ze.g=0}})})}r.initialize=function(){return q(this,function C(){var E=this;return I(C,function(R){return R.g==1?w(R,Ol(E),2):R.g!=3?w(R,Jy(E),3):w(R,Qy(E),0)})})};function Ll(C,E){return q(C,function R(){var tt=this,xt,Rt;return I(R,function(Tt){return E in tt.F?Tt.return(tt.F[E]):(xt=tt.locateFile(E,""),Rt=fetch(xt).then(function(Pt){return Pt.arrayBuffer()}),tt.F[E]=Rt,Tt.return(Rt))})})}r.overrideFile=function(C,E){this.i?this.i.overrideFile(C,E):this.B[C]=E},r.clearOverriddenFiles=function(){this.B={},this.i&&this.i.clearOverriddenFiles()},r.send=function(C,E){return q(this,function R(){var tt=this,xt,Rt,Tt,Pt,Zt,pe,ze,xn,nn;return I(R,function(Ge){switch(Ge.g){case 1:return tt.g.inputs?(xt=1e3*(E??performance.now()),w(Ge,tt.C,2)):Ge.return();case 2:return w(Ge,tt.initialize(),3);case 3:for(Rt=new tt.h.PacketDataList,Tt=c(Object.keys(C)),Pt=Tt.next();!Pt.done;Pt=Tt.next())if(Zt=Pt.value,pe=tt.g.inputs[Zt]){t:{var _e=tt,T=C[Zt];switch(pe.type){case"video":var M=_e.m[pe.stream];if(M||(M=new Jn(_e.h,_e.D),_e.m[pe.stream]=M),_e=M,_e.l===0&&(_e.l=_e.h.createTexture()),typeof HTMLVideoElement<"u"&&T instanceof HTMLVideoElement){var P=T.videoWidth;M=T.videoHeight}else typeof HTMLImageElement<"u"&&T instanceof HTMLImageElement?(P=T.naturalWidth,M=T.naturalHeight):(P=T.width,M=T.height);M={glName:_e.l,width:P,height:M},P=_e.g,P.canvas.width=M.width,P.canvas.height=M.height,P.activeTexture(P.TEXTURE0),_e.h.bindTexture2d(_e.l),P.texImage2D(P.TEXTURE_2D,0,P.RGBA,P.RGBA,P.UNSIGNED_BYTE,T),_e.h.bindTexture2d(0),_e=M;break t;case"detections":for(M=_e.m[pe.stream],M||(M=new Ga(_e.h),_e.m[pe.stream]=M),_e=M,_e.data||(_e.data=new _e.g.DetectionListData),_e.data.reset(T.length),M=0;M<T.length;++M){P=T[M];var z=_e.data,Q=z.setBoundingBox,X=M,nt=P.T,at=new Ye;me(at,1,nt.Z),me(at,2,nt.$),me(at,3,nt.height),me(at,4,nt.width),me(at,5,nt.rotation),me(at,6,nt.X);var Ct=nt=new jt;ye(Ct,1,lt(at,1)),ye(Ct,2,lt(at,2)),ye(Ct,3,lt(at,3)),ye(Ct,4,lt(at,4)),ye(Ct,5,lt(at,5));var Ot=lt(at,6);if(Ot!=null&&Ot!=null){Ee(Ct.g,48);var Ut=Ct.g,Qt=Ot;Ot=0>Qt,Qt=Math.abs(Qt);var ee=Qt>>>0;for(Qt=Math.floor((Qt-ee)/4294967296),Qt>>>=0,Ot&&(Qt=~Qt>>>0,ee=(~ee>>>0)+1,4294967295<ee&&(ee=0,Qt++,4294967295<Qt&&(Qt=0))),Vt=ee,zt=Qt,Ot=Vt,ee=zt;0<ee||127<Ot;)Ut.push(Ot&127|128),Ot=(Ot>>>7|ee<<25)>>>0,ee>>>=7;Ut.push(Ot)}if(Ps(at,Ct),nt=te(nt),Q.call(z,X,nt),P.O)for(z=0;z<P.O.length;++z)at=P.O[z],Ct=!!at.visibility,Q=_e.data,X=Q.addNormalizedLandmark,nt=M,at=Object.assign(Object.assign({},at),{visibility:Ct?at.visibility:0}),Ct=new Ce,me(Ct,1,at.x),me(Ct,2,at.y),me(Ct,3,at.z),at.visibility&&me(Ct,4,at.visibility),Ut=at=new jt,ye(Ut,1,lt(Ct,1)),ye(Ut,2,lt(Ct,2)),ye(Ut,3,lt(Ct,3)),ye(Ut,4,lt(Ct,4)),ye(Ut,5,lt(Ct,5)),Ps(Ct,Ut),at=te(at),X.call(Q,nt,at);if(P.M)for(z=0;z<P.M.length;++z){if(Q=_e.data,X=Q.addClassification,nt=M,at=P.M[z],Ct=new St,me(Ct,2,at.Y),at.index&&me(Ct,1,at.index),at.label&&me(Ct,3,at.label),at.displayName&&me(Ct,4,at.displayName),Ut=at=new jt,ee=lt(Ct,1),ee!=null&&ee!=null)if(Ee(Ut.g,8),Ot=Ut.g,0<=ee)Ee(Ot,ee);else{for(Qt=0;9>Qt;Qt++)Ot.push(ee&127|128),ee>>=7;Ot.push(1)}ye(Ut,2,lt(Ct,2)),Ot=lt(Ct,3),Ot!=null&&(Ot=et(Ot),Ee(Ut.g,26),Ee(Ut.g,Ot.length),qt(Ut,Ut.g.end()),qt(Ut,Ot)),Ot=lt(Ct,4),Ot!=null&&(Ot=et(Ot),Ee(Ut.g,34),Ee(Ut.g,Ot.length),qt(Ut,Ut.g.end()),qt(Ut,Ot)),Ps(Ct,Ut),at=te(at),X.call(Q,nt,at)}}_e=_e.data;break t;default:_e={}}}switch(ze=_e,xn=pe.stream,pe.type){case"video":Rt.pushTexture2d(Object.assign(Object.assign({},ze),{stream:xn,timestamp:xt}));break;case"detections":nn=ze,nn.stream=xn,nn.timestamp=xt,Rt.pushDetectionList(nn);break;default:throw Error("Unknown input config type: '"+pe.type+"'")}}return tt.i.send(Rt),w(Ge,tt.C,4);case 4:Rt.delete(),Ge.g=0}})})};function Jg(C,E,R){return q(C,function tt(){var xt,Rt,Tt,Pt,Zt,pe,ze=this,xn,nn,Ge,_e,T,M,P,z;return I(tt,function(Q){switch(Q.g){case 1:if(!R)return Q.return(E);for(xt={},Rt=0,Tt=c(Object.keys(R)),Pt=Tt.next();!Pt.done;Pt=Tt.next())Zt=Pt.value,pe=R[Zt],typeof pe!="string"&&pe.type==="texture"&&E[pe.stream]!==void 0&&++Rt;1<Rt&&(ze.G=!1),xn=c(Object.keys(R)),Pt=xn.next();case 2:if(Pt.done){Q.g=4;break}if(nn=Pt.value,Ge=R[nn],typeof Ge=="string")return P=xt,z=nn,w(Q,Qg(ze,nn,E[Ge]),14);if(_e=E[Ge.stream],Ge.type==="detection_list"){if(_e){for(var X=_e.getRectList(),nt=_e.getLandmarksList(),at=_e.getClassificationsList(),Ct=[],Ot=0;Ot<X.size();++Ot){var Ut=X.get(Ot);t:{var Qt=new Ye;for(Ut=new We(Ut);Ne(Ut);)switch(Ut.i){case 13:var ee=Qe(Ut);me(Qt,1,ee);break;case 21:ee=Qe(Ut),me(Qt,2,ee);break;case 29:ee=Qe(Ut),me(Qt,3,ee);break;case 37:ee=Qe(Ut),me(Qt,4,ee);break;case 45:ee=Qe(Ut),me(Qt,5,ee);break;case 48:ee=ne(Ut.g),me(Qt,6,ee);break;default:if(!Cr(Qt,Ut))break t}}Qt={Z:ve(Qt,1),$:ve(Qt,2),height:ve(Qt,3),width:ve(Qt,4),rotation:ve(Qt,5,0),X:le(Qt,6,0)},Ut=vs(Xe(nt.get(Ot)),Ce).map(Wa);var he=at.get(Ot);t:for(ee=new wt,he=new We(he);Ne(he);)switch(he.i){case 10:ee.addClassification(yn(he,new St,Mt));break;default:if(!Cr(ee,he))break t}Qt={T:Qt,O:Ut,M:en(ee)},Ct.push(Qt)}X=Ct}else X=[];xt[nn]=X,Q.g=7;break}if(Ge.type==="proto_list"){if(_e){for(X=Array(_e.size()),nt=0;nt<_e.size();nt++)X[nt]=_e.get(nt);_e.delete()}else X=[];xt[nn]=X,Q.g=7;break}if(_e===void 0){Q.g=3;break}if(Ge.type==="float_list"){xt[nn]=_e,Q.g=7;break}if(Ge.type==="proto"){xt[nn]=_e,Q.g=7;break}if(Ge.type!=="texture")throw Error("Unknown output config type: '"+Ge.type+"'");return T=ze.s[nn],T||(T=new Jn(ze.h,ze.D),ze.s[nn]=T),w(Q,$r(T,_e,ze.G),13);case 13:M=Q.h,xt[nn]=M;case 7:Ge.transform&&xt[nn]&&(xt[nn]=Ge.transform(xt[nn])),Q.g=3;break;case 14:P[z]=Q.h;case 3:Pt=xn.next(),Q.g=2;break;case 4:return Q.return(xt)}})})}function Qg(C,E,R){return q(C,function tt(){var xt=this,Rt;return I(tt,function(Tt){return typeof R=="number"||R instanceof Uint8Array||R instanceof xt.h.Uint8BlobList?Tt.return(R):R instanceof xt.h.Texture2dDataOut?(Rt=xt.s[E],Rt||(Rt=new Jn(xt.h,xt.D),xt.s[E]=Rt),Tt.return($r(Rt,R,xt.G))):Tt.return(void 0)})})}function tx(C,E){for(var R=E.name||"$",tt=[].concat(u(E.wants)),xt=new C.h.StringList,Rt=c(E.wants),Tt=Rt.next();!Tt.done;Tt=Rt.next())xt.push_back(Tt.value);Rt=C.h.PacketListener.implement({onResults:function(Pt){for(var Zt={},pe=0;pe<E.wants.length;++pe)Zt[tt[pe]]=Pt.get(pe);var ze=C.listeners[R];ze&&(C.C=Jg(C,Zt,E.outs).then(function(xn){xn=ze(xn);for(var nn=0;nn<E.wants.length;++nn){var Ge=Zt[tt[nn]];typeof Ge=="object"&&Ge.hasOwnProperty&&Ge.hasOwnProperty("delete")&&Ge.delete()}xn&&(C.C=xn)}))}}),C.i.attachMultiListener(xt,Rt),xt.delete()}r.onResults=function(C,E){this.listeners[E||"$"]=C},D("Solution",Ci),D("OptionType",{BOOL:0,NUMBER:1,aa:2,0:"BOOL",1:"NUMBER",2:"STRING"});function ex(C){C=Hi(C);var E=C.getMesh();if(!E)return C;var R=new Float32Array(E.getVertexBufferList());E.getVertexBufferList=function(){return R};var tt=new Uint32Array(E.getIndexBufferList());return E.getIndexBufferList=function(){return tt},C}var Lf={files:[{url:"face_mesh_solution_packed_assets_loader.js"},{simd:!0,url:"face_mesh_solution_simd_wasm_bin.js"},{simd:!1,url:"face_mesh_solution_wasm_bin.js"}],graph:{url:"face_mesh.binarypb"},listeners:[{wants:["multi_face_geometry","image_transformed","multi_face_landmarks"],outs:{image:"image_transformed",multiFaceGeometry:{type:"proto_list",stream:"multi_face_geometry",transform:function(C){return C.map(ex)}},multiFaceLandmarks:{type:"proto_list",stream:"multi_face_landmarks",transform:function(C){return C.map(function(E){return vs(Xe(E),Ce).map(Wa)})}}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},enableFaceGeometry:{type:0,graphOptionXref:{calculatorName:"EnableFaceGeometryConstant",calculatorType:"ConstantSidePacketCalculator",fieldName:"bool_value"}},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},maxNumFaces:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorNumFaces",fieldName:"int_value"}},refineLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorRefineLandmarks",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"facelandmarkfrontgpu__facedetectionshortrangegpu__facedetectionshortrangecommon__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"facelandmarkfrontgpu__facelandmarkgpu__ThresholdingCalculator",fieldName:"threshold"}},cameraNear:{type:1,graphOptionXref:{calculatorType:"FaceGeometryEnvGeneratorCalculator",fieldName:"near"}},cameraFar:{type:1,graphOptionXref:{calculatorType:"FaceGeometryEnvGeneratorCalculator",fieldName:"far"}},cameraVerticalFovDegrees:{type:1,graphOptionXref:{calculatorType:"FaceGeometryEnvGeneratorCalculator",fieldName:"vertical_fov_degrees"}}}},Ff=[[61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]],Pf=[[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]],Bf=[[276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]],zf=[[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]],Vf=[[46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]],Uf=[[10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]],t0=[].concat(u(Ff),u(Pf),u(Bf),u(zf),u(Vf),u(Uf));function e0(C){C=C||{},C=Object.assign(Object.assign({},Lf),C),this.g=new Ci(C)}r=e0.prototype,r.close=function(){return this.g.close(),Promise.resolve()},r.onResults=function(C){this.g.onResults(C)},r.initialize=function(){return q(this,function C(){var E=this;return I(C,function(R){return w(R,E.g.initialize(),0)})})},r.reset=function(){this.g.reset()},r.send=function(C){return q(this,function E(){var R=this;return I(E,function(tt){return w(tt,R.g.send(C),0)})})},r.setOptions=function(C){this.g.setOptions(C)},D("FACE_GEOMETRY",{Layout:{COLUMN_MAJOR:0,ROW_MAJOR:1,0:"COLUMN_MAJOR",1:"ROW_MAJOR"},PrimitiveType:{TRIANGLE:0,0:"TRIANGLE"},VertexType:{VERTEX_PT:0,0:"VERTEX_PT"},DEFAULT_CAMERA_PARAMS:{verticalFovDegrees:63,near:1,far:1e4}}),D("FaceMesh",e0),D("FACEMESH_LIPS",Ff),D("FACEMESH_LEFT_EYE",Pf),D("FACEMESH_LEFT_EYEBROW",Bf),D("FACEMESH_LEFT_IRIS",[[474,475],[475,476],[476,477],[477,474]]),D("FACEMESH_RIGHT_EYE",zf),D("FACEMESH_RIGHT_EYEBROW",Vf),D("FACEMESH_RIGHT_IRIS",[[469,470],[470,471],[471,472],[472,469]]),D("FACEMESH_FACE_OVAL",Uf),D("FACEMESH_CONTOURS",t0),D("FACEMESH_TESSELATION",[[127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]]),D("matrixDataToMatrix",function(C){for(var E=C.getCols(),R=C.getRows(),tt=C.getPackedDataList(),xt=[],Rt=0;Rt<R;Rt++)xt.push(Array(E));for(Rt=0;Rt<R;Rt++)for(var Tt=0;Tt<E;Tt++){var Pt=C.getLayout()===1?Rt*E+Tt:Tt*R+Rt;xt[Rt][Tt]=tt[Pt]}return xt}),D("VERSION","0.4.1633559619")}).call(Ea);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qkt=1e-7,Kkt=1e-4;class Xkt{refCount(t){return Ei("refCount")}incRef(t){return Ei("incRef")}timerAvailable(){return!0}time(t){return Ei("time")}read(t){return Ei("read")}readSync(t){return Ei("readSync")}readToGPU(t,n){return Ei("readToGPU")}numDataIds(){return Ei("numDataIds")}disposeData(t,n){return Ei("disposeData")}write(t,n,i){return Ei("write")}move(t,n,i,o,a){return Ei("move")}memory(){return Ei("memory")}floatPrecision(){return Ei("floatPrecision")}epsilon(){return this.floatPrecision()===32?qkt:Kkt}dispose(){return Ei("dispose")}}function Ei(r){throw new Error(`'${r}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function st(r,t){if(!r)throw new Error(typeof t=="string"?t:t())}function Eo(r,t,n=""){st(Nc(r,t),()=>n+` Shapes ${r} and ${t} must match`)}function Mf(r){st(r!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Vy(r,t=[],n=!1){if(t==null&&(t=[]),Array.isArray(r)||za(r)&&!n)for(let i=0;i<r.length;++i)Vy(r[i],t,n);else t.push(r);return t}function cr(r){if(r.length===0)return 1;let t=r[0];for(let n=1;n<r.length;n++)t*=r[n];return t}function Nc(r,t){if(r===t)return!0;if(r==null||t==null||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!==t[n])return!1;return!0}function fm(r){return r%1===0}function E1(r,t){return t<=r.length?r:r+" ".repeat(t-r.length)}function Uy(r,t){const n=t.length;return r=r==null?t.map((i,o)=>o):[].concat(r),st(r.every(i=>i>=-n&&i<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${r}`),st(r.every(i=>fm(i)),()=>`All values in axis param must be integers but got axis ${r}`),r.map(i=>i<0?n+i:i)}function Ykt(r,t){const n=[],i=[],o=t!=null&&Array.isArray(t)&&t.length===0,a=t==null||o?null:Uy(t,r).sort();let l=0;for(let c=0;c<r.length;++c){if(a!=null){if(a[l]===c&&r[c]!==1)throw new Error(`Can't squeeze axis ${c} since its dim '${r[c]}' is not 1`);(a[l]==null||a[l]>c)&&r[c]===1&&(n.push(r[c]),i.push(c)),a[l]<=c&&l++}r[c]!==1&&(n.push(r[c]),i.push(c))}return{newShape:n,keptDims:i}}function Zkt(r,t){let n=null;if(r==null||r==="float32")n=new Float32Array(t);else if(r==="int32")n=new Int32Array(t);else if(r==="bool")n=new Uint8Array(t);else throw new Error(`Unknown data type ${r}`);return n}function Jkt(r,t){let n=null;if(r==null||r==="float32")n=new Float32Array(t);else if(r==="int32")n=new Int32Array(t);else if(r==="bool")n=new Uint8Array(t);else if(r==="string")n=new Array(t);else throw new Error(`Unknown data type ${r}`);return n}function Qkt(r,t){for(let n=0;n<r.length;n++){const i=r[n];if(isNaN(i)||!isFinite(i))throw Error(`A tensor of type ${t} being uploaded contains ${i}.`)}}function t$t(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function za(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}function sA(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error(`Unknown dtype ${r}`)}function e$t(r){if(r==null)return 0;let t=0;return r.forEach(n=>t+=n.length),t}function AC(r){return typeof r=="string"||r instanceof String}function n$t(r){return typeof r=="boolean"}function s$t(r){return typeof r=="number"}function MC(r){return Array.isArray(r)?MC(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":s$t(r)?"float32":AC(r)?"string":n$t(r)?"bool":"float32"}function rA(r){return!!(r&&r.constructor&&r.call&&r.apply)}function DC(r){const t=r.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=r[t-1];for(let i=t-3;i>=0;--i)n[i]=n[i+1]*r[i+1];return n}function nP(r,t,n,i=!1){const o=new Array;if(t.length===1){const a=t[0]*(i?2:1);for(let l=0;l<a;l++)o[l]=n[r+l]}else{const a=t[0],l=t.slice(1),c=l.reduce((u,h)=>u*h)*(i?2:1);for(let u=0;u<a;u++)o[u]=nP(r+u*c,l,n,i)}return o}function Rw(r,t,n=!1){if(r.length===0)return t[0];const i=r.reduce((o,a)=>o*a)*(n?2:1);if(i===0)return[];if(i!==t.length)throw new Error(`[${r}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return nP(0,r,t,n)}function sP(r,t){const n=RC(r,t);for(let i=0;i<n.length;i++)n[i]=1;return n}function RC(r,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(r);if(t==="int32")return new Int32Array(r);if(t==="bool")return new Uint8Array(r);throw new Error(`Unknown data type ${t}`)}function rP(r){r.forEach(t=>{st(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${r}].`)})}function tf(r){return r&&r.then&&typeof r.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iA="tfjsflags";class r$t{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=i$t,this.populateURLFlags()}setPlatform(t,n){this.platform!=null&&(Cn().getBool("IS_TEST")||Cn().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=n}registerFlag(t,n,i){if(this.flagRegistry[t]={evaluationFn:n,setHook:i},this.urlFlags[t]!=null){const o=this.urlFlags[t];Cn().getBool("IS_TEST")||Cn().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${o}.`),this.set(t,o)}}async getAsync(t){return t in this.flags?this.flags[t]:(this.flags[t]=await this.evaluateFlag(t),this.flags[t])}get(t){if(t in this.flags)return this.flags[t];const n=this.evaluateFlag(t);if(tf(n))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=n,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,n){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=n,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(n)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const t=this.getQueryParams(this.global.location.search);iA in t&&t[iA].split(",").forEach(i=>{const[o,a]=i.split(":");this.urlFlags[o]=a$t(o,a)})}}function i$t(r){const t={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...i)=>(o$t(t,i[0],i[1]),i.join("="))),t}function o$t(r,t,n){r[decodeURIComponent(t)]=decodeURIComponent(n||"")}function a$t(r,t){if(t=t.toLowerCase(),t==="true"||t==="false")return t==="true";if(`${+t}`===t)return+t;throw new Error(`Could not parse value flag value ${t} for flag ${r}.`)}function Cn(){return iP}let iP=null;function l$t(r){iP=r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Nb;function oP(){if(Nb==null){let r;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");Nb=r}return Nb}function c$t(){const r=oP();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function OC(r,t){const n=c$t();if(n.has(r))return n.get(r);{const i=t();return n.set(r,i),n.get(r)}}const u$t="Abs",h$t="Acos",d$t="Acosh",aP="Add",f$t="AddN",p$t="All",m$t="Any",g$t="ArgMax",v$t="ArgMin",y$t="Asin",x$t="Asinh",b$t="Atan",w$t="Atanh",S$t="Atan2",_$t="AvgPool",T$t="AvgPool3D",C$t="BatchMatMul",k$t="BatchToSpaceND",$$t="Bincount",I$t="BroadcastArgs",lP="Cast",E$t="Ceil",N$t="ClipByValue",A$t="Complex",M$t="ComplexAbs",D$t="Concat",R$t="Conv2D",O$t="Conv2DBackpropFilter",L$t="Conv2DBackpropInput",F$t="Conv3D",P$t="Conv3DBackpropInputV2",B$t="Cos",z$t="Cosh",V$t="Cumprod",U$t="Cumsum",W$t="CropAndResize",G$t="DenseBincount",H$t="DepthToSpace",j$t="DepthwiseConv2dNative",q$t="DepthwiseConv2dNativeBackpropFilter",K$t="DepthwiseConv2dNativeBackpropInput",X$t="Diag",Y$t="Dilation2D",Z$t="RealDiv",J$t="Einsum",Q$t="Elu",tIt="Erf",eIt="Equal",nIt="Exp",sIt="ExpandDims",rIt="Expm1",iIt="FFT",oIt="Fill",aIt="FlipLeftRight",lIt="Floor",cIt="FloorDiv",uIt="FusedBatchNorm",hIt="GatherV2",dIt="GatherNd",fIt="Greater",pIt="GreaterEqual",cP="Identity",mIt="IFFT",gIt="Imag",vIt="IsFinite",yIt="IsInf",xIt="IsNan",bIt="LeakyRelu",wIt="Less",SIt="LessEqual",_It="LinSpace",TIt="Log",CIt="Log1p",kIt="LogicalAnd",$It="LogicalNot",IIt="LogicalOr",EIt="LRN",NIt="Max",AIt="Maximum",MIt="MaxPool",DIt="MaxPool3D",RIt="MaxPoolWithArgmax",OIt="Mean",LIt="Min",FIt="Minimum",PIt="MirrorPad",BIt="Mod",zIt="Multinomial",VIt="Multiply",UIt="Neg",WIt="NotEqual",GIt="NonMaxSuppressionV3",HIt="NonMaxSuppressionV4",jIt="NonMaxSuppressionV5",qIt="OnesLike",KIt="OneHot",XIt="Pack",YIt="PadV2",ZIt="Pow",JIt="Prelu",QIt="Prod",tEt="RaggedGather",eEt="RaggedTensorToTensor",nEt="Range",sEt="Real",rEt="Reciprocal",iEt="Relu",oEt="Reshape",aEt="ResizeNearestNeighbor",lEt="ResizeBilinear",cEt="Relu6",uEt="Reverse",hEt="Round",dEt="Rsqrt",fEt="ScatterNd",pEt="SearchSorted",mEt="Select",gEt="Selu",vEt="Slice",yEt="Sin",xEt="Sinh",bEt="Sign",wEt="Sigmoid",SEt="Softplus",_Et="Sqrt",TEt="Sum",CEt="SpaceToBatchND",kEt="SplitV",$Et="Softmax",IEt="SparseFillEmptyRows",EEt="SparseReshape",NEt="SparseSegmentMean",AEt="SparseSegmentSum",MEt="SparseToDense",DEt="SquaredDifference",REt="StridedSlice",OEt="StringNGrams",LEt="StringSplit",FEt="StringToHashBucketFast",PEt="Sub",BEt="Tan",zEt="Tanh",uP="Tile",VEt="TopK",UEt="Transform",Ab="Transpose",WEt="Unique",GEt="Unpack",HEt="UnsortedSegmentSum",jEt="ZerosLike",qEt="Step",oA="FromPixels",KEt="RotateWithOffset",aA="_FusedMatMul",lA="FusedConv2D",cA="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dp(...r){Cn().getBool("IS_TEST")||Cn().getBool("PROD")||console.warn(...r)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hP=OC("kernelRegistry",()=>new Map),XEt=OC("gradRegistry",()=>new Map);function Ow(r,t){const n=YEt(r,t);return hP.get(n)}function uA(r){return XEt.get(r)}function hA(r){const t=hP.entries(),n=[];for(;;){const{done:i,value:o}=t.next();if(i)break;const[a,l]=o,[c]=a.split("_");c===r&&n.push(l)}return n}function YEt(r,t){return`${t}_${r}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZEt(r,t){return r instanceof Float32Array&&t==="float32"||r instanceof Int32Array&&t==="int32"||r instanceof Uint8Array&&t==="bool"}function dP(r,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Vy(r)),Cn().getBool("DEBUG")&&Qkt(r,t),ZEt(r,t))return r;if(t==null||t==="float32"||t==="complex64")return new Float32Array(r);if(t==="int32")return new Int32Array(r);if(t==="bool"){const n=new Uint8Array(r.length);for(let i=0;i<n.length;++i)Math.round(r[i])!==0&&(n[i]=1);return n}else throw new Error(`Unknown data type ${t}`)}function N2(){return Cn().platform.now()}function JEt(r,t="utf-8"){return t=t||"utf-8",Cn().platform.encode(r,t)}function dA(r,t="utf-8"){return t=t||"utf-8",Cn().platform.decode(r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QEt{constructor(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new eNt)}profileKernel(t,n,i){let o;const a=()=>{o=i()};let l;const c=N2();if(this.backendTimer.timerAvailable())l=this.backendTimer.time(a);else{a();for(const h of o)h.dataSync();l=Promise.resolve({kernelMs:N2()-c})}if(Cn().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let h=0;h<o.length;h++){const d=o[h];d.data().then(f=>{tNt(f,d.dtype,t)})}return{kernelName:t,outputs:o,inputs:n,timeMs:l.then(h=>h.kernelMs),extraInfo:l.then(h=>h.getExtraProfileInfo!=null?h.getExtraProfileInfo():"")}}logKernelProfile(t){const{kernelName:n,outputs:i,timeMs:o,inputs:a,extraInfo:l}=t;i.forEach(c=>{Promise.all([c.data(),o,l]).then(u=>{this.logger.logKernelProfile(n,c,u[0],u[1],a,u[2])})})}}function tNt(r,t,n){if(t!=="float32")return!1;for(let i=0;i<r.length;i++){const o=r[i];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${n}'`),!0}return!1}class eNt{logKernelProfile(t,n,i,o,a,l){const c=typeof o=="number"?E1(`${o}ms`,9):o.error,u=E1(t,25),h=n.rank,d=n.size,f=E1(n.shape.toString(),14);let p="";for(const m in a){const g=a[m];if(g!=null){const y=g.shape||n.shape,v=y.length;p+=`${m}: ${v}D ${v>0?y:""} `}}console.log(`%c${u}	%c${c}	%c${h}D ${f}	%c${d}	%c${p}	%c${l}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nNt(r,t,n){const i={},o={};for(let u=0;u<t.length;u++)i[t[u].id]=!0;for(let u=0;u<r.length;u++){const h=r[u],d=h.inputs;for(const f in d){const p=d[f];let m=!1;for(let g=0;g<t.length;g++)if(i[p.id]){h.outputs.forEach(y=>i[y.id]=!0),m=!0,o[h.id]=!0;break}if(m)break}}const a={};a[n.id]=!0;const l={};for(let u=r.length-1;u>=0;u--){const h=r[u],d=h.inputs;for(let f=0;f<h.outputs.length;f++)if(a[h.outputs[f].id]){for(const p in d)a[d[p].id]=!0,l[h.id]=!0;break}}const c=[];for(let u=0;u<r.length;u++){const h=r[u];if(o[h.id]&&l[h.id]){const d={};for(const p in h.inputs){const m=h.inputs[p];i[m.id]&&(d[p]=m)}const f=Object.assign({},h);f.inputs=d,f.outputs=h.outputs,c.push(f)}}return c}function sNt(r,t,n,i){for(let o=t.length-1;o>=0;o--){const a=t[o],l=[];if(a.outputs.forEach(u=>{const h=r[u.id];h!=null?l.push(h):l.push(null)}),a.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${a.kernelName}.`);const c=a.gradient(l);for(const u in a.inputs){if(!(u in c))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(c)}.`);const h=n(()=>c[u]());if(h.dtype!=="float32")throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${h.dtype}'`);const d=a.inputs[u];if(!Nc(h.shape,d.shape))throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input '${u}' has shape '${h.shape}', which does not match the shape of the input '${d.shape}'`);if(r[d.id]==null)r[d.id]=h;else{const f=r[d.id];r[d.id]=i(f,h),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fA=20,fp=3,Mb=7;function rNt(r,t,n,i){const o=DC(t),a=iNt(r,t,n,o),l=t.length,c=N1(r,t,n,o,a),u=["Tensor"];return i&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${l}`),u.push(`  shape: [${t}]`),u.push("  values:")),u.push(c.map(h=>"    "+h).join(`
`)),u.join(`
`)}function iNt(r,t,n,i){const o=cr(t),a=i[i.length-1],l=new Array(a).fill(0),c=t.length,u=n==="complex64"?$p(r):r;if(c>1)for(let h=0;h<o/a;h++){const d=h*a;for(let f=0;f<a;f++)l[f]=Math.max(l[f],kp(u[d+f],0,n).length)}return l}function kp(r,t,n){let i;return Array.isArray(r)?i=`${parseFloat(r[0].toFixed(Mb))} + ${parseFloat(r[1].toFixed(Mb))}j`:AC(r)?i=`'${r}'`:n==="bool"?i=fP(r):i=parseFloat(r.toFixed(Mb)).toString(),E1(i,t)}function fP(r){return r===0?"false":"true"}function N1(r,t,n,i,o,a=!0){const l=n==="complex64"?2:1,c=t[0],u=t.length;if(u===0){if(n==="complex64"){const y=$p(r);return[kp(y[0],0,n)]}return n==="bool"?[fP(r[0])]:[r[0].toString()]}if(u===1){if(c>fA){const v=fp*l;let x=Array.from(r.slice(0,v)),b=Array.from(r.slice((c-fp)*l,c*l));return n==="complex64"&&(x=$p(x),b=$p(b)),["["+x.map((w,S)=>kp(w,o[S],n)).join(", ")+", ..., "+b.map((w,S)=>kp(w,o[c-fp+S],n)).join(", ")+"]"]}return["["+(n==="complex64"?$p(r):Array.from(r)).map((v,x)=>kp(v,o[x],n)).join(", ")+"]"]}const h=t.slice(1),d=i.slice(1),f=i[0]*l,p=[];if(c>fA){for(let y=0;y<fp;y++){const v=y*f,x=v+f;p.push(...N1(r.slice(v,x),h,n,d,o,!1))}p.push("...");for(let y=c-fp;y<c;y++){const v=y*f,x=v+f;p.push(...N1(r.slice(v,x),h,n,d,o,y===c-1))}}else for(let y=0;y<c;y++){const v=y*f,x=v+f;p.push(...N1(r.slice(v,x),h,n,d,o,y===c-1))}const m=u===2?",":"";p[0]="["+p[0]+m;for(let y=1;y<p.length-1;y++)p[y]=" "+p[y]+m;let g=`,
`;for(let y=2;y<u;y++)g+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(a?"":g),p}function $p(r){const t=[];for(let n=0;n<r.length;n+=2)t.push([r[n],r[n+1]]);return t}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lw{constructor(t,n,i){if(this.dtype=n,this.shape=t.slice(),this.size=cr(t),i!=null){const o=i.length;st(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=i||Jkt(n,this.size),this.strides=DC(t)}set(t,...n){n.length===0&&(n=[0]),st(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const i=this.locToIndex(n);this.values[i]=t}get(...t){t.length===0&&(t=[0]);let n=0;for(const o of t){if(o<0||o>=this.shape[n]){const a=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(a)}n++}let i=t[t.length-1];for(let o=0;o<t.length-1;++o)i+=this.strides[o]*t[o];return this.values[i]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let n=t[t.length-1];for(let i=0;i<t.length-1;++i)n+=this.strides[i]*t[i];return n}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];const n=new Array(this.shape.length);for(let i=0;i<n.length-1;++i)n[i]=Math.floor(t/this.strides[i]),t-=n[i]*this.strides[i];return n[n.length-1]=t,n}get rank(){return this.shape.length}toTensor(){return zo().makeTensor(this.values,this.shape,this.dtype)}}let zo=null,cd=null;function oNt(r){zo=r}function aNt(r){cd=r}class us{constructor(t,n,i,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=cr(t),this.strides=DC(t),this.dataId=i,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return cd.buffer(this.shape,this.dtype,t)}bufferSync(){return cd.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return Rw(this.shape,t,this.dtype==="complex64")}arraySync(){return Rw(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const t=zo().read(this.dataId);if(this.dtype==="string"){const n=await t;try{return n.map(i=>dA(i))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),zo().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=zo().readSync(this.dataId);if(this.dtype==="string")try{return t.map(n=>dA(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await zo().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(zo().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return cd.print(this,t)}clone(){return this.throwIfDisposed(),cd.clone(this)}toString(t=!1){const n=this.dataSync();return rNt(n,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),cd.cast(this,t)}variable(t=!0,n,i){return this.throwIfDisposed(),zo().makeVariable(this,t,n,i)}}Object.defineProperty(us,Symbol.hasInstance,{value:r=>!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null});function lNt(){return OC("Tensor",()=>us)}lNt();class Fw extends us{constructor(t,n,i,o){super(t.shape,t.dtype,t.dataId,o),this.trainable=n,this.name=i}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!Nc(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);zo().disposeTensor(this),this.dataId=t.dataId,zo().incRef(this,null)}dispose(){zo().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Fw,Symbol.hasInstance,{value:r=>r instanceof us&&r.assign!=null&&r.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var pA;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(pA||(pA={}));var Pw;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(Pw||(Pw={}));var Bw;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(Bw||(Bw={}));var zw;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(zw||(zw={}));var Vw;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(Vw||(Vw={}));const cNt={float32:zw,int32:Pw,bool:Bw,complex64:Vw};function uNt(r,t){if(r==="string"||t==="string"){if(r==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${r} with ${t}`)}return cNt[r][t]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xs(r,t){if(r.dtype===t.dtype)return[r,t];const n=uNt(r.dtype,t.dtype);return[r.cast(n),t.cast(n)]}function hNt(r,t){st(r.dtype===t.dtype,()=>`The dtypes of the first(${r.dtype}) and second(${t.dtype}) input must match`)}function pP(r){const t=[];return mP(r,t,new Set),t}function mP(r,t,n){if(r==null)return;if(r instanceof us){t.push(r);return}if(!dNt(r))return;const i=r;for(const o in i){const a=i[o];n.has(a)||(n.add(a),mP(a,t,n))}}function dNt(r){return Array.isArray(r)||typeof r=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Db(r){return r.kernelName!=null}class mA{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class ef{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new mA}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const t=this.getSortedBackends();for(let n=0;n<t.length;n++){const i=t[n];if(await this.initializeBackend(i).success){await this.setBackend(i);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:t,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){const{asyncInit:n}=this.initializeBackend(t);if(n)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,n,i=1){return t in this.registryFactory?(dp(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:n,priority:i},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;const{success:n,asyncInit:i}=this.initializeBackend(t);if(!(i?await n:n))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new QEt(this.backendInstance),!0}setupRegisteredKernels(){hA(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){hA(t).forEach(i=>{i.disposeFunc!=null&&i.disposeFunc(this.registry[t])})}initializeBackend(t){const n=this.registryFactory[t];if(n==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const i=n.factory();if(i&&!(i instanceof Xkt)&&typeof i.then=="function"){const o=++this.pendingBackendInitId,a=i.then(l=>o<this.pendingBackendInitId?!1:(this.registry[t]=l,this.pendingBackendInit=null,!0)).catch(l=>(o<this.pendingBackendInitId||(this.pendingBackendInit=null,dp(`Initialization of backend ${t} failed`),dp(l.stack||l.message)),!1));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}else return this.registry[t]=i,{success:!0,asyncInit:!1}}catch(i){return dp(`Initialization of backend ${t} failed`),dp(i.stack||i.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,n)=>this.registryFactory[n].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let n=0;n<t.length;n++){const i=t[n],{success:o,asyncInit:a}=this.initializeBackend(i);if(a||o)return{name:i,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,n){const i=this.state.tensorInfo.get(n),o=i.backend,a=this.readSync(n),l=o.refCount(n);o.disposeData(n,!0),i.backend=t,t.move(n,a,i.shape,i.dtype,l),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,n){let i=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}let o;return this.scopedRun(()=>this.startScope(i),()=>this.endScope(o),()=>(o=n(),o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),o))}scopedRun(t,n,i){t();try{const o=i();return n(),o}catch(o){throw n(),o}}nextTensorId(){return ef.nextTensorId++}nextVariableId(){return ef.nextVariableId++}clone(t){const n=mt.runKernel(cP,{x:t}),i={x:t},o=l=>({x:()=>{const c="float32",u={x:l},h={dtype:c};return mt.runKernel(lP,u,h)}}),a=[];return this.addTapeNode(this.state.activeScope.name,i,[n],o,a,{}),n}runKernel(t,n,i){if(this.backendName==null&&this.backend,!(Ow(t,this.backendName)!=null))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:n,attrs:i})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,n,i){const o=this.backend.numDataIds();let a=0;i.forEach(u=>{a+=u.dtype==="complex64"?3:1});const l=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],c=o-n-a-l;if(c>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${c} data ids) after running '${t}'`)}runKernelFunc(t){let n,i=[];const o=this.isTapeOn(),a=this.state.numBytes,l=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let c;this.backendName==null&&this.backend;let u;const h=Db(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Db(t)){const{kernelName:g,inputs:y,attrs:v}=t;this.backendName==null&&this.backend;const x=Ow(g,this.backendName);st(x!=null,()=>`Cannot find registered kernel '${g}' for backend '${this.backendName}'`),c=()=>{const b=this.backend.numDataIds();u=x.kernelFunc({inputs:y,attrs:v,backend:this.backend});const w=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(g,b,w);const S=w.map(_=>_.rank!=null?_:this.makeTensorFromTensorInfo(_));if(o){const _=this.getTensorsForGradient(g,y,S);i=this.saveTensorsForBackwardMode(_)}return S}}else{const{forwardFunc:g}=t,y=v=>{o&&(i=v.map(x=>this.keep(this.clone(x))))};c=()=>{const v=this.backend.numDataIds();u=this.tidy(()=>g(this.backend,y));const x=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(h,v,x),x}}const{inputs:d,attrs:f}=t,p=Db(t)?null:t.backwardsFunc;let m;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=c():(m=this.profiler.profileKernel(h,d,()=>c()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),n=m.outputs)}),o&&this.addTapeNode(h,d,n,p,i,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:h,bytesAdded:this.state.numBytes-a,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-l,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(g=>d[g]!=null?d[g].shape:null),outputShapes:n.map(g=>g.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(u)?n:n[0]}saveTensorsForBackwardMode(t){return t.map(i=>this.keep(this.clone(i)))}getTensorsForGradient(t,n,i){const o=uA(t);if(o!=null){const a=o.inputsToSave||[],l=o.outputsToSave||[];let c;o.saveAllInputs?(st(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),c=Object.keys(n).map(h=>n[h])):c=a.map(h=>n[h]);const u=i.filter((h,d)=>l[d]);return c.concat(u)}return[]}makeTensor(t,n,i,o){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");i=i||"float32",o=o||this.backend;let a=t;i==="string"&&AC(t[0])&&(a=t.map(u=>JEt(u)));const l=o.write(a,n,i),c=new us(n,i,l,this.nextTensorId());if(this.trackTensor(c,o),i==="string"){const u=this.state.tensorInfo.get(l),h=e$t(a);this.state.numBytes+=h-u.bytes,u.bytes=h}return c}makeTensorFromDataId(t,n,i,o){i=i||"float32";const a={dataId:t,shape:n,dtype:i};return this.makeTensorFromTensorInfo(a,o)}makeTensorFromTensorInfo(t,n){const{dataId:i,shape:o,dtype:a}=t,l=new us(o,a,i,this.nextTensorId());return this.trackTensor(l,n),l}makeVariable(t,n=!0,i,o){i=i||this.nextVariableId().toString(),o!=null&&o!==t.dtype&&(t=t.cast(o));const a=new Fw(t,n,i,this.nextTensorId());if(this.state.registeredVariables[a.name]!=null)throw new Error(`Variable with name ${a.name} was already registered`);return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}trackTensor(t,n){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let i=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(i=t.size*sA(t.dtype)),this.state.numBytes+=i,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:i})),t instanceof Fw||this.track(t)}incRef(t,n){this.trackTensor(t,n),this.backend.incRef(t.dataId)}removeDataId(t,n){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===n&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const n=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){const i=t.size*sA(t.dtype);this.state.numBytes-=i}n.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,n.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const n=this.state.registeredVariables[t];this.disposeVariable(n)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const n=this.state.numBytes,i=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(o=>o.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-i;for(const o of this.state.activeProfile.kernels)o.kernelTimeMs=await o.kernelTimeMs,o.extraInfo=await o.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,n,i,o,a,l){const c={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:i,saved:a},u=uA(t);u!=null&&(o=u.gradFunc),o!=null&&(c.gradient=h=>(h=h.map((d,f)=>{if(d==null){const p=i[f],m=RC(p.size,p.dtype);return this.makeTensor(m,p.shape,p.dtype)}return d}),o(h.length>1?h:h[0],a,l))),this.state.activeTape.push(c)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(t){const n=pP(t),i=new Set(n.map(a=>a.id));for(let a=0;a<this.state.activeScope.track.length;a++){const l=this.state.activeScope.track[a];!l.kept&&!i.has(l.id)&&l.dispose()}const o=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(a=>{!a.kept&&a.scopeId===o.id&&this.track(a)})}gradients(t,n,i,o=!1){if(st(n.length>0,()=>"gradients() received an empty list of xs."),i!=null&&i.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${i.dtype}'`);const a=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));st(a instanceof us,()=>"The result y returned by f() must be a tensor.");const l=nNt(this.state.activeTape,n,a);if(!o&&l.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const c={};c[a.id]=i??fNt(a.shape),sNt(c,l,h=>this.tidy(h),pNt);const u=n.map(h=>c[h.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(h=>{for(const d of h.saved)d.dispose()}),this.state.activeTape=null),{value:a,grads:u}})}customGrad(t){return st(rA(t),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{st(n.every(c=>c instanceof us),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let i;const o={};n.forEach((c,u)=>{o[u]=c});const a=(c,u)=>(i=t(...n,u),st(i.value instanceof us,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),st(rA(i.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),i.value),l=(c,u)=>{const h=i.gradFunc(c,u),d=Array.isArray(h)?h:[h];st(d.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),st(d.every(p=>p instanceof us),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return d.forEach((p,m)=>{f[m]=()=>p}),f};return this.runKernelFunc({forwardFunc:a,backwardsFunc:l,inputs:o})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,n){return this.state.tensorInfo.get(t).backend.readToGPU(t,n)}async time(t){const n=N2(),i=await this.backend.time(t);return i.wallMs=N2()-n,i}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new mA;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}ef.nextTensorId=0;ef.nextVariableId=0;function fNt(r){const t=sP(cr(r),"float32");return mt.makeTensor(t,r,"float32")}function gP(){const r=oP();if(r._tfengine==null){const t=new r$t(r);r._tfengine=new ef(t)}return l$t(r._tfengine.ENV),oNt(()=>r._tfengine),r._tfengine}const mt=gP();function pNt(r,t){const n={a:r,b:t};return mt.runKernel(aP,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mNt(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bi=Cn();bi.registerFlag("DEBUG",()=>!1,r=>{r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});bi.registerFlag("IS_BROWSER",()=>mNt());bi.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");bi.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));bi.registerFlag("PROD",()=>!1);bi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>bi.getBool("DEBUG"));bi.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);bi.registerFlag("IS_TEST",()=>!1);bi.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);bi.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);bi.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);bi.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);bi.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kc(r,t){let n=r;if(za(r))return t==="string"?[]:[r.length];if(!Array.isArray(r))return[];const i=[];for(;Array.isArray(n)||za(n)&&t!=="string";)i.push(n.length),n=n[0];return Array.isArray(r)&&Cn().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&vP(r,i,[]),i}function vP(r,t,n){if(n=n||[],!Array.isArray(r)&&!za(r)){st(t.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}st(t.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${r.length} elements`),st(r.length===t[0],()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${r.length} elements`);const i=t.slice(1);for(let o=0;o<r.length;++o)vP(r[o],i,n.concat(o))}function gA(r,t,n,i){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==t||r==="numeric"&&t==="string")throw new Error(`Argument '${n}' passed to '${i}' must be ${r} tensor, but got ${t} tensor`)}}function U(r,t,n,i="numeric"){if(r instanceof us)return gA(i,r.dtype,t,n),r;let o=MC(r);if(o!=="string"&&["bool","int32","float32"].indexOf(i)>=0&&(o=i),gA(i,o,t,n),r==null||!za(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){const u=r==null?"null":r.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${u}'`)}const a=Kc(r,o);!za(r)&&!Array.isArray(r)&&(r=[r]);const c=o!=="string"?dP(r,o):Vy(r,[],!0);return mt.makeTensor(c,a,o)}function A2(r,t,n,i="numeric"){if(!Array.isArray(r))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return r.map((a,l)=>U(a,`${t}[${l}]`,n,i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yP="__op";function ot(r){const t=Object.keys(r);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0];const i=r[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+yP;const o=(...a)=>{mt.startScope(n);try{const l=i(...a);return tf(l)&&console.error("Cannot return a Promise inside of tidy."),mt.endScope(l),l}catch(l){throw mt.endScope(null),l}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gNt(r,t){const n=U(r,"real","complex"),i=U(t,"imag","complex");Eo(n.shape,i.shape,`real and imag shapes, ${n.shape} and ${i.shape}, must match in call to tf.complex().`);const o={real:n,imag:i};return mt.runKernel(A$t,o)}const Ac=ot({complex_:gNt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xc(r,t,n,i){if(i==null&&(i=MC(r)),i==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!za(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){rP(t);const o=cr(t),a=cr(n);st(o===a,()=>`Based on the provided shape, [${t}], the tensor should have ${o} values but has ${a}`);for(let l=0;l<n.length;++l){const c=n[l],u=l===n.length-1?c!==cr(t.slice(l)):!0;st(n[l]===t[l]||!u,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `)}}return!za(r)&&!Array.isArray(r)&&(r=[r]),t=t||n,r=i!=="string"?dP(r,i):Vy(r,[],!0),mt.makeTensor(r,t,i)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function La(r,t,n){const i=Kc(r,n);return Xc(r,t,i,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uw={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M2=4;async function vNt(r,t){const n=[],i=[],o=Array.isArray(r)?r.map(l=>l.name):Object.keys(r);for(let l=0;l<o.length;++l){const c=o[l],u=Array.isArray(r)?r[l].tensor:r[c];if(u.dtype!=="float32"&&u.dtype!=="int32"&&u.dtype!=="bool"&&u.dtype!=="string"&&u.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${c}': ${u.dtype}`);const h={name:c,shape:u.shape,dtype:u.dtype};if(u.dtype==="string"){const d=new Promise(async f=>{const p=await u.bytes(),m=p.reduce((v,x)=>v+x.length,0)+M2*p.length,g=new Uint8Array(m);let y=0;for(let v=0;v<p.length;v++){const x=p[v],b=new Uint8Array(new Uint32Array([x.length]).buffer);g.set(b,y),y+=M2,g.set(x,y),y+=x.length}f(g)});i.push(d)}else i.push(u.data());t!=null&&(h.group=t),n.push(h)}const a=await Promise.all(i);return{data:yNt(a),specs:n}}function xP(r,t){const n={};let i,o=0;for(const a of t){const l=a.name,c=a.dtype,u=a.shape,h=cr(u);let d;if("quantization"in a){const f=a.quantization;if(f.dtype==="uint8"||f.dtype==="uint16"){if(!("min"in f&&"scale"in f))throw new Error(`Weight ${a.name} with quantization ${f.dtype} doesn't have corresponding metadata min and scale.`)}else if(f.dtype==="float16"){if(c!=="float32")throw new Error(`Weight ${a.name} is quantized with ${f.dtype} which only supports weights of type float32 not ${c}.`)}else throw new Error(`Weight ${a.name} has unknown quantization dtype ${f.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const p=Uw[f.dtype],m=r.slice(o,o+h*p),g=f.dtype==="uint8"?new Uint8Array(m):new Uint16Array(m);if(c==="float32")if(f.dtype==="uint8"||f.dtype==="uint16"){d=new Float32Array(g.length);for(let y=0;y<g.length;y++){const v=g[y];d[y]=v*f.scale+f.min}}else if(f.dtype==="float16")i===void 0&&(i=TNt()),d=i(g);else throw new Error(`Unsupported quantization type ${f.dtype} for weight type float32.`);else if(c==="int32"){if(f.dtype!=="uint8"&&f.dtype!=="uint16")throw new Error(`Unsupported quantization type ${f.dtype} for weight type int32.`);d=new Int32Array(g.length);for(let y=0;y<g.length;y++){const v=g[y];d[y]=Math.round(v*f.scale+f.min)}}else throw new Error(`Unsupported dtype in weight '${l}': ${c}`);o+=h*p}else if(c==="string"){const f=cr(a.shape);d=[];for(let p=0;p<f;p++){const m=new Uint32Array(r.slice(o,o+M2))[0];o+=M2;const g=new Uint8Array(r.slice(o,o+m));d.push(g),o+=m}}else{const f=Uw[c],p=r.slice(o,o+h*f);if(c==="float32")d=new Float32Array(p);else if(c==="int32")d=new Int32Array(p);else if(c==="bool")d=new Uint8Array(p);else if(c==="complex64"){d=new Float32Array(p);const m=new Float32Array(d.length/2),g=new Float32Array(d.length/2);for(let x=0;x<m.length;x++)m[x]=d[x*2],g[x]=d[x*2+1];const y=La(m,u,"float32"),v=La(g,u,"float32");n[l]=Ac(y,v),y.dispose(),v.dispose()}else throw new Error(`Unsupported dtype in weight '${l}': ${c}`);o+=h*f}c!=="complex64"&&(n[l]=La(d,u,c))}return n}function yNt(r){if(r===null)throw new Error(`Invalid input value: ${JSON.stringify(r)}`);let t=0;const n=[];r.forEach(a=>{if(t+=a.byteLength,n.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${a.constructor.name}`)});const i=new Uint8Array(t);let o=0;return n.forEach(a=>{i.set(new Uint8Array(a.buffer),o),o+=a.byteLength}),i.buffer}const LC=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function vA(r){return LC?Buffer.byteLength(r):new Blob([r]).size}function xNt(r){if(LC)return Buffer.from(r).toString("base64");const t=new Uint8Array(r);let n="";for(let i=0,o=t.length;i<o;i++)n+=String.fromCharCode(t[i]);return btoa(n)}function bNt(r){if(LC){const i=Buffer.from(r,"base64");return i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength)}const t=atob(r),n=new Uint8Array(t.length);for(let i=0;i<t.length;++i)n.set([t.charCodeAt(i)],i);return n.buffer}function FC(r){if(r.length===1)return r[0];let t=0;r.forEach(o=>{t+=o.byteLength});const n=new Uint8Array(t);let i=0;return r.forEach(o=>{n.set(new Uint8Array(o),i),i+=o.byteLength}),n.buffer}function yA(r){const t="/";for(r=r.trim();r.endsWith(t);)r=r.slice(0,r.length-1);const n=r.split(t);return n[n.length-1]}function bP(r,t){const n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:t};return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),n}function wP(r,t,n){const i={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(i.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");i.weightSpecs=t,i.weightData=n}return r.signature!=null&&(i.signature=r.signature),r.userDefinedMetadata!=null&&(i.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(i.modelInitializer=r.modelInitializer),i}async function PC(r,t){let n,i;return r.weightsManifest!=null&&([n,i]=await t(r.weightsManifest)),wP(r,n,i)}function Yg(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:vA(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:vA(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}function SP(r){const t=[];for(const n of r)t.push(...n.weights);return t}function wNt(){const r=n=>{let i=n<<13,o=0;for(;!(i&8388608);)o-=8388608,i<<=1;return i&=-8388609,o+=947912704,i|o},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=r(n);for(let n=1024;n<2048;n++)t[n]=939524096+(n-1024<<13);return t}function SNt(){const r=new Uint32Array(64);r[0]=0,r[31]=1199570944,r[32]=2147483648,r[63]=3347054592;for(let t=1;t<31;t++)r[t]=t<<23;for(let t=33;t<63;t++)r[t]=2147483648+(t-32<<23);return r}function _Nt(){const r=new Uint32Array(64);for(let t=0;t<64;t++)r[t]=1024;return r[0]=r[32]=0,r}function TNt(){const r=wNt(),t=SNt(),n=_Nt();return i=>{const o=new ArrayBuffer(4*i.length),a=new Uint32Array(o);for(let l=0;l<i.length;l++){const c=i[l],u=r[n[c>>10]+(c&1023)]+t[c>>10];a[l]=u}return new Float32Array(o)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cs{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return cs.instance==null&&(cs.instance=new cs),cs.instance}static registerSaveRouter(t){cs.getInstance().saveRouters.push(t)}static registerLoadRouter(t){cs.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return cs.getHandlers(t,"save")}static getLoadHandlers(t,n){return cs.getHandlers(t,"load",n)}static getHandlers(t,n,i){const o=[];return(n==="load"?cs.getInstance().loadRouters:cs.getInstance().saveRouters).forEach(l=>{const c=l(t,i);c!==null&&o.push(c)}),o}}const CNt=r=>cs.registerSaveRouter(r),kNt=r=>cs.registerLoadRouter(r),$Nt=r=>cs.getSaveHandlers(r),INt=(r,t)=>cs.getLoadHandlers(r,t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ww="tensorflowjs",Gw=1,Tu="models_store",oc="model_info_store";function _P(){if(!Cn().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const r=typeof window>"u"?self:window,t=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Hw(r){const t=r.result;t.createObjectStore(Tu,{keyPath:"modelPath"}),t.createObjectStore(oc,{keyPath:"modelPath"})}class lh{constructor(t){if(this.indexedDB=_P(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,n){return new Promise((i,o)=>{const a=this.indexedDB.open(Ww,Gw);a.onupgradeneeded=()=>Hw(a),a.onsuccess=()=>{const l=a.result;if(n==null){const c=l.transaction(Tu,"readonly"),h=c.objectStore(Tu).get(this.modelPath);h.onsuccess=()=>{if(h.result==null)return l.close(),o(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));i(h.result.modelArtifacts)},h.onerror=d=>(l.close(),o(h.error)),c.oncomplete=()=>l.close()}else{const c=Yg(n),u=l.transaction(oc,"readwrite");let h=u.objectStore(oc);const d=h.put({modelPath:this.modelPath,modelArtifactsInfo:c});let f;d.onsuccess=()=>{f=l.transaction(Tu,"readwrite");const m=f.objectStore(Tu).put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:c});m.onsuccess=()=>i({modelArtifactsInfo:c}),m.onerror=g=>{h=u.objectStore(oc);const y=h.delete(this.modelPath);y.onsuccess=()=>(l.close(),o(m.error)),y.onerror=v=>(l.close(),o(m.error))}},d.onerror=p=>(l.close(),o(d.error)),u.oncomplete=()=>{f==null?l.close():f.oncomplete=()=>l.close()}}},a.onerror=l=>o(a.error)})}}lh.URL_SCHEME="indexeddb://";const TP=r=>Cn().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(lh.URL_SCHEME)?ENt(r.slice(lh.URL_SCHEME.length)):null;cs.registerSaveRouter(TP);cs.registerLoadRouter(TP);function ENt(r){return new lh(r)}function NNt(r){return r.startsWith(lh.URL_SCHEME)?r.slice(lh.URL_SCHEME.length):r}class ANt{constructor(){this.indexedDB=_P()}async listModels(){return new Promise((t,n)=>{const i=this.indexedDB.open(Ww,Gw);i.onupgradeneeded=()=>Hw(i),i.onsuccess=()=>{const o=i.result,a=o.transaction(oc,"readonly"),c=a.objectStore(oc).getAll();c.onsuccess=()=>{const u={};for(const h of c.result)u[h.modelPath]=h.modelArtifactsInfo;t(u)},c.onerror=u=>(o.close(),n(c.error)),a.oncomplete=()=>o.close()},i.onerror=o=>n(i.error)})}async removeModel(t){return t=NNt(t),new Promise((n,i)=>{const o=this.indexedDB.open(Ww,Gw);o.onupgradeneeded=()=>Hw(o),o.onsuccess=()=>{const a=o.result,l=a.transaction(oc,"readwrite"),c=l.objectStore(oc),u=c.get(t);let h;u.onsuccess=()=>{if(u.result==null)return a.close(),i(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const d=c.delete(t),f=()=>{h=a.transaction(Tu,"readwrite");const m=h.objectStore(Tu).delete(t);m.onsuccess=()=>n(u.result.modelArtifactsInfo),m.onerror=g=>i(u.error)};d.onsuccess=f,d.onerror=p=>(f(),a.close(),i(u.error))}},u.onerror=d=>(a.close(),i(u.error)),l.oncomplete=()=>{h==null?a.close():h.oncomplete=()=>a.close()}},o.onerror=a=>i(o.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const al="/",ud="tensorflowjs_models",CP="info",MNt="model_topology",DNt="weight_specs",RNt="weight_data",ONt="model_metadata";function kP(r){return{info:[ud,r,CP].join(al),topology:[ud,r,MNt].join(al),weightSpecs:[ud,r,DNt].join(al),weightData:[ud,r,RNt].join(al),modelMetadata:[ud,r,ONt].join(al)}}function $P(r){for(const t of Object.values(r))window.localStorage.removeItem(t)}function LNt(r){const t=r.split(al);if(t.length<3)throw new Error(`Invalid key format: ${r}`);return t.slice(1,t.length-1).join(al)}function FNt(r){return r.startsWith(ch.URL_SCHEME)?r.slice(ch.URL_SCHEME.length):r}class ch{constructor(t){if(!Cn().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=kP(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(t.modelTopology),i=JSON.stringify(t.weightSpecs),o=Yg(t);try{this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,i),this.LS.setItem(this.keys.weightData,xNt(t.weightData));const a={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:t.signature!=null?t.signature:void 0,userDefinedMetadata:t.userDefinedMetadata!=null?t.userDefinedMetadata:void 0,modelInitializer:t.modelInitializer!=null?t.modelInitializer:void 0,trainingConfig:t.trainingConfig!=null?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(a)),{modelArtifactsInfo:o}}catch{throw $P(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${o.modelTopologyBytes}, weightSpecsBytes=${o.weightSpecsBytes}, weightDataBytes=${o.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(t==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},i=JSON.parse(this.LS.getItem(this.keys.topology));if(i==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=i;const o=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(o==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=o;const a=this.LS.getItem(this.keys.modelMetadata);if(a!=null){const c=JSON.parse(a);n.format=c.format,n.generatedBy=c.generatedBy,n.convertedBy=c.convertedBy,c.signature!=null&&(n.signature=c.signature),c.userDefinedMetadata!=null&&(n.userDefinedMetadata=c.userDefinedMetadata),c.modelInitializer!=null&&(n.modelInitializer=c.modelInitializer),c.trainingConfig!=null&&(n.trainingConfig=c.trainingConfig)}const l=this.LS.getItem(this.keys.weightData);if(l==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=bNt(l),n}}ch.URL_SCHEME="localstorage://";const IP=r=>Cn().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(ch.URL_SCHEME)?PNt(r.slice(ch.URL_SCHEME.length)):null;cs.registerSaveRouter(IP);cs.registerLoadRouter(IP);function PNt(r){return new ch(r)}class BNt{constructor(){st(Cn().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),st(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const t={},n=ud+al,i=al+CP;for(let o=0;o<this.LS.length;++o){const a=this.LS.key(o);if(a.startsWith(n)&&a.endsWith(i)){const l=LNt(a);t[l]=JSON.parse(this.LS.getItem(a))}}return t}async removeModel(t){t=FNt(t);const n=kP(t);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${t}'`);const i=JSON.parse(this.LS.getItem(n.info));return $P(n),i}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $d="://";class Nr{constructor(){this.managers={}}static getInstance(){return Nr.instance==null&&(Nr.instance=new Nr),Nr.instance}static registerManager(t,n){st(t!=null,()=>"scheme must not be undefined or null."),t.endsWith($d)&&(t=t.slice(0,t.indexOf($d))),st(t.length>0,()=>"scheme must not be an empty string.");const i=Nr.getInstance();st(i.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),i.managers[t]=n}static getManager(t){const n=Nr.getInstance().managers[t];if(n==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return n}static getSchemes(){return Object.keys(Nr.getInstance().managers)}}function A1(r){if(r.indexOf($d)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Nr.getSchemes().join(",")}`);return{scheme:r.split($d)[0],path:r.split($d)[1]}}async function EP(r,t,n=!1){st(r!==t,()=>`Old path and new path are the same: '${r}'`);const i=cs.getLoadHandlers(r);st(i.length>0,()=>`Copying failed because no load handler is found for source URL ${r}.`),st(i.length<2,()=>`Copying failed because more than one (${i.length}) load handlers for source URL ${r}.`);const o=i[0],a=cs.getSaveHandlers(t);st(a.length>0,()=>`Copying failed because no save handler is found for destination URL ${t}.`),st(a.length<2,()=>`Copying failed because more than one (${i.length}) save handlers for destination URL ${t}.`);const l=a[0],c=A1(r).scheme,u=A1(r).path,h=c===A1(r).scheme,d=await o.load();n&&h&&await Nr.getManager(c).removeModel(u);const f=await l.save(d);return n&&!h&&await Nr.getManager(c).removeModel(u),f.modelArtifactsInfo}async function zNt(){const r=Nr.getSchemes(),t={};for(const n of r){const i=await Nr.getManager(n).listModels();for(const o in i){const a=n+$d+o;t[a]=i[o]}}return t}async function VNt(r){const t=A1(r);return Nr.getManager(t.scheme).removeModel(t.path)}async function UNt(r,t){return EP(r,t,!1)}async function WNt(r,t){return EP(r,t,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GNt{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,n){return fetch(t,n)}now(){return performance.now()}encode(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,n){return new TextDecoder(n).decode(t)}setTimeoutCustom(t,n){if(!window||!Cn().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(t,n);return}this.functionRefs.push(t),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",i=>{if(i.source===window&&i.data.name===this.messageName){i.stopPropagation();const o=this.functionRefs[i.data.index];o(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}}if(Cn().get("IS_BROWSER")){Cn().setPlatform("browser",new GNt);try{Nr.registerManager(ch.URL_SCHEME,new BNt)}catch{}try{Nr.registerManager(lh.URL_SCHEME,new ANt)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HNt={importFetch:()=>require("node-fetch")};let Rb;class jNt{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,n){return Cn().global.fetch!=null?Cn().global.fetch(t,n):(Rb==null&&(Rb=HNt.importFetch()),Rb(t,n))}now(){const t=process.hrtime();return t[0]*1e3+t[1]/1e6}encode(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(t)}decode(t,n){return t.length===0?"":new this.util.TextDecoder(n).decode(t)}}Cn().get("IS_NODE")&&!Cn().get("IS_BROWSER")&&Cn().setPlatform("node",new jNt);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _l(r,t="float32",n){return t=t||"float32",rP(r),new Lw(r,t,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qNt(r,t){const n=U(r,"x","cast");if(!t$t(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const i={x:n},o={dtype:t};return mt.runKernel(lP,i,o)}const ps=ot({cast_:qNt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KNt(r){const n={x:U(r,"x","clone","string_or_numeric")};return mt.runKernel(cP,n)}const mc=ot({clone_:KNt});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NP(r,t=!1){console.log(r.toString(t))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */gP();const XNt={buffer:_l,cast:ps,clone:mc,print:NP};aNt(XNt);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YNt="model",ZNt=".json",JNt=".weights.bin";function xA(r){return new Promise(t=>setTimeout(t)).then(r)}class uh{constructor(t){if(!Cn().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(uh.URL_SCHEME)&&(t=t.slice(uh.URL_SCHEME.length)),(t==null||t.length===0)&&(t=YNt),this.modelJsonFileName=t+ZNt,this.weightDataFileName=t+JNt}async save(t){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const i=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],o=bP(t,i),a=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),l=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(l.download=this.modelJsonFileName,l.href=a,await xA(()=>l.dispatchEvent(new MouseEvent("click"))),t.weightData!=null){const c=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;c.download=this.weightDataFileName,c.href=n,await xA(()=>c.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Yg(t)}}}}uh.URL_SCHEME="downloads://";class QNt{constructor(t){if(t==null||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}async load(){return new Promise((t,n)=>{const i=new FileReader;i.onload=o=>{const a=JSON.parse(o.target.result),l=a.modelTopology;if(l==null){n(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(a.weightsManifest==null){n(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){t({modelTopology:l});return}const u=PC(a,h=>this.loadWeights(h));t(u)},i.onerror=o=>n(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),i.readAsText(this.jsonFile)})}loadWeights(t){const n=[],i=[];for(const l of t)n.push(...l.weights),i.push(...l.paths);const o=this.checkManifestAndWeightFiles(t),a=i.map(l=>this.loadWeightsFile(l,o[l]));return Promise.all(a).then(l=>[n,FC(l)])}loadWeightsFile(t,n){return new Promise((i,o)=>{const a=new FileReader;a.onload=l=>{const c=l.target.result;i(c)},a.onerror=l=>o(`Failed to weights data from file of path '${t}'.`),a.readAsArrayBuffer(n)})}checkManifestAndWeightFiles(t){const n=[],i=this.weightsFiles.map(a=>yA(a.name)),o={};for(const a of t)a.paths.forEach(l=>{const c=yA(l);if(n.indexOf(c)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${c}'`);if(n.push(c),i.indexOf(c)===-1)throw new Error(`Weight file with basename '${c}' is not provided.`);o[l]=this.weightsFiles[i.indexOf(c)]});if(n.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return o}}const tAt=r=>Cn().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(uh.URL_SCHEME)?eAt(r.slice(uh.URL_SCHEME.length)):null;cs.registerSaveRouter(tAt);function eAt(r="model"){return new uh(r)}function nAt(r){return new QNt(r)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bA(r,t,n,i){l(r),n=n??0,i=i??1,c(n,i);let o=0;const a=u=>(u.then(h=>{const d=n+ ++o/r.length*(i-n);return t(d),h}),u);function l(u){st(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function c(u,h){st(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),st(h>=0&&h<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${h}`),st(h>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${h}`)}return Promise.all(r.map(a))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function AP(r,t){t==null&&(t={});const n=t.fetchFunc==null?Cn().platform.fetch:t.fetchFunc,i=r.map(f=>n(f,t.requestInit,{isBinary:!0})),o=0,a=.5,c=(t.onProgress==null?await Promise.all(i):await bA(i,t.onProgress,o,a)).map(f=>f.arrayBuffer()),u=.5,h=1;return t.onProgress==null?await Promise.all(c):await bA(c,t.onProgress,u,h)}async function sAt(r,t="",n,i){return MP(l=>AP(l,{requestInit:i}))(r,t,n)}function MP(r){return async(t,n="",i)=>{const o=t.map(()=>!1),a={},l=i!=null?i.map(()=>!1):[],c=[];if(t.forEach((m,g)=>{let y=0;m.weights.forEach(v=>{const x="quantization"in v?v.quantization.dtype:v.dtype,b=Uw[x]*cr(v.shape),w=()=>{o[g]=!0,a[g]==null&&(a[g]=[]),a[g].push({manifestEntry:v,groupOffset:y,sizeBytes:b})};i!=null?i.forEach((S,_)=>{S===v.name&&(w(),l[_]=!0)}):w(),c.push(v.name),y+=b})}),!l.every(m=>m)){const m=i.filter((g,y)=>!l[y]);throw new Error(`Could not find weights in manifest with names: ${m.join(", ")}. 
Manifest JSON has weights with names: ${c.join(", ")}.`)}const u=o.reduce((m,g,y)=>(g&&m.push(y),m),[]),h=[];u.forEach(m=>{t[m].paths.forEach(g=>{const y=n+(n.endsWith("/")?"":"/")+g;h.push(y)})});const d=await r(h),f={};let p=0;return u.forEach(m=>{const g=t[m].paths.length;let y=0;for(let S=0;S<g;S++)y+=d[p+S].byteLength;const v=new ArrayBuffer(y),x=new Uint8Array(v);let b=0;for(let S=0;S<g;S++){const _=new Uint8Array(d[p+S]);x.set(_,b),b+=_.byteLength}a[m].forEach(S=>{const _=v.slice(S.groupOffset,S.groupOffset+S.sizeBytes),$=xP(_,[S.manifestEntry]);for(const N in $)f[N]=$[N]}),p+=g}),f}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rAt="application/octet-stream",iAt="application/json";class BC{constructor(t,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(st(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=Cn().platform.fetch,st(t!=null&&t.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(t)&&st(t.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`),this.path=t,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const i=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],o=bP(t,i);n.body.append("model.json",new Blob([JSON.stringify(o)],{type:iAt}),"model.json"),t.weightData!=null&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:rAt}),"model.weights.bin");const a=await this.fetch(this.path,n);if(a.ok)return{modelArtifactsInfo:Yg(t),responses:[a]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${a.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await t.json()}catch{let l=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?l+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":l+=" Please make sure the server is serving valid JSON for this request.",new Error(l)}const i=n.modelTopology,o=n.weightsManifest;if(i==null&&o==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return PC(n,a=>this.loadWeights(a))}async loadWeights(t){const n=Array.isArray(this.path)?this.path[1]:this.path,[i,o]=oAt(n),a=this.weightPathPrefix||i,l=SP(t),c=[],u=[];for(const d of t)for(const f of d.paths)this.weightUrlConverter!=null?u.push(this.weightUrlConverter(f)):c.push(a+f+o);this.weightUrlConverter&&c.push(...await Promise.all(u));const h=await AP(c,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[l,FC(h)]}}BC.URL_SCHEME_REGEX=/^https?:\/\//;function oAt(r){const t=r.lastIndexOf("/"),n=r.lastIndexOf("?"),i=r.substring(0,t),o=n>t?r.substring(n):"";return[i+"/",o]}function jw(r){return r.match(BC.URL_SCHEME_REGEX)!=null}const DP=(r,t)=>{if(typeof fetch>"u"&&(t==null||t.fetchFunc==null))return null;{let n=!0;if(Array.isArray(r)?n=r.every(i=>jw(i)):n=jw(r),n)return zC(r,t)}return null};cs.registerSaveRouter(DP);cs.registerLoadRouter(DP);function zC(r,t){return new BC(r,t)}function aAt(r,t){return zC(r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ob{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}}class RP{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}}class lAt{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=n=>Promise.resolve(t.save(n)))}}function cAt(r,t,n,i){const o=arguments;return new lAt(OP(...o))}function OP(r,t,n,i){return arguments.length===1?r.modelTopology!=null||r.weightSpecs!=null?new Ob(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Ob({modelTopology:r})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Ob({modelTopology:r,weightSpecs:t,weightData:n,trainingConfig:i}))}function uAt(r){return new RP(r)}function hAt(r){return new RP(r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LP=Object.freeze(Object.defineProperty({__proto__:null,browserFiles:nAt,browserHTTPRequest:aAt,concatenateArrayBuffers:FC,decodeWeights:xP,encodeWeights:vNt,fromMemory:cAt,fromMemorySync:OP,getLoadHandlers:INt,getModelArtifactsForJSON:PC,getModelArtifactsForJSONSync:wP,getModelArtifactsInfoForJSON:Yg,getSaveHandlers:$Nt,getWeightSpecs:SP,http:zC,isHTTPScheme:jw,loadWeights:sAt,registerLoadRouter:kNt,registerSaveRouter:CNt,weightsLoaderFactory:MP,withSaveHandler:uAt,withSaveHandlerSync:hAt,copyModel:UNt,listModels:zNt,moveModel:WNt,removeModel:VNt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dAt(r,t,n=!1,i=!1){let o=U(r,"a","matMul"),a=U(t,"b","matMul");[o,a]=xs(o,a);const l={a:o,b:a},c={transposeA:n,transposeB:i};return mt.runKernel(C$t,l,c)}const Pn=ot({matMul_:dAt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fAt(r,t,n=1,i=0,o="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const l={indices:U(r,"indices","oneHot","int32")},c={dtype:o,depth:t,onValue:n,offValue:i};return mt.runKernel(KIt,l,c)}const pAt=ot({oneHot_:fAt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $s(r,t){return mt.tidy(r,t)}function $a(r){pP(r).forEach(n=>n.dispose())}function ac(r){return mt.keep(r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mAt(r){const n={input:U(r,"input","imag")};return mt.runKernel(gIt,n)}const Wy=ot({imag_:mAt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gAt(r){const n={x:U(r,"x","neg")};return mt.runKernel(UIt,n)}const gl=ot({neg_:gAt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vAt(r){const n={input:U(r,"input","real")};return mt.runKernel(sEt,n)}const pm=ot({real_:vAt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yAt(r,t,n){const i=U(r,"x","transpose");if(t==null&&(t=i.shape.map((l,c)=>c).reverse()),st(i.rank===t.length,()=>`Error in transpose: rank of input ${i.rank} must match length of perm ${t}.`),t.forEach(l=>{st(l>=0&&l<i.rank,()=>`All entries in 'perm' must be between 0 and ${i.rank-1} but got ${t}`)}),i.rank<=1)return i.clone();const o={x:i},a={perm:t};return i.dtype==="complex64"?$s(()=>{let l=pm(i),c=Wy(i);return l=mt.runKernel(Ab,{x:l},a),c=mt.runKernel(Ab,{x:c},a),n&&(c=gl(c)),Ac(l,c)}):mt.runKernel(Ab,o,a)}const qw=ot({transpose_:yAt});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xAt(r,t){const n=[];for(let i=0;i<t.length;i++){const o=r[r.length-i-1],a=t.length-i-1,l=t[a];(o==null||o===1&&l>1)&&n.unshift(a)}return n}function Ys(r,t){const n=[],i=Math.max(r.length,t.length);for(let o=0;o<i;o++){let a=r[r.length-o-1];a==null&&(a=1);let l=t[t.length-o-1];if(l==null&&(l=1),a===1)n.unshift(l);else if(l===1)n.unshift(a);else if(a!==l){const c=`Operands could not be broadcast together with shapes ${r} and ${t}.`;throw Error(c)}else n.unshift(a)}return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FP(r,t,n){if(Mf(r),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const i=Kc(r,n);if(i.length!==3&&i.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(i.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Xc(r,t,i,n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let cu;function bAt(r,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,i=!1,o=!1,a=!1,l=!1,c=!1;if(r.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)i=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)a=!0;else if(r.getContext!=null)l=!0;else if(typeof ImageBitmap<"u"&&r instanceof ImageBitmap)c=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${r.constructor.name}`);if(Ow(oA,mt.backendName)!=null){const g={pixels:r},y={numChannels:t};return mt.runKernel(oA,g,y)}const[h,d]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height];let f;if(l)f=r.getContext("2d").getImageData(0,0,h,d).data;else if(i||n)f=r.data;else if(a||o||c){if(cu==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")cu=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else cu=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});cu.canvas.width=h,cu.canvas.height=d,cu.drawImage(r,0,0,h,d),f=cu.getImageData(0,0,h,d).data}let p;if(t===4)p=new Int32Array(f);else{const g=h*d;p=new Int32Array(g*t);for(let y=0;y<g;y++)for(let v=0;v<t;++v)p[y*t+v]=f[y*4+v]}return FP(p,[d,h,t],"int32")}async function PP(r,t){let n=U(r,"img","toPixels");if(!(r instanceof us)){const h=n;n=ps(h,"int32"),h.dispose()}if(n.rank!==2&&n.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[i,o]=n.shape.slice(0,2),a=n.rank===2?1:n.shape[2];if(a>4||a===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${a}`);if(n.dtype!=="float32"&&n.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const l=await n.data(),c=n.dtype==="float32"?255:1,u=new Uint8ClampedArray(o*i*4);for(let h=0;h<i*o;++h){const d=[0,0,0,255];for(let p=0;p<a;p++){const m=l[h*a+p];if(n.dtype==="float32"){if(m<0||m>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${m}.`)}else if(n.dtype==="int32"&&(m<0||m>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${m}.`);a===1?(d[0]=m*c,d[1]=m*c,d[2]=m*c):d[p]=m*c}const f=h*4;u[f+0]=Math.round(d[0]),u[f+1]=Math.round(d[1]),u[f+2]=Math.round(d[2]),u[f+3]=Math.round(d[3])}if(t!=null){t.width=o,t.height=i;const h=t.getContext("2d"),d=new ImageData(u,o,i);h.putImageData(d,0,0)}return n!==r&&n.dispose(),u}const BP=ot({fromPixels_:bAt});function wAt(r,t,n){const i=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${r}, sliceDim: ${i}, and batchDim: ${o}.`;if(n.rank<o)throw new Error(a+` update.rank < ${o}. `);if(r.length<i+(n.rank-o))throw new Error(a+` Output shape length < ${i+(n.rank-o)}`);if(n.rank!==o+r.length-i)throw new Error(a+` update.rank != ${o+r.length-i}`);for(let l=0;l<o;++l)if(n.shape[l]!==t.shape[l])throw new Error(a+` updates.shape[${l}] (${n.shape[l]}) != indices.shape[${l}] (${t.shape[l]}).`);for(let l=0;l<n.rank-o;++l)if(n.shape[l+o]!==r[l+i])throw new Error(a+` updates.shape[${l+o}] (${n.shape[l+o]}) != shape[${l+o}] (${r[l+o]})`)}function SAt(r,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(r.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${r.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(r.size===0)throw new Error(`Updates specified for empty output. updates shape: ${r.shape}`)}wAt(n,t,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _At(r,t){let n=U(r,"a","add"),i=U(t,"b","add");[n,i]=xs(n,i);const o={a:n,b:i};return mt.runKernel(aP,o)}const Hn=ot({add_:_At});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TAt(r,t){let n=U(r,"a","floorDiv"),i=U(t,"b","floorDiv");[n,i]=xs(n,i);const o={a:n,b:i};return mt.runKernel(cIt,o)}const zP=ot({floorDiv_:TAt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CAt(r,t){let n=U(r,"a","div"),i=U(t,"b","div");if([n,i]=xs(n,i),n.dtype==="int32"&&i.dtype==="int32")return zP(n,i);const o={a:n,b:i},a={};return mt.runKernel(Z$t,o,a)}const zn=ot({div_:CAt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kAt(r,t){let n=U(r,"a","mul"),i=U(t,"b","mul");[n,i]=xs(n,i);const o={a:n,b:i};return mt.runKernel(VIt,o)}const Re=ot({mul_:kAt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $At(r){const t=U(r,"x","abs");if(t.dtype==="complex64"){const n={x:t};return mt.runKernel(M$t,n)}else{const n={x:t};return mt.runKernel(u$t,n)}}const no=ot({abs_:$At});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IAt(r){const n={x:U(r,"x","acos")};return mt.runKernel(h$t,n)}const EAt=ot({acos_:IAt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NAt(r){const n={x:U(r,"x","acosh")};return mt.runKernel(d$t,n)}const AAt=ot({acosh_:NAt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MAt(r){st(Array.isArray(r),()=>"The argument passed to tf.addN() must be a list of tensors"),st(r.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${r.length}`);const t=r.map((o,a)=>U(o,`tensors${a}`,"addN")),n=t[0];t.forEach(o=>{if(o.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(o=>{if(!Nc(o.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const i=t;return mt.runKernel(f$t,i)}const DAt=ot({addN_:MAt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RAt(r,t=null,n=!1){const o={x:U(r,"x","all","bool")},a={axis:t,keepDims:n};return mt.runKernel(p$t,o,a)}const OAt=ot({all_:RAt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LAt(r,t=null,n=!1){const o={x:U(r,"x","any","bool")},a={axis:t,keepDims:n};return mt.runKernel(m$t,o,a)}const FAt=ot({any_:LAt});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PAt(r,t=0){const i={x:U(r,"x","argMax")},o={axis:t};return mt.runKernel(g$t,i,o)}const BAt=ot({argMax_:PAt});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zAt(r,t=0){const i={x:U(r,"x","argMin")},o={axis:t};return mt.runKernel(v$t,i,o)}const VAt=ot({argMin_:zAt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UAt(r){const n={x:U(r,"x","asin")};return mt.runKernel(y$t,n)}const WAt=ot({asin_:UAt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GAt(r){const n={x:U(r,"x","asinh")};return mt.runKernel(x$t,n)}const HAt=ot({asinh_:GAt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jAt(r){const n={x:U(r,"x","atan")};return mt.runKernel(b$t,n)}const qAt=ot({atan_:jAt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KAt(r,t){let n=U(r,"a","atan2"),i=U(t,"b","atan2");[n,i]=xs(n,i);const o={a:n,b:i};return mt.runKernel(S$t,o)}const XAt=ot({atan2_:KAt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YAt(r){const n={x:U(r,"x","atanh")};return mt.runKernel(w$t,n)}const ZAt=ot({atanh_:YAt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JAt(r,t,n,i,o,a,l="channelsLast"){const[c,u]=D2(t);let h;if(l==="channelsLast")h=[c,u,r[3],r[3]];else if(l==="channelsFirst")h=[c,u,r[1],r[1]];else throw new Error(`Unknown dataFormat ${l}`);return VC(r,h,n,i,o,a,!1,l)}function VC(r,t,n,i,o,a,l=!1,c="channelsLast"){let[u,h,d,f]=[-1,-1,-1,-1];if(c==="channelsLast")[u,h,d,f]=r;else if(c==="channelsFirst")[u,f,h,d]=r;else throw new Error(`Unknown dataFormat ${c}`);const[p,m,,g]=t,[y,v]=D2(n),[x,b]=D2(i),w=Kw(p,x),S=Kw(m,b),{padInfo:_,outHeight:$,outWidth:N}=eMt(o,h,d,y,v,w,S,a,c),k=l?g*f:g;let I;return c==="channelsFirst"?I=[u,k,$,N]:c==="channelsLast"&&(I=[u,$,N,k]),{batchSize:u,dataFormat:c,inHeight:h,inWidth:d,inChannels:f,outHeight:$,outWidth:N,outChannels:k,padInfo:_,strideHeight:y,strideWidth:v,filterHeight:p,filterWidth:m,effectiveFilterHeight:w,effectiveFilterWidth:S,dilationHeight:x,dilationWidth:b,inShape:r,outShape:I,filterShape:t}}function QAt(r,t,n,i,o){i==null&&(i=tMt(r,t,n));const a=r[0],l=r[1],c=R2((a-t+2*i)/n+1,o),u=R2((l-t+2*i)/n+1,o);return[c,u]}function tMt(r,t,n,i=1){const o=Kw(t,i);return Math.floor((r[0]*(n-1)-n+o)/2)}function D2(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Kw(r,t){return t<=1?r:r+(r-1)*(t-1)}function eMt(r,t,n,i,o,a,l,c,u){let h,d,f;if(typeof r=="number"){h={top:r,bottom:r,left:r,right:r,type:r===0?"VALID":"NUMBER"};const m=QAt([t,n],a,i,r,c);d=m[0],f=m[1]}else if(r==="same"){d=Math.ceil(t/i),f=Math.ceil(n/o);const p=Math.max(0,(d-1)*i+a-t),m=Math.max(0,(f-1)*o+l-n),g=Math.floor(p/2),y=p-g,v=Math.floor(m/2),x=m-v;h={top:g,bottom:y,left:v,right:x,type:"SAME"}}else if(r==="valid")h={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((t-a+1)/i),f=Math.ceil((n-l+1)/o);else if(typeof r=="object"){const p=u==="channelsLast"?r[1][0]:r[2][0],m=u==="channelsLast"?r[1][1]:r[2][1],g=u==="channelsLast"?r[2][0]:r[3][0],y=u==="channelsLast"?r[2][1]:r[3][1];h={top:p,bottom:m,left:g,right:y,type:p===0&&m===0&&g===0&&y===0?"VALID":"EXPLICIT"},d=R2((t-a+p+m)/i+1,c),f=R2((n-l+g+y)/o+1,c)}else throw Error(`Unknown padding parameter: ${r}`);return{padInfo:h,outHeight:d,outWidth:f}}function R2(r,t){if(!t)return Math.trunc(r);switch(t){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error(`Unknown roundingMode ${t}`)}}function O2(r){const[t,n,i]=D2(r);return t===1&&n===1&&i===1}function Yc(r,t){return O2(r)||O2(t)}function ha(r,t,n){if(n!=null){if(typeof t=="string")throw Error(`Error in ${r}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if(typeof t=="number")st(fm(t),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);else if(typeof t=="object")t.forEach(i=>{i.forEach(o=>{st(fm(o),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${n} but got pad ${o}.`)})});else throw Error(`Error in ${r}: Unknown padding parameter: ${t}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nMt(r,t){const i={x:U(r,"x","reshape","string_or_numeric")},o={shape:t};return mt.runKernel(oEt,i,o)}const Bt=ot({reshape_:nMt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sMt(r,t,n,i,o){const a=U(r,"x","avgPool","float32"),l=1;st(Yc(n,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${l}'`);let c=a,u=!1;a.rank===3&&(u=!0,c=Bt(a,[1,a.shape[0],a.shape[1],a.shape[2]])),st(c.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${c.rank}.`),ha("avgPool",i,o);const h={x:c},d={filterSize:t,strides:n,pad:i,dimRoundingMode:o};let f=mt.runKernel(_$t,h,d);return f=ps(f,a.dtype),u?Bt(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const VP=ot({avgPool_:sMt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rMt(r,t,n,i,o,a="NDHWC"){const l=U(r,"x","avgPool3d","float32");let c=l,u=!1;l.rank===4&&(u=!0,c=Bt(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),st(c.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${c.rank}.`),st(a==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${a}`),ha("avgPool3d",i,o);const h={x:c},d={filterSize:t,strides:n,pad:i,dimRoundingMode:o,dataFormat:a};let f=mt.runKernel(T$t,h,d);return f=ps(f,c.dtype),u?Bt(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const iMt=ot({avgPool3d_:rMt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oMt(r,t=0){st(r.length>=1,()=>"Pass at least one tensor to concat");const n=A2(r,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(a=>{if(a.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${a.dtype}. `)}),n.length===1)return mc(n[0]);const i=n,o={axis:t};return mt.runKernel(D$t,i,o)}const ur=ot({concat_:oMt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aMt(r){const n={x:U(r,"x","sigmoid","float32")};return mt.runKernel(wEt,n)}const Pu=ot({sigmoid_:aMt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lMt(r,t,n){const i=U(r,"x","slice","string_or_numeric");if(i.rank===0)throw new Error("Slicing scalar is not possible");const o={x:i},a={begin:t,size:n};return mt.runKernel(vEt,o,a)}const Je=ot({slice_:lMt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cMt(r){const n={x:U(r,"x","tanh","float32")};return mt.runKernel(zEt,n)}const Xw=ot({tanh_:cMt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uMt(r,t,n,i,o,a){const l=U(r,"forgetBias","basicLSTMCell"),c=U(t,"lstmKernel","basicLSTMCell"),u=U(n,"lstmBias","basicLSTMCell"),h=U(i,"data","basicLSTMCell"),d=U(o,"c","basicLSTMCell"),f=U(a,"h","basicLSTMCell"),p=ur([h,f],1),m=Pn(p,c),g=Hn(m,u),y=g.shape[0],v=g.shape[1]/4,x=[y,v],b=Je(g,[0,0],x),w=Je(g,[0,v],x),S=Je(g,[0,v*2],x),_=Je(g,[0,v*3],x),$=Hn(Re(Pu(b),Xw(w)),Re(d,Pu(Hn(l,S)))),N=Re(Xw($),Pu(_));return[$,N]}const hMt=ot({basicLSTMCell_:uMt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dMt(r,t,n){const i=U(r,"x","batchToSpaceND"),o=t.reduce((c,u)=>c*u);st(i.rank>=1+t.length,()=>`input rank is ${i.rank} but should be > than blockShape.length ${t.length}`),st(n.length===t.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`),st(i.shape[0]%o===0,()=>`input tensor batch is ${i.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${o}`);const a={x:i},l={blockShape:t,crops:n};return mt.runKernel(k$t,a,l)}const UP=ot({batchToSpaceND_:dMt});function fMt(r){let t;return r.rank===0||r.rank===1?t=Bt(r,[1,1,1,r.size]):r.rank===2?t=Bt(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?t=Bt(r,[1,r.shape[0],r.shape[1],r.shape[2]]):t=r,t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pMt(r,t,n,i,o,a){a==null&&(a=.001);const l=U(r,"x","batchNorm"),c=U(t,"mean","batchNorm"),u=U(n,"variance","batchNorm");let h;o!=null&&(h=U(o,"scale","batchNorm"));let d;i!=null&&(d=U(i,"offset","batchNorm")),st(c.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),st(d==null||c.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),st(h==null||c.rank===h.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:fMt(l),scale:h,offset:d,mean:c,variance:u},m={varianceEpsilon:a},g=mt.runKernel(uIt,p,m);return Bt(g,l.shape)}const Gy=ot({batchNorm_:pMt});function mMt(r,t,n,i,o,a){const l=U(r,"x","batchNorm"),c=U(t,"mean","batchNorm"),u=U(n,"variance","batchNorm");let h;o!=null&&(h=U(o,"scale","batchNorm"));let d;return i!=null&&(d=U(i,"offset","batchNorm")),st(l.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${l.rank}.`),st(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${c.rank}.`),st(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),h!=null&&st(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${h.rank}.`),d!=null&&st(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),Gy(l,c,u,d,h,a)}const gMt=ot({batchNorm2d_:mMt});function vMt(r,t,n,i,o,a){const l=U(r,"x","batchNorm"),c=U(t,"mean","batchNorm"),u=U(n,"variance","batchNorm");let h;o!=null&&(h=U(o,"scale","batchNorm"));let d;return i!=null&&(d=U(i,"offset","batchNorm")),st(l.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${l.rank}.`),st(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${c.rank}.`),st(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),h!=null&&st(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${h.rank}.`),d!=null&&st(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),Gy(l,c,u,d,h,a)}const yMt=ot({batchNorm3d_:vMt});function xMt(r,t,n,i,o,a){const l=U(r,"x","batchNorm"),c=U(t,"mean","batchNorm"),u=U(n,"variance","batchNorm");let h;o!=null&&(h=U(o,"scale","batchNorm"));let d;return i!=null&&(d=U(i,"offset","batchNorm")),st(l.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${l.rank}.`),st(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${c.rank}.`),st(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),h!=null&&st(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${h.rank}.`),d!=null&&st(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),Gy(l,c,u,d,h,a)}const bMt=ot({batchNorm4d_:xMt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wMt(r,t,n){const i=U(r,"x","bincount"),o=U(t,"weights","bincount");st(i.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${i.dtype}`),st(n>=0,()=>`size must be non-negative, but got ${n}.`),st(o.size===i.size||o.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${i.shape}, weights shape: ${o.shape}.`);const a={x:i,weights:o},l={size:n};return mt.runKernel($$t,a,l)}const WP=ot({bincount_:wMt});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SMt(r,t){const n=U(r,"s0","broadcastArgs","int32"),i=U(t,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(i.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${i.rank}`);const o={s0:n,s1:i};return mt.runKernel(I$t,o)}const _Mt=ot({broadcastArgs_:SMt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TMt(r,t){let n=U(r,"broadcastTo","x");const i=n.shape;if(t.some(h=>!(h>0)||h%1!==0))throw new Error(`broadcastTo(): Invalid broadcast shape [${t}].`);if(t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){const h=n.shape.slice();for(;h.length<t.length;)h.unshift(1);n=Bt(n,h)}const o=n.shape,a=Array.from(t);for(let h=t.length-1;h>=0;h--)if(o[h]===t[h])a[h]=1;else if(n.shape[h]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${t}].`);if(a.map((h,d)=>h>1?d:-1).filter(h=>h>=0).length===0)return mc(n);const c={x:n},u={reps:a};return mt.runKernel(uP,c,u)}const M1=ot({broadcastTo_:TMt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CMt(r){const n={x:U(r,"x","ceil","float32")};return mt.runKernel(E$t,n)}const kMt=ot({ceil_:CMt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hy(r,t,n){const i={shape:r,value:t,dtype:n};return mt.runKernel(oIt,{},i)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Mt(r,t,n){const i=U(r,"x","clipByValue");if(st(t<=n,()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`),t===n)return Hy(i.shape,t,i.dtype);const o={x:i},a={clipValueMin:t,clipValueMax:n};return mt.runKernel(N$t,o,a)}const GP=ot({clipByValue_:$Mt});function IMt(r){return ur(r,0)}const EMt=ot({concat1d_:IMt});function NMt(r,t){return ur(r,t)}const AMt=ot({concat2d_:NMt});function MMt(r,t){return ur(r,t)}const DMt=ot({concat3d_:MMt});function RMt(r,t){return ur(r,t)}const OMt=ot({concat4d_:RMt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LMt(r,t,n,i,o="NHWC",a=[1,1],l){const c=U(r,"x","conv2d","float32"),u=U(t,"filter","conv2d","float32");let h=c,d=!1;c.rank===3&&(d=!0,h=Bt(c,[1,c.shape[0],c.shape[1],c.shape[2]])),st(h.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${h.rank}.`),st(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),ha("conv2d",i,l);const f=o==="NHWC"?h.shape[3]:h.shape[1];st(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),st(Yc(n,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`);const p={x:h,filter:u},m={strides:n,pad:i,dataFormat:o,dilations:a,dimRoundingMode:l},g=mt.runKernel(R$t,p,m);return d?Bt(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const jy=ot({conv2d_:LMt});function FMt(r,t,n,i,o="NWC",a=1,l){const c=U(r,"x","conv1d"),u=U(t,"filter","conv1d");let h=c,d=!1;c.rank===2&&(d=!0,h=Bt(c,[1,c.shape[0],c.shape[1]])),st(h.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${h.rank}.`),st(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),ha("conv1d",i,l),st(h.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${h.shape[2]}) must match input depth for filter ${u.shape[1]}.`),st(Yc(n,a),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${a}'`),st(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);const f=Bt(u,[1,u.shape[0],u.shape[1],u.shape[2]]),p=Bt(h,[h.shape[0],1,h.shape[1],h.shape[2]]),v=jy(p,f,[1,n],i,"NHWC",[1,a],l);return d?Bt(v,[v.shape[2],v.shape[3]]):Bt(v,[v.shape[0],v.shape[2],v.shape[3]])}const PMt=ot({conv1d_:FMt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BMt(r,t,n,i,o,a="NHWC",l){st(r.length===t.rank,()=>`Length of inShape (${r.length}) and rank of dy (${t.rank}) must match`);let c=r,u=t,h=!1;t.rank===3&&(h=!0,u=Bt(t,[1,t.shape[0],t.shape[1],t.shape[2]]),c=[1,r[0],r[1],r[2]]),st(c.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${c.length}.`),st(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),st(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const d=a==="NHWC"?c[3]:c[1],f=a==="NHWC"?u.shape[3]:u.shape[1];st(d===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${n.shape[2]}.`),st(f===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[3]}.`),ha("conv2dDerInput",o,l);const p={dy:u,filter:n},m={strides:i,pad:o,dataFormat:a,dimRoundingMode:l,inputShape:c},g=mt.runKernel(L$t,p,m);return h?Bt(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const HP=ot({conv2DBackpropInput_:BMt});function zMt(r,t,n,i,o,a){const l=U(r,"x","conv2dTranspose"),c=U(t,"filter","conv2dTranspose");return HP(n,l,c,i,o,"NHWC",a)}const VMt=ot({conv2dTranspose_:zMt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UMt(r,t,n,i,o="NDHWC",a=[1,1,1]){const l=U(r,"x","conv3d"),c=U(t,"filter","conv3d");let u=l,h=!1;l.rank===4&&(h=!0,u=Bt(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),st(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),st(c.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${c.rank}.`),st(u.shape[4]===c.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${c.shape[3]}.`),st(Yc(n,a),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`),st(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`);const d={x:u,filter:c},f={strides:n,pad:i,dataFormat:o,dilations:a},p=mt.runKernel(F$t,d,f);return h?Bt(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const WMt=ot({conv3d_:UMt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GMt(r,t,n,i,o){st(r.length===t.rank,()=>`Length of inShape (${r.length}) and rank of dy (${t.rank}) must match`);let a=r,l=t,c=!1;t.rank===4&&(c=!0,l=Bt(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),a=[1,r[0],r[1],r[2],r[3]]);const u=a[4],h=l.shape[4];st(a.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${a.length}.`),st(l.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${l.rank}`),st(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),st(u===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`),st(h===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[4]}.`);const d={dy:l,filter:n},f={pad:o,strides:i,inputShape:a},p=mt.runKernel(P$t,d,f);return c?Bt(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const HMt=ot({conv3DBackpropInput_:GMt});function jMt(r,t,n,i,o){const a=U(r,"x","conv3dTranspose"),l=U(t,"filter","conv3dTranspose");return HMt(n,a,l,i,o)}const qMt=ot({conv3dTranspose_:jMt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KMt(r){const n={x:U(r,"x","cos","float32")};return mt.runKernel(B$t,n)}const XMt=ot({cos_:KMt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YMt(r){const n={x:U(r,"x","cosh","float32")};return mt.runKernel(z$t,n)}const ZMt=ot({cosh_:YMt});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JMt(r,t=0,n=!1,i=!1){const a={x:U(r,"x","cumprod")},l={axis:t,exclusive:n,reverse:i};return mt.runKernel(V$t,a,l)}const QMt=ot({cumprod_:JMt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t6t(r,t=0,n=!1,i=!1){const a={x:U(r,"x","cumsum")},l={axis:t,exclusive:n,reverse:i};return mt.runKernel(U$t,a,l)}const e6t=ot({cumsum_:t6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n6t(r,t,n,i=!1){const o=U(r,"x","denseBincount"),a=U(t,"weights","denseBincount");st(o.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${o.dtype}`),st(o.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${o.rank}.`),st(n>=0,()=>`size must be non-negative, but got ${n}.`),st(a.size===o.size||a.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${o.shape}, weights shape: ${a.shape}.`);const l={x:o,weights:a},c={size:n,binaryOutput:i};return mt.runKernel(G$t,l,c)}const s6t=ot({denseBincount_:n6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r6t(r,t,n="NHWC"){const i=U(r,"x","depthToSpace","float32"),o=n==="NHWC"?i.shape[1]:i.shape[2],a=n==="NHWC"?i.shape[2]:i.shape[3],l=n==="NHWC"?i.shape[3]:i.shape[1];st(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),st(o*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${t}  for depthToSpace with input shape
    ${i.shape}`),st(a*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${t} for depthToSpace with input shape
        ${i.shape}`),st(l%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${l} for depthToSpace with input shape ${i.shape}`);const c={x:i},u={blockSize:t,dataFormat:n};return mt.runKernel(H$t,c,u)}const i6t=ot({depthToSpace_:r6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o6t(r,t,n,i,o="NHWC",a=[1,1],l){const c=U(r,"x","depthwiseConv2d","float32"),u=U(t,"filter","depthwiseConv2d","float32");let h=c,d=!1;c.rank===3&&(d=!0,h=Bt(c,[1,c.shape[0],c.shape[1],c.shape[2]])),st(h.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${h.rank}.`),st(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);const f=o==="NHWC"?h.shape[3]:h.shape[1];st(f===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${u.shape[2]}.`),ha("depthwiseConv2d",i,l);const p={x:h,filter:u},m={strides:n,pad:i,dataFormat:o,dilations:a,dimRoundingMode:l},g=mt.runKernel(j$t,p,m);return d?Bt(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const UC=ot({depthwiseConv2d_:o6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a6t(r){const n={x:U(r,"x","diag")};return mt.runKernel(X$t,n)}const l6t=ot({diag_:a6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c6t(r,t,n,i,o=[1,1],a="NHWC"){const l=U(r,"x","dilation2d"),c=U(t,"filter","dilation2d");st(l.rank===3||l.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${l.rank}.`),st(c.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${c.rank}.`),st(a==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${a}`);let u=l,h=!1;l.rank===3&&(u=Bt(l,[1,l.shape[0],l.shape[1],l.shape[2]]),h=!0);const d={x:u,filter:c},f={strides:n,pad:i,dilations:o},p=mt.runKernel(Y$t,d,f);return h?Bt(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const u6t=ot({dilation2d_:c6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h6t(r,t){let n=U(r,"a","equal","string_or_numeric"),i=U(t,"b","equal","string_or_numeric");[n,i]=xs(n,i),Ys(n.shape,i.shape);const o={a:n,b:i};return mt.runKernel(eIt,o)}const jP=ot({equal_:h6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d6t(r,t,n){const i=U(t,"a","where"),o=U(n,"b","where"),a=U(r,"condition","where","bool"),l=Ys(Ys(a.shape,i.shape),o.shape),c=M1(a,l),u=M1(i,l),h=M1(o,l),d={condition:c,t:u,e:h};return mt.runKernel(mEt,d)}const nf=ot({where_:d6t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f6t(r){const n={x:U(r,"x","zerosLike")};return mt.runKernel(jEt,n)}const WC=ot({zerosLike_:f6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p6t(r,t){let n=U(r,"a","div"),i=U(t,"b","div");[n,i]=xs(n,i);const o=zn(n,i),a=WC(o),l=jP(i,a);return nf(l,a,o)}const m6t=ot({divNoNan_:p6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g6t(r,t){const n=U(r,"t1","dot"),i=U(t,"t2","dot");st((n.rank===1||n.rank===2)&&(i.rank===1||i.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${i.rank}.`);const o=n.rank===1?n.size:n.shape[1],a=i.rank===1?i.size:i.shape[0];if(st(o===a,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${a}.`),n.rank===1&&i.rank===1){const l=Bt(n,[1,-1]),c=Bt(i,[-1,1]),u=Pn(l,c);return Bt(u,[])}else if(n.rank===1&&i.rank===2){const l=Bt(n,[1,-1]),c=Bt(i,[i.shape[0],i.shape[1]]),u=Pn(l,c);return Bt(u,[u.size])}else if(n.rank===2&&i.rank===1){const l=Bt(i,[-1,1]),c=Pn(n,l);return Bt(c,[c.size])}else{const l=Bt(i,[i.shape[0],i.shape[1]]);return Pn(n,l)}}const v6t=ot({dot_:g6t});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y6t(r,...t){const n=t.map((o,a)=>U(o,`tensors${a}`,"einsum")),i={equation:r};return mt.runKernel(J$t,n,i)}const x6t=ot({einsum_:y6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b6t(r){const n={x:U(r,"x","elu","float32")};return mt.runKernel(Q$t,n)}const qP=ot({elu_:b6t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w6t(r){let t=U(r,"x","erf");st(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=ps(t,"float32"));const n={x:t};return mt.runKernel(tIt,n)}const S6t=ot({erf_:w6t});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _6t(r,t,n){const i=r.length+t.length,o=[];let a=0,l=0;for(let c=0;c<i;c++)n.indexOf(c)===-1?o.push(r[a++]):o.push(t[l++]);return o}function qy(r,t){const n=t.map(i=>1);return _6t(r,n,t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T6t(r,t=null,n=!1){const o={x:U(r,"x","max")},a={reductionIndices:t,keepDims:n};return mt.runKernel(NIt,o,a)}const Id=ot({max_:T6t});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C6t(r,t=null,n=!1){const o={x:U(r,"x","min")},a={axis:t,keepDims:n};return mt.runKernel(LIt,o,a)}const Yw=ot({min_:C6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k6t(r,t){let n=U(r,"base","pow"),i=U(t,"exp","pow");[n,i]=xs(n,i);const o={a:n,b:i};return mt.runKernel(ZIt,o)}const GC=ot({pow_:k6t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rn(r,t){if((za(r)&&t!=="string"||Array.isArray(r))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&za(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Xc(r,[],[],t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $6t(r){const n={x:U(r,"x","sqrt","float32")};return mt.runKernel(_Et,n)}const Zw=ot({sqrt_:$6t});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I6t(r){const t=U(r,"x","square"),n={};return mt.runKernel("Square",{x:t},n)}const Ky=ot({square_:I6t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E6t(r,t=null,n=!1){let i=U(r,"x","sum");i.dtype==="bool"&&(i=ps(i,"int32"));const o={x:i},a={axis:t,keepDims:n};return mt.runKernel(TEt,o,a)}const es=ot({sum_:E6t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N6t(r,t="euclidean",n=null,i=!1){r=U(r,"x","norm");const o=KP(r,t,n);let a=o.shape;if(i){const l=Uy(n,r.shape);a=qy(o.shape,l)}return Bt(o,a)}function KP(r,t,n=null){if(r.rank===0)return no(r);if(r.rank!==1&&n===null)return KP(Bt(r,[-1]),t,n);if(r.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(t===1)return es(no(r),n);if(t===1/0)return Id(no(r),n);if(t===-1/0)return Yw(no(r),n);if(t==="euclidean"||t===2)return Zw(es(GC(no(r),Rn(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&n.length===2){if(t===1)return Id(es(no(r),n[0]),n[1]-1);if(t===1/0)return Id(es(no(r),n[1]),n[0]);if(t===-1/0)return Yw(es(no(r),n[1]),n[0]);if(t==="fro"||t==="euclidean")return Zw(es(Ky(r),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Xy=ot({norm_:N6t});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A6t(r,t=null,n=!1){return Xy(r,"euclidean",t,n)}const M6t=ot({euclideanNorm_:A6t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D6t(r){const n={x:U(r,"x","exp")};return mt.runKernel(nIt,n)}const Tl=ot({exp_:D6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R6t(r,t=0){const n=U(r,"x","expandDims","string_or_numeric");st(t<=n.rank,()=>"Axis must be <= rank of the tensor");const i={input:n},o={dim:t};return mt.runKernel(sIt,i,o)}const Vo=ot({expandDims_:R6t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O6t(r){const n={x:U(r,"x","expm1")};return mt.runKernel(rIt,n)}const L6t=ot({expm1_:O6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F6t(r,t){const n=U(r,"x","tile","string_or_numeric");st(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`);const i={x:n},o={reps:t};return mt.runKernel(uP,i,o)}const Lp=ot({tile_:F6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P6t(r,t,n,i="float32"){t==null&&(t=r);const o=_l([r,t],i),a=r<=t?r:t;for(let c=0;c<a;++c)o.set(1,c,c);const l=Bt(o.toTensor(),[r,t]);if(n==null)return l;if(n.length===1)return Lp(Vo(l,0),[n[0],1,1]);if(n.length===2)return Lp(Vo(Vo(l,0),0),[n[0],n[1],1,1]);if(n.length===3)return Lp(Vo(Vo(Vo(l,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const XP=ot({eye_:P6t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B6t(r){const n={x:U(r,"x","floor","float32")};return mt.runKernel(lIt,n)}const YP=ot({floor_:B6t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z6t(r,t,n=0,i=0){const o=U(r,"x","gather"),a=U(t,"indices","gather","int32"),l={x:o,indices:a},c={axis:n,batchDims:i};return mt.runKernel(hIt,l,c)}const ZP=ot({gather_:z6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V6t(r,t){let n=U(r,"a","greater","string_or_numeric"),i=U(t,"b","greater","string_or_numeric");[n,i]=xs(n,i),Ys(n.shape,i.shape);const o={a:n,b:i};return mt.runKernel(fIt,o)}const Yy=ot({greater_:V6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U6t(r,t){let n=U(r,"a","greaterEqual","string_or_numeric"),i=U(t,"b","greaterEqual","string_or_numeric");[n,i]=xs(n,i),Ys(n.shape,i.shape);const o={a:n,b:i};return mt.runKernel(pIt,o)}const JP=ot({greaterEqual_:U6t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W6t(r){const n={x:U(r,"x","isFinite")};return mt.runKernel(vIt,n)}const G6t=ot({isFinite_:W6t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H6t(r){const n={x:U(r,"x","isInf")};return mt.runKernel(yIt,n)}const j6t=ot({isInf_:H6t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q6t(r){const n={x:U(r,"x","isNaN")};return mt.runKernel(xIt,n)}const K6t=ot({isNaN_:q6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X6t(r,t=.2){const i={x:U(r,"x","leakyRelu")},o={alpha:t};return mt.runKernel(bIt,i,o)}const QP=ot({leakyRelu_:X6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y6t(r,t){let n=U(r,"a","less","string_or_numeric"),i=U(t,"b","less","string_or_numeric");[n,i]=xs(n,i),Ys(n.shape,i.shape);const o={a:n,b:i};return mt.runKernel(wIt,o)}const Z6t=ot({less_:Y6t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J6t(r,t){let n=U(r,"a","lessEqual","string_or_numeric"),i=U(t,"b","lessEqual","string_or_numeric");[n,i]=xs(n,i),Ys(n.shape,i.shape);const o={a:n,b:i};return mt.runKernel(SIt,o)}const HC=ot({lessEqual_:J6t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q6t(r,t,n){if(n<=0)throw new Error("The number of values should be positive.");const i={start:r,stop:t,num:n};return mt.runKernel(_It,{},i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t5t(r,t=5,n=1,i=1,o=.5){const a=U(r,"x","localResponseNormalization");st(a.rank===4||a.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${a.rank}.`),st(fm(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let l=a,c=!1;a.rank===3&&(c=!0,l=Bt(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const u={x:l},h={depthRadius:t,bias:n,alpha:i,beta:o},d=mt.runKernel(EIt,u,h);return c?Bt(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const e5t=ot({localResponseNormalization_:t5t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n5t(r){const n={x:U(r,"x","log","float32")};return mt.runKernel(TIt,n)}const mm=ot({log_:n5t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s5t(r){const n={x:U(r,"x","log1p")};return mt.runKernel(CIt,n)}const tB=ot({log1p_:s5t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cl(r){return mt.customGrad(r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r5t(r){const n={x:U(r,"x","softplus")};return mt.runKernel(SEt,n)}const eB=ot({softplus_:r5t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i5t(r){const t=U(r,"x","logSigmoid");return Cl(i=>({value:gl(eB(gl(i))),gradFunc:l=>Re(l,Pu(gl(i)))}))(t)}const o5t=ot({logSigmoid_:i5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a5t(r,t){let n=U(r,"a","sub"),i=U(t,"b","sub");[n,i]=xs(n,i);const o={a:n,b:i};return mt.runKernel(PEt,o)}const wn=ot({sub_:a5t});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l5t(r,t=-1){const n=U(r,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return Cl((o,a)=>{const c=Id(o,t,!0),u=wn(o,c),h=wn(ps(u,"float32"),mm(es(Tl(u),t,!0)));return a([h]),{value:h,gradFunc:(f,p)=>{const[m]=p,g=!0,y=Tl(m);return wn(f,Re(es(f,t,g),y))}}})(n)}const c5t=ot({logSoftmax_:l5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u5t(r,t=null,n=!1){const i=U(r,"x","logSumExp"),o=Uy(t,i.shape),a=Id(i,o,!0),l=wn(i,a),c=Tl(l),u=es(c,o),h=mm(u),d=Hn(Bt(a,h.shape),h);if(n){const f=qy(d.shape,o);return Bt(d,f)}return d}const nB=ot({logSumExp_:u5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h5t(r,t){const n=U(r,"a","logicalAnd","bool"),i=U(t,"b","logicalAnd","bool");Ys(n.shape,i.shape);const o={a:n,b:i};return mt.runKernel(kIt,o)}const L2=ot({logicalAnd_:h5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d5t(r){const n={x:U(r,"x","logicalNot","bool")};return mt.runKernel($It,n)}const sB=ot({logicalNot_:d5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f5t(r,t){const n=U(r,"a","logicalOr","bool"),i=U(t,"b","logicalOr","bool");Ys(n.shape,i.shape);const o={a:n,b:i};return mt.runKernel(IIt,o)}const rB=ot({logicalOr_:f5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p5t(r,t){const n=U(r,"a","logicalXor","bool"),i=U(t,"b","logicalXor","bool");return Ys(n.shape,i.shape),L2(rB(r,t),sB(L2(r,t)))}const m5t=ot({logicalXor_:p5t});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g1=2147483648;function g5t(r,t,n="left"){const i=U(r,"sortedSequence","searchSorted"),o=U(t,"values","searchSorted"),a=i.shape[i.shape.length-1],l=o.shape[o.shape.length-1],c=Bt(i,[-1,a]),u=Bt(o,[-1,l]);if(c.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(c.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(cr(u.shape)>=g1)throw new Error(`values tensor size must less than ${g1}`);if(c.shape[1]>=g1)throw new Error(`trailing dim_size must less than ${g1} for int32 output type, was ${c.shape[1]}`);const h={sortedSequence:c,values:u},d={side:n};return mt.runKernel(pEt,h,d)}const jC=ot({searchSorted_:g5t});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v5t(r,t){return jC(r,t,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y5t(r,t,n,i,o){const a=U(r,"x","maxPool"),l=1;let c=a,u=!1;a.rank===3&&(u=!0,c=Bt(a,[1,a.shape[0],a.shape[1],a.shape[2]])),st(c.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${c.rank}.`),st(Yc(n,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${l}'`),ha("maxPool",i,o);const h={x:c},d={filterSize:t,strides:n,pad:i,dimRoundingMode:o},f=mt.runKernel(MIt,h,d);return u?Bt(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const iB=ot({maxPool_:y5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x5t(r,t=[1,1,1],n,i,o,a="NDHWC"){const l=U(r,"x","maxPool3d");let c=l,u=!1;l.rank===4&&(u=!0,c=Bt(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),st(c.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${c.rank}.`),st(a==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${a}`),ha("maxPool3d",i,o);const h={x:c},d={filterSize:t,strides:n,pad:i,dimRoundingMode:o,dataFormat:a},f=mt.runKernel(DIt,h,d);return u?Bt(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const b5t=ot({maxPool3d_:x5t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w5t(r,t,n,i,o=!1){const l={x:U(r,"x","maxPoolWithArgmax")},c={filterSize:t,strides:n,pad:i,includeBatchInIndex:o},u=mt.runKernel(RIt,l,c);return{result:u[0],indexes:u[1]}}const S5t=ot({maxPoolWithArgmax_:w5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _5t(r,t){let n=U(r,"a","maximum"),i=U(t,"b","maximum");[n,i]=xs(n,i),n.dtype==="bool"&&(n=ps(n,"int32"),i=ps(i,"int32")),Ys(n.shape,i.shape);const o={a:n,b:i};return mt.runKernel(AIt,o)}const T5t=ot({maximum_:_5t});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C5t(r,t=null,n=!1){const o={x:U(r,"x","mean")},a={axis:t,keepDims:n};return mt.runKernel(OIt,o,a)}const F2=ot({mean_:C5t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sf(r,t="float32"){if(t==="complex64"){const i=sf(r,"float32"),o=sf(r,"float32");return Ac(i,o)}const n=RC(cr(r),t);return mt.makeTensor(n,r,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cu(r,t="float32"){if(t==="complex64"){const i=Cu(r,"float32"),o=sf(r,"float32");return Ac(i,o)}const n=sP(cr(r),t);return mt.makeTensor(n,r,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k5t(r,t,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(r===void 0)return[];let i=U(r,"x","meshgrid",r instanceof us?r.dtype:"float32");if(t===void 0)return[i];let o=U(t,"y","meshgrid",t instanceof us?t.dtype:"float32");const a=cr(i.shape),l=cr(o.shape);return n==="xy"?(i=Bt(i,[1,-1]),o=Bt(o,[-1,1]),[Pn(Cu([l,1],i.dtype),i),Pn(o,Cu([1,a],o.dtype))]):(i=Bt(i,[-1,1]),o=Bt(o,[1,-1]),[Pn(i,Cu([1,l],i.dtype)),Pn(Cu([a,1],o.dtype),o)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $5t(r,t){let n=U(r,"a","minimum"),i=U(t,"b","minimum");[n,i]=xs(n,i),n.dtype==="bool"&&(n=ps(n,"int32"),i=ps(i,"int32")),Ys(n.shape,i.shape);const o={a:n,b:i};return mt.runKernel(FIt,o)}const oB=ot({minimum_:$5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I5t(r,t,n){st(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const i=U(r,"x","mirrorPad");if(i.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");st(t.length===i.rank,()=>`Padding doesn't match input. Must be ${i.rank}. Got ${t.length}.`);const o=n==="reflect"?1:0;for(let c=0;c<i.rank;c++)st(t[c].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),st(t[c][0]>=0&&t[c][0]<=i.shape[c]-o&&t[c][1]>=0&&t[c][1]<=i.shape[c]-o,()=>`Padding in dimension ${c} cannot be greater than or equal to ${i.shape[c]-o} or less than 0 for input of shape ${i.shape}`);const a={paddings:t,mode:n},l={x:i};return mt.runKernel(PIt,l,a)}const E5t=ot({mirrorPad_:I5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N5t(r,t){let n=U(r,"a","mod"),i=U(t,"b","mod");[n,i]=xs(n,i);const o={a:n,b:i};return mt.runKernel(BIt,o)}const A5t=ot({mod_:N5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M5t(r,t=null,n=!1){r=U(r,"x","moments");const i=Uy(t,r.shape),o=F2(r,i,n);let a=o.shape;n||(a=qy(o.shape,i));const l=Ky(wn(ps(r,"float32"),Bt(o,a))),c=F2(l,i,n);return{mean:o,variance:c}}const D5t=ot({moments_:M5t});function R5t(r,t,n,i){const o=U(t,"data","multiRNNCell"),a=A2(n,"c","multiRNNCell"),l=A2(i,"h","multiRNNCell");let c=o;const u=[];for(let f=0;f<r.length;f++){const p=r[f](c,a[f],l[f]);u.push(p[0]),u.push(p[1]),c=p[1]}const h=[],d=[];for(let f=0;f<u.length;f+=2)h.push(u[f]),d.push(u[f+1]);return[h,d]}const O5t=ot({multiRNNCell_:R5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L5t(r,t,n,i=!1){const o=U(r,"logits","multinomial"),a=o.size,l=o.rank;if(a<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${a}.`);if(l>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${l}`);n=n||Math.random();const u={logits:l===1?Bt(o,[1,-1]):o},h={numSamples:t,seed:n,normalized:i},d=mt.runKernel(zIt,u,h);return l===1?Bt(d,[d.size]):d}const F5t=ot({multinomial_:L5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P5t(r,t){let n=U(r,"a","notEqual","string_or_numeric"),i=U(t,"b","notEqual","string_or_numeric");[n,i]=xs(n,i),Ys(n.shape,i.shape);const o={a:n,b:i};return mt.runKernel(WIt,o)}const aB=ot({notEqual_:P5t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B5t(r){const n={x:U(r,"x","onesLike")};return mt.runKernel(qIt,n)}const z5t=ot({onesLike_:B5t});function V5t(r,t){const n=U(r,"v1","outerProduct"),i=U(t,"v2","outerProduct");st(n.rank===1&&i.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${i.rank}.`);const o=Bt(n,[-1,1]),a=Bt(i,[1,-1]);return Pn(o,a)}const U5t=ot({outerProduct_:V5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W5t(r,t,n=0){const i=U(r,"x","pad");if(i.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const o={paddings:t,constantValue:n},a={x:i};return mt.runKernel(YIt,a,o)}const Zg=ot({pad_:W5t});function G5t(r,t,n=0){return st(t.length===2,()=>"Invalid number of paddings. Must be length of 2."),Zg(r,[t],n)}const H5t=ot({pad1d_:G5t});function j5t(r,t,n=0){return st(t.length===2&&t[0].length===2&&t[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Zg(r,t,n)}const q5t=ot({pad2d_:j5t});function K5t(r,t,n=0){return st(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Zg(r,t,n)}const X5t=ot({pad3d_:K5t});function Y5t(r,t,n=0){return st(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Zg(r,t,n)}const Z5t=ot({pad4d_:Y5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J5t(r,t,n){const i=U(r,"x","spaceToBatchND");st(i.rank>=1+t.length,()=>`input rank ${i.rank} should be > than [blockShape] ${t.length}`),st(n.length===t.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`),st(i.shape.reduce((l,c,u)=>u>0&&u<=t.length?l&&(c+n[u-1][0]+n[u-1][1])%t[u-1]===0:l,!0),()=>`input spatial dimensions ${i.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`);const o={x:i},a={blockShape:t,paddings:n};return mt.runKernel(CEt,o,a)}const lB=ot({spaceToBatchND_:J5t});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q5t(r,t,n,i,o,a,l){o==null&&(o=[1,1]),a==null&&(a=1),i===0&&(i="valid");const c=U(r,"x","maxPool");let u=c,h=!1;c.rank===3&&(h=!0,u=Bt(c,[1,c.shape[0],c.shape[1],c.shape[2]])),st(Yc(a,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${a} and dilations '${o}'`);const d=JAt(u.shape,t,a,o,i),f=[d.dilationHeight,d.dilationWidth];let p;i==="same"?p=eDt([d.filterHeight,d.filterWidth],f):p=[[0,0],[0,0]];const m=f[0]===1&&f[1]===1,[g,y]=tDt([d.inHeight,d.inWidth],f,p),v=m?i:"valid",x=m?u:lB(u,f,g),w=(n==="avg"?()=>VP(x,t,a,v,l):()=>iB(x,t,a,v,l))(),S=m?w:UP(w,f,y);return h?Bt(S,[S.shape[1],S.shape[2],S.shape[3]]):S}function tDt(r,t,n){const i=n.map(d=>d[0]),o=n.map(d=>d[1]),a=r.concat(i,o),l=t.map((d,f)=>(d-a[f]%d)%d),c=o.map((d,f)=>d+l[f]),u=t.map((d,f)=>[i[f],c[f]]),h=t.map((d,f)=>[0,l[f]]);return[u,h]}function eDt(r,t){const i=r.map((l,c)=>l+(l-1)*(t[c]-1)).map(l=>l-1),o=i.map(l=>Math.floor(l/2)),a=i.map((l,c)=>l-o[c]);return i.map((l,c)=>[o[c],a[c]])}const nDt=ot({pool_:Q5t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sDt(r,t){const n=U(r,"x","prelu"),i=U(t,"alpha","prelu"),o={x:n,alpha:i};return mt.runKernel(JIt,o)}const cB=ot({prelu_:sDt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rDt(r,t=null,n=!1){let i=U(r,"x","prod");i.dtype==="bool"&&(i=ps(i,"int32"));const o={x:i},a={axis:t,keepDims:n};return mt.runKernel(QIt,o,a)}const iDt=ot({prod_:rDt});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oDt(r,t,n,i){const o=r.map((d,f)=>U(d,`tensors${f}`,"raggedGather","int32")),a=U(t,"paramsDenseValues","raggedGather"),l=U(n,"indices","raggedGather","int32"),c={paramsNestedSplits:o,paramsDenseValues:a,indices:l},u={outputRaggedRank:i},h=mt.runKernel(tEt,c,u);return{outputNestedSplits:h.slice(0,h.length-1),outputDenseValues:h[h.length-1]}}const aDt=ot({raggedGather_:oDt});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lDt(r,t,n,i,o){const a=U(r,"shape","raggedTensorToTensor","int32"),l=U(t,"values","raggedTensorToTensor"),c=U(n,"defaultValue","raggedTensorToTensor",l.dtype),u=i.map((f,p)=>U(f,`tensors${p}`,"raggedTensorToTensor","int32")),h={shape:a,values:l,defaultValue:c,rowPartitionTensors:u},d={rowPartitionTypes:o};return mt.runKernel(eEt,h,d)}const cDt=ot({raggedTensorToTensor_:lDt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uDt(r,t,n){const i=cr(r);let o=null;if(n==null||n==="float32")o=new Float32Array(i);else if(n==="int32")o=new Int32Array(i);else if(n==="bool")o=new Uint8Array(i);else throw new Error(`Unknown data type ${n}`);for(let a=0;a<i;a++)o[a]=t();return mt.makeTensor(o,r,n)}const hDt=ot({rand_:uDt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qC{constructor(t,n,i,o,a){this.mean=t,this.stdDev=n,this.dtype=i,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const l=a||Math.random();this.random=gf.alea(l.toString())}nextValue(){if(!isNaN(this.nextVal)){const o=this.nextVal;return this.nextVal=NaN,o}let t,n,i=!1;for(;!i;){let o,a,l;do o=2*this.random()-1,a=2*this.random()-1,l=o*o+a*a;while(l>=1||l===0);const c=Math.sqrt(-2*Math.log(l)/l);t=this.mean+this.stdDev*o*c,n=this.mean+this.stdDev*a*c,(!this.truncated||this.isValidTruncated(t))&&(i=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class dDt{constructor(t,n,i,o){this.alpha=t,this.beta=1/n,this.dtype=i;const a=o||Math.random();this.randu=gf.alea(a.toString()),this.randn=new qC(0,1,i,!1,this.randu()),t<1?this.d=t+2/3:this.d=t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,n,i,o,a,l;for(;;){do o=this.randn.nextValue(),l=1+this.c*o;while(l<=0);if(l*=l*l,t=o*o,n=1-.331*t*t,i=.5*t+this.d*(1-l+Math.log(l)),a=this.randu(),a<n||Math.log(a)<i)break}return l=1/this.beta*this.d*l,this.alpha<1&&(l*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(l)}convertValue(t){return this.dtype==="float32"?t:Math.round(t)}}class fDt{constructor(t=0,n=1,i,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=n-t,this.dtype=i,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${n} <= 1 and dtype is not float`);this.random=gf.alea(o)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pDt(r,t,n=1,i="float32",o){if(n==null&&(n=1),i==null&&(i="float32"),i!=="float32"&&i!=="int32")throw new Error(`Unsupported data type ${i}`);const a=new dDt(t,n,i,o),l=_l(r,i);for(let c=0;c<l.values.length;c++)l.values[c]=a.nextValue();return l.toTensor()}const mDt=ot({randomGamma_:pDt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gDt(r,t=0,n=1,i,o){if(i!=null&&i==="bool")throw new Error(`Unsupported data type ${i}`);const a=new qC(t,n,i,!1,o),l=_l(r,i);for(let c=0;c<l.values.length;c++)l.values[c]=a.nextValue();return l.toTensor()}const uB=ot({randomNormal_:gDt});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vDt(r,t,n){if(t!=null&&t==="bool")throw new Error(`Unsupported data type ${t}`);return uB(r,0,1,t,n)}const yDt=ot({randomStandardNormal_:vDt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xDt(r,t=0,n=1,i="float32",o){const a=_l(r,i),l=new fDt(t,n,null,o);for(let c=0;c<a.values.length;c++)a.values[c]=l.nextValue();return a.toTensor()}const hB=ot({randomUniform_:xDt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gm(r,t,n=1,i="float32"){if(n===0)throw new Error("Cannot have a step of zero");const o={start:r,stop:t,step:n,dtype:i};return mt.runKernel(nEt,{},o)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bDt(r){const n={x:U(r,"x","reciprocal")};return mt.runKernel(rEt,n)}const wDt=ot({reciprocal_:bDt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SDt(r){const n={x:U(r,"x","relu")};return mt.runKernel(iEt,n)}const Zy=ot({relu_:SDt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Dt(r){const n={x:U(r,"x","relu6")};return mt.runKernel(cEt,n)}const dB=ot({relu6_:_Dt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TDt(r,t){const i={x:U(r,"x","reverse")},o={dims:t};return mt.runKernel(uEt,i,o)}const hh=ot({reverse_:TDt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CDt(r){const t=U(r,"x","reverse");return st(t.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`),hh(t,0)}const kDt=ot({reverse1d_:CDt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Dt(r,t){const n=U(r,"x","reverse");return st(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),hh(n,t)}const IDt=ot({reverse2d_:$Dt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EDt(r,t){const n=U(r,"x","reverse");return st(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),hh(n,t)}const NDt=ot({reverse3d_:EDt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ADt(r,t){const n=U(r,"x","reverse");return st(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),hh(n,t)}const MDt=ot({reverse4d_:ADt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DDt(r){const n={x:U(r,"x","round")};return mt.runKernel(hEt,n)}const fB=ot({round_:DDt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RDt(r){const n={x:U(r,"x","rsqrt","float32")};return mt.runKernel(dEt,n)}const ODt=ot({rsqrt_:RDt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LDt(r){const n={x:U(r,"x","selu")};return mt.runKernel(gEt,n)}const FDt=ot({selu_:LDt});function PDt(r,t,n,i,o,a=[1,1],l="NHWC"){const c=U(r,"x","separableConv2d"),u=U(t,"depthwiseFilter","separableConv2d"),h=U(n,"pointwiseFilter","separableConv2d");let d=c,f=!1;if(c.rank===3&&(f=!0,d=Bt(c,[1,c.shape[0],c.shape[1],c.shape[2]])),l==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");st(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),st(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),st(h.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),st(h.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${h.shape[0]}.`),st(h.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${h.shape[1]}.`);const p=u.shape[2],m=u.shape[3];st(h.shape[2]===p*m,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*m}, but got ${h.shape[2]}.`);const g=UC(d,u,i,o,l,a),v=jy(g,h,1,"valid",l);return f?Bt(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const BDt=ot({separableConv2d_:PDt});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function zDt(r,t){const n=U(r,"x","setdiff1d"),i=U(t,"y","setdiff1d");st(n.dtype===i.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${i.dtype}).`),st(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),st(i.rank===1,()=>`y should be 1D tensor, but got y (${i.shape}).`);const o=await n.data(),a=await i.data(),l=new Set(a);let c=0;for(let d=0;d<o.length;d++)l.has(o[d])||c++;const u=new Lw([c],n.dtype),h=new Lw([c],"int32");for(let d=0,f=0;d<o.length;d++)l.has(o[d])||(u.values[f]=o[d],h.values[f]=d,f++);return[u.toTensor(),h.toTensor()]}const VDt=zDt;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UDt(r){const n={x:U(r,"x","sign")};return mt.runKernel(bEt,n)}const WDt=ot({sign_:UDt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GDt(r){const n={x:U(r,"x","sin","float32")};return mt.runKernel(yEt,n)}const HDt=ot({sin_:GDt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jDt(r){const n={x:U(r,"x","sinh")};return mt.runKernel(xEt,n)}const qDt=ot({sinh_:jDt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KDt(r,t,n){const i=U(r,"x","slice1d");return st(i.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${i.rank} tensor`),Je(i,[t],[n])}const XDt=ot({slice1d_:KDt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YDt(r,t,n){const i=U(r,"x","slice2d");return st(i.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${i.rank} tensor`),Je(i,t,n)}const ZDt=ot({slice2d_:YDt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JDt(r,t,n){const i=U(r,"x","slice3d");return st(i.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${i.rank} tensor`),Je(i,t,n)}const QDt=ot({slice3d_:JDt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tRt(r,t,n){const i=U(r,"x","slice4d");return st(i.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${i.rank} tensor`),Je(i,t,n)}const eRt=ot({slice4d_:tRt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nRt(r,t=-1){const n=U(r,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);const i={logits:n},o={dim:t};return mt.runKernel($Et,i,o)}const sRt=ot({softmax_:nRt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rRt(r){st(r.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${r.dtype}.`);const t={input:r};return mt.runKernel(iIt,t)}const KC=ot({fft_:rRt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iRt(r){st(r.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${r.dtype}.`);const t={input:r};return mt.runKernel(mIt,t)}const P2=ot({ifft_:iRt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oRt(r){const t=r.shape[r.shape.length-1],n=r.size/t;let i;if(t<=2){const o=Bt(r,[n,t]);i=P2(o)}else{const o=[n,2*(t-1)],a=Bt(pm(r),[n,t]),l=Bt(Wy(r),[n,t]),c=hh(Je(a,[0,1],[n,t-2]),1),u=Re(hh(Je(l,[0,1],[n,t-2]),1),Rn(-1)),h=ur([a,c],1),d=ur([l,u],1),f=Bt(Ac(h,d),[o[0],o[1]]);i=P2(f)}if(i=pm(i),r.rank===3&&r.shape[0]!==0){const o=i,a=r.shape[0];i=Bt(i,[a,i.shape[0]/a,i.shape[1]]),o.dispose()}return i}const pB=ot({irfft_:oRt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aRt(r,t,n=0){const o={x:U(r,"x","split")},a={numOrSizeSplits:t,axis:n};return mt.runKernel(kEt,o,a)}const vm=ot({split_:aRt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lRt(r,t){st(r.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${r.dtype}`);let n=r.shape[r.shape.length-1];const i=r.size/n;let o;if(t!=null&&t<n){const g=r.shape.map(v=>0),y=r.shape.map(v=>v);y[r.shape.length-1]=t,o=Je(r,g,y),n=t}else if(t!=null&&t>n){const g=r.shape.map(y=>y);g[r.shape.length-1]=t-n,o=ur([r,sf(g)],r.shape.length-1),n=t}else o=r;const a=WC(o),l=Bt(Ac(o,a),[i,n]),c=KC(l),u=Math.floor(n/2)+1,h=pm(c),d=Wy(c),f=vm(h,[u,n-u],h.shape.length-1),p=vm(d,[u,n-u],d.shape.length-1),m=o.shape.slice();return m[o.shape.length-1]=u,Bt(Ac(f[0],p[0]),m)}const XC=ot({rfft_:lRt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cRt(r,t){let n=U(r,"a","squaredDifference"),i=U(t,"b","squaredDifference");[n,i]=xs(n,i),Ys(n.shape,i.shape);const o={a:n,b:i},a={};return mt.runKernel(DEt,o,a)}const mB=ot({squaredDifference_:cRt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uRt(r,t){const n=U(r,"x","squeeze","string_or_numeric");return Bt(n,Ykt(n.shape,t).newShape)}const Vs=ot({squeeze_:uRt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hRt(r,t=0){const n=A2(r,"tensors","stack","string_or_numeric");st(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&st(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");const i=n,o={axis:t};return mt.runKernel(XIt,i,o)}const kl=ot({stack_:hRt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dRt(r,t=0){const i={x:U(r,"x","step")},o={alpha:t};return mt.runKernel(qEt,i,o)}const gB=ot({step_:dRt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fRt(r,t,n,i,o=0,a=0,l=0,c=0,u=0){const d={x:U(r,"x","stridedSlice","string_or_numeric")},f={begin:t,end:n,strides:i,beginMask:o,endMask:a,ellipsisMask:l,newAxisMask:c,shrinkAxisMask:u};return mt.runKernel(REt,d,f)}const pRt=ot({stridedSlice_:fRt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mRt(r){const n={x:U(r,"x","tan","float32")};return mt.runKernel(BEt,n)}const gRt=ot({tan_:mRt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lr(r,t){Mf(r);const n=Kc(r,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Xc(r,null,n,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gc(r,t,n){if(Mf(r),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const i=Kc(r,n);if(i.length!==2&&i.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(i.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Xc(r,t,i,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vRt(r,t,n){if(Mf(r),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const i=Kc(r,n);if(i.length!==4&&i.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(i.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Xc(r,t,i,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yRt(r,t,n){if(Mf(r),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const i=Kc(r,n);if(i.length!==5&&i.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(i.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Xc(r,t,i,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xRt(r,t,n){if(Mf(r),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const i=Kc(r,n);if(i.length!==6&&i.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(i.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return t=t||i,Xc(r,t,i,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bRt(r,t=1,n=!0){const i=U(r,"x","topk");if(i.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const o=i.shape[i.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${t}`);const a={x:i},l={k:t,sorted:n},[c,u]=mt.runKernel(VEt,a,l);return{values:c,indices:u}}const wRt=ot({topk_:bRt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SRt(r,t=0,n=1,i,o){if(i!=null&&i==="bool")throw new Error("Unsupported data type $ { dtype }");const a=new qC(t,n,i,!0,o),l=_l(r,i);for(let c=0;c<l.values.length;c++)l.values[c]=a.nextValue();return l.toTensor()}const _Rt=ot({truncatedNormal_:SRt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TRt(r,t=0){const n=U(r,"x","unique","string_or_numeric");st(n.rank>0,()=>"The input tensor must be at least 1D");const i={x:n},o={axis:t},[a,l]=mt.runKernel(WEt,i,o);return{values:a,indices:l}}const CRt=ot({unique_:TRt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kRt(r,t,n){const i=U(r,"x","unsortedSegmentSum"),o=U(t,"segmentIds","unsortedSegmentSum","int32");st(fm(n),()=>"numSegments must be of dtype int");const a={x:i,segmentIds:o},l={numSegments:n};return mt.runKernel(HEt,a,l)}const $Rt=ot({unsortedSegmentSum_:kRt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IRt(r,t=0){const n=U(r,"x","unstack","string_or_numeric");st(t>=-n.shape.length&&t<n.shape.length,()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`);const i={value:n},o={axis:t};return mt.runKernel(GEt,i,o)}const Eh=ot({unstack_:IRt});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ERt(r,t){return jC(r,t,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NRt(r,t=!0,n,i){return mt.makeVariable(r,t,n,i)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ARt(r,t){const n=[];for(let a=0;a<t.length;a++)t[a]&&n.push(a);const i=_l(r,"int32"),o=_l([n.length,r.length],"int32");for(let a=0;a<n.length;a++){const l=i.indexToLoc(n[a]),c=a*r.length;o.values.set(l,c)}return o.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function MRt(r){const t=U(r,"condition","whereAsync","bool"),n=await t.data(),i=ARt(t.shape,n);return r!==t&&t.dispose(),i}const vB=MRt;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function DRt(r,t,n){const i=U(r,"tensor","boolMask"),o=U(t,"mask","boolMask","bool"),a=n??0,l=o.rank,c=i.shape;st(l>0,()=>"mask cannot be scalar"),Eo(c.slice(a,a+l),o.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let y=a;y<a+l;y++)u*=c[y];const h=c.slice(0,a).concat([u],c.slice(a+l)),d=Bt(i,h),f=Bt(o,[-1]),p=await vB(f),m=Vs(p,[1]),g=ZP(d,m,a);return r!==i&&i.dispose(),t!==o&&o.dispose(),m.dispose(),d.dispose(),f.dispose(),p.dispose(),g}const RRt=DRt;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ORt(r,t,n,i,o=!0){const a=U(r,"v","movingAverage"),l=U(t,"x","movingAverage"),c=U(n,"decay","movingAverage");hNt(a,l),st(Nc(a.shape,l.shape),()=>"Shape mismatch in v and x");const u=Rn(1),h=wn(u,c);let d=Re(wn(l,a),h);if(o){st(i!=null,()=>"When using zeroDebias: true, step is required.");const f=U(i,"step","movingAverage");d=zn(d,wn(u,GC(c,f)))}return Hn(a,d)}const LRt=ot({movingAverage_:ORt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FRt(r,t,n){const i=U(r,"indices","scatterND","int32"),o=U(t,"updates","scatterND");SAt(o,i,n);const a={indices:i,updates:o},l={shape:n};return mt.runKernel(fEt,a,l)}const PRt=ot({scatterND_:FRt});function BRt(r,t,n,i){if(r.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${r.dtype}.`);if(r.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${r.shape}.`);const o=r.rank>0?r.shape[0]:1,a=r.rank>1?r.shape[1]:1;if(n.length!==a)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${a}.`);const l=t.size;if(!(t.rank===0||t.rank===1&&l===o))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${o}]`);if(t.dtype!==i.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zRt(r,t,n,i=0){const o=U(r,"sparseIndices","sparseToDense","int32"),a=U(t,"sparseValues","sparseToDense","string_or_numeric"),l=U(i,"defaultValue","sparseToDense",a.dtype);BRt(o,a,n,l);const c={sparseIndices:o,sparseValues:a,defaultValue:l},u={outputShape:n};return mt.runKernel(MEt,c,u)}const VRt=ot({sparseToDense_:zRt});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function URt(r,t){const n=U(t,"indices","gatherND","int32"),o={params:U(r,"x","gatherND","string_or_numeric"),indices:n};return mt.runKernel(dIt,o)}const WRt=ot({gatherND_:URt});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GRt(r,t){if(t==null)return r.shape.slice();if(Nc(r.shape,t))return t;if(r.shape.length===t.length){const n=[];for(let i=0;i<r.shape.length;i++)t[i]==null&&r.shape[i]!=null?n.push(r.shape[i]):n.push(t[i]);return n}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HRt(r,t,n,i){const o=U(r,"x","dropout");if(st(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),st(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return r instanceof us?o.clone():o;const a=GRt(o,n),l=1-t,c=zn(YP(Hn(hB(a,0,1,"float32",i),l)),l);return Re(o,c)}const jRt=ot({dropout_:HRt});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yB(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function YC(r,t,n){const i=1-r%2,o=new Float32Array(r);for(let a=0;a<r;++a){const l=2*Math.PI*a/(r+i-1);o[a]=t-n*Math.cos(l)}return Lr(o,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function qRt(r,t,n=1){const i=U(r,"predictions","inTopK"),o=U(t,"targets","inTopK");st(i.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${i.rank}`),st(i.rank-1===o.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${i.rank} and targets rank ${o.rank}`),Eo(i.shape.slice(0,i.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const a=i.shape[i.shape.length-1];st(n>0&&n<=a,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${a}), but got ${n}`);const l=await i.data(),c=await o.data(),[u,h]=[l.length/a,a],d=Zkt("bool",u);for(let f=0;f<u;f++){const p=f*h,m=l.subarray(p,p+h),g=[];for(let y=0;y<m.length;y++)g.push({value:m[y],index:y});g.sort((y,v)=>v.value-y.value),d[f]=0;for(let y=0;y<n;y++)if(g[y].index===c[f]){d[f]=1;break}}return r!==i&&i.dispose(),t!==o&&o.dispose(),La(d,o.shape,"bool")}const KRt=qRt;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XRt(r,t,n,i,o,a="NHWC",l){let c=r;r.rank===3&&(c=Bt(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=t;u.rank===3&&(u=Bt(t,[1,t.shape[0],t.shape[1],t.shape[2]])),st(c.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${c.shape}.`),st(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),st(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const h=a==="NHWC"?c.shape[3]:c.shape[1],d=a==="NHWC"?u.shape[3]:u.shape[1];st(h===n[2],()=>`Error in conv2dDerFilter: depth of input ${h}) must match input depth in filter (${n[2]}.`),st(d===n[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${n[3]}).`),ha("conv2dDerFilter",o,l);const f={x:c,dy:u},p={strides:i,pad:o,dataFormat:a,dimRoundingMode:l,filterShape:n};return mt.runKernel(O$t,f,p)}const YRt=ot({conv2DBackpropFilter_:XRt});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZC(r,t,n){if(n==null||n==="linear")return r;if(n==="relu")return Re(r,gB(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function JC(r,t){let n=t;const i=xAt(r.shape,t.shape);return i.length>0&&(n=es(n,i)),Bt(n,r.shape)}function QC(r,t,n,i){if(t==="linear")return r;if(t==="relu")return Zy(r);if(t==="elu")return qP(r);if(t==="relu6")return dB(r);if(t==="prelu")return cB(r,n);if(t==="leakyrelu")return QP(r,i);if(t==="sigmoid")return Pu(r);throw new Error(`Unknown fused activation ${t}.`)}const tk=(r,t)=>!(r>0)||t==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZRt({x:r,filter:t,strides:n,pad:i,dataFormat:o="NHWC",dilations:a=[1,1],dimRoundingMode:l,bias:c,activation:u="linear",preluActivationWeights:h,leakyreluAlpha:d}){if(u=u||"linear",tk(mt.state.gradientDepth,u)===!1){st(o==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${o} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let $=jy(r,t,n,i,o,a,l);return c!=null&&($=Hn($,c)),QC($,u,h,d)}const f=U(r,"x","conv2d","float32"),p=U(t,"filter","conv2d","float32");let m=f,g=!1;f.rank===3&&(g=!0,m=Bt(f,[1,f.shape[0],f.shape[1],f.shape[2]])),st(m.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${m.rank}.`),st(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),ha("fused conv2d",i,l);const y=o==="NHWC"?m.shape[3]:m.shape[1];st(p.shape[2]===y,()=>`Error in conv2d: depth of input (${y}) must match input depth for filter ${p.shape[2]}.`),st(Yc(n,a),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`);const v=VC(m.shape,p.shape,n,a,i,l);let x;c!=null&&(x=U(c,"bias","fused conv2d"),[x]=xs(x,f),o==="NHWC"?Ys(v.outShape,x.shape):(st(x.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${x.shape.length}.`),st(x.shape.length===0||x.shape[0]===v.outChannels||x.shape[0]===1,()=>`Error in fused conv2d: bias shape (${x.shape}) is not compatible with the number of output channels (${v.outChannels})`)));let b;if(h!=null){const $=h.shape;if(st($.length<=1||$.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${$.length}.`),$.length===1)st($[0]===1||$[0]===v.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the number of output channels (${v.outChannels}).`);else if($.length===3)try{Ys($,v.outShape)}catch{const k=`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the output shape of the conv2d (${v.outShape}).`;throw Error(k)}b=U(h,"prelu weights","fused conv2d")}const w=($,N)=>{st(o==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${o} but only NHWC is currently supported.`);const[k,I,O,B]=N,F=ZC($,O,u);st(O2(a),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`);const D=HP(I.shape,F,k,n,i),L=YRt(I,F,k.shape,n,i),V=[D,L];if(B!=null){const j=JC(B,F);V.push(j)}return V},S={x:m,filter:p,bias:x,preluActivationWeights:b},_={strides:n,pad:i,dataFormat:o,dilations:a,dimRoundingMode:l,activation:u,leakyreluAlpha:d};return c==null?Cl((N,k,I)=>{let O=mt.runKernel(lA,S,_);return I([k,N,O]),g&&(O=Bt(O,[O.shape[1],O.shape[2],O.shape[3]])),{value:O,gradFunc:w}})(m,p):Cl((N,k,I,O)=>{let B=mt.runKernel(lA,S,_);return O([k,N,B,I]),g&&(B=Bt(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:w}})(m,p,x)}const JRt=ot({fusedConv2d_:ZRt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QRt(r,t,n,i,o,a=[1,1],l){let c=r;r.rank===3&&(c=Bt(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=t;u.rank===3&&(u=Bt(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const h={x:c,dy:u},d={strides:i,pad:o,dimRoundingMode:l,dilations:a,filterShape:n};return mt.runKernel(q$t,h,d)}const t9t=ot({depthwiseConv2dNativeBackpropFilter_:QRt});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e9t(r,t,n,i,o,a=[1,1],l){let c=t,u=!1;t.rank===3&&(u=!0,c=Bt(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const h={dy:c,filter:n},d={strides:i,pad:o,dimRoundingMode:l,dilations:a,inputShape:r},f=mt.runKernel(K$t,h,d);return u?Bt(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const n9t=ot({depthwiseConv2dNativeBackpropInput_:e9t});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s9t({x:r,filter:t,strides:n,pad:i,dataFormat:o="NHWC",dilations:a=[1,1],dimRoundingMode:l,bias:c,activation:u="linear",preluActivationWeights:h,leakyreluAlpha:d}){if(tk(mt.state.gradientDepth,u)===!1){let _=UC(r,t,n,i,o,a,l);return c!=null&&(_=Hn(_,c)),QC(_,u,h,d)}const f=U(r,"x","depthwiseConv2d","float32"),p=U(t,"filter","depthwiseConv2d","float32");let m=f,g=!1;f.rank===3&&(g=!0,m=Bt(f,[1,f.shape[0],f.shape[1],f.shape[2]])),st(m.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${m.rank}.`),st(p.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`),st(m.shape[3]===p.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${m.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`),a==null&&(a=[1,1]),st(Yc(n,a),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`),ha("fused depthwiseConv2d",i,l);const y=VC(m.shape,p.shape,n,a,i,l,!0);let v;c!=null&&(v=U(c,"bias","fused conv2d"),[v]=xs(v,f),Ys(y.outShape,v.shape));let x;h!=null&&(x=U(h,"prelu weights","fused depthwiseConv2d"));const b=(_,$)=>{st(O2(a),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[N,k,I,O]=$,B=ZC(_,I,u),F=n9t(k.shape,B,N,n,i,a,l),D=t9t(k,B,N.shape,n,i,a,l);if(O!=null){const L=JC(v,B);return[F,D,L]}return[F,D]},w={x:m,filter:p,bias:v,preluActivationWeights:x},S={strides:n,pad:i,dataFormat:o,dilations:a,dimRoundingMode:l,activation:u,leakyreluAlpha:d};return c==null?Cl(($,N,k)=>{let I=mt.runKernel(cA,w,S);return k([N,$,I]),g&&(I=Bt(I,[I.shape[1],I.shape[2],I.shape[3]])),{value:I,gradFunc:b}})(m,p):Cl(($,N,k,I)=>{let O=mt.runKernel(cA,w,S);return I([N,$,O,k]),g&&(O=Bt(O,[O.shape[1],O.shape[2],O.shape[3]])),{value:O,gradFunc:b}})(m,p,v)}const r9t=ot({fusedDepthwiseConv2d_:s9t});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i9t({a:r,b:t,transposeA:n=!1,transposeB:i=!1,bias:o,activation:a="linear",preluActivationWeights:l,leakyreluAlpha:c=.2}){if(tk(mt.state.gradientDepth,a)===!1){let B=Pn(r,t,n,i);return o!=null&&(B=Hn(B,o)),QC(B,a,l,c)}let u=U(r,"a","fused matMul"),h=U(t,"b","fused matMul");[u,h]=xs(u,h);const d=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=i?h.shape[h.rank-1]:h.shape[h.rank-2],p=n?u.shape[u.rank-1]:u.shape[u.rank-2],m=i?h.shape[h.rank-2]:h.shape[h.rank-1],g=u.shape.slice(0,-2),y=h.shape.slice(0,-2),v=cr(g),x=cr(y);st(d===f,()=>`Error in fused matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${u.shape} and ${h.shape} and transposeA=${n} and transposeB=${i} must match.`);const w=Ys(u.shape.slice(0,-2),h.shape.slice(0,-2)).concat([p,m]),S=n?Bt(u,[v,d,p]):Bt(u,[v,p,d]),_=i?Bt(h,[x,m,f]):Bt(h,[x,f,m]);let $;o!=null&&($=U(o,"bias","fused matMul"),[$]=xs($,u),Ys(w,$.shape));let N;l!=null&&(N=U(l,"prelu weights","fused matMul"));const k=(B,F)=>{const[D,L,V,j]=F,Y=ZC(Bt(B,V.shape),V,a);let H,et;if(!n&&!i?(H=Pn(Y,L,!1,!0),et=Pn(D,Y,!0,!1)):!n&&i?(H=Pn(Y,L,!1,!1),et=Pn(Y,D,!0,!1)):n&&!i?(H=Pn(L,Y,!1,!0),et=Pn(D,Y,!1,!1)):(H=Pn(L,Y,!0,!0),et=Pn(Y,D,!0,!0)),o!=null){const it=JC(j,Y);return[H,et,it]}else return[H,et]},I={a:S,b:_,bias:$,preluActivationWeights:N},O={transposeA:n,transposeB:i,activation:a,leakyreluAlpha:c};return o==null?Cl((F,D,L)=>{const V=mt.runKernel(aA,I,O);return L([F,D,V]),{value:Bt(V,w),gradFunc:k}})(S,_):Cl((F,D,L,V)=>{const j=mt.runKernel(aA,I,O);return V([F,D,j,L]),{value:Bt(j,w),gradFunc:k}})(S,_,$)}const o9t=ot({fusedMatMul_:i9t});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a9t=Object.freeze(Object.defineProperty({__proto__:null,conv2d:JRt,depthwiseConv2d:r9t,matMul:o9t},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l9t(r){return YC(r,.54,.46)}const c9t=ot({hammingWindow_:l9t});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u9t(r){return YC(r,.5,.5)}const xB=ot({hannWindow_:u9t});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h9t(r,t,n,i=!1,o=0){let a=0;const l=[];for(;a+t<=r.size;)l.push(Je(r,a,t)),a+=n;if(i)for(;a<r.size;){const c=a+t-r.size,u=ur([Je(r,a,t-c),Hy([c],o)]);l.push(u),a+=n}return l.length===0?gc([],[0,t]):Bt(ur(l),[l.length,t])}const bB=ot({frame_:h9t});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d9t(r,t,n,i,o=xB){i==null&&(i=yB(t));const a=bB(r,t,n),l=Re(a,o(t));return XC(l,i)}const f9t=ot({stft_:d9t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p9t(r,t,n,i,o="bilinear",a=0){const l=U(r,"image","cropAndResize"),c=U(t,"boxes","cropAndResize","float32"),u=U(n,"boxInd","cropAndResize","int32"),h=c.shape[0];st(l.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${l.rank}.`),st(c.rank===2&&c.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${h},4] but had shape ${c.shape}.`),st(u.rank===1&&u.shape[0]===h,()=>`Error in cropAndResize: boxInd must be have size [${h}] but had shape ${c.shape}.`),st(i.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${i.length}.`),st(i[0]>=1&&i[1]>=1,()=>`cropSize must be atleast [1,1], but was ${i}`),st(o==="bilinear"||o==="nearest",()=>`method must be bilinear or nearest, but was ${o}`);const d={image:l,boxes:c,boxInd:u},f={method:o,extrapolationValue:a,cropSize:i};return mt.runKernel(W$t,d,f)}const m9t=ot({cropAndResize_:p9t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g9t(r){const t=U(r,"image","flipLeftRight","float32");st(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);const n={image:t};return mt.runKernel(aIt,n,{})}const v9t=ot({flipLeftRight_:g9t});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y9t(r){const t=U(r,"image","grayscaleToRGB"),n=t.rank-1,i=t.shape[n];st(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),st(i===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${i}.`);const o=new Array(t.rank);return o.fill(1,0,n),o[n]=3,Lp(t,o)}const x9t=ot({grayscaleToRGB_:y9t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b9t(r,t,n=0,i=.5){const o=U(r,"image","rotateWithOffset","float32");st(o.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${o.rank}.`);const a={image:o},l={radians:t,fillValue:n,center:i};return mt.runKernel(KEt,a,l)}const w9t=ot({rotateWithOffset_:b9t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Df(r,t,n,i,o,a){i==null&&(i=.5),o==null&&(o=Number.NEGATIVE_INFINITY),a==null&&(a=0);const l=r.shape[0];return n=Math.min(n,l),st(0<=i&&i<=1,()=>`iouThreshold must be in [0, 1], but was '${i}'`),st(r.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${r.rank}'`),st(r.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${r.shape[1]}`),st(t.rank===1,()=>"scores must be a 1D tensor"),st(t.shape[0]===l,()=>`scores has incompatible shape with boxes. Expected ${l}, but was ${t.shape[0]}`),st(0<=a&&a<=1,()=>`softNmsSigma must be in [0, 1], but was '${a}'`),{maxOutputSize:n,iouThreshold:i,scoreThreshold:o,softNmsSigma:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S9t(r,t,n,i=.5,o=Number.NEGATIVE_INFINITY){const a=U(r,"boxes","nonMaxSuppression","float32"),l=U(t,"scores","nonMaxSuppression","float32"),c=Df(a,l,n,i,o);n=c.maxOutputSize,i=c.iouThreshold,o=c.scoreThreshold;const u={maxOutputSize:n,iouThreshold:i,scoreThreshold:o};return mt.runKernel(GIt,{boxes:a,scores:l},u)}const _9t=ot({nonMaxSuppression_:S9t});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T9t(r,t,n){const i=C9t(r,t,n),o=i<0?-(i+1):i;r.splice(o,0,t)}function C9t(r,t,n){return $9t(r,t,n||k9t)}function k9t(r,t){return r>t?1:r<t?-1:0}function $9t(r,t,n){let i=0,o=r.length,a=0,l=!1;for(;i<o;){a=i+(o-i>>>1);const c=n(t,r[a]);c>0?i=a+1:(o=a,l=!c)}return l?i:-i-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I9t(r,t,n,i,o){return ek(r,t,n,i,o,0)}function E9t(r,t,n,i,o,a){return ek(r,t,n,i,o,0,!1,a,!0)}function N9t(r,t,n,i,o,a){return ek(r,t,n,i,o,a,!0)}function ek(r,t,n,i,o,a,l=!1,c=!1,u=!1){const h=[];for(let v=0;v<t.length;v++)t[v]>o&&h.push({score:t[v],boxIndex:v,suppressBeginIndex:0});h.sort(wA);const d=a>0?-.5/a:0,f=[],p=[];for(;f.length<n&&h.length>0;){const v=h.pop(),{score:x,boxIndex:b,suppressBeginIndex:w}=v;if(x<o)break;let S=!1;for(let _=f.length-1;_>=w;--_){const $=A9t(r,b,f[_]);if($>=i){S=!0;break}if(v.score=v.score*M9t(i,d,$),v.score<=o)break}v.suppressBeginIndex=f.length,S||(v.score===x?(f.push(b),p.push(v.score)):v.score>o&&T9t(h,v,wA))}const m=f.length,g=n-m;c&&g>0&&(f.push(...new Array(g).fill(0)),p.push(...new Array(g).fill(0)));const y={selectedIndices:f};return l&&(y.selectedScores=p),u&&(y.validOutputs=m),y}function A9t(r,t,n){const i=r.subarray(t*4,t*4+4),o=r.subarray(n*4,n*4+4),a=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),c=Math.max(i[0],i[2]),u=Math.max(i[1],i[3]),h=Math.min(o[0],o[2]),d=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),p=Math.max(o[1],o[3]),m=(c-a)*(u-l),g=(f-h)*(p-d);if(m<=0||g<=0)return 0;const y=Math.max(a,h),v=Math.max(l,d),x=Math.min(c,f),b=Math.min(u,p),w=Math.max(x-y,0)*Math.max(b-v,0);return w/(m+g-w)}function M9t(r,t,n){const i=Math.exp(t*n*n);return n<=r?i:0}function wA(r,t){return r.score-t.score||r.score===t.score&&t.boxIndex-r.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function D9t(r,t,n,i=.5,o=Number.NEGATIVE_INFINITY){const a=U(r,"boxes","nonMaxSuppressionAsync"),l=U(t,"scores","nonMaxSuppressionAsync"),c=Df(a,l,n,i,o);n=c.maxOutputSize,i=c.iouThreshold,o=c.scoreThreshold;const u=await Promise.all([a.data(),l.data()]),h=u[0],d=u[1],{selectedIndices:f}=I9t(h,d,n,i,o);return a!==r&&a.dispose(),l!==t&&l.dispose(),Lr(f,"int32")}const R9t=D9t;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O9t(r,t,n,i=.5,o=Number.NEGATIVE_INFINITY,a=0){const l=U(r,"boxes","nonMaxSuppression"),c=U(t,"scores","nonMaxSuppression"),u=Df(l,c,n,i,o,a);n=u.maxOutputSize,i=u.iouThreshold,o=u.scoreThreshold,a=u.softNmsSigma;const h={boxes:l,scores:c},d={maxOutputSize:n,iouThreshold:i,scoreThreshold:o,softNmsSigma:a},f=mt.runKernel(jIt,h,d);return{selectedIndices:f[0],selectedScores:f[1]}}const L9t=ot({nonMaxSuppressionWithScore_:O9t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function F9t(r,t,n,i=.5,o=Number.NEGATIVE_INFINITY,a=0){const l=U(r,"boxes","nonMaxSuppressionAsync"),c=U(t,"scores","nonMaxSuppressionAsync"),u=Df(l,c,n,i,o,a);n=u.maxOutputSize,i=u.iouThreshold,o=u.scoreThreshold,a=u.softNmsSigma;const h=await Promise.all([l.data(),c.data()]),d=h[0],f=h[1],{selectedIndices:p,selectedScores:m}=N9t(d,f,n,i,o,a);return l!==r&&l.dispose(),c!==t&&c.dispose(),{selectedIndices:Lr(p,"int32"),selectedScores:Lr(m)}}const P9t=F9t;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B9t(r,t,n,i=.5,o=Number.NEGATIVE_INFINITY,a=!1){const l=U(r,"boxes","nonMaxSuppression"),c=U(t,"scores","nonMaxSuppression"),u=Df(l,c,n,i,o,null),h=u.maxOutputSize,d=u.iouThreshold,f=u.scoreThreshold,p={boxes:l,scores:c},m={maxOutputSize:h,iouThreshold:d,scoreThreshold:f,padToMaxOutputSize:a},g=mt.runKernel(HIt,p,m);return{selectedIndices:g[0],validOutputs:g[1]}}const z9t=ot({nonMaxSuppressionPadded_:B9t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function V9t(r,t,n,i=.5,o=Number.NEGATIVE_INFINITY,a=!1){const l=U(r,"boxes","nonMaxSuppressionAsync"),c=U(t,"scores","nonMaxSuppressionAsync"),u=Df(l,c,n,i,o,null),h=u.maxOutputSize,d=u.iouThreshold,f=u.scoreThreshold,[p,m]=await Promise.all([l.data(),c.data()]),{selectedIndices:g,validOutputs:y}=E9t(p,m,h,d,f,a);return l!==r&&l.dispose(),c!==t&&c.dispose(),{selectedIndices:Lr(g,"int32"),validOutputs:Rn(y,"int32")}}const U9t=V9t;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W9t(r,t,n=!1,i=!1){const o=U(r,"images","resizeBilinear");st(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),st(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),st(i===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let a=o,l=!1;o.rank===3&&(l=!0,a=Bt(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const c={images:a},u={alignCorners:n,halfPixelCenters:i,size:t},h=mt.runKernel(lEt,c,u);return l?Bt(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const G9t=ot({resizeBilinear_:W9t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H9t(r,t,n=!1,i=!1){const o=U(r,"images","resizeNearestNeighbor");st(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),st(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),st(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),st(i===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let a=o,l=!1;o.rank===3&&(l=!0,a=Bt(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const c={images:a},u={alignCorners:n,halfPixelCenters:i,size:t},h=mt.runKernel(aEt,c,u);return l?Bt(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const j9t=ot({resizeNearestNeighbor_:H9t});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q9t(r,t="binary",n=!1,i=.5){const o=U(r,"image","threshold"),a=.2989,l=.587,c=.114,u=o.shape[0]*o.shape[1];let h=Re(Lr([i]),255),d,f,p,m;if(st(o.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${o.rank}.`),st(o.shape[2]===3||o.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${o.shape[2]}.`),st(o.dtype==="int32"||o.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${o.dtype}.`),st(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),o.shape[2]===3){[d,f,p]=vm(o,[1,1,1],-1);const v=Re(d,a),x=Re(f,l),b=Re(p,c);m=Hn(Hn(v,x),b)}else m=r;if(t==="otsu"){const v=WP(ps(fB(m),"int32"),La([]),256);h=K9t(v,u)}const g=n?HC(m,h):Yy(m,h);return ps(Re(g,255),"int32")}function K9t(r,t){let n=Lr([-1]),i=Lr([0]),o=Lr([0]),a,l,c,u,h,d;for(let f=0;f<r.size-1;f++){a=Je(r,0,f+1),l=Je(r,f+1),h=zn(es(a),t),d=zn(es(l),t);const p=es(Re(a,gm(0,a.size)));c=zn(p,es(a));const m=Hy(l.shape,a.size),g=Hn(gm(0,l.size),m),y=Re(l,g);u=zn(es(y),es(l));const v=wn(c,u),x=wn(c,u),b=Re(h,d);o=Re(Re(b,v),x);const w=Yy(o,i);i=nf(w,o,i),n=nf(w,Lr([f]),n)}return n}const X9t=ot({threshold_:q9t});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y9t(r,t,n="nearest",i="constant",o=0,a){const l=U(r,"image","transform","float32"),c=U(t,"transforms","transform","float32");st(l.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${l.rank}.`),st(c.rank===2&&(c.shape[0]===l.shape[0]||c.shape[0]===1)&&c.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),st(a==null||a.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${a}.`);const u={image:l,transforms:c},h={interpolation:n,fillMode:i,fillValue:o,outputShape:a};return mt.runKernel(UEt,u,h)}const Z9t=ot({transform_:Y9t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J9t(r,t,n){st(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),st(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`);const i=U(r,"a","bandPart");st(i.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${i.rank}.`);const o=i.shape,[a,l]=i.shape.slice(-2);if(!(t<=a))throw new Error(`bandPart(): numLower (${t}) must not be greater than the number of rows (${a}).`);if(!(n<=l))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${l}).`);t<0&&(t=a),n<0&&(n=l);const c=Bt(gm(0,a,1,"int32"),[-1,1]),u=gm(0,l,1,"int32"),h=wn(c,u),d=L2(HC(h,Rn(+t,"int32")),JP(h,Rn(-n,"int32"))),f=sf([a,l],i.dtype);return Bt(kl(Eh(Bt(i,[-1,a,l])).map(p=>nf(d,p,f))),o)}const Q9t=ot({bandPart_:J9t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t8t(r){let t;if(Array.isArray(r)){t=!1,st(r!=null&&r.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const o=r[0].shape[0];for(let a=1;a<r.length;++a)st(r[a].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${r[a].shape[0]} vs. ${o})`)}else t=!0,r=vm(r,r.shape[0],0).map(o=>Vs(o,[0]));st(r.length<=r[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${r.length}) exceeds number of dimensions (${r[0].shape[0]}).`);const n=[],i=r;for(let o=0;o<r.length;++o)n.push(mt.tidy(()=>{let a=i[o];if(o>0)for(let l=0;l<o;++l){const c=Re(es(Re(n[l],a)),n[l]);a=wn(a,c)}return zn(a,Xy(a,"euclidean"))}));return t?kl(n,0):n}const e8t=ot({gramSchmidt_:t8t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n8t(r,t=!1){if(st(r.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${r.rank}`),r.rank===2)return SA(r,t);{const n=r.shape.slice(0,r.shape.length-2).reduce((u,h)=>u*h),i=Eh(Bt(r,[n,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),o=[],a=[];i.forEach(u=>{const[h,d]=SA(u,t);o.push(h),a.push(d)});const l=Bt(kl(o,0),r.shape),c=Bt(kl(a,0),r.shape);return[l,c]}}function SA(r,t=!1){return mt.tidy(()=>{st(r.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${r.shape.length}D Tensor.`);const n=r.shape[0],i=r.shape[1];let o=XP(n),a=mc(r);const l=gc([[1]],[1,1]);let c=mc(l);const u=n>=i?i:n;for(let h=0;h<u;++h){const d=a,f=c,p=o;[c,a,o]=mt.tidy(()=>{const m=Je(a,[h,h],[n-h,1]),g=Xy(m),y=Je(a,[h,h],[1,1]),v=nf(Yy(y,0),gc([[-1]]),gc([[1]])),x=wn(y,Re(v,g)),b=zn(m,x);b.shape[0]===1?c=mc(l):c=ur([l,Je(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);const w=gl(zn(Pn(v,x),g)),S=Je(a,[h,0],[n-h,i]),_=Re(w,c),$=qw(c);if(h===0)a=wn(S,Pn(_,Pn($,S)));else{const I=wn(S,Pn(_,Pn($,S)));a=ur([Je(a,[0,0],[h,i]),I],0)}const N=qw(_),k=Je(o,[0,h],[n,o.shape[1]-h]);if(h===0)o=wn(k,Pn(Pn(k,c),N));else{const I=wn(k,Pn(Pn(k,c),N));o=ur([Je(o,[0,0],[n,h]),I],1)}return[c,a,o]}),$a([d,f,p])}return!t&&n>i&&(o=Je(o,[0,0],[n,i]),a=Je(a,[0,0],[i,i])),[o,a]})}const s8t=ot({qr_:n8t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Jr;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Jr||(Jr={}));function r8t(r,t,n=Jr.SUM_BY_NONZERO_WEIGHTS){const i=U(r,"losses","computeWeightedLoss");let o=null;t!=null&&(o=U(t,"weights","computeWeightedLoss"));const a=o==null?i:Re(i,o);if(n===Jr.NONE)return a;if(n===Jr.SUM)return es(a);if(n===Jr.MEAN){if(o==null)return F2(a);{const l=i.size/o.size,c=zn(es(a),es(o));return l>1?zn(c,Rn(l)):c}}if(n===Jr.SUM_BY_NONZERO_WEIGHTS){if(o==null)return zn(es(a),Rn(i.size));{const l=Re(o,Cu(i.shape)),c=ps(es(aB(l,Rn(0))),"float32");return zn(es(a),c)}}throw Error(`Unknown reduction: ${n}`)}const Rl=ot({computeWeightedLoss_:r8t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i8t(r,t,n,i=Jr.SUM_BY_NONZERO_WEIGHTS){const o=U(r,"labels","absoluteDifference"),a=U(t,"predictions","absoluteDifference");let l=null;n!=null&&(l=U(n,"weights","absoluteDifference")),Eo(o.shape,a.shape,"Error in absoluteDifference: ");const c=no(wn(o,a));return Rl(c,l,i)}const o8t=ot({absoluteDifference_:i8t});function a8t(r,t,n,i,o=Jr.SUM_BY_NONZERO_WEIGHTS){const a=U(r,"labels","cosineDistance"),l=U(t,"predictions","cosineDistance");let c=null;i!=null&&(c=U(i,"weights","cosineDistance")),Eo(a.shape,l.shape,"Error in cosineDistance: ");const u=Rn(1),h=wn(u,es(Re(a,l),n,!0));return Rl(h,c,o)}const l8t=ot({cosineDistance_:a8t});function c8t(r,t,n,i=Jr.SUM_BY_NONZERO_WEIGHTS){let o=U(r,"labels","hingeLoss");const a=U(t,"predictions","hingeLoss");let l=null;n!=null&&(l=U(n,"weights","hingeLoss")),Eo(o.shape,a.shape,"Error in hingeLoss: ");const c=Rn(1);o=wn(Re(Rn(2),o),c);const u=Zy(wn(c,Re(o,a)));return Rl(u,l,i)}const u8t=ot({hingeLoss_:c8t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h8t(r,t,n,i=1,o=Jr.SUM_BY_NONZERO_WEIGHTS){const a=U(r,"labels","huberLoss"),l=U(t,"predictions","huberLoss");let c=null;n!=null&&(c=U(n,"weights","huberLoss")),Eo(a.shape,l.shape,"Error in huberLoss: ");const u=Rn(i),h=no(wn(l,a)),d=oB(h,u),f=wn(h,d),p=Hn(Re(Rn(.5),Ky(d)),Re(u,f));return Rl(p,c,o)}const d8t=ot({huberLoss_:h8t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f8t(r,t,n,i=1e-7,o=Jr.SUM_BY_NONZERO_WEIGHTS){const a=U(r,"labels","logLoss"),l=U(t,"predictions","logLoss");let c=null;n!=null&&(c=U(n,"weights","logLoss")),Eo(a.shape,l.shape,"Error in logLoss: ");const u=Rn(1),h=Rn(i),d=gl(Re(a,mm(Hn(l,h)))),f=Re(wn(u,a),mm(Hn(wn(u,l),h))),p=wn(d,f);return Rl(p,c,o)}const p8t=ot({logLoss_:f8t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m8t(r,t,n,i=Jr.SUM_BY_NONZERO_WEIGHTS){const o=U(r,"labels","meanSquaredError"),a=U(t,"predictions","meanSquaredError");let l=null;n!=null&&(l=U(n,"weights","meanSquaredError")),Eo(o.shape,a.shape,"Error in meanSquaredError: ");const c=mB(o,a);return Rl(c,l,i)}const g8t=ot({meanSquaredError_:m8t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v8t(r,t){const n=U(r,"labels","sigmoidCrossEntropyWithLogits"),i=U(t,"logits","sigmoidCrossEntropyWithLogits");Eo(n.shape,i.shape,"Error in sigmoidCrossEntropyWithLogits: ");const o=Zy(i),a=Re(i,n),l=tB(Tl(gl(no(i))));return Hn(wn(o,a),l)}function y8t(r,t,n,i=0,o=Jr.SUM_BY_NONZERO_WEIGHTS){let a=U(r,"multiClassLabels","sigmoidCrossEntropy");const l=U(t,"logits","sigmoidCrossEntropy");let c=null;if(n!=null&&(c=U(n,"weights","sigmoidCrossEntropy")),Eo(a.shape,l.shape,"Error in sigmoidCrossEntropy: "),i>0){const h=Rn(i),d=Rn(1),f=Rn(.5);a=Hn(Re(a,wn(d,h)),Re(f,h))}const u=v8t(a,l);return Rl(u,c,o)}const x8t=ot({sigmoidCrossEntropy_:y8t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b8t(r,t,n=-1){if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);return Cl((o,a,l)=>{const u=nB(a,[n],!0),h=wn(ps(a,"float32"),u);l([o,h]);const d=gl(Re(h,o));return{value:es(d,[n]),gradFunc:(m,g)=>{const[y,v]=g,x=qy(m.shape,[n]);return[Re(Bt(m,x),wn(ps(y,"float32"),Tl(v))),Re(Bt(m,x),wn(Tl(v),ps(y,"float32")))]}}})(r,t)}function w8t(r,t,n,i=0,o=Jr.SUM_BY_NONZERO_WEIGHTS){let a=U(r,"onehotLabels","softmaxCrossEntropy");const l=U(t,"logits","softmaxCrossEntropy");let c=null;if(n!=null&&(c=U(n,"weights","softmaxCrossEntropy")),Eo(a.shape,l.shape,"Error in softmaxCrossEntropy: "),i>0){const h=Rn(i),d=Rn(1),f=Rn(a.shape[1]);a=Hn(Re(a,wn(d,h)),zn(h,f))}const u=b8t(a,l);return Rl(u,c,o)}const S8t=ot({softmaxCrossEntropy_:w8t});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _8t(r,t,n,i){const o=U(r,"indices","sparseFillEmptyRows","int32"),a=U(t,"values","sparseFillEmptyRows"),l=U(n,"denseShape","sparseFillEmptyRows","int32"),c=U(i,"defaultValue","sparseFillEmptyRows",a.dtype);if(o.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${o.shape}`);if(a.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${a.shape}`);if(l.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${l.shape}`);if(c.rank!==0)throw new Error(`Default value should be a scalar but received shape ${c.shape}`);const u={indices:o,values:a,denseShape:l,defaultValue:c},h=mt.runKernel(IEt,u);return{outputIndices:h[0],outputValues:h[1],emptyRowIndicator:h[2],reverseIndexMap:h[3]}}const T8t=ot({sparseFillEmptyRows_:_8t});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C8t(r,t,n){const i=U(r,"inputIndices","sparseReshape","int32"),o=U(t,"inputShape","sparseReshape","int32"),a=U(n,"newShape","sparseReshape","int32");if(i.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${i.shape}`);if(o.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${o.shape}`);if(a.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${a.shape}`);const l={inputIndices:i,inputShape:o,newShape:a},c=mt.runKernel(EEt,l);return{outputIndices:c[0],outputShape:c[1]}}const k8t=ot({sparseReshape_:C8t});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $8t(r,t,n){const i=U(r,"data","sparseSegmentMean"),o=U(t,"indices","sparseSegmentMean","int32"),a=U(n,"segmentIds","sparseSegmentMean","int32");if(i.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${o.shape}`);if(a.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${a.shape}`);const l={data:i,indices:o,segmentIds:a};return mt.runKernel(NEt,l)}const I8t=ot({sparseSegmentMean_:$8t});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E8t(r,t,n){const i=U(r,"data","sparseSegmentSum"),o=U(t,"indices","sparseSegmentSum","int32"),a=U(n,"segmentIds","sparseSegmentSum","int32");if(i.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${o.shape}`);if(a.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${a.shape}`);const l={data:i,indices:o,segmentIds:a};return mt.runKernel(AEt,l)}const N8t=ot({sparseSegmentSum_:E8t});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A8t(r,t,n,i,o,a,l,c){const u=U(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error(`Data must be a vector, saw: ${u.shape}`);const h=U(t,"dataSplits","stringNGrams");if(h.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const d={separator:n,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c},f={data:u,dataSplits:h},p=mt.runKernel(OEt,f,d);return{nGrams:p[0],nGramsSplits:p[1]}}const M8t=ot({stringNGrams_:A8t});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D8t(r,t,n=!0){const i=U(r,"input","stringSplit","string"),o=U(t,"delimiter","stringSplit","string");if(i.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${i.shape}`);if(o.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${o.shape}`);const a={skipEmpty:n},l={input:i,delimiter:o},c=mt.runKernel(LEt,l,a);return{indices:c[0],values:c[1],shape:c[2]}}const R8t=ot({stringSplit_:D8t});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O8t(r,t){const n=U(r,"input","stringToHashBucketFast","string"),i={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");const o={input:n};return mt.runKernel(FEt,o,i)}const L8t=ot({stringToHashBucketFast_:O8t});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F8t={fft:KC,ifft:P2,rfft:XC,irfft:pB},P8t={hammingWindow:c9t,hannWindow:xB,frame:bB,stft:f9t},Rf={flipLeftRight:v9t,grayscaleToRGB:x9t,resizeNearestNeighbor:j9t,resizeBilinear:G9t,rotateWithOffset:w9t,cropAndResize:m9t,nonMaxSuppression:_9t,nonMaxSuppressionAsync:R9t,nonMaxSuppressionWithScore:L9t,nonMaxSuppressionWithScoreAsync:P9t,nonMaxSuppressionPadded:z9t,nonMaxSuppressionPaddedAsync:U9t,threshold:X9t,transform:Z9t},B8t={bandPart:Q9t,gramSchmidt:e8t,qr:s8t},z8t={absoluteDifference:o8t,computeWeightedLoss:Rl,cosineDistance:l8t,hingeLoss:u8t,huberLoss:d8t,logLoss:p8t,meanSquaredError:g8t,sigmoidCrossEntropy:x8t,softmaxCrossEntropy:S8t},V8t={sparseFillEmptyRows:T8t,sparseReshape:k8t,sparseSegmentMean:I8t,sparseSegmentSum:N8t},U8t={stringNGrams:M8t,stringSplit:R8t,stringToHashBucketFast:L8t};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W8t=Cn();W8t.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,r=>{r&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Ji;(function(r){r[r.DT_INVALID=0]="DT_INVALID",r[r.DT_FLOAT=1]="DT_FLOAT",r[r.DT_DOUBLE=2]="DT_DOUBLE",r[r.DT_INT32=3]="DT_INT32",r[r.DT_UINT8=4]="DT_UINT8",r[r.DT_INT16=5]="DT_INT16",r[r.DT_INT8=6]="DT_INT8",r[r.DT_STRING=7]="DT_STRING",r[r.DT_COMPLEX64=8]="DT_COMPLEX64",r[r.DT_INT64=9]="DT_INT64",r[r.DT_BOOL=10]="DT_BOOL",r[r.DT_QINT8=11]="DT_QINT8",r[r.DT_QUINT8=12]="DT_QUINT8",r[r.DT_QINT32=13]="DT_QINT32",r[r.DT_BFLOAT16=14]="DT_BFLOAT16",r[r.DT_QINT16=15]="DT_QINT16",r[r.DT_QUINT16=16]="DT_QUINT16",r[r.DT_UINT16=17]="DT_UINT16",r[r.DT_COMPLEX128=18]="DT_COMPLEX128",r[r.DT_HALF=19]="DT_HALF",r[r.DT_RESOURCE=20]="DT_RESOURCE",r[r.DT_VARIANT=21]="DT_VARIANT",r[r.DT_UINT32=22]="DT_UINT32",r[r.DT_UINT64=23]="DT_UINT64",r[r.DT_FLOAT_REF=101]="DT_FLOAT_REF",r[r.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",r[r.DT_INT32_REF=103]="DT_INT32_REF",r[r.DT_UINT8_REF=104]="DT_UINT8_REF",r[r.DT_INT16_REF=105]="DT_INT16_REF",r[r.DT_INT8_REF=106]="DT_INT8_REF",r[r.DT_STRING_REF=107]="DT_STRING_REF",r[r.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",r[r.DT_INT64_REF=109]="DT_INT64_REF",r[r.DT_BOOL_REF=110]="DT_BOOL_REF",r[r.DT_QINT8_REF=111]="DT_QINT8_REF",r[r.DT_QUINT8_REF=112]="DT_QUINT8_REF",r[r.DT_QINT32_REF=113]="DT_QINT32_REF",r[r.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",r[r.DT_QINT16_REF=115]="DT_QINT16_REF",r[r.DT_QUINT16_REF=116]="DT_QUINT16_REF",r[r.DT_UINT16_REF=117]="DT_UINT16_REF",r[r.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",r[r.DT_HALF_REF=119]="DT_HALF_REF",r[r.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",r[r.DT_VARIANT_REF=121]="DT_VARIANT_REF",r[r.DT_UINT32_REF=122]="DT_UINT32_REF",r[r.DT_UINT64_REF=123]="DT_UINT64_REF"})(Ji||(Ji={}));var _A;(function(r){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(r.CheckpointFormatVersion||(r.CheckpointFormatVersion={}))})(_A||(_A={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G8t={};function wB(r){return G8t[r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A(r,t,n,i,o){const a=t.inputParams[r];if(a&&a.inputIndexStart!==void 0){const c=a.inputIndexStart,u=a.inputIndexEnd===0?void 0:a.inputIndexEnd===void 0?c+1:a.inputIndexEnd;if(a.type==="tensor")return Or(t.inputNames[a.inputIndexStart],n,i,o);if(a.type==="tensors")return t.inputNames.slice(c,u).map(p=>Or(p,n,i,o));const h=Or(t.inputNames.slice(c)[0],n,i,o),d=h.dataSync();return a.type==="number"?d[0]:Rw(h.shape,d)}const l=t.attrParams[r];return l&&l.value}function Or(r,t,n,i){const[o,a]=li(r);if(i!=null){const c=i.getHashTableHandleByName(o);if(c!=null)return c}const l=n.currentContextIds.find(c=>!!t[B2(o,c)]);return l!==void 0?t[B2(o,l)][a]:void 0}function H8t(r,t,n){return t[B2(r,n.currentContextId)]}function _a(r,t){const[n,i,o]=li(r);return[B2(n,t&&t.currentContextId),i,o]}function B2(r,t){return t?`${r}-${t}`:r}function li(r){const t=r.split(":");if(t.length===1)return[r,0,void 0];const n=t[0],i=t.length===3?t[1]:void 0,o=Number(t[t.length-1]);return[n,o,i]}function D1(r,t,n){let i=A("pad",r,t,n);if(i==="explicit"){i=A("explicitPaddings",r,t,n);const o=[[0,0],[0,0],[0,0],[0,0]];for(let a=0;a<4;a++)o[a][0]=i[a*2],o[a][1]=i[a*2+1];return o}return i}function rl(r){return r.kept?r:mc(r)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j8t=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],q8t=Object.freeze(Object.defineProperty({__proto__:null,json:j8t},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K8t=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],X8t=Object.freeze(Object.defineProperty({__proto__:null,json:K8t},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y8t=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],Z8t=Object.freeze(Object.defineProperty({__proto__:null,json:Y8t},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J8t=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],Q8t=Object.freeze(Object.defineProperty({__proto__:null,json:J8t},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tOt=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],eOt=Object.freeze(Object.defineProperty({__proto__:null,json:tOt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nOt=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],sOt=Object.freeze(Object.defineProperty({__proto__:null,json:nOt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rOt=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],iOt=Object.freeze(Object.defineProperty({__proto__:null,json:rOt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oOt=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],aOt=Object.freeze(Object.defineProperty({__proto__:null,json:oOt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lOt=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}],cOt=Object.freeze(Object.defineProperty({__proto__:null,json:lOt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uOt=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],hOt=Object.freeze(Object.defineProperty({__proto__:null,json:uOt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dOt=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],fOt=Object.freeze(Object.defineProperty({__proto__:null,json:dOt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pOt=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}],mOt=Object.freeze(Object.defineProperty({__proto__:null,json:pOt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gOt=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],vOt=Object.freeze(Object.defineProperty({__proto__:null,json:gOt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yOt=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],xOt=Object.freeze(Object.defineProperty({__proto__:null,json:yOt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bOt=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],wOt=Object.freeze(Object.defineProperty({__proto__:null,json:bOt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SOt=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],_Ot=Object.freeze(Object.defineProperty({__proto__:null,json:SOt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TOt=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],COt=Object.freeze(Object.defineProperty({__proto__:null,json:TOt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kOt=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],$Ot=Object.freeze(Object.defineProperty({__proto__:null,json:kOt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IOt=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],EOt=Object.freeze(Object.defineProperty({__proto__:null,json:IOt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TA{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const t=[q8t,X8t,Z8t,Q8t,eOt,sOt,iOt,aOt,cOt,hOt,fOt,mOt,vOt,xOt,wOt,_Ot,COt,$Ot,EOt],n=[].concat(...t.map(i=>i.json));this.opMappers=n.reduce((i,o)=>(i[o.tfOpName]=o,i),{})}transformGraph(t,n={}){const i=t.node,o=[],a=[],l=[],c=i.reduce((y,v)=>(y[v.name]=this.mapNode(v),v.op.startsWith("Placeholder")?o.push(y[v.name]):v.op==="Const"?a.push(y[v.name]):(v.input==null||v.input.length===0)&&l.push(y[v.name]),y),{});let u=[];const h=[];let d={},f={};n!=null&&(d=this.mapSignatureEntries(n.inputs),f=this.mapSignatureEntries(n.outputs));const p=Object.keys(c);p.forEach(y=>{const v=c[y];v.inputNames.forEach((x,b)=>{const[w,,S]=_a(x),_=c[w];if(_.outputs!=null){const $=_.outputs.indexOf(S);if($!==-1){const N=`${w}:${$}`;v.inputNames[b]=N}}v.inputs.push(_),_.children.push(v)})}),Object.keys(f).length===0?p.forEach(y=>{const v=c[y];v.children.length===0&&h.push(v)}):Object.keys(f).forEach(y=>{const[v]=_a(y),x=c[v];x!=null&&(x.signatureKey=f[y],h.push(x))}),Object.keys(d).length>0?Object.keys(d).forEach(y=>{const[v]=_a(y),x=c[v];x&&(x.signatureKey=d[y],u.push(x))}):u=o;let m={};t.library!=null&&t.library.function!=null&&(m=t.library.function.reduce((y,v)=>(y[v.signature.name]=this.mapFunction(v),y),{}));const g={nodes:c,inputs:u,outputs:h,weights:a,placeholders:o,signature:n,functions:m};return l.length>0&&(g.initNodes=l),g}mapSignatureEntries(t){return Object.keys(t||{}).reduce((n,i)=>(n[t[i].name]=i,n),{})}mapNode(t){const n=wB(t.op)||this.opMappers[t.op]||{};t.attr==null&&(t.attr={});const i={name:t.name,op:t.op,category:n.category,inputNames:(t.input||[]).map(o=>o.startsWith("^")?o.slice(1):o),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr,outputs:n.outputs};return n.inputs!=null&&(i.inputParams=n.inputs.reduce((o,a)=>(o[a.name]={type:a.type,inputIndexStart:a.start,inputIndexEnd:a.end},o),{})),n.attrs!=null&&(i.attrParams=n.attrs.reduce((o,a)=>{const l=a.type;let c;switch(a.type){case"string":c=Jw(t.attr,a.tfName,a.defaultValue),c===void 0&&a.tfDeprecatedName&&(c=Jw(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"string[]":c=iS(t.attr,a.tfName,a.defaultValue),c===void 0&&a.tfDeprecatedName&&(c=iS(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"number":c=tS(t.attr,a.tfName,a.defaultValue||0),c===void 0&&a.tfDeprecatedName&&(c=tS(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"number[]":c=rS(t.attr,a.tfName,a.defaultValue),c===void 0&&a.tfDeprecatedName&&(c=rS(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool":c=Qw(t.attr,a.tfName,a.defaultValue),c===void 0&&a.tfDeprecatedName&&(c=Qw(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool[]":c=aS(t.attr,a.tfName,a.defaultValue),c===void 0&&a.tfDeprecatedName&&(c=aS(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape":c=sS(t.attr,a.tfName,a.defaultValue),c===void 0&&a.tfDeprecatedName&&(c=sS(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape[]":c=oS(t.attr,a.tfName,a.defaultValue),c===void 0&&a.tfDeprecatedName&&(c=oS(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype":c=eS(t.attr,a.tfName,a.defaultValue),c===void 0&&a.tfDeprecatedName&&(c=eS(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype[]":c=nS(t.attr,a.tfName,a.defaultValue),c===void 0&&a.tfDeprecatedName&&(c=nS(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"func":c=CA(t.attr,a.tfName,a.defaultValue),c===void 0&&a.tfDeprecatedName&&(c=CA(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${a.type} for op: ${t.op}`)}return o[a.name]={value:c,type:l},o},{})),i}mapFunction(t){const n=t.nodeDef,i=[],o=[];let a={};n!=null&&(a=n.reduce((f,p)=>(f[p.name]=this.mapNode(p),p.op==="Const"&&o.push(f[p.name]),f),{}));const l=[],c=[];t.signature.inputArg.forEach(f=>{const[p]=_a(f.name),m={name:p,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:nk(f.type),type:"dtype"}},children:[]};m.signatureKey=f.name,l.push(m),a[p]=m}),Object.keys(a).forEach(f=>{const p=a[f];p.inputNames.forEach((m,g)=>{const[y,,v]=_a(m),x=a[y];if(x.outputs!=null){const b=x.outputs.indexOf(v);if(b!==-1){const w=`${y}:${b}`;p.inputNames[g]=w}}p.inputs.push(x),x.children.push(p)})});const h=t.ret;t.signature.outputArg.forEach(f=>{const[p,m]=_a(h[f.name]),g=a[p];g!=null&&(g.defaultOutput=m,c.push(g))});const d=this.mapArgsToSignature(t);return{nodes:a,inputs:l,outputs:c,weights:o,placeholders:i,signature:d}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce((n,i)=>(n[i.name]=this.mapArgToTensorInfo(i),n),{}),outputs:t.signature.outputArg.reduce((n,i)=>(n[i.name]=this.mapArgToTensorInfo(i,t.ret),n),{})}}mapArgToTensorInfo(t,n){let i=t.name;return n!=null&&(i=n[i]),{name:i,dtype:t.type}}}function NOt(r){const t=Cn().global;if(typeof t.atob<"u")return t.atob(r);if(typeof Buffer<"u")return new Buffer(r,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function SB(r,t){const n=Array.isArray(r)?String.fromCharCode.apply(null,r):NOt(r);return t?n:n.toLowerCase()}function Jw(r,t,n,i=!1){const o=r[t];return o!=null?SB(o.s,i):n}function Qw(r,t,n){const i=r[t];return i?i.b:n}function tS(r,t,n){const i=r[t]||{},o=i.i!=null?i.i:i.f!=null?i.f:n;return typeof o=="number"?o:parseInt(o,10)}function nk(r){switch(typeof r=="string"&&(r=Ji[r]),r){case Ji.DT_FLOAT:case Ji.DT_HALF:return"float32";case Ji.DT_INT32:case Ji.DT_INT64:case Ji.DT_INT8:case Ji.DT_UINT8:return"int32";case Ji.DT_BOOL:return"bool";case Ji.DT_DOUBLE:return"float32";case Ji.DT_STRING:return"string";default:return null}}function CA(r,t,n){const i=r[t];return i&&i.func?i.func.name:n}function eS(r,t,n){const i=r[t];return i&&i.type?nk(i.type):n}function nS(r,t,n){const i=r[t];return i&&i.list&&i.list.type?i.list.type.map(o=>nk(o)):n}function _B(r){if(!r.unknownRank)return r.dim!=null?r.dim.map(t=>typeof t.size=="number"?t.size:parseInt(t.size,10)):[]}function sS(r,t,n){const i=r[t];return i&&i.shape?_B(i.shape):n}function rS(r,t,n){const i=r[t];return i?((i.list.f&&i.list.f.length?i.list.f:i.list.i)||[]).map(o=>typeof o=="number"?o:parseInt(o,10)):n}function iS(r,t,n,i=!1){const o=r[t];return o&&o.list&&o.list.s?o.list.s.map(a=>SB(a,i)):n}function oS(r,t,n){const i=r[t];return i&&i.list&&i.list.shape?i.list.shape.map(o=>_B(o)):n}function aS(r,t,n){const i=r[t];return i&&i.list&&i.list.b?i.list.b:n}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AOt{constructor(t,n,i){this.node=t,this.tensorMap=n,this.context=i,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map(o=>this.getInput(o)),t.rawAttrs!=null&&(this.attrs=Object.keys(t.rawAttrs).reduce((o,a)=>(o[a]=this.getAttr(a),o),{}))}getInput(t){return Or(t,this.tensorMap,this.context)}getAttr(t,n){const i=this.node.rawAttrs[t];if(i.tensor!=null)return Or(t,this.tensorMap,this.context);if(i.i!=null||i.f!=null)return tS(this.node.rawAttrs,t,n);if(i.s!=null)return Jw(this.node.rawAttrs,t,n);if(i.b!=null)return Qw(this.node.rawAttrs,t,n);if(i.shape!=null)return sS(this.node.rawAttrs,t,n);if(i.type!=null)return eS(this.node.rawAttrs,t,n);if(i.list!=null){if(i.list.i!=null||i.list.f!=null)return rS(this.node.rawAttrs,t,n);if(i.list.s!=null)return iS(this.node.rawAttrs,t,n);if(i.list.shape!=null)return oS(this.node.rawAttrs,t,n);if(i.list.b!=null)return aS(this.node.rawAttrs,t,n);if(i.list.type!=null)return nS(this.node.rawAttrs,t,n)}return n}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tr=Object.freeze(Object.defineProperty({__proto__:null,abs:no,acos:EAt,acosh:AAt,add:Hn,addN:DAt,all:OAt,any:FAt,argMax:BAt,argMin:VAt,asin:WAt,asinh:HAt,atan:qAt,atan2:XAt,atanh:ZAt,avgPool:VP,avgPool3d:iMt,basicLSTMCell:hMt,batchToSpaceND:UP,batchNorm:Gy,batchNorm2d:gMt,batchNorm3d:yMt,batchNorm4d:bMt,bincount:WP,broadcastArgs:_Mt,broadcastTo:M1,buffer:_l,cast:ps,ceil:kMt,clipByValue:GP,clone:mc,complex:Ac,concat:ur,concat1d:EMt,concat2d:AMt,concat3d:DMt,concat4d:OMt,conv1d:PMt,conv2d:jy,conv2dTranspose:VMt,conv3d:WMt,conv3dTranspose:qMt,cos:XMt,cosh:ZMt,cumprod:QMt,cumsum:e6t,denseBincount:s6t,depthToSpace:i6t,depthwiseConv2d:UC,diag:l6t,dilation2d:u6t,div:zn,divNoNan:m6t,dot:v6t,einsum:x6t,elu:qP,equal:jP,erf:S6t,euclideanNorm:M6t,exp:Tl,expandDims:Vo,expm1:L6t,eye:XP,fill:Hy,floor:YP,floorDiv:zP,gather:ZP,greater:Yy,greaterEqual:JP,imag:Wy,isFinite:G6t,isInf:j6t,isNaN:K6t,leakyRelu:QP,less:Z6t,lessEqual:HC,linspace:Q6t,localResponseNormalization:e5t,log:mm,log1p:tB,logSigmoid:o5t,logSoftmax:c5t,logSumExp:nB,logicalAnd:L2,logicalNot:sB,logicalOr:rB,logicalXor:m5t,lowerBound:v5t,matMul:Pn,max:Id,maxPool:iB,maxPool3d:b5t,maxPoolWithArgmax:S5t,maximum:T5t,mean:F2,meshgrid:k5t,min:Yw,minimum:oB,mirrorPad:E5t,mod:A5t,moments:D5t,mul:Re,multiRNNCell:O5t,multinomial:F5t,neg:gl,notEqual:aB,oneHot:pAt,ones:Cu,onesLike:z5t,outerProduct:U5t,pad:Zg,pad1d:H5t,pad2d:q5t,pad3d:X5t,pad4d:Z5t,pool:nDt,pow:GC,prelu:cB,print:NP,prod:iDt,raggedGather:aDt,raggedTensorToTensor:cDt,rand:hDt,randomGamma:mDt,randomNormal:uB,randomStandardNormal:yDt,randomUniform:hB,range:gm,real:pm,reciprocal:wDt,relu:Zy,relu6:dB,reshape:Bt,reverse:hh,reverse1d:kDt,reverse2d:IDt,reverse3d:NDt,reverse4d:MDt,round:fB,rsqrt:ODt,scalar:Rn,selu:FDt,separableConv2d:BDt,setdiff1dAsync:VDt,sigmoid:Pu,sign:WDt,sin:HDt,sinh:qDt,slice:Je,slice1d:XDt,slice2d:ZDt,slice3d:QDt,slice4d:eRt,softmax:sRt,softplus:eB,spaceToBatchND:lB,fft:KC,ifft:P2,irfft:pB,rfft:XC,split:vm,sqrt:Zw,square:Ky,squaredDifference:mB,squeeze:Vs,stack:kl,step:gB,stridedSlice:pRt,sub:wn,sum:es,tan:gRt,tanh:Xw,tensor:La,tensor1d:Lr,tensor2d:gc,tensor3d:FP,tensor4d:vRt,tensor5d:yRt,tensor6d:xRt,tile:Lp,topk:wRt,truncatedNormal:_Rt,unique:CRt,unsortedSegmentSum:$Rt,unstack:Eh,upperBound:ERt,variable:NRt,where:nf,whereAsync:vB,zeros:sf,zerosLike:WC,op:ot,OP_SCOPE_SUFFIX:yP,booleanMaskAsync:RRt,transpose:qw,norm:Xy,movingAverage:LRt,scatterND:PRt,searchSorted:jC,sparseToDense:VRt,gatherND:WRt,dropout:jRt,enclosingPowerOfTwo:yB,cosineWindow:YC,inTopKAsync:KRt,image:Rf,linalg:B8t,losses:z8t,spectral:F8t,fused:a9t,signal:P8t,sparse:V8t,string:U8t},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MOt=(r,t,n,i=Tr)=>{switch(r.op){case"BiasAdd":case"AddV2":case"Add":return[i.add(A("a",r,t,n),A("b",r,t,n))];case"AddN":return[i.addN(A("tensors",r,t,n))];case"FloorMod":case"Mod":return[i.mod(A("a",r,t,n),A("b",r,t,n))];case"Mul":return[i.mul(A("a",r,t,n),A("b",r,t,n))];case"RealDiv":case"Div":return[i.div(A("a",r,t,n),A("b",r,t,n))];case"DivNoNan":return[i.divNoNan(A("a",r,t,n),A("b",r,t,n))];case"FloorDiv":return[i.floorDiv(A("a",r,t,n),A("b",r,t,n))];case"Sub":return[i.sub(A("a",r,t,n),A("b",r,t,n))];case"Minimum":return[i.minimum(A("a",r,t,n),A("b",r,t,n))];case"Maximum":return[i.maximum(A("a",r,t,n),A("b",r,t,n))];case"Pow":return[i.pow(A("a",r,t,n),A("b",r,t,n))];case"SquaredDifference":return[i.squaredDifference(A("a",r,t,n),A("b",r,t,n))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DOt=(r,t,n,i=Tr)=>{switch(r.op){case"Abs":case"ComplexAbs":return[i.abs(A("x",r,t,n))];case"Acos":return[i.acos(A("x",r,t,n))];case"Acosh":return[i.acosh(A("x",r,t,n))];case"Asin":return[i.asin(A("x",r,t,n))];case"Asinh":return[i.asinh(A("x",r,t,n))];case"Atan":return[i.atan(A("x",r,t,n))];case"Atan2":return[i.atan2(A("x",r,t,n),A("y",r,t,n))];case"Atanh":return[i.atanh(A("x",r,t,n))];case"Ceil":return[i.ceil(A("x",r,t,n))];case"Complex":return[i.complex(A("real",r,t,n),A("imag",r,t,n))];case"Cos":return[i.cos(A("x",r,t,n))];case"Cosh":return[i.cosh(A("x",r,t,n))];case"Elu":return[i.elu(A("x",r,t,n))];case"Erf":return[i.erf(A("x",r,t,n))];case"Exp":return[i.exp(A("x",r,t,n))];case"Expm1":return[i.expm1(A("x",r,t,n))];case"Floor":return[i.floor(A("x",r,t,n))];case"Log":return[i.log(A("x",r,t,n))];case"Log1p":return[i.log1p(A("x",r,t,n))];case"Imag":return[i.imag(A("x",r,t,n))];case"Neg":return[i.neg(A("x",r,t,n))];case"Reciprocal":return[i.reciprocal(A("x",r,t,n))];case"Real":return[i.real(A("x",r,t,n))];case"Relu":return[i.relu(A("x",r,t,n))];case"Round":return[i.round(A("x",r,t,n))];case"Selu":return[i.selu(A("x",r,t,n))];case"Sigmoid":return[i.sigmoid(A("x",r,t,n))];case"Sin":return[i.sin(A("x",r,t,n))];case"Sign":return[i.sign(A("x",r,t,n))];case"Sinh":return[i.sinh(A("x",r,t,n))];case"Softplus":return[i.softplus(A("x",r,t,n))];case"Sqrt":return[i.sqrt(A("x",r,t,n))];case"Square":return[i.square(A("x",r,t,n))];case"Tanh":return[i.tanh(A("x",r,t,n))];case"Tan":return[i.tan(A("x",r,t,n))];case"ClipByValue":return[i.clipByValue(A("x",r,t,n),A("clipValueMin",r,t,n),A("clipValueMax",r,t,n))];case"Relu6":return[i.relu6(A("x",r,t,n))];case"Rsqrt":return[i.rsqrt(Or(r.inputNames[0],t,n))];case"Prod":return[i.prod(A("x",r,t,n),A("axes",r,t,n))];case"LeakyRelu":return[i.leakyRelu(A("x",r,t,n),A("alpha",r,t,n))];case"Prelu":return[i.prelu(A("x",r,t,n),A("alpha",r,t,n))];case"IsNan":return[i.isNaN(Or(r.inputNames[0],t,n))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function so(r,t,n=""){if(!(typeof r=="number"||typeof t=="number")){st(r.length===t.length,()=>n+` Shapes ${r} and ${t} must match`);for(let i=0;i<r.length;i++){const o=r[i],a=t[i];st(o<0||a<0||o===a,()=>n+` Shapes ${r} and ${t} must match`)}}}function kA(r){return!(typeof r=="number"||r.some(t=>t<0))}function pp(r,t,n){let i=lS(r,n);const o=!kA(i);if(o&&t.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${i}`);if(o&&t.forEach(a=>{i=lS(a.shape,i)}),!kA(i))throw new Error(`Non-fully-defined elementShape: ${i}`);return i}function lS(r,t){if(typeof r=="number")return t;if(typeof t=="number")return r;if(r.length!==t.length)throw new Error(`Incompatible ranks during merge: ${r} vs. ${t}`);const n=[];for(let i=0;i<r.length;++i){const o=r[i],a=t[i];if(o>=0&&a>=0&&o!==a)throw new Error(`Incompatible shape during merge: ${r} vs. ${t}`);n[i]=o>=0?o:a}return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ROt{constructor(t,n,i,o,a,l,c){this.name=t,this.dtype=n,this.maxSize=i,this.elementShape=o,this.identicalElementShapes=a,this.dynamicSize=l,this.clearAfterRead=c,this.tensors=[],this.closed_=!1,this.idTensor=Rn(0),ac(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(t){this.tensors.forEach(n=>{(t==null||!t.has(n.tensor.id))&&n.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);const n=this.tensors[t];if(n.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(n.cleared=!0),n.read=!0,n.tensor}readMany(t){return t.map(n=>this.read(n))}write(t,n){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);const i=this.tensors[t]||{};if(n.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},
          because the value dtype is ${n.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=n.shape),so(this.elementShape,n.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),i.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(i.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);i.tensor=n,ac(n),i.written=!0,this.tensors[t]=i}writeMany(t,n){if(t.length!==n.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${n.length}.`);t.forEach((i,o)=>this.write(i,n[o]))}gather(t,n){if(n&&n!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${n}`);if(t)t=t.slice(0,this.size());else{t=[];for(let o=0;o<this.size();o++)t.push(o)}if(t.length===0)return La([],[0].concat(this.elementShape));const i=this.readMany(t);return so(this.elementShape,i[0].shape,"TensorArray shape mismatch: "),kl(i,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(this.size()===0)return La([],[0].concat(this.elementShape));const n=[];for(let o=0;o<this.size();o++)n.push(o);const i=this.readMany(n);return so(this.elementShape,i[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${i[0].shape})`),ur(i,0)}scatter(t,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);if(t.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${n.shape[0]}`);const i=Math.max(...t);if(!this.dynamicSize&&i>=this.maxSize)throw new Error(`Max index must be < array size (${i}  vs. ${this.maxSize})`);this.writeMany(t,Eh(n,0))}split(t,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);let i=0;const o=t.map(u=>(i+=u,i));if(i!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${i}, and tensor's shape is: ${n.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);const a=i===0?0:n.size/i,l=[];$s(()=>{n=Bt(n,[1,i,a]);for(let u=0;u<t.length;++u){const d=[0,u===0?0:o[u-1],0],f=[1,t[u],a];l[u]=Bt(Je(n,d,f),this.elementShape)}return l});const c=[];for(let u=0;u<t.length;u++)c[u]=u;this.writeMany(c,l)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dh{constructor(t,n,i,o=-1){this.tensors=t,this.elementShape=n,this.elementDtype=i,t!=null&&t.forEach(a=>{if(i!==a.dtype)throw new Error(`Invalid data types; op elements ${i}, but list elements ${a.dtype}`);so(n,a.shape,"TensorList shape mismatch: "),ac(a)}),this.idTensor=Rn(0),this.maxNumElements=o,ac(this.idTensor)}get id(){return this.idTensor.id}copy(){return new dh([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach(n=>{(t==null||!t.has(n.id))&&n.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,n,i=-1){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(i!==-1&&this.tensors.length!==i)throw new Error(`Operation expected a list with ${i} elements but got a list with ${this.tensors.length} elements.`);so(t,this.elementShape,"TensorList shape mismatch: ");const o=pp(this.elementShape,this.tensors,t);return $s(()=>{const a=this.tensors.map(l=>Bt(l,o));return kl(a,0)})}popBack(t,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const i=pp(this.elementShape,this.tensors,t),o=this.tensors.pop();return o.kept=!1,so(o.shape,t,"TensorList shape mismatch: "),Bt(o,i)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(so(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");ac(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(this.maxNumElements!==-1&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);const n=new dh([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=t;for(let i=0;i<Math.min(this.tensors.length,t);++i)n.tensors[i]=this.tensors[i];return n}getItem(t,n,i){if(i!==this.elementDtype)throw new Error(`Invalid data types; op elements ${i}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(this.tensors[t]==null)throw new Error(`element at index ${t} is null.`);so(this.tensors[t].shape,n,"TensorList shape mismatch: ");const o=pp(this.elementShape,this.tensors,n);return Bt(this.tensors[t],o)}setItem(t,n){if(n.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${this.elementDtype}`);if(t<0||this.maxNumElements!==-1&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);so(this.elementShape,n.shape,"TensorList shape mismatch: "),ac(n),this.tensors[t]!=null&&(this.tensors[t].kept=!1),this.tensors[t]=n}gather(t,n,i){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);so(this.elementShape,i,"TensorList shape mismatch: "),t=t.slice(0,this.size());const o=pp(this.elementShape,this.tensors,i);return t.length===0?La([],[0].concat(o)):$s(()=>{const a=t.map(l=>Bt(this.tensors[l],o));return kl(a,0)})}concat(t,n){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);so(this.elementShape,n,"TensorList shape mismatch: ");const i=pp(this.elementShape,this.tensors,n);return this.size()===0?La([],[0].concat(i)):$s(()=>{const o=this.tensors.map(a=>Bt(a,i));return ur(o,0)})}}function OOt(r,t,n){const i=r.dtype;if(r.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${r.shape}`);if(r.dtype!==n)throw new Error(`Invalid data types; op elements ${r.dtype}, but list elements ${n}`);const o=r.shape.slice(1);so(o,t,"TensorList shape mismatch: ");const a=Eh(r);return new dh(a,t,i)}function LOt(r,t,n,i){return new dh([],r,t,i)}function FOt(r,t,n,i){if(t.length!==r.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${r.shape[0]}`);const o=Math.max(...t);if(i!=null&&i!==-1&&o>=i)throw new Error(`Max index must be < array size (${o}  vs. ${i})`);const a=new dh([],n,r.dtype,i),l=Eh(r,0);return t.forEach((c,u)=>{a.setItem(c,l[u])}),a}function POt(r,t,n){let i=0;const o=t.map(d=>(i+=d,i));if(i!==r.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${i}, and tensor's shape is: ${r.shape}`);const a=r.shape.slice(1),l=lS(a,n),c=i===0?0:r.size/i,u=$s(()=>{const d=[];r=Bt(r,[1,i,c]);for(let f=0;f<t.length;++f){const m=[0,f===0?0:o[f-1],0],g=[1,t[f],c];d[f]=Bt(Je(r,m,g),l)}return r.dispose(),d}),h=new dh([],n,r.dtype,t.length);for(let d=0;d<u.length;d++)h.setItem(d,u[d]);return h}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BOt=async(r,t,n)=>{switch(r.op){case"If":case"StatelessIf":{const i=A("thenBranch",r,t,n),o=A("elseBranch",r,t,n),a=A("cond",r,t,n),l=A("args",r,t,n);return(await a.data())[0]?n.functionMap[i].executeFunctionAsync(l,n.tensorArrayMap,n.tensorListMap):n.functionMap[o].executeFunctionAsync(l,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const i=A("body",r,t,n),o=A("cond",r,t,n),a=A("args",r,t,n),l=await n.functionMap[o].executeFunctionAsync(a,n.tensorArrayMap,n.tensorListMap),c=a.map(d=>d.id);let u=await l[0].data();l.forEach(d=>{!d.kept&&c.indexOf(d.id)===-1&&d.dispose()});let h=a;for(;u[0];){const d=h;h=await n.functionMap[i].executeFunctionAsync(h,n.tensorArrayMap,n.tensorListMap);const f=h.map(m=>m.id);d.forEach(m=>{!m.kept&&c.indexOf(m.id)===-1&&f.indexOf(m.id)===-1&&m.dispose()});const p=await n.functionMap[o].executeFunctionAsync(h,n.tensorArrayMap,n.tensorListMap);u=await p[0].data(),p.forEach(m=>{!m.kept&&c.indexOf(m.id)===-1&&f.indexOf(m.id)===-1&&m.dispose()})}return h}case"LoopCond":{const i=A("pred",r,t,n);return[rl(i)]}case"Switch":{const i=A("pred",r,t,n);let o=A("data",r,t,n);return o.kept||(o=rl(o)),(await i.data())[0]?[void 0,o]:[o,void 0]}case"Merge":{const i=r.inputNames.find(o=>Or(o,t,n)!==void 0);if(i){const o=Or(i,t,n);return[rl(o)]}return}case"Enter":{const i=A("frameName",r,t,n),o=A("tensor",r,t,n);return n.enterFrame(i),[rl(o)]}case"Exit":{const i=A("tensor",r,t,n);return n.exitFrame(),[rl(i)]}case"NextIteration":{const i=A("tensor",r,t,n);return n.nextIteration(),[rl(i)]}case"TensorArrayV3":{const i=A("size",r,t,n),o=A("dtype",r,t,n),a=A("elementShape",r,t,n),l=A("dynamicSize",r,t,n),c=A("clearAfterRead",r,t,n),u=A("identicalElementShapes",r,t,n),h=A("name",r,t,n),d=new ROt(h,o,i,a,u,l,c);return n.addTensorArray(d),[d.idTensor,Rn(1)]}case"TensorArrayWriteV3":{const i=A("tensorArrayId",r,t,n),o=A("index",r,t,n),a=A("tensor",r,t,n),l=n.getTensorArray(i.id);return l.write(o,a),[l.idTensor]}case"TensorArrayReadV3":{const i=A("tensorArrayId",r,t,n),o=A("index",r,t,n);return[n.getTensorArray(i.id).read(o)]}case"TensorArrayGatherV3":{const i=A("tensorArrayId",r,t,n),o=A("indices",r,t,n),a=A("dtype",r,t,n);return[n.getTensorArray(i.id).gather(o,a)]}case"TensorArrayScatterV3":{const i=A("tensorArrayId",r,t,n),o=A("indices",r,t,n),a=A("tensor",r,t,n),l=n.getTensorArray(i.id);return l.scatter(o,a),[l.idTensor]}case"TensorArrayConcatV3":{const i=A("tensorArrayId",r,t,n),o=n.getTensorArray(i.id),a=A("dtype",r,t,n);return[o.concat(a)]}case"TensorArraySplitV3":{const i=A("tensorArrayId",r,t,n),o=A("tensor",r,t,n),a=A("lengths",r,t,n),l=n.getTensorArray(i.id);return l.split(a,o),[l.idTensor]}case"TensorArraySizeV3":{const i=A("tensorArrayId",r,t,n),o=n.getTensorArray(i.id);return[Rn(o.size(),"int32")]}case"TensorArrayCloseV3":{const i=A("tensorArrayId",r,t,n),o=n.getTensorArray(i.id);return o.clearAndClose(),[o.idTensor]}case"TensorListSetItem":{const i=A("tensorListId",r,t,n),o=A("index",r,t,n),a=A("tensor",r,t,n),l=n.getTensorList(i.id);return l.setItem(o,a),[l.idTensor]}case"TensorListGetItem":{const i=A("tensorListId",r,t,n),o=A("index",r,t,n),a=A("elementShape",r,t,n),l=A("elementDType",r,t,n);return[n.getTensorList(i.id).getItem(o,a,l)]}case"TensorListScatterV2":case"TensorListScatter":{const i=A("indices",r,t,n),o=A("tensor",r,t,n),a=A("elementShape",r,t,n),l=A("numElements",r,t,n),c=FOt(o,i,a,l);return n.addTensorList(c),[c.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const i=A("elementShape",r,t,n),o=A("elementDType",r,t,n);let a;r.op==="TensorListReserve"?a="numElements":a="maxNumElements";const l=A(a,r,t,n),c=r.op==="TensorListReserve"?-1:l,u=LOt(i,o,l,c);return n.addTensorList(u),[u.idTensor]}case"TensorListGather":{const i=A("tensorListId",r,t,n),o=A("indices",r,t,n),a=A("elementShape",r,t,n),l=A("elementDType",r,t,n);return[n.getTensorList(i.id).gather(o,l,a)]}case"TensorListStack":{const i=A("tensorListId",r,t,n),o=A("elementShape",r,t,n),a=A("elementDType",r,t,n),l=A("numElements",r,t,n);return[n.getTensorList(i.id).stack(o,a,l)]}case"TensorListFromTensor":{const i=A("tensor",r,t,n),o=A("elementShape",r,t,n),a=A("elementDType",r,t,n),l=OOt(i,o,a);return n.addTensorList(l),[l.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const i=A("tensorListId",r,t,n),o=n.getTensorList(i.id),a=A("dtype",r,t,n),l=A("elementShape",r,t,n);return[o.concat(a,l)]}case"TensorListPushBack":{const i=A("tensorListId",r,t,n),o=A("tensor",r,t,n),a=n.getTensorList(i.id);return a.pushBack(o),[a.idTensor]}case"TensorListPopBack":{const i=A("tensorListId",r,t,n),o=A("elementShape",r,t,n),a=A("elementDType",r,t,n);return[n.getTensorList(i.id).popBack(o,a)]}case"TensorListSplit":{const i=A("tensor",r,t,n),o=A("elementShape",r,t,n),a=A("lengths",r,t,n),l=POt(i,a,o);return n.addTensorList(l),[l.idTensor]}case"TensorListLength":{const i=A("tensorListId",r,t,n),o=n.getTensorList(i.id);return[Rn(o.size(),"int32")]}case"TensorListResize":{const i=A("tensorListId",r,t,n),o=A("size",r,t,n),l=n.getTensorList(i.id).resize(o);return n.addTensorList(l),[l.idTensor]}default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $A(r,t,n){const[i,o]=A("fusedOps",r,t,n),a=i==="biasadd",l=!a,c=o==="prelu",u=i==="fusedbatchnorm",h=A("numArgs",r,t,n);if(a){if(c&&h!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&a&&h!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const d=A("strides",r,t,n),f=D1(r,t,n),p=A("dataFormat",r,t,n).toUpperCase(),m=A("dilations",r,t,n);let[g,y]=A("args",r,t,n);l&&(y=g,g=void 0);const v=A("leakyreluAlpha",r,t,n);return{stride:d,pad:f,dataFormat:p,dilations:m,biasArg:g,preluArg:y,activationFunc:o,leakyreluAlpha:v}}const zOt=(r,t,n,i=Tr)=>{switch(r.op){case"Conv1D":{const o=A("stride",r,t,n),a=A("pad",r,t,n),l=A("dataFormat",r,t,n).toUpperCase(),c=A("dilation",r,t,n);return[i.conv1d(A("x",r,t,n),A("filter",r,t,n),o,a,l,c)]}case"Conv2D":{const o=A("strides",r,t,n),a=D1(r,t,n),l=A("dataFormat",r,t,n).toUpperCase(),c=A("dilations",r,t,n);return[i.conv2d(A("x",r,t,n),A("filter",r,t,n),[o[1],o[2]],a,l,[c[1],c[2]])]}case"_FusedConv2D":{const{stride:o,pad:a,dataFormat:l,dilations:c,biasArg:u,preluArg:h,activationFunc:d,leakyreluAlpha:f}=$A(r,t,n);return[i.fused.conv2d({x:A("x",r,t,n),filter:A("filter",r,t,n),strides:[o[1],o[2]],pad:a,dataFormat:l,dilations:[c[1],c[2]],bias:u,activation:d,preluActivationWeights:h,leakyreluAlpha:f})]}case"FusedDepthwiseConv2dNative":{const{stride:o,pad:a,dataFormat:l,dilations:c,biasArg:u,preluArg:h,activationFunc:d,leakyreluAlpha:f}=$A(r,t,n);return[i.fused.depthwiseConv2d({x:A("x",r,t,n),filter:A("filter",r,t,n),strides:[o[1],o[2]],pad:a,dataFormat:l,dilations:[c[1],c[2]],bias:u,activation:d,preluActivationWeights:h,leakyreluAlpha:f})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const o=A("outputShape",r,t,n),a=A("strides",r,t,n),l=D1(r,t,n);return[i.conv2dTranspose(A("x",r,t,n),A("filter",r,t,n),o,[a[1],a[2]],l)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const o=A("strides",r,t,n),a=D1(r,t,n),l=A("dilations",r,t,n),c=A("dataFormat",r,t,n).toUpperCase();return[i.depthwiseConv2d(A("input",r,t,n),A("filter",r,t,n),[o[1],o[2]],a,c,[l[1],l[2]])]}case"Conv3D":{const o=A("strides",r,t,n),a=A("pad",r,t,n),l=A("dataFormat",r,t,n).toUpperCase(),c=A("dilations",r,t,n);return[i.conv3d(A("x",r,t,n),A("filter",r,t,n),[o[1],o[2],o[3]],a,l,[c[1],c[2],c[3]])]}case"AvgPool":{const o=A("strides",r,t,n),a=A("pad",r,t,n),l=A("kernelSize",r,t,n);return[i.avgPool(A("x",r,t,n),[l[1],l[2]],[o[1],o[2]],a)]}case"MaxPool":{const o=A("strides",r,t,n),a=A("pad",r,t,n),l=A("kernelSize",r,t,n);return[i.maxPool(A("x",r,t,n),[l[1],l[2]],[o[1],o[2]],a)]}case"MaxPoolWithArgmax":{const o=A("strides",r,t,n),a=A("pad",r,t,n),l=A("kernelSize",r,t,n),c=A("includeBatchInIndex",r,t,n),{result:u,indexes:h}=i.maxPoolWithArgmax(A("x",r,t,n),[l[1],l[2]],[o[1],o[2]],a,c);return[u,h]}case"AvgPool3D":{const o=A("strides",r,t,n),a=A("pad",r,t,n),l=A("kernelSize",r,t,n);return[i.avgPool3d(A("x",r,t,n),[l[1],l[2],l[3]],[o[1],o[2],o[3]],a)]}case"MaxPool3D":{const o=A("strides",r,t,n),a=A("pad",r,t,n),l=A("kernelSize",r,t,n);return[i.maxPool3d(A("x",r,t,n),[l[1],l[2],l[3]],[o[1],o[2],o[3]],a)]}case"Dilation2D":{const o=A("strides",r,t,n),a=A("pad",r,t,n),l=A("dilations",r,t,n),c=o[1],u=o[2],h=l[1],d=l[2];return[i.dilation2d(A("x",r,t,n),A("filter",r,t,n),[c,u],a,[h,d],"NHWC")]}default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VOt=(r,t,n,i=Tr)=>{switch(r.op){case"Fill":{const o=A("shape",r,t,n),a=A("dtype",r,t,n),l=A("value",r,t,n);return[i.fill(o,l,a)]}case"LinSpace":{const o=A("start",r,t,n),a=A("stop",r,t,n),l=A("num",r,t,n);return[i.linspace(o,a,l)]}case"Multinomial":{const o=A("logits",r,t,n),a=A("numSamples",r,t,n),l=A("seed",r,t,n);return[i.multinomial(o,a,l)]}case"OneHot":{const o=A("indices",r,t,n),a=A("depth",r,t,n),l=A("onValue",r,t,n),c=A("offValue",r,t,n),u=A("dtype",r,t,n);return[i.oneHot(o,a,l,c,u)]}case"Ones":return[i.ones(A("shape",r,t,n),A("dtype",r,t,n))];case"OnesLike":return[i.onesLike(A("x",r,t,n))];case"RandomStandardNormal":return[i.randomStandardNormal(A("shape",r,t,n),A("dtype",r,t,n),A("seed",r,t,n))];case"RandomUniform":return[i.randomUniform(A("shape",r,t,n),A("minval",r,t,n),A("maxval",r,t,n),A("dtype",r,t,n))];case"Range":{const o=A("start",r,t,n),a=A("stop",r,t,n),l=A("step",r,t,n);return[i.range(o,a,l,A("dtype",r,t,n))]}case"TruncatedNormal":{const o=A("shape",r,t,n),a=A("mean",r,t,n),l=A("stdDev",r,t,n),c=A("seed",r,t,n);return[i.truncatedNormal(o,a,l,A("dtype",r,t,n),c)]}case"Zeros":return[i.zeros(A("shape",r,t,n),A("dtype",r,t,n))];case"ZerosLike":return[i.zerosLike(A("x",r,t,n))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lb(r,t,n){const i=A("boxes",r,t,n),o=A("scores",r,t,n),a=A("maxOutputSize",r,t,n),l=A("iouThreshold",r,t,n),c=A("scoreThreshold",r,t,n),u=A("softNmsSigma",r,t,n);return{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:c,softNmsSigma:u}}const UOt=async(r,t,n,i,o=Tr)=>{switch(r.op){case"NonMaxSuppressionV5":{const{boxes:a,scores:l,maxOutputSize:c,iouThreshold:u,scoreThreshold:h,softNmsSigma:d}=Lb(r,t,n),f=await o.image.nonMaxSuppressionWithScoreAsync(a,l,c,u,h,d);return[f.selectedIndices,f.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:a,scores:l,maxOutputSize:c,iouThreshold:u,scoreThreshold:h}=Lb(r,t,n),d=A("padToMaxOutputSize",r,t,n),f=await o.image.nonMaxSuppressionPaddedAsync(a,l,c,u,h,d);return[f.selectedIndices,f.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:a,scores:l,maxOutputSize:c,iouThreshold:u,scoreThreshold:h}=Lb(r,t,n);return[await o.image.nonMaxSuppressionAsync(a,l,c,u,h)]}case"Where":{const a=o.cast(A("condition",r,t,n),"bool"),l=[await o.whereAsync(a)];return a.dispose(),l}case"ListDiff":return o.setdiff1dAsync(A("x",r,t,n),A("y",r,t,n));default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WOt=(r,t,n,i=Tr)=>{switch(r.op){case"LowerBound":{const o=A("sortedSequence",r,t,n),a=A("values",r,t,n);return[i.lowerBound(o,a)]}case"TopKV2":{const o=A("x",r,t,n),a=A("k",r,t,n),l=A("sorted",r,t,n),c=i.topk(o,a,l);return[c.values,c.indices]}case"UpperBound":{const o=A("sortedSequence",r,t,n),a=A("values",r,t,n);return[i.upperBound(o,a)]}case"Unique":{const o=A("x",r,t,n),a=i.unique(o);return[a.values,a.indices]}case"UniqueV2":{const o=A("x",r,t,n),a=A("axis",r,t,n),l=i.unique(o,a);return[l.values,l.indices]}default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GOt=(r,t,n,i=Tr)=>{switch(r.op){case"Const":return t[r.name];case"PlaceholderWithDefault":const o=A("default",r,t,n);return[Or(r.name,t,n)||o];case"Placeholder":return[Or(r.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const d=A("x",r,t,n);return[rl(d)]}case"IdentityN":return A("x",r,t,n).map(d=>rl(d));case"Snapshot":const a=A("x",r,t,n);return[rl(a)];case"Shape":return[i.tensor1d(A("x",r,t,n).shape,"int32")];case"ShapeN":return A("x",r,t,n).map(d=>i.tensor1d(d.shape));case"Size":return[i.scalar(A("x",r,t,n).size,"int32")];case"Rank":return[i.scalar(A("x",r,t,n).rank,"int32")];case"NoOp":return[i.scalar(1)];case"Print":const l=A("x",r,t,n),c=A("data",r,t,n),u=A("message",r,t,n),h=A("summarize",r,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(u);for(let d=0;d<c.length;d++)console.log(Array.prototype.slice.call(c[d].dataSync()).slice(0,h));return[l];default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HOt{constructor(t,n){this.keyDType=t,this.valueDType=n,this.handle=Rn(0),this.tensorMap=new Map,ac(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach(t=>t.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Rn(this.size(),"int32")}async import(t,n){this.checkKeyAndValueTensor(t,n);const i=await t.data();return this.tensorMap.forEach(o=>o.dispose()),this.tensorMap.clear(),$s(()=>{const o=Eh(n),a=i.length,l=o.length;st(a===l,()=>`The number of elements doesn't match, keys has ${a} elements, the values has ${l} elements.`);for(let c=0;c<a;c++){const u=i[c],h=o[c];ac(h),this.tensorMap.set(u,h)}return this.handle})}async find(t,n){this.checkKeyAndValueTensor(t,n);const i=await t.data();return $s(()=>{const o=[];for(let a=0;a<i.length;a++){const l=i[a],c=this.findWithDefault(l,n);o.push(c)}return kl(o)})}findWithDefault(t,n){const i=this.tensorMap.get(t);return i??n}checkKeyAndValueTensor(t,n){if(t.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${t.dtype}`);if(n.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${n.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jOt=async(r,t,n,i)=>{switch(r.op){case"HashTable":case"HashTableV2":{const o=A("keyDType",r,t,n),a=A("valueDType",r,t,n),l=new HOt(o,a);return i.addHashTable(r.name,l),[l.handle]}case"LookupTableImport":case"LookupTableImportV2":{const o=A("tableHandle",r,t,n,i),a=A("keys",r,t,n),l=A("values",r,t,n);return[await i.getHashTableById(o.id).import(a,l)]}case"LookupTableFind":case"LookupTableFindV2":{const o=A("tableHandle",r,t,n,i),a=A("keys",r,t,n),l=A("defaultValue",r,t,n);return[await i.getHashTableById(o.id).find(a,l)]}case"LookupTableSize":case"LookupTableSizeV2":{const o=A("tableHandle",r,t,n,i);return[i.getHashTableById(o.id).tensorSize()]}default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qOt=(r,t,n,i=Tr)=>{switch(r.op){case"ResizeBilinear":{const o=A("images",r,t,n),a=A("size",r,t,n),l=A("alignCorners",r,t,n),c=A("halfPixelCenters",r,t,n);return[i.image.resizeBilinear(o,[a[0],a[1]],l,c)]}case"ResizeNearestNeighbor":{const o=A("images",r,t,n),a=A("size",r,t,n),l=A("alignCorners",r,t,n),c=A("halfPixelCenters",r,t,n);return[i.image.resizeNearestNeighbor(o,[a[0],a[1]],l,c)]}case"CropAndResize":{const o=A("image",r,t,n),a=A("boxes",r,t,n),l=A("boxInd",r,t,n),c=A("cropSize",r,t,n),u=A("method",r,t,n),h=A("extrapolationValue",r,t,n);return[i.image.cropAndResize(o,a,l,c,u,h)]}case"ImageProjectiveTransformV3":{const o=A("images",r,t,n),a=A("transforms",r,t,n),l=A("outputShape",r,t,n),c=A("fillValue",r,t,n),u=A("interpolation",r,t,n),h=A("fillMode",r,t,n);return[i.image.transform(o,a,u.toLowerCase(),h.toLowerCase(),c,l)]}default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KOt=(r,t,n,i=Tr)=>{switch(r.op){case"Equal":return[i.equal(A("a",r,t,n),A("b",r,t,n))];case"NotEqual":return[i.notEqual(A("a",r,t,n),A("b",r,t,n))];case"Greater":return[i.greater(A("a",r,t,n),A("b",r,t,n))];case"GreaterEqual":return[i.greaterEqual(A("a",r,t,n),A("b",r,t,n))];case"Less":return[i.less(A("a",r,t,n),A("b",r,t,n))];case"LessEqual":return[i.lessEqual(A("a",r,t,n),A("b",r,t,n))];case"LogicalAnd":return[i.logicalAnd(A("a",r,t,n),A("b",r,t,n))];case"LogicalNot":return[i.logicalNot(A("a",r,t,n))];case"LogicalOr":return[i.logicalOr(A("a",r,t,n),A("b",r,t,n))];case"Select":case"SelectV2":return[i.where(A("condition",r,t,n),A("a",r,t,n),A("b",r,t,n))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XOt=(r,t,n,i=Tr)=>{switch(r.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[i.matMul(A("a",r,t,n),A("b",r,t,n),A("transposeA",r,t,n),A("transposeB",r,t,n))];case"Einsum":return[i.einsum(A("equation",r,t,n),...A("tensors",r,t,n))];case"Transpose":return[i.transpose(A("x",r,t,n),A("perm",r,t,n))];case"_FusedMatMul":const[o,a]=A("fusedOps",r,t,n),l=o==="biasadd",c=a==="prelu",u=A("numArgs",r,t,n),h=A("leakyreluAlpha",r,t,n);if(l){if(c&&u!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&u!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[d,f]=A("args",r,t,n);return[i.fused.matMul({a:A("a",r,t,n),b:A("b",r,t,n),transposeA:A("transposeA",r,t,n),transposeB:A("transposeB",r,t,n),bias:d,activation:a,preluActivationWeights:f,leakyreluAlpha:h})];default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YOt=(r,t,n,i=Tr)=>{switch(r.op){case"EuclideanNorm":return[i.euclideanNorm(A("x",r,t,n),A("axis",r,t,n),A("keepDims",r,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":return[i.batchNorm(A("x",r,t,n),A("mean",r,t,n),A("variance",r,t,n),A("offset",r,t,n),A("scale",r,t,n),A("epsilon",r,t,n))];case"FusedBatchNormV3":return[i.batchNorm(A("x",r,t,n),A("mean",r,t,n),A("variance",r,t,n),A("offset",r,t,n),A("scale",r,t,n),A("epsilon",r,t,n))];case"LRN":return[i.localResponseNormalization(A("x",r,t,n),A("radius",r,t,n),A("bias",r,t,n),A("alpha",r,t,n),A("beta",r,t,n))];case"Softmax":return[i.softmax(A("x",r,t,n))];case"LogSoftmax":return[i.logSoftmax(A("x",r,t,n))];case"SparseToDense":return[i.sparseToDense(A("sparseIndices",r,t,n),A("outputShape",r,t,n),A("sparseValues",r,t,n),A("defaultValue",r,t,n))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZOt=(r,t,n,i=Tr)=>{switch(r.op){case"Max":{const c=A("axis",r,t,n),u=A("keepDims",r,t,n);return[i.max(A("x",r,t,n),c,u)]}case"Mean":{const c=A("axis",r,t,n),u=A("keepDims",r,t,n);return[i.mean(A("x",r,t,n),c,u)]}case"Min":{const c=A("axis",r,t,n),u=A("keepDims",r,t,n);return[i.min(A("x",r,t,n),c,u)]}case"Sum":{const c=A("axis",r,t,n),u=A("keepDims",r,t,n);return[i.sum(A("x",r,t,n),c,u)]}case"All":{const c=A("axis",r,t,n),u=A("keepDims",r,t,n);return[i.all(A("x",r,t,n),c,u)]}case"Any":{const c=A("axis",r,t,n),u=A("keepDims",r,t,n);return[i.any(A("x",r,t,n),c,u)]}case"ArgMax":{const c=A("axis",r,t,n);return[i.argMax(A("x",r,t,n),c)]}case"ArgMin":{const c=A("axis",r,t,n);return[i.argMin(A("x",r,t,n),c)]}case"Prod":{const c=A("axis",r,t,n),u=A("keepDims",r,t,n);return[i.prod(A("x",r,t,n),c,u)]}case"Cumprod":{const c=A("axis",r,t,n),u=A("exclusive",r,t,n),h=A("reverse",r,t,n);return[i.cumprod(A("x",r,t,n),c,u,h)]}case"Cumsum":{const c=A("axis",r,t,n),u=A("exclusive",r,t,n),h=A("reverse",r,t,n);return[i.cumsum(A("x",r,t,n),c,u,h)]}case"Bincount":const o=A("x",r,t,n),a=A("weights",r,t,n),l=A("size",r,t,n);return[i.bincount(o,a,l)];case"DenseBincount":{const c=A("x",r,t,n),u=A("weights",r,t,n),h=A("size",r,t,n),d=A("binaryOutput",r,t,n);return[i.denseBincount(c,u,h,d)]}default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JOt=(r,t,n,i=Tr)=>{switch(r.op){case"ConcatV2":case"Concat":{const o=A("n",r,t,n),a=A("axis",r,t,n);let l=A("tensors",r,t,n);return l=l.slice(0,o),[i.concat(l,a)]}case"Gather":{const o=A("x",r,t,n),a=A("indices",r,t,n);return[i.gather(o,i.cast(a,"int32"),0)]}case"GatherV2":{const o=A("axis",r,t,n),a=A("batchDims",r,t,n),l=A("x",r,t,n),c=A("indices",r,t,n);return[i.gather(l,i.cast(c,"int32"),o,a)]}case"Reverse":{const o=A("dims",r,t,n),a=[];for(let c=0;c<o.length;c++)o[c]&&a.push(c);const l=A("x",r,t,n);return[i.reverse(l,a)]}case"ReverseV2":{const o=A("axis",r,t,n),a=A("x",r,t,n);return[i.reverse(a,o)]}case"Slice":{const o=A("begin",r,t,n),a=A("size",r,t,n);return[i.slice(A("x",r,t,n),o,a)]}case"StridedSlice":{const o=A("begin",r,t,n),a=A("end",r,t,n),l=A("strides",r,t,n),c=A("beginMask",r,t,n),u=A("endMask",r,t,n),h=A("ellipsisMask",r,t,n),d=A("newAxisMask",r,t,n),f=A("shrinkAxisMask",r,t,n),p=A("x",r,t,n);return[i.stridedSlice(p,o,a,l,c,u,h,d,f)]}case"Pack":return $s(()=>{const o=A("axis",r,t,n),a=A("tensors",r,t,n),l=a[0].shape,c=i.squeeze(a[0]).shape,u=a.map(h=>{const d=Nc(h.shape,l);if(!d&&!Nc(i.squeeze(h).shape,c))throw new Error("the input tensors shape does not match");return d?h:i.reshape(h,l)});return[i.stack(u,o)]});case"Unpack":{const o=A("axis",r,t,n),a=A("tensor",r,t,n);return i.unstack(a,o)}case"Tile":{const o=A("reps",r,t,n);return[i.tile(A("x",r,t,n),o)]}case"Split":case"SplitV":{const o=A("axis",r,t,n),a=A("numOrSizeSplits",r,t,n),l=A("x",r,t,n);return i.split(l,a,o)}case"ScatterNd":{const o=A("indices",r,t,n),a=A("values",r,t,n),l=A("shape",r,t,n);return[i.scatterND(o,a,l)]}case"GatherNd":{const o=A("x",r,t,n),a=A("indices",r,t,n);return[i.gatherND(o,a)]}case"SparseToDense":{const o=A("sparseIndices",r,t,n),a=A("outputShape",r,t,n),l=A("sparseValues",r,t,n),c=A("defaultValue",r,t,n);return[i.sparseToDense(o,l,a,l.dtype===c.dtype?c:i.cast(c,l.dtype))]}default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QOt=(r,t,n,i=Tr)=>{switch(r.op){case"SparseFillEmptyRows":{const{outputIndices:o,outputValues:a,emptyRowIndicator:l,reverseIndexMap:c}=i.sparse.sparseFillEmptyRows(A("indices",r,t,n),A("values",r,t,n),A("denseShape",r,t,n),A("defaultValue",r,t,n));return[o,a,l,c]}case"SparseReshape":{const{outputIndices:o,outputShape:a}=i.sparse.sparseReshape(A("inputIndices",r,t,n),A("inputShape",r,t,n),A("newShape",r,t,n));return[o,a]}case"SparseSegmentMean":return[i.sparse.sparseSegmentMean(A("data",r,t,n),A("indices",r,t,n),A("segmentIds",r,t,n))];case"SparseSegmentSum":return[i.sparse.sparseSegmentSum(A("data",r,t,n),A("indices",r,t,n),A("segmentIds",r,t,n))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t7t=(r,t,n,i=Tr)=>{switch(r.op){case"FFT":return[i.fft(A("x",r,t,n))];case"IFFT":return[i.ifft(A("x",r,t,n))];case"RFFT":return[i.rfft(A("x",r,t,n))];case"IRFFT":return[i.irfft(A("x",r,t,n))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e7t=(r,t,n,i=Tr)=>{switch(r.op){case"StringNGrams":{const{nGrams:o,nGramsSplits:a}=i.string.stringNGrams(A("data",r,t,n),A("dataSplits",r,t,n),A("separator",r,t,n),A("nGramWidths",r,t,n),A("leftPad",r,t,n),A("rightPad",r,t,n),A("padWidth",r,t,n),A("preserveShortSequences",r,t,n));return[o,a]}case"StringSplit":{const{indices:o,values:a,shape:l}=i.string.stringSplit(A("input",r,t,n),A("delimiter",r,t,n),A("skipEmpty",r,t,n));return[o,a,l]}case"StringToHashBucketFast":return[i.string.stringToHashBucketFast(A("input",r,t,n),A("numBuckets",r,t,n))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n7t=(r,t,n,i=Tr)=>{switch(r.op){case"Cast":return[i.cast(A("x",r,t,n),A("dtype",r,t,n))];case"ExpandDims":{const o=A("axis",r,t,n);return[i.expandDims(A("x",r,t,n),o)]}case"Squeeze":{const o=A("axis",r,t,n);return[i.squeeze(A("x",r,t,n),o)]}case"Reshape":return[i.reshape(A("x",r,t,n),A("shape",r,t,n))];case"MirrorPad":return[i.mirrorPad(A("x",r,t,n),A("padding",r,t,n),A("mode",r,t,n))];case"PadV2":case"Pad":return[i.pad(A("x",r,t,n),A("padding",r,t,n),A("constantValue",r,t,n))];case"SpaceToBatchND":{const o=A("blockShape",r,t,n),a=A("paddings",r,t,n);return[i.spaceToBatchND(A("x",r,t,n),o,a)]}case"BatchToSpaceND":{const o=A("blockShape",r,t,n),a=A("crops",r,t,n);return[i.batchToSpaceND(A("x",r,t,n),o,a)]}case"DepthToSpace":{const o=A("blockSize",r,t,n),a=A("dataFormat",r,t,n).toUpperCase();return[i.depthToSpace(A("x",r,t,n),o,a)]}case"BroadcastTo":return[i.broadcastTo(A("x",r,t,n),A("shape",r,t,n))];case"BroadcastArgs":return[i.broadcastArgs(A("s0",r,t,n),A("s1",r,t,n))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IA(r,t,n,i,o=$s){const a=((l,c,u)=>{switch(l.category){case"arithmetic":return o(()=>MOt(l,c,u));case"basic_math":return o(()=>DOt(l,c,u));case"control":return BOt(l,c,u);case"convolution":return o(()=>zOt(l,c,u));case"creation":return o(()=>VOt(l,c,u));case"dynamic":return UOt(l,c,u);case"evaluation":return o(()=>WOt(l,c,u));case"image":return o(()=>qOt(l,c,u));case"graph":return o(()=>GOt(l,c,u));case"logical":return o(()=>KOt(l,c,u));case"matrices":return o(()=>XOt(l,c,u));case"normalization":return o(()=>YOt(l,c,u));case"reduction":return o(()=>ZOt(l,c,u));case"slice_join":return o(()=>JOt(l,c,u));case"sparse":return o(()=>QOt(l,c,u));case"spectral":return o(()=>t7t(l,c,u));case"string":return o(()=>e7t(l,c,u));case"transformation":return o(()=>n7t(l,c,u));case"hash_table":return jOt(l,c,u,i);case"custom":const h=wB(l.op);if(h&&h.customExecutor)return h.customExecutor(new AOt(l,c,u));throw TypeError(`Custom op ${l.op} is not registered.`);default:throw TypeError(`Unknown op '${l.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(r,t,n);return tf(a)?a.then(l=>[].concat(l)):[].concat(a)}class EA{constructor(t={},n={},i={},o={}){this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=i,this.functionMap=o,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,n){return{id:t,frameName:n,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const t=[];for(let n=0;n<this.contexts.length-1;n++){const i=this.contexts.slice(0,this.contexts.length-n);t.push(this.contextIdforContexts(i))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map(n=>n.id===0&&n.iterationId===0?"":`${n.frameName}-${n.iterationId}`).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(t){for(const n in this.tensorArrayMap)this.tensorArrayMap[n].clearAndClose(t);for(const n in this.tensorListMap)this.tensorListMap[n].clearAndClose(t)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NA(r,t,n,i){const o=new Set,a=[];let l=null,c=null;const u=new Set,h=Object.keys(r).map(p=>li(p)[0]);let d=[];i!=null&&(d=i.map(p=>li(p.name)[0]));const f=[...t];for(;f.length>0;){const p=f.pop();if((TB(p)||a7t(p)||l7t(p))&&l==null&&(l=p,c=l.children.map(m=>m.name).filter(m=>o.has(m))),o.add(p.name),n[p.name]==null&&h.indexOf(p.name)===-1&&d.indexOf(p.name)===-1){if(p.inputs.length===0){a.push(p.name);continue}p.inputs.forEach(m=>{u.has(m.name)||(u.add(m.name),f.push(m))})}}return{inputs:r,outputs:t,usedNodes:o,missingInputs:a,dynamicNode:l,syncInputs:c}}function s7t(r,t,n){const{usedNodes:i,inputs:o}=n,a=[],l=Object.keys(o).map(d=>li(d)[0]).map(d=>r.nodes[d]),c=r.initNodes;l.forEach(d=>{i.has(d.name)&&a.push(d)}),r.weights.forEach(d=>{i.has(d.name)&&a.push(d)}),c!=null&&c.forEach(d=>{i.has(d.name)&&a.push(d)});const u=new Set,h=[];for(;a.length>0;){const d=a.pop();u.add(d.name),t[d.name]||h.push(d),d.children.forEach(f=>{!u.has(f.name)&&i.has(f.name)&&f.inputs.every(p=>u.has(p.name))&&a.push(f)})}return h}const r7t=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],i7t=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],o7t=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function TB(r){return r7t.indexOf(r.op)>=0}function a7t(r){return i7t.indexOf(r.op)>=0}function l7t(r){return o7t.indexOf(r.op)>=0}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z2{constructor(t,n){this.graph=t,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,t.functions!=null&&Object.keys(t.functions).forEach(i=>{this._functionExecutorMap[i]=new z2(t.functions[i],this)})}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){const n=Object.keys(t).map(i=>t[i].map(o=>o.id));this._weightIds=[].concat(...n),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(t=>t.signatureKey||t.name)}get outputNodes(){return this._outputs.map(t=>{const n=t.signatureKey||t.name;return t.defaultOutput?`${n}:${t.defaultOutput}`:n})}get functions(){return Object.keys(this._functions).reduce((t,n)=>(t[n]=this._functions[n].signature,t),{})}getCompilationKey(t,n){const i=t.map(a=>a.name).sort(),o=n.map(a=>a.name).sort();return i.join(this.SEPERATOR)+"--"+o.join(this.SEPERATOR)}compile(t,n){const i=NA(t,n,this.weightMap,this._initNodes),{missingInputs:o,dynamicNode:a,syncInputs:l}=i;if(a!=null)throw new Error(`This execution contains the node '${a.name}', which has the dynamic op '${a.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${l}]`);if(o.length>0){const c=n.map(h=>h.name),u=Object.keys(t);throw new Error(`Cannot compute the outputs [${c}] from the provided inputs [${u}]. Missing the following inputs: [${o}]`)}return s7t(this.graph,this.weightMap,i)}execute(t,n){t=this.mapInputs(t);const i=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n);const o=i.map(f=>this.graph.nodes[li(f)[0]]),a=n.map(f=>li(f)[0]);let l=a.map(f=>this.graph.nodes[f]);this.resetIntermediateTensors(),l.length===0&&(l=this._outputs);const c=this.getCompilationKey(o,l);let u=this.compiledMap.get(c);u==null&&(u=this.compile(t,l),this.compiledMap.set(c,u));const h={},d={};return $s(()=>{const f=new EA(this.weightMap,h,d,this.functionExecutorMap),p=Object.assign({},this.weightMap);Object.keys(t).forEach(y=>{const[v,x]=li(y),b=[];b[x]=t[y],p[v]=b});const m=this.getFrozenTensorIds(p),g={};for(let y=0;y<u.length;y++){const v=u[y];if(!p[v.name]){const x=IA(v,p,f,this._resourceManager);if(tf(x))throw new Error(`The execution of the op '${v.op}' returned a promise. Please use model.executeAsync() instead.`);p[v.name]=x,this.checkTensorForDisposal(v.name,v,p,f,m,a,g)}}return this.parent==null&&f.dispose(m),n.map(y=>Or(y,p,f))})}getFrozenTensorIds(t){const n=[].concat.apply([],Object.keys(t).map(i=>t[i]).map(i=>i.map(o=>o.id)));return new Set(n)}checkTensorForDisposal(t,n,i,o,a,l,c){n.category==="control"||l.indexOf(t)!==-1||(i[t].forEach(u=>{u!=null&&(c[u.id]=(c[u.id]||0)+n.children.length)}),n.inputs.forEach(u=>{if(u.category!=="control"){const h=H8t(u.name,i,o);h!=null&&h.forEach(d=>{if(d&&!d.kept&&!a.has(d.id)){const f=c[d.id];if(f===1){if(!this.keepTensorForDebug)d.dispose();else{const[p,m]=_a(n.name,o);this.intermediateTensors[p]?this.intermediateTensors[p][m]=d:(this.intermediateTensors[p]=[],this.intermediateTensors[p][m]=d)}delete c[d.id]}else f!=null&&c[d.id]--}})}}))}async executeAsync(t,n){return this._executeAsync(t,n)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach(t=>this.intermediateTensors[t].forEach(n=>n.dispose())),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach(t=>{this.tensorsMap[t].forEach(i=>{i&&!i.kept&&!i.isDisposed&&!this.keepIds.has(i.id)&&i.dispose()})})}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const t in this.intermediateTensors)this.intermediateTensors[t].forEach(n=>n.dispose()),delete this.intermediateTensors[t]}async _executeAsync(t,n,i=!1,o={},a={}){i||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepTensorForDebug=Cn().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){console.warn(d.message)}this.resetIntermediateTensors();const l=new EA(this.weightMap,o,a,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(t,l,n,i);const c=n.map(d=>Or(d,this.tensorsMap,l)),u=c.map(d=>d.id),h=Object.keys(t).map(d=>t[d].id);return this.keepIds=new Set([...u,...h,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),this.parent==null&&l.dispose(this.keepIds),c}async executeFunctionAsync(t,n,i){const o=t.reduce((a,l,c)=>(a[this.inputs[c].name]=l,a),{});return this._executeAsync(o,this.outputNodes,!0,n,i)}async executeWithControlFlow(t,n,i,o){const a=Object.keys(t),l=a.map(w=>this.graph.nodes[li(w)[0]]),c=i.map(w=>li(w)[0]);let u=c.map(w=>this.graph.nodes[w]);u.length===0&&(u=this._outputs);const{usedNodes:h,missingInputs:d,dynamicNode:f,syncInputs:p}=NA(t,u,this.weightMap,this._initNodes),m=[...l,...this.graph.weights,...this._initNodes||[]].map(w=>({node:w,contexts:n.currentContext})),g=Object.assign({},this.weightMap);Object.keys(t).forEach(w=>{const[S,_]=li(w),$=[];$[_]=t[w],g[S]=$});const y={},v=this.getFrozenTensorIds(g),x={};for(;m.length>0;){const w=this.processStack(l,m,n,g,x,v,c,y,h);await Promise.all(w)}f==null&&!o&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const b=u.filter(w=>!TB(w)&&!Or(w.name,g,n)).map(w=>w.name);if(b.length>0){let w="";throw f!=null&&(w=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${p}]`),new Error(`Cannot compute the outputs [${b}] from the provided inputs [${a}]. Consider providing the following inputs: [${d}]. ${w}`)}return g}processStack(t,n,i,o,a,l,c,u,h){const d=[];for(;n.length>0;){const f=n.pop();i.currentContext=f.contexts;let p="";if(f.node.op==="Enter"&&A("isConstant",f.node,o,i)&&([p]=_a(f.node.name,i)),o[f.node.name]==null){const m=IA(f.node,o,i,this._resourceManager);p||([p]=_a(f.node.name,i));const g=i.currentContext;tf(m)?d.push(m.then(y=>(o[p]=y,i.currentContext=g,this.checkTensorForDisposal(p,f.node,o,i,l,c,u),this.processChildNodes(f.node,n,i,o,a,h),y))):(o[p]=m,this.checkTensorForDisposal(p,f.node,o,i,l,c,u),this.processChildNodes(f.node,n,i,o,a,h))}else this.processChildNodes(f.node,n,i,o,a,h)}return d}processChildNodes(t,n,i,o,a,l){t.children.forEach(c=>{const[u]=_a(c.name,i);a[u]||!l.has(c.name)||(c.op==="Merge"?c.inputNames.some(h=>!!Or(h,o,i))&&(a[u]=!0,n.push({contexts:i.currentContext,node:c})):c.inputNames.every(h=>!!Or(h,o,i))&&(a[u]=!0,n.push({contexts:i.currentContext,node:c})))})}dispose(){Object.keys(this.weightMap).forEach(t=>this.weightMap[t].forEach(n=>n.dispose()))}checkInputShapeAndType(t){Object.keys(t).forEach(n=>{const i=t[n],[o]=li(n),a=this.graph.nodes[o];if(a.attrParams.shape&&a.attrParams.shape.value){const l=a.attrParams.shape.value,c=l.length===i.shape.length&&i.shape.every((u,h)=>l[h]===-1||l[h]===u);st(c,()=>`The shape of dict['${a.name}'] provided in model.execute(dict) must be [${l}], but was [${i.shape}]`)}a.attrParams.dtype&&a.attrParams.dtype.value&&st(i.dtype===a.attrParams.dtype.value,()=>`The dtype of dict['${a.name}'] provided in model.execute(dict) must be ${a.attrParams.dtype.value}, but was ${i.dtype}`)})}mapInputs(t){const n={};for(const i in t)if(this._signature!=null&&this._signature.inputs!=null&&this._signature.inputs[i]!=null){const o=this._signature.inputs[i];n[o.name]=t[i]}else n[i]=t[i];return n}checkInputs(t){const n=Object.keys(t).filter(i=>{const[o]=li(i);return this.graph.nodes[o]==null});if(n.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${n}] that are not part of graph`)}mapOutputs(t){return t.map(n=>this._signature!=null&&this._signature.outputs!=null&&this._signature.outputs[n]!=null?this._signature.outputs[n].name:n,{})}checkOutputs(t){t.forEach(n=>{const[i]=li(n);if(!this.graph.nodes[i])throw new Error(`The output '${n}' is not found in the graph`)})}}class c7t{constructor(t={},n={}){this.hashTableNameToHandle=t,this.hashTableMap=n}addHashTable(t,n){this.hashTableNameToHandle[t]=n.handle,this.hashTableMap[n.id]=n}getHashTableHandleByName(t){return this.hashTableNameToHandle[t]}getHashTableById(t){return this.hashTableMap[t]}dispose(){for(const t in this.hashTableMap)this.hashTableMap[t].clearAndClose(),delete this.hashTableMap[t];for(const t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u7t="?tfjs-format=file",h7t="model.json";class d7t{constructor(t,n={},i=LP){this.modelUrl=t,this.loadOptions=n,this.version="n/a",this.io=i,n==null&&(this.loadOptions={}),this.resourceManager=new c7t}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}findIOHandler(){const t=this.modelUrl;if(t.load!=null)this.handler=t;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(t,this.loadOptions);else{const n=this.io.getLoadHandlers(t,this.loadOptions);if(n.length===0)n.push(this.io.browserHTTPRequest(t,this.loadOptions));else if(n.length>1)throw new Error(`Found more than one (${n.length}) load handlers for URL '${[t]}'`);this.handler=n[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const t=this.handler.load();return tf(t)?t.then(n=>this.loadSync(n)):this.loadSync(t)}loadSync(t){this.artifacts=t;const n=this.artifacts.modelTopology;let i=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const a=this.artifacts.userDefinedMetadata;a.signature!=null&&(i=a.signature),a.structuredOutputKeys!=null&&(this.structuredOutputKeys=a.structuredOutputKeys)}this.signature=i,this.version=`${n.versions.producer}.${n.versions.minConsumer}`;const o=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new z2(TA.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(o),this.executor.resourceManager=this.resourceManager,t.modelInitializer!=null&&t.modelInitializer.node!=null){const a=TA.Instance.transformGraph(t.modelInitializer);this.initializer=new z2(a),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(t,n){if(typeof t=="string"){const i=this.io.getSaveHandlers(t);if(i.length===0)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(i.length>1)throw new Error(`Found more than one (${i.length}) save handlers for URL '${t}'`);t=i[0]}if(t.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)}predict(t,n){const i=this.execute(t,this.outputNodes);if(this.structuredOutputKeys){const o=i instanceof us?[i]:i,a={};return o.forEach((l,c)=>a[this.structuredOutputKeys[c]]=l),a}return i}normalizeInputs(t){if(!(t instanceof us)&&!Array.isArray(t))return t;if(t=Array.isArray(t)?t:[t],t.length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${t.length} input tensors.`);return this.inputNodes.reduce((n,i,o)=>(n[i]=t[o],n),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}execute(t,n){t=this.normalizeInputs(t),n=this.normalizeOutputs(n);const i=this.executor.execute(t,n);return i.length>1?i:i[0]}async executeAsync(t,n){t=this.normalizeInputs(t),n=this.normalizeOutputs(n);const i=await this.executor.executeAsync(t,n);return i.length>1?i:i[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce((n,i)=>(n[i]=[t[i]],n),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function CB(r,t={},n=LP){if(r==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");t==null&&(t={}),t.fromTFHub&&typeof r=="string"&&(r=f7t(r));const i=new d7t(r,t,n);return await i.load(),i}function f7t(r){return r.endsWith("/")||(r=r+"/"),`${r}${h7t}${u7t}`}/**
    * @license
    * Copyright 2022 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */var Jo=function(){return Jo=Object.assign||function(r){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o]);return r},Jo.apply(this,arguments)};function dl(r,t,n,i){return new(n||(n=Promise))(function(o,a){function l(h){try{u(i.next(h))}catch(d){a(d)}}function c(h){try{u(i.throw(h))}catch(d){a(d)}}function u(h){var d;h.done?o(h.value):(d=h.value,d instanceof n?d:new n(function(f){f(d)})).then(l,c)}u((i=i.apply(r,t||[])).next())})}function fl(r,t){var n,i,o,a,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(u){return function(h){return function(d){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,i&&(o=2&d[0]?i.return:d[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,d[1])).done)return o;switch(i=0,o&&(d=[2&d[0],o.value]),d[0]){case 0:case 1:o=d;break;case 4:return l.label++,{value:d[1],done:!1};case 5:l.label++,i=d[1],d=[0];continue;case 7:d=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!((o=o.length>0&&o[o.length-1])||d[0]!==6&&d[0]!==2)){l=0;continue}if(d[0]===3&&(!o||d[1]>o[0]&&d[1]<o[3])){l.label=d[1];break}if(d[0]===6&&l.label<o[1]){l.label=o[1],o=d;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(d);break}o[2]&&l.ops.pop(),l.trys.pop();continue}d=t.call(r,l)}catch(f){d=[6,f],i=0}finally{n=o=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([u,h])}}}function Kl(r){var t=r.map(function(n){return n[0]});return t.push(r[r.length-1][1]),t}var p7t={lips:Kl([[61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]]),leftEye:Kl([[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]]),leftEyebrow:Kl([[276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]]),leftIris:Kl([[474,475],[475,476],[476,477],[477,474]]),rightEye:Kl([[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]]),rightEyebrow:Kl([[46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]]),rightIris:Kl([[469,470],[470,471],[471,472],[472,469]]),faceOval:Kl([[10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]])},m7t=Object.entries(p7t).map(function(r){var t=r[0];return r[1].map(function(n){return[n,t]})}).flat(),kB=new Map(m7t);function cS(r){for(var t={locationData:{relativeKeypoints:[]}},n=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,a=Number.MIN_SAFE_INTEGER,l=0;l<r.length;++l){var c=r[l];n=Math.min(n,c.x),i=Math.max(i,c.x),o=Math.min(o,c.y),a=Math.max(a,c.y),t.locationData.relativeKeypoints.push({x:c.x,y:c.y})}return t.locationData.relativeBoundingBox={xMin:n,yMin:o,xMax:i,yMax:a,width:i-n,height:a-o},t}var Fb={runtime:"mediapipe",maxFaces:1,refineLandmarks:!1},g7t=function(){function r(t){var n=this;this.width=0,this.height=0,this.selfieMode=!1,this.faceMeshSolution=new jkt.FaceMesh({locateFile:function(i,o){return t.solutionPath?t.solutionPath.replace(/\/+$/,"")+"/"+i:o+"/"+i}}),this.faceMeshSolution.setOptions({refineLandmarks:t.refineLandmarks,selfieMode:this.selfieMode,maxNumFaces:t.maxFaces}),this.faceMeshSolution.onResults(function(i){if(n.height=i.image.height,n.width=i.image.width,n.faces=[],i.multiFaceLandmarks!==null)for(var o=i.multiFaceLandmarks,a=0;a<o.length;a++){var l=n.translateOutput(o[a]);n.faces.push({keypoints:l,box:cS(l).locationData.relativeBoundingBox})}})}return r.prototype.translateOutput=function(t){var n=this;return t.map(function(i,o){var a={x:i.x*n.width,y:i.y*n.height,z:i.z*n.width},l=kB.get(o);return l!=null&&(a.name=l),a})},r.prototype.estimateFaces=function(t,n){return dl(this,void 0,void 0,function(){var i,o;return fl(this,function(a){switch(a.label){case 0:return n&&n.flipHorizontal&&n.flipHorizontal!==this.selfieMode&&(this.selfieMode=n.flipHorizontal,this.faceMeshSolution.setOptions({selfieMode:this.selfieMode})),t instanceof us?(o=ImageData.bind,[4,PP(t)]):[3,2];case 1:return i=new(o.apply(ImageData,[void 0,a.sent(),t.shape[1],t.shape[0]])),[3,3];case 2:i=t,a.label=3;case 3:return t=i,[4,this.faceMeshSolution.send({image:t})];case 4:return a.sent(),[2,this.faces]}})})},r.prototype.dispose=function(){this.faceMeshSolution.close()},r.prototype.reset=function(){this.faceMeshSolution.reset(),this.width=0,this.height=0,this.faces=null,this.selfieMode=!1},r.prototype.initialize=function(){return this.faceMeshSolution.initialize()},r}();function v7t(r){return dl(this,void 0,void 0,function(){var t,n;return fl(this,function(i){switch(i.label){case 0:return t=function(o){if(o==null)return Jo({},Fb);var a=Jo({},o);return a.runtime="mediapipe",a.maxFaces==null&&(a.maxFaces=Fb.maxFaces),a.refineLandmarks==null&&(a.refineLandmarks=Fb.refineLandmarks),a}(r),[4,(n=new g7t(t)).initialize()];case 1:return i.sent(),[2,n]}})})}var Pb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},y7t={};(function(){var r;function t(T){var M=0;return function(){return M<T.length?{done:!1,value:T[M++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(T,M,P){return T==Array.prototype||T==Object.prototype||(T[M]=P.value),T},i=function(T){T=[typeof globalThis=="object"&&globalThis,T,typeof window=="object"&&window,typeof self=="object"&&self,typeof Pb=="object"&&Pb];for(var M=0;M<T.length;++M){var P=T[M];if(P&&P.Math==Math)return P}throw Error("Cannot find global object")}(this);function o(T,M){if(M)t:{var P=i;T=T.split(".");for(var z=0;z<T.length-1;z++){var Q=T[z];if(!(Q in P))break t;P=P[Q]}(M=M(z=P[T=T[T.length-1]]))!=z&&M!=null&&n(P,T,{configurable:!0,writable:!0,value:M})}}function a(T){return(T={next:T})[Symbol.iterator]=function(){return this},T}function l(T){var M=typeof Symbol<"u"&&Symbol.iterator&&T[Symbol.iterator];return M?M.call(T):{next:t(T)}}function c(T){if(!(T instanceof Array)){T=l(T);for(var M,P=[];!(M=T.next()).done;)P.push(M.value);T=P}return T}o("Symbol",function(T){function M(Q,X){this.g=Q,n(this,"description",{configurable:!0,writable:!0,value:X})}if(T)return T;M.prototype.toString=function(){return this.g};var P="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",z=0;return function Q(X){if(this instanceof Q)throw new TypeError("Symbol is not a constructor");return new M(P+(X||"")+"_"+z++,X)}}),o("Symbol.iterator",function(T){if(T)return T;T=Symbol("Symbol.iterator");for(var M="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),P=0;P<M.length;P++){var z=i[M[P]];typeof z=="function"&&typeof z.prototype[T]!="function"&&n(z.prototype,T,{configurable:!0,writable:!0,value:function(){return a(t(this))}})}return T});var u,h=typeof Object.create=="function"?Object.create:function(T){function M(){}return M.prototype=T,new M};if(typeof Object.setPrototypeOf=="function")u=Object.setPrototypeOf;else{var d;t:{var f={};try{f.__proto__={a:!0},d=f.a;break t}catch{}d=!1}u=d?function(T,M){if(T.__proto__=M,T.__proto__!==M)throw new TypeError(T+" is not extensible");return T}:null}var p=u;function m(T,M){if(T.prototype=h(M.prototype),T.prototype.constructor=T,p)p(T,M);else for(var P in M)if(P!="prototype")if(Object.defineProperties){var z=Object.getOwnPropertyDescriptor(M,P);z&&Object.defineProperty(T,P,z)}else T[P]=M[P];T.na=M.prototype}function g(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.u=this.o=0,this.j=null}function y(T){if(T.l)throw new TypeError("Generator is already running");T.l=!0}function v(T,M){T.j={da:M,ea:!0},T.g=T.o||T.u}function x(T,M,P){return T.g=P,{value:M}}function b(T){this.g=new g,this.h=T}function w(T,M,P,z){try{var Q=M.call(T.g.i,P);if(!(Q instanceof Object))throw new TypeError("Iterator result "+Q+" is not an object");if(!Q.done)return T.g.l=!1,Q;var X=Q.value}catch(nt){return T.g.i=null,v(T.g,nt),S(T)}return T.g.i=null,z.call(T.g,X),S(T)}function S(T){for(;T.g.g;)try{var M=T.h(T.g);if(M)return T.g.l=!1,{value:M.value,done:!1}}catch(P){T.g.h=void 0,v(T.g,P)}if(T.g.l=!1,T.g.j){if(M=T.g.j,T.g.j=null,M.ea)throw M.da;return{value:M.return,done:!0}}return{value:void 0,done:!0}}function _(T){this.next=function(M){return y(T.g),T.g.i?M=w(T,T.g.i.next,M,T.g.s):(T.g.s(M),M=S(T)),M},this.throw=function(M){return y(T.g),T.g.i?M=w(T,T.g.i.throw,M,T.g.s):(v(T.g,M),M=S(T)),M},this.return=function(M){return function(P,z){y(P.g);var Q=P.g.i;return Q?w(P,"return"in Q?Q.return:function(X){return{value:X,done:!0}},z,P.g.return):(P.g.return(z),S(P))}(T,M)},this[Symbol.iterator]=function(){return this}}function $(T){return function(M){function P(Q){return M.next(Q)}function z(Q){return M.throw(Q)}return new Promise(function(Q,X){(function nt(at){at.done?Q(at.value):Promise.resolve(at.value).then(P,z).then(nt,X)})(M.next())})}(new _(new b(T)))}g.prototype.s=function(T){this.h=T},g.prototype.return=function(T){this.j={return:T},this.g=this.u},o("Promise",function(T){function M(nt){this.h=0,this.i=void 0,this.g=[],this.s=!1;var at=this.j();try{nt(at.resolve,at.reject)}catch(Ct){at.reject(Ct)}}function P(){this.g=null}function z(nt){return nt instanceof M?nt:new M(function(at){at(nt)})}if(T)return T;P.prototype.h=function(nt){if(this.g==null){this.g=[];var at=this;this.i(function(){at.l()})}this.g.push(nt)};var Q=i.setTimeout;P.prototype.i=function(nt){Q(nt,0)},P.prototype.l=function(){for(;this.g&&this.g.length;){var nt=this.g;this.g=[];for(var at=0;at<nt.length;++at){var Ct=nt[at];nt[at]=null;try{Ct()}catch(Ot){this.j(Ot)}}}this.g=null},P.prototype.j=function(nt){this.i(function(){throw nt})},M.prototype.j=function(){function nt(Ot){return function(Ut){Ct||(Ct=!0,Ot.call(at,Ut))}}var at=this,Ct=!1;return{resolve:nt(this.D),reject:nt(this.l)}},M.prototype.D=function(nt){if(nt===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(nt instanceof M)this.H(nt);else{t:switch(typeof nt){case"object":var at=nt!=null;break t;case"function":at=!0;break t;default:at=!1}at?this.A(nt):this.o(nt)}},M.prototype.A=function(nt){var at=void 0;try{at=nt.then}catch(Ct){return void this.l(Ct)}typeof at=="function"?this.I(at,nt):this.o(nt)},M.prototype.l=function(nt){this.u(2,nt)},M.prototype.o=function(nt){this.u(1,nt)},M.prototype.u=function(nt,at){if(this.h!=0)throw Error("Cannot settle("+nt+", "+at+"): Promise already settled in state"+this.h);this.h=nt,this.i=at,this.h===2&&this.G(),this.B()},M.prototype.G=function(){var nt=this;Q(function(){if(nt.C()){var at=i.console;at!==void 0&&at.error(nt.i)}},1)},M.prototype.C=function(){if(this.s)return!1;var nt=i.CustomEvent,at=i.Event,Ct=i.dispatchEvent;return Ct===void 0||(typeof nt=="function"?nt=new nt("unhandledrejection",{cancelable:!0}):typeof at=="function"?nt=new at("unhandledrejection",{cancelable:!0}):(nt=i.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,nt),nt.promise=this,nt.reason=this.i,Ct(nt))},M.prototype.B=function(){if(this.g!=null){for(var nt=0;nt<this.g.length;++nt)X.h(this.g[nt]);this.g=null}};var X=new P;return M.prototype.H=function(nt){var at=this.j();nt.M(at.resolve,at.reject)},M.prototype.I=function(nt,at){var Ct=this.j();try{nt.call(at,Ct.resolve,Ct.reject)}catch(Ot){Ct.reject(Ot)}},M.prototype.then=function(nt,at){function Ct(ee,he){return typeof ee=="function"?function(Ve){try{Ot(ee(Ve))}catch(Ze){Ut(Ze)}}:he}var Ot,Ut,Qt=new M(function(ee,he){Ot=ee,Ut=he});return this.M(Ct(nt,Ot),Ct(at,Ut)),Qt},M.prototype.catch=function(nt){return this.then(void 0,nt)},M.prototype.M=function(nt,at){function Ct(){switch(Ot.h){case 1:nt(Ot.i);break;case 2:at(Ot.i);break;default:throw Error("Unexpected state: "+Ot.h)}}var Ot=this;this.g==null?X.h(Ct):this.g.push(Ct),this.s=!0},M.resolve=z,M.reject=function(nt){return new M(function(at,Ct){Ct(nt)})},M.race=function(nt){return new M(function(at,Ct){for(var Ot=l(nt),Ut=Ot.next();!Ut.done;Ut=Ot.next())z(Ut.value).M(at,Ct)})},M.all=function(nt){var at=l(nt),Ct=at.next();return Ct.done?z([]):new M(function(Ot,Ut){function Qt(Ve){return function(Ze){ee[Ve]=Ze,--he==0&&Ot(ee)}}var ee=[],he=0;do ee.push(void 0),he++,z(Ct.value).M(Qt(ee.length-1),Ut),Ct=at.next();while(!Ct.done)})},M});var N=typeof Object.assign=="function"?Object.assign:function(T,M){for(var P=1;P<arguments.length;P++){var z=arguments[P];if(z)for(var Q in z)Object.prototype.hasOwnProperty.call(z,Q)&&(T[Q]=z[Q])}return T};o("Object.assign",function(T){return T||N}),o("Object.is",function(T){return T||function(M,P){return M===P?M!==0||1/M==1/P:M!=M&&P!=P}}),o("Array.prototype.includes",function(T){return T||function(M,P){var z=this;z instanceof String&&(z=String(z));var Q=z.length;for(0>(P=P||0)&&(P=Math.max(P+Q,0));P<Q;P++){var X=z[P];if(X===M||Object.is(X,M))return!0}return!1}}),o("String.prototype.includes",function(T){return T||function(M,P){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(M instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(M,P||0)!==-1}}),o("Array.prototype.keys",function(T){return T||function(){return function(M,P){M instanceof String&&(M+="");var z=0,Q=!1,X={next:function(){if(!Q&&z<M.length){var nt=z++;return{value:P(nt,M[nt]),done:!1}}return Q=!0,{done:!0,value:void 0}}};return X[Symbol.iterator]=function(){return X},X}(this,function(M){return M})}});var k=this||self;function I(T,M){T=T.split(".");var P,z=k;for((T[0]in z)||z.execScript===void 0||z.execScript("var "+T[0]);T.length&&(P=T.shift());)T.length||M===void 0?z=z[P]&&z[P]!==Object.prototype[P]?z[P]:z[P]={}:z[P]=M}function O(){throw Error("Invalid UTF8")}function B(T,M){return M=String.fromCharCode.apply(null,M),T==null?M:T+M}var F,D,L=typeof TextDecoder<"u",V=typeof TextEncoder<"u",j={},Y=null;function H(T){var M;M===void 0&&(M=0),it(),M=j[M];for(var P=Array(Math.floor(T.length/3)),z=M[64]||"",Q=0,X=0;Q<T.length-2;Q+=3){var nt=T[Q],at=T[Q+1],Ct=T[Q+2],Ot=M[nt>>2];nt=M[(3&nt)<<4|at>>4],at=M[(15&at)<<2|Ct>>6],Ct=M[63&Ct],P[X++]=Ot+nt+at+Ct}switch(Ot=0,Ct=z,T.length-Q){case 2:Ct=M[(15&(Ot=T[Q+1]))<<2]||z;case 1:T=T[Q],P[X]=M[T>>2]+M[(3&T)<<4|Ot>>4]+Ct+z}return P.join("")}function et(T){var M=T.length,P=3*M/4;P%3?P=Math.floor(P):"=.".indexOf(T[M-1])!=-1&&(P="=.".indexOf(T[M-2])!=-1?P-2:P-1);var z=new Uint8Array(P),Q=0;return function(X,nt){function at(he){for(;Ct<X.length;){var Ve=X.charAt(Ct++),Ze=Y[Ve];if(Ze!=null)return Ze;if(!/^[\s\xa0]*$/.test(Ve))throw Error("Unknown base64 encoding at char: "+Ve)}return he}it();for(var Ct=0;;){var Ot=at(-1),Ut=at(0),Qt=at(64),ee=at(64);if(ee===64&&Ot===-1)break;nt(Ot<<2|Ut>>4),Qt!=64&&(nt(Ut<<4&240|Qt>>2),ee!=64&&nt(Qt<<6&192|ee))}}(T,function(X){z[Q++]=X}),Q!==P?z.subarray(0,Q):z}function it(){if(!Y){Y={};for(var T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),M=["+/=","+/","-_=","-_.","-_"],P=0;5>P;P++){var z=T.concat(M[P].split(""));j[P]=z;for(var Q=0;Q<z.length;Q++){var X=z[Q];Y[X]===void 0&&(Y[X]=Q)}}}}var J,rt=typeof Uint8Array=="function";function ut(T){return rt&&T!=null&&T instanceof Uint8Array}function vt(T){if(this.L=T,T!==null&&T.length===0)throw Error("ByteString should be constructed with non-empty values")}var bt=typeof Uint8Array.prototype.slice=="function",ht=0;function Wt(T,M){return Error("Invalid wire type: "+T+" (at position "+M+")")}function Dt(){return Error("Failed to read varint, encoding is invalid.")}function Vt(T,M){M=(M=M===void 0?{}:M).v!==void 0&&M.v,this.h=null,this.g=this.i=this.j=0,this.v=M,T&&zt(this,T)}function zt(T,M){T.h=function(P,z){if(P.constructor===Uint8Array)return P;if(P.constructor===ArrayBuffer)return new Uint8Array(P);if(P.constructor===Array)return new Uint8Array(P);if(P.constructor===String)return et(P);if(P.constructor===vt)return!z&&(z=P.L)&&z.constructor===Uint8Array?z:(z=(z=P.L)==null||ut(z)?z:typeof z=="string"?et(z):null,(P=P.L=z)?new Uint8Array(P):J||(J=new Uint8Array(0)));if(P instanceof Uint8Array)return new Uint8Array(P.buffer,P.byteOffset,P.byteLength);throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, or Array of numbers")}(M,T.v),T.j=0,T.i=T.h.length,T.g=T.j}function Jt(T){if(T.g>T.i)throw Error("Tried to read past the end of the data "+T.g+" > "+T.i)}function oe(T){var M=T.h,P=M[T.g],z=127&P;if(128>P)return T.g+=1,Jt(T),z;if(z|=(127&(P=M[T.g+1]))<<7,128>P)return T.g+=2,Jt(T),z;if(z|=(127&(P=M[T.g+2]))<<14,128>P)return T.g+=3,Jt(T),z;if(z|=(127&(P=M[T.g+3]))<<21,128>P)return T.g+=4,Jt(T),z;if(P=M[T.g+4],T.g+=5,z|=(15&P)<<28,128>P)return Jt(T),z;if(128<=M[T.g++]&&128<=M[T.g++]&&128<=M[T.g++]&&128<=M[T.g++]&&128<=M[T.g++])throw Dt();return Jt(T),z}Vt.prototype.reset=function(){this.g=this.j};var ne=[];function Oe(){this.g=[]}function Ae(T,M){for(;127<M;)T.g.push(127&M|128),M>>>=7;T.g.push(M)}function Ee(T){var M={},P=M.W!==void 0&&M.W;this.l={v:M.v!==void 0&&M.v},this.W=P,M=this.l,ne.length?(P=ne.pop(),M&&(P.v=M.v),T&&zt(P,T),T=P):T=new Vt(T,M),this.g=T,this.j=this.g.g,this.h=this.i=-1}function We(T){var M=T.g;if(M.g==M.i)return!1;T.j=T.g.g;var P=oe(T.g)>>>0;if(M=P>>>3,!(0<=(P&=7)&&5>=P))throw Wt(P,T.j);if(1>M)throw Error("Invalid field number: "+M+" (at position "+T.j+")");return T.i=M,T.h=P,!0}function Ne(T){switch(T.h){case 0:if(T.h!=0)Ne(T);else t:{for(var M=(T=T.g).g,P=M+10;M<P;)if(!(128&T.h[M++])){T.g=M,Jt(T);break t}throw Dt()}break;case 1:(T=T.g).g+=8,Jt(T);break;case 2:T.h!=2?Ne(T):(M=oe(T.g)>>>0,(T=T.g).g+=M,Jt(T));break;case 5:(T=T.g).g+=4,Jt(T);break;case 3:for(M=T.i;;){if(!We(T))throw Error("Unmatched start-group tag: stream EOF");if(T.h==4){if(T.i!=M)throw Error("Unmatched end-group tag");break}Ne(T)}break;default:throw Wt(T.h,T.j)}}Oe.prototype.length=function(){return this.g.length},Oe.prototype.end=function(){var T=this.g;return this.g=[],T},Ee.prototype.reset=function(){this.g.reset(),this.j=this.g.g,this.h=this.i=-1};var Le=[];function yn(){this.i=[],this.h=0,this.g=new Oe}function Qe(T,M){M.length!==0&&(T.i.push(M),T.h+=M.length)}var Z=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol(void 0):void 0;function G(T,M){Object.isFrozen(T)||(Z?T[Z]|=M:T.N!==void 0?T.N|=M:Object.defineProperties(T,{N:{value:M,configurable:!0,writable:!0,enumerable:!1}}))}function Et(T){var M;return(M=Z?T[Z]:T.N)==null?0:M}function jt(T){return G(T,1),T}function qt(T){return!!Array.isArray(T)&&!!(2&Et(T))}function te(T){if(!Array.isArray(T))throw Error("cannot mark non-array as immutable");G(T,2)}function ye(T){return T!==null&&typeof T=="object"&&!Array.isArray(T)&&T.constructor===Object}var se=Object.freeze(jt([]));function Lt(T){if(qt(T.m))throw Error("Cannot mutate an immutable Message")}var ke,Me=typeof Symbol<"u"&&Symbol.hasInstance!==void 0;function xe(T){return{value:T,configurable:!1,writable:!1,enumerable:!1}}function ge(T,M,P){return M===-1?null:M>=T.i?T.g?T.g[M]:void 0:P!==void 0&&P&&T.g&&(P=T.g[M])!=null?P:T.m[M+T.h]}function ae(T,M,P,z){z=z!==void 0&&z,Lt(T),M<T.i&&!z?T.m[M+T.h]=P:(T.g||(T.g=T.m[T.i+T.h]={}))[M]=P}function De(T,M,P,z){P=P===void 0||P;var Q=ge(T,M,z=z!==void 0&&z);return Q==null&&(Q=se),qt(T.m)?P&&(te(Q),Object.freeze(Q)):(Q===se||qt(Q))&&ae(T,M,Q=jt(Q.slice()),z),Q}function tn(T,M,P){return(T=(T=ge(T,M))==null?T:+T)==null?P===void 0?0:P:T}function Yn(T,M,P,z){T.j||(T.j={});var Q=qt(T.m),X=T.j[P];if(!X){z=De(T,P,!0,z!==void 0&&z),X=[],Q=Q||qt(z);for(var nt=0;nt<z.length;nt++)X[nt]=new M(z[nt]),Q&&te(X[nt].m);Q&&(te(X),Object.freeze(X)),T.j[P]=X}return X}function lt(T,M,P,z,Q){var X=X!==void 0&&X;return Lt(T),X=Yn(T,P,M,X),P=z||new P,T=De(T,M),Q!=null?(X.splice(Q,0,P),T.splice(Q,0,P.m)):(X.push(P),T.push(P.m)),P}function At(T,M){return(T=ge(T,M))==null?0:T}function Yt(T,M){return(T=ge(T,M))==null?"":T}function le(T){var M=gs;return me(T,M=M===void 0?vs:M)}function ve(T,M){if(T!=null){if(Array.isArray(T))T=me(T,M);else if(ye(T)){var P,z={};for(P in T)z[P]=ve(T[P],M);T=z}else T=M(T);return T}}function me(T,M){for(var P=T.slice(),z=0;z<P.length;z++)P[z]=ve(P[z],M);return Array.isArray(T)&&1&Et(T)&&jt(P),P}function gs(T){return T&&typeof T=="object"&&T.toJSON?T.toJSON():(T=function(M){switch(typeof M){case"number":return isFinite(M)?M:String(M);case"object":if(M&&!Array.isArray(M)){if(ut(M))return H(M);if(M instanceof vt){var P=M.L;return P=P==null||typeof P=="string"?P:rt&&P instanceof Uint8Array?H(P):null,(M.L=P)||""}}}return M}(T),Array.isArray(T)?le(T):T)}function vs(T){return ut(T)?new Uint8Array(T):T}function Wr(T,M,P){T||(T=ke),ke=null;var z=this.constructor.h;if(T||(T=z?[z]:[]),this.h=(z?0:-1)-(this.constructor.g||0),this.j=void 0,this.m=T,T=(z=this.m.length)-1,z&&ye(z=this.m[T])?(this.i=T-this.h,this.g=z):M!==void 0&&-1<M?(this.i=Math.max(M,T+1-this.h),this.g=void 0):this.i=Number.MAX_VALUE,P)for(M=0;M<P.length;M++)if((T=P[M])<this.i)T+=this.h,(z=this.m[T])?Array.isArray(z)&&jt(z):this.m[T]=se;else{var Q=(z=this.g||(this.g=this.m[this.i+this.h]={}))[T];Q?Array.isArray(Q)&&jt(Q):z[T]=se}}function En(){Wr.apply(this,arguments)}if(Wr.prototype.toJSON=function(){return le(this.m)},Wr.prototype.toString=function(){return this.m.toString()},m(En,Wr),Me){var Es={};Object.defineProperties(En,(Es[Symbol.hasInstance]=xe(function(){throw Error("Cannot perform instanceof checks for MutableMessage")}),Es))}function Ps(T,M,P){if(P){var z,Q={};for(z in P){var X=P[z],nt=X.ha;nt||(Q.F=X.la||X.fa.P,X.aa?(Q.U=Mt(X.aa),nt=function(at){return function(Ct,Ot,Ut){return at.F(Ct,Ot,Ut,at.U)}}(Q)):X.ca?(Q.T=wt(X.X.g,X.ca),nt=function(at){return function(Ct,Ot,Ut){return at.F(Ct,Ot,Ut,at.T)}}(Q)):nt=Q.F,X.ha=nt),nt(M,T,X.X),Q={F:Q.F,U:Q.U,T:Q.T}}}(function(at,Ct){if(Ct=Ct.ba){Qe(at,at.g.end());for(var Ot=0;Ot<Ct.length;Ot++)Qe(at,Ct[Ot])}})(M,T)}var Cr=Symbol();function Gi(T,M,P){return T[Cr]||(T[Cr]=function(z,Q){return M(z,Q,P)})}function Nh(T){var M=T[Cr];if(!M){var P=Hi(T);M=function(z,Q){return Zn(z,Q,P)},T[Cr]=M}return M}function Of(T){var M=function(Q){var X=Q.aa;return X?Nh(X):(X=Q.ka)?Gi(Q.X.g,X,Q.ca):void 0}(T),P=T.X,z=T.fa.O;return M?function(Q,X){return z(Q,X,P,M)}:function(Q,X){return z(Q,X,P)}}function q(T,M,P,z,Q,X){var nt=0;for((T=T()).length&&typeof T[0]!="number"&&(P(M,T[0]),nt++);nt<T.length;){P=T[nt++];for(var at=nt+1;at<T.length&&typeof T[at]!="number";)at++;var Ct=T[nt++];switch(at-=nt){case 0:z(M,P,Ct);break;case 1:z(M,P,Ct,T[nt++]);break;case 2:Q(M,P,Ct,T[nt++],T[nt++]);break;case 3:at=T[nt++];var Ot=T[nt++],Ut=T[nt++];Array.isArray(Ut)?Q(M,P,Ct,at,Ot,Ut):X(M,P,Ct,at,Ot,Ut);break;case 4:X(M,P,Ct,T[nt++],T[nt++],T[nt++],T[nt++]);break;default:throw Error("unexpected number of binary field arguments: "+at)}}return M}var St=Symbol();function Mt(T){var M=T[St];if(!M){var P=fn(T);M=function(z,Q){return Wa(z,Q,P)},T[St]=M}return M}function wt(T,M){var P=T[St];return P||(P=function(z,Q){return Ps(z,Q,M)},T[St]=P),P}var Ft=Symbol();function Ce(T,M){T.push(M)}function Be(T,M,P){T.push(M,P.P)}function Ke(T,M,P,z,Q){var X=Mt(Q),nt=P.P;T.push(M,function(at,Ct,Ot){return nt(at,Ct,Ot,z,X)})}function Xe(T,M,P,z,Q,X){var nt=wt(z,X),at=P.P;T.push(M,function(Ct,Ot,Ut){return at(Ct,Ot,Ut,z,nt)})}function fn(T){var M=T[Ft];return M||q(T,T[Ft]=[],Ce,Be,Ke,Xe)}var Ye=Symbol();function He(T,M){T[0]=M}function ls(T,M,P,z){var Q=P.O;T[M]=z?function(X,nt,at){return Q(X,nt,at,z)}:Q}function mr(T,M,P,z,Q,X){var nt=P.O,at=Nh(Q);T[M]=function(Ct,Ot,Ut){return nt(Ct,Ot,Ut,z,at,X)}}function kr(T,M,P,z,Q,X,nt){var at=P.O,Ct=Gi(z,Q,X);T[M]=function(Ot,Ut,Qt){return at(Ot,Ut,Qt,z,Ct,nt)}}function Hi(T){var M=T[Ye];return M||q(T,T[Ye]={},He,ls,mr,kr)}function Zn(T,M,P){for(;We(M)&&M.h!=4;){var z=M.i,Q=P[z];if(!Q){var X=P[0];X&&(X=X[z])&&(Q=P[z]=Of(X))}if(!(Q&&Q(M,T,z)||(Q=M,z=T,X=Q.j,Ne(Q),Q.W))){var nt=Q.g.h;Q=X===(Q=Q.g.g)?J||(J=new Uint8Array(0)):bt?nt.slice(X,Q):new Uint8Array(nt.subarray(X,Q)),(X=z.ba)?X.push(Q):z.ba=[Q]}}return T}function en(T,M,P){if(Le.length){var z=Le.pop();T&&(zt(z.g,T),z.i=-1,z.h=-1),T=z}else T=new Ee(T);try{return Zn(new M,T,Hi(P))}finally{(M=T.g).h=null,M.j=0,M.i=0,M.g=0,M.v=!1,T.i=-1,T.h=-1,100>Le.length&&Le.push(T)}}function Wa(T,M,P){for(var z=P.length,Q=z%2==1,X=Q?1:0;X<z;X+=2)(0,P[X+1])(M,T,P[X]);Ps(T,M,Q?P[0]:void 0)}function Jn(T,M){var P=new yn;Wa(T,P,fn(M)),Qe(P,P.g.end()),T=new Uint8Array(P.h);for(var z=(M=P.i).length,Q=0,X=0;X<z;X++){var nt=M[X];T.set(nt,Q),Q+=nt.length}return P.i=[T],T}function $r(T,M){return{O:T,P:M}}var Ir=$r(function(T,M,P){if(T.h!==5)return!1;var z=(T=T.g).h[T.g],Q=T.h[T.g+1],X=T.h[T.g+2],nt=T.h[T.g+3];return T.g+=4,Jt(T),T=2*((Q=(z<<0|Q<<8|X<<16|nt<<24)>>>0)>>31)+1,z=Q>>>23&255,Q&=8388607,ae(M,P,z==255?Q?NaN:1/0*T:z==0?T*Math.pow(2,-149)*Q:T*Math.pow(2,z-150)*(Q+Math.pow(2,23))),!0},function(T,M,P){if((M=ge(M,P))!=null){Ae(T.g,8*P+5),T=T.g;var z=M;(z=(P=0>z?1:0)?-z:z)===0?0<1/z?ht=0:ht=2147483648:isNaN(z)?ht=2147483647:34028234663852886e22<z?ht=(P<<31|2139095040)>>>0:11754943508222875e-54>z?(z=Math.round(z/Math.pow(2,-149)),ht=(P<<31|z)>>>0):(M=Math.floor(Math.log(z)/Math.LN2),z*=Math.pow(2,-M),16777216<=(z=Math.round(8388608*z))&&++M,ht=(P<<31|M+127<<23|8388607&z)>>>0),P=ht,T.g.push(P>>>0&255),T.g.push(P>>>8&255),T.g.push(P>>>16&255),T.g.push(P>>>24&255)}}),Ga=$r(function(T,M,P){if(T.h!==0)return!1;for(var z=T.g,Q=128,X=0,nt=T=0;4>nt&&128<=Q;nt++)Q=z.h[z.g++],Jt(z),X|=(127&Q)<<7*nt;if(128<=Q&&(Q=z.h[z.g++],Jt(z),X|=(127&Q)<<28,T|=(127&Q)>>4),128<=Q)for(nt=0;5>nt&&128<=Q;nt++)Q=z.h[z.g++],Jt(z),T|=(127&Q)<<7*nt+3;if(!(128>Q))throw Dt();return z=X>>>0,(T=2147483648&(Q=T>>>0))&&(Q=~Q>>>0,(z=1+~z>>>0)==0&&(Q=Q+1>>>0)),z=4294967296*Q+(z>>>0),ae(M,P,T?-z:z),!0},function(T,M,P){if((M=ge(M,P))!=null&&M!=null){Ae(T.g,8*P),T=T.g;var z=M;for(P=0>z,M=(z=Math.abs(z))>>>0,z=Math.floor((z-M)/4294967296),z>>>=0,P&&(z=~z>>>0,4294967295<(M=1+(~M>>>0))&&(M=0,4294967295<++z&&(z=0))),P=ht=M,M=z;0<M||127<P;)T.g.push(127&P|128),P=(P>>>7|M<<25)>>>0,M>>>=7;T.g.push(P)}}),Zc=$r(function(T,M,P){return T.h===0&&(ae(M,P,oe(T.g)),!0)},function(T,M,P){if((M=ge(M,P))!=null&&M!=null)if(Ae(T.g,8*P),T=T.g,0<=(P=M))Ae(T,P);else{for(M=0;9>M;M++)T.g.push(127&P|128),P>>=7;T.g.push(1)}}),Ns=$r(function(T,M,P){if(T.h!==2)return!1;var z,Q=oe(T.g)>>>0,X=(T=T.g).g;if(T.g+=Q,Jt(T),T=T.h,L)(z=F)||(z=F=new TextDecoder("utf-8",{fatal:!0})),z=z.decode(T.subarray(X,X+Q));else{Q=X+Q;for(var nt,at,Ct,Ot=[],Ut=null;X<Q;)128>(nt=T[X++])?Ot.push(nt):224>nt?X>=Q?O():(at=T[X++],194>nt||(192&at)!=128?(X--,O()):Ot.push((31&nt)<<6|63&at)):240>nt?X>=Q-1?O():(192&(at=T[X++]))!=128||nt===224&&160>at||nt===237&&160<=at||(192&(z=T[X++]))!=128?(X--,O()):Ot.push((15&nt)<<12|(63&at)<<6|63&z):244>=nt?X>=Q-2?O():(192&(at=T[X++]))!=128||at-144+(nt<<28)>>30||(192&(z=T[X++]))!=128||(192&(Ct=T[X++]))!=128?(X--,O()):(nt=(7&nt)<<18|(63&at)<<12|(63&z)<<6|63&Ct,nt-=65536,Ot.push(55296+(nt>>10&1023),56320+(1023&nt))):O(),8192<=Ot.length&&(Ut=B(Ut,Ot),Ot.length=0);z=B(Ut,Ot)}return ae(M,P,z),!0},function(T,M,P){if((M=ge(M,P))!=null){var z=!1;if(z=z!==void 0&&z,V){if(z&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(M))throw Error("Found an unpaired surrogate");M=(D||(D=new TextEncoder)).encode(M)}else{for(var Q=0,X=new Uint8Array(3*M.length),nt=0;nt<M.length;nt++){var at=M.charCodeAt(nt);if(128>at)X[Q++]=at;else{if(2048>at)X[Q++]=at>>6|192;else{if(55296<=at&&57343>=at){if(56319>=at&&nt<M.length){var Ct=M.charCodeAt(++nt);if(56320<=Ct&&57343>=Ct){at=1024*(at-55296)+Ct-56320+65536,X[Q++]=at>>18|240,X[Q++]=at>>12&63|128,X[Q++]=at>>6&63|128,X[Q++]=63&at|128;continue}nt--}if(z)throw Error("Found an unpaired surrogate");at=65533}X[Q++]=at>>12|224,X[Q++]=at>>6&63|128}X[Q++]=63&at|128}}M=X.subarray(0,Q)}Ae(T.g,8*P+2),Ae(T.g,M.length),Qe(T,T.g.end()),Qe(T,M)}}),Ti=$r(function(T,M,P,z,Q){if(T.h!==2)return!1;M=lt(M,P,z),P=T.g.i,z=oe(T.g)>>>0;var X=T.g.g+z,nt=X-P;if(0>=nt&&(T.g.i=X,Q(M,T),nt=X-T.g.g),nt)throw Error("Message parsing ended unexpectedly. Expected to read "+z+" bytes, instead read "+(z-nt)+" bytes, either the data ended unexpectedly or the message misreported its own length");return T.g.g=X,T.g.i=P,!0},function(T,M,P,z,Q){if((M=Yn(M,z,P))!=null)for(z=0;z<M.length;z++){var X=T;Ae(X.g,8*P+2);var nt=X.g.end();Qe(X,nt),nt.push(X.h),X=nt,Q(M[z],T),nt=T;var at=X.pop();for(at=nt.h+nt.g.length()-at;127<at;)X.push(127&at|128),at>>>=7,nt.h++;X.push(at),nt.h++}});function Qs(){En.apply(this,arguments)}if(m(Qs,En),Me){var tr={};Object.defineProperties(Qs,(tr[Symbol.hasInstance]=xe(Object[Symbol.hasInstance]),tr))}function Ci(T){Qs.call(this,T)}function Ah(){return[1,Zc,2,Ir,3,Ns,4,Ns]}function Ol(T){Qs.call(this,T,-1,Qy)}function Jy(){return[1,Ti,Ci,Ah]}m(Ci,Qs),m(Ol,Qs),Ol.prototype.addClassification=function(T,M){return lt(this,1,Ci,T,M),this};var Qy=[1];function Ll(T){Qs.call(this,T)}function Jg(){return[1,Ir,2,Ir,3,Ir,4,Ir,5,Ir]}function Qg(T){Qs.call(this,T,-1,ex)}function tx(){return[1,Ti,Ll,Jg]}m(Ll,Qs),m(Qg,Qs);var ex=[1];function Lf(T){Qs.call(this,T)}function Ff(){return[1,Ir,2,Ir,3,Ir,4,Ir,5,Ir,6,Ga]}m(Lf,Qs);var Pf=[[61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]],Bf=[[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]],zf=[[276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]],Vf=[[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]],Uf=[[46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]],t0=[[10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]],e0=[].concat(c(Pf),c(Bf),c(zf),c(Vf),c(Uf),c(t0));function C(T,M,P){if(P=T.createShader(P===0?T.VERTEX_SHADER:T.FRAGMENT_SHADER),T.shaderSource(P,M),T.compileShader(P),!T.getShaderParameter(P,T.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+T.getShaderInfoLog(P));return P}function E(T){return Yn(T,Ci,1).map(function(M){return{index:At(M,1),ga:tn(M,2),label:ge(M,3)!=null?Yt(M,3):void 0,displayName:ge(M,4)!=null?Yt(M,4):void 0}})}function R(T){return{x:tn(T,1),y:tn(T,2),z:tn(T,3),visibility:ge(T,4)!=null?tn(T,4):void 0}}function tt(T,M){this.h=T,this.g=M,this.l=0}function xt(T,M,P){return function(z,Q){var X=z.g;if(z.o===void 0){var nt=C(X,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),at=C(X,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),Ct=X.createProgram();if(X.attachShader(Ct,nt),X.attachShader(Ct,at),X.linkProgram(Ct),!X.getProgramParameter(Ct,X.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+X.getProgramInfoLog(Ct));nt=z.o=Ct,X.useProgram(nt),at=X.getUniformLocation(nt,"sampler0"),z.j={K:X.getAttribLocation(nt,"aVertex"),J:X.getAttribLocation(nt,"aTex"),ma:at},z.u=X.createBuffer(),X.bindBuffer(X.ARRAY_BUFFER,z.u),X.enableVertexAttribArray(z.j.K),X.vertexAttribPointer(z.j.K,2,X.FLOAT,!1,0,0),X.bufferData(X.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),X.STATIC_DRAW),X.bindBuffer(X.ARRAY_BUFFER,null),z.s=X.createBuffer(),X.bindBuffer(X.ARRAY_BUFFER,z.s),X.enableVertexAttribArray(z.j.J),X.vertexAttribPointer(z.j.J,2,X.FLOAT,!1,0,0),X.bufferData(X.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),X.STATIC_DRAW),X.bindBuffer(X.ARRAY_BUFFER,null),X.uniform1i(at,0)}nt=z.j,X.useProgram(z.o),X.canvas.width=Q.width,X.canvas.height=Q.height,X.viewport(0,0,Q.width,Q.height),X.activeTexture(X.TEXTURE0),z.h.bindTexture2d(Q.glName),X.enableVertexAttribArray(nt.K),X.bindBuffer(X.ARRAY_BUFFER,z.u),X.vertexAttribPointer(nt.K,2,X.FLOAT,!1,0,0),X.enableVertexAttribArray(nt.J),X.bindBuffer(X.ARRAY_BUFFER,z.s),X.vertexAttribPointer(nt.J,2,X.FLOAT,!1,0,0),X.bindFramebuffer(X.DRAW_FRAMEBUFFER?X.DRAW_FRAMEBUFFER:X.FRAMEBUFFER,null),X.clearColor(0,0,0,0),X.clear(X.COLOR_BUFFER_BIT),X.colorMask(!0,!0,!0,!0),X.drawArrays(X.TRIANGLE_FAN,0,4),X.disableVertexAttribArray(nt.K),X.disableVertexAttribArray(nt.J),X.bindBuffer(X.ARRAY_BUFFER,null),z.h.bindTexture2d(0)}(T,M),typeof T.g.canvas.transferToImageBitmap=="function"?Promise.resolve(T.g.canvas.transferToImageBitmap()):P?Promise.resolve(T.g.canvas):typeof createImageBitmap=="function"?createImageBitmap(T.g.canvas):(T.i===void 0&&(T.i=document.createElement("canvas")),new Promise(function(z){T.i.height=T.g.canvas.height,T.i.width=T.g.canvas.width,T.i.getContext("2d",{}).drawImage(T.g.canvas,0,0,T.g.canvas.width,T.g.canvas.height),z(T.i)}))}function Rt(T){this.g=T}var Tt=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Pt(T,M){return M+T}function Zt(T,M){window[T]=M}function pe(T){if(this.g=T,this.listeners={},this.j={},this.H={},this.o={},this.u={},this.I=this.s=this.Z=!0,this.D=Promise.resolve(),this.Y="",this.C={},this.locateFile=T&&T.locateFile||Pt,typeof window=="object")var M=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if(typeof location>"u")throw Error("solutions can only be loaded on a web page or in a web worker");M=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.$=M,T.options)for(var P=(M=l(Object.keys(T.options))).next();!P.done;P=M.next()){P=P.value;var z=T.options[P].default;z!==void 0&&(this.j[P]=typeof z=="function"?z():z)}}function ze(T){var M,P,z,Q,X,nt,at,Ct,Ot,Ut,Qt;return $(function(ee){switch(ee.g){case 1:return T.Z?(M=T.g.files===void 0?[]:typeof T.g.files=="function"?T.g.files(T.j):T.g.files,x(ee,$(function(he){switch(he.g){case 1:return he.o=2,x(he,WebAssembly.instantiate(Tt),4);case 4:he.g=3,he.o=0;break;case 2:return he.o=0,he.j=null,he.return(!1);case 3:return he.return(!0)}}),2)):ee.return();case 2:if(P=ee.h,typeof window=="object")return Zt("createMediapipeSolutionsWasm",{locateFile:T.locateFile}),Zt("createMediapipeSolutionsPackedAssets",{locateFile:T.locateFile}),nt=M.filter(function(he){return he.data!==void 0}),at=M.filter(function(he){return he.data===void 0}),Ct=Promise.all(nt.map(function(he){var Ve=xn(T,he.url);if(he.path!==void 0){var Ze=he.path;Ve=Ve.then(function(Bn){return T.overrideFile(Ze,Bn),Promise.resolve(Bn)})}return Ve})),Ot=Promise.all(at.map(function(he){return he.simd===void 0||he.simd&&P||!he.simd&&!P?function(Ve){var Ze=document.createElement("script");return Ze.setAttribute("src",Ve),Ze.setAttribute("crossorigin","anonymous"),new Promise(function(Bn){Ze.addEventListener("load",function(){Bn()},!1),Ze.addEventListener("error",function(){Bn()},!1),document.body.appendChild(Ze)})}(T.locateFile(he.url,T.$)):Promise.resolve()})).then(function(){var he,Ve,Ze;return $(function(Bn){if(Bn.g==1)return he=window.createMediapipeSolutionsWasm,Ve=window.createMediapipeSolutionsPackedAssets,Ze=T,x(Bn,he(Ve),2);Ze.h=Bn.h,Bn.g=0})}),Ut=$(function(he){return T.g.graph&&T.g.graph.url?he=x(he,xn(T,T.g.graph.url),0):(he.g=0,he=void 0),he}),x(ee,Promise.all([Ot,Ct,Ut]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return z=M.filter(function(he){return he.simd===void 0||he.simd&&P||!he.simd&&!P}).map(function(he){return T.locateFile(he.url,T.$)}),importScripts.apply(null,c(z)),Q=T,x(ee,createMediapipeSolutionsWasm(Module),6);case 6:Q.h=ee.h,T.l=new OffscreenCanvas(1,1),T.h.canvas=T.l,X=T.h.GL.createContext(T.l,{antialias:!1,alpha:!1,ja:typeof WebGL2RenderingContext<"u"?2:1}),T.h.GL.makeContextCurrent(X),ee.g=4;break;case 7:if(T.l=document.createElement("canvas"),!(Qt=T.l.getContext("webgl2",{}))&&!(Qt=T.l.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),ee.return();T.G=Qt,T.h.canvas=T.l,T.h.createContext(T.l,!0,!0,{});case 4:T.i=new T.h.SolutionWasm,T.Z=!1,ee.g=0}})}function xn(T,M){var P,z;return $(function(Q){return M in T.H?Q.return(T.H[M]):(P=T.locateFile(M,""),z=fetch(P).then(function(X){return X.arrayBuffer()}),T.H[M]=z,Q.return(z))})}function nn(T,M,P){var z,Q,X,nt,at,Ct,Ot,Ut,Qt,ee,he,Ve,Ze,Bn;return $(function(Qn){switch(Qn.g){case 1:if(!P)return Qn.return(M);for(z={},Q=0,X=l(Object.keys(P)),nt=X.next();!nt.done;nt=X.next())at=nt.value,typeof(Ct=P[at])!="string"&&Ct.type==="texture"&&M[Ct.stream]!==void 0&&++Q;1<Q&&(T.I=!1),Ot=l(Object.keys(P)),nt=Ot.next();case 2:if(nt.done){Qn.g=4;break}if(Ut=nt.value,typeof(Qt=P[Ut])=="string")return Ze=z,Bn=Ut,x(Qn,function(Jc,sk,Mh){var n0;return $(function(nx){return typeof Mh=="number"||Mh instanceof Uint8Array||Mh instanceof Jc.h.Uint8BlobList?nx.return(Mh):Mh instanceof Jc.h.Texture2dDataOut?((n0=Jc.u[sk])||(n0=new tt(Jc.h,Jc.G),Jc.u[sk]=n0),nx.return(xt(n0,Mh,Jc.I))):nx.return(void 0)})}(T,Ut,M[Qt]),14);if(ee=M[Qt.stream],Qt.type==="detection_list"){if(ee){for(var Gr=ee.getRectList(),ji=ee.getLandmarksList(),ii=ee.getClassificationsList(),Mn=[],gr=0;gr<Gr.size();++gr){var Fl=en(Gr.get(gr),Lf,Ff);Fl={boundingBox:{xCenter:tn(Fl,1),yCenter:tn(Fl,2),height:tn(Fl,3),width:tn(Fl,4),rotation:tn(Fl,5,0),rectId:At(Fl,6)},landmarks:Yn(en(ji.get(gr),Qg,tx),Ll,1).map(R),V:E(en(ii.get(gr),Ol,Jy))},Mn.push(Fl)}Gr=Mn}else Gr=[];z[Ut]=Gr,Qn.g=7;break}if(Qt.type==="proto_list"){if(ee){for(Gr=Array(ee.size()),ji=0;ji<ee.size();ji++)Gr[ji]=ee.get(ji);ee.delete()}else Gr=[];z[Ut]=Gr,Qn.g=7;break}if(ee===void 0){Qn.g=3;break}if(Qt.type==="float_list"){z[Ut]=ee,Qn.g=7;break}if(Qt.type==="proto"){z[Ut]=ee,Qn.g=7;break}if(Qt.type!=="texture")throw Error("Unknown output config type: '"+Qt.type+"'");return(he=T.u[Ut])||(he=new tt(T.h,T.G),T.u[Ut]=he),x(Qn,xt(he,ee,T.I),13);case 13:Ve=Qn.h,z[Ut]=Ve;case 7:Qt.transform&&z[Ut]&&(z[Ut]=Qt.transform(z[Ut])),Qn.g=3;break;case 14:Ze[Bn]=Qn.h;case 3:nt=Ot.next(),Qn.g=2;break;case 4:return Qn.return(z)}})}function Ge(T,M){for(var P=M.name||"$",z=[].concat(c(M.wants)),Q=new T.h.StringList,X=l(M.wants),nt=X.next();!nt.done;nt=X.next())Q.push_back(nt.value);X=T.h.PacketListener.implement({onResults:function(at){for(var Ct={},Ot=0;Ot<M.wants.length;++Ot)Ct[z[Ot]]=at.get(Ot);var Ut=T.listeners[P];Ut&&(T.D=nn(T,Ct,M.outs).then(function(Qt){Qt=Ut(Qt);for(var ee=0;ee<M.wants.length;++ee){var he=Ct[z[ee]];typeof he=="object"&&he.hasOwnProperty&&he.hasOwnProperty("delete")&&he.delete()}Qt&&(T.D=Qt)}))}}),T.i.attachMultiListener(Q,X),Q.delete()}function _e(T){var M=this;T=T||{};var P={url:"face_detection_short.binarypb"},z={type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"facedetectionshortrangegpu__facedetectionshortrangecommon__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}};this.g=new pe({locateFile:T.locateFile,files:[{data:!0,url:"face_detection_short.binarypb"},{data:!0,url:"face_detection_short_range.tflite"},{simd:!0,url:"face_detection_solution_simd_wasm_bin.js"},{simd:!1,url:"face_detection_solution_wasm_bin.js"}],graph:P,listeners:[{wants:["detections","image_transformed"],outs:{image:"image_transformed",detections:{type:"detection_list",stream:"detections"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window=="object"&&window.navigator!==void 0&&("iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document)},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},model:{type:0,onChange:function(Q){var X,nt,at,Ct,Ot;return $(function(Ut){switch(Ut.g){case 1:X=l(Q==="short"?["face_detection_short_range.tflite"]:["face_detection_full_range_sparse.tflite"]),nt=X.next();case 2:if(nt.done){Ut.g=4;break}return at=nt.value,Ct="third_party/mediapipe/modules/face_detection/"+at,x(Ut,xn(M.g,at),5);case 5:Ot=Ut.h,M.g.overrideFile(Ct,Ot),nt=X.next(),Ut.g=2;break;case 4:return P.url=Q==="short"?"face_detection_short.binarypb":"face_detection_full.binarypb",z.graphOptionXref.calculatorName=Q==="short"?"facedetectionshortrangegpu__facedetectionshortrangecommon__TensorsToDetectionsCalculator":"facedetectionfullrangegpu__facedetectionfullrangecommon__TensorsToDetectionsCalculator",Ut.return(!0)}})}},minDetectionConfidence:z}})}(r=pe.prototype).close=function(){return this.i&&this.i.delete(),Promise.resolve()},r.reset=function(){var T=this;return $(function(M){T.i&&(T.i.reset(),T.o={},T.u={}),M.g=0})},r.setOptions=function(T,M){var P=this;if(M=M||this.g.options){for(var z=[],Q=[],X={},nt=l(Object.keys(T)),at=nt.next();!at.done;X={R:X.R,S:X.S},at=nt.next()){var Ct=at.value;Ct in this.j&&this.j[Ct]===T[Ct]||(this.j[Ct]=T[Ct],(at=M[Ct])!==void 0&&(at.onChange&&(X.R=at.onChange,X.S=T[Ct],z.push(function(Ot){return function(){return $(function(Ut){if(Ut.g==1)return x(Ut,Ot.R(Ot.S),2);Ut.h===!0&&(P.s=!0),Ut.g=0})}}(X))),at.graphOptionXref&&(Ct={valueNumber:at.type===1?T[Ct]:0,valueBoolean:at.type===0&&T[Ct],valueString:at.type===2?T[Ct]:""},at=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),at.graphOptionXref),Ct),Q.push(at))))}z.length===0&&Q.length===0||(this.s=!0,this.B=(this.B===void 0?[]:this.B).concat(Q),this.A=(this.A===void 0?[]:this.A).concat(z))}},r.initialize=function(){var T=this;return $(function(M){return M.g==1?x(M,ze(T),2):M.g!=3?x(M,function(P){var z,Q,X,nt,at,Ct,Ot,Ut;return $(function(Qt){if(Qt.g==1)return P.g.graph&&P.g.graph.url&&P.Y===P.g.graph.url?Qt.return():(P.s=!0,P.g.graph&&P.g.graph.url?(P.Y=P.g.graph.url,x(Qt,xn(P,P.g.graph.url),3)):void(Qt.g=2));for(Qt.g!=2&&(z=Qt.h,P.i.loadGraph(z)),Q=l(Object.keys(P.C)),X=Q.next();!X.done;X=Q.next())nt=X.value,P.i.overrideFile(nt,P.C[nt]);if(P.C={},P.g.listeners)for(at=l(P.g.listeners),Ct=at.next();!Ct.done;Ct=at.next())Ot=Ct.value,Ge(P,Ot);Ut=P.j,P.j={},P.setOptions(Ut),Qt.g=0})}(T),3):x(M,function(P){var z,Q,X,nt,at,Ct;return $(function(Ot){switch(Ot.g){case 1:if(!P.s)return Ot.return();if(!P.A){Ot.g=2;break}z=l(P.A),Q=z.next();case 3:if(Q.done){Ot.g=5;break}return x(Ot,(0,Q.value)(),4);case 4:Q=z.next(),Ot.g=3;break;case 5:P.A=void 0;case 2:if(P.B){for(X=new P.h.GraphOptionChangeRequestList,nt=l(P.B),at=nt.next();!at.done;at=nt.next())Ct=at.value,X.push_back(Ct);P.i.changeOptions(X),X.delete(),P.B=void 0}P.s=!1,Ot.g=0}})}(T),0)})},r.overrideFile=function(T,M){this.i?this.i.overrideFile(T,M):this.C[T]=M},r.clearOverriddenFiles=function(){this.C={},this.i&&this.i.clearOverriddenFiles()},r.send=function(T,M){var P,z,Q,X,nt,at,Ct,Ot,Ut,Qt=this;return $(function(ee){switch(ee.g){case 1:return Qt.g.inputs?(P=1e3*(M??performance.now()),x(ee,Qt.D,2)):ee.return();case 2:return x(ee,Qt.initialize(),3);case 3:for(z=new Qt.h.PacketDataList,Q=l(Object.keys(T)),X=Q.next();!X.done;X=Q.next())if(nt=X.value,at=Qt.g.inputs[nt]){t:{var he=T[nt];switch(at.type){case"video":var Ve=Qt.o[at.stream];if(Ve||(Ve=new tt(Qt.h,Qt.G),Qt.o[at.stream]=Ve),Ve.l===0&&(Ve.l=Ve.h.createTexture()),typeof HTMLVideoElement<"u"&&he instanceof HTMLVideoElement)var Ze=he.videoWidth,Bn=he.videoHeight;else typeof HTMLImageElement<"u"&&he instanceof HTMLImageElement?(Ze=he.naturalWidth,Bn=he.naturalHeight):(Ze=he.width,Bn=he.height);Bn={glName:Ve.l,width:Ze,height:Bn},(Ze=Ve.g).canvas.width=Bn.width,Ze.canvas.height=Bn.height,Ze.activeTexture(Ze.TEXTURE0),Ve.h.bindTexture2d(Ve.l),Ze.texImage2D(Ze.TEXTURE_2D,0,Ze.RGBA,Ze.RGBA,Ze.UNSIGNED_BYTE,he),Ve.h.bindTexture2d(0),Ve=Bn;break t;case"detections":for((Ve=Qt.o[at.stream])||(Ve=new Rt(Qt.h),Qt.o[at.stream]=Ve),Ve.data||(Ve.data=new Ve.g.DetectionListData),Ve.data.reset(he.length),Bn=0;Bn<he.length;++Bn){Ze=he[Bn];var Qn=Ve.data,Gr=Qn.setBoundingBox,ji=Bn,ii=Ze.boundingBox,Mn=new Lf;if(ae(Mn,1,ii.xCenter),ae(Mn,2,ii.yCenter),ae(Mn,3,ii.height),ae(Mn,4,ii.width),ae(Mn,5,ii.rotation),ae(Mn,6,ii.rectId),ii=Jn(Mn,Ff),Gr.call(Qn,ji,ii),Ze.landmarks)for(Qn=0;Qn<Ze.landmarks.length;++Qn){var gr=!!(Mn=Ze.landmarks[Qn]).visibility;ji=(Gr=Ve.data).addNormalizedLandmark,ii=Bn,Mn=Object.assign(Object.assign({},Mn),{visibility:gr?Mn.visibility:0}),ae(gr=new Ll,1,Mn.x),ae(gr,2,Mn.y),ae(gr,3,Mn.z),Mn.visibility&&ae(gr,4,Mn.visibility),Mn=Jn(gr,Jg),ji.call(Gr,ii,Mn)}if(Ze.V)for(Qn=0;Qn<Ze.V.length;++Qn)ji=(Gr=Ve.data).addClassification,ii=Bn,Mn=Ze.V[Qn],ae(gr=new Ci,2,Mn.ga),Mn.index&&ae(gr,1,Mn.index),Mn.label&&ae(gr,3,Mn.label),Mn.displayName&&ae(gr,4,Mn.displayName),Mn=Jn(gr,Ah),ji.call(Gr,ii,Mn)}Ve=Ve.data;break t;default:Ve={}}}switch(Ct=Ve,Ot=at.stream,at.type){case"video":z.pushTexture2d(Object.assign(Object.assign({},Ct),{stream:Ot,timestamp:P}));break;case"detections":(Ut=Ct).stream=Ot,Ut.timestamp=P,z.pushDetectionList(Ut);break;default:throw Error("Unknown input config type: '"+at.type+"'")}}return Qt.i.send(z),x(ee,Qt.D,4);case 4:z.delete(),ee.g=0}})},r.onResults=function(T,M){this.listeners[M||"$"]=T},I("Solution",pe),I("OptionType",{BOOL:0,NUMBER:1,ia:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(r=_e.prototype).close=function(){return this.g.close(),Promise.resolve()},r.onResults=function(T){this.g.onResults(T)},r.initialize=function(){var T=this;return $(function(M){return x(M,T.g.initialize(),0)})},r.reset=function(){this.g.reset()},r.send=function(T){var M=this;return $(function(P){return x(P,M.g.send(T),0)})},r.setOptions=function(T){this.g.setOptions(T)},I("FaceDetection",_e),I("FACEDETECTION_LIPS",Pf),I("FACEDETECTION_LEFT_EYE",Bf),I("FACEDETECTION_LEFT_EYEBROW",zf),I("FACEDETECTION_RIGHT_EYE",Vf),I("FACEDETECTION_RIGHT_EYEBROW",Uf),I("FACEDETECTION_FACE_OVAL",t0),I("FACEDETECTION_CONTOURS",e0),I("FACEDETECTION_TESSELATION",[[127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]]),I("VERSION","0.4.1646425229")}).call(Pb);var Mc=function(){return Mc=Object.assign||function(r){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o]);return r},Mc.apply(this,arguments)};function $l(r,t,n,i){return new(n||(n=Promise))(function(o,a){function l(h){try{u(i.next(h))}catch(d){a(d)}}function c(h){try{u(i.throw(h))}catch(d){a(d)}}function u(h){var d;h.done?o(h.value):(d=h.value,d instanceof n?d:new n(function(f){f(d)})).then(l,c)}u((i=i.apply(r,t||[])).next())})}function Il(r,t){var n,i,o,a,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(u){return function(h){return function(d){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,i&&(o=2&d[0]?i.return:d[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,d[1])).done)return o;switch(i=0,o&&(d=[2&d[0],o.value]),d[0]){case 0:case 1:o=d;break;case 4:return l.label++,{value:d[1],done:!1};case 5:l.label++,i=d[1],d=[0];continue;case 7:d=l.ops.pop(),l.trys.pop();continue;default:if(!((o=(o=l.trys).length>0&&o[o.length-1])||d[0]!==6&&d[0]!==2)){l=0;continue}if(d[0]===3&&(!o||d[1]>o[0]&&d[1]<o[3])){l.label=d[1];break}if(d[0]===6&&l.label<o[1]){l.label=o[1],o=d;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(d);break}o[2]&&l.ops.pop(),l.trys.pop();continue}d=t.call(r,l)}catch(f){d=[6,f],i=0}finally{n=o=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([u,h])}}}var $B=["rightEye","leftEye","noseTip","mouthCenter","rightEarTragion","leftEarTragion"],Bb={modelType:"short",runtime:"mediapipe",maxFaces:1},x7t=function(){function r(t){var n=this;this.width=0,this.height=0,this.selfieMode=!1,this.faceDetectorSolution=new y7t.FaceDetection({locateFile:function(i,o){return t.solutionPath?t.solutionPath.replace(/\/+$/,"")+"/"+i:o+"/"+i}}),this.faceDetectorSolution.setOptions({selfieMode:this.selfieMode,model:t.modelType}),this.faceDetectorSolution.onResults(function(i){if(n.height=i.image.height,n.width=i.image.width,n.faces=[],i.detections!==null)for(var o=0,a=i.detections;o<a.length;o++){var l=a[o];n.faces.push(n.normalizedToAbsolute(l.landmarks,{xMin:u=(c=l.boundingBox).xCenter-c.width/2,xMax:u+c.width,yMin:h=c.yCenter-c.height/2,yMax:h+c.height,width:c.width,height:c.height}))}var c,u,h})}return r.prototype.normalizedToAbsolute=function(t,n){var i=this;return{keypoints:t.map(function(o,a){return{x:o.x*i.width,y:o.y*i.height,name:$B[a]}}),box:{xMin:n.xMin*this.width,yMin:n.yMin*this.height,xMax:n.xMax*this.width,yMax:n.yMax*this.height,width:n.width*this.width,height:n.height*this.height}}},r.prototype.estimateFaces=function(t,n){return $l(this,void 0,void 0,function(){var i,o;return Il(this,function(a){switch(a.label){case 0:return n&&n.flipHorizontal&&n.flipHorizontal!==this.selfieMode&&(this.selfieMode=n.flipHorizontal,this.faceDetectorSolution.setOptions({selfieMode:this.selfieMode})),t instanceof us?(o=ImageData.bind,[4,PP(t)]):[3,2];case 1:return i=new(o.apply(ImageData,[void 0,a.sent(),t.shape[1],t.shape[0]])),[3,3];case 2:i=t,a.label=3;case 3:return t=i,[4,this.faceDetectorSolution.send({image:t})];case 4:return a.sent(),[2,this.faces]}})})},r.prototype.dispose=function(){this.faceDetectorSolution.close()},r.prototype.reset=function(){this.faceDetectorSolution.reset(),this.width=0,this.height=0,this.faces=null,this.selfieMode=!1},r.prototype.initialize=function(){return this.faceDetectorSolution.initialize()},r}();function b7t(r){return $l(this,void 0,void 0,function(){var t,n;return Il(this,function(i){switch(i.label){case 0:return t=function(o){if(o==null)return Mc({},Bb);var a=Mc({},o);return a.runtime="mediapipe",a.modelType==null&&(a.modelType=Bb.modelType),a.maxFaces==null&&(a.maxFaces=Bb.maxFaces),a}(r),[4,(n=new x7t(t)).initialize()];case 1:return i.sent(),[2,n]}})})}function IB(r){return r instanceof us?{height:r.shape[0],width:r.shape[1]}:{height:r.height,width:r.width}}function EB(r){return r instanceof us?r:BP(r)}function zb(r,t){st(r.width!==0,function(){return t+" width cannot be 0."}),st(r.height!==0,function(){return t+" height cannot be 0."})}function w7t(r,t,n){var i=t.outputTensorSize,o=t.keepAspectRatio,a=t.borderMode,l=t.outputTensorFloatRange,c=IB(r),u=function(p,m){return m?{xCenter:m.xCenter*p.width,yCenter:m.yCenter*p.height,width:m.width*p.width,height:m.height*p.height,rotation:m.rotation}:{xCenter:.5*p.width,yCenter:.5*p.height,width:p.width,height:p.height,rotation:0}}(c,n),h=function(p,m,g){if(g===void 0&&(g=!1),!g)return{top:0,left:0,right:0,bottom:0};var y=m.height,v=m.width;zb(m,"targetSize"),zb(p,"roi");var x,b,w=y/v,S=p.height/p.width,_=0,$=0;return w>S?(x=p.width,b=p.width*w,$=(1-S/w)/2):(x=p.height/w,b=p.height,_=(1-w/S)/2),p.width=x,p.height=b,{top:$,left:_,right:_,bottom:$}}(u,i,o),d=function(p,m,g,y){var v=p.width,x=p.height,b=y?-1:1,w=Math.cos(p.rotation),S=Math.sin(p.rotation),_=p.xCenter,$=p.yCenter,N=1/m,k=1/g,I=new Array(16);return I[0]=v*w*b*N,I[1]=-x*S*N,I[2]=0,I[3]=(-.5*v*w*b+.5*x*S+_)*N,I[4]=v*S*b*k,I[5]=x*w*k,I[6]=0,I[7]=(-.5*x*w-.5*v*S*b+$)*k,I[8]=0,I[9]=0,I[10]=v*N,I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,function(O){if(O.length!==16)throw new Error("Array length must be 16 but got "+O.length);return[[O[0],O[1],O[2],O[3]],[O[4],O[5],O[6],O[7]],[O[8],O[9],O[10],O[11]],[O[12],O[13],O[14],O[15]]]}(I)}(u,c.width,c.height,!1),f=$s(function(){var p=EB(r),m=gc(function(v,x,b){return zb(b,"inputResolution"),[1/b.width*v[0][0]*x.width,1/b.height*v[0][1]*x.width,v[0][3]*x.width,1/b.width*v[1][0]*x.height,1/b.height*v[1][1]*x.height,v[1][3]*x.height,0,0]}(d,c,i),[1,8]),g=a==="zero"?"constant":"nearest",y=Rf.transform(Vo(ps(p,"float32")),m,"bilinear",g,0,[i.height,i.width]);return l!=null?function(v,x){var b=function(w,S,_,$){var N=($-_)/255;return{scale:N,offset:_-0*N}}(0,0,x[0],x[1]);return $s(function(){return Hn(Re(v,b.scale),b.offset)})}(y,l):y});return{imageTensor:f,padding:h,transformationMatrix:d}}function AA(r){r.reduceBoxesInLowestLayer==null&&(r.reduceBoxesInLowestLayer=!1),r.interpolatedScaleAspectRatio==null&&(r.interpolatedScaleAspectRatio=1),r.fixedAnchorSize==null&&(r.fixedAnchorSize=!1);for(var t=[],n=0;n<r.numLayers;){for(var i=[],o=[],a=[],l=[],c=n;c<r.strides.length&&r.strides[c]===r.strides[n];){var u=MA(r.minScale,r.maxScale,c,r.strides.length);if(c===0&&r.reduceBoxesInLowestLayer)a.push(1),a.push(2),a.push(.5),l.push(.1),l.push(u),l.push(u);else{for(var h=0;h<r.aspectRatios.length;++h)a.push(r.aspectRatios[h]),l.push(u);if(r.interpolatedScaleAspectRatio>0){var d=c===r.strides.length-1?1:MA(r.minScale,r.maxScale,c+1,r.strides.length);l.push(Math.sqrt(u*d)),a.push(r.interpolatedScaleAspectRatio)}}c++}for(var f=0;f<a.length;++f){var p=Math.sqrt(a[f]);i.push(l[f]/p),o.push(l[f]*p)}var m=0,g=0;if(r.featureMapHeight.length>0)m=r.featureMapHeight[n],g=r.featureMapWidth[n];else{var y=r.strides[n];m=Math.ceil(r.inputSizeHeight/y),g=Math.ceil(r.inputSizeWidth/y)}for(var v=0;v<m;++v)for(var x=0;x<g;++x)for(var b=0;b<i.length;++b){var w={xCenter:(x+r.anchorOffsetX)/g,yCenter:(v+r.anchorOffsetY)/m,width:0,height:0};r.fixedAnchorSize?(w.width=1,w.height=1):(w.width=o[b],w.height=i[b]),t.push(w)}n=c}return t}function MA(r,t,n,i){return i===1?.5*(r+t):r+(t-r)*n/(i-1)}function DA(r,t){var n=t[0],i=t[1];return[n*r[0]+i*r[1]+r[3],n*r[4]+i*r[5]+r[7]]}function S7t(r,t,n,i){return $l(this,void 0,void 0,function(){var o,a,l,c,u;return Il(this,function(h){switch(h.label){case 0:return r.sort(function(d,f){return Math.max.apply(Math,f.score)-Math.max.apply(Math,d.score)}),o=gc(r.map(function(d){return[d.locationData.relativeBoundingBox.yMin,d.locationData.relativeBoundingBox.xMin,d.locationData.relativeBoundingBox.yMax,d.locationData.relativeBoundingBox.xMax]})),a=Lr(r.map(function(d){return d.score[0]})),[4,Rf.nonMaxSuppressionAsync(o,a,t,n)];case 1:return[4,(l=h.sent()).array()];case 2:return c=h.sent(),u=r.filter(function(d,f){return c.indexOf(f)>-1}),$a([o,a,l]),[2,u]}})})}function _7t(r,t,n){return $l(this,void 0,void 0,function(){var i,o,a,l,c;return Il(this,function(u){switch(u.label){case 0:return i=r[0],o=r[1],a=function(h,d,f){return $s(function(){var p,m,g,y;f.reverseOutputOrder?(m=Vs(Je(h,[0,f.boxCoordOffset+0],[-1,1])),p=Vs(Je(h,[0,f.boxCoordOffset+1],[-1,1])),y=Vs(Je(h,[0,f.boxCoordOffset+2],[-1,1])),g=Vs(Je(h,[0,f.boxCoordOffset+3],[-1,1]))):(p=Vs(Je(h,[0,f.boxCoordOffset+0],[-1,1])),m=Vs(Je(h,[0,f.boxCoordOffset+1],[-1,1])),g=Vs(Je(h,[0,f.boxCoordOffset+2],[-1,1])),y=Vs(Je(h,[0,f.boxCoordOffset+3],[-1,1]))),m=Hn(Re(zn(m,f.xScale),d.w),d.x),p=Hn(Re(zn(p,f.yScale),d.h),d.y),f.applyExponentialOnBoxSize?(g=Re(Tl(zn(g,f.hScale)),d.h),y=Re(Tl(zn(y,f.wScale)),d.w)):(g=Re(zn(g,f.hScale),d.h),y=Re(zn(y,f.wScale),d.h));var v=wn(p,zn(g,2)),x=wn(m,zn(y,2)),b=Hn(p,zn(g,2)),w=Hn(m,zn(y,2)),S=ur([Bt(v,[f.numBoxes,1]),Bt(x,[f.numBoxes,1]),Bt(b,[f.numBoxes,1]),Bt(w,[f.numBoxes,1])],1);if(f.numKeypoints)for(var _=0;_<f.numKeypoints;++_){var $=f.keypointCoordOffset+_*f.numValuesPerKeypoint,N=void 0,k=void 0;f.reverseOutputOrder?(N=Vs(Je(h,[0,$],[-1,1])),k=Vs(Je(h,[0,$+1],[-1,1]))):(k=Vs(Je(h,[0,$],[-1,1])),N=Vs(Je(h,[0,$+1],[-1,1])));var I=Hn(Re(zn(N,f.xScale),d.w),d.x),O=Hn(Re(zn(k,f.yScale),d.h),d.y);S=ur([S,Bt(I,[f.numBoxes,1]),Bt(O,[f.numBoxes,1])],1)}return S})}(o,t,n),l=$s(function(){var h=i;return n.sigmoidScore?(n.scoreClippingThresh!=null&&(h=GP(i,-n.scoreClippingThresh,n.scoreClippingThresh)),h=Pu(h)):h}),[4,T7t(a,l,n)];case 1:return c=u.sent(),$a([a,l]),[2,c]}})})}function T7t(r,t,n){return $l(this,void 0,void 0,function(){var i,o,a,l,c,u,h,d,f,p,m,g;return Il(this,function(y){switch(y.label){case 0:return i=[],[4,r.data()];case 1:return o=y.sent(),[4,t.data()];case 2:for(a=y.sent(),l=0;l<n.numBoxes;++l)if(!(n.minScoreThresh!=null&&a[l]<n.minScoreThresh||(c=l*n.numCoords,u=C7t(o[c+0],o[c+1],o[c+2],o[c+3],a[l],n.flipVertically,l),(h=u.locationData.relativeBoundingBox).width<0||h.height<0))){if(n.numKeypoints>0)for((d=u.locationData).relativeKeypoints=[],f=n.numKeypoints*n.numValuesPerKeypoint,p=0;p<f;p+=n.numValuesPerKeypoint)m=c+n.keypointCoordOffset+p,g={x:o[m+0],y:n.flipVertically?1-o[m+1]:o[m+1]},d.relativeKeypoints.push(g);i.push(u)}return[2,i]}})})}function C7t(r,t,n,i,o,a,l){return{score:[o],ind:l,locationData:{relativeBoundingBox:{xMin:t,yMin:a?1-n:r,xMax:i,yMax:a?1-r:n,width:i-t,height:n-r}}}}var V2,k7t={reduceBoxesInLowestLayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:4,minScale:.1484375,maxScale:.75,inputSizeHeight:128,inputSizeWidth:128,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,16,16],aspectRatios:[1],fixedAnchorSize:!0},$7t={reduceBoxesInLowestLayer:!1,interpolatedScaleAspectRatio:0,featureMapHeight:[],featureMapWidth:[],numLayers:1,minScale:.1484375,maxScale:.75,inputSizeHeight:192,inputSizeWidth:192,anchorOffsetX:.5,anchorOffsetY:.5,strides:[4],aspectRatios:[1],fixedAnchorSize:!0},Vb={runtime:"tfjs",modelType:"short",maxFaces:1,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/face_detection/short/1"},I7t={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:896,numCoords:16,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:6,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:128,yScale:128,hScale:128,wScale:128,minScoreThresh:.5},E7t={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2304,numCoords:16,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:6,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:192,yScale:192,hScale:192,wScale:192,minScoreThresh:.6},N7t={outputTensorSize:{width:128,height:128},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},A7t={outputTensorSize:{width:192,height:192},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},M7t=function(){function r(t,n,i){this.detectorModel=n,this.maxFaces=i,t==="full"?(this.imageToTensorConfig=A7t,this.tensorsToDetectionConfig=E7t,this.anchors=AA($7t)):(this.imageToTensorConfig=N7t,this.tensorsToDetectionConfig=I7t,this.anchors=AA(k7t));var o=Lr(this.anchors.map(function(u){return u.width})),a=Lr(this.anchors.map(function(u){return u.height})),l=Lr(this.anchors.map(function(u){return u.xCenter})),c=Lr(this.anchors.map(function(u){return u.yCenter}));this.anchorTensor={x:l,y:c,w:o,h:a}}return r.prototype.dispose=function(){this.detectorModel.dispose(),$a([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h])},r.prototype.reset=function(){},r.prototype.detectFaces=function(t,n){return n===void 0&&(n=!1),$l(this,void 0,void 0,function(){var i,o,a,l,c,u,h,d,f,p,m;return Il(this,function(g){switch(g.label){case 0:return t==null?(this.reset(),[2,[]]):(i=$s(function(){var y=ps(EB(t),"float32");return n&&(y=Vs(Rf.flipLeftRight(Vo(y,0)),[0])),y}),o=w7t(i,this.imageToTensorConfig),a=o.imageTensor,l=o.transformationMatrix,c=this.detectorModel.execute(a,"Identity:0"),u=function(y){return $s(function(){var v=function(w){return $s(function(){return[Je(w,[0,0,0],[1,-1,1]),Je(w,[0,0,1],[1,-1,-1])]})}(y),x=v[0],b=v[1];return{boxes:Vs(b),logits:Vs(x)}})}(c),h=u.boxes,[4,_7t([d=u.logits,h],this.anchorTensor,this.tensorsToDetectionConfig)]);case 1:return(f=g.sent()).length===0?($a([i,a,c,d,h]),[2,f]):[4,S7t(f,this.maxFaces,.3)];case 2:return p=g.sent(),m=function(y,v){y===void 0&&(y=[]);var x,b=(x=v,[].concat.apply([],x));return y.forEach(function(w){var S=w.locationData;S.relativeKeypoints.forEach(function(O){var B=DA(b,[O.x,O.y]),F=B[0],D=B[1];O.x=F,O.y=D});var _=S.relativeBoundingBox,$=Number.MAX_VALUE,N=Number.MAX_VALUE,k=Number.MIN_VALUE,I=Number.MIN_VALUE;[[_.xMin,_.yMin],[_.xMin+_.width,_.yMin],[_.xMin+_.width,_.yMin+_.height],[_.xMin,_.yMin+_.height]].forEach(function(O){var B=DA(b,O),F=B[0],D=B[1];$=Math.min($,F),k=Math.max(k,F),N=Math.min(N,D),I=Math.max(I,D)}),S.relativeBoundingBox={xMin:$,xMax:k,yMin:N,yMax:I,width:k-$,height:I-N}}),y}(p,l),$a([i,a,c,d,h]),[2,m]}})})},r.prototype.estimateFaces=function(t,n){return $l(this,void 0,void 0,function(){var i,o;return Il(this,function(a){return i=IB(t),o=!!n&&n.flipHorizontal,[2,this.detectFaces(t,o).then(function(l){return l.map(function(c){for(var u=c.locationData.relativeKeypoints.map(function(g,y){return Mc(Mc({},g),{x:g.x*i.width,y:g.y*i.height,name:$B[y]})}),h=c.locationData.relativeBoundingBox,d=0,f=["width","xMax","xMin"];d<f.length;d++)h[f[d]]*=i.width;for(var p=0,m=["height","yMax","yMin"];p<m.length;p++)h[m[p]]*=i.height;return{keypoints:u,box:h}})})]})})},r}();function D7t(r){return $l(this,void 0,void 0,function(){var t,n,i;return Il(this,function(o){switch(o.label){case 0:return t=function(a){if(a==null)return Mc({},Vb);var l=Mc({},a);return l.modelType==null&&(l.modelType=Vb.modelType),l.maxFaces==null&&(l.maxFaces=Vb.maxFaces),l.detectorModelUrl==null&&(l.modelType==="full"?l.detectorModelUrl="https://tfhub.dev/mediapipe/tfjs-model/face_detection/full/1":l.detectorModelUrl="https://tfhub.dev/mediapipe/tfjs-model/face_detection/short/1"),l}(r),n=typeof t.detectorModelUrl=="string"&&t.detectorModelUrl.indexOf("https://tfhub.dev")>-1,[4,CB(t.detectorModelUrl,{fromTFHub:n})];case 1:return i=o.sent(),[2,new M7t(t.modelType,i,t.maxFaces)]}})})}function R7t(r,t){return $l(this,void 0,void 0,function(){var n,i;return Il(this,function(o){if(r===V2.MediaPipeFaceDetector){if(i=void 0,(n=t)!=null){if(n.runtime==="tfjs")return[2,D7t(n)];if(n.runtime==="mediapipe")return[2,b7t(n)];i=n.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+i)}throw new Error(r+" is not a supported model name.")})})}function Ub(r){return r.width*r.height}function RA(r){var t=r.xCenter-r.width/2,n=t+r.width,i=r.yCenter-r.height/2;return{xMin:t,xMax:n,yMin:i,yMax:i+r.height,width:r.width,height:r.height}}function O7t(r,t){var n=RA(r),i=RA(t);if(!function(l,c){return!(l.xMax<c.xMin||c.xMax<l.xMin||l.yMax<c.yMin||c.yMax<l.yMin)}(n,i))return 0;var o=Ub(function(l,c){var u=Math.max(l.xMin,c.xMin),h=Math.min(l.xMax,c.xMax),d=Math.max(l.yMin,c.yMin),f=Math.min(l.yMax,c.yMax);return{xMin:u,xMax:h,yMin:d,yMax:f,width:Math.max(h-u,0),height:Math.max(f-d,0)}}(n,i)),a=Ub(n)+Ub(i)-o;return a>0?o/a:0}function L7t(r,t,n,i){var o=r.width,a=r.height,l=i?-1:1,c=Math.cos(r.rotation),u=Math.sin(r.rotation),h=r.xCenter,d=r.yCenter,f=1/t,p=1/n,m=new Array(16);return m[0]=o*c*l*f,m[1]=-a*u*f,m[2]=0,m[3]=(-.5*o*c*l+.5*a*u+h)*f,m[4]=o*u*l*p,m[5]=a*c*p,m[6]=0,m[7]=(-.5*a*c-.5*o*u*l+d)*p,m[8]=0,m[9]=0,m[10]=o*f,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,function(g){if(g.length!==16)throw new Error("Array length must be 16 but got "+g.length);return[[g[0],g[1],g[2],g[3]],[g[4],g[5],g[6],g[7]],[g[8],g[9],g[10],g[11]],[g[12],g[13],g[14],g[15]]]}(m)}function NB(r){return r instanceof us?{height:r.shape[0],width:r.shape[1]}:{height:r.height,width:r.width}}function AB(r){return r-2*Math.PI*Math.floor((r+Math.PI)/(2*Math.PI))}function MB(r){return r instanceof us?r:BP(r)}function Wb(r,t){st(r.width!==0,function(){return t+" width cannot be 0."}),st(r.height!==0,function(){return t+" height cannot be 0."})}function F7t(r,t){var n=function(i,o,a,l){var c=o-i,u=l-a;if(c===0)throw new Error("Original min and max are both "+i+", range cannot be 0.");var h=u/c;return{scale:h,offset:a-i*h}}(0,255,t[0],t[1]);return $s(function(){return Hn(Re(r,n.scale),n.offset)})}function P7t(r,t,n){var i=t.outputTensorSize,o=t.keepAspectRatio,a=t.borderMode,l=t.outputTensorFloatRange,c=NB(r),u=function(p,m){return m?{xCenter:m.xCenter*p.width,yCenter:m.yCenter*p.height,width:m.width*p.width,height:m.height*p.height,rotation:m.rotation}:{xCenter:.5*p.width,yCenter:.5*p.height,width:p.width,height:p.height,rotation:0}}(c,n),h=function(p,m,g){if(g===void 0&&(g=!1),!g)return{top:0,left:0,right:0,bottom:0};var y=m.height,v=m.width;Wb(m,"targetSize"),Wb(p,"roi");var x,b,w=y/v,S=p.height/p.width,_=0,$=0;return w>S?(x=p.width,b=p.width*w,$=(1-S/w)/2):(x=p.height/w,b=p.height,_=(1-w/S)/2),p.width=x,p.height=b,{top:$,left:_,right:_,bottom:$}}(u,i,o),d=L7t(u,c.width,c.height,!1),f=$s(function(){var p=MB(r),m=gc(function(v,x,b){return Wb(b,"inputResolution"),[1/b.width*v[0][0]*x.width,1/b.height*v[0][1]*x.width,v[0][3]*x.width,1/b.width*v[1][0]*x.height,1/b.height*v[1][1]*x.height,v[1][3]*x.height,0,0]}(d,c,i),[1,8]),g=a==="zero"?"constant":"nearest",y=Rf.transform(Vo(ps(p,"float32")),m,"bilinear",g,0,[i.height,i.width]);return l!=null?F7t(y,l):y});return{imageTensor:f,padding:h,transformationMatrix:d}}function OA(r){return{xCenter:r.xMin+r.width/2,yCenter:r.yMin+r.height/2,width:r.width,height:r.height}}function LA(r){var t=r.relativeKeypoints;if(t.length<=1)throw new Error("2 or more keypoints required to calculate a rect.");var n=Number.MAX_VALUE,i=Number.MAX_VALUE,o=Number.MIN_VALUE,a=Number.MIN_VALUE;return t.forEach(function(l){n=Math.min(n,l.x),o=Math.max(o,l.x),i=Math.min(i,l.y),a=Math.max(a,l.y)}),{xCenter:(n+o)/2,yCenter:(i+a)/2,width:o-n,height:a-i}}function FA(r,t,n,i,o){var a=n==="rect"?function(l,c,u){var h,d=l.locationData;if(c==="boundingbox")h=OA(d.boundingBox);else{h=LA(d);var f=u.width,p=u.height;h.xCenter=Math.round(h.xCenter*f),h.yCenter=Math.round(h.yCenter*p),h.width=Math.round(h.width*f),h.height=Math.round(h.height*p)}return h}(r,t,i):function(l,c){var u=l.locationData;return c==="boundingbox"?OA(u.relativeBoundingBox):LA(u)}(r,t);return o&&(a.rotation=function(l,c,u){var h,d=l.locationData,f=u.rotationVectorStartKeypointIndex,p=u.rotationVectorEndKeypointIndex;h=u.rotationVectorTargetAngle?u.rotationVectorTargetAngle:Math.PI*u.rotationVectorTargetAngleDegree/180;var m=d.relativeKeypoints[f].x*c.width,g=d.relativeKeypoints[f].y*c.height,y=d.relativeKeypoints[p].x*c.width,v=d.relativeKeypoints[p].y*c.height;return AB(h-Math.atan2(-(v-g),y-m))}(r,i,o)),a}function B7t(r,t,n){for(var i=0;i<t.length;++i){var o=t[i],a=n[r[i]];a.x=o.x,a.y=o.y}}function z7t(r,t,n,i){if(typeof t=="string"){if(t==="copy")for(var o=0;o<n.length;++o)i[r[o]].z=n[o].z}else{var a=function(l,c){for(var u=0,h=0;h<c.length;++h)u+=l[c[h]].z;return u/c.length}(i,t);for(o=0;o<r.length;++o)i[r[o]].z=a}}function V7t(r,t){for(var n=function(c){var u=[].concat.apply([],c.map(function(m){return m.indexesMapping}));if(u.length===0)throw new Error("There should be at least one landmark in indexes mapping");var h=u[0],d=u[0],f=new Set(u);f.forEach(function(m){h=Math.min(h,m),d=Math.max(d,m)});var p=f.size;if(h!==0)throw new Error("Indexes are expected to start with 0 instead of "+h);if(d+1!==p)throw new Error("Indexes should have no gaps but "+(d-p+1)+" indexes are missing");return p}(t),i=new Array(n).fill(null).map(Object),o=0;o<r.length;++o){var a=r[o],l=t[o];if(a.length!==l.indexesMapping.length)throw new Error("There are "+a.length+" refinement landmarks while mapping has "+l.indexesMapping.length);B7t(l.indexesMapping,a,i),z7t(l.indexesMapping,l.zRefinement,a,i)}return i}function U7t(r,t){return r.map(function(n){var i=Jo(Jo({},n),{x:n.x*t.width,y:n.y*t.height});return n.z!=null&&(i.z=n.z*t.width),i})}function W7t(r,t){return r==="none"?t:function(n){return 1/(1+Math.exp(-n))}(t)}function uu(r,t,n,i){return dl(this,void 0,void 0,function(){var o,a,l,c,u,h,d,f;return fl(this,function(p){switch(p.label){case 0:return n=n||t.flipHorizontally||!1,i=i||t.flipVertically||!1,o=r.size,a=o/t.numLandmarks,[4,r.data()];case 1:for(l=p.sent(),c=[],u=0;u<t.numLandmarks;++u)h=u*a,(f={x:0,y:0}).x=n?t.inputImageWidth-l[h]:l[h],a>1&&(f.y=i?t.inputImageHeight-l[h+1]:l[h+1]),a>2&&(f.z=l[h+2]),a>3&&(f.score=W7t(t.visibilityActivation,l[h+3])),c.push(f);for(d=0;d<c.length;++d)(f=c[d]).x=f.x/t.inputImageWidth,f.y=f.y/t.inputImageHeight,f.z=f.z/t.inputImageWidth/(t.normalizeZ||1);return[2,c]}})})}function PA(r,t,n){var i=r.width,o=r.height,a=r.rotation;if(n.rotation==null&&n.rotationDegree==null||(a=function(d,f){return f.rotation!=null?d+=f.rotation:f.rotationDegree!=null&&(d+=Math.PI*f.rotationDegree/180),AB(d)}(a,n)),a===0)r.xCenter=r.xCenter+i*n.shiftX,r.yCenter=r.yCenter+o*n.shiftY;else{var l=(t.width*i*n.shiftX*Math.cos(a)-t.height*o*n.shiftY*Math.sin(a))/t.width,c=(t.width*i*n.shiftX*Math.sin(a)+t.height*o*n.shiftY*Math.cos(a))/t.height;r.xCenter=r.xCenter+l,r.yCenter=r.yCenter+c}if(n.squareLong){var u=Math.max(i*t.width,o*t.height);i=u/t.width,o=u/t.height}else if(n.squareShort){var h=Math.min(i*t.width,o*t.height);i=h/t.width,o=h/t.height}return r.width=i*n.scaleX,r.height=o*n.scaleY,r}(V2||(V2={})).MediaPipeFaceDetector="MediaPipeFaceDetector";var Gb={runtime:"tfjs",maxFaces:1,refineLandmarks:!1,landmarkModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/face_landmarks_detection/face_mesh/1"},Hb={flipHorizontal:!1,staticImageMode:!1},BA={shiftX:0,shiftY:0,scaleX:1.5,scaleY:1.5,squareLong:!0},G7t={outputTensorSize:{width:192,height:192},outputTensorFloatRange:[0,1],borderMode:"replicate"},zA={numLandmarks:468,inputImageWidth:192,inputImageHeight:192,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},H7t={numLandmarks:80,inputImageWidth:192,inputImageHeight:192,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},VA={numLandmarks:71,inputImageWidth:192,inputImageHeight:192,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},UA={numLandmarks:5,inputImageWidth:192,inputImageHeight:192,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},j7t={indexesMapping:Array.from(Array(468).keys()),zRefinement:"copy"},q7t={indexesMapping:[61,146,91,181,84,17,314,405,321,375,291,185,40,39,37,0,267,269,270,409,78,95,88,178,87,14,317,402,318,324,308,191,80,81,82,13,312,311,310,415,76,77,90,180,85,16,315,404,320,307,306,184,74,73,72,11,302,303,304,408,62,96,89,179,86,15,316,403,319,325,292,183,42,41,38,12,268,271,272,407],zRefinement:"none"},K7t={indexesMapping:[33,7,163,144,145,153,154,155,133,246,161,160,159,158,157,173,130,25,110,24,23,22,26,112,243,247,30,29,27,28,56,190,226,31,228,229,230,231,232,233,244,113,225,224,223,222,221,189,35,124,46,53,52,65,143,111,117,118,119,120,121,128,245,156,70,63,105,66,107,55,193],zRefinement:"none"},X7t={indexesMapping:[263,249,390,373,374,380,381,382,362,466,388,387,386,385,384,398,359,255,339,254,253,252,256,341,463,467,260,259,257,258,286,414,446,261,448,449,450,451,452,453,464,342,445,444,443,442,441,413,265,353,276,283,282,295,372,340,346,347,348,349,350,357,465,383,300,293,334,296,336,285,417],zRefinement:"none"},Y7t={indexesMapping:[468,469,470,471,472],zRefinement:[33,7,163,144,145,153,154,155,133,246,161,160,159,158,157,173]},Z7t={indexesMapping:[473,474,475,476,477],zRefinement:[263,249,390,373,374,380,381,382,362,466,388,387,386,385,384,398]},U2,J7t=function(){function r(t,n,i,o){this.detector=t,this.landmarkModel=n,this.maxFaces=i,this.withAttention=o,this.prevFaceRectsFromLandmarks=null}return r.prototype.estimateFaces=function(t,n){return dl(this,void 0,void 0,function(){var i,o,a,l,c,u,h,d,f,p,m,g,y,v=this;return fl(this,function(x){switch(x.label){case 0:return i=function(S){if(S==null)return Jo({},Hb);var _=Jo({},S);return _.flipHorizontal==null&&(_.flipHorizontal=Hb.flipHorizontal),_.staticImageMode==null&&(_.staticImageMode=Hb.staticImageMode),_}(n),t==null?(this.reset(),[2,[]]):(o=NB(t),a=$s(function(){var S=ps(MB(t),"float32");return i.flipHorizontal&&(S=Vs(Rf.flipLeftRight(Vo(S,0)),[0])),S}),l=this.prevFaceRectsFromLandmarks,i.staticImageMode||l==null||l.length<this.maxFaces?[4,this.detector.detectFaces(a,!1)]:[3,2]);case 1:return(u=x.sent()).length===0?(this.reset(),a.dispose(),[2,[]]):(c=u.map(function(S){return v.faceDetectionFrontDetectionToRoi(S,o)}),[3,3]);case 2:c=[],x.label=3;case 3:return b=.5,w=[],[c,l||[]].forEach(function(S){return S.forEach(function(_){(w=w.filter(function($){return O7t(_,$)<=b})).push(_)})}),h=w,[4,Promise.all(h.map(function(S){return v.faceLandmark(S,a)}))];case 4:for(d=x.sent(),f=[],this.prevFaceRectsFromLandmarks=[],p=0;p<d.length;++p)(m=d[p])!=null&&(this.prevFaceRectsFromLandmarks.push(this.faceLandmarksToRoi(m,o)),(g=U7t(m,o))!=null&&g.forEach(function(S,_){var $=kB.get(_);$!=null&&(S.name=$)}),y=cS(g),f.push({keypoints:g,box:y.locationData.relativeBoundingBox}));return a.dispose(),[2,f]}var b,w})})},r.prototype.dispose=function(){this.detector.dispose(),this.landmarkModel.dispose()},r.prototype.reset=function(){this.detector.reset(),this.prevFaceRectsFromLandmarks=null},r.prototype.faceDetectionFrontDetectionToRoi=function(t,n){return PA(FA(t,"boundingbox","normRect",n,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:0}),n,BA)},r.prototype.faceLandmark=function(t,n){return dl(this,void 0,void 0,function(){var i,o,a,l,c,u,h;return fl(this,function(d){switch(d.label){case 0:return i=P7t(n,G7t,t).imageTensor,o=["output_faceflag"].concat(this.withAttention?["output_mesh_identity","output_lips","Identity_6:0","Identity_1:0","Identity_2:0","Identity_5:0"]:["output_mesh"]),a=this.landmarkModel.execute(i,o),l=a[0],c=a.slice(1),[4,l.data()];case 1:return d.sent()[0]<.5?($a(a),$a(i),[2,null]):this.withAttention?[4,this.tensorsToFaceLandmarksWithAttention(c)]:[3,3];case 2:return u=d.sent(),[3,5];case 3:return[4,this.tensorsToFaceLandmarks(c)];case 4:u=d.sent(),d.label=5;case 5:return h=function(f,p,m){m===void 0&&(m={ignoreRotation:!1});for(var g=[],y=0,v=f;y<v.length;y++){var x=v[y],b=x.x-.5,w=x.y-.5,S=m.ignoreRotation?0:p.rotation,_=Math.cos(S)*b-Math.sin(S)*w,$=Math.sin(S)*b+Math.cos(S)*w;_=_*p.width+p.xCenter,$=$*p.height+p.yCenter;var N=x.z*p.width,k=Jo({},x);k.x=_,k.y=$,k.z=N,g.push(k)}return g}(u,t),$a(a),$a(i),[2,h]}})})},r.prototype.tensorsToFaceLandmarks=function(t){return dl(this,void 0,void 0,function(){return fl(this,function(n){return[2,uu(t[0],zA)]})})},r.prototype.tensorsToFaceLandmarksWithAttention=function(t){return dl(this,void 0,void 0,function(){var n,i,o,a,l,c;return fl(this,function(u){switch(u.label){case 0:return[4,uu(t[0],zA)];case 1:return n=u.sent(),[4,uu(t[1],H7t)];case 2:return i=u.sent(),[4,uu(t[3],VA)];case 3:return o=u.sent(),[4,uu(t[5],VA)];case 4:return a=u.sent(),[4,uu(t[4],UA)];case 5:return l=u.sent(),[4,uu(t[2],UA)];case 6:return c=u.sent(),[2,V7t([n,i,o,a,l,c],[j7t,q7t,K7t,X7t,Y7t,Z7t])]}})})},r.prototype.faceLandmarksToRoi=function(t,n){return PA(FA(cS(t),"boundingbox","normRect",n,{rotationVectorStartKeypointIndex:33,rotationVectorEndKeypointIndex:263,rotationVectorTargetAngleDegree:0}),n,BA)},r}();function Q7t(r){return dl(this,void 0,void 0,function(){var t,n,i,o;return fl(this,function(a){switch(a.label){case 0:return t=function(l){if(l==null)return Jo({},Gb);var c=Jo({},l);return c.runtime="tfjs",c.maxFaces==null&&(c.maxFaces=Gb.maxFaces),c.refineLandmarks==null&&(c.refineLandmarks=Gb.refineLandmarks),c.landmarkModelUrl==null&&(c.landmarkModelUrl=c.refineLandmarks?"https://tfhub.dev/mediapipe/tfjs-model/face_landmarks_detection/attention_mesh/1":"https://tfhub.dev/mediapipe/tfjs-model/face_landmarks_detection/face_mesh/1"),c}(r),n=typeof t.landmarkModelUrl=="string"&&t.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,CB(t.landmarkModelUrl,{fromTFHub:n})];case 1:return i=a.sent(),[4,R7t(V2.MediaPipeFaceDetector,{modelType:"short",maxFaces:t.maxFaces,detectorModelUrl:t.detectorModelUrl,runtime:t.runtime})];case 2:return o=a.sent(),[2,new J7t(o,i,t.maxFaces,t.refineLandmarks)]}})})}function tLt(r,t){return dl(this,void 0,void 0,function(){var n,i;return fl(this,function(o){if(r===U2.MediaPipeFaceMesh){if(i=void 0,(n=t)!=null){if(n.runtime==="tfjs")return[2,Q7t(n)];if(n.runtime==="mediapipe")return[2,v7t(n)];i=n.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+i)}throw new Error(r+" is not a supported model name.")})})}(function(r){r.MediaPipeFaceMesh="MediaPipeFaceMesh"})(U2||(U2={}));const rf=(r,t,n)=>Math.max(Math.min(r,n),t),el=(r,t,n)=>(rf(r,t,n)-t)/(n-t),Ed="Right",vl="Left",to=Math.PI,sd=Math.PI*2;class Kt{constructor(t,n,i){var o,a,l,c,u,h;if(Array.isArray(t)){this.x=(o=t[0])!==null&&o!==void 0?o:0,this.y=(a=t[1])!==null&&a!==void 0?a:0,this.z=(l=t[2])!==null&&l!==void 0?l:0;return}if(t&&typeof t=="object"){this.x=(c=t.x)!==null&&c!==void 0?c:0,this.y=(u=t.y)!==null&&u!==void 0?u:0,this.z=(h=t.z)!==null&&h!==void 0?h:0;return}this.x=t??0,this.y=n??0,this.z=i??0}negative(){return new Kt(-this.x,-this.y,-this.z)}add(t){return t instanceof Kt?new Kt(this.x+t.x,this.y+t.y,this.z+t.z):new Kt(this.x+t,this.y+t,this.z+t)}subtract(t){return t instanceof Kt?new Kt(this.x-t.x,this.y-t.y,this.z-t.z):new Kt(this.x-t,this.y-t,this.z-t)}multiply(t){return t instanceof Kt?new Kt(this.x*t.x,this.y*t.y,this.z*t.z):new Kt(this.x*t,this.y*t,this.z*t)}divide(t){return t instanceof Kt?new Kt(this.x/t.x,this.y/t.y,this.z/t.z):new Kt(this.x/t,this.y/t,this.z/t)}equals(t){return this.x==t.x&&this.y==t.y&&this.z==t.z}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new Kt(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}length(){return Math.sqrt(this.dot(this))}distance(t,n=3){return Math.sqrt(n===2?Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2):Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)+Math.pow(this.z-t.z,2))}lerp(t,n){return t.subtract(this).multiply(n).add(this)}unit(){return this.divide(this.length())}min(){return Math.min(Math.min(this.x,this.y),this.z)}max(){return Math.max(Math.max(this.x,this.y),this.z)}toSphericalCoords(t={x:"x",y:"y",z:"z"}){return{theta:Math.atan2(this[t.y],this[t.x]),phi:Math.acos(this[t.z]/this.length())}}angleTo(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}toArray(t){return[this.x,this.y,this.z].slice(0,t||3)}clone(){return new Kt(this.x,this.y,this.z)}init(t,n,i){return this.x=t,this.y=n,this.z=i,this}static negative(t,n=new Kt){return n.x=-t.x,n.y=-t.y,n.z=-t.z,n}static add(t,n,i=new Kt){return n instanceof Kt?(i.x=t.x+n.x,i.y=t.y+n.y,i.z=t.z+n.z):(i.x=t.x+n,i.y=t.y+n,i.z=t.z+n),i}static subtract(t,n,i=new Kt){return n instanceof Kt?(i.x=t.x-n.x,i.y=t.y-n.y,i.z=t.z-n.z):(i.x=t.x-n,i.y=t.y-n,i.z=t.z-n),i}static multiply(t,n,i=new Kt){return n instanceof Kt?(i.x=t.x*n.x,i.y=t.y*n.y,i.z=t.z*n.z):(i.x=t.x*n,i.y=t.y*n,i.z=t.z*n),i}static divide(t,n,i=new Kt){return n instanceof Kt?(i.x=t.x/n.x,i.y=t.y/n.y,i.z=t.z/n.z):(i.x=t.x/n,i.y=t.y/n,i.z=t.z/n),i}static cross(t,n,i=new Kt){return i.x=t.y*n.z-t.z*n.y,i.y=t.z*n.x-t.x*n.z,i.z=t.x*n.y-t.y*n.x,i}static unit(t,n){const i=t.length();return n.x=t.x/i,n.y=t.y/i,n.z=t.z/i,n}static fromAngles(t,n){return new Kt(Math.cos(t)*Math.cos(n),Math.sin(n),Math.sin(t)*Math.cos(n))}static randomDirection(){return Kt.fromAngles(Math.random()*sd,Math.asin(Math.random()*2-1))}static min(t,n){return new Kt(Math.min(t.x,n.x),Math.min(t.y,n.y),Math.min(t.z,n.z))}static max(t,n){return new Kt(Math.max(t.x,n.x),Math.max(t.y,n.y),Math.max(t.z,n.z))}static lerp(t,n,i){return n instanceof Kt?n.subtract(t).multiply(i).add(t):(n-t)*i+t}static fromArray(t){return Array.isArray(t)?new Kt(t[0],t[1],t[2]):new Kt(t.x,t.y,t.z)}static angleBetween(t,n){return t.angleTo(n)}static distance(t,n,i){return Math.sqrt(i===2?Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2):Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)+Math.pow(t.z-n.z,2))}static toDegrees(t){return t*(180/to)}static normalizeAngle(t){let n=t%sd;return n=n>to?n-sd:n<-to?sd+n:n,n/to}static normalizeRadians(t){return t>=to/2&&(t-=sd),t<=-to/2&&(t+=sd,t=to-t),t/to}static find2DAngle(t,n,i,o){const a=o-n,l=i-t;return Math.atan2(a,l)}static findRotation(t,n,i=!0){return i?new Kt(Kt.normalizeRadians(Kt.find2DAngle(t.z,t.x,n.z,n.x)),Kt.normalizeRadians(Kt.find2DAngle(t.z,t.y,n.z,n.y)),Kt.normalizeRadians(Kt.find2DAngle(t.x,t.y,n.x,n.y))):new Kt(Kt.find2DAngle(t.z,t.x,n.z,n.x),Kt.find2DAngle(t.z,t.y,n.z,n.y),Kt.find2DAngle(t.x,t.y,n.x,n.y))}static rollPitchYaw(t,n,i){if(!i)return new Kt(Kt.normalizeAngle(Kt.find2DAngle(t.z,t.y,n.z,n.y)),Kt.normalizeAngle(Kt.find2DAngle(t.z,t.x,n.z,n.x)),Kt.normalizeAngle(Kt.find2DAngle(t.x,t.y,n.x,n.y)));const o=n.subtract(t),a=i.subtract(t),c=o.cross(a).unit(),u=o.unit(),h=c.cross(u),d=Math.asin(c.x)||0,f=Math.atan2(-c.y,c.z)||0,p=Math.atan2(-h.x,u.x)||0;return new Kt(Kt.normalizeAngle(f),Kt.normalizeAngle(d),Kt.normalizeAngle(p))}static angleBetween3DCoords(t,n,i){t instanceof Kt||(t=new Kt(t),n=new Kt(n),i=new Kt(i));const o=t.subtract(n),a=i.subtract(n),l=o.unit(),c=a.unit(),u=l.dot(c),h=Math.acos(u);return Kt.normalizeRadians(h)}static getRelativeSphericalCoords(t,n,i,o){t instanceof Kt||(t=new Kt(t),n=new Kt(n),i=new Kt(i));const a=n.subtract(t),l=i.subtract(n),c=a.unit(),u=l.unit(),{theta:h,phi:d}=c.toSphericalCoords(o),{theta:f,phi:p}=u.toSphericalCoords(o),m=h-f,g=d-p;return{theta:Kt.normalizeAngle(m),phi:Kt.normalizeAngle(g)}}static getSphericalCoords(t,n,i={x:"x",y:"y",z:"z"}){t instanceof Kt||(t=new Kt(t),n=new Kt(n));const a=n.subtract(t).unit(),{theta:l,phi:c}=a.toSphericalCoords(i);return{theta:Kt.normalizeAngle(-l),phi:Kt.normalizeAngle(to/2-c)}}}const eLt=r=>{const t=new Kt(r[21]),n=new Kt(r[251]),i=new Kt(r[397]),o=new Kt(r[172]),a=i.lerp(o,.5);return{vector:[t,n,a],points:[t,n,i,o]}},nLt=r=>{const t=eLt(r).vector,n=Kt.rollPitchYaw(t[0],t[1],t[2]),i=t[0].lerp(t[1],.5),o=t[0].distance(t[1]),a=i.distance(t[2]);return n.x*=-1,n.z*=-1,{y:n.y*to,x:n.x*to,z:n.z*to,width:o,height:a,position:i.lerp(t[2],.5),normalized:{y:n.y,x:n.x,z:n.z},degrees:{y:n.y*180,x:n.x*180,z:n.z*180}}},Fp={eye:{[vl]:[130,133,160,159,158,144,145,153],[Ed]:[263,362,387,386,385,373,374,380]},brow:{[vl]:[35,244,63,105,66,229,230,231],[Ed]:[265,464,293,334,296,449,450,451]},pupil:{[vl]:[468,469,470,471,472],[Ed]:[473,474,475,476,477]}},WA=(r,t=vl,{high:n=.85,low:i=.55}={})=>{const o=Fp.eye[t],a=DB(r[o[0]],r[o[1]],r[o[2]],r[o[3]],r[o[4]],r[o[5]],r[o[6]],r[o[7]]),c=rf(a/.285,0,2);return{norm:el(c,i,n),raw:c}},DB=(r,t,n,i,o,a,l,c)=>{r=new Kt(r),t=new Kt(t),n=new Kt(n),i=new Kt(i),o=new Kt(o),a=new Kt(a),l=new Kt(l),c=new Kt(c);const u=r.distance(t,2),h=n.distance(a,2),d=i.distance(l,2),f=o.distance(c,2);return(h+d+f)/3/u},GA=(r,t=vl)=>{const n=new Kt(r[Fp.eye[t][0]]),i=new Kt(r[Fp.eye[t][1]]),o=n.distance(i,2),a=n.lerp(i,.5),l=new Kt(r[Fp.pupil[t][0]]),c=a.x-l.x,u=a.y-o*.075-l.y;let h=c/(o/2),d=u/(o/4);return h*=4,d*=4,{x:h,y:d}},RB=(r,t,{enableWink:n=!0,maxRot:i=.5}={})=>{r.r=rf(r.r,0,1),r.l=rf(r.l,0,1);const o=Math.abs(r.l-r.r),a=n?.8:1.2,l=r.l<.3&&r.r<.3,c=r.l>.6&&r.r>.6;return t>i?{l:r.r,r:r.r}:t<-i?{l:r.l,r:r.l}:{l:o>=a&&!l&&!c?r.l:r.r>r.l?Kt.lerp(r.r,r.l,.95):Kt.lerp(r.r,r.l,.05),r:o>=a&&!l&&!c?r.r:r.r>r.l?Kt.lerp(r.r,r.l,.95):Kt.lerp(r.r,r.l,.05)}},sLt=(r,{high:t=.85,low:n=.55}={})=>{if(r.length!==478)return{l:1,r:1};const i=WA(r,vl,{high:t,low:n}),o=WA(r,Ed,{high:t,low:n});return{l:i.norm||0,r:o.norm||0}},rLt=r=>{if(r.length!==478)return{x:0,y:0};{const t=GA(r,vl),n=GA(r,Ed);return{x:(t.x+n.x)*.5||0,y:(t.y+n.y)*.5||0}}},HA=(r,t=vl)=>{const n=Fp.brow[t],i=DB(r[n[0]],r[n[1]],r[n[2]],r[n[3]],r[n[4]],r[n[5]],r[n[6]],r[n[7]]),o=1.15,a=.125,l=.07,c=i/o-1;return(rf(c,l,a)-l)/(a-l)},iLt=r=>{if(r.length!==478)return 0;{const t=HA(r,vl),n=HA(r,Ed);return(t+n)/2||0}},oLt=r=>{const t=new Kt(r[133]),n=new Kt(r[362]),i=new Kt(r[130]),o=new Kt(r[263]),a=t.distance(n),l=i.distance(o),c=new Kt(r[13]),u=new Kt(r[14]),h=new Kt(r[61]),d=new Kt(r[291]),f=c.distance(u),p=h.distance(d);let m=f/a,g=p/l;m=el(m,.15,.7),g=el(g,.45,.9),g=(g-.3)*2;const y=g,v=el(f/a,.17,.5),x=rf(el(y,0,1)*2*el(v,.2,.7),0,1),b=v*.4+v*(1-x)*.6,w=v*el(1-x,0,.3)*.1,S=el(w,.2,1)*(1-x)*.3,_=(1-x)*el(v,.3,1)*.4;return{x:g||0,y:m||0,shape:{A:b||0,E:S||0,I:x||0,O:_||0,U:w||0}}};class OB{static solve(t,{runtime:n="tfjs",video:i=null,imageSize:o=null,smoothBlink:a=!1,blinkSettings:l=[]}={}){if(!t){console.error("Need Face Landmarks");return}if(i){const p=typeof i=="string"?document.querySelector(i):i;o={width:p.videoWidth,height:p.videoHeight}}if(n==="mediapipe"&&o)for(const p of t)p.x*=o.width,p.y*=o.height,p.z*=o.width;const c=nLt(t),u=oLt(t);l=l.length>0?l:n==="tfjs"?[.55,.85]:[.35,.5];let h=sLt(t,{high:l[1],low:l[0]});a&&(h=RB(h,c.y));const d=rLt(t),f=iLt(t);return{head:c,eye:h,brow:f,pupil:d,mouth:u}}}OB.stabilizeBlink=RB;class aLt{constructor(t,n){const i={audio:!1,video:{frameRate:{ideal:100,max:150}}};this.opts={...i,...n},this.isOpen=!1,this.isOpenLoading=!1,this.video=t,this.isPhone=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}open(t){return new Promise(async(n,i)=>{if(!this.isVideo(this.video))this.isOpen=!1,this.isOpenLoading=!1,i({errMsg:"video not HTMLElement"});else if(this.isOpenLoading=!0,this.isOpen=!1,navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){await this.getMediaDevices();const o={audio:this.opts.audio,video:this.opts.video};t==="user"||t==="environment"?o.video.facingMode=t:t?o.video.deviceId=t:o.video.facingMode="user",navigator.mediaDevices.getUserMedia(o).then(a=>{const l=a.getVideoTracks();if(l.length>0)this.stream=a,this.video.pause(),this.video.setAttribute("playsinline",!0),"srcObject"in this.video?this.video.srcObject=a:this.video.src=a,this.video.onloadedmetadata=async()=>{await this.video.play(),this.isOpen=!0,this.isOpenLoading=!1;const c=l[0];c.constraints=c.getConstraints(),c.settings=c.getSettings(),this.isPhone&&c.settings&&c.settings.deviceId&&(c.settings.deviceId=t),console.log(c),this.tracks=c,n(this.tracks)},this.video.onError=c=>{const u={errMsg:`video Error-${c}`,opts:this.opts};i(u)};else{const c={errMsg:"No VideoTracks",opts:this.opts};i(c)}}).catch(a=>{const l={errMsg:`Failed to acquire camera feed: ${a}`,opts:this.opts};i(l)})}else{const o={errMsg:"No navigator.mediaDevices.getUserMedia exists",opts:this.opts};i(o)}})}stop(){return new Promise(t=>{this.isOpen&&this.stream&&this.stream.getVideoTracks().forEach(async n=>{await n.stop()}),t(this)})}getMediaDevices(){return new Promise((t,n)=>{if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)this.isPhone?t([{label:"",deviceId:"user"},{label:"",deviceId:"environment"}]):navigator.mediaDevices.enumerateDevices().then(i=>{const o=(i||[]).filter(a=>a.kind==="videoinput"&&a.deviceId);this.devicesList=o,t(o)});else{const i={errMsg:"No navigator.mediaDevices.enumerateDevices exists",opts:this.opts};n(i)}})}isVideo(t){return t instanceof HTMLElement&&t.nodeName==="VIDEO"}}const Tn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"},lLt=[127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,157,154,155,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,92,186,230,229,118,202,212,214,83,18,17,76,61,146,160,29,30,56,157,173,106,204,194,135,214,192,203,165,98,21,71,68,51,45,4,144,24,23,77,146,91,205,50,187,201,200,18,91,106,182,90,91,181,85,84,17,206,203,36,148,171,140,92,40,39,193,189,244,159,158,28,247,246,161,236,3,196,54,68,104,193,168,8,117,228,31,189,193,55,98,97,99,126,47,100,166,79,218,155,154,26,209,49,131,135,136,150,47,126,217,223,52,53,45,51,134,211,170,140,67,69,108,43,106,91,230,119,120,226,130,247,63,53,52,238,20,242,46,70,156,78,62,96,46,53,63,143,34,227,173,155,133,123,117,111,44,125,19,236,134,51,216,206,205,154,153,22,39,37,167,200,201,208,36,142,100,57,212,202,20,60,99,28,158,157,35,226,113,160,159,27,204,202,210,113,225,46,43,202,204,62,76,77,137,123,116,41,38,72,203,129,142,64,98,240,49,102,64,41,73,74,212,216,207,42,74,184,169,170,211,170,149,176,105,66,69,122,6,168,123,147,187,96,77,90,65,55,107,89,90,180,101,100,120,63,105,104,93,137,227,15,86,85,129,102,49,14,87,86,55,8,9,100,47,121,145,23,22,88,89,179,6,122,196,88,95,96,138,172,136,215,58,172,115,48,219,42,80,81,195,3,51,43,146,61,171,175,199,81,82,38,53,46,225,144,163,110,246,33,7,52,65,66,229,228,117,34,127,234,107,108,69,109,108,151,48,64,235,62,78,191,129,209,126,111,35,143,163,161,246,117,123,50,222,65,52,19,125,141,221,55,65,3,195,197,25,7,33,220,237,44,70,71,139,122,193,245,247,130,33,71,21,162,153,158,159,170,169,150,188,174,196,216,186,92,144,160,161,2,97,167,141,125,241,164,167,37,72,38,12,145,159,160,38,82,13,63,68,71,226,35,111,158,153,154,101,50,205,206,92,165,209,198,217,165,167,97,220,115,218,133,112,243,239,238,241,214,135,169,190,173,133,171,208,32,125,44,237,86,87,178,85,86,179,84,85,180,83,84,181,201,83,182,137,93,132,76,62,183,61,76,184,57,61,185,212,57,186,214,207,187,34,143,156,79,239,237,123,137,177,44,1,4,201,194,32,64,102,129,213,215,138,59,166,219,242,99,97,2,94,141,75,59,235,24,110,228,25,130,226,23,24,229,22,23,230,26,22,231,112,26,232,189,190,243,221,56,190,28,56,221,27,28,222,29,27,223,30,29,224,247,30,225,238,79,20,166,59,75,60,75,240,147,177,215,20,79,166,187,147,213,112,233,244,233,128,245,128,114,188,114,217,174,131,115,220,217,198,236,198,131,134,177,132,58,143,35,124,110,163,7,228,110,25,356,389,368,11,302,267,452,350,349,302,303,269,357,343,277,452,453,357,333,332,297,175,152,377,384,398,382,347,348,330,303,304,270,9,336,337,278,279,360,418,262,431,304,408,409,310,415,407,270,409,410,450,348,347,422,430,434,313,314,17,306,307,375,387,388,260,286,414,398,335,406,418,364,367,416,423,358,327,251,284,298,281,5,4,373,374,253,307,320,321,425,427,411,421,313,18,321,405,406,320,404,405,315,16,17,426,425,266,377,400,369,322,391,269,417,465,464,386,257,258,466,260,388,456,399,419,284,332,333,417,285,8,346,340,261,413,441,285,327,460,328,355,371,329,392,439,438,382,341,256,429,420,360,364,394,379,277,343,437,443,444,283,275,440,363,431,262,369,297,338,337,273,375,321,450,451,349,446,342,467,293,334,282,458,461,462,276,353,383,308,324,325,276,300,293,372,345,447,382,398,362,352,345,340,274,1,19,456,248,281,436,427,425,381,256,252,269,391,393,200,199,428,266,330,329,287,273,422,250,462,328,258,286,384,265,353,342,387,259,257,424,431,430,342,353,276,273,335,424,292,325,307,366,447,345,271,303,302,423,266,371,294,455,460,279,278,294,271,272,304,432,434,427,272,407,408,394,430,431,395,369,400,334,333,299,351,417,168,352,280,411,325,319,320,295,296,336,319,403,404,330,348,349,293,298,333,323,454,447,15,16,315,358,429,279,14,15,316,285,336,9,329,349,350,374,380,252,318,402,403,6,197,419,318,319,325,367,364,365,435,367,397,344,438,439,272,271,311,195,5,281,273,287,291,396,428,199,311,271,268,283,444,445,373,254,339,263,466,249,282,334,296,449,347,346,264,447,454,336,296,299,338,10,151,278,439,455,292,407,415,358,371,355,340,345,372,390,249,466,346,347,280,442,443,282,19,94,370,441,442,295,248,419,197,263,255,359,440,275,274,300,383,368,351,412,465,263,467,466,301,368,389,380,374,386,395,378,379,412,351,419,436,426,322,373,390,388,2,164,393,370,462,461,164,0,267,302,11,12,374,373,387,268,12,13,293,300,301,446,261,340,385,384,381,330,266,425,426,423,391,429,355,437,391,327,326,440,457,438,341,382,362,459,457,461,434,430,394,414,463,362,396,369,262,354,461,457,316,403,402,315,404,403,314,405,404,313,406,405,421,418,406,366,401,361,306,408,407,291,409,408,287,410,409,432,436,410,434,416,411,264,368,383,309,438,457,352,376,401,274,275,4,421,428,262,294,327,358,433,416,367,289,455,439,462,370,326,2,326,370,305,460,455,254,449,448,255,261,446,253,450,449,252,451,450,256,452,451,341,453,452,413,464,463,441,413,414,258,442,441,257,443,442,259,444,443,260,445,444,467,342,445,459,458,250,289,392,290,290,328,460,376,433,435,250,290,392,411,416,433,341,463,464,453,464,465,357,465,412,343,412,399,360,363,440,437,399,456,420,456,363,401,435,288,372,383,353,339,255,249,448,261,255,133,243,190,133,155,112,33,246,247,33,130,25,398,384,286,362,398,414,362,463,341,263,359,467,263,249,255,466,467,260,75,60,166,238,239,79,162,127,139,72,11,37,121,232,120,73,72,39,114,128,47,233,232,128,103,104,67,152,175,148,173,157,155,119,118,101,74,73,40,107,9,108,49,48,131,32,194,211,184,74,185,191,80,183,185,40,186,119,230,118,210,202,214,84,83,17,77,76,146,161,160,30,190,56,173,182,106,194,138,135,192,129,203,98,54,21,68,5,51,4,145,144,23,90,77,91,207,205,187,83,201,18,181,91,182,180,90,181,16,85,17,205,206,36,176,148,140,165,92,39,245,193,244,27,159,28,30,247,161,174,236,196,103,54,104,55,193,8,111,117,31,221,189,55,240,98,99,142,126,100,219,166,218,112,155,26,198,209,131,169,135,150,114,47,217,224,223,53,220,45,134,32,211,140,109,67,108,146,43,91,231,230,120,113,226,247,105,63,52,241,238,242,124,46,156,95,78,96,70,46,63,116,143,227,116,123,111,1,44,19,3,236,51,207,216,205,26,154,22,165,39,167,199,200,208,101,36,100,43,57,202,242,20,99,56,28,157,124,35,113,29,160,27,211,204,210,124,113,46,106,43,204,96,62,77,227,137,116,73,41,72,36,203,142,235,64,240,48,49,64,42,41,74,214,212,207,183,42,184,210,169,211,140,170,176,104,105,69,193,122,168,50,123,187,89,96,90,66,65,107,179,89,180,119,101,120,68,63,104,234,93,227,16,15,85,209,129,49,15,14,86,107,55,9,120,100,121,153,145,22,178,88,179,197,6,196,89,88,96,135,138,136,138,215,172,218,115,219,41,42,81,5,195,51,57,43,61,208,171,199,41,81,38,224,53,225,24,144,110,105,52,66,118,229,117,227,34,234,66,107,69,10,109,151,219,48,235,183,62,191,142,129,126,116,111,143,7,163,246,118,117,50,223,222,52,94,19,141,222,221,65,196,3,197,45,220,44,156,70,139,188,122,245,139,71,162,145,153,159,149,170,150,122,188,196,206,216,92,163,144,161,164,2,167,242,141,241,0,164,37,11,72,12,144,145,160,12,38,13,70,63,71,31,226,111,157,158,154,36,101,205,203,206,165,126,209,217,98,165,97,237,220,218,237,239,241,210,214,169,140,171,32,241,125,237,179,86,178,180,85,179,181,84,180,182,83,181,194,201,182,177,137,132,184,76,183,185,61,184,186,57,185,216,212,186,192,214,187,139,34,156,218,79,237,147,123,177,45,44,4,208,201,32,98,64,129,192,213,138,235,59,219,141,242,97,97,2,141,240,75,235,229,24,228,31,25,226,230,23,229,231,22,230,232,26,231,233,112,232,244,189,243,189,221,190,222,28,221,223,27,222,224,29,223,225,30,224,113,247,225,99,60,240,213,147,215,60,20,166,192,187,213,243,112,244,244,233,245,245,128,188,188,114,174,134,131,220,174,217,236,236,198,134,215,177,58,156,143,124,25,110,7,31,228,25,264,356,368,0,11,267,451,452,349,267,302,269,350,357,277,350,452,357,299,333,297,396,175,377,381,384,382,280,347,330,269,303,270,151,9,337,344,278,360,424,418,431,270,304,409,272,310,407,322,270,410,449,450,347,432,422,434,18,313,17,291,306,375,259,387,260,424,335,418,434,364,416,391,423,327,301,251,298,275,281,4,254,373,253,375,307,321,280,425,411,200,421,18,335,321,406,321,320,405,314,315,17,423,426,266,396,377,369,270,322,269,413,417,464,385,386,258,248,456,419,298,284,333,168,417,8,448,346,261,417,413,285,326,327,328,277,355,329,309,392,438,381,382,256,279,429,360,365,364,379,355,277,437,282,443,283,281,275,363,395,431,369,299,297,337,335,273,321,348,450,349,359,446,467,283,293,282,250,458,462,300,276,383,292,308,325,283,276,293,264,372,447,346,352,340,354,274,19,363,456,281,426,436,425,380,381,252,267,269,393,421,200,428,371,266,329,432,287,422,290,250,328,385,258,384,446,265,342,386,387,257,422,424,430,445,342,276,422,273,424,306,292,307,352,366,345,268,271,302,358,423,371,327,294,460,331,279,294,303,271,304,436,432,427,304,272,408,395,394,431,378,395,400,296,334,299,6,351,168,376,352,411,307,325,320,285,295,336,320,319,404,329,330,349,334,293,333,366,323,447,316,15,315,331,358,279,317,14,316,8,285,9,277,329,350,253,374,252,319,318,403,351,6,419,324,318,325,397,367,365,288,435,397,278,344,439,310,272,311,248,195,281,375,273,291,175,396,199,312,311,268,276,283,445,390,373,339,295,282,296,448,449,346,356,264,454,337,336,299,337,338,151,294,278,455,308,292,415,429,358,355,265,340,372,388,390,466,352,346,280,295,442,282,354,19,370,285,441,295,195,248,197,457,440,274,301,300,368,417,351,465,251,301,389,385,380,386,394,395,379,399,412,419,410,436,322,387,373,388,326,2,393,354,370,461,393,164,267,268,302,12,386,374,387,312,268,13,298,293,301,265,446,340,380,385,381,280,330,425,322,426,391,420,429,437,393,391,326,344,440,438,458,459,461,364,434,394,428,396,262,274,354,457,317,316,402,316,315,403,315,314,404,314,313,405,313,421,406,323,366,361,292,306,407,306,291,408,291,287,409,287,432,410,427,434,411,372,264,383,459,309,457,366,352,401,1,274,4,418,421,262,331,294,358,435,433,367,392,289,439,328,462,326,94,2,370,289,305,455,339,254,448,359,255,446,254,253,449,253,252,450,252,256,451,256,341,452,414,413,463,286,441,414,286,258,441,258,257,442,257,259,443,259,260,444,260,467,445,309,459,250,305,289,290,305,290,460,401,376,435,309,250,392,376,411,433,453,341,464,357,453,465,343,357,412,437,343,399,344,360,440,420,437,456,360,420,363,361,401,288,265,372,353,390,339,249,339,448,255],cLt=[.499976992607117,.34746599197387695,.500025987625122,.45251297950744596,.499974012374878,.397628009319305,.482113003730774,.528020977973938,.500150978565216,.47284400463104204,.499909996986389,.5017470121383669,.499523013830185,.59893798828125,.289712011814117,.6192359924316411,.499954998493195,.687601983547211,.499987006187439,.730081021785736,.500023007392883,.892949998378754,.500023007392883,.33376598358154297,.5000159740448,.320775985717773,.500023007392883,.30765199661254905,.499976992607117,.30472201108932495,.499976992607117,.29406601190567005,.499976992607117,.280614972114563,.499976992607117,.262980997562408,.499967992305756,.21862900257110596,.499816000461578,.43701899051666304,.473773002624512,.42609000205993697,.104906998574734,.745859026908875,.365929991006851,.590424001216888,.338757991790771,.58697497844696,.311120003461838,.590539991855621,.274657994508743,.6108689904212949,.393361985683441,.596293985843658,.345234006643295,.655988991260529,.370094001293182,.6539239883422849,.319321990013123,.652734994888306,.297903001308441,.646408975124359,.24779200553894,.589190006256104,.396889001131058,.15724498033523604,.280097991228104,.6244000196456909,.106310002505779,.6000440120697019,.2099249958992,.6086469888687129,.355807989835739,.46559399366378795,.471751004457474,.34959602355957,.474155008792877,.319808006286621,.439785003662109,.342770993709564,.414617002010345,.33345901966095004,.450374007225037,.319139003753662,.428770989179611,.31730902194976796,.374971002340317,.272194981575012,.486716985702515,.452371001243591,.485300987958908,.47260499000549305,.257764995098114,.685509979724884,.401223003864288,.544827997684479,.429818987846375,.451385021209717,.421351999044418,.466259002685547,.276895999908447,.467943012714386,.483370006084442,.500413000583649,.33721199631691,.7171170115470891,.296391993761063,.706757009029388,.169294998049736,.806186020374298,.447580009698868,.697390019893646,.392390012741089,.646112024784088,.354490011930466,.30321598052978505,.067304998636246,.269894957542419,.442739009857178,.427173972129822,.457098007202148,.415207982063293,.381974011659622,.305289030075073,.392388999462128,.305796980857849,.277076005935669,.728067994117737,.422551989555359,.436766982078552,.385919004678726,.718635976314545,.383103013038635,.744159996509552,.331431001424789,.880285978317261,.229923993349075,.767997026443481,.364500999450684,.810886025428772,.229622006416321,.700459003448486,.173287004232407,.721252024173737,.472878992557526,.33380198478698697,.446828007698059,.331472992897034,.422762006521225,.32611000537872303,.445307999849319,.41993403434753396,.388103008270264,.306038975715637,.403039008378983,.293460011482239,.403629004955292,.306046962738037,.460041999816895,.44286096096038796,.431158006191254,.307633996009827,.452181994915009,.307633996009827,.475387006998062,.307633996009827,.465828001499176,.22080999612808205,.472328990697861,.263774037361145,.473087012767792,.282142996788025,.473122000694275,.295374035835266,.473033010959625,.30472201108932495,.427942007780075,.30472201108932495,.426479011774063,.29646003246307395,.423162013292313,.28815400600433305,.4183090031147,.27993702888488803,.390094995498657,.360427021980286,.013953999616206,.439965963363647,.499913990497589,.41985297203064,.413199990987778,.30460000038146995,.409626007080078,.29817700386047397,.468080013990402,.398465037345886,.422728985548019,.414014995098114,.463079988956451,.406216025352478,.37211999297142,.52658599615097,.334562003612518,.5039269924163821,.411671012639999,.45303499698638905,.242175996303558,.85232400894165,.290776997804642,.798554003238678,.327338010072708,.7434729933738711,.399509996175766,.251078963279724,.441727995872498,.738323986530304,.429764986038208,.8121659755706789,.412198007106781,.891098976135254,.288955003023148,.601047992706299,.218936994671822,.564589023590088,.41278201341629,.601029992103577,.257135003805161,.644559979438782,.427684992551804,.562039017677307,.448339998722076,.46306395530700695,.178560003638268,.54244601726532,.247308000922203,.542806029319763,.286267012357712,.532325029373169,.332827985286713,.5392879843711851,.368755996227264,.552793025970459,.398963987827301,.567345023155212,.476410001516342,.594193994998932,.189241006970406,.47607600688934304,.228962004184723,.651049017906189,.490725994110107,.43759900331497203,.404670000076294,.514867007732391,.019469000399113,.598435997962952,.426243007183075,.5795689821243291,.396993011236191,.451202988624573,.266469985246658,.6230229735374451,.439121007919312,.48104202747345004,.032313998788595,.355643033981323,.419054001569748,.612845003604889,.462783008813858,.49425303936004605,.238978996872902,.22025501728057895,.198220998048782,.16806197166442904,.107550002634525,.459244966506958,.183610007166862,.259742975234985,.134409993886948,.6663169860839839,.385764002799988,.11684602499008201,.490967005491257,.42062199115753196,.382384985685349,.491427004337311,.174399003386497,.602329015731812,.318785011768341,.60376501083374,.343364000320435,.599403023719788,.396100014448166,.28978300094604503,.187885001301765,.41146200895309404,.430987000465393,.05593502521514904,.318993002176285,.101714968681335,.266247987747192,.130298972129822,.500023007392883,.809423983097076,.499976992607117,.045547008514403964,.366169989109039,.601177990436554,.393207013607025,.6044629812240601,.410373002290726,.608919978141785,.194993004202843,.657898008823395,.388664990663528,.6377159953117371,.365961998701096,.644029021263123,.343364000320435,.6446430087089541,.318785011768341,.64165997505188,.301414996385574,.636843979358673,.058132998645306,.680923998355865,.301414996385574,.612550973892212,.499987989664078,.38156598806381203,.415838003158569,.375804007053375,.445681989192963,.43392300605773904,.465844005346298,.379359006881714,.49992299079895,.648476004600525,.288718998432159,.180054008960724,.335278987884521,.14718002080917403,.440512001514435,.09758102893829301,.128294005990028,.20805901288986195,.408771991729736,.6261060237884519,.455606997013092,.548198997974396,.499877005815506,.09100997447967496,.375436991453171,.07580798864364602,.11421000212431,.38497799634933505,.448662012815475,.30472201108932495,.4480200111866,.295367956161499,.447111994028091,.28419196605682395,.444831997156143,.269205987453461,.430011987686157,.23319101333618197,.406787008047104,.31432700157165505,.400738000869751,.318930983543396,.392399996519089,.32229697704315197,.367855995893478,.33608102798461903,.247923001646996,.39866697788238503,.452769994735718,.579150021076202,.43639200925827,.640112996101379,.416164010763168,.631286025047302,.413385987281799,.307633996009827,.228018000721931,.316428005695343,.468268007040024,.6473289728164671,.411361992359161,.195672988891602,.499989002943039,.530174970626831,.479153990745544,.557345986366272,.499974012374878,.5603629946708679,.432112008333206,.506411015987396,.499886006116867,.13308298587799094,.49991300702095,.17827099561691295,.456548988819122,.18079900741577104,.344549000263214,.254561007022858,.37890899181366,.425989985466003,.374292999505997,.219815015792847,.319687992334366,.42926204204559304,.357154995203018,.395730018615723,.295284003019333,.37841904163360596,.447750002145767,.137522995471954,.410986006259918,.491276979446411,.31395098567009,.22469198703765902,.354128003120422,.187447011470795,.324548006057739,.296007037162781,.189096003770828,.35370004177093495,.279776990413666,.28534197807312,.1338230073452,.317299008369446,.336768001317978,.35526698827743497,.429883986711502,.533478021621704,.455527991056442,.451377034187317,.437114000320435,.441103994846344,.467287987470627,.47007501125335704,.414712011814117,.6647800207138059,.37704598903656,.677222013473511,.344107985496521,.679849028587341,.312875986099243,.67766797542572,.283526003360748,.6668099761009221,.241245999932289,.617214024066925,.102986000478268,.531237006187439,.267612010240555,.575439989566803,.297879010438919,.5668240189552309,.333433985710144,.5661219954490659,.366427004337311,.573884010314941,.396012008190155,.583303987979889,.420121014118195,.58977198600769,.007561000064015,.519222974777222,.432949006557465,.43048202991485596,.458638995885849,.520910978317261,.473466008901596,.45425599813461304,.476087987422943,.43616998195648204,.468472003936768,.444943010807037,.433990985155106,.417638003826141,.483518004417419,.43701601028442405,.482482999563217,.42215096950530995,.42645001411438,.6102010011672969,.438998997211456,.60350501537323,.450067013502121,.599565982818604,.289712011814117,.631747007369995,.276670008897781,.636627018451691,.517862021923065,.528051972389221,.710287988185883,.6192359924316411,.526226997375488,.42609000205993697,.895093023777008,.745859026908875,.634069979190826,.590424001216888,.661242008209229,.58697497844696,.688880026340485,.590539991855621,.725341975688934,.6108689904212949,.606630027294159,.5962949991226201,.654766023159027,.655988991260529,.629905998706818,.6539239883422849,.680678009986877,.652734994888306,.702096998691559,.646408975124359,.75221198797226,.589195013046265,.602918028831482,.15713703632354703,.719901978969574,.6244000196456909,.893692970275879,.600040018558502,.790081977844238,.608645975589752,.643998026847839,.465512037277222,.528249025344849,.34959602355957,.525849997997284,.31980895996093806,.560214996337891,.342770993709564,.585384011268616,.33345901966095004,.549625992774963,.319139003753662,.57122802734375,.317308008670807,.624852001667023,.27190101146698,.513050019741058,.45271801948547397,.51509702205658,.472748041152954,.742246985435486,.685492992401123,.598631024360657,.545020997524261,.570338010787964,.451424956321716,.578631997108459,.46637701988220204,.723087012767792,.467945992946625,.516445994377136,.500361025333405,.662801027297974,.717082023620605,.70362401008606,.706728994846344,.830704987049103,.806186020374298,.552385985851288,.697431981563568,.607609987258911,.646112024784088,.645429015159607,.30329298973083496,.932694971561432,.269894957542419,.557260990142822,.427173972129822,.542901992797852,.415207982063293,.6180260181427,.305289030075073,.607590973377228,.305796980857849,.722943007946014,.7280369997024541,.577413976192474,.43683302402496305,.614082992076874,.7186130285263059,.616907000541687,.744113981723785,.668509006500244,.880086004734039,.770092010498047,.767979025840759,.635536015033722,.8107510209083559,.77039098739624,.7004439830780029,.826722025871277,.7212449908256531,.527121007442474,.33380198478698697,.553171992301941,.331472992897034,.577238023281097,.32611000537872303,.554691970348358,.41993403434753396,.611896991729736,.306038975715637,.59696102142334,.293460011482239,.596370995044708,.306046962738037,.539958000183105,.44286096096038796,.568841993808746,.307633996009827,.547818005084991,.307633996009827,.52461302280426,.307633996009827,.534089982509613,.22085899114608798,.527670979499817,.263774037361145,.526912987232208,.282142996788025,.526877999305725,.295374035835266,.526966989040375,.30472201108932495,.572058022022247,.30472201108932495,.573521018028259,.29646003246307395,.57683801651001,.28815400600433305,.581691026687622,.27993702888488803,.609944999217987,.36009001731872603,.986046016216278,.439965963363647,.5867999792099,.30460000038146995,.590372025966644,.29817700386047397,.531915009021759,.398463010787964,.577268004417419,.414065003395081,.536915004253387,.406213998794556,.627542972564697,.526647984981537,.665585994720459,.5040490031242371,.588353991508484,.45313799381256104,.757824003696442,.85232400894165,.709249973297119,.798492014408112,.672684013843536,.743418991565704,.600408971309662,.25099503993988004,.55826598405838,.738327980041504,.570303976535797,.812129020690918,.588165998458862,.890955984592438,.711045026779175,.601047992706299,.781069993972778,.564594984054565,.587247014045715,.601068019866943,.742869973182678,.644554018974304,.572156012058258,.562348008155823,.55186802148819,.46342998743057295,.821442008018494,.542443990707397,.752701997756958,.542818009853363,.71375697851181,.532373011112213,.66711300611496,.539327025413513,.631101012229919,.552846014499664,.6008620262146,.567526996135712,.523481011390686,.5943729877471919,.810747981071472,.476073980331421,.771045982837677,.6510409712791441,.509127020835876,.43728196620941195,.595292985439301,.514976024627686,.980530977249146,.598435997962952,.573499977588654,.579999983310699,.602994978427887,.45131200551986705,.733529984951019,.6230229735374451,.560611009597778,.48098301887512196,.967685997486115,.355643033981323,.580985009670258,.612839996814728,.537728011608124,.494614958763123,.760966002941132,.22024703025817904,.801778972148895,.16806197166442904,.892440974712372,.45923900604248,.816350996494293,.259739995002747,.865594983100891,.666312992572784,.614073991775513,.11675399541854903,.508952975273132,.42056202888488803,.617941975593567,.49168395996093806,.825608015060425,.602325022220612,.681214988231659,.60376501083374,.656635999679565,.599403023719788,.603900015354156,.28978300094604503,.81208598613739,.41146099567413297,.56801301240921,.05543500185012795,.681007981300354,.101714968681335,.733752012252808,.130298972129822,.633830010890961,.601177990436554,.606792986392975,.6044629812240601,.589659988880157,.6089379787445071,.805015981197357,.657891988754272,.611334979534149,.6377159953117371,.634037971496582,.644029021263123,.656635999679565,.6446430087089541,.681214988231659,.64165997505188,.698584973812103,.636843979358673,.941866993904114,.680923998355865,.698584973812103,.612550973892212,.584177017211914,.375892996788025,.554318010807037,.43392300605773904,.534153997898102,.37935996055603005,.711217999458313,.18002498149871804,.664629995822906,.14712899923324596,.559099972248077,.09736800193786599,.871706008911133,.20805901288986195,.591234028339386,.6261060237884519,.544341027736664,.548416018486023,.624562978744507,.07580798864364602,.88577002286911,.384971022605896,.551338016986847,.30472201108932495,.551980018615723,.295367956161499,.552887976169586,.28419196605682395,.555167973041534,.269205987453461,.569944024085999,.23296499252319303,.593203008174896,.31432402133941695,.599261999130249,.318930983543396,.607599973678589,.32229697704315197,.631937980651855,.33649998903274503,.752032995223999,.398684978485107,.547226011753082,.579604983329773,.563543975353241,.640172004699707,.583841025829315,.631286025047302,.586614012718201,.307633996009827,.771915018558502,.31642198562622104,.531597018241882,.647517025470734,.588370978832245,.19555902481079102,.52079701423645,.5574349761009221,.567984998226166,.5065209865570071,.543282985687256,.18074500560760498,.655317008495331,.25448501110076904,.621008992195129,.42598199844360396,.625559985637665,.21968799829483,.680198013782501,.42928099632263195,.64276397228241,.39566200971603405,.704662978649139,.378470003604889,.552012026309967,.13740801811218295,.589071989059448,.491362988948822,.685944974422455,.224642992019653,.645735025405884,.18735998868942305,.675342977046967,.29602199792861905,.810858011245728,.35369503498077404,.72012197971344,.28533303737640403,.866151988506317,.31729501485824596,.663187026977539,.35540300607681297,.570082008838654,.533674001693726,.544561982154846,.451624035835266,.562758982181549,.441215038299561,.531987011432648,.469859957695007,.585271000862122,.664822995662689,.622952997684479,.67722100019455,.655896008014679,.679836988449097,.687132000923157,.677654027938843,.716481983661652,.666799008846283,.758756995201111,.617213010787964,.897013008594513,.531230986118317,.732392013072968,.575452983379364,.70211398601532,.566837012767792,.66652500629425,.566133975982666,.633504986763,.5739120244979861,.603875994682312,.583413004875183,.579657971858978,.590054988861084,.992439985275269,.519222974777222,.567192018032074,.43058001995086703,.54136598110199,.521100997924805,.526564002037048,.453881978988647,.523913025856018,.43616998195648204,.531529009342194,.444943010807037,.566035985946655,.41767096519470204,.51631098985672,.43694603443145796,.5174720287323,.42212295532226596,.573594987392426,.610193014144897,.560697972774506,.604668021202087,.549755990505219,.6002489924430849,.710287988185883,.631747007369995,.723330020904541,.636627018451691];class uLt extends Kg{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(n=>new mLt(n)),this.register(n=>new SLt(n)),this.register(n=>new _Lt(n)),this.register(n=>new vLt(n)),this.register(n=>new yLt(n)),this.register(n=>new xLt(n)),this.register(n=>new bLt(n)),this.register(n=>new pLt(n)),this.register(n=>new wLt(n)),this.register(n=>new gLt(n)),this.register(n=>new dLt(n)),this.register(n=>new TLt(n)),this.register(n=>new CLt(n))}load(t,n,i,o){const a=this;let l;l=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:Fu.extractUrlBase(t),this.manager.itemStart(t);const c=function(h){o?o(h):console.error(h),a.manager.itemError(t),a.manager.itemEnd(t)},u=new QF(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(t,h=>{try{a.parse(h,l,d=>{n(d),a.manager.itemEnd(t)},c)}catch(d){c(d)}},i,c)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return!this.pluginCallbacks.includes(t)&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.includes(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,n,i,o){let a;const l={},c={};if(typeof t=="string")a=JSON.parse(t);else if(t instanceof ArrayBuffer)if(Fu.decodeText(new Uint8Array(t,0,4))===LB){try{l[Tn.KHR_BINARY_GLTF]=new kLt(t)}catch(h){return void(o&&o(h))}a=JSON.parse(l[Tn.KHR_BINARY_GLTF].content)}else a=JSON.parse(Fu.decodeText(new Uint8Array(t)));else a=t;if(a.asset===void 0||a.asset.version[0]<2)return void(o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const u=new PLt(a,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const d=this.pluginCallbacks[h](u);c[d.name]=d,l[d.name]=!0}if(a.extensionsUsed)for(let h=0;h<a.extensionsUsed.length;++h){const d=a.extensionsUsed[h],f=a.extensionsRequired||[];switch(d){case Tn.KHR_MATERIALS_UNLIT:l[d]=new fLt;break;case Tn.KHR_DRACO_MESH_COMPRESSION:l[d]=new $Lt(a,this.dracoLoader);break;case Tn.KHR_TEXTURE_TRANSFORM:l[d]=new ILt;break;case Tn.KHR_MESH_QUANTIZATION:l[d]=new ELt;break;default:f.includes(d)&&c[d]===void 0&&console.warn(`THREE.GLTFLoader: Unknown extension "${d}".`)}}u.setExtensions(l),u.setPlugins(c),u.parse(i,o)}parseAsync(t,n){const i=this;return new Promise((o,a)=>{i.parse(t,n,o,a)})}}function hLt(){let r={};return{get(t){return r[t]},add(t,n){r[t]=n},remove(t){delete r[t]},removeAll(){r={}}}}class dLt{constructor(t){this.parser=t,this.name=Tn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,n=this.parser.json.nodes||[];for(let i=0,o=n.length;i<o;i++){const a=n[i];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,a.extensions[this.name].light)}}_loadLight(t){const n=this.parser,i=`light:${t}`;let o=n.cache.get(i);if(o)return o;const a=n.json,l=((a.extensions&&a.extensions[this.name]||{}).lights||[])[t];let c;const u=new sn(16777215);l.color!==void 0&&u.fromArray(l.color);const h=l.range!==void 0?l.range:0;switch(l.type){case"directional":(c=new eP(u)).target.position.set(0,0,-1),c.add(c.target);break;case"point":(c=new Dkt(u)).distance=h;break;case"spot":(c=new Akt(u)).distance=h,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error(`THREE.GLTFLoader: Unexpected light type: ${l.type}`)}return c.position.set(0,0,0),c.decay=2,Jl(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=n.createUniqueName(l.name||`light_${t}`),o=Promise.resolve(c),n.cache.add(i,o),o}getDependency(t,n){if(t==="light")return this._loadLight(n)}createNodeAttachment(t){const n=this,i=this.parser,o=i.json.nodes[t],a=(o.extensions&&o.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(l=>i._getNodeRef(n.cache,a,l))}}class fLt{constructor(){this.name=Tn.KHR_MATERIALS_UNLIT}getMaterialType(){return hl}extendParams(t,n,i){const o=[];t.color=new sn(1,1,1),t.opacity=1;const a=n.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const l=a.baseColorFactor;t.color.fromArray(l),t.opacity=l[3]}a.baseColorTexture!==void 0&&o.push(i.assignTexture(t,"map",a.baseColorTexture,Dn))}return Promise.all(o)}}class pLt{constructor(t){this.parser=t,this.name=Tn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,n){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=i.extensions[this.name].emissiveStrength;return o!==void 0&&(n.emissiveIntensity=o),Promise.resolve()}}class mLt{constructor(t){this.parser=t,this.name=Tn.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const n=this.parser.json.materials[t];return n.extensions&&n.extensions[this.name]?Ih:null}extendMaterialParams(t,n){const i=this.parser,o=i.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],l=o.extensions[this.name];if(l.clearcoatFactor!==void 0&&(n.clearcoat=l.clearcoatFactor),l.clearcoatTexture!==void 0&&a.push(i.assignTexture(n,"clearcoatMap",l.clearcoatTexture)),l.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=l.clearcoatRoughnessFactor),l.clearcoatRoughnessTexture!==void 0&&a.push(i.assignTexture(n,"clearcoatRoughnessMap",l.clearcoatRoughnessTexture)),l.clearcoatNormalTexture!==void 0&&(a.push(i.assignTexture(n,"clearcoatNormalMap",l.clearcoatNormalTexture)),l.clearcoatNormalTexture.scale!==void 0)){const c=l.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new $n(c,c)}return Promise.all(a)}}class gLt{constructor(t){this.parser=t,this.name=Tn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const n=this.parser.json.materials[t];return n.extensions&&n.extensions[this.name]?Ih:null}extendMaterialParams(t,n){const i=this.parser,o=i.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],l=o.extensions[this.name];return l.iridescenceFactor!==void 0&&(n.iridescence=l.iridescenceFactor),l.iridescenceTexture!==void 0&&a.push(i.assignTexture(n,"iridescenceMap",l.iridescenceTexture)),l.iridescenceIor!==void 0&&(n.iridescenceIOR=l.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),l.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=l.iridescenceThicknessMinimum),l.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=l.iridescenceThicknessMaximum),l.iridescenceThicknessTexture!==void 0&&a.push(i.assignTexture(n,"iridescenceThicknessMap",l.iridescenceThicknessTexture)),Promise.all(a)}}class vLt{constructor(t){this.parser=t,this.name=Tn.KHR_MATERIALS_SHEEN}getMaterialType(t){const n=this.parser.json.materials[t];return n.extensions&&n.extensions[this.name]?Ih:null}extendMaterialParams(t,n){const i=this.parser,o=i.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[];n.sheenColor=new sn(0,0,0),n.sheenRoughness=0,n.sheen=1;const l=o.extensions[this.name];return l.sheenColorFactor!==void 0&&n.sheenColor.fromArray(l.sheenColorFactor),l.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=l.sheenRoughnessFactor),l.sheenColorTexture!==void 0&&a.push(i.assignTexture(n,"sheenColorMap",l.sheenColorTexture,Dn)),l.sheenRoughnessTexture!==void 0&&a.push(i.assignTexture(n,"sheenRoughnessMap",l.sheenRoughnessTexture)),Promise.all(a)}}class yLt{constructor(t){this.parser=t,this.name=Tn.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const n=this.parser.json.materials[t];return n.extensions&&n.extensions[this.name]?Ih:null}extendMaterialParams(t,n){const i=this.parser,o=i.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],l=o.extensions[this.name];return l.transmissionFactor!==void 0&&(n.transmission=l.transmissionFactor),l.transmissionTexture!==void 0&&a.push(i.assignTexture(n,"transmissionMap",l.transmissionTexture)),Promise.all(a)}}class xLt{constructor(t){this.parser=t,this.name=Tn.KHR_MATERIALS_VOLUME}getMaterialType(t){const n=this.parser.json.materials[t];return n.extensions&&n.extensions[this.name]?Ih:null}extendMaterialParams(t,n){const i=this.parser,o=i.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],l=o.extensions[this.name];n.thickness=l.thicknessFactor!==void 0?l.thicknessFactor:0,l.thicknessTexture!==void 0&&a.push(i.assignTexture(n,"thicknessMap",l.thicknessTexture)),n.attenuationDistance=l.attenuationDistance||1/0;const c=l.attenuationColor||[1,1,1];return n.attenuationColor=new sn(c[0],c[1],c[2]),Promise.all(a)}}class bLt{constructor(t){this.parser=t,this.name=Tn.KHR_MATERIALS_IOR}getMaterialType(t){const n=this.parser.json.materials[t];return n.extensions&&n.extensions[this.name]?Ih:null}extendMaterialParams(t,n){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=i.extensions[this.name];return n.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class wLt{constructor(t){this.parser=t,this.name=Tn.KHR_MATERIALS_SPECULAR}getMaterialType(t){const n=this.parser.json.materials[t];return n.extensions&&n.extensions[this.name]?Ih:null}extendMaterialParams(t,n){const i=this.parser,o=i.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],l=o.extensions[this.name];n.specularIntensity=l.specularFactor!==void 0?l.specularFactor:1,l.specularTexture!==void 0&&a.push(i.assignTexture(n,"specularIntensityMap",l.specularTexture));const c=l.specularColorFactor||[1,1,1];return n.specularColor=new sn(c[0],c[1],c[2]),l.specularColorTexture!==void 0&&a.push(i.assignTexture(n,"specularColorMap",l.specularColorTexture,Dn)),Promise.all(a)}}class SLt{constructor(t){this.parser=t,this.name=Tn.KHR_TEXTURE_BASISU}loadTexture(t){const n=this.parser,i=n.json,o=i.textures[t];if(!o.extensions||!o.extensions[this.name])return null;const a=o.extensions[this.name],l=n.options.ktx2Loader;if(!l){if(i.extensionsRequired&&i.extensionsRequired.includes(this.name))throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(t,a.source,l)}}class _Lt{constructor(t){this.parser=t,this.name=Tn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const n=this.name,i=this.parser,o=i.json,a=o.textures[t];if(!a.extensions||!a.extensions[n])return null;const l=a.extensions[n],c=o.images[l.source];let u=i.textureLoader;if(c.uri){const h=i.options.manager.getHandler(c.uri);h!==null&&(u=h)}return this.detectSupport().then(h=>{if(h)return i.loadTextureImage(t,l.source,u);if(o.extensionsRequired&&o.extensionsRequired.includes(n))throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(t=>{const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){t(n.height===1)}})),this.isSupported}}class TLt{constructor(t){this.name=Tn.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const n=this.parser.json,i=n.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const o=i.extensions[this.name],a=this.parser.getDependency("buffer",o.buffer),l=this.parser.options.meshoptDecoder;if(!l||!l.supported){if(n.extensionsRequired&&n.extensionsRequired.includes(this.name))throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return a.then(c=>{const u=o.byteOffset||0,h=o.byteLength||0,d=o.count,f=o.byteStride,p=new Uint8Array(c,u,h);return l.decodeGltfBufferAsync?l.decodeGltfBufferAsync(d,f,p,o.mode,o.filter).then(m=>m.buffer):l.ready.then(()=>{const m=new ArrayBuffer(d*f);return l.decodeGltfBuffer(new Uint8Array(m),d,f,p,o.mode,o.filter),m})})}return null}}class CLt{constructor(t){this.name=Tn.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const n=this.parser.json,i=n.nodes[t];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const o=n.meshes[i.mesh];for(const u of o.primitives)if(u.mode!==eo.TRIANGLES&&u.mode!==eo.TRIANGLE_STRIP&&u.mode!==eo.TRIANGLE_FAN&&u.mode!==void 0)return null;const a=i.extensions[this.name].attributes,l=[],c={};for(const u in a)l.push(this.parser.getDependency("accessor",a[u]).then(h=>(c[u]=h,c[u])));return l.length<1?null:(l.push(this.parser.createNodeMesh(t)),Promise.all(l).then(u=>{const h=u.pop(),d=h.isGroup?h.children:[h],f=u[0].count,p=[];for(const m of d){const g=new pn,y=new yt,v=new qc,x=new yt(1,1,1),b=new dkt(m.geometry,m.material,f);for(let w=0;w<f;w++)c.TRANSLATION&&y.fromBufferAttribute(c.TRANSLATION,w),c.ROTATION&&v.fromBufferAttribute(c.ROTATION,w),c.SCALE&&x.fromBufferAttribute(c.SCALE,w),b.setMatrixAt(w,g.compose(y,v,x));for(const w in c)w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&m.geometry.setAttribute(w,c[w]);as.prototype.copy.call(b,m),b.frustumCulled=!1,this.parser.assignFinalMaterial(b),p.push(b)}return h.isGroup?(h.clear(),h.add(...p),h):p[0]}))}}const LB="glTF",mp=12,jA={JSON:1313821514,BIN:5130562};class kLt{constructor(t){this.name=Tn.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(t,0,mp);if(this.header={magic:Fu.decodeText(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==LB)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-mp,o=new DataView(t,mp);let a=0;for(;a<i;){const l=o.getUint32(a,!0);a+=4;const c=o.getUint32(a,!0);if(a+=4,c===jA.JSON){const u=new Uint8Array(t,mp+a,l);this.content=Fu.decodeText(u)}else if(c===jA.BIN){const u=mp+a;this.body=t.slice(u,u+l)}a+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class $Lt{constructor(t,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Tn.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(t,n){const i=this.json,o=this.dracoLoader,a=t.extensions[this.name].bufferView,l=t.extensions[this.name].attributes,c={},u={},h={};for(const d in l){const f=uS[d]||d.toLowerCase();c[f]=l[d]}for(const d in t.attributes){const f=uS[d]||d.toLowerCase();if(l[d]!==void 0){const p=i.accessors[t.attributes[d]],m=Nd[p.componentType];h[f]=m.name,u[f]=p.normalized===!0}}return n.getDependency("bufferView",a).then(d=>new Promise(f=>{o.decodeDracoFile(d,p=>{for(const m in p.attributes){const g=p.attributes[m],y=u[m];y!==void 0&&(g.normalized=y)}f(p)},c,h)}))}}class ILt{constructor(){this.name=Tn.KHR_TEXTURE_TRANSFORM}extendTexture(t,n){return n.texCoord!==void 0&&console.warn(`THREE.GLTFLoader: Custom UV sets in "${this.name}" extension not yet supported.`),n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(t=t.clone(),n.offset!==void 0&&t.offset.fromArray(n.offset),n.rotation!==void 0&&(t.rotation=n.rotation),n.scale!==void 0&&t.repeat.fromArray(n.scale),t.needsUpdate=!0),t}}class ELt{constructor(){this.name=Tn.KHR_MESH_QUANTIZATION}}class FB extends qg{constructor(t,n,i,o){super(t,n,i,o)}copySampleValue_(t){const n=this.resultBuffer,i=this.sampleValues,o=this.valueSize,a=t*o*3+o;for(let l=0;l!==o;l++)n[l]=i[a+l];return n}interpolate_(t,n,i,o){const a=this.resultBuffer,l=this.sampleValues,c=this.valueSize,u=2*c,h=3*c,d=o-n,f=(i-n)/d,p=f*f,m=p*f,g=t*h,y=g-h,v=-2*m+3*p,x=m-p,b=1-v,w=x-p+f;for(let S=0;S!==c;S++){const _=l[y+S+c],$=l[y+S+u]*d,N=l[g+S+c],k=l[g+S]*d;a[S]=b*_+w*$+v*N+x*k}return a}}const NLt=new qc;class ALt extends FB{interpolate_(t,n,i,o){const a=super.interpolate_(t,n,i,o);return NLt.fromArray(a).normalize().toArray(a),a}}const eo={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Nd={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},qA={9728:rr,9729:Mr,9984:Iw,9985:CF,9986:k1,9987:nh},KA={33071:io,33648:I2,10497:Xd},jb={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},uS={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Xl={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},MLt={CUBICSPLINE:void 0,LINEAR:Zd,STEP:am},qb={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function DLt(r){return r.DefaultMaterial===void 0&&(r.DefaultMaterial=new $C({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ec})),r.DefaultMaterial}function gp(r,t,n){for(const i in n.extensions)r[i]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function Jl(r,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(r.userData,t.extras):console.warn(`THREE.GLTFLoader: Ignoring primitive type .extras, ${t.extras}`))}function RLt(r,t,n){let i=!1,o=!1,a=!1;for(let h=0,d=t.length;h<d;h++){const f=t[h];if(f.POSITION!==void 0&&(i=!0),f.NORMAL!==void 0&&(o=!0),f.COLOR_0!==void 0&&(a=!0),i&&o&&a)break}if(!i&&!o&&!a)return Promise.resolve(r);const l=[],c=[],u=[];for(let h=0,d=t.length;h<d;h++){const f=t[h];if(i){const p=f.POSITION!==void 0?n.getDependency("accessor",f.POSITION):r.attributes.position;l.push(p)}if(o){const p=f.NORMAL!==void 0?n.getDependency("accessor",f.NORMAL):r.attributes.normal;c.push(p)}if(a){const p=f.COLOR_0!==void 0?n.getDependency("accessor",f.COLOR_0):r.attributes.color;u.push(p)}}return Promise.all([Promise.all(l),Promise.all(c),Promise.all(u)]).then(h=>{const d=h[0],f=h[1],p=h[2];return i&&(r.morphAttributes.position=d),o&&(r.morphAttributes.normal=f),a&&(r.morphAttributes.color=p),r.morphTargetsRelative=!0,r})}function OLt(r,t){if(r.updateMorphTargets(),t.weights!==void 0)for(let n=0,i=t.weights.length;n<i;n++)r.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(r.morphTargetInfluences.length===n.length){r.morphTargetDictionary={};for(let i=0,o=n.length;i<o;i++)r.morphTargetDictionary[n[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function LLt(r){const t=r.extensions&&r.extensions[Tn.KHR_DRACO_MESH_COMPRESSION];return t?`draco:${t.bufferView}:${t.indices}:${XA(t.attributes)}`:`${r.indices}:${XA(r.attributes)}:${r.mode}`}function XA(r){let t="";const n=Object.keys(r).sort();for(let i=0,o=n.length;i<o;i++)t+=`${n[i]}:${r[n[i]]};`;return t}function hS(r){switch(r){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function FLt(r){return r.search(/\.jpe?g($|\?)/i)>0||r.search(/^data\:image\/jpeg/)===0?"image/jpeg":r.search(/\.webp($|\?)/i)>0||r.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class PLt{constructor(t={},n={}){this.json=t,this.extensions={},this.plugins={},this.options=n,this.cache=new hLt,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,o=!1,a=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,a=(o=navigator.userAgent.includes("Firefox"))?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||o&&a<98?this.textureLoader=new tP(this.options.manager):this.textureLoader=new Lkt(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new QF(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,n){const i=this,o=this.json,a=this.extensions;this.cache.removeAll(),this._invokeAll(l=>l._markDefs&&l._markDefs()),Promise.all(this._invokeAll(l=>l.beforeRoot&&l.beforeRoot())).then(()=>Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])).then(l=>{const c={scene:l[0][o.scene||0],scenes:l[0],animations:l[1],cameras:l[2],asset:o.asset,parser:i,userData:{}};gp(a,c,o),Jl(c,o),Promise.all(i._invokeAll(u=>u.afterRoot&&u.afterRoot(c))).then(()=>{t(c)})}).catch(n)}_markDefs(){const t=this.json.nodes||[],n=this.json.skins||[],i=this.json.meshes||[];for(let o=0,a=n.length;o<a;o++){const l=n[o].joints;for(let c=0,u=l.length;c<u;c++)t[l[c]].isBone=!0}for(let o=0,a=t.length;o<a;o++){const l=t[o];l.mesh!==void 0&&(this._addNodeRef(this.meshCache,l.mesh),l.skin!==void 0&&(i[l.mesh].isSkinnedMesh=!0)),l.camera!==void 0&&this._addNodeRef(this.cameraCache,l.camera)}}_addNodeRef(t,n){n!==void 0&&(t.refs[n]===void 0&&(t.refs[n]=t.uses[n]=0),t.refs[n]++)}_getNodeRef(t,n,i){if(t.refs[n]<=1)return i;const o=i.clone(),a=(l,c)=>{const u=this.associations.get(l);u!=null&&this.associations.set(c,u);for(const[h,d]of l.children.entries())a(d,c.children[h])};return a(i,o),o.name+=`_instance_${t.uses[n]++}`,o}_invokeOne(t){const n=Object.values(this.plugins);n.push(this);for(let i=0;i<n.length;i++){const o=t(n[i]);if(o)return o}return null}_invokeAll(t){const n=Object.values(this.plugins);n.unshift(this);const i=[];for(let o=0;o<n.length;o++){const a=t(n[o]);a&&i.push(a)}return i}getDependency(t,n){const i=`${t}:${n}`;let o=this.cache.get(i);if(!o){switch(t){case"scene":o=this.loadScene(n);break;case"node":o=this.loadNode(n);break;case"mesh":o=this._invokeOne(a=>a.loadMesh&&a.loadMesh(n));break;case"accessor":o=this.loadAccessor(n);break;case"bufferView":o=this._invokeOne(a=>a.loadBufferView&&a.loadBufferView(n));break;case"buffer":o=this.loadBuffer(n);break;case"material":o=this._invokeOne(a=>a.loadMaterial&&a.loadMaterial(n));break;case"texture":o=this._invokeOne(a=>a.loadTexture&&a.loadTexture(n));break;case"skin":o=this.loadSkin(n);break;case"animation":o=this._invokeOne(a=>a.loadAnimation&&a.loadAnimation(n));break;case"camera":o=this.loadCamera(n);break;default:if(!(o=this._invokeOne(function(a){return a!=this&&a.getDependency&&a.getDependency(t,n)})))throw new Error(`Unknown type: ${t}`)}this.cache.add(i,o)}return o}getDependencies(t){let n=this.cache.get(t);if(!n){const i=this,o=this.json[t+(t==="mesh"?"es":"s")]||[];n=Promise.all(o.map((a,l)=>i.getDependency(t,l))),this.cache.add(t,n)}return n}loadBuffer(t){const n=this.json.buffers[t],i=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error(`THREE.GLTFLoader: ${n.type} buffer type is not supported.`);if(n.uri===void 0&&t===0)return Promise.resolve(this.extensions[Tn.KHR_BINARY_GLTF].body);const o=this.options;return new Promise((a,l)=>{i.load(Fu.resolveURL(n.uri,o.path),a,void 0,()=>{l(new Error(`THREE.GLTFLoader: Failed to load buffer "${n.uri}".`))})})}loadBufferView(t){const n=this.json.bufferViews[t];return this.getDependency("buffer",n.buffer).then(i=>{const o=n.byteLength||0,a=n.byteOffset||0;return i.slice(a,a+o)})}loadAccessor(t){const n=this,i=this.json,o=this.json.accessors[t];if(o.bufferView===void 0&&o.sparse===void 0){const l=jb[o.type],c=Nd[o.componentType],u=o.normalized===!0,h=new c(o.count*l);return Promise.resolve(new ti(h,l,u))}const a=[];return o.bufferView!==void 0?a.push(this.getDependency("bufferView",o.bufferView)):a.push(null),o.sparse!==void 0&&(a.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(a).then(l=>{const c=l[0],u=jb[o.type],h=Nd[o.componentType],d=h.BYTES_PER_ELEMENT,f=d*u,p=o.byteOffset||0,m=o.bufferView!==void 0?i.bufferViews[o.bufferView].byteStride:void 0,g=o.normalized===!0;let y,v;if(m&&m!==f){const x=Math.floor(p/m),b=`InterleavedBuffer:${o.bufferView}:${o.componentType}:${x}:${o.count}`;let w=n.cache.get(b);w||(y=new h(c,x*m,o.count*m/d),w=new okt(y,m/d),n.cache.add(b,w)),v=new TC(w,u,p%m/d,g)}else y=c===null?new h(o.count*u):new h(c,p,o.count*u),v=new ti(y,u,g);if(o.sparse!==void 0){const x=jb.SCALAR,b=Nd[o.sparse.indices.componentType],w=o.sparse.indices.byteOffset||0,S=o.sparse.values.byteOffset||0,_=new b(l[1],w,o.sparse.count*x),$=new h(l[2],S,o.sparse.count*u);c!==null&&(v=new ti(v.array.slice(),v.itemSize,v.normalized));for(let N=0,k=_.length;N<k;N++){const I=_[N];if(v.setX(I,$[N*u]),u>=2&&v.setY(I,$[N*u+1]),u>=3&&v.setZ(I,$[N*u+2]),u>=4&&v.setW(I,$[N*u+3]),u>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(t){const n=this.json,i=this.options,o=n.textures[t].source,a=n.images[o];let l=this.textureLoader;if(a.uri){const c=i.manager.getHandler(a.uri);c!==null&&(l=c)}return this.loadTextureImage(t,o,l)}loadTextureImage(t,n,i){const o=this,a=this.json,l=a.textures[t],c=a.images[n],u=`${c.uri||c.bufferView}:${l.sampler}`;if(this.textureCache[u])return this.textureCache[u];const h=this.loadImageSource(n,i).then(d=>{d.flipY=!1,d.name=l.name||c.name||"";const f=(a.samplers||{})[l.sampler]||{};return d.magFilter=qA[f.magFilter]||Mr,d.minFilter=qA[f.minFilter]||nh,d.wrapS=KA[f.wrapS]||Xd,d.wrapT=KA[f.wrapT]||Xd,o.associations.set(d,{textures:t}),d}).catch(()=>null);return this.textureCache[u]=h,h}loadImageSource(t,n){const i=this,o=this.json,a=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(f=>f.clone());const l=o.images[t],c=self.URL||self.webkitURL;let u=l.uri||"",h=!1;if(l.bufferView!==void 0)u=i.getDependency("bufferView",l.bufferView).then(f=>{h=!0;const p=new Blob([f],{type:l.mimeType});return u=c.createObjectURL(p)});else if(l.uri===void 0)throw new Error(`THREE.GLTFLoader: Image ${t} is missing URI and bufferView`);const d=Promise.resolve(u).then(f=>new Promise((p,m)=>{let g=p;n.isImageBitmapLoader===!0&&(g=function(y){const v=new lr(y);v.needsUpdate=!0,p(v)}),n.load(Fu.resolveURL(f,a.path),g,void 0,m)})).then(f=>(h===!0&&c.revokeObjectURL(u),f.userData.mimeType=l.mimeType||FLt(l.uri),f)).catch(f=>{throw console.error("THREE.GLTFLoader: Couldn't load texture",u),f});return this.sourceCache[t]=d,d}assignTexture(t,n,i,o){const a=this;return this.getDependency("texture",i.index).then(l=>{if(!l)return null;if(i.texCoord===void 0||i.texCoord==0||n==="aoMap"&&i.texCoord==1||console.warn(`THREE.GLTFLoader: Custom UV set ${i.texCoord} for texture ${n} not yet supported.`),a.extensions[Tn.KHR_TEXTURE_TRANSFORM]){const c=i.extensions!==void 0?i.extensions[Tn.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const u=a.associations.get(l);l=a.extensions[Tn.KHR_TEXTURE_TRANSFORM].extendTexture(l,c),a.associations.set(l,u)}}return o!==void 0&&(l.encoding=o),t[n]=l,l})}assignFinalMaterial(t){const n=t.geometry;let i=t.material;const o=n.attributes.tangent===void 0,a=n.attributes.color!==void 0,l=n.attributes.normal===void 0;if(t.isPoints){const c=`PointsMaterial:${i.uuid}`;let u=this.cache.get(c);u||(u=new XF,Oa.prototype.copy.call(u,i),u.color.copy(i.color),u.map=i.map,u.sizeAttenuation=!1,this.cache.add(c,u)),i=u}else if(t.isLine){const c=`LineBasicMaterial:${i.uuid}`;let u=this.cache.get(c);u||(u=new KF,Oa.prototype.copy.call(u,i),u.color.copy(i.color),this.cache.add(c,u)),i=u}if(o||a||l){let c=`ClonedMaterial:${i.uuid}:`;o&&(c+="derivative-tangents:"),a&&(c+="vertex-colors:"),l&&(c+="flat-shading:");let u=this.cache.get(c);u||(u=i.clone(),a&&(u.vertexColors=!0),l&&(u.flatShading=!0),o&&(u.normalScale&&(u.normalScale.y*=-1),u.clearcoatNormalScale&&(u.clearcoatNormalScale.y*=-1)),this.cache.add(c,u),this.associations.set(u,this.associations.get(i))),i=u}i.aoMap&&n.attributes.uv2===void 0&&n.attributes.uv!==void 0&&n.setAttribute("uv2",n.attributes.uv),t.material=i}getMaterialType(){return $C}loadMaterial(t){const n=this,i=this.json,o=this.extensions,a=i.materials[t];let l;const c={},u=[];if((a.extensions||{})[Tn.KHR_MATERIALS_UNLIT]){const d=o[Tn.KHR_MATERIALS_UNLIT];l=d.getMaterialType(),u.push(d.extendParams(c,a,n))}else{const d=a.pbrMetallicRoughness||{};if(c.color=new sn(1,1,1),c.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;c.color.fromArray(f),c.opacity=f[3]}d.baseColorTexture!==void 0&&u.push(n.assignTexture(c,"map",d.baseColorTexture,Dn)),c.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,c.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(u.push(n.assignTexture(c,"metalnessMap",d.metallicRoughnessTexture)),u.push(n.assignTexture(c,"roughnessMap",d.metallicRoughnessTexture))),l=this._invokeOne(f=>f.getMaterialType&&f.getMaterialType(t)),u.push(Promise.all(this._invokeAll(f=>f.extendMaterialParams&&f.extendMaterialParams(t,c))))}a.doubleSided===!0&&(c.side=Ly);const h=a.alphaMode||qb.OPAQUE;if(h===qb.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,h===qb.MASK&&(c.alphaTest=a.alphaCutoff!==void 0?a.alphaCutoff:.5)),a.normalTexture!==void 0&&l!==hl&&(u.push(n.assignTexture(c,"normalMap",a.normalTexture)),c.normalScale=new $n(1,1),a.normalTexture.scale!==void 0)){const d=a.normalTexture.scale;c.normalScale.set(d,d)}return a.occlusionTexture!==void 0&&l!==hl&&(u.push(n.assignTexture(c,"aoMap",a.occlusionTexture)),a.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=a.occlusionTexture.strength)),a.emissiveFactor!==void 0&&l!==hl&&(c.emissive=new sn().fromArray(a.emissiveFactor)),a.emissiveTexture!==void 0&&l!==hl&&u.push(n.assignTexture(c,"emissiveMap",a.emissiveTexture,Dn)),Promise.all(u).then(()=>{const d=new l(c);return a.name&&(d.name=a.name),Jl(d,a),n.associations.set(d,{materials:t}),a.extensions&&gp(o,d,a),d})}createUniqueName(t){const n=Ln.sanitizeNodeName(t||"");let i=n;for(let o=1;this.nodeNamesUsed[i];++o)i=`${n}_${o}`;return this.nodeNamesUsed[i]=!0,i}loadGeometries(t){const n=this,i=this.extensions,o=this.primitiveCache;function a(c){return i[Tn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,n).then(u=>YA(u,c,n))}const l=[];for(let c=0,u=t.length;c<u;c++){const h=t[c],d=LLt(h),f=o[d];if(f)l.push(f.promise);else{let p;p=h.extensions&&h.extensions[Tn.KHR_DRACO_MESH_COMPRESSION]?a(h):YA(new ua,h,n),o[d]={primitive:h,promise:p},l.push(p)}}return Promise.all(l)}loadMesh(t){const n=this,i=this.json,o=this.extensions,a=i.meshes[t],l=a.primitives,c=[];for(let u=0,h=l.length;u<h;u++){const d=l[u].material===void 0?DLt(this.cache):this.getDependency("material",l[u].material);c.push(d)}return c.push(n.loadGeometries(l)),Promise.all(c).then(u=>{const h=u.slice(0,u.length-1),d=u[u.length-1],f=[];for(let m=0,g=d.length;m<g;m++){const y=d[m],v=l[m];let x;const b=h[m];if(v.mode===eo.TRIANGLES||v.mode===eo.TRIANGLE_STRIP||v.mode===eo.TRIANGLE_FAN||v.mode===void 0)(x=a.isSkinnedMesh===!0?new lkt(y,b):new mi(y,b)).isSkinnedMesh!==!0||x.geometry.attributes.skinWeight.normalized||x.normalizeSkinWeights(),v.mode===eo.TRIANGLE_STRIP?x.geometry=ZA(x.geometry,Vwt):v.mode===eo.TRIANGLE_FAN&&(x.geometry=ZA(x.geometry,$F));else if(v.mode===eo.LINES)x=new fkt(y,b);else if(v.mode===eo.LINE_STRIP)x=new kC(y,b);else if(v.mode===eo.LINE_LOOP)x=new pkt(y,b);else{if(v.mode!==eo.POINTS)throw new Error(`THREE.GLTFLoader: Primitive mode unsupported: ${v.mode}`);x=new mkt(y,b)}Object.keys(x.geometry.morphAttributes).length>0&&OLt(x,a),x.name=n.createUniqueName(a.name||`mesh_${t}`),Jl(x,a),v.extensions&&gp(o,x,v),n.assignFinalMaterial(x),f.push(x)}for(let m=0,g=f.length;m<g;m++)n.associations.set(f[m],{meshes:t,primitives:m});if(f.length===1)return f[0];const p=new _u;n.associations.set(p,{meshes:t});for(let m=0,g=f.length;m<g;m++)p.add(f[m]);return p})}loadCamera(t){let n;const i=this.json.cameras[t],o=i[i.type];if(o)return i.type==="perspective"?n=new hi(iSt.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):i.type==="orthographic"&&(n=new By(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),i.name&&(n.name=this.createUniqueName(i.name)),Jl(n,i),Promise.resolve(n);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){const n=this.json.skins[t],i=[];for(let o=0,a=n.joints.length;o<a;o++)i.push(this.getDependency("node",n.joints[o]));return n.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",n.inverseBindMatrices)):i.push(null),Promise.all(i).then(o=>{const a=o.pop(),l=o,c=[],u=[];for(let h=0,d=l.length;h<d;h++){const f=l[h];if(f){c.push(f);const p=new pn;a!==null&&p.fromArray(a.array,16*h),u.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[h])}return new CC(c,u)})}loadAnimation(t){const n=this.json.animations[t],i=[],o=[],a=[],l=[],c=[];for(let u=0,h=n.channels.length;u<h;u++){const d=n.channels[u],f=n.samplers[d.sampler],p=d.target,m=p.node,g=n.parameters!==void 0?n.parameters[f.input]:f.input,y=n.parameters!==void 0?n.parameters[f.output]:f.output;i.push(this.getDependency("node",m)),o.push(this.getDependency("accessor",g)),a.push(this.getDependency("accessor",y)),l.push(f),c.push(p)}return Promise.all([Promise.all(i),Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c)]).then(u=>{const h=u[0],d=u[1],f=u[2],p=u[3],m=u[4],g=[];for(let v=0,x=h.length;v<x;v++){const b=h[v],w=d[v],S=f[v],_=p[v],$=m[v];if(b===void 0)continue;let N;switch(b.updateMatrix(),Xl[$.path]){case Xl.weights:N=hm;break;case Xl.rotation:N=ah;break;case Xl.position:case Xl.scale:default:N=dm}const k=b.name?b.name:b.uuid,I=_.interpolation!==void 0?MLt[_.interpolation]:Zd,O=[];Xl[$.path]===Xl.weights?b.traverse(F=>{F.morphTargetInfluences&&O.push(F.name?F.name:F.uuid)}):O.push(k);let B=S.array;if(S.normalized){const F=hS(B.constructor),D=new Float32Array(B.length);for(let L=0,V=B.length;L<V;L++)D[L]=B[L]*F;B=D}for(let F=0,D=O.length;F<D;F++){const L=new N(`${O[F]}.${Xl[$.path]}`,w.array,B,I);_.interpolation==="CUBICSPLINE"&&(L.createInterpolant=function(V){return new(this instanceof ah?ALt:FB)(this.times,this.values,this.getValueSize()/3,V)},L.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),g.push(L)}}const y=n.name?n.name:`animation_${t}`;return new Skt(y,void 0,g)})}createNodeMesh(t){const n=this.json,i=this,o=n.nodes[t];return o.mesh===void 0?null:i.getDependency("mesh",o.mesh).then(a=>{const l=i._getNodeRef(i.meshCache,o.mesh,a);return o.weights!==void 0&&l.traverse(c=>{if(c.isMesh)for(let u=0,h=o.weights.length;u<h;u++)c.morphTargetInfluences[u]=o.weights[u]}),l})}loadNode(t){const n=this.json,i=this.extensions,o=this,a=n.nodes[t],l=a.name?o.createUniqueName(a.name):"";return function(){const c=[],u=o._invokeOne(h=>h.createNodeMesh&&h.createNodeMesh(t));return u&&c.push(u),a.camera!==void 0&&c.push(o.getDependency("camera",a.camera).then(h=>o._getNodeRef(o.cameraCache,a.camera,h))),o._invokeAll(h=>h.createNodeAttachment&&h.createNodeAttachment(t)).forEach(h=>{c.push(h)}),Promise.all(c)}().then(c=>{let u;if((u=a.isBone===!0?new qF:c.length>1?new _u:c.length===1?c[0]:new as)!==c[0])for(let h=0,d=c.length;h<d;h++)u.add(c[h]);if(a.name&&(u.userData.name=a.name,u.name=l),Jl(u,a),a.extensions&&gp(i,u,a),a.matrix!==void 0){const h=new pn;h.fromArray(a.matrix),u.applyMatrix4(h)}else a.translation!==void 0&&u.position.fromArray(a.translation),a.rotation!==void 0&&u.quaternion.fromArray(a.rotation),a.scale!==void 0&&u.scale.fromArray(a.scale);return o.associations.has(u)||o.associations.set(u,{}),o.associations.get(u).nodes=t,u})}loadScene(t){const n=this.json,i=this.extensions,o=this.json.scenes[t],a=this,l=new _u;o.name&&(l.name=a.createUniqueName(o.name)),Jl(l,o),o.extensions&&gp(i,l,o);const c=o.nodes||[],u=[];for(let h=0,d=c.length;h<d;h++)u.push(PB(c[h],l,n,a));return Promise.all(u).then(()=>(a.associations=(h=>{const d=new Map;for(const[f,p]of a.associations)(f instanceof Oa||f instanceof lr)&&d.set(f,p);return h.traverse(f=>{const p=a.associations.get(f);p!=null&&d.set(f,p)}),d})(l),l))}}function PB(r,t,n,i){const o=n.nodes[r];return i.getDependency("node",r).then(a=>o.skin===void 0?a:i.getDependency("skin",o.skin).then(l=>(a.traverse(c=>{c.isSkinnedMesh&&c.bind(l,c.matrixWorld)}),a))).then(a=>{t.add(a);const l=[];if(o.children){const c=o.children;for(let u=0,h=c.length;u<h;u++){const d=c[u];l.push(PB(d,a,n,i))}}return Promise.all(l)})}function BLt(r,t,n){const i=t.attributes,o=new $h;if(i.POSITION===void 0)return;{const c=n.json.accessors[i.POSITION],u=c.min,h=c.max;if(u===void 0||h===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(o.set(new yt(u[0],u[1],u[2]),new yt(h[0],h[1],h[2])),c.normalized){const d=hS(Nd[c.componentType]);o.min.multiplyScalar(d),o.max.multiplyScalar(d)}}const a=t.targets;if(a!==void 0){const c=new yt,u=new yt;for(let h=0,d=a.length;h<d;h++){const f=a[h];if(f.POSITION!==void 0){const p=n.json.accessors[f.POSITION],m=p.min,g=p.max;if(m!==void 0&&g!==void 0){if(u.setX(Math.max(Math.abs(m[0]),Math.abs(g[0]))),u.setY(Math.max(Math.abs(m[1]),Math.abs(g[1]))),u.setZ(Math.max(Math.abs(m[2]),Math.abs(g[2]))),p.normalized){const y=hS(Nd[p.componentType]);u.multiplyScalar(y)}c.max(u)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(c)}r.boundingBox=o;const l=new If;o.getCenter(l.center),l.radius=o.min.distanceTo(o.max)/2,r.boundingSphere=l}function YA(r,t,n){const i=t.attributes,o=[];function a(l,c){return n.getDependency("accessor",l).then(u=>{r.setAttribute(c,u)})}for(const l in i){const c=uS[l]||l.toLowerCase();c in r.attributes||o.push(a(i[l],c))}if(t.indices!==void 0&&!r.index){const l=n.getDependency("accessor",t.indices).then(c=>{r.setIndex(c)});o.push(l)}return Jl(r,t),BLt(r,t,n),Promise.all(o).then(()=>t.targets!==void 0?RLt(r,t.targets,n):r)}function ZA(r,t){let n=r.getIndex();if(n===null){const l=[],c=r.getAttribute("position");if(c===void 0)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),r;for(let u=0;u<c.count;u++)l.push(u);r.setIndex(l),n=r.getIndex()}const i=n.count-2,o=[];if(t===$F)for(let l=1;l<=i;l++)o.push(n.getX(0)),o.push(n.getX(l)),o.push(n.getX(l+1));else for(let l=0;l<i;l++)l%2==0?(o.push(n.getX(l)),o.push(n.getX(l+1)),o.push(n.getX(l+2))):(o.push(n.getX(l+2)),o.push(n.getX(l+1)),o.push(n.getX(l)));o.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=r.clone();return a.setIndex(o),a}function JA(r){return r===void 0||r==="undefined"||r==null||r===""||r.length===0||typeof r=="object"&&Object.keys(r).length===0}function QA(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}function zLt(r,t,n,i,o,a,l,c){var u=typeof r=="function"?r.options:r;t&&(u.render=t,u.staticRenderFns=n,u._compiled=!0),i&&(u.functional=!0),a&&(u._scopeId="data-v-"+a);var h;if(l?(h=function(p){p=p||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!p&&typeof __VUE_SSR_CONTEXT__<"u"&&(p=__VUE_SSR_CONTEXT__),o&&o.call(this,p),p&&p._registeredComponents&&p._registeredComponents.add(l)},u._ssrRegister=h):o&&(h=c?function(){o.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:o),h)if(u.functional){u._injectStyles=h;var d=u.render;u.render=function(m,g){return h.call(g),d(m,g)}}else{var f=u.beforeCreate;u.beforeCreate=f?[].concat(f,h):[h]}return{exports:r,options:u}}const VLt={data:()=>({camera:null,width:document.documentElement.clientWidth||window.innerWidth,height:document.documentElement.clientHeight||window.innerHeight,canvasWidth:0,canvasHeight:0,actionShow:!1,deviceList:[],isCameraOpen:!1,task:null,model:null,modelLoad:!0,deviceId:localStorage.getItem("deviceId")||"user",flipHorizontal:!1,scene:null,threeCamera:null,renderer:null,geometry:null,background:null,mesh:null,Object3D:null,morphTarget:null,meshPopup:!1,meshIndex:0,meshListAll:[{name:"IGG+",src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68d3a08e5bb84cf1bd86c3d04124d4ea~tplv-k3u1fbpfcp-watermark.image?"},{name:"IGG",src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a657feac71414b74967d205e8584b970~tplv-k3u1fbpfcp-watermark.image?"},{name:"",src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/82ccebf7425943c9b259de3459edf145~tplv-k3u1fbpfcp-watermark.image?"},{name:"",src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/31bdecebd17247bb97b2d9d1df1c7e44~tplv-k3u1fbpfcp-watermark.image?"},{name:"2",src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/62e7922194344367a71bfaee1323e234~tplv-k3u1fbpfcp-watermark.image?"},{name:"",src:"https://dcdn.it120.cc/2022/12/14/cb57d900-8597-4c70-b34d-2966dc428bc7.png",srcX:"https://dcdn.it120.cc/2022/12/14/3f1e0c82-3455-4896-9ea3-d19541db52be.png"},{name:"+",src:"https://dcdn.it120.cc/2022/12/07/9a31a6ac-ac04-40df-b890-af64ca3ae33a.png"},{name:"",src:"https://dcdn.it120.cc/2022/12/07/fb96a09a-0d58-4365-b3f8-57054168517c.png"},{name:"",src:"https://dcdn.it120.cc/2022/12/07/dac52247-8c04-420f-84e6-26fc4b430b5e.png"},{name:"",src:"https://dcdn.it120.cc/2022/12/09/62fcfd9a-191e-4a9d-9c6a-b99e92ef7512.png"},{name:"",type:"model",src:"https://dcdn.it120.cc/2022/12/07/e64174b8-a96c-4f36-9b70-9ed5c952f4df.png",model:"https://dcdn.it120.cc/2022/12/07/55607c9c-1aaa-494a-b332-6a5360933c4a.glb"},{name:"",type:"model",src:"https://dcdn.it120.cc/2022/12/07/208ccc82-94db-4aab-a431-c7531ec190a3.png",model:"https://dcdn.it120.cc/2022/12/07/4c4096b0-fd19-4a1b-886c-7b263c35dfe9.glb"},{name:"",type:"model",src:"https://dcdn.it120.cc/2022/12/07/bb97bbff-3799-4a16-88f9-527495859e0d.png",model:"https://dcdn.it120.cc/2022/12/07/2204b6c9-e334-4e56-b056-2fe19ca7a578.glb"},{name:"",type:"model",src:"https://dcdn.it120.cc/2022/12/07/38c7776f-8604-45fc-bc4e-60435bc03f6e.png",model:"https://dcdn.it120.cc/2022/12/07/92fbd0de-9d5f-449e-999f-709e7eb0cc63.glb"},{name:"",calculateFun:"Heartglasses",type:"model",src:"https://dcdn.it120.cc/2022/12/07/e6fa3b86-863c-4d6e-844c-0e1cd03bf32c.png",model:"https://dcdn.it120.cc/2022/12/07/752de96c-bc3f-4fab-b73f-12626dad8977.glb"},{name:"(test)",calculateFun:"Heartglasses",type:"model",src:"https://dcdn.it120.cc/2022/12/13/cf78108d-3511-4c65-9502-3c92e7d4a312.png",model:"https://dcdn.it120.cc/2022/12/13/40e7af5b-97a5-45a1-8944-f172f6e04fa3.glb"}],meshList:[],helpTextModel:["0"],tabsActive:"stickers"}),mounted(){QA()&&(this.flipHorizontal=!0),this.getData(),this.$dialog.alert({message:`<div class="prompt-text">                   <h5>AR</h5>
                    <ol>
                        <li>1-2</li>
                        <li></li>
                        <li></li>
                    </ol>
                </div>`,theme:"round-button",className:"helpdialog",confirmButtonText:""}).then(()=>{this.cameraInit(),this.openCamera()})},async beforeUnmount(){this.isCameraOpen=!1,window.cancelAnimationFrame(this.task),this.mesh&&this.scene.remove(this.mesh),this.geometry&&this.scene.remove(this.geometry),this.renderer&&this.renderer.dispose(),this.threeCamera=null,this.camera&&await this.camera.stop()},methods:{isEmpty:r=>JA(r),tabsChange(){const r=this.tabsActive;this.meshIndex=-1,this.mesh&&this.scene.remove(this.mesh),this.Object3D&&(this.Object3D.visible=!1),this.geometry&&this.scene.remove(this.geometry),r==="stickers"&&(this.meshList=this.meshListAll.filter(t=>t.type!=="model")),r==="3Dmodel"&&(this.meshList=this.meshListAll.filter(t=>t.type==="model"))},async getData(){const r=this.$toast.loading({duration:0,forbidClick:!0,message:""});try{this.tabsChange()}catch(t){console.log("getData",t)}finally{r.clear()}},uploaderImage(r){const t=this.$toast.loading({duration:0,forbidClick:!0,message:"loading"});return s=window.URL&&window.URL.createObjectURL(r),r.type.includes("image/")?(this.meshList.push({src:s,name:r.name}),this.meshListAll.push({src:s,name:r.name}),t.clear()):(t.clear(),this.$toast(`-${r.type}`)),!1},uploaderGlb(r){const t=this.$toast.loading({duration:0,forbidClick:!0,message:"loading"});return s=window.URL&&window.URL.createObjectURL(r),r.name.includes(".glb")?(this.meshListAll.push({model:s,type:"model",name:r.name}),this.meshList.push({model:s,type:"model",name:r.name}),t.clear()):(t.clear(),this.$toast(`-${r.type}`)),!1},Create3dScene(){const r=this.canvasWidth,t=this.canvasHeight,n=this.$refs.video,i=this.$refs.canvas,o=new ikt,a=new gkt(n),l=new mi(new Py(r,t),new hl({map:a}));l.position.set(0,0,-1e3),o.add(l);const c=new By(r/-2,r/2,t/2,t/-2,0,2e3);c.position.set(0,0,1e3),c.lookAt(o.position);const u=new Ekt(16777215,16777215,.3);o.add(u);const h=new Okt(16777215,.7);o.add(h);const d=new eP(16777215,.7);d.position.set(.5,0,.866),o.add(d);const f=new jF({canvas:i,alpha:!0,antialias:!0});f.setPixelRatio(window.devicePixelRatio),f.setSize(r,t),this.scene=o,this.threeCamera=c,this.background=l,this.renderer=f,this.changeMesh()},changeMesh(r=0){if(r!==-1){if(this.tabsActive==="stickers"){const t=this.$toast.loading({duration:0,forbidClick:!0,message:""});try{this.mesh&&this.scene.remove(this.mesh),this.geometry&&this.scene.remove(this.geometry);const n=new ua;n.setIndex(lLt),n.setAttribute("uv",new Zo(cLt.map((l,c)=>c%2?l:1-l),2)),n.computeVertexNormals(),this.geometry=n;const i=new tP,{src:o,srcX:a}=this.meshList[r];i.load(this.flipHorizontal?o:a||o,l=>{l.encoding=Dn,l.anisotropy=16;const c=new hl({map:l,transparent:!0,color:new sn(16777215),reflectivity:.5}),u=new mi(n,c);this.scene.add(u),this.mesh=u,this.meshIndex=r,this.meshPopup=!1,t.clear()})}catch(n){console.log(n),t.clear(),this.$toast("")}}if(this.tabsActive==="3Dmodel"){const t=this.$toast.loading({duration:0,forbidClick:!0,message:"3D"});try{const n=this.meshList[r].model,i=new uLt,o=new as;this.Object3D&&this.scene.remove(this.Object3D),o.position.set(0,0,0),i.load(n,a=>{const l=a.scene,c=new $h().setFromObject(l),u=(c.getSize(new yt).length(),c.getCenter(new yt));l.position.x+=l.position.x-u.x,l.position.y+=l.position.y-u.y+1,l.position.z+=l.position.z-u.z-15,o.add(l),this.scene.add(o),this.morphTarget=this.findMorphTarget(l),this.Object3D=o,this.meshIndex=r,this.meshPopup=!1,t.clear(),console.log("",this.morphTarget)})}catch(n){console.log(n),t.clear(),this.$toast("")}}}},renderStickers(r){r&&this.updateGeometry(r),this.renderer.render(this.scene,this.threeCamera)},updateGeometry(r){const t=this.canvasWidth,n=this.canvasHeight,i=this.resolveMesh(r.scaledMesh,t,n).reduce((o,a)=>o.concat(a),[]);this.geometry.setAttribute("position",new Zo(i,3)),this.geometry.attributes.position.needsUpdate=!0},track(r,t){try{const n=t.midwayBetweenEyes[0],i=this.getScale(t.scaledMesh,234,454),o=this.getRotation(t.scaledMesh,10,50,280);r.position.set(...n),r.scale.setScalar(i/20),r.scale.x*=-1,r.rotation.setFromRotationMatrix(o),r.rotation.y=-r.rotation.y,r.rotateZ(Math.PI),r.rotateX(.05*-Math.PI),this.morphTarget&&(this.morphTarget.leftEye&&this.morphTarget.leftEye(1-t.faceRig.eye.r),this.morphTarget.rightEye&&this.morphTarget.rightEye(1-t.faceRig.eye.l),this.morphTarget.mouth&&this.morphTarget.mouth(t.faceRig.mouth.shape.A))}catch{}},trackHeartglasses(r,t){try{const n=[168].map(a=>t.faceMesh[a])[0],i=this.getScale(t.scaledMesh,234,454),o=this.getRotation(t.scaledMesh,10,50,280);r.position.set(...n),r.scale.setScalar(i/17),r.scale.x*=-1,r.rotation.setFromRotationMatrix(o),r.rotation.y=-r.rotation.y,r.rotateZ(Math.PI),r.rotateX(.1*-Math.PI)}catch(n){console.log(n)}},findMorphTarget(r,t){const n={},i=o=>{if(o.type==="Mesh"&&o.morphTargetInfluences){const a=o;Object.keys(a.morphTargetDictionary).forEach(l=>{n[l]=c=>{a.morphTargetInfluences[a.morphTargetDictionary[l]]=c}})}o.children.forEach(i)};return i(r),n},getScale(r,t=0,n=1){const i=new yt(...r[t]),o=new yt(...r[n]);return i.distanceTo(o)},getRotation(r,t=0,n=1,i=2){const o=new yt(...r[t]),a=new yt(...r[n]),l=new yt(...r[i]),c=new pn,u=a.clone().sub(l).normalize(),h=a.clone().add(l).multiplyScalar(.5).sub(o).multiplyScalar(-1).normalize(),d=new yt().crossVectors(u,h).normalize();return c.makeBasis(u,h,d).invert()},render3D(r){if(r){const{calculateFun:t}=this.meshList[this.meshIndex]||{};this.isEmpty(t)?this.track(this.Object3D,r):t==="Heartglasses"&&this.trackHeartglasses(this.Object3D,r)}this.renderer.render(this.scene,this.threeCamera)},resolveMesh(r,t=this.canvasWidth,n=this.canvasHeight){return r.map(i=>[i[0]-t/2,n/2-i[1],-i[2]])},async triggerToggleFlipHorizontal(){this.flipHorizontal=!this.flipHorizontal,this.tabsActive==="stickers"&&this.changeMesh(this.meshIndex)},actionSelect(r){const{deviceId:t}=r;this.actionShow=!1,(JA(t)||this.deviceId===t)&&(this.deviceId=t,window.localStorage.setItem("deviceId",t),this.openCamera())},async getMediaDevices(){const r=await this.camera.getMediaDevices();this.deviceList=r.map(t=>(t.name=t.label||t.deviceId,t.color=t.deviceId==this.deviceId?"#1989fa":"#323233",t))},async cameraInit(){const r=this.$refs.video;this.width>960&&(this.width=960,this.height=540),this.camera=new aLt(r,{audio:!1,video:QA()?{frameRate:60}:{width:this.width,height:this.height,frameRate:60}}),await this.getMediaDevices()},openCamera(){const r=this.$toast.loading({duration:0,forbidClick:!0,message:""});this.isCameraOpen=!1,this.camera.open(this.deviceId).then(async t=>{var c;const n=this.$refs.video,{videoWidth:i,videoHeight:o}=n,{clientWidth:a,clientHeight:l}=n;this.canvasWidth=i,this.canvasHeight=o,n.style.width=`${i}px`,n.style.height=`${o}px`,this.$refs.wrapper.style.width=`${a}px`,this.$refs.wrapper.style.height=`${i/a*l}px`,this.isCameraOpen=!0,(c=t==null?void 0:t.settings)!=null&&c.deviceId&&(this.deviceId=t.settings.deviceId,this.deviceList.filter(u=>u.deviceId===this.deviceId).length===0&&this.deviceList.unshift({color:"#1989fa",name:t.label||"[]",deviceId:this.deviceId}),window.localStorage.setItem("deviceId",this.deviceId)),await this.createModel(),this.Create3dScene(),window.cancelAnimationFrame(this.task),this.task=window.requestAnimationFrame(this.recognition)}).catch(t=>{console.log(t),this.$dialog.alert({title:"",message:`${t.errMsg}`,theme:"round-button"}).then(()=>{this.openCamera()})}).finally(()=>{r.clear()})},createModel(){return new Promise(async r=>{this.modelLoad=!0;const t=this.$toast.loading({duration:0,forbidClick:!0,message:""});await xZ("webgl");const n=U2.MediaPipeFaceMesh;this.model=await tLt(n,{maxFaces:1,refineLandmarks:!0,runtime:"mediapipe",solutionPath:"https://unpkg.com/@mediapipe/face_mesh"}),t.clear(),this.modelLoad=!1,r(this.model)})},async recognition(){try{if(this.isCameraOpen&&!this.modelLoad&&!this.isPause){const t=this.$refs.video,n=await this.model.estimateFaces(t,{flipHorizontal:!1});if(this.tabsActive==="stickers")if(n.length>0){const i=n[0].keypoints;this.renderStickers({scaledMesh:i.reduce((o,a)=>(o.push([a.x,a.y,a.z]),o),[])})}else this.renderStickers({scaledMesh:[]});if(this.tabsActive==="3Dmodel")if(n.length>0){var r=(e=n[0].keypoints).reduce((a,l)=>(a.push([l.x,l.y,l.z]),a),[]);const i=this.resolveMesh(r),o=OB.solve(e,{runtime:"mediapipe",video:t,imageSize:{height:this.canvasHeight,width:this.canvasWidth},smoothBlink:!1,blinkSettings:[.25,.75]});this.Object3D&&(this.Object3D.visible=!0),this.render3D({midwayBetweenEyes:[168].map(a=>i[a]),scaledMesh:r,faceMesh:i,faceRig:o})}else this.Object3D&&(this.Object3D.visible=!1),this.renderer.render(this.scene,this.threeCamera)}this.task=window.requestAnimationFrame(this.recognition)}catch(t){console.error(t),this.task=window.requestAnimationFrame(this.recognition)}}}};var ULt=function(){var t=this,n=t._self._c;return n("div",{staticClass:"faceMesh"},[n("div",{ref:"wrapper",staticClass:"canvas-wrapper"},[n("video",{ref:"video",style:{transform:t.flipHorizontal?"translate(-50%,-50%) scale(-1, 1)":"translate(-50%,-50%) scale(1, 1)"},attrs:{"webkit-playsinline":"true",playsinline:"true",preload:"",autoplay:"",loop:"",muted:""},domProps:{muted:!0}}),n("canvas",{ref:"canvas",style:{transform:t.flipHorizontal?"translate(-50%,-50%) scale(-1, 1)":"translate(-50%,-50%) scale(1, 1)"},attrs:{width:t.canvasWidth,height:t.canvasHeight}})]),n("van-action-sheet",{attrs:{actions:t.deviceList,description:"","cancel-text":"","close-on-click-action":""},on:{select:t.actionSelect},model:{value:t.actionShow,callback:function(i){t.actionShow=i},expression:"actionShow"}}),n("div",{staticClass:"btn-group"},[n("van-button",{attrs:{type:"default","native-type":"button",size:"small",icon:"photograph"},on:{click:function(i){t.actionShow=!0}}},[t._v("  ")]),n("van-button",{attrs:{type:"default","native-type":"button",size:"small",icon:"smile"},on:{click:function(i){t.meshPopup=!0}}},[t._v("  ")]),n("van-button",{staticClass:"flipHorizontalBut",attrs:{type:"default","native-type":"button",size:"small",icon:t.flipHorizontal?"ascending":"descending"},on:{click:t.triggerToggleFlipHorizontal}},[t._v("  ")])],1),n("van-popup",{staticClass:"meshPopup",style:{height:"80%",width:"100%"},attrs:{position:"bottom",round:"",closeable:""},model:{value:t.meshPopup,callback:function(i){t.meshPopup=i},expression:"meshPopup"}},[n("h2",{staticClass:"meshPopup-title van-hairline--bottom"},[t._v("  ")]),n("van-tabs",{attrs:{type:"card"},on:{change:t.tabsChange},model:{value:t.tabsActive,callback:function(i){t.tabsActive=i},expression:"tabsActive"}},[n("van-tab",{attrs:{name:"stickers",title:""}})],1),n("div",{staticClass:"scrollbar-y",staticStyle:{height:"calc(100% - 55px - 30px)","background-color":"#f7f8fa"}},[n("div",{staticClass:"meshList"},[t._l(t.meshList,function(i,o){return n("div",{key:o,staticClass:"meshList-item",class:{meshAction:t.meshIndex===o},on:{click:function(a){t.meshIndex!==o&&t.changeMesh(t.meshIndex=o)}}},[n("van-image",{attrs:{src:i.src,fit:"cover"}}),i.name?n("div",{staticClass:"meshName van-ellipsis",domProps:{textContent:t._s(i.name)}}):t._e()],1)}),t.tabsActive==="stickers"?n("div",{staticClass:"meshList-item"},[n("van-uploader",{attrs:{"before-read":t.uploaderImage,"preview-size":"100px",accept:"image/*"}}),n("div",{staticClass:"uploader-text"},[n("div",[n("van-icon",{attrs:{name:"photograph"}}),n("p",[t._v("")])],1)])],1):t._e()],2)])],1)],1)},WLt=[],GLt=zLt(VLt,ULt,WLt,!1,null,"93f27cb6",null,null);const HLt=GLt.exports;dn.use(jX);new dn({render:r=>r(HLt)}).$mount("#app");
